<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>initial commit - succ - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="succ Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>succ</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/827b615053b0db38bc59a894583d264a561d31a9.html">827b615053b0db38bc59a894583d264a561d31a9</a>
<b>Author:</b> ctdunc &lt;<a href="mailto:connor.t.duncan@gmail.com">connor.t.duncan@gmail.com</a>&gt;
<b>Date:</b>   Sat, 15 Jun 2019 12:06:40 -0700

initial commit

<b>Diffstat:</b>
<table><tr><td class="A">A</td><td><a href="#h0">dwm/LICENSE</a></td><td> | </td><td class="num">37</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h1">dwm/Makefile</a></td><td> | </td><td class="num">51</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">dwm/README</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">dwm/config.def.h</a></td><td> | </td><td class="num">115</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">dwm/config.h</a></td><td> | </td><td class="num">121</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">dwm/config.mk</a></td><td> | </td><td class="num">38</td><td><span class="i">++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">dwm/drw.c</a></td><td> | </td><td class="num">435</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">dwm/drw.h</a></td><td> | </td><td class="num">57</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">dwm/drw.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">dwm/dwm</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">dwm/dwm.1</a></td><td> | </td><td class="num">176</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">dwm/dwm.c</a></td><td> | </td><td class="num">2149</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">dwm/dwm.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">dwm/dwm.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">dwm/transient.c</a></td><td> | </td><td class="num">42</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">dwm/util.c</a></td><td> | </td><td class="num">35</td><td><span class="i">+++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">dwm/util.h</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">dwm/util.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">slock/LICENSE</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">slock/Makefile</a></td><td> | </td><td class="num">61</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h20">slock/README</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h21">slock/arg.h</a></td><td> | </td><td class="num">65</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h22">slock/config.def.h</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">slock/config.h</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h24">slock/config.mk</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h25">slock/explicit_bzero.c</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h26">slock/explicit_bzero.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h27">slock/slock</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h28">slock/slock.1</a></td><td> | </td><td class="num">39</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h29">slock/slock.c</a></td><td> | </td><td class="num">395</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h30">slock/slock.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h31">slock/util.h</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h32">st/FAQ</a></td><td> | </td><td class="num">167</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h33">st/LEGACY</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h34">st/LICENSE</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h35">st/Makefile</a></td><td> | </td><td class="num">57</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h36">st/README</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h37">st/TODO</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h38">st/arg.h</a></td><td> | </td><td class="num">50</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h39">st/config.def.h</a></td><td> | </td><td class="num">466</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h40">st/config.h</a></td><td> | </td><td class="num">472</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h41">st/config.mk</a></td><td> | </td><td class="num">35</td><td><span class="i">+++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h42">st/st</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h43">st/st-alpha-20190116-3be4cf1.diff</a></td><td> | </td><td class="num">200</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h44">st/st-anysize-0.8.1.diff</a></td><td> | </td><td class="num">152</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h45">st/st-clipboard-20180309-c5ba9c0.diff</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h46">st/st-hidecursor-0.8.1.diff</a></td><td> | </td><td class="num">88</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h47">st/st.1</a></td><td> | </td><td class="num">176</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h48">st/st.c</a></td><td> | </td><td class="num">2605</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h49">st/st.h</a></td><td> | </td><td class="num">123</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h50">st/st.info</a></td><td> | </td><td class="num">222</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h51">st/st.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h52">st/win.h</a></td><td> | </td><td class="num">39</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h53">st/x.c</a></td><td> | </td><td class="num">2080</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h54">st/x.c.orig</a></td><td> | </td><td class="num">2076</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h55">st/x.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h56">surf/FAQ.md</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h57">surf/LICENSE</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h58">surf/Makefile</a></td><td> | </td><td class="num">77</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h59">surf/README</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h60">surf/TODO.md</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h61">surf/arg.h</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h62">surf/common.c</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h63">surf/common.h</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h64">surf/common.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h65">surf/config.def.h</a></td><td> | </td><td class="num">197</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h66">surf/config.def.h.orig</a></td><td> | </td><td class="num">195</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h67">surf/config.def.h.rej</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h68">surf/config.h</a></td><td> | </td><td class="num">202</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h69">surf/config.mk</a></td><td> | </td><td class="num">31</td><td><span class="i">+++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h70">surf/libsurf-webext.c</a></td><td> | </td><td class="num">128</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h71">surf/libsurf-webext.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h72">surf/libsurf-webext.so</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h73">surf/surf</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h74">surf/surf-open.sh</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h75">surf/surf-patches/searchengines.diff</a></td><td> | </td><td class="num">56</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h76">surf/surf-patches/surf-homepage.diff</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h77">surf/surf.1</a></td><td> | </td><td class="num">330</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h78">surf/surf.c</a></td><td> | </td><td class="num">2153</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h79">surf/surf.c.orig</a></td><td> | </td><td class="num">2131</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h80">surf/surf.c.rej</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h81">surf/surf.o</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h82">surf/surf.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
</table></pre><pre>83 files changed, 18883 insertions(+), 0 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/dwm/LICENSE.html">dwm/LICENSE</a> b/<a href="../file/dwm/LICENSE.html">dwm/LICENSE</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1,37 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+MIT/X Consortium License
</a><a href="#h0-0-1" id="h0-0-1" class="i">+
</a><a href="#h0-0-2" id="h0-0-2" class="i">+© 2006-2019 Anselm R Garbe &lt;anselm@garbe.ca&gt;
</a><a href="#h0-0-3" id="h0-0-3" class="i">+© 2006-2009 Jukka Salmi &lt;jukka at salmi dot ch&gt;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+© 2006-2007 Sander van Dijk &lt;a dot h dot vandijk at gmail dot com&gt;
</a><a href="#h0-0-5" id="h0-0-5" class="i">+© 2007-2011 Peter Hartlich &lt;sgkkr at hartlich dot com&gt;
</a><a href="#h0-0-6" id="h0-0-6" class="i">+© 2007-2009 Szabolcs Nagy &lt;nszabolcs at gmail dot com&gt;
</a><a href="#h0-0-7" id="h0-0-7" class="i">+© 2007-2009 Christof Musik &lt;christof at sendfax dot de&gt;
</a><a href="#h0-0-8" id="h0-0-8" class="i">+© 2007-2009 Premysl Hruby &lt;dfenze at gmail dot com&gt;
</a><a href="#h0-0-9" id="h0-0-9" class="i">+© 2007-2008 Enno Gottox Boland &lt;gottox at s01 dot de&gt;
</a><a href="#h0-0-10" id="h0-0-10" class="i">+© 2008 Martin Hurton &lt;martin dot hurton at gmail dot com&gt;
</a><a href="#h0-0-11" id="h0-0-11" class="i">+© 2008 Neale Pickett &lt;neale dot woozle dot org&gt;
</a><a href="#h0-0-12" id="h0-0-12" class="i">+© 2009 Mate Nagy &lt;mnagy at port70 dot net&gt;
</a><a href="#h0-0-13" id="h0-0-13" class="i">+© 2010-2016 Hiltjo Posthuma &lt;hiltjo@codemadness.org&gt;
</a><a href="#h0-0-14" id="h0-0-14" class="i">+© 2010-2012 Connor Lane Smith &lt;cls@lubutu.com&gt;
</a><a href="#h0-0-15" id="h0-0-15" class="i">+© 2011 Christoph Lohmann &lt;20h@r-36.net&gt;
</a><a href="#h0-0-16" id="h0-0-16" class="i">+© 2015-2016 Quentin Rameau &lt;quinq@fifth.space&gt;
</a><a href="#h0-0-17" id="h0-0-17" class="i">+© 2015-2016 Eric Pruitt &lt;eric.pruitt@gmail.com&gt;
</a><a href="#h0-0-18" id="h0-0-18" class="i">+© 2016-2017 Markus Teich &lt;markus.teich@stusta.mhn.de&gt;
</a><a href="#h0-0-19" id="h0-0-19" class="i">+
</a><a href="#h0-0-20" id="h0-0-20" class="i">+Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h0-0-21" id="h0-0-21" class="i">+copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h0-0-22" id="h0-0-22" class="i">+to deal in the Software without restriction, including without limitation
</a><a href="#h0-0-23" id="h0-0-23" class="i">+the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h0-0-24" id="h0-0-24" class="i">+and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h0-0-25" id="h0-0-25" class="i">+Software is furnished to do so, subject to the following conditions:
</a><a href="#h0-0-26" id="h0-0-26" class="i">+
</a><a href="#h0-0-27" id="h0-0-27" class="i">+The above copyright notice and this permission notice shall be included in
</a><a href="#h0-0-28" id="h0-0-28" class="i">+all copies or substantial portions of the Software.
</a><a href="#h0-0-29" id="h0-0-29" class="i">+
</a><a href="#h0-0-30" id="h0-0-30" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h0-0-31" id="h0-0-31" class="i">+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h0-0-32" id="h0-0-32" class="i">+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h0-0-33" id="h0-0-33" class="i">+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h0-0-34" id="h0-0-34" class="i">+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h0-0-35" id="h0-0-35" class="i">+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h0-0-36" id="h0-0-36" class="i">+DEALINGS IN THE SOFTWARE.
</a><b>diff --git a/<a id="h1" href="../file/dwm/Makefile.html">dwm/Makefile</a> b/<a href="../file/dwm/Makefile.html">dwm/Makefile</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1,51 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+# dwm - dynamic window manager
</a><a href="#h1-0-1" id="h1-0-1" class="i">+# See LICENSE file for copyright and license details.
</a><a href="#h1-0-2" id="h1-0-2" class="i">+
</a><a href="#h1-0-3" id="h1-0-3" class="i">+include config.mk
</a><a href="#h1-0-4" id="h1-0-4" class="i">+
</a><a href="#h1-0-5" id="h1-0-5" class="i">+SRC = drw.c dwm.c util.c
</a><a href="#h1-0-6" id="h1-0-6" class="i">+OBJ = ${SRC:.c=.o}
</a><a href="#h1-0-7" id="h1-0-7" class="i">+
</a><a href="#h1-0-8" id="h1-0-8" class="i">+all: options dwm
</a><a href="#h1-0-9" id="h1-0-9" class="i">+
</a><a href="#h1-0-10" id="h1-0-10" class="i">+options:
</a><a href="#h1-0-11" id="h1-0-11" class="i">+	@echo dwm build options:
</a><a href="#h1-0-12" id="h1-0-12" class="i">+	@echo &quot;CFLAGS   = ${CFLAGS}&quot;
</a><a href="#h1-0-13" id="h1-0-13" class="i">+	@echo &quot;LDFLAGS  = ${LDFLAGS}&quot;
</a><a href="#h1-0-14" id="h1-0-14" class="i">+	@echo &quot;CC       = ${CC}&quot;
</a><a href="#h1-0-15" id="h1-0-15" class="i">+
</a><a href="#h1-0-16" id="h1-0-16" class="i">+.c.o:
</a><a href="#h1-0-17" id="h1-0-17" class="i">+	${CC} -c ${CFLAGS} $&lt;
</a><a href="#h1-0-18" id="h1-0-18" class="i">+
</a><a href="#h1-0-19" id="h1-0-19" class="i">+${OBJ}: config.h config.mk
</a><a href="#h1-0-20" id="h1-0-20" class="i">+
</a><a href="#h1-0-21" id="h1-0-21" class="i">+config.h:
</a><a href="#h1-0-22" id="h1-0-22" class="i">+	cp config.def.h $@
</a><a href="#h1-0-23" id="h1-0-23" class="i">+
</a><a href="#h1-0-24" id="h1-0-24" class="i">+dwm: ${OBJ}
</a><a href="#h1-0-25" id="h1-0-25" class="i">+	${CC} -o $@ ${OBJ} ${LDFLAGS}
</a><a href="#h1-0-26" id="h1-0-26" class="i">+
</a><a href="#h1-0-27" id="h1-0-27" class="i">+clean:
</a><a href="#h1-0-28" id="h1-0-28" class="i">+	rm -f dwm ${OBJ} dwm-${VERSION}.tar.gz
</a><a href="#h1-0-29" id="h1-0-29" class="i">+
</a><a href="#h1-0-30" id="h1-0-30" class="i">+dist: clean
</a><a href="#h1-0-31" id="h1-0-31" class="i">+	mkdir -p dwm-${VERSION}
</a><a href="#h1-0-32" id="h1-0-32" class="i">+	cp -R LICENSE Makefile README config.def.h config.mk\
</a><a href="#h1-0-33" id="h1-0-33" class="i">+		dwm.1 drw.h util.h ${SRC} dwm.png transient.c dwm-${VERSION}
</a><a href="#h1-0-34" id="h1-0-34" class="i">+	tar -cf dwm-${VERSION}.tar dwm-${VERSION}
</a><a href="#h1-0-35" id="h1-0-35" class="i">+	gzip dwm-${VERSION}.tar
</a><a href="#h1-0-36" id="h1-0-36" class="i">+	rm -rf dwm-${VERSION}
</a><a href="#h1-0-37" id="h1-0-37" class="i">+
</a><a href="#h1-0-38" id="h1-0-38" class="i">+install: all
</a><a href="#h1-0-39" id="h1-0-39" class="i">+	mkdir -p ${DESTDIR}${PREFIX}/bin
</a><a href="#h1-0-40" id="h1-0-40" class="i">+	cp -f dwm ${DESTDIR}${PREFIX}/bin
</a><a href="#h1-0-41" id="h1-0-41" class="i">+	chmod 755 ${DESTDIR}${PREFIX}/bin/dwm
</a><a href="#h1-0-42" id="h1-0-42" class="i">+	mkdir -p ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h1-0-43" id="h1-0-43" class="i">+	sed &quot;s/VERSION/${VERSION}/g&quot; &lt; dwm.1 &gt; ${DESTDIR}${MANPREFIX}/man1/dwm.1
</a><a href="#h1-0-44" id="h1-0-44" class="i">+	chmod 644 ${DESTDIR}${MANPREFIX}/man1/dwm.1
</a><a href="#h1-0-45" id="h1-0-45" class="i">+
</a><a href="#h1-0-46" id="h1-0-46" class="i">+uninstall:
</a><a href="#h1-0-47" id="h1-0-47" class="i">+	rm -f ${DESTDIR}${PREFIX}/bin/dwm\
</a><a href="#h1-0-48" id="h1-0-48" class="i">+		${DESTDIR}${MANPREFIX}/man1/dwm.1
</a><a href="#h1-0-49" id="h1-0-49" class="i">+
</a><a href="#h1-0-50" id="h1-0-50" class="i">+.PHONY: all options clean dist install uninstall
</a><b>diff --git a/<a id="h2" href="../file/dwm/README.html">dwm/README</a> b/<a href="../file/dwm/README.html">dwm/README</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,48 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+dwm - dynamic window manager
</a><a href="#h2-0-1" id="h2-0-1" class="i">+============================
</a><a href="#h2-0-2" id="h2-0-2" class="i">+dwm is an extremely fast, small, and dynamic window manager for X.
</a><a href="#h2-0-3" id="h2-0-3" class="i">+
</a><a href="#h2-0-4" id="h2-0-4" class="i">+
</a><a href="#h2-0-5" id="h2-0-5" class="i">+Requirements
</a><a href="#h2-0-6" id="h2-0-6" class="i">+------------
</a><a href="#h2-0-7" id="h2-0-7" class="i">+In order to build dwm you need the Xlib header files.
</a><a href="#h2-0-8" id="h2-0-8" class="i">+
</a><a href="#h2-0-9" id="h2-0-9" class="i">+
</a><a href="#h2-0-10" id="h2-0-10" class="i">+Installation
</a><a href="#h2-0-11" id="h2-0-11" class="i">+------------
</a><a href="#h2-0-12" id="h2-0-12" class="i">+Edit config.mk to match your local setup (dwm is installed into
</a><a href="#h2-0-13" id="h2-0-13" class="i">+the /usr/local namespace by default).
</a><a href="#h2-0-14" id="h2-0-14" class="i">+
</a><a href="#h2-0-15" id="h2-0-15" class="i">+Afterwards enter the following command to build and install dwm (if
</a><a href="#h2-0-16" id="h2-0-16" class="i">+necessary as root):
</a><a href="#h2-0-17" id="h2-0-17" class="i">+
</a><a href="#h2-0-18" id="h2-0-18" class="i">+    make clean install
</a><a href="#h2-0-19" id="h2-0-19" class="i">+
</a><a href="#h2-0-20" id="h2-0-20" class="i">+
</a><a href="#h2-0-21" id="h2-0-21" class="i">+Running dwm
</a><a href="#h2-0-22" id="h2-0-22" class="i">+-----------
</a><a href="#h2-0-23" id="h2-0-23" class="i">+Add the following line to your .xinitrc to start dwm using startx:
</a><a href="#h2-0-24" id="h2-0-24" class="i">+
</a><a href="#h2-0-25" id="h2-0-25" class="i">+    exec dwm
</a><a href="#h2-0-26" id="h2-0-26" class="i">+
</a><a href="#h2-0-27" id="h2-0-27" class="i">+In order to connect dwm to a specific display, make sure that
</a><a href="#h2-0-28" id="h2-0-28" class="i">+the DISPLAY environment variable is set correctly, e.g.:
</a><a href="#h2-0-29" id="h2-0-29" class="i">+
</a><a href="#h2-0-30" id="h2-0-30" class="i">+    DISPLAY=foo.bar:1 exec dwm
</a><a href="#h2-0-31" id="h2-0-31" class="i">+
</a><a href="#h2-0-32" id="h2-0-32" class="i">+(This will start dwm on display :1 of the host foo.bar.)
</a><a href="#h2-0-33" id="h2-0-33" class="i">+
</a><a href="#h2-0-34" id="h2-0-34" class="i">+In order to display status info in the bar, you can do something
</a><a href="#h2-0-35" id="h2-0-35" class="i">+like this in your .xinitrc:
</a><a href="#h2-0-36" id="h2-0-36" class="i">+
</a><a href="#h2-0-37" id="h2-0-37" class="i">+    while xsetroot -name &quot;`date` `uptime | sed &#39;s/.*,//&#39;`&quot;
</a><a href="#h2-0-38" id="h2-0-38" class="i">+    do
</a><a href="#h2-0-39" id="h2-0-39" class="i">+    	sleep 1
</a><a href="#h2-0-40" id="h2-0-40" class="i">+    done &amp;
</a><a href="#h2-0-41" id="h2-0-41" class="i">+    exec dwm
</a><a href="#h2-0-42" id="h2-0-42" class="i">+
</a><a href="#h2-0-43" id="h2-0-43" class="i">+
</a><a href="#h2-0-44" id="h2-0-44" class="i">+Configuration
</a><a href="#h2-0-45" id="h2-0-45" class="i">+-------------
</a><a href="#h2-0-46" id="h2-0-46" class="i">+The configuration of dwm is done by creating a custom config.h
</a><a href="#h2-0-47" id="h2-0-47" class="i">+and (re)compiling the source code.
</a><b>diff --git a/<a id="h3" href="../file/dwm/config.def.h.html">dwm/config.def.h</a> b/<a href="../file/dwm/config.def.h.html">dwm/config.def.h</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,115 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+/* appearance */
</a><a href="#h3-0-3" id="h3-0-3" class="i">+static const unsigned int borderpx  = 1;        /* border pixel of windows */
</a><a href="#h3-0-4" id="h3-0-4" class="i">+static const unsigned int snap      = 32;       /* snap pixel */
</a><a href="#h3-0-5" id="h3-0-5" class="i">+static const int showbar            = 1;        /* 0 means no bar */
</a><a href="#h3-0-6" id="h3-0-6" class="i">+static const int topbar             = 1;        /* 0 means bottom bar */
</a><a href="#h3-0-7" id="h3-0-7" class="i">+static const char *fonts[]          = { &quot;monospace:size=10&quot; };
</a><a href="#h3-0-8" id="h3-0-8" class="i">+static const char dmenufont[]       = &quot;monospace:size=10&quot;;
</a><a href="#h3-0-9" id="h3-0-9" class="i">+static const char col_gray1[]       = &quot;#222222&quot;;
</a><a href="#h3-0-10" id="h3-0-10" class="i">+static const char col_gray2[]       = &quot;#444444&quot;;
</a><a href="#h3-0-11" id="h3-0-11" class="i">+static const char col_gray3[]       = &quot;#bbbbbb&quot;;
</a><a href="#h3-0-12" id="h3-0-12" class="i">+static const char col_gray4[]       = &quot;#eeeeee&quot;;
</a><a href="#h3-0-13" id="h3-0-13" class="i">+static const char col_cyan[]        = &quot;#005577&quot;;
</a><a href="#h3-0-14" id="h3-0-14" class="i">+static const char *colors[][3]      = {
</a><a href="#h3-0-15" id="h3-0-15" class="i">+	/*               fg         bg         border   */
</a><a href="#h3-0-16" id="h3-0-16" class="i">+	[SchemeNorm] = { col_gray3, col_gray1, col_gray2 },
</a><a href="#h3-0-17" id="h3-0-17" class="i">+	[SchemeSel]  = { col_gray4, col_cyan,  col_cyan  },
</a><a href="#h3-0-18" id="h3-0-18" class="i">+};
</a><a href="#h3-0-19" id="h3-0-19" class="i">+
</a><a href="#h3-0-20" id="h3-0-20" class="i">+/* tagging */
</a><a href="#h3-0-21" id="h3-0-21" class="i">+static const char *tags[] = { &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot; };
</a><a href="#h3-0-22" id="h3-0-22" class="i">+
</a><a href="#h3-0-23" id="h3-0-23" class="i">+static const Rule rules[] = {
</a><a href="#h3-0-24" id="h3-0-24" class="i">+	/* xprop(1):
</a><a href="#h3-0-25" id="h3-0-25" class="i">+	 *	WM_CLASS(STRING) = instance, class
</a><a href="#h3-0-26" id="h3-0-26" class="i">+	 *	WM_NAME(STRING) = title
</a><a href="#h3-0-27" id="h3-0-27" class="i">+	 */
</a><a href="#h3-0-28" id="h3-0-28" class="i">+	/* class      instance    title       tags mask     isfloating   monitor */
</a><a href="#h3-0-29" id="h3-0-29" class="i">+	{ &quot;Gimp&quot;,     NULL,       NULL,       0,            1,           -1 },
</a><a href="#h3-0-30" id="h3-0-30" class="i">+	{ &quot;Firefox&quot;,  NULL,       NULL,       1 &lt;&lt; 8,       0,           -1 },
</a><a href="#h3-0-31" id="h3-0-31" class="i">+};
</a><a href="#h3-0-32" id="h3-0-32" class="i">+
</a><a href="#h3-0-33" id="h3-0-33" class="i">+/* layout(s) */
</a><a href="#h3-0-34" id="h3-0-34" class="i">+static const float mfact     = 0.55; /* factor of master area size [0.05..0.95] */
</a><a href="#h3-0-35" id="h3-0-35" class="i">+static const int nmaster     = 1;    /* number of clients in master area */
</a><a href="#h3-0-36" id="h3-0-36" class="i">+static const int resizehints = 1;    /* 1 means respect size hints in tiled resizals */
</a><a href="#h3-0-37" id="h3-0-37" class="i">+
</a><a href="#h3-0-38" id="h3-0-38" class="i">+static const Layout layouts[] = {
</a><a href="#h3-0-39" id="h3-0-39" class="i">+	/* symbol     arrange function */
</a><a href="#h3-0-40" id="h3-0-40" class="i">+	{ &quot;[]=&quot;,      tile },    /* first entry is default */
</a><a href="#h3-0-41" id="h3-0-41" class="i">+	{ &quot;&gt;&lt;&gt;&quot;,      NULL },    /* no layout function means floating behavior */
</a><a href="#h3-0-42" id="h3-0-42" class="i">+	{ &quot;[M]&quot;,      monocle },
</a><a href="#h3-0-43" id="h3-0-43" class="i">+};
</a><a href="#h3-0-44" id="h3-0-44" class="i">+
</a><a href="#h3-0-45" id="h3-0-45" class="i">+/* key definitions */
</a><a href="#h3-0-46" id="h3-0-46" class="i">+#define MODKEY Mod1Mask
</a><a href="#h3-0-47" id="h3-0-47" class="i">+#define TAGKEYS(KEY,TAG) \
</a><a href="#h3-0-48" id="h3-0-48" class="i">+	{ MODKEY,                       KEY,      view,           {.ui = 1 &lt;&lt; TAG} }, \
</a><a href="#h3-0-49" id="h3-0-49" class="i">+	{ MODKEY|ControlMask,           KEY,      toggleview,     {.ui = 1 &lt;&lt; TAG} }, \
</a><a href="#h3-0-50" id="h3-0-50" class="i">+	{ MODKEY|ShiftMask,             KEY,      tag,            {.ui = 1 &lt;&lt; TAG} }, \
</a><a href="#h3-0-51" id="h3-0-51" class="i">+	{ MODKEY|ControlMask|ShiftMask, KEY,      toggletag,      {.ui = 1 &lt;&lt; TAG} },
</a><a href="#h3-0-52" id="h3-0-52" class="i">+
</a><a href="#h3-0-53" id="h3-0-53" class="i">+/* helper for spawning shell commands in the pre dwm-5.0 fashion */
</a><a href="#h3-0-54" id="h3-0-54" class="i">+#define SHCMD(cmd) { .v = (const char*[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, cmd, NULL } }
</a><a href="#h3-0-55" id="h3-0-55" class="i">+
</a><a href="#h3-0-56" id="h3-0-56" class="i">+/* commands */
</a><a href="#h3-0-57" id="h3-0-57" class="i">+static char dmenumon[2] = &quot;0&quot;; /* component of dmenucmd, manipulated in spawn() */
</a><a href="#h3-0-58" id="h3-0-58" class="i">+static const char *dmenucmd[] = { &quot;dmenu_run&quot;, &quot;-m&quot;, dmenumon, &quot;-fn&quot;, dmenufont, &quot;-nb&quot;, col_gray1, &quot;-nf&quot;, col_gray3, &quot;-sb&quot;, col_cyan, &quot;-sf&quot;, col_gray4, NULL };
</a><a href="#h3-0-59" id="h3-0-59" class="i">+static const char *termcmd[]  = { &quot;st&quot;, NULL };
</a><a href="#h3-0-60" id="h3-0-60" class="i">+
</a><a href="#h3-0-61" id="h3-0-61" class="i">+static Key keys[] = {
</a><a href="#h3-0-62" id="h3-0-62" class="i">+	/* modifier                     key        function        argument */
</a><a href="#h3-0-63" id="h3-0-63" class="i">+	{ MODKEY,                       XK_p,      spawn,          {.v = dmenucmd } },
</a><a href="#h3-0-64" id="h3-0-64" class="i">+	{ MODKEY|ShiftMask,             XK_Return, spawn,          {.v = termcmd } },
</a><a href="#h3-0-65" id="h3-0-65" class="i">+	{ MODKEY,                       XK_b,      togglebar,      {0} },
</a><a href="#h3-0-66" id="h3-0-66" class="i">+	{ MODKEY,                       XK_j,      focusstack,     {.i = +1 } },
</a><a href="#h3-0-67" id="h3-0-67" class="i">+	{ MODKEY,                       XK_k,      focusstack,     {.i = -1 } },
</a><a href="#h3-0-68" id="h3-0-68" class="i">+	{ MODKEY,                       XK_i,      incnmaster,     {.i = +1 } },
</a><a href="#h3-0-69" id="h3-0-69" class="i">+	{ MODKEY,                       XK_d,      incnmaster,     {.i = -1 } },
</a><a href="#h3-0-70" id="h3-0-70" class="i">+	{ MODKEY,                       XK_h,      setmfact,       {.f = -0.05} },
</a><a href="#h3-0-71" id="h3-0-71" class="i">+	{ MODKEY,                       XK_l,      setmfact,       {.f = +0.05} },
</a><a href="#h3-0-72" id="h3-0-72" class="i">+	{ MODKEY,                       XK_Return, zoom,           {0} },
</a><a href="#h3-0-73" id="h3-0-73" class="i">+	{ MODKEY,                       XK_Tab,    view,           {0} },
</a><a href="#h3-0-74" id="h3-0-74" class="i">+	{ MODKEY|ShiftMask,             XK_c,      killclient,     {0} },
</a><a href="#h3-0-75" id="h3-0-75" class="i">+	{ MODKEY,                       XK_t,      setlayout,      {.v = &amp;layouts[0]} },
</a><a href="#h3-0-76" id="h3-0-76" class="i">+	{ MODKEY,                       XK_f,      setlayout,      {.v = &amp;layouts[1]} },
</a><a href="#h3-0-77" id="h3-0-77" class="i">+	{ MODKEY,                       XK_m,      setlayout,      {.v = &amp;layouts[2]} },
</a><a href="#h3-0-78" id="h3-0-78" class="i">+	{ MODKEY,                       XK_space,  setlayout,      {0} },
</a><a href="#h3-0-79" id="h3-0-79" class="i">+	{ MODKEY|ShiftMask,             XK_space,  togglefloating, {0} },
</a><a href="#h3-0-80" id="h3-0-80" class="i">+	{ MODKEY,                       XK_0,      view,           {.ui = ~0 } },
</a><a href="#h3-0-81" id="h3-0-81" class="i">+	{ MODKEY|ShiftMask,             XK_0,      tag,            {.ui = ~0 } },
</a><a href="#h3-0-82" id="h3-0-82" class="i">+	{ MODKEY,                       XK_comma,  focusmon,       {.i = -1 } },
</a><a href="#h3-0-83" id="h3-0-83" class="i">+	{ MODKEY,                       XK_period, focusmon,       {.i = +1 } },
</a><a href="#h3-0-84" id="h3-0-84" class="i">+	{ MODKEY|ShiftMask,             XK_comma,  tagmon,         {.i = -1 } },
</a><a href="#h3-0-85" id="h3-0-85" class="i">+	{ MODKEY|ShiftMask,             XK_period, tagmon,         {.i = +1 } },
</a><a href="#h3-0-86" id="h3-0-86" class="i">+	TAGKEYS(                        XK_1,                      0)
</a><a href="#h3-0-87" id="h3-0-87" class="i">+	TAGKEYS(                        XK_2,                      1)
</a><a href="#h3-0-88" id="h3-0-88" class="i">+	TAGKEYS(                        XK_3,                      2)
</a><a href="#h3-0-89" id="h3-0-89" class="i">+	TAGKEYS(                        XK_4,                      3)
</a><a href="#h3-0-90" id="h3-0-90" class="i">+	TAGKEYS(                        XK_5,                      4)
</a><a href="#h3-0-91" id="h3-0-91" class="i">+	TAGKEYS(                        XK_6,                      5)
</a><a href="#h3-0-92" id="h3-0-92" class="i">+	TAGKEYS(                        XK_7,                      6)
</a><a href="#h3-0-93" id="h3-0-93" class="i">+	TAGKEYS(                        XK_8,                      7)
</a><a href="#h3-0-94" id="h3-0-94" class="i">+	TAGKEYS(                        XK_9,                      8)
</a><a href="#h3-0-95" id="h3-0-95" class="i">+	{ MODKEY|ShiftMask,             XK_q,      quit,           {0} },
</a><a href="#h3-0-96" id="h3-0-96" class="i">+};
</a><a href="#h3-0-97" id="h3-0-97" class="i">+
</a><a href="#h3-0-98" id="h3-0-98" class="i">+/* button definitions */
</a><a href="#h3-0-99" id="h3-0-99" class="i">+/* click can be ClkTagBar, ClkLtSymbol, ClkStatusText, ClkWinTitle, ClkClientWin, or ClkRootWin */
</a><a href="#h3-0-100" id="h3-0-100" class="i">+static Button buttons[] = {
</a><a href="#h3-0-101" id="h3-0-101" class="i">+	/* click                event mask      button          function        argument */
</a><a href="#h3-0-102" id="h3-0-102" class="i">+	{ ClkLtSymbol,          0,              Button1,        setlayout,      {0} },
</a><a href="#h3-0-103" id="h3-0-103" class="i">+	{ ClkLtSymbol,          0,              Button3,        setlayout,      {.v = &amp;layouts[2]} },
</a><a href="#h3-0-104" id="h3-0-104" class="i">+	{ ClkWinTitle,          0,              Button2,        zoom,           {0} },
</a><a href="#h3-0-105" id="h3-0-105" class="i">+	{ ClkStatusText,        0,              Button2,        spawn,          {.v = termcmd } },
</a><a href="#h3-0-106" id="h3-0-106" class="i">+	{ ClkClientWin,         MODKEY,         Button1,        movemouse,      {0} },
</a><a href="#h3-0-107" id="h3-0-107" class="i">+	{ ClkClientWin,         MODKEY,         Button2,        togglefloating, {0} },
</a><a href="#h3-0-108" id="h3-0-108" class="i">+	{ ClkClientWin,         MODKEY,         Button3,        resizemouse,    {0} },
</a><a href="#h3-0-109" id="h3-0-109" class="i">+	{ ClkTagBar,            0,              Button1,        view,           {0} },
</a><a href="#h3-0-110" id="h3-0-110" class="i">+	{ ClkTagBar,            0,              Button3,        toggleview,     {0} },
</a><a href="#h3-0-111" id="h3-0-111" class="i">+	{ ClkTagBar,            MODKEY,         Button1,        tag,            {0} },
</a><a href="#h3-0-112" id="h3-0-112" class="i">+	{ ClkTagBar,            MODKEY,         Button3,        toggletag,      {0} },
</a><a href="#h3-0-113" id="h3-0-113" class="i">+};
</a><a href="#h3-0-114" id="h3-0-114" class="i">+
</a><b>diff --git a/<a id="h4" href="../file/dwm/config.h.html">dwm/config.h</a> b/<a href="../file/dwm/config.h.html">dwm/config.h</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,121 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+/* appearance */
</a><a href="#h4-0-3" id="h4-0-3" class="i">+static const unsigned int borderpx  = 1;        /* border pixel of windows */
</a><a href="#h4-0-4" id="h4-0-4" class="i">+static const unsigned int snap      = 32;       /* snap pixel */
</a><a href="#h4-0-5" id="h4-0-5" class="i">+static const int showbar            = 1;        /* 0 means no bar */
</a><a href="#h4-0-6" id="h4-0-6" class="i">+static const int topbar             = 1;        /* 0 means bottom bar */
</a><a href="#h4-0-7" id="h4-0-7" class="i">+static const char *fonts[]          = { &quot;UbuntuMono Nerd Font:size=11&quot;  };
</a><a href="#h4-0-8" id="h4-0-8" class="i">+static const char dmenufont[]       = &quot;monospace:size=11&quot;;
</a><a href="#h4-0-9" id="h4-0-9" class="i">+static const char col_gray1[]       = &quot;#070707&quot;; //background normal
</a><a href="#h4-0-10" id="h4-0-10" class="i">+static const char col_gray2[]       = &quot;#070707&quot;; //border normal
</a><a href="#h4-0-11" id="h4-0-11" class="i">+static const char col_gray3[]       = &quot;#fbf0d2&quot;; //foreground normal
</a><a href="#h4-0-12" id="h4-0-12" class="i">+static const char col_gray4[]       = &quot;#f79031&quot;; //foreground selected
</a><a href="#h4-0-13" id="h4-0-13" class="i">+static const char col_cyan[]        = &quot;#a0446c&quot;; //background/border selected
</a><a href="#h4-0-14" id="h4-0-14" class="i">+static const char *colors[][3]      = {
</a><a href="#h4-0-15" id="h4-0-15" class="i">+	/*               fg         bg         border   */
</a><a href="#h4-0-16" id="h4-0-16" class="i">+	[SchemeNorm] = { col_gray3, col_gray1, col_gray2 },
</a><a href="#h4-0-17" id="h4-0-17" class="i">+	[SchemeSel]  = { col_gray4, col_cyan,  col_cyan  },
</a><a href="#h4-0-18" id="h4-0-18" class="i">+};
</a><a href="#h4-0-19" id="h4-0-19" class="i">+
</a><a href="#h4-0-20" id="h4-0-20" class="i">+/* tagging */
</a><a href="#h4-0-21" id="h4-0-21" class="i">+/* { code, pdf, admin, paused, research, processing, spotify, web} */
</a><a href="#h4-0-22" id="h4-0-22" class="i">+static const char *tags[] = { &quot;\ue62b&quot;, &quot;\uf02d&quot;, &quot;\uf303&quot;,&quot;\uf8e6&quot;, &quot;\uf848&quot;, &quot;\ufcc1&quot;, &quot;\uf6ed&quot;, &quot;\uf1bc&quot;, &quot;\ufa9e&quot; };
</a><a href="#h4-0-23" id="h4-0-23" class="i">+
</a><a href="#h4-0-24" id="h4-0-24" class="i">+static const Rule rules[] = {
</a><a href="#h4-0-25" id="h4-0-25" class="i">+	/* xprop(1):
</a><a href="#h4-0-26" id="h4-0-26" class="i">+	 *	WM_CLASS(STRING) = instance, class
</a><a href="#h4-0-27" id="h4-0-27" class="i">+	 *	WM_NAME(STRING) = title
</a><a href="#h4-0-28" id="h4-0-28" class="i">+	 */
</a><a href="#h4-0-29" id="h4-0-29" class="i">+	/* class      instance    title       tags mask     isfloating   monitor */
</a><a href="#h4-0-30" id="h4-0-30" class="i">+	{ &quot;Spotify&quot;,  NULL,       NULL,       1 &lt;&lt; 8,       0,		 -1 },
</a><a href="#h4-0-31" id="h4-0-31" class="i">+	{ &quot;Firefox&quot;,  NULL,       NULL,       1 &lt;&lt; 8,       0,           -1 },
</a><a href="#h4-0-32" id="h4-0-32" class="i">+	{ &quot;Surf&quot;,     NULL,	  NULL,	      1 &lt;&lt; 8,	    0,		 -1 },
</a><a href="#h4-0-33" id="h4-0-33" class="i">+};
</a><a href="#h4-0-34" id="h4-0-34" class="i">+
</a><a href="#h4-0-35" id="h4-0-35" class="i">+/* layout(s) */
</a><a href="#h4-0-36" id="h4-0-36" class="i">+static const float mfact     = 0.55; /* factor of master area size [0.05..0.95] */
</a><a href="#h4-0-37" id="h4-0-37" class="i">+static const int nmaster     = 1;    /* number of clients in master area */
</a><a href="#h4-0-38" id="h4-0-38" class="i">+static const int resizehints = 1;    /* 1 means respect size hints in tiled resizals */
</a><a href="#h4-0-39" id="h4-0-39" class="i">+
</a><a href="#h4-0-40" id="h4-0-40" class="i">+static const Layout layouts[] = {
</a><a href="#h4-0-41" id="h4-0-41" class="i">+	/* symbol     arrange function */
</a><a href="#h4-0-42" id="h4-0-42" class="i">+	{ &quot;til&quot;,	tile },    /* first entry is default */
</a><a href="#h4-0-43" id="h4-0-43" class="i">+	{ &quot;flt&quot;,	NULL },    /* no layout function means floating behavior */
</a><a href="#h4-0-44" id="h4-0-44" class="i">+	{ &quot;mnc&quot;,	monocle },
</a><a href="#h4-0-45" id="h4-0-45" class="i">+};
</a><a href="#h4-0-46" id="h4-0-46" class="i">+
</a><a href="#h4-0-47" id="h4-0-47" class="i">+/* key definitions */
</a><a href="#h4-0-48" id="h4-0-48" class="i">+#define MODKEY Mod4Mask
</a><a href="#h4-0-49" id="h4-0-49" class="i">+#define TAGKEYS(KEY,TAG) \
</a><a href="#h4-0-50" id="h4-0-50" class="i">+	{ MODKEY,                       KEY,      view,           {.ui = 1 &lt;&lt; TAG} }, \
</a><a href="#h4-0-51" id="h4-0-51" class="i">+	{ MODKEY|ControlMask,           KEY,      toggleview,     {.ui = 1 &lt;&lt; TAG} }, \
</a><a href="#h4-0-52" id="h4-0-52" class="i">+	{ MODKEY|ShiftMask,             KEY,      tag,            {.ui = 1 &lt;&lt; TAG} }, \
</a><a href="#h4-0-53" id="h4-0-53" class="i">+	{ MODKEY|ControlMask|ShiftMask, KEY,      toggletag,      {.ui = 1 &lt;&lt; TAG} },
</a><a href="#h4-0-54" id="h4-0-54" class="i">+
</a><a href="#h4-0-55" id="h4-0-55" class="i">+/* helper for spawning shell commands in the pre dwm-5.0 fashion */
</a><a href="#h4-0-56" id="h4-0-56" class="i">+#define SHCMD(cmd) { .v = (const char*[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, cmd, NULL } }
</a><a href="#h4-0-57" id="h4-0-57" class="i">+
</a><a href="#h4-0-58" id="h4-0-58" class="i">+/* commands */
</a><a href="#h4-0-59" id="h4-0-59" class="i">+static char dmenumon[2] = &quot;0&quot;; /* component of dmenucmd, manipulated in spawn() */
</a><a href="#h4-0-60" id="h4-0-60" class="i">+static const char *dmenucmd[] = { &quot;dmenu_run&quot;, &quot;-m&quot;, dmenumon, &quot;-fn&quot;, dmenufont, &quot;-nb&quot;, col_gray1, &quot;-nf&quot;, col_gray3, &quot;-sb&quot;, col_cyan, &quot;-sf&quot;, col_gray4, NULL };
</a><a href="#h4-0-61" id="h4-0-61" class="i">+static const char *termcmd[]  = { &quot;st&quot;, NULL };
</a><a href="#h4-0-62" id="h4-0-62" class="i">+static const char *lockcmd[] = {&quot;slock&quot;, NULL };
</a><a href="#h4-0-63" id="h4-0-63" class="i">+static const char *surfcmd[] = { &quot;surf&quot;, NULL}; 
</a><a href="#h4-0-64" id="h4-0-64" class="i">+
</a><a href="#h4-0-65" id="h4-0-65" class="i">+static Key keys[] = {
</a><a href="#h4-0-66" id="h4-0-66" class="i">+	/* modifier                     key        function        argument */
</a><a href="#h4-0-67" id="h4-0-67" class="i">+	{ MODKEY,                       XK_d,      spawn,          {.v = dmenucmd } },
</a><a href="#h4-0-68" id="h4-0-68" class="i">+	{ MODKEY,			XK_Return, spawn,          {.v = termcmd } },
</a><a href="#h4-0-69" id="h4-0-69" class="i">+	{ MODKEY,			XK_s,	   spawn,	   {.v = surfcmd } },
</a><a href="#h4-0-70" id="h4-0-70" class="i">+	{ MODKEY,                       XK_space,  togglebar,      {0} },
</a><a href="#h4-0-71" id="h4-0-71" class="i">+	{ MODKEY,                       XK_j,      focusstack,     {.i = +1 } },
</a><a href="#h4-0-72" id="h4-0-72" class="i">+	{ MODKEY,                       XK_k,      focusstack,     {.i = -1 } },
</a><a href="#h4-0-73" id="h4-0-73" class="i">+	{ MODKEY,                       XK_c,      incnmaster,     {.i = +1 } }, //increment no. in master
</a><a href="#h4-0-74" id="h4-0-74" class="i">+	{ MODKEY|ShiftMask,		XK_v,      incnmaster,     {.i = -1 } }, //decrement no. in master
</a><a href="#h4-0-75" id="h4-0-75" class="i">+	{ MODKEY,                       XK_h,      setmfact,       {.f = -0.05} },
</a><a href="#h4-0-76" id="h4-0-76" class="i">+	{ MODKEY,                       XK_l,      setmfact,       {.f = +0.05} },
</a><a href="#h4-0-77" id="h4-0-77" class="i">+	{ MODKEY,                       XK_z, zoom,           {0} },
</a><a href="#h4-0-78" id="h4-0-78" class="i">+	{ MODKEY|ShiftMask,		XK_z,	   spawn,	   {.v = lockcmd } },
</a><a href="#h4-0-79" id="h4-0-79" class="i">+	{ MODKEY,                       XK_Tab,    view,           {0} },
</a><a href="#h4-0-80" id="h4-0-80" class="i">+	{ MODKEY,                       XK_q,      killclient,     {0} },
</a><a href="#h4-0-81" id="h4-0-81" class="i">+	{ MODKEY,                       XK_t,      setlayout,      {.v = &amp;layouts[0]} }, //tiling layout
</a><a href="#h4-0-82" id="h4-0-82" class="i">+	{ MODKEY|ShiftMask,		XK_f,      setlayout,      {.v = &amp;layouts[1]} }, //floating layout
</a><a href="#h4-0-83" id="h4-0-83" class="i">+	{ MODKEY,                       XK_f,      setlayout,      {.v = &amp;layouts[2]} }, //monocole layout
</a><a href="#h4-0-84" id="h4-0-84" class="i">+	/* { MODKEY,                       XK_space,  setlayout,      {0} },*/
</a><a href="#h4-0-85" id="h4-0-85" class="i">+	{ MODKEY|ShiftMask,             XK_space,  togglefloating, {0} },
</a><a href="#h4-0-86" id="h4-0-86" class="i">+	{ MODKEY,                       XK_0,      view,           {.ui = ~0 } },
</a><a href="#h4-0-87" id="h4-0-87" class="i">+	{ MODKEY|ShiftMask,             XK_0,      tag,            {.ui = ~0 } },
</a><a href="#h4-0-88" id="h4-0-88" class="i">+	{ MODKEY,                       XK_comma,  focusmon,       {.i = -1 } },
</a><a href="#h4-0-89" id="h4-0-89" class="i">+	{ MODKEY,                       XK_period, focusmon,       {.i = +1 } },
</a><a href="#h4-0-90" id="h4-0-90" class="i">+	{ MODKEY|ShiftMask,             XK_comma,  tagmon,         {.i = -1 } },
</a><a href="#h4-0-91" id="h4-0-91" class="i">+	{ MODKEY|ShiftMask,             XK_period, tagmon,         {.i = +1 } },
</a><a href="#h4-0-92" id="h4-0-92" class="i">+	TAGKEYS(                        XK_1,                      0)
</a><a href="#h4-0-93" id="h4-0-93" class="i">+	TAGKEYS(                        XK_2,                      1)
</a><a href="#h4-0-94" id="h4-0-94" class="i">+	TAGKEYS(                        XK_3,                      2)
</a><a href="#h4-0-95" id="h4-0-95" class="i">+	TAGKEYS(                        XK_4,                      3)
</a><a href="#h4-0-96" id="h4-0-96" class="i">+	TAGKEYS(                        XK_5,                      4)
</a><a href="#h4-0-97" id="h4-0-97" class="i">+	TAGKEYS(                        XK_6,                      5)
</a><a href="#h4-0-98" id="h4-0-98" class="i">+	TAGKEYS(                        XK_7,                      6)
</a><a href="#h4-0-99" id="h4-0-99" class="i">+	TAGKEYS(                        XK_8,                      7)
</a><a href="#h4-0-100" id="h4-0-100" class="i">+	TAGKEYS(                        XK_9,                      8)
</a><a href="#h4-0-101" id="h4-0-101" class="i">+	{MODKEY|ShiftMask,              XK_q,      quit,           {0} },
</a><a href="#h4-0-102" id="h4-0-102" class="i">+};
</a><a href="#h4-0-103" id="h4-0-103" class="i">+
</a><a href="#h4-0-104" id="h4-0-104" class="i">+/* button definitions */
</a><a href="#h4-0-105" id="h4-0-105" class="i">+/* click can be ClkTagBar, ClkLtSymbol, ClkStatusText, ClkWinTitle, ClkClientWin, or ClkRootWin */
</a><a href="#h4-0-106" id="h4-0-106" class="i">+static Button buttons[] = {
</a><a href="#h4-0-107" id="h4-0-107" class="i">+	/* click                event mask      button          function        argument */
</a><a href="#h4-0-108" id="h4-0-108" class="i">+	{ ClkLtSymbol,          0,              Button1,        setlayout,      {0} },
</a><a href="#h4-0-109" id="h4-0-109" class="i">+	{ ClkLtSymbol,          0,              Button3,        setlayout,      {.v = &amp;layouts[2]} },
</a><a href="#h4-0-110" id="h4-0-110" class="i">+	{ ClkWinTitle,          0,              Button2,        zoom,           {0} },
</a><a href="#h4-0-111" id="h4-0-111" class="i">+	{ ClkStatusText,        0,              Button2,        spawn,          {.v = termcmd } },
</a><a href="#h4-0-112" id="h4-0-112" class="i">+	{ ClkClientWin,         MODKEY,         Button1,        movemouse,      {0} },
</a><a href="#h4-0-113" id="h4-0-113" class="i">+	{ ClkClientWin,         MODKEY,         Button2,        togglefloating, {0} },
</a><a href="#h4-0-114" id="h4-0-114" class="i">+	{ ClkClientWin,         MODKEY,         Button3,        resizemouse,    {0} },
</a><a href="#h4-0-115" id="h4-0-115" class="i">+	{ ClkTagBar,            0,              Button1,        view,           {0} },
</a><a href="#h4-0-116" id="h4-0-116" class="i">+	{ ClkTagBar,            0,              Button3,        toggleview,     {0} },
</a><a href="#h4-0-117" id="h4-0-117" class="i">+	{ ClkTagBar,            MODKEY,         Button1,        tag,            {0} },
</a><a href="#h4-0-118" id="h4-0-118" class="i">+	{ ClkTagBar,            MODKEY,         Button3,        toggletag,      {0} },
</a><a href="#h4-0-119" id="h4-0-119" class="i">+};
</a><a href="#h4-0-120" id="h4-0-120" class="i">+
</a><b>diff --git a/<a id="h5" href="../file/dwm/config.mk.html">dwm/config.mk</a> b/<a href="../file/dwm/config.mk.html">dwm/config.mk</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,38 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+# dwm version
</a><a href="#h5-0-1" id="h5-0-1" class="i">+VERSION = 6.2
</a><a href="#h5-0-2" id="h5-0-2" class="i">+
</a><a href="#h5-0-3" id="h5-0-3" class="i">+# Customize below to fit your system
</a><a href="#h5-0-4" id="h5-0-4" class="i">+
</a><a href="#h5-0-5" id="h5-0-5" class="i">+# paths
</a><a href="#h5-0-6" id="h5-0-6" class="i">+PREFIX = /usr/local
</a><a href="#h5-0-7" id="h5-0-7" class="i">+MANPREFIX = ${PREFIX}/share/man
</a><a href="#h5-0-8" id="h5-0-8" class="i">+
</a><a href="#h5-0-9" id="h5-0-9" class="i">+X11INC = /usr/X11R6/include
</a><a href="#h5-0-10" id="h5-0-10" class="i">+X11LIB = /usr/X11R6/lib
</a><a href="#h5-0-11" id="h5-0-11" class="i">+
</a><a href="#h5-0-12" id="h5-0-12" class="i">+# Xinerama, comment if you don&#39;t want it
</a><a href="#h5-0-13" id="h5-0-13" class="i">+XINERAMALIBS  = -lXinerama
</a><a href="#h5-0-14" id="h5-0-14" class="i">+XINERAMAFLAGS = -DXINERAMA
</a><a href="#h5-0-15" id="h5-0-15" class="i">+
</a><a href="#h5-0-16" id="h5-0-16" class="i">+# freetype
</a><a href="#h5-0-17" id="h5-0-17" class="i">+FREETYPELIBS = -lfontconfig -lXft
</a><a href="#h5-0-18" id="h5-0-18" class="i">+FREETYPEINC = /usr/include/freetype2
</a><a href="#h5-0-19" id="h5-0-19" class="i">+# OpenBSD (uncomment)
</a><a href="#h5-0-20" id="h5-0-20" class="i">+#FREETYPEINC = ${X11INC}/freetype2
</a><a href="#h5-0-21" id="h5-0-21" class="i">+
</a><a href="#h5-0-22" id="h5-0-22" class="i">+# includes and libs
</a><a href="#h5-0-23" id="h5-0-23" class="i">+INCS = -I${X11INC} -I${FREETYPEINC}
</a><a href="#h5-0-24" id="h5-0-24" class="i">+LIBS = -L${X11LIB} -lX11 ${XINERAMALIBS} ${FREETYPELIBS}
</a><a href="#h5-0-25" id="h5-0-25" class="i">+
</a><a href="#h5-0-26" id="h5-0-26" class="i">+# flags
</a><a href="#h5-0-27" id="h5-0-27" class="i">+CPPFLAGS = -D_DEFAULT_SOURCE -D_BSD_SOURCE -D_POSIX_C_SOURCE=2 -DVERSION=\&quot;${VERSION}\&quot; ${XINERAMAFLAGS}
</a><a href="#h5-0-28" id="h5-0-28" class="i">+#CFLAGS   = -g -std=c99 -pedantic -Wall -O0 ${INCS} ${CPPFLAGS}
</a><a href="#h5-0-29" id="h5-0-29" class="i">+CFLAGS   = -std=c99 -pedantic -Wall -Wno-deprecated-declarations -Os ${INCS} ${CPPFLAGS}
</a><a href="#h5-0-30" id="h5-0-30" class="i">+LDFLAGS  = ${LIBS}
</a><a href="#h5-0-31" id="h5-0-31" class="i">+
</a><a href="#h5-0-32" id="h5-0-32" class="i">+# Solaris
</a><a href="#h5-0-33" id="h5-0-33" class="i">+#CFLAGS = -fast ${INCS} -DVERSION=\&quot;${VERSION}\&quot;
</a><a href="#h5-0-34" id="h5-0-34" class="i">+#LDFLAGS = ${LIBS}
</a><a href="#h5-0-35" id="h5-0-35" class="i">+
</a><a href="#h5-0-36" id="h5-0-36" class="i">+# compiler and linker
</a><a href="#h5-0-37" id="h5-0-37" class="i">+CC = cc
</a><b>diff --git a/<a id="h6" href="../file/dwm/drw.c.html">dwm/drw.c</a> b/<a href="../file/dwm/drw.c.html">dwm/drw.c</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,435 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h6-0-1" id="h6-0-1" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h6-0-2" id="h6-0-2" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h6-0-3" id="h6-0-3" class="i">+#include &lt;string.h&gt;
</a><a href="#h6-0-4" id="h6-0-4" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h6-0-5" id="h6-0-5" class="i">+#include &lt;X11/Xft/Xft.h&gt;
</a><a href="#h6-0-6" id="h6-0-6" class="i">+
</a><a href="#h6-0-7" id="h6-0-7" class="i">+#include &quot;drw.h&quot;
</a><a href="#h6-0-8" id="h6-0-8" class="i">+#include &quot;util.h&quot;
</a><a href="#h6-0-9" id="h6-0-9" class="i">+
</a><a href="#h6-0-10" id="h6-0-10" class="i">+#define UTF_INVALID 0xFFFD
</a><a href="#h6-0-11" id="h6-0-11" class="i">+#define UTF_SIZ     4
</a><a href="#h6-0-12" id="h6-0-12" class="i">+
</a><a href="#h6-0-13" id="h6-0-13" class="i">+static const unsigned char utfbyte[UTF_SIZ + 1] = {0x80,    0, 0xC0, 0xE0, 0xF0};
</a><a href="#h6-0-14" id="h6-0-14" class="i">+static const unsigned char utfmask[UTF_SIZ + 1] = {0xC0, 0x80, 0xE0, 0xF0, 0xF8};
</a><a href="#h6-0-15" id="h6-0-15" class="i">+static const long utfmin[UTF_SIZ + 1] = {       0,    0,  0x80,  0x800,  0x10000};
</a><a href="#h6-0-16" id="h6-0-16" class="i">+static const long utfmax[UTF_SIZ + 1] = {0x10FFFF, 0x7F, 0x7FF, 0xFFFF, 0x10FFFF};
</a><a href="#h6-0-17" id="h6-0-17" class="i">+
</a><a href="#h6-0-18" id="h6-0-18" class="i">+static long
</a><a href="#h6-0-19" id="h6-0-19" class="i">+utf8decodebyte(const char c, size_t *i)
</a><a href="#h6-0-20" id="h6-0-20" class="i">+{
</a><a href="#h6-0-21" id="h6-0-21" class="i">+	for (*i = 0; *i &lt; (UTF_SIZ + 1); ++(*i))
</a><a href="#h6-0-22" id="h6-0-22" class="i">+		if (((unsigned char)c &amp; utfmask[*i]) == utfbyte[*i])
</a><a href="#h6-0-23" id="h6-0-23" class="i">+			return (unsigned char)c &amp; ~utfmask[*i];
</a><a href="#h6-0-24" id="h6-0-24" class="i">+	return 0;
</a><a href="#h6-0-25" id="h6-0-25" class="i">+}
</a><a href="#h6-0-26" id="h6-0-26" class="i">+
</a><a href="#h6-0-27" id="h6-0-27" class="i">+static size_t
</a><a href="#h6-0-28" id="h6-0-28" class="i">+utf8validate(long *u, size_t i)
</a><a href="#h6-0-29" id="h6-0-29" class="i">+{
</a><a href="#h6-0-30" id="h6-0-30" class="i">+	if (!BETWEEN(*u, utfmin[i], utfmax[i]) || BETWEEN(*u, 0xD800, 0xDFFF))
</a><a href="#h6-0-31" id="h6-0-31" class="i">+		*u = UTF_INVALID;
</a><a href="#h6-0-32" id="h6-0-32" class="i">+	for (i = 1; *u &gt; utfmax[i]; ++i)
</a><a href="#h6-0-33" id="h6-0-33" class="i">+		;
</a><a href="#h6-0-34" id="h6-0-34" class="i">+	return i;
</a><a href="#h6-0-35" id="h6-0-35" class="i">+}
</a><a href="#h6-0-36" id="h6-0-36" class="i">+
</a><a href="#h6-0-37" id="h6-0-37" class="i">+static size_t
</a><a href="#h6-0-38" id="h6-0-38" class="i">+utf8decode(const char *c, long *u, size_t clen)
</a><a href="#h6-0-39" id="h6-0-39" class="i">+{
</a><a href="#h6-0-40" id="h6-0-40" class="i">+	size_t i, j, len, type;
</a><a href="#h6-0-41" id="h6-0-41" class="i">+	long udecoded;
</a><a href="#h6-0-42" id="h6-0-42" class="i">+
</a><a href="#h6-0-43" id="h6-0-43" class="i">+	*u = UTF_INVALID;
</a><a href="#h6-0-44" id="h6-0-44" class="i">+	if (!clen)
</a><a href="#h6-0-45" id="h6-0-45" class="i">+		return 0;
</a><a href="#h6-0-46" id="h6-0-46" class="i">+	udecoded = utf8decodebyte(c[0], &amp;len);
</a><a href="#h6-0-47" id="h6-0-47" class="i">+	if (!BETWEEN(len, 1, UTF_SIZ))
</a><a href="#h6-0-48" id="h6-0-48" class="i">+		return 1;
</a><a href="#h6-0-49" id="h6-0-49" class="i">+	for (i = 1, j = 1; i &lt; clen &amp;&amp; j &lt; len; ++i, ++j) {
</a><a href="#h6-0-50" id="h6-0-50" class="i">+		udecoded = (udecoded &lt;&lt; 6) | utf8decodebyte(c[i], &amp;type);
</a><a href="#h6-0-51" id="h6-0-51" class="i">+		if (type)
</a><a href="#h6-0-52" id="h6-0-52" class="i">+			return j;
</a><a href="#h6-0-53" id="h6-0-53" class="i">+	}
</a><a href="#h6-0-54" id="h6-0-54" class="i">+	if (j &lt; len)
</a><a href="#h6-0-55" id="h6-0-55" class="i">+		return 0;
</a><a href="#h6-0-56" id="h6-0-56" class="i">+	*u = udecoded;
</a><a href="#h6-0-57" id="h6-0-57" class="i">+	utf8validate(u, len);
</a><a href="#h6-0-58" id="h6-0-58" class="i">+
</a><a href="#h6-0-59" id="h6-0-59" class="i">+	return len;
</a><a href="#h6-0-60" id="h6-0-60" class="i">+}
</a><a href="#h6-0-61" id="h6-0-61" class="i">+
</a><a href="#h6-0-62" id="h6-0-62" class="i">+Drw *
</a><a href="#h6-0-63" id="h6-0-63" class="i">+drw_create(Display *dpy, int screen, Window root, unsigned int w, unsigned int h)
</a><a href="#h6-0-64" id="h6-0-64" class="i">+{
</a><a href="#h6-0-65" id="h6-0-65" class="i">+	Drw *drw = ecalloc(1, sizeof(Drw));
</a><a href="#h6-0-66" id="h6-0-66" class="i">+
</a><a href="#h6-0-67" id="h6-0-67" class="i">+	drw-&gt;dpy = dpy;
</a><a href="#h6-0-68" id="h6-0-68" class="i">+	drw-&gt;screen = screen;
</a><a href="#h6-0-69" id="h6-0-69" class="i">+	drw-&gt;root = root;
</a><a href="#h6-0-70" id="h6-0-70" class="i">+	drw-&gt;w = w;
</a><a href="#h6-0-71" id="h6-0-71" class="i">+	drw-&gt;h = h;
</a><a href="#h6-0-72" id="h6-0-72" class="i">+	drw-&gt;drawable = XCreatePixmap(dpy, root, w, h, DefaultDepth(dpy, screen));
</a><a href="#h6-0-73" id="h6-0-73" class="i">+	drw-&gt;gc = XCreateGC(dpy, root, 0, NULL);
</a><a href="#h6-0-74" id="h6-0-74" class="i">+	XSetLineAttributes(dpy, drw-&gt;gc, 1, LineSolid, CapButt, JoinMiter);
</a><a href="#h6-0-75" id="h6-0-75" class="i">+
</a><a href="#h6-0-76" id="h6-0-76" class="i">+	return drw;
</a><a href="#h6-0-77" id="h6-0-77" class="i">+}
</a><a href="#h6-0-78" id="h6-0-78" class="i">+
</a><a href="#h6-0-79" id="h6-0-79" class="i">+void
</a><a href="#h6-0-80" id="h6-0-80" class="i">+drw_resize(Drw *drw, unsigned int w, unsigned int h)
</a><a href="#h6-0-81" id="h6-0-81" class="i">+{
</a><a href="#h6-0-82" id="h6-0-82" class="i">+	if (!drw)
</a><a href="#h6-0-83" id="h6-0-83" class="i">+		return;
</a><a href="#h6-0-84" id="h6-0-84" class="i">+
</a><a href="#h6-0-85" id="h6-0-85" class="i">+	drw-&gt;w = w;
</a><a href="#h6-0-86" id="h6-0-86" class="i">+	drw-&gt;h = h;
</a><a href="#h6-0-87" id="h6-0-87" class="i">+	if (drw-&gt;drawable)
</a><a href="#h6-0-88" id="h6-0-88" class="i">+		XFreePixmap(drw-&gt;dpy, drw-&gt;drawable);
</a><a href="#h6-0-89" id="h6-0-89" class="i">+	drw-&gt;drawable = XCreatePixmap(drw-&gt;dpy, drw-&gt;root, w, h, DefaultDepth(drw-&gt;dpy, drw-&gt;screen));
</a><a href="#h6-0-90" id="h6-0-90" class="i">+}
</a><a href="#h6-0-91" id="h6-0-91" class="i">+
</a><a href="#h6-0-92" id="h6-0-92" class="i">+void
</a><a href="#h6-0-93" id="h6-0-93" class="i">+drw_free(Drw *drw)
</a><a href="#h6-0-94" id="h6-0-94" class="i">+{
</a><a href="#h6-0-95" id="h6-0-95" class="i">+	XFreePixmap(drw-&gt;dpy, drw-&gt;drawable);
</a><a href="#h6-0-96" id="h6-0-96" class="i">+	XFreeGC(drw-&gt;dpy, drw-&gt;gc);
</a><a href="#h6-0-97" id="h6-0-97" class="i">+	free(drw);
</a><a href="#h6-0-98" id="h6-0-98" class="i">+}
</a><a href="#h6-0-99" id="h6-0-99" class="i">+
</a><a href="#h6-0-100" id="h6-0-100" class="i">+/* This function is an implementation detail. Library users should use
</a><a href="#h6-0-101" id="h6-0-101" class="i">+ * drw_fontset_create instead.
</a><a href="#h6-0-102" id="h6-0-102" class="i">+ */
</a><a href="#h6-0-103" id="h6-0-103" class="i">+static Fnt *
</a><a href="#h6-0-104" id="h6-0-104" class="i">+xfont_create(Drw *drw, const char *fontname, FcPattern *fontpattern)
</a><a href="#h6-0-105" id="h6-0-105" class="i">+{
</a><a href="#h6-0-106" id="h6-0-106" class="i">+	Fnt *font;
</a><a href="#h6-0-107" id="h6-0-107" class="i">+	XftFont *xfont = NULL;
</a><a href="#h6-0-108" id="h6-0-108" class="i">+	FcPattern *pattern = NULL;
</a><a href="#h6-0-109" id="h6-0-109" class="i">+
</a><a href="#h6-0-110" id="h6-0-110" class="i">+	if (fontname) {
</a><a href="#h6-0-111" id="h6-0-111" class="i">+		/* Using the pattern found at font-&gt;xfont-&gt;pattern does not yield the
</a><a href="#h6-0-112" id="h6-0-112" class="i">+		 * same substitution results as using the pattern returned by
</a><a href="#h6-0-113" id="h6-0-113" class="i">+		 * FcNameParse; using the latter results in the desired fallback
</a><a href="#h6-0-114" id="h6-0-114" class="i">+		 * behaviour whereas the former just results in missing-character
</a><a href="#h6-0-115" id="h6-0-115" class="i">+		 * rectangles being drawn, at least with some fonts. */
</a><a href="#h6-0-116" id="h6-0-116" class="i">+		if (!(xfont = XftFontOpenName(drw-&gt;dpy, drw-&gt;screen, fontname))) {
</a><a href="#h6-0-117" id="h6-0-117" class="i">+			fprintf(stderr, &quot;error, cannot load font from name: &#39;%s&#39;\n&quot;, fontname);
</a><a href="#h6-0-118" id="h6-0-118" class="i">+			return NULL;
</a><a href="#h6-0-119" id="h6-0-119" class="i">+		}
</a><a href="#h6-0-120" id="h6-0-120" class="i">+		if (!(pattern = FcNameParse((FcChar8 *) fontname))) {
</a><a href="#h6-0-121" id="h6-0-121" class="i">+			fprintf(stderr, &quot;error, cannot parse font name to pattern: &#39;%s&#39;\n&quot;, fontname);
</a><a href="#h6-0-122" id="h6-0-122" class="i">+			XftFontClose(drw-&gt;dpy, xfont);
</a><a href="#h6-0-123" id="h6-0-123" class="i">+			return NULL;
</a><a href="#h6-0-124" id="h6-0-124" class="i">+		}
</a><a href="#h6-0-125" id="h6-0-125" class="i">+	} else if (fontpattern) {
</a><a href="#h6-0-126" id="h6-0-126" class="i">+		if (!(xfont = XftFontOpenPattern(drw-&gt;dpy, fontpattern))) {
</a><a href="#h6-0-127" id="h6-0-127" class="i">+			fprintf(stderr, &quot;error, cannot load font from pattern.\n&quot;);
</a><a href="#h6-0-128" id="h6-0-128" class="i">+			return NULL;
</a><a href="#h6-0-129" id="h6-0-129" class="i">+		}
</a><a href="#h6-0-130" id="h6-0-130" class="i">+	} else {
</a><a href="#h6-0-131" id="h6-0-131" class="i">+		die(&quot;no font specified.&quot;);
</a><a href="#h6-0-132" id="h6-0-132" class="i">+	}
</a><a href="#h6-0-133" id="h6-0-133" class="i">+
</a><a href="#h6-0-134" id="h6-0-134" class="i">+	/* Do not allow using color fonts. This is a workaround for a BadLength
</a><a href="#h6-0-135" id="h6-0-135" class="i">+	 * error from Xft with color glyphs. Modelled on the Xterm workaround. See
</a><a href="#h6-0-136" id="h6-0-136" class="i">+	 * https://bugzilla.redhat.com/show_bug.cgi?id=1498269
</a><a href="#h6-0-137" id="h6-0-137" class="i">+	 * https://lists.suckless.org/dev/1701/30932.html
</a><a href="#h6-0-138" id="h6-0-138" class="i">+	 * https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=916349
</a><a href="#h6-0-139" id="h6-0-139" class="i">+	 * and lots more all over the internet.
</a><a href="#h6-0-140" id="h6-0-140" class="i">+	 */
</a><a href="#h6-0-141" id="h6-0-141" class="i">+	FcBool iscol;
</a><a href="#h6-0-142" id="h6-0-142" class="i">+	if(FcPatternGetBool(xfont-&gt;pattern, FC_COLOR, 0, &amp;iscol) == FcResultMatch &amp;&amp; iscol) {
</a><a href="#h6-0-143" id="h6-0-143" class="i">+		XftFontClose(drw-&gt;dpy, xfont);
</a><a href="#h6-0-144" id="h6-0-144" class="i">+		return NULL;
</a><a href="#h6-0-145" id="h6-0-145" class="i">+	}
</a><a href="#h6-0-146" id="h6-0-146" class="i">+
</a><a href="#h6-0-147" id="h6-0-147" class="i">+	font = ecalloc(1, sizeof(Fnt));
</a><a href="#h6-0-148" id="h6-0-148" class="i">+	font-&gt;xfont = xfont;
</a><a href="#h6-0-149" id="h6-0-149" class="i">+	font-&gt;pattern = pattern;
</a><a href="#h6-0-150" id="h6-0-150" class="i">+	font-&gt;h = xfont-&gt;ascent + xfont-&gt;descent;
</a><a href="#h6-0-151" id="h6-0-151" class="i">+	font-&gt;dpy = drw-&gt;dpy;
</a><a href="#h6-0-152" id="h6-0-152" class="i">+
</a><a href="#h6-0-153" id="h6-0-153" class="i">+	return font;
</a><a href="#h6-0-154" id="h6-0-154" class="i">+}
</a><a href="#h6-0-155" id="h6-0-155" class="i">+
</a><a href="#h6-0-156" id="h6-0-156" class="i">+static void
</a><a href="#h6-0-157" id="h6-0-157" class="i">+xfont_free(Fnt *font)
</a><a href="#h6-0-158" id="h6-0-158" class="i">+{
</a><a href="#h6-0-159" id="h6-0-159" class="i">+	if (!font)
</a><a href="#h6-0-160" id="h6-0-160" class="i">+		return;
</a><a href="#h6-0-161" id="h6-0-161" class="i">+	if (font-&gt;pattern)
</a><a href="#h6-0-162" id="h6-0-162" class="i">+		FcPatternDestroy(font-&gt;pattern);
</a><a href="#h6-0-163" id="h6-0-163" class="i">+	XftFontClose(font-&gt;dpy, font-&gt;xfont);
</a><a href="#h6-0-164" id="h6-0-164" class="i">+	free(font);
</a><a href="#h6-0-165" id="h6-0-165" class="i">+}
</a><a href="#h6-0-166" id="h6-0-166" class="i">+
</a><a href="#h6-0-167" id="h6-0-167" class="i">+Fnt*
</a><a href="#h6-0-168" id="h6-0-168" class="i">+drw_fontset_create(Drw* drw, const char *fonts[], size_t fontcount)
</a><a href="#h6-0-169" id="h6-0-169" class="i">+{
</a><a href="#h6-0-170" id="h6-0-170" class="i">+	Fnt *cur, *ret = NULL;
</a><a href="#h6-0-171" id="h6-0-171" class="i">+	size_t i;
</a><a href="#h6-0-172" id="h6-0-172" class="i">+
</a><a href="#h6-0-173" id="h6-0-173" class="i">+	if (!drw || !fonts)
</a><a href="#h6-0-174" id="h6-0-174" class="i">+		return NULL;
</a><a href="#h6-0-175" id="h6-0-175" class="i">+
</a><a href="#h6-0-176" id="h6-0-176" class="i">+	for (i = 1; i &lt;= fontcount; i++) {
</a><a href="#h6-0-177" id="h6-0-177" class="i">+		if ((cur = xfont_create(drw, fonts[fontcount - i], NULL))) {
</a><a href="#h6-0-178" id="h6-0-178" class="i">+			cur-&gt;next = ret;
</a><a href="#h6-0-179" id="h6-0-179" class="i">+			ret = cur;
</a><a href="#h6-0-180" id="h6-0-180" class="i">+		}
</a><a href="#h6-0-181" id="h6-0-181" class="i">+	}
</a><a href="#h6-0-182" id="h6-0-182" class="i">+	return (drw-&gt;fonts = ret);
</a><a href="#h6-0-183" id="h6-0-183" class="i">+}
</a><a href="#h6-0-184" id="h6-0-184" class="i">+
</a><a href="#h6-0-185" id="h6-0-185" class="i">+void
</a><a href="#h6-0-186" id="h6-0-186" class="i">+drw_fontset_free(Fnt *font)
</a><a href="#h6-0-187" id="h6-0-187" class="i">+{
</a><a href="#h6-0-188" id="h6-0-188" class="i">+	if (font) {
</a><a href="#h6-0-189" id="h6-0-189" class="i">+		drw_fontset_free(font-&gt;next);
</a><a href="#h6-0-190" id="h6-0-190" class="i">+		xfont_free(font);
</a><a href="#h6-0-191" id="h6-0-191" class="i">+	}
</a><a href="#h6-0-192" id="h6-0-192" class="i">+}
</a><a href="#h6-0-193" id="h6-0-193" class="i">+
</a><a href="#h6-0-194" id="h6-0-194" class="i">+void
</a><a href="#h6-0-195" id="h6-0-195" class="i">+drw_clr_create(Drw *drw, Clr *dest, const char *clrname)
</a><a href="#h6-0-196" id="h6-0-196" class="i">+{
</a><a href="#h6-0-197" id="h6-0-197" class="i">+	if (!drw || !dest || !clrname)
</a><a href="#h6-0-198" id="h6-0-198" class="i">+		return;
</a><a href="#h6-0-199" id="h6-0-199" class="i">+
</a><a href="#h6-0-200" id="h6-0-200" class="i">+	if (!XftColorAllocName(drw-&gt;dpy, DefaultVisual(drw-&gt;dpy, drw-&gt;screen),
</a><a href="#h6-0-201" id="h6-0-201" class="i">+	                       DefaultColormap(drw-&gt;dpy, drw-&gt;screen),
</a><a href="#h6-0-202" id="h6-0-202" class="i">+	                       clrname, dest))
</a><a href="#h6-0-203" id="h6-0-203" class="i">+		die(&quot;error, cannot allocate color &#39;%s&#39;&quot;, clrname);
</a><a href="#h6-0-204" id="h6-0-204" class="i">+}
</a><a href="#h6-0-205" id="h6-0-205" class="i">+
</a><a href="#h6-0-206" id="h6-0-206" class="i">+/* Wrapper to create color schemes. The caller has to call free(3) on the
</a><a href="#h6-0-207" id="h6-0-207" class="i">+ * returned color scheme when done using it. */
</a><a href="#h6-0-208" id="h6-0-208" class="i">+Clr *
</a><a href="#h6-0-209" id="h6-0-209" class="i">+drw_scm_create(Drw *drw, const char *clrnames[], size_t clrcount)
</a><a href="#h6-0-210" id="h6-0-210" class="i">+{
</a><a href="#h6-0-211" id="h6-0-211" class="i">+	size_t i;
</a><a href="#h6-0-212" id="h6-0-212" class="i">+	Clr *ret;
</a><a href="#h6-0-213" id="h6-0-213" class="i">+
</a><a href="#h6-0-214" id="h6-0-214" class="i">+	/* need at least two colors for a scheme */
</a><a href="#h6-0-215" id="h6-0-215" class="i">+	if (!drw || !clrnames || clrcount &lt; 2 || !(ret = ecalloc(clrcount, sizeof(XftColor))))
</a><a href="#h6-0-216" id="h6-0-216" class="i">+		return NULL;
</a><a href="#h6-0-217" id="h6-0-217" class="i">+
</a><a href="#h6-0-218" id="h6-0-218" class="i">+	for (i = 0; i &lt; clrcount; i++)
</a><a href="#h6-0-219" id="h6-0-219" class="i">+		drw_clr_create(drw, &amp;ret[i], clrnames[i]);
</a><a href="#h6-0-220" id="h6-0-220" class="i">+	return ret;
</a><a href="#h6-0-221" id="h6-0-221" class="i">+}
</a><a href="#h6-0-222" id="h6-0-222" class="i">+
</a><a href="#h6-0-223" id="h6-0-223" class="i">+void
</a><a href="#h6-0-224" id="h6-0-224" class="i">+drw_setfontset(Drw *drw, Fnt *set)
</a><a href="#h6-0-225" id="h6-0-225" class="i">+{
</a><a href="#h6-0-226" id="h6-0-226" class="i">+	if (drw)
</a><a href="#h6-0-227" id="h6-0-227" class="i">+		drw-&gt;fonts = set;
</a><a href="#h6-0-228" id="h6-0-228" class="i">+}
</a><a href="#h6-0-229" id="h6-0-229" class="i">+
</a><a href="#h6-0-230" id="h6-0-230" class="i">+void
</a><a href="#h6-0-231" id="h6-0-231" class="i">+drw_setscheme(Drw *drw, Clr *scm)
</a><a href="#h6-0-232" id="h6-0-232" class="i">+{
</a><a href="#h6-0-233" id="h6-0-233" class="i">+	if (drw)
</a><a href="#h6-0-234" id="h6-0-234" class="i">+		drw-&gt;scheme = scm;
</a><a href="#h6-0-235" id="h6-0-235" class="i">+}
</a><a href="#h6-0-236" id="h6-0-236" class="i">+
</a><a href="#h6-0-237" id="h6-0-237" class="i">+void
</a><a href="#h6-0-238" id="h6-0-238" class="i">+drw_rect(Drw *drw, int x, int y, unsigned int w, unsigned int h, int filled, int invert)
</a><a href="#h6-0-239" id="h6-0-239" class="i">+{
</a><a href="#h6-0-240" id="h6-0-240" class="i">+	if (!drw || !drw-&gt;scheme)
</a><a href="#h6-0-241" id="h6-0-241" class="i">+		return;
</a><a href="#h6-0-242" id="h6-0-242" class="i">+	XSetForeground(drw-&gt;dpy, drw-&gt;gc, invert ? drw-&gt;scheme[ColBg].pixel : drw-&gt;scheme[ColFg].pixel);
</a><a href="#h6-0-243" id="h6-0-243" class="i">+	if (filled)
</a><a href="#h6-0-244" id="h6-0-244" class="i">+		XFillRectangle(drw-&gt;dpy, drw-&gt;drawable, drw-&gt;gc, x, y, w, h);
</a><a href="#h6-0-245" id="h6-0-245" class="i">+	else
</a><a href="#h6-0-246" id="h6-0-246" class="i">+		XDrawRectangle(drw-&gt;dpy, drw-&gt;drawable, drw-&gt;gc, x, y, w - 1, h - 1);
</a><a href="#h6-0-247" id="h6-0-247" class="i">+}
</a><a href="#h6-0-248" id="h6-0-248" class="i">+
</a><a href="#h6-0-249" id="h6-0-249" class="i">+int
</a><a href="#h6-0-250" id="h6-0-250" class="i">+drw_text(Drw *drw, int x, int y, unsigned int w, unsigned int h, unsigned int lpad, const char *text, int invert)
</a><a href="#h6-0-251" id="h6-0-251" class="i">+{
</a><a href="#h6-0-252" id="h6-0-252" class="i">+	char buf[1024];
</a><a href="#h6-0-253" id="h6-0-253" class="i">+	int ty;
</a><a href="#h6-0-254" id="h6-0-254" class="i">+	unsigned int ew;
</a><a href="#h6-0-255" id="h6-0-255" class="i">+	XftDraw *d = NULL;
</a><a href="#h6-0-256" id="h6-0-256" class="i">+	Fnt *usedfont, *curfont, *nextfont;
</a><a href="#h6-0-257" id="h6-0-257" class="i">+	size_t i, len;
</a><a href="#h6-0-258" id="h6-0-258" class="i">+	int utf8strlen, utf8charlen, render = x || y || w || h;
</a><a href="#h6-0-259" id="h6-0-259" class="i">+	long utf8codepoint = 0;
</a><a href="#h6-0-260" id="h6-0-260" class="i">+	const char *utf8str;
</a><a href="#h6-0-261" id="h6-0-261" class="i">+	FcCharSet *fccharset;
</a><a href="#h6-0-262" id="h6-0-262" class="i">+	FcPattern *fcpattern;
</a><a href="#h6-0-263" id="h6-0-263" class="i">+	FcPattern *match;
</a><a href="#h6-0-264" id="h6-0-264" class="i">+	XftResult result;
</a><a href="#h6-0-265" id="h6-0-265" class="i">+	int charexists = 0;
</a><a href="#h6-0-266" id="h6-0-266" class="i">+
</a><a href="#h6-0-267" id="h6-0-267" class="i">+	if (!drw || (render &amp;&amp; !drw-&gt;scheme) || !text || !drw-&gt;fonts)
</a><a href="#h6-0-268" id="h6-0-268" class="i">+		return 0;
</a><a href="#h6-0-269" id="h6-0-269" class="i">+
</a><a href="#h6-0-270" id="h6-0-270" class="i">+	if (!render) {
</a><a href="#h6-0-271" id="h6-0-271" class="i">+		w = ~w;
</a><a href="#h6-0-272" id="h6-0-272" class="i">+	} else {
</a><a href="#h6-0-273" id="h6-0-273" class="i">+		XSetForeground(drw-&gt;dpy, drw-&gt;gc, drw-&gt;scheme[invert ? ColFg : ColBg].pixel);
</a><a href="#h6-0-274" id="h6-0-274" class="i">+		XFillRectangle(drw-&gt;dpy, drw-&gt;drawable, drw-&gt;gc, x, y, w, h);
</a><a href="#h6-0-275" id="h6-0-275" class="i">+		d = XftDrawCreate(drw-&gt;dpy, drw-&gt;drawable,
</a><a href="#h6-0-276" id="h6-0-276" class="i">+		                  DefaultVisual(drw-&gt;dpy, drw-&gt;screen),
</a><a href="#h6-0-277" id="h6-0-277" class="i">+		                  DefaultColormap(drw-&gt;dpy, drw-&gt;screen));
</a><a href="#h6-0-278" id="h6-0-278" class="i">+		x += lpad;
</a><a href="#h6-0-279" id="h6-0-279" class="i">+		w -= lpad;
</a><a href="#h6-0-280" id="h6-0-280" class="i">+	}
</a><a href="#h6-0-281" id="h6-0-281" class="i">+
</a><a href="#h6-0-282" id="h6-0-282" class="i">+	usedfont = drw-&gt;fonts;
</a><a href="#h6-0-283" id="h6-0-283" class="i">+	while (1) {
</a><a href="#h6-0-284" id="h6-0-284" class="i">+		utf8strlen = 0;
</a><a href="#h6-0-285" id="h6-0-285" class="i">+		utf8str = text;
</a><a href="#h6-0-286" id="h6-0-286" class="i">+		nextfont = NULL;
</a><a href="#h6-0-287" id="h6-0-287" class="i">+		while (*text) {
</a><a href="#h6-0-288" id="h6-0-288" class="i">+			utf8charlen = utf8decode(text, &amp;utf8codepoint, UTF_SIZ);
</a><a href="#h6-0-289" id="h6-0-289" class="i">+			for (curfont = drw-&gt;fonts; curfont; curfont = curfont-&gt;next) {
</a><a href="#h6-0-290" id="h6-0-290" class="i">+				charexists = charexists || XftCharExists(drw-&gt;dpy, curfont-&gt;xfont, utf8codepoint);
</a><a href="#h6-0-291" id="h6-0-291" class="i">+				if (charexists) {
</a><a href="#h6-0-292" id="h6-0-292" class="i">+					if (curfont == usedfont) {
</a><a href="#h6-0-293" id="h6-0-293" class="i">+						utf8strlen += utf8charlen;
</a><a href="#h6-0-294" id="h6-0-294" class="i">+						text += utf8charlen;
</a><a href="#h6-0-295" id="h6-0-295" class="i">+					} else {
</a><a href="#h6-0-296" id="h6-0-296" class="i">+						nextfont = curfont;
</a><a href="#h6-0-297" id="h6-0-297" class="i">+					}
</a><a href="#h6-0-298" id="h6-0-298" class="i">+					break;
</a><a href="#h6-0-299" id="h6-0-299" class="i">+				}
</a><a href="#h6-0-300" id="h6-0-300" class="i">+			}
</a><a href="#h6-0-301" id="h6-0-301" class="i">+
</a><a href="#h6-0-302" id="h6-0-302" class="i">+			if (!charexists || nextfont)
</a><a href="#h6-0-303" id="h6-0-303" class="i">+				break;
</a><a href="#h6-0-304" id="h6-0-304" class="i">+			else
</a><a href="#h6-0-305" id="h6-0-305" class="i">+				charexists = 0;
</a><a href="#h6-0-306" id="h6-0-306" class="i">+		}
</a><a href="#h6-0-307" id="h6-0-307" class="i">+
</a><a href="#h6-0-308" id="h6-0-308" class="i">+		if (utf8strlen) {
</a><a href="#h6-0-309" id="h6-0-309" class="i">+			drw_font_getexts(usedfont, utf8str, utf8strlen, &amp;ew, NULL);
</a><a href="#h6-0-310" id="h6-0-310" class="i">+			/* shorten text if necessary */
</a><a href="#h6-0-311" id="h6-0-311" class="i">+			for (len = MIN(utf8strlen, sizeof(buf) - 1); len &amp;&amp; ew &gt; w; len--)
</a><a href="#h6-0-312" id="h6-0-312" class="i">+				drw_font_getexts(usedfont, utf8str, len, &amp;ew, NULL);
</a><a href="#h6-0-313" id="h6-0-313" class="i">+
</a><a href="#h6-0-314" id="h6-0-314" class="i">+			if (len) {
</a><a href="#h6-0-315" id="h6-0-315" class="i">+				memcpy(buf, utf8str, len);
</a><a href="#h6-0-316" id="h6-0-316" class="i">+				buf[len] = &#39;\0&#39;;
</a><a href="#h6-0-317" id="h6-0-317" class="i">+				if (len &lt; utf8strlen)
</a><a href="#h6-0-318" id="h6-0-318" class="i">+					for (i = len; i &amp;&amp; i &gt; len - 3; buf[--i] = &#39;.&#39;)
</a><a href="#h6-0-319" id="h6-0-319" class="i">+						; /* NOP */
</a><a href="#h6-0-320" id="h6-0-320" class="i">+
</a><a href="#h6-0-321" id="h6-0-321" class="i">+				if (render) {
</a><a href="#h6-0-322" id="h6-0-322" class="i">+					ty = y + (h - usedfont-&gt;h) / 2 + usedfont-&gt;xfont-&gt;ascent;
</a><a href="#h6-0-323" id="h6-0-323" class="i">+					XftDrawStringUtf8(d, &amp;drw-&gt;scheme[invert ? ColBg : ColFg],
</a><a href="#h6-0-324" id="h6-0-324" class="i">+					                  usedfont-&gt;xfont, x, ty, (XftChar8 *)buf, len);
</a><a href="#h6-0-325" id="h6-0-325" class="i">+				}
</a><a href="#h6-0-326" id="h6-0-326" class="i">+				x += ew;
</a><a href="#h6-0-327" id="h6-0-327" class="i">+				w -= ew;
</a><a href="#h6-0-328" id="h6-0-328" class="i">+			}
</a><a href="#h6-0-329" id="h6-0-329" class="i">+		}
</a><a href="#h6-0-330" id="h6-0-330" class="i">+
</a><a href="#h6-0-331" id="h6-0-331" class="i">+		if (!*text) {
</a><a href="#h6-0-332" id="h6-0-332" class="i">+			break;
</a><a href="#h6-0-333" id="h6-0-333" class="i">+		} else if (nextfont) {
</a><a href="#h6-0-334" id="h6-0-334" class="i">+			charexists = 0;
</a><a href="#h6-0-335" id="h6-0-335" class="i">+			usedfont = nextfont;
</a><a href="#h6-0-336" id="h6-0-336" class="i">+		} else {
</a><a href="#h6-0-337" id="h6-0-337" class="i">+			/* Regardless of whether or not a fallback font is found, the
</a><a href="#h6-0-338" id="h6-0-338" class="i">+			 * character must be drawn. */
</a><a href="#h6-0-339" id="h6-0-339" class="i">+			charexists = 1;
</a><a href="#h6-0-340" id="h6-0-340" class="i">+
</a><a href="#h6-0-341" id="h6-0-341" class="i">+			fccharset = FcCharSetCreate();
</a><a href="#h6-0-342" id="h6-0-342" class="i">+			FcCharSetAddChar(fccharset, utf8codepoint);
</a><a href="#h6-0-343" id="h6-0-343" class="i">+
</a><a href="#h6-0-344" id="h6-0-344" class="i">+			if (!drw-&gt;fonts-&gt;pattern) {
</a><a href="#h6-0-345" id="h6-0-345" class="i">+				/* Refer to the comment in xfont_create for more information. */
</a><a href="#h6-0-346" id="h6-0-346" class="i">+				die(&quot;the first font in the cache must be loaded from a font string.&quot;);
</a><a href="#h6-0-347" id="h6-0-347" class="i">+			}
</a><a href="#h6-0-348" id="h6-0-348" class="i">+
</a><a href="#h6-0-349" id="h6-0-349" class="i">+			fcpattern = FcPatternDuplicate(drw-&gt;fonts-&gt;pattern);
</a><a href="#h6-0-350" id="h6-0-350" class="i">+			FcPatternAddCharSet(fcpattern, FC_CHARSET, fccharset);
</a><a href="#h6-0-351" id="h6-0-351" class="i">+			FcPatternAddBool(fcpattern, FC_SCALABLE, FcTrue);
</a><a href="#h6-0-352" id="h6-0-352" class="i">+			FcPatternAddBool(fcpattern, FC_COLOR, FcFalse);
</a><a href="#h6-0-353" id="h6-0-353" class="i">+
</a><a href="#h6-0-354" id="h6-0-354" class="i">+			FcConfigSubstitute(NULL, fcpattern, FcMatchPattern);
</a><a href="#h6-0-355" id="h6-0-355" class="i">+			FcDefaultSubstitute(fcpattern);
</a><a href="#h6-0-356" id="h6-0-356" class="i">+			match = XftFontMatch(drw-&gt;dpy, drw-&gt;screen, fcpattern, &amp;result);
</a><a href="#h6-0-357" id="h6-0-357" class="i">+
</a><a href="#h6-0-358" id="h6-0-358" class="i">+			FcCharSetDestroy(fccharset);
</a><a href="#h6-0-359" id="h6-0-359" class="i">+			FcPatternDestroy(fcpattern);
</a><a href="#h6-0-360" id="h6-0-360" class="i">+
</a><a href="#h6-0-361" id="h6-0-361" class="i">+			if (match) {
</a><a href="#h6-0-362" id="h6-0-362" class="i">+				usedfont = xfont_create(drw, NULL, match);
</a><a href="#h6-0-363" id="h6-0-363" class="i">+				if (usedfont &amp;&amp; XftCharExists(drw-&gt;dpy, usedfont-&gt;xfont, utf8codepoint)) {
</a><a href="#h6-0-364" id="h6-0-364" class="i">+					for (curfont = drw-&gt;fonts; curfont-&gt;next; curfont = curfont-&gt;next)
</a><a href="#h6-0-365" id="h6-0-365" class="i">+						; /* NOP */
</a><a href="#h6-0-366" id="h6-0-366" class="i">+					curfont-&gt;next = usedfont;
</a><a href="#h6-0-367" id="h6-0-367" class="i">+				} else {
</a><a href="#h6-0-368" id="h6-0-368" class="i">+					xfont_free(usedfont);
</a><a href="#h6-0-369" id="h6-0-369" class="i">+					usedfont = drw-&gt;fonts;
</a><a href="#h6-0-370" id="h6-0-370" class="i">+				}
</a><a href="#h6-0-371" id="h6-0-371" class="i">+			}
</a><a href="#h6-0-372" id="h6-0-372" class="i">+		}
</a><a href="#h6-0-373" id="h6-0-373" class="i">+	}
</a><a href="#h6-0-374" id="h6-0-374" class="i">+	if (d)
</a><a href="#h6-0-375" id="h6-0-375" class="i">+		XftDrawDestroy(d);
</a><a href="#h6-0-376" id="h6-0-376" class="i">+
</a><a href="#h6-0-377" id="h6-0-377" class="i">+	return x + (render ? w : 0);
</a><a href="#h6-0-378" id="h6-0-378" class="i">+}
</a><a href="#h6-0-379" id="h6-0-379" class="i">+
</a><a href="#h6-0-380" id="h6-0-380" class="i">+void
</a><a href="#h6-0-381" id="h6-0-381" class="i">+drw_map(Drw *drw, Window win, int x, int y, unsigned int w, unsigned int h)
</a><a href="#h6-0-382" id="h6-0-382" class="i">+{
</a><a href="#h6-0-383" id="h6-0-383" class="i">+	if (!drw)
</a><a href="#h6-0-384" id="h6-0-384" class="i">+		return;
</a><a href="#h6-0-385" id="h6-0-385" class="i">+
</a><a href="#h6-0-386" id="h6-0-386" class="i">+	XCopyArea(drw-&gt;dpy, drw-&gt;drawable, win, drw-&gt;gc, x, y, w, h, x, y);
</a><a href="#h6-0-387" id="h6-0-387" class="i">+	XSync(drw-&gt;dpy, False);
</a><a href="#h6-0-388" id="h6-0-388" class="i">+}
</a><a href="#h6-0-389" id="h6-0-389" class="i">+
</a><a href="#h6-0-390" id="h6-0-390" class="i">+unsigned int
</a><a href="#h6-0-391" id="h6-0-391" class="i">+drw_fontset_getwidth(Drw *drw, const char *text)
</a><a href="#h6-0-392" id="h6-0-392" class="i">+{
</a><a href="#h6-0-393" id="h6-0-393" class="i">+	if (!drw || !drw-&gt;fonts || !text)
</a><a href="#h6-0-394" id="h6-0-394" class="i">+		return 0;
</a><a href="#h6-0-395" id="h6-0-395" class="i">+	return drw_text(drw, 0, 0, 0, 0, 0, text, 0);
</a><a href="#h6-0-396" id="h6-0-396" class="i">+}
</a><a href="#h6-0-397" id="h6-0-397" class="i">+
</a><a href="#h6-0-398" id="h6-0-398" class="i">+void
</a><a href="#h6-0-399" id="h6-0-399" class="i">+drw_font_getexts(Fnt *font, const char *text, unsigned int len, unsigned int *w, unsigned int *h)
</a><a href="#h6-0-400" id="h6-0-400" class="i">+{
</a><a href="#h6-0-401" id="h6-0-401" class="i">+	XGlyphInfo ext;
</a><a href="#h6-0-402" id="h6-0-402" class="i">+
</a><a href="#h6-0-403" id="h6-0-403" class="i">+	if (!font || !text)
</a><a href="#h6-0-404" id="h6-0-404" class="i">+		return;
</a><a href="#h6-0-405" id="h6-0-405" class="i">+
</a><a href="#h6-0-406" id="h6-0-406" class="i">+	XftTextExtentsUtf8(font-&gt;dpy, font-&gt;xfont, (XftChar8 *)text, len, &amp;ext);
</a><a href="#h6-0-407" id="h6-0-407" class="i">+	if (w)
</a><a href="#h6-0-408" id="h6-0-408" class="i">+		*w = ext.xOff;
</a><a href="#h6-0-409" id="h6-0-409" class="i">+	if (h)
</a><a href="#h6-0-410" id="h6-0-410" class="i">+		*h = font-&gt;h;
</a><a href="#h6-0-411" id="h6-0-411" class="i">+}
</a><a href="#h6-0-412" id="h6-0-412" class="i">+
</a><a href="#h6-0-413" id="h6-0-413" class="i">+Cur *
</a><a href="#h6-0-414" id="h6-0-414" class="i">+drw_cur_create(Drw *drw, int shape)
</a><a href="#h6-0-415" id="h6-0-415" class="i">+{
</a><a href="#h6-0-416" id="h6-0-416" class="i">+	Cur *cur;
</a><a href="#h6-0-417" id="h6-0-417" class="i">+
</a><a href="#h6-0-418" id="h6-0-418" class="i">+	if (!drw || !(cur = ecalloc(1, sizeof(Cur))))
</a><a href="#h6-0-419" id="h6-0-419" class="i">+		return NULL;
</a><a href="#h6-0-420" id="h6-0-420" class="i">+
</a><a href="#h6-0-421" id="h6-0-421" class="i">+	cur-&gt;cursor = XCreateFontCursor(drw-&gt;dpy, shape);
</a><a href="#h6-0-422" id="h6-0-422" class="i">+
</a><a href="#h6-0-423" id="h6-0-423" class="i">+	return cur;
</a><a href="#h6-0-424" id="h6-0-424" class="i">+}
</a><a href="#h6-0-425" id="h6-0-425" class="i">+
</a><a href="#h6-0-426" id="h6-0-426" class="i">+void
</a><a href="#h6-0-427" id="h6-0-427" class="i">+drw_cur_free(Drw *drw, Cur *cursor)
</a><a href="#h6-0-428" id="h6-0-428" class="i">+{
</a><a href="#h6-0-429" id="h6-0-429" class="i">+	if (!cursor)
</a><a href="#h6-0-430" id="h6-0-430" class="i">+		return;
</a><a href="#h6-0-431" id="h6-0-431" class="i">+
</a><a href="#h6-0-432" id="h6-0-432" class="i">+	XFreeCursor(drw-&gt;dpy, cursor-&gt;cursor);
</a><a href="#h6-0-433" id="h6-0-433" class="i">+	free(cursor);
</a><a href="#h6-0-434" id="h6-0-434" class="i">+}
</a><b>diff --git a/<a id="h7" href="../file/dwm/drw.h.html">dwm/drw.h</a> b/<a href="../file/dwm/drw.h.html">dwm/drw.h</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,57 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h7-0-1" id="h7-0-1" class="i">+
</a><a href="#h7-0-2" id="h7-0-2" class="i">+typedef struct {
</a><a href="#h7-0-3" id="h7-0-3" class="i">+	Cursor cursor;
</a><a href="#h7-0-4" id="h7-0-4" class="i">+} Cur;
</a><a href="#h7-0-5" id="h7-0-5" class="i">+
</a><a href="#h7-0-6" id="h7-0-6" class="i">+typedef struct Fnt {
</a><a href="#h7-0-7" id="h7-0-7" class="i">+	Display *dpy;
</a><a href="#h7-0-8" id="h7-0-8" class="i">+	unsigned int h;
</a><a href="#h7-0-9" id="h7-0-9" class="i">+	XftFont *xfont;
</a><a href="#h7-0-10" id="h7-0-10" class="i">+	FcPattern *pattern;
</a><a href="#h7-0-11" id="h7-0-11" class="i">+	struct Fnt *next;
</a><a href="#h7-0-12" id="h7-0-12" class="i">+} Fnt;
</a><a href="#h7-0-13" id="h7-0-13" class="i">+
</a><a href="#h7-0-14" id="h7-0-14" class="i">+enum { ColFg, ColBg, ColBorder }; /* Clr scheme index */
</a><a href="#h7-0-15" id="h7-0-15" class="i">+typedef XftColor Clr;
</a><a href="#h7-0-16" id="h7-0-16" class="i">+
</a><a href="#h7-0-17" id="h7-0-17" class="i">+typedef struct {
</a><a href="#h7-0-18" id="h7-0-18" class="i">+	unsigned int w, h;
</a><a href="#h7-0-19" id="h7-0-19" class="i">+	Display *dpy;
</a><a href="#h7-0-20" id="h7-0-20" class="i">+	int screen;
</a><a href="#h7-0-21" id="h7-0-21" class="i">+	Window root;
</a><a href="#h7-0-22" id="h7-0-22" class="i">+	Drawable drawable;
</a><a href="#h7-0-23" id="h7-0-23" class="i">+	GC gc;
</a><a href="#h7-0-24" id="h7-0-24" class="i">+	Clr *scheme;
</a><a href="#h7-0-25" id="h7-0-25" class="i">+	Fnt *fonts;
</a><a href="#h7-0-26" id="h7-0-26" class="i">+} Drw;
</a><a href="#h7-0-27" id="h7-0-27" class="i">+
</a><a href="#h7-0-28" id="h7-0-28" class="i">+/* Drawable abstraction */
</a><a href="#h7-0-29" id="h7-0-29" class="i">+Drw *drw_create(Display *dpy, int screen, Window win, unsigned int w, unsigned int h);
</a><a href="#h7-0-30" id="h7-0-30" class="i">+void drw_resize(Drw *drw, unsigned int w, unsigned int h);
</a><a href="#h7-0-31" id="h7-0-31" class="i">+void drw_free(Drw *drw);
</a><a href="#h7-0-32" id="h7-0-32" class="i">+
</a><a href="#h7-0-33" id="h7-0-33" class="i">+/* Fnt abstraction */
</a><a href="#h7-0-34" id="h7-0-34" class="i">+Fnt *drw_fontset_create(Drw* drw, const char *fonts[], size_t fontcount);
</a><a href="#h7-0-35" id="h7-0-35" class="i">+void drw_fontset_free(Fnt* set);
</a><a href="#h7-0-36" id="h7-0-36" class="i">+unsigned int drw_fontset_getwidth(Drw *drw, const char *text);
</a><a href="#h7-0-37" id="h7-0-37" class="i">+void drw_font_getexts(Fnt *font, const char *text, unsigned int len, unsigned int *w, unsigned int *h);
</a><a href="#h7-0-38" id="h7-0-38" class="i">+
</a><a href="#h7-0-39" id="h7-0-39" class="i">+/* Colorscheme abstraction */
</a><a href="#h7-0-40" id="h7-0-40" class="i">+void drw_clr_create(Drw *drw, Clr *dest, const char *clrname);
</a><a href="#h7-0-41" id="h7-0-41" class="i">+Clr *drw_scm_create(Drw *drw, const char *clrnames[], size_t clrcount);
</a><a href="#h7-0-42" id="h7-0-42" class="i">+
</a><a href="#h7-0-43" id="h7-0-43" class="i">+/* Cursor abstraction */
</a><a href="#h7-0-44" id="h7-0-44" class="i">+Cur *drw_cur_create(Drw *drw, int shape);
</a><a href="#h7-0-45" id="h7-0-45" class="i">+void drw_cur_free(Drw *drw, Cur *cursor);
</a><a href="#h7-0-46" id="h7-0-46" class="i">+
</a><a href="#h7-0-47" id="h7-0-47" class="i">+/* Drawing context manipulation */
</a><a href="#h7-0-48" id="h7-0-48" class="i">+void drw_setfontset(Drw *drw, Fnt *set);
</a><a href="#h7-0-49" id="h7-0-49" class="i">+void drw_setscheme(Drw *drw, Clr *scm);
</a><a href="#h7-0-50" id="h7-0-50" class="i">+
</a><a href="#h7-0-51" id="h7-0-51" class="i">+/* Drawing functions */
</a><a href="#h7-0-52" id="h7-0-52" class="i">+void drw_rect(Drw *drw, int x, int y, unsigned int w, unsigned int h, int filled, int invert);
</a><a href="#h7-0-53" id="h7-0-53" class="i">+int drw_text(Drw *drw, int x, int y, unsigned int w, unsigned int h, unsigned int lpad, const char *text, int invert);
</a><a href="#h7-0-54" id="h7-0-54" class="i">+
</a><a href="#h7-0-55" id="h7-0-55" class="i">+/* Map functions */
</a><a href="#h7-0-56" id="h7-0-56" class="i">+void drw_map(Drw *drw, Window win, int x, int y, unsigned int w, unsigned int h);
</a><b>diff --git a/<a id="h8" href="../file/dwm/drw.o.html">dwm/drw.o</a> b/<a href="../file/dwm/drw.o.html">dwm/drw.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h9" href="../file/dwm/dwm.html">dwm/dwm</a> b/<a href="../file/dwm/dwm.html">dwm/dwm</a></b>
Binary files differ.
<b>diff --git a/<a id="h10" href="../file/dwm/dwm.1.html">dwm/dwm.1</a> b/<a href="../file/dwm/dwm.1.html">dwm/dwm.1</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,176 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+.TH DWM 1 dwm\-VERSION
</a><a href="#h10-0-1" id="h10-0-1" class="i">+.SH NAME
</a><a href="#h10-0-2" id="h10-0-2" class="i">+dwm \- dynamic window manager
</a><a href="#h10-0-3" id="h10-0-3" class="i">+.SH SYNOPSIS
</a><a href="#h10-0-4" id="h10-0-4" class="i">+.B dwm
</a><a href="#h10-0-5" id="h10-0-5" class="i">+.RB [ \-v ]
</a><a href="#h10-0-6" id="h10-0-6" class="i">+.SH DESCRIPTION
</a><a href="#h10-0-7" id="h10-0-7" class="i">+dwm is a dynamic window manager for X. It manages windows in tiled, monocle
</a><a href="#h10-0-8" id="h10-0-8" class="i">+and floating layouts. Either layout can be applied dynamically, optimising the
</a><a href="#h10-0-9" id="h10-0-9" class="i">+environment for the application in use and the task performed.
</a><a href="#h10-0-10" id="h10-0-10" class="i">+.P
</a><a href="#h10-0-11" id="h10-0-11" class="i">+In tiled layouts windows are managed in a master and stacking area. The master
</a><a href="#h10-0-12" id="h10-0-12" class="i">+area on the left contains one window by default, and the stacking area on the
</a><a href="#h10-0-13" id="h10-0-13" class="i">+right contains all other windows. The number of master area windows can be
</a><a href="#h10-0-14" id="h10-0-14" class="i">+adjusted from zero to an arbitrary number. In monocle layout all windows are
</a><a href="#h10-0-15" id="h10-0-15" class="i">+maximised to the screen size. In floating layout windows can be resized and
</a><a href="#h10-0-16" id="h10-0-16" class="i">+moved freely. Dialog windows are always managed floating, regardless of the
</a><a href="#h10-0-17" id="h10-0-17" class="i">+layout applied.
</a><a href="#h10-0-18" id="h10-0-18" class="i">+.P
</a><a href="#h10-0-19" id="h10-0-19" class="i">+Windows are grouped by tags. Each window can be tagged with one or multiple
</a><a href="#h10-0-20" id="h10-0-20" class="i">+tags. Selecting certain tags displays all windows with these tags.
</a><a href="#h10-0-21" id="h10-0-21" class="i">+.P
</a><a href="#h10-0-22" id="h10-0-22" class="i">+Each screen contains a small status bar which displays all available tags, the
</a><a href="#h10-0-23" id="h10-0-23" class="i">+layout, the title of the focused window, and the text read from the root window
</a><a href="#h10-0-24" id="h10-0-24" class="i">+name property, if the screen is focused. A floating window is indicated with an
</a><a href="#h10-0-25" id="h10-0-25" class="i">+empty square and a maximised floating window is indicated with a filled square
</a><a href="#h10-0-26" id="h10-0-26" class="i">+before the windows title.  The selected tags are indicated with a different
</a><a href="#h10-0-27" id="h10-0-27" class="i">+color. The tags of the focused window are indicated with a filled square in the
</a><a href="#h10-0-28" id="h10-0-28" class="i">+top left corner.  The tags which are applied to one or more windows are
</a><a href="#h10-0-29" id="h10-0-29" class="i">+indicated with an empty square in the top left corner.
</a><a href="#h10-0-30" id="h10-0-30" class="i">+.P
</a><a href="#h10-0-31" id="h10-0-31" class="i">+dwm draws a small border around windows to indicate the focus state.
</a><a href="#h10-0-32" id="h10-0-32" class="i">+.SH OPTIONS
</a><a href="#h10-0-33" id="h10-0-33" class="i">+.TP
</a><a href="#h10-0-34" id="h10-0-34" class="i">+.B \-v
</a><a href="#h10-0-35" id="h10-0-35" class="i">+prints version information to standard output, then exits.
</a><a href="#h10-0-36" id="h10-0-36" class="i">+.SH USAGE
</a><a href="#h10-0-37" id="h10-0-37" class="i">+.SS Status bar
</a><a href="#h10-0-38" id="h10-0-38" class="i">+.TP
</a><a href="#h10-0-39" id="h10-0-39" class="i">+.B X root window name
</a><a href="#h10-0-40" id="h10-0-40" class="i">+is read and displayed in the status text area. It can be set with the
</a><a href="#h10-0-41" id="h10-0-41" class="i">+.BR xsetroot (1)
</a><a href="#h10-0-42" id="h10-0-42" class="i">+command.
</a><a href="#h10-0-43" id="h10-0-43" class="i">+.TP
</a><a href="#h10-0-44" id="h10-0-44" class="i">+.B Button1
</a><a href="#h10-0-45" id="h10-0-45" class="i">+click on a tag label to display all windows with that tag, click on the layout
</a><a href="#h10-0-46" id="h10-0-46" class="i">+label toggles between tiled and floating layout.
</a><a href="#h10-0-47" id="h10-0-47" class="i">+.TP
</a><a href="#h10-0-48" id="h10-0-48" class="i">+.B Button3
</a><a href="#h10-0-49" id="h10-0-49" class="i">+click on a tag label adds/removes all windows with that tag to/from the view.
</a><a href="#h10-0-50" id="h10-0-50" class="i">+.TP
</a><a href="#h10-0-51" id="h10-0-51" class="i">+.B Mod1\-Button1
</a><a href="#h10-0-52" id="h10-0-52" class="i">+click on a tag label applies that tag to the focused window.
</a><a href="#h10-0-53" id="h10-0-53" class="i">+.TP
</a><a href="#h10-0-54" id="h10-0-54" class="i">+.B Mod1\-Button3
</a><a href="#h10-0-55" id="h10-0-55" class="i">+click on a tag label adds/removes that tag to/from the focused window.
</a><a href="#h10-0-56" id="h10-0-56" class="i">+.SS Keyboard commands
</a><a href="#h10-0-57" id="h10-0-57" class="i">+.TP
</a><a href="#h10-0-58" id="h10-0-58" class="i">+.B Mod1\-Shift\-Return
</a><a href="#h10-0-59" id="h10-0-59" class="i">+Start
</a><a href="#h10-0-60" id="h10-0-60" class="i">+.BR st(1).
</a><a href="#h10-0-61" id="h10-0-61" class="i">+.TP
</a><a href="#h10-0-62" id="h10-0-62" class="i">+.B Mod1\-p
</a><a href="#h10-0-63" id="h10-0-63" class="i">+Spawn
</a><a href="#h10-0-64" id="h10-0-64" class="i">+.BR dmenu(1)
</a><a href="#h10-0-65" id="h10-0-65" class="i">+for launching other programs.
</a><a href="#h10-0-66" id="h10-0-66" class="i">+.TP
</a><a href="#h10-0-67" id="h10-0-67" class="i">+.B Mod1\-,
</a><a href="#h10-0-68" id="h10-0-68" class="i">+Focus previous screen, if any.
</a><a href="#h10-0-69" id="h10-0-69" class="i">+.TP
</a><a href="#h10-0-70" id="h10-0-70" class="i">+.B Mod1\-.
</a><a href="#h10-0-71" id="h10-0-71" class="i">+Focus next screen, if any.
</a><a href="#h10-0-72" id="h10-0-72" class="i">+.TP
</a><a href="#h10-0-73" id="h10-0-73" class="i">+.B Mod1\-Shift\-,
</a><a href="#h10-0-74" id="h10-0-74" class="i">+Send focused window to previous screen, if any.
</a><a href="#h10-0-75" id="h10-0-75" class="i">+.TP
</a><a href="#h10-0-76" id="h10-0-76" class="i">+.B Mod1\-Shift\-.
</a><a href="#h10-0-77" id="h10-0-77" class="i">+Send focused window to next screen, if any.
</a><a href="#h10-0-78" id="h10-0-78" class="i">+.TP
</a><a href="#h10-0-79" id="h10-0-79" class="i">+.B Mod1\-b
</a><a href="#h10-0-80" id="h10-0-80" class="i">+Toggles bar on and off.
</a><a href="#h10-0-81" id="h10-0-81" class="i">+.TP
</a><a href="#h10-0-82" id="h10-0-82" class="i">+.B Mod1\-t
</a><a href="#h10-0-83" id="h10-0-83" class="i">+Sets tiled layout.
</a><a href="#h10-0-84" id="h10-0-84" class="i">+.TP
</a><a href="#h10-0-85" id="h10-0-85" class="i">+.B Mod1\-f
</a><a href="#h10-0-86" id="h10-0-86" class="i">+Sets floating layout.
</a><a href="#h10-0-87" id="h10-0-87" class="i">+.TP
</a><a href="#h10-0-88" id="h10-0-88" class="i">+.B Mod1\-m
</a><a href="#h10-0-89" id="h10-0-89" class="i">+Sets monocle layout.
</a><a href="#h10-0-90" id="h10-0-90" class="i">+.TP
</a><a href="#h10-0-91" id="h10-0-91" class="i">+.B Mod1\-space
</a><a href="#h10-0-92" id="h10-0-92" class="i">+Toggles between current and previous layout.
</a><a href="#h10-0-93" id="h10-0-93" class="i">+.TP
</a><a href="#h10-0-94" id="h10-0-94" class="i">+.B Mod1\-j
</a><a href="#h10-0-95" id="h10-0-95" class="i">+Focus next window.
</a><a href="#h10-0-96" id="h10-0-96" class="i">+.TP
</a><a href="#h10-0-97" id="h10-0-97" class="i">+.B Mod1\-k
</a><a href="#h10-0-98" id="h10-0-98" class="i">+Focus previous window.
</a><a href="#h10-0-99" id="h10-0-99" class="i">+.TP
</a><a href="#h10-0-100" id="h10-0-100" class="i">+.B Mod1\-i
</a><a href="#h10-0-101" id="h10-0-101" class="i">+Increase number of windows in master area.
</a><a href="#h10-0-102" id="h10-0-102" class="i">+.TP
</a><a href="#h10-0-103" id="h10-0-103" class="i">+.B Mod1\-d
</a><a href="#h10-0-104" id="h10-0-104" class="i">+Decrease number of windows in master area.
</a><a href="#h10-0-105" id="h10-0-105" class="i">+.TP
</a><a href="#h10-0-106" id="h10-0-106" class="i">+.B Mod1\-l
</a><a href="#h10-0-107" id="h10-0-107" class="i">+Increase master area size.
</a><a href="#h10-0-108" id="h10-0-108" class="i">+.TP
</a><a href="#h10-0-109" id="h10-0-109" class="i">+.B Mod1\-h
</a><a href="#h10-0-110" id="h10-0-110" class="i">+Decrease master area size.
</a><a href="#h10-0-111" id="h10-0-111" class="i">+.TP
</a><a href="#h10-0-112" id="h10-0-112" class="i">+.B Mod1\-Return
</a><a href="#h10-0-113" id="h10-0-113" class="i">+Zooms/cycles focused window to/from master area (tiled layouts only).
</a><a href="#h10-0-114" id="h10-0-114" class="i">+.TP
</a><a href="#h10-0-115" id="h10-0-115" class="i">+.B Mod1\-Shift\-c
</a><a href="#h10-0-116" id="h10-0-116" class="i">+Close focused window.
</a><a href="#h10-0-117" id="h10-0-117" class="i">+.TP
</a><a href="#h10-0-118" id="h10-0-118" class="i">+.B Mod1\-Shift\-space
</a><a href="#h10-0-119" id="h10-0-119" class="i">+Toggle focused window between tiled and floating state.
</a><a href="#h10-0-120" id="h10-0-120" class="i">+.TP
</a><a href="#h10-0-121" id="h10-0-121" class="i">+.B Mod1\-Tab
</a><a href="#h10-0-122" id="h10-0-122" class="i">+Toggles to the previously selected tags.
</a><a href="#h10-0-123" id="h10-0-123" class="i">+.TP
</a><a href="#h10-0-124" id="h10-0-124" class="i">+.B Mod1\-Shift\-[1..n]
</a><a href="#h10-0-125" id="h10-0-125" class="i">+Apply nth tag to focused window.
</a><a href="#h10-0-126" id="h10-0-126" class="i">+.TP
</a><a href="#h10-0-127" id="h10-0-127" class="i">+.B Mod1\-Shift\-0
</a><a href="#h10-0-128" id="h10-0-128" class="i">+Apply all tags to focused window.
</a><a href="#h10-0-129" id="h10-0-129" class="i">+.TP
</a><a href="#h10-0-130" id="h10-0-130" class="i">+.B Mod1\-Control\-Shift\-[1..n]
</a><a href="#h10-0-131" id="h10-0-131" class="i">+Add/remove nth tag to/from focused window.
</a><a href="#h10-0-132" id="h10-0-132" class="i">+.TP
</a><a href="#h10-0-133" id="h10-0-133" class="i">+.B Mod1\-[1..n]
</a><a href="#h10-0-134" id="h10-0-134" class="i">+View all windows with nth tag.
</a><a href="#h10-0-135" id="h10-0-135" class="i">+.TP
</a><a href="#h10-0-136" id="h10-0-136" class="i">+.B Mod1\-0
</a><a href="#h10-0-137" id="h10-0-137" class="i">+View all windows with any tag.
</a><a href="#h10-0-138" id="h10-0-138" class="i">+.TP
</a><a href="#h10-0-139" id="h10-0-139" class="i">+.B Mod1\-Control\-[1..n]
</a><a href="#h10-0-140" id="h10-0-140" class="i">+Add/remove all windows with nth tag to/from the view.
</a><a href="#h10-0-141" id="h10-0-141" class="i">+.TP
</a><a href="#h10-0-142" id="h10-0-142" class="i">+.B Mod1\-Shift\-q
</a><a href="#h10-0-143" id="h10-0-143" class="i">+Quit dwm.
</a><a href="#h10-0-144" id="h10-0-144" class="i">+.SS Mouse commands
</a><a href="#h10-0-145" id="h10-0-145" class="i">+.TP
</a><a href="#h10-0-146" id="h10-0-146" class="i">+.B Mod1\-Button1
</a><a href="#h10-0-147" id="h10-0-147" class="i">+Move focused window while dragging. Tiled windows will be toggled to the floating state.
</a><a href="#h10-0-148" id="h10-0-148" class="i">+.TP
</a><a href="#h10-0-149" id="h10-0-149" class="i">+.B Mod1\-Button2
</a><a href="#h10-0-150" id="h10-0-150" class="i">+Toggles focused window between floating and tiled state.
</a><a href="#h10-0-151" id="h10-0-151" class="i">+.TP
</a><a href="#h10-0-152" id="h10-0-152" class="i">+.B Mod1\-Button3
</a><a href="#h10-0-153" id="h10-0-153" class="i">+Resize focused window while dragging. Tiled windows will be toggled to the floating state.
</a><a href="#h10-0-154" id="h10-0-154" class="i">+.SH CUSTOMIZATION
</a><a href="#h10-0-155" id="h10-0-155" class="i">+dwm is customized by creating a custom config.h and (re)compiling the source
</a><a href="#h10-0-156" id="h10-0-156" class="i">+code. This keeps it fast, secure and simple.
</a><a href="#h10-0-157" id="h10-0-157" class="i">+.SH SEE ALSO
</a><a href="#h10-0-158" id="h10-0-158" class="i">+.BR dmenu (1),
</a><a href="#h10-0-159" id="h10-0-159" class="i">+.BR st (1)
</a><a href="#h10-0-160" id="h10-0-160" class="i">+.SH ISSUES
</a><a href="#h10-0-161" id="h10-0-161" class="i">+Java applications which use the XToolkit/XAWT backend may draw grey windows
</a><a href="#h10-0-162" id="h10-0-162" class="i">+only. The XToolkit/XAWT backend breaks ICCCM-compliance in recent JDK 1.5 and early
</a><a href="#h10-0-163" id="h10-0-163" class="i">+JDK 1.6 versions, because it assumes a reparenting window manager. Possible workarounds
</a><a href="#h10-0-164" id="h10-0-164" class="i">+are using JDK 1.4 (which doesn&#39;t contain the XToolkit/XAWT backend) or setting the
</a><a href="#h10-0-165" id="h10-0-165" class="i">+environment variable
</a><a href="#h10-0-166" id="h10-0-166" class="i">+.BR AWT_TOOLKIT=MToolkit
</a><a href="#h10-0-167" id="h10-0-167" class="i">+(to use the older Motif backend instead) or running
</a><a href="#h10-0-168" id="h10-0-168" class="i">+.B xprop -root -f _NET_WM_NAME 32a -set _NET_WM_NAME LG3D
</a><a href="#h10-0-169" id="h10-0-169" class="i">+or
</a><a href="#h10-0-170" id="h10-0-170" class="i">+.B wmname LG3D
</a><a href="#h10-0-171" id="h10-0-171" class="i">+(to pretend that a non-reparenting window manager is running that the
</a><a href="#h10-0-172" id="h10-0-172" class="i">+XToolkit/XAWT backend can recognize) or when using OpenJDK setting the environment variable
</a><a href="#h10-0-173" id="h10-0-173" class="i">+.BR _JAVA_AWT_WM_NONREPARENTING=1 .
</a><a href="#h10-0-174" id="h10-0-174" class="i">+.SH BUGS
</a><a href="#h10-0-175" id="h10-0-175" class="i">+Send all bug reports with a patch to hackers@suckless.org.
</a><b>diff --git a/<a id="h11" href="../file/dwm/dwm.c.html">dwm/dwm.c</a> b/<a href="../file/dwm/dwm.c.html">dwm/dwm.c</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,2149 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+/* See LICENSE file for copyright and license details.
</a><a href="#h11-0-1" id="h11-0-1" class="i">+ *
</a><a href="#h11-0-2" id="h11-0-2" class="i">+ * dynamic window manager is designed like any other X client as well. It is
</a><a href="#h11-0-3" id="h11-0-3" class="i">+ * driven through handling X events. In contrast to other X clients, a window
</a><a href="#h11-0-4" id="h11-0-4" class="i">+ * manager selects for SubstructureRedirectMask on the root window, to receive
</a><a href="#h11-0-5" id="h11-0-5" class="i">+ * events about window (dis-)appearance. Only one X connection at a time is
</a><a href="#h11-0-6" id="h11-0-6" class="i">+ * allowed to select for this event mask.
</a><a href="#h11-0-7" id="h11-0-7" class="i">+ *
</a><a href="#h11-0-8" id="h11-0-8" class="i">+ * The event handlers of dwm are organized in an array which is accessed
</a><a href="#h11-0-9" id="h11-0-9" class="i">+ * whenever a new event has been fetched. This allows event dispatching
</a><a href="#h11-0-10" id="h11-0-10" class="i">+ * in O(1) time.
</a><a href="#h11-0-11" id="h11-0-11" class="i">+ *
</a><a href="#h11-0-12" id="h11-0-12" class="i">+ * Each child of the root window is called a client, except windows which have
</a><a href="#h11-0-13" id="h11-0-13" class="i">+ * set the override_redirect flag. Clients are organized in a linked client
</a><a href="#h11-0-14" id="h11-0-14" class="i">+ * list on each monitor, the focus history is remembered through a stack list
</a><a href="#h11-0-15" id="h11-0-15" class="i">+ * on each monitor. Each client contains a bit array to indicate the tags of a
</a><a href="#h11-0-16" id="h11-0-16" class="i">+ * client.
</a><a href="#h11-0-17" id="h11-0-17" class="i">+ *
</a><a href="#h11-0-18" id="h11-0-18" class="i">+ * Keys and tagging rules are organized as arrays and defined in config.h.
</a><a href="#h11-0-19" id="h11-0-19" class="i">+ *
</a><a href="#h11-0-20" id="h11-0-20" class="i">+ * To understand everything else, start reading main().
</a><a href="#h11-0-21" id="h11-0-21" class="i">+ */
</a><a href="#h11-0-22" id="h11-0-22" class="i">+#include &lt;errno.h&gt;
</a><a href="#h11-0-23" id="h11-0-23" class="i">+#include &lt;locale.h&gt;
</a><a href="#h11-0-24" id="h11-0-24" class="i">+#include &lt;signal.h&gt;
</a><a href="#h11-0-25" id="h11-0-25" class="i">+#include &lt;stdarg.h&gt;
</a><a href="#h11-0-26" id="h11-0-26" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h11-0-27" id="h11-0-27" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h11-0-28" id="h11-0-28" class="i">+#include &lt;string.h&gt;
</a><a href="#h11-0-29" id="h11-0-29" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h11-0-30" id="h11-0-30" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h11-0-31" id="h11-0-31" class="i">+#include &lt;sys/wait.h&gt;
</a><a href="#h11-0-32" id="h11-0-32" class="i">+#include &lt;X11/cursorfont.h&gt;
</a><a href="#h11-0-33" id="h11-0-33" class="i">+#include &lt;X11/keysym.h&gt;
</a><a href="#h11-0-34" id="h11-0-34" class="i">+#include &lt;X11/Xatom.h&gt;
</a><a href="#h11-0-35" id="h11-0-35" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h11-0-36" id="h11-0-36" class="i">+#include &lt;X11/Xproto.h&gt;
</a><a href="#h11-0-37" id="h11-0-37" class="i">+#include &lt;X11/Xutil.h&gt;
</a><a href="#h11-0-38" id="h11-0-38" class="i">+#ifdef XINERAMA
</a><a href="#h11-0-39" id="h11-0-39" class="i">+#include &lt;X11/extensions/Xinerama.h&gt;
</a><a href="#h11-0-40" id="h11-0-40" class="i">+#endif /* XINERAMA */
</a><a href="#h11-0-41" id="h11-0-41" class="i">+#include &lt;X11/Xft/Xft.h&gt;
</a><a href="#h11-0-42" id="h11-0-42" class="i">+
</a><a href="#h11-0-43" id="h11-0-43" class="i">+#include &quot;drw.h&quot;
</a><a href="#h11-0-44" id="h11-0-44" class="i">+#include &quot;util.h&quot;
</a><a href="#h11-0-45" id="h11-0-45" class="i">+
</a><a href="#h11-0-46" id="h11-0-46" class="i">+/* macros */
</a><a href="#h11-0-47" id="h11-0-47" class="i">+#define BUTTONMASK              (ButtonPressMask|ButtonReleaseMask)
</a><a href="#h11-0-48" id="h11-0-48" class="i">+#define CLEANMASK(mask)         (mask &amp; ~(numlockmask|LockMask) &amp; (ShiftMask|ControlMask|Mod1Mask|Mod2Mask|Mod3Mask|Mod4Mask|Mod5Mask))
</a><a href="#h11-0-49" id="h11-0-49" class="i">+#define INTERSECT(x,y,w,h,m)    (MAX(0, MIN((x)+(w),(m)-&gt;wx+(m)-&gt;ww) - MAX((x),(m)-&gt;wx)) \
</a><a href="#h11-0-50" id="h11-0-50" class="i">+                               * MAX(0, MIN((y)+(h),(m)-&gt;wy+(m)-&gt;wh) - MAX((y),(m)-&gt;wy)))
</a><a href="#h11-0-51" id="h11-0-51" class="i">+#define ISVISIBLE(C)            ((C-&gt;tags &amp; C-&gt;mon-&gt;tagset[C-&gt;mon-&gt;seltags]))
</a><a href="#h11-0-52" id="h11-0-52" class="i">+#define LENGTH(X)               (sizeof X / sizeof X[0])
</a><a href="#h11-0-53" id="h11-0-53" class="i">+#define MOUSEMASK               (BUTTONMASK|PointerMotionMask)
</a><a href="#h11-0-54" id="h11-0-54" class="i">+#define WIDTH(X)                ((X)-&gt;w + 2 * (X)-&gt;bw)
</a><a href="#h11-0-55" id="h11-0-55" class="i">+#define HEIGHT(X)               ((X)-&gt;h + 2 * (X)-&gt;bw)
</a><a href="#h11-0-56" id="h11-0-56" class="i">+#define TAGMASK                 ((1 &lt;&lt; LENGTH(tags)) - 1)
</a><a href="#h11-0-57" id="h11-0-57" class="i">+#define TEXTW(X)                (drw_fontset_getwidth(drw, (X)) + lrpad)
</a><a href="#h11-0-58" id="h11-0-58" class="i">+
</a><a href="#h11-0-59" id="h11-0-59" class="i">+/* enums */
</a><a href="#h11-0-60" id="h11-0-60" class="i">+enum { CurNormal, CurResize, CurMove, CurLast }; /* cursor */
</a><a href="#h11-0-61" id="h11-0-61" class="i">+enum { SchemeNorm, SchemeSel }; /* color schemes */
</a><a href="#h11-0-62" id="h11-0-62" class="i">+enum { NetSupported, NetWMName, NetWMState, NetWMCheck,
</a><a href="#h11-0-63" id="h11-0-63" class="i">+       NetWMFullscreen, NetActiveWindow, NetWMWindowType,
</a><a href="#h11-0-64" id="h11-0-64" class="i">+       NetWMWindowTypeDialog, NetClientList, NetLast }; /* EWMH atoms */
</a><a href="#h11-0-65" id="h11-0-65" class="i">+enum { WMProtocols, WMDelete, WMState, WMTakeFocus, WMLast }; /* default atoms */
</a><a href="#h11-0-66" id="h11-0-66" class="i">+enum { ClkTagBar, ClkLtSymbol, ClkStatusText, ClkWinTitle,
</a><a href="#h11-0-67" id="h11-0-67" class="i">+       ClkClientWin, ClkRootWin, ClkLast }; /* clicks */
</a><a href="#h11-0-68" id="h11-0-68" class="i">+
</a><a href="#h11-0-69" id="h11-0-69" class="i">+typedef union {
</a><a href="#h11-0-70" id="h11-0-70" class="i">+	int i;
</a><a href="#h11-0-71" id="h11-0-71" class="i">+	unsigned int ui;
</a><a href="#h11-0-72" id="h11-0-72" class="i">+	float f;
</a><a href="#h11-0-73" id="h11-0-73" class="i">+	const void *v;
</a><a href="#h11-0-74" id="h11-0-74" class="i">+} Arg;
</a><a href="#h11-0-75" id="h11-0-75" class="i">+
</a><a href="#h11-0-76" id="h11-0-76" class="i">+typedef struct {
</a><a href="#h11-0-77" id="h11-0-77" class="i">+	unsigned int click;
</a><a href="#h11-0-78" id="h11-0-78" class="i">+	unsigned int mask;
</a><a href="#h11-0-79" id="h11-0-79" class="i">+	unsigned int button;
</a><a href="#h11-0-80" id="h11-0-80" class="i">+	void (*func)(const Arg *arg);
</a><a href="#h11-0-81" id="h11-0-81" class="i">+	const Arg arg;
</a><a href="#h11-0-82" id="h11-0-82" class="i">+} Button;
</a><a href="#h11-0-83" id="h11-0-83" class="i">+
</a><a href="#h11-0-84" id="h11-0-84" class="i">+typedef struct Monitor Monitor;
</a><a href="#h11-0-85" id="h11-0-85" class="i">+typedef struct Client Client;
</a><a href="#h11-0-86" id="h11-0-86" class="i">+struct Client {
</a><a href="#h11-0-87" id="h11-0-87" class="i">+	char name[256];
</a><a href="#h11-0-88" id="h11-0-88" class="i">+	float mina, maxa;
</a><a href="#h11-0-89" id="h11-0-89" class="i">+	int x, y, w, h;
</a><a href="#h11-0-90" id="h11-0-90" class="i">+	int oldx, oldy, oldw, oldh;
</a><a href="#h11-0-91" id="h11-0-91" class="i">+	int basew, baseh, incw, inch, maxw, maxh, minw, minh;
</a><a href="#h11-0-92" id="h11-0-92" class="i">+	int bw, oldbw;
</a><a href="#h11-0-93" id="h11-0-93" class="i">+	unsigned int tags;
</a><a href="#h11-0-94" id="h11-0-94" class="i">+	int isfixed, isfloating, isurgent, neverfocus, oldstate, isfullscreen;
</a><a href="#h11-0-95" id="h11-0-95" class="i">+	Client *next;
</a><a href="#h11-0-96" id="h11-0-96" class="i">+	Client *snext;
</a><a href="#h11-0-97" id="h11-0-97" class="i">+	Monitor *mon;
</a><a href="#h11-0-98" id="h11-0-98" class="i">+	Window win;
</a><a href="#h11-0-99" id="h11-0-99" class="i">+};
</a><a href="#h11-0-100" id="h11-0-100" class="i">+
</a><a href="#h11-0-101" id="h11-0-101" class="i">+typedef struct {
</a><a href="#h11-0-102" id="h11-0-102" class="i">+	unsigned int mod;
</a><a href="#h11-0-103" id="h11-0-103" class="i">+	KeySym keysym;
</a><a href="#h11-0-104" id="h11-0-104" class="i">+	void (*func)(const Arg *);
</a><a href="#h11-0-105" id="h11-0-105" class="i">+	const Arg arg;
</a><a href="#h11-0-106" id="h11-0-106" class="i">+} Key;
</a><a href="#h11-0-107" id="h11-0-107" class="i">+
</a><a href="#h11-0-108" id="h11-0-108" class="i">+typedef struct {
</a><a href="#h11-0-109" id="h11-0-109" class="i">+	const char *symbol;
</a><a href="#h11-0-110" id="h11-0-110" class="i">+	void (*arrange)(Monitor *);
</a><a href="#h11-0-111" id="h11-0-111" class="i">+} Layout;
</a><a href="#h11-0-112" id="h11-0-112" class="i">+
</a><a href="#h11-0-113" id="h11-0-113" class="i">+struct Monitor {
</a><a href="#h11-0-114" id="h11-0-114" class="i">+	char ltsymbol[16];
</a><a href="#h11-0-115" id="h11-0-115" class="i">+	float mfact;
</a><a href="#h11-0-116" id="h11-0-116" class="i">+	int nmaster;
</a><a href="#h11-0-117" id="h11-0-117" class="i">+	int num;
</a><a href="#h11-0-118" id="h11-0-118" class="i">+	int by;               /* bar geometry */
</a><a href="#h11-0-119" id="h11-0-119" class="i">+	int mx, my, mw, mh;   /* screen size */
</a><a href="#h11-0-120" id="h11-0-120" class="i">+	int wx, wy, ww, wh;   /* window area  */
</a><a href="#h11-0-121" id="h11-0-121" class="i">+	unsigned int seltags;
</a><a href="#h11-0-122" id="h11-0-122" class="i">+	unsigned int sellt;
</a><a href="#h11-0-123" id="h11-0-123" class="i">+	unsigned int tagset[2];
</a><a href="#h11-0-124" id="h11-0-124" class="i">+	int showbar;
</a><a href="#h11-0-125" id="h11-0-125" class="i">+	int topbar;
</a><a href="#h11-0-126" id="h11-0-126" class="i">+	Client *clients;
</a><a href="#h11-0-127" id="h11-0-127" class="i">+	Client *sel;
</a><a href="#h11-0-128" id="h11-0-128" class="i">+	Client *stack;
</a><a href="#h11-0-129" id="h11-0-129" class="i">+	Monitor *next;
</a><a href="#h11-0-130" id="h11-0-130" class="i">+	Window barwin;
</a><a href="#h11-0-131" id="h11-0-131" class="i">+	const Layout *lt[2];
</a><a href="#h11-0-132" id="h11-0-132" class="i">+};
</a><a href="#h11-0-133" id="h11-0-133" class="i">+
</a><a href="#h11-0-134" id="h11-0-134" class="i">+typedef struct {
</a><a href="#h11-0-135" id="h11-0-135" class="i">+	const char *class;
</a><a href="#h11-0-136" id="h11-0-136" class="i">+	const char *instance;
</a><a href="#h11-0-137" id="h11-0-137" class="i">+	const char *title;
</a><a href="#h11-0-138" id="h11-0-138" class="i">+	unsigned int tags;
</a><a href="#h11-0-139" id="h11-0-139" class="i">+	int isfloating;
</a><a href="#h11-0-140" id="h11-0-140" class="i">+	int monitor;
</a><a href="#h11-0-141" id="h11-0-141" class="i">+} Rule;
</a><a href="#h11-0-142" id="h11-0-142" class="i">+
</a><a href="#h11-0-143" id="h11-0-143" class="i">+/* function declarations */
</a><a href="#h11-0-144" id="h11-0-144" class="i">+static void applyrules(Client *c);
</a><a href="#h11-0-145" id="h11-0-145" class="i">+static int applysizehints(Client *c, int *x, int *y, int *w, int *h, int interact);
</a><a href="#h11-0-146" id="h11-0-146" class="i">+static void arrange(Monitor *m);
</a><a href="#h11-0-147" id="h11-0-147" class="i">+static void arrangemon(Monitor *m);
</a><a href="#h11-0-148" id="h11-0-148" class="i">+static void attach(Client *c);
</a><a href="#h11-0-149" id="h11-0-149" class="i">+static void attachstack(Client *c);
</a><a href="#h11-0-150" id="h11-0-150" class="i">+static void buttonpress(XEvent *e);
</a><a href="#h11-0-151" id="h11-0-151" class="i">+static void checkotherwm(void);
</a><a href="#h11-0-152" id="h11-0-152" class="i">+static void cleanup(void);
</a><a href="#h11-0-153" id="h11-0-153" class="i">+static void cleanupmon(Monitor *mon);
</a><a href="#h11-0-154" id="h11-0-154" class="i">+static void clientmessage(XEvent *e);
</a><a href="#h11-0-155" id="h11-0-155" class="i">+static void configure(Client *c);
</a><a href="#h11-0-156" id="h11-0-156" class="i">+static void configurenotify(XEvent *e);
</a><a href="#h11-0-157" id="h11-0-157" class="i">+static void configurerequest(XEvent *e);
</a><a href="#h11-0-158" id="h11-0-158" class="i">+static Monitor *createmon(void);
</a><a href="#h11-0-159" id="h11-0-159" class="i">+static void destroynotify(XEvent *e);
</a><a href="#h11-0-160" id="h11-0-160" class="i">+static void detach(Client *c);
</a><a href="#h11-0-161" id="h11-0-161" class="i">+static void detachstack(Client *c);
</a><a href="#h11-0-162" id="h11-0-162" class="i">+static Monitor *dirtomon(int dir);
</a><a href="#h11-0-163" id="h11-0-163" class="i">+static void drawbar(Monitor *m);
</a><a href="#h11-0-164" id="h11-0-164" class="i">+static void drawbars(void);
</a><a href="#h11-0-165" id="h11-0-165" class="i">+static void enternotify(XEvent *e);
</a><a href="#h11-0-166" id="h11-0-166" class="i">+static void expose(XEvent *e);
</a><a href="#h11-0-167" id="h11-0-167" class="i">+static void focus(Client *c);
</a><a href="#h11-0-168" id="h11-0-168" class="i">+static void focusin(XEvent *e);
</a><a href="#h11-0-169" id="h11-0-169" class="i">+static void focusmon(const Arg *arg);
</a><a href="#h11-0-170" id="h11-0-170" class="i">+static void focusstack(const Arg *arg);
</a><a href="#h11-0-171" id="h11-0-171" class="i">+static int getrootptr(int *x, int *y);
</a><a href="#h11-0-172" id="h11-0-172" class="i">+static long getstate(Window w);
</a><a href="#h11-0-173" id="h11-0-173" class="i">+static int gettextprop(Window w, Atom atom, char *text, unsigned int size);
</a><a href="#h11-0-174" id="h11-0-174" class="i">+static void grabbuttons(Client *c, int focused);
</a><a href="#h11-0-175" id="h11-0-175" class="i">+static void grabkeys(void);
</a><a href="#h11-0-176" id="h11-0-176" class="i">+static void incnmaster(const Arg *arg);
</a><a href="#h11-0-177" id="h11-0-177" class="i">+static void keypress(XEvent *e);
</a><a href="#h11-0-178" id="h11-0-178" class="i">+static void killclient(const Arg *arg);
</a><a href="#h11-0-179" id="h11-0-179" class="i">+static void manage(Window w, XWindowAttributes *wa);
</a><a href="#h11-0-180" id="h11-0-180" class="i">+static void mappingnotify(XEvent *e);
</a><a href="#h11-0-181" id="h11-0-181" class="i">+static void maprequest(XEvent *e);
</a><a href="#h11-0-182" id="h11-0-182" class="i">+static void monocle(Monitor *m);
</a><a href="#h11-0-183" id="h11-0-183" class="i">+static void motionnotify(XEvent *e);
</a><a href="#h11-0-184" id="h11-0-184" class="i">+static void movemouse(const Arg *arg);
</a><a href="#h11-0-185" id="h11-0-185" class="i">+static Client *nexttiled(Client *c);
</a><a href="#h11-0-186" id="h11-0-186" class="i">+static void pop(Client *);
</a><a href="#h11-0-187" id="h11-0-187" class="i">+static void propertynotify(XEvent *e);
</a><a href="#h11-0-188" id="h11-0-188" class="i">+static void quit(const Arg *arg);
</a><a href="#h11-0-189" id="h11-0-189" class="i">+static Monitor *recttomon(int x, int y, int w, int h);
</a><a href="#h11-0-190" id="h11-0-190" class="i">+static void resize(Client *c, int x, int y, int w, int h, int interact);
</a><a href="#h11-0-191" id="h11-0-191" class="i">+static void resizeclient(Client *c, int x, int y, int w, int h);
</a><a href="#h11-0-192" id="h11-0-192" class="i">+static void resizemouse(const Arg *arg);
</a><a href="#h11-0-193" id="h11-0-193" class="i">+static void restack(Monitor *m);
</a><a href="#h11-0-194" id="h11-0-194" class="i">+static void run(void);
</a><a href="#h11-0-195" id="h11-0-195" class="i">+static void scan(void);
</a><a href="#h11-0-196" id="h11-0-196" class="i">+static int sendevent(Client *c, Atom proto);
</a><a href="#h11-0-197" id="h11-0-197" class="i">+static void sendmon(Client *c, Monitor *m);
</a><a href="#h11-0-198" id="h11-0-198" class="i">+static void setclientstate(Client *c, long state);
</a><a href="#h11-0-199" id="h11-0-199" class="i">+static void setfocus(Client *c);
</a><a href="#h11-0-200" id="h11-0-200" class="i">+static void setfullscreen(Client *c, int fullscreen);
</a><a href="#h11-0-201" id="h11-0-201" class="i">+static void setlayout(const Arg *arg);
</a><a href="#h11-0-202" id="h11-0-202" class="i">+static void setmfact(const Arg *arg);
</a><a href="#h11-0-203" id="h11-0-203" class="i">+static void setup(void);
</a><a href="#h11-0-204" id="h11-0-204" class="i">+static void seturgent(Client *c, int urg);
</a><a href="#h11-0-205" id="h11-0-205" class="i">+static void showhide(Client *c);
</a><a href="#h11-0-206" id="h11-0-206" class="i">+static void sigchld(int unused);
</a><a href="#h11-0-207" id="h11-0-207" class="i">+static void spawn(const Arg *arg);
</a><a href="#h11-0-208" id="h11-0-208" class="i">+static void tag(const Arg *arg);
</a><a href="#h11-0-209" id="h11-0-209" class="i">+static void tagmon(const Arg *arg);
</a><a href="#h11-0-210" id="h11-0-210" class="i">+static void tile(Monitor *);
</a><a href="#h11-0-211" id="h11-0-211" class="i">+static void togglebar(const Arg *arg);
</a><a href="#h11-0-212" id="h11-0-212" class="i">+static void togglefloating(const Arg *arg);
</a><a href="#h11-0-213" id="h11-0-213" class="i">+static void toggletag(const Arg *arg);
</a><a href="#h11-0-214" id="h11-0-214" class="i">+static void toggleview(const Arg *arg);
</a><a href="#h11-0-215" id="h11-0-215" class="i">+static void unfocus(Client *c, int setfocus);
</a><a href="#h11-0-216" id="h11-0-216" class="i">+static void unmanage(Client *c, int destroyed);
</a><a href="#h11-0-217" id="h11-0-217" class="i">+static void unmapnotify(XEvent *e);
</a><a href="#h11-0-218" id="h11-0-218" class="i">+static void updatebarpos(Monitor *m);
</a><a href="#h11-0-219" id="h11-0-219" class="i">+static void updatebars(void);
</a><a href="#h11-0-220" id="h11-0-220" class="i">+static void updateclientlist(void);
</a><a href="#h11-0-221" id="h11-0-221" class="i">+static int updategeom(void);
</a><a href="#h11-0-222" id="h11-0-222" class="i">+static void updatenumlockmask(void);
</a><a href="#h11-0-223" id="h11-0-223" class="i">+static void updatesizehints(Client *c);
</a><a href="#h11-0-224" id="h11-0-224" class="i">+static void updatestatus(void);
</a><a href="#h11-0-225" id="h11-0-225" class="i">+static void updatetitle(Client *c);
</a><a href="#h11-0-226" id="h11-0-226" class="i">+static void updatewindowtype(Client *c);
</a><a href="#h11-0-227" id="h11-0-227" class="i">+static void updatewmhints(Client *c);
</a><a href="#h11-0-228" id="h11-0-228" class="i">+static void view(const Arg *arg);
</a><a href="#h11-0-229" id="h11-0-229" class="i">+static Client *wintoclient(Window w);
</a><a href="#h11-0-230" id="h11-0-230" class="i">+static Monitor *wintomon(Window w);
</a><a href="#h11-0-231" id="h11-0-231" class="i">+static int xerror(Display *dpy, XErrorEvent *ee);
</a><a href="#h11-0-232" id="h11-0-232" class="i">+static int xerrordummy(Display *dpy, XErrorEvent *ee);
</a><a href="#h11-0-233" id="h11-0-233" class="i">+static int xerrorstart(Display *dpy, XErrorEvent *ee);
</a><a href="#h11-0-234" id="h11-0-234" class="i">+static void zoom(const Arg *arg);
</a><a href="#h11-0-235" id="h11-0-235" class="i">+
</a><a href="#h11-0-236" id="h11-0-236" class="i">+/* variables */
</a><a href="#h11-0-237" id="h11-0-237" class="i">+static const char broken[] = &quot;broken&quot;;
</a><a href="#h11-0-238" id="h11-0-238" class="i">+static char stext[256];
</a><a href="#h11-0-239" id="h11-0-239" class="i">+static int screen;
</a><a href="#h11-0-240" id="h11-0-240" class="i">+static int sw, sh;           /* X display screen geometry width, height */
</a><a href="#h11-0-241" id="h11-0-241" class="i">+static int bh, blw = 0;      /* bar geometry */
</a><a href="#h11-0-242" id="h11-0-242" class="i">+static int lrpad;            /* sum of left and right padding for text */
</a><a href="#h11-0-243" id="h11-0-243" class="i">+static int (*xerrorxlib)(Display *, XErrorEvent *);
</a><a href="#h11-0-244" id="h11-0-244" class="i">+static unsigned int numlockmask = 0;
</a><a href="#h11-0-245" id="h11-0-245" class="i">+static void (*handler[LASTEvent]) (XEvent *) = {
</a><a href="#h11-0-246" id="h11-0-246" class="i">+	[ButtonPress] = buttonpress,
</a><a href="#h11-0-247" id="h11-0-247" class="i">+	[ClientMessage] = clientmessage,
</a><a href="#h11-0-248" id="h11-0-248" class="i">+	[ConfigureRequest] = configurerequest,
</a><a href="#h11-0-249" id="h11-0-249" class="i">+	[ConfigureNotify] = configurenotify,
</a><a href="#h11-0-250" id="h11-0-250" class="i">+	[DestroyNotify] = destroynotify,
</a><a href="#h11-0-251" id="h11-0-251" class="i">+	[EnterNotify] = enternotify,
</a><a href="#h11-0-252" id="h11-0-252" class="i">+	[Expose] = expose,
</a><a href="#h11-0-253" id="h11-0-253" class="i">+	[FocusIn] = focusin,
</a><a href="#h11-0-254" id="h11-0-254" class="i">+	[KeyPress] = keypress,
</a><a href="#h11-0-255" id="h11-0-255" class="i">+	[MappingNotify] = mappingnotify,
</a><a href="#h11-0-256" id="h11-0-256" class="i">+	[MapRequest] = maprequest,
</a><a href="#h11-0-257" id="h11-0-257" class="i">+	[MotionNotify] = motionnotify,
</a><a href="#h11-0-258" id="h11-0-258" class="i">+	[PropertyNotify] = propertynotify,
</a><a href="#h11-0-259" id="h11-0-259" class="i">+	[UnmapNotify] = unmapnotify
</a><a href="#h11-0-260" id="h11-0-260" class="i">+};
</a><a href="#h11-0-261" id="h11-0-261" class="i">+static Atom wmatom[WMLast], netatom[NetLast];
</a><a href="#h11-0-262" id="h11-0-262" class="i">+static int running = 1;
</a><a href="#h11-0-263" id="h11-0-263" class="i">+static Cur *cursor[CurLast];
</a><a href="#h11-0-264" id="h11-0-264" class="i">+static Clr **scheme;
</a><a href="#h11-0-265" id="h11-0-265" class="i">+static Display *dpy;
</a><a href="#h11-0-266" id="h11-0-266" class="i">+static Drw *drw;
</a><a href="#h11-0-267" id="h11-0-267" class="i">+static Monitor *mons, *selmon;
</a><a href="#h11-0-268" id="h11-0-268" class="i">+static Window root, wmcheckwin;
</a><a href="#h11-0-269" id="h11-0-269" class="i">+
</a><a href="#h11-0-270" id="h11-0-270" class="i">+/* configuration, allows nested code to access above variables */
</a><a href="#h11-0-271" id="h11-0-271" class="i">+#include &quot;config.h&quot;
</a><a href="#h11-0-272" id="h11-0-272" class="i">+
</a><a href="#h11-0-273" id="h11-0-273" class="i">+/* compile-time check if all tags fit into an unsigned int bit array. */
</a><a href="#h11-0-274" id="h11-0-274" class="i">+struct NumTags { char limitexceeded[LENGTH(tags) &gt; 31 ? -1 : 1]; };
</a><a href="#h11-0-275" id="h11-0-275" class="i">+
</a><a href="#h11-0-276" id="h11-0-276" class="i">+/* function implementations */
</a><a href="#h11-0-277" id="h11-0-277" class="i">+void
</a><a href="#h11-0-278" id="h11-0-278" class="i">+applyrules(Client *c)
</a><a href="#h11-0-279" id="h11-0-279" class="i">+{
</a><a href="#h11-0-280" id="h11-0-280" class="i">+	const char *class, *instance;
</a><a href="#h11-0-281" id="h11-0-281" class="i">+	unsigned int i;
</a><a href="#h11-0-282" id="h11-0-282" class="i">+	const Rule *r;
</a><a href="#h11-0-283" id="h11-0-283" class="i">+	Monitor *m;
</a><a href="#h11-0-284" id="h11-0-284" class="i">+	XClassHint ch = { NULL, NULL };
</a><a href="#h11-0-285" id="h11-0-285" class="i">+
</a><a href="#h11-0-286" id="h11-0-286" class="i">+	/* rule matching */
</a><a href="#h11-0-287" id="h11-0-287" class="i">+	c-&gt;isfloating = 0;
</a><a href="#h11-0-288" id="h11-0-288" class="i">+	c-&gt;tags = 0;
</a><a href="#h11-0-289" id="h11-0-289" class="i">+	XGetClassHint(dpy, c-&gt;win, &amp;ch);
</a><a href="#h11-0-290" id="h11-0-290" class="i">+	class    = ch.res_class ? ch.res_class : broken;
</a><a href="#h11-0-291" id="h11-0-291" class="i">+	instance = ch.res_name  ? ch.res_name  : broken;
</a><a href="#h11-0-292" id="h11-0-292" class="i">+
</a><a href="#h11-0-293" id="h11-0-293" class="i">+	for (i = 0; i &lt; LENGTH(rules); i++) {
</a><a href="#h11-0-294" id="h11-0-294" class="i">+		r = &amp;rules[i];
</a><a href="#h11-0-295" id="h11-0-295" class="i">+		if ((!r-&gt;title || strstr(c-&gt;name, r-&gt;title))
</a><a href="#h11-0-296" id="h11-0-296" class="i">+		&amp;&amp; (!r-&gt;class || strstr(class, r-&gt;class))
</a><a href="#h11-0-297" id="h11-0-297" class="i">+		&amp;&amp; (!r-&gt;instance || strstr(instance, r-&gt;instance)))
</a><a href="#h11-0-298" id="h11-0-298" class="i">+		{
</a><a href="#h11-0-299" id="h11-0-299" class="i">+			c-&gt;isfloating = r-&gt;isfloating;
</a><a href="#h11-0-300" id="h11-0-300" class="i">+			c-&gt;tags |= r-&gt;tags;
</a><a href="#h11-0-301" id="h11-0-301" class="i">+			for (m = mons; m &amp;&amp; m-&gt;num != r-&gt;monitor; m = m-&gt;next);
</a><a href="#h11-0-302" id="h11-0-302" class="i">+			if (m)
</a><a href="#h11-0-303" id="h11-0-303" class="i">+				c-&gt;mon = m;
</a><a href="#h11-0-304" id="h11-0-304" class="i">+		}
</a><a href="#h11-0-305" id="h11-0-305" class="i">+	}
</a><a href="#h11-0-306" id="h11-0-306" class="i">+	if (ch.res_class)
</a><a href="#h11-0-307" id="h11-0-307" class="i">+		XFree(ch.res_class);
</a><a href="#h11-0-308" id="h11-0-308" class="i">+	if (ch.res_name)
</a><a href="#h11-0-309" id="h11-0-309" class="i">+		XFree(ch.res_name);
</a><a href="#h11-0-310" id="h11-0-310" class="i">+	c-&gt;tags = c-&gt;tags &amp; TAGMASK ? c-&gt;tags &amp; TAGMASK : c-&gt;mon-&gt;tagset[c-&gt;mon-&gt;seltags];
</a><a href="#h11-0-311" id="h11-0-311" class="i">+}
</a><a href="#h11-0-312" id="h11-0-312" class="i">+
</a><a href="#h11-0-313" id="h11-0-313" class="i">+int
</a><a href="#h11-0-314" id="h11-0-314" class="i">+applysizehints(Client *c, int *x, int *y, int *w, int *h, int interact)
</a><a href="#h11-0-315" id="h11-0-315" class="i">+{
</a><a href="#h11-0-316" id="h11-0-316" class="i">+	int baseismin;
</a><a href="#h11-0-317" id="h11-0-317" class="i">+	Monitor *m = c-&gt;mon;
</a><a href="#h11-0-318" id="h11-0-318" class="i">+
</a><a href="#h11-0-319" id="h11-0-319" class="i">+	/* set minimum possible */
</a><a href="#h11-0-320" id="h11-0-320" class="i">+	*w = MAX(1, *w);
</a><a href="#h11-0-321" id="h11-0-321" class="i">+	*h = MAX(1, *h);
</a><a href="#h11-0-322" id="h11-0-322" class="i">+	if (interact) {
</a><a href="#h11-0-323" id="h11-0-323" class="i">+		if (*x &gt; sw)
</a><a href="#h11-0-324" id="h11-0-324" class="i">+			*x = sw - WIDTH(c);
</a><a href="#h11-0-325" id="h11-0-325" class="i">+		if (*y &gt; sh)
</a><a href="#h11-0-326" id="h11-0-326" class="i">+			*y = sh - HEIGHT(c);
</a><a href="#h11-0-327" id="h11-0-327" class="i">+		if (*x + *w + 2 * c-&gt;bw &lt; 0)
</a><a href="#h11-0-328" id="h11-0-328" class="i">+			*x = 0;
</a><a href="#h11-0-329" id="h11-0-329" class="i">+		if (*y + *h + 2 * c-&gt;bw &lt; 0)
</a><a href="#h11-0-330" id="h11-0-330" class="i">+			*y = 0;
</a><a href="#h11-0-331" id="h11-0-331" class="i">+	} else {
</a><a href="#h11-0-332" id="h11-0-332" class="i">+		if (*x &gt;= m-&gt;wx + m-&gt;ww)
</a><a href="#h11-0-333" id="h11-0-333" class="i">+			*x = m-&gt;wx + m-&gt;ww - WIDTH(c);
</a><a href="#h11-0-334" id="h11-0-334" class="i">+		if (*y &gt;= m-&gt;wy + m-&gt;wh)
</a><a href="#h11-0-335" id="h11-0-335" class="i">+			*y = m-&gt;wy + m-&gt;wh - HEIGHT(c);
</a><a href="#h11-0-336" id="h11-0-336" class="i">+		if (*x + *w + 2 * c-&gt;bw &lt;= m-&gt;wx)
</a><a href="#h11-0-337" id="h11-0-337" class="i">+			*x = m-&gt;wx;
</a><a href="#h11-0-338" id="h11-0-338" class="i">+		if (*y + *h + 2 * c-&gt;bw &lt;= m-&gt;wy)
</a><a href="#h11-0-339" id="h11-0-339" class="i">+			*y = m-&gt;wy;
</a><a href="#h11-0-340" id="h11-0-340" class="i">+	}
</a><a href="#h11-0-341" id="h11-0-341" class="i">+	if (*h &lt; bh)
</a><a href="#h11-0-342" id="h11-0-342" class="i">+		*h = bh;
</a><a href="#h11-0-343" id="h11-0-343" class="i">+	if (*w &lt; bh)
</a><a href="#h11-0-344" id="h11-0-344" class="i">+		*w = bh;
</a><a href="#h11-0-345" id="h11-0-345" class="i">+	if (resizehints || c-&gt;isfloating || !c-&gt;mon-&gt;lt[c-&gt;mon-&gt;sellt]-&gt;arrange) {
</a><a href="#h11-0-346" id="h11-0-346" class="i">+		/* see last two sentences in ICCCM 4.1.2.3 */
</a><a href="#h11-0-347" id="h11-0-347" class="i">+		baseismin = c-&gt;basew == c-&gt;minw &amp;&amp; c-&gt;baseh == c-&gt;minh;
</a><a href="#h11-0-348" id="h11-0-348" class="i">+		if (!baseismin) { /* temporarily remove base dimensions */
</a><a href="#h11-0-349" id="h11-0-349" class="i">+			*w -= c-&gt;basew;
</a><a href="#h11-0-350" id="h11-0-350" class="i">+			*h -= c-&gt;baseh;
</a><a href="#h11-0-351" id="h11-0-351" class="i">+		}
</a><a href="#h11-0-352" id="h11-0-352" class="i">+		/* adjust for aspect limits */
</a><a href="#h11-0-353" id="h11-0-353" class="i">+		if (c-&gt;mina &gt; 0 &amp;&amp; c-&gt;maxa &gt; 0) {
</a><a href="#h11-0-354" id="h11-0-354" class="i">+			if (c-&gt;maxa &lt; (float)*w / *h)
</a><a href="#h11-0-355" id="h11-0-355" class="i">+				*w = *h * c-&gt;maxa + 0.5;
</a><a href="#h11-0-356" id="h11-0-356" class="i">+			else if (c-&gt;mina &lt; (float)*h / *w)
</a><a href="#h11-0-357" id="h11-0-357" class="i">+				*h = *w * c-&gt;mina + 0.5;
</a><a href="#h11-0-358" id="h11-0-358" class="i">+		}
</a><a href="#h11-0-359" id="h11-0-359" class="i">+		if (baseismin) { /* increment calculation requires this */
</a><a href="#h11-0-360" id="h11-0-360" class="i">+			*w -= c-&gt;basew;
</a><a href="#h11-0-361" id="h11-0-361" class="i">+			*h -= c-&gt;baseh;
</a><a href="#h11-0-362" id="h11-0-362" class="i">+		}
</a><a href="#h11-0-363" id="h11-0-363" class="i">+		/* adjust for increment value */
</a><a href="#h11-0-364" id="h11-0-364" class="i">+		if (c-&gt;incw)
</a><a href="#h11-0-365" id="h11-0-365" class="i">+			*w -= *w % c-&gt;incw;
</a><a href="#h11-0-366" id="h11-0-366" class="i">+		if (c-&gt;inch)
</a><a href="#h11-0-367" id="h11-0-367" class="i">+			*h -= *h % c-&gt;inch;
</a><a href="#h11-0-368" id="h11-0-368" class="i">+		/* restore base dimensions */
</a><a href="#h11-0-369" id="h11-0-369" class="i">+		*w = MAX(*w + c-&gt;basew, c-&gt;minw);
</a><a href="#h11-0-370" id="h11-0-370" class="i">+		*h = MAX(*h + c-&gt;baseh, c-&gt;minh);
</a><a href="#h11-0-371" id="h11-0-371" class="i">+		if (c-&gt;maxw)
</a><a href="#h11-0-372" id="h11-0-372" class="i">+			*w = MIN(*w, c-&gt;maxw);
</a><a href="#h11-0-373" id="h11-0-373" class="i">+		if (c-&gt;maxh)
</a><a href="#h11-0-374" id="h11-0-374" class="i">+			*h = MIN(*h, c-&gt;maxh);
</a><a href="#h11-0-375" id="h11-0-375" class="i">+	}
</a><a href="#h11-0-376" id="h11-0-376" class="i">+	return *x != c-&gt;x || *y != c-&gt;y || *w != c-&gt;w || *h != c-&gt;h;
</a><a href="#h11-0-377" id="h11-0-377" class="i">+}
</a><a href="#h11-0-378" id="h11-0-378" class="i">+
</a><a href="#h11-0-379" id="h11-0-379" class="i">+void
</a><a href="#h11-0-380" id="h11-0-380" class="i">+arrange(Monitor *m)
</a><a href="#h11-0-381" id="h11-0-381" class="i">+{
</a><a href="#h11-0-382" id="h11-0-382" class="i">+	if (m)
</a><a href="#h11-0-383" id="h11-0-383" class="i">+		showhide(m-&gt;stack);
</a><a href="#h11-0-384" id="h11-0-384" class="i">+	else for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-385" id="h11-0-385" class="i">+		showhide(m-&gt;stack);
</a><a href="#h11-0-386" id="h11-0-386" class="i">+	if (m) {
</a><a href="#h11-0-387" id="h11-0-387" class="i">+		arrangemon(m);
</a><a href="#h11-0-388" id="h11-0-388" class="i">+		restack(m);
</a><a href="#h11-0-389" id="h11-0-389" class="i">+	} else for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-390" id="h11-0-390" class="i">+		arrangemon(m);
</a><a href="#h11-0-391" id="h11-0-391" class="i">+}
</a><a href="#h11-0-392" id="h11-0-392" class="i">+
</a><a href="#h11-0-393" id="h11-0-393" class="i">+void
</a><a href="#h11-0-394" id="h11-0-394" class="i">+arrangemon(Monitor *m)
</a><a href="#h11-0-395" id="h11-0-395" class="i">+{
</a><a href="#h11-0-396" id="h11-0-396" class="i">+	strncpy(m-&gt;ltsymbol, m-&gt;lt[m-&gt;sellt]-&gt;symbol, sizeof m-&gt;ltsymbol);
</a><a href="#h11-0-397" id="h11-0-397" class="i">+	if (m-&gt;lt[m-&gt;sellt]-&gt;arrange)
</a><a href="#h11-0-398" id="h11-0-398" class="i">+		m-&gt;lt[m-&gt;sellt]-&gt;arrange(m);
</a><a href="#h11-0-399" id="h11-0-399" class="i">+}
</a><a href="#h11-0-400" id="h11-0-400" class="i">+
</a><a href="#h11-0-401" id="h11-0-401" class="i">+void
</a><a href="#h11-0-402" id="h11-0-402" class="i">+attach(Client *c)
</a><a href="#h11-0-403" id="h11-0-403" class="i">+{
</a><a href="#h11-0-404" id="h11-0-404" class="i">+	c-&gt;next = c-&gt;mon-&gt;clients;
</a><a href="#h11-0-405" id="h11-0-405" class="i">+	c-&gt;mon-&gt;clients = c;
</a><a href="#h11-0-406" id="h11-0-406" class="i">+}
</a><a href="#h11-0-407" id="h11-0-407" class="i">+
</a><a href="#h11-0-408" id="h11-0-408" class="i">+void
</a><a href="#h11-0-409" id="h11-0-409" class="i">+attachstack(Client *c)
</a><a href="#h11-0-410" id="h11-0-410" class="i">+{
</a><a href="#h11-0-411" id="h11-0-411" class="i">+	c-&gt;snext = c-&gt;mon-&gt;stack;
</a><a href="#h11-0-412" id="h11-0-412" class="i">+	c-&gt;mon-&gt;stack = c;
</a><a href="#h11-0-413" id="h11-0-413" class="i">+}
</a><a href="#h11-0-414" id="h11-0-414" class="i">+
</a><a href="#h11-0-415" id="h11-0-415" class="i">+void
</a><a href="#h11-0-416" id="h11-0-416" class="i">+buttonpress(XEvent *e)
</a><a href="#h11-0-417" id="h11-0-417" class="i">+{
</a><a href="#h11-0-418" id="h11-0-418" class="i">+	unsigned int i, x, click;
</a><a href="#h11-0-419" id="h11-0-419" class="i">+	Arg arg = {0};
</a><a href="#h11-0-420" id="h11-0-420" class="i">+	Client *c;
</a><a href="#h11-0-421" id="h11-0-421" class="i">+	Monitor *m;
</a><a href="#h11-0-422" id="h11-0-422" class="i">+	XButtonPressedEvent *ev = &amp;e-&gt;xbutton;
</a><a href="#h11-0-423" id="h11-0-423" class="i">+
</a><a href="#h11-0-424" id="h11-0-424" class="i">+	click = ClkRootWin;
</a><a href="#h11-0-425" id="h11-0-425" class="i">+	/* focus monitor if necessary */
</a><a href="#h11-0-426" id="h11-0-426" class="i">+	if ((m = wintomon(ev-&gt;window)) &amp;&amp; m != selmon) {
</a><a href="#h11-0-427" id="h11-0-427" class="i">+		unfocus(selmon-&gt;sel, 1);
</a><a href="#h11-0-428" id="h11-0-428" class="i">+		selmon = m;
</a><a href="#h11-0-429" id="h11-0-429" class="i">+		focus(NULL);
</a><a href="#h11-0-430" id="h11-0-430" class="i">+	}
</a><a href="#h11-0-431" id="h11-0-431" class="i">+	if (ev-&gt;window == selmon-&gt;barwin) {
</a><a href="#h11-0-432" id="h11-0-432" class="i">+		i = x = 0;
</a><a href="#h11-0-433" id="h11-0-433" class="i">+		do
</a><a href="#h11-0-434" id="h11-0-434" class="i">+			x += TEXTW(tags[i]);
</a><a href="#h11-0-435" id="h11-0-435" class="i">+		while (ev-&gt;x &gt;= x &amp;&amp; ++i &lt; LENGTH(tags));
</a><a href="#h11-0-436" id="h11-0-436" class="i">+		if (i &lt; LENGTH(tags)) {
</a><a href="#h11-0-437" id="h11-0-437" class="i">+			click = ClkTagBar;
</a><a href="#h11-0-438" id="h11-0-438" class="i">+			arg.ui = 1 &lt;&lt; i;
</a><a href="#h11-0-439" id="h11-0-439" class="i">+		} else if (ev-&gt;x &lt; x + blw)
</a><a href="#h11-0-440" id="h11-0-440" class="i">+			click = ClkLtSymbol;
</a><a href="#h11-0-441" id="h11-0-441" class="i">+		else if (ev-&gt;x &gt; selmon-&gt;ww - TEXTW(stext))
</a><a href="#h11-0-442" id="h11-0-442" class="i">+			click = ClkStatusText;
</a><a href="#h11-0-443" id="h11-0-443" class="i">+		else
</a><a href="#h11-0-444" id="h11-0-444" class="i">+			click = ClkWinTitle;
</a><a href="#h11-0-445" id="h11-0-445" class="i">+	} else if ((c = wintoclient(ev-&gt;window))) {
</a><a href="#h11-0-446" id="h11-0-446" class="i">+		focus(c);
</a><a href="#h11-0-447" id="h11-0-447" class="i">+		restack(selmon);
</a><a href="#h11-0-448" id="h11-0-448" class="i">+		XAllowEvents(dpy, ReplayPointer, CurrentTime);
</a><a href="#h11-0-449" id="h11-0-449" class="i">+		click = ClkClientWin;
</a><a href="#h11-0-450" id="h11-0-450" class="i">+	}
</a><a href="#h11-0-451" id="h11-0-451" class="i">+	for (i = 0; i &lt; LENGTH(buttons); i++)
</a><a href="#h11-0-452" id="h11-0-452" class="i">+		if (click == buttons[i].click &amp;&amp; buttons[i].func &amp;&amp; buttons[i].button == ev-&gt;button
</a><a href="#h11-0-453" id="h11-0-453" class="i">+		&amp;&amp; CLEANMASK(buttons[i].mask) == CLEANMASK(ev-&gt;state))
</a><a href="#h11-0-454" id="h11-0-454" class="i">+			buttons[i].func(click == ClkTagBar &amp;&amp; buttons[i].arg.i == 0 ? &amp;arg : &amp;buttons[i].arg);
</a><a href="#h11-0-455" id="h11-0-455" class="i">+}
</a><a href="#h11-0-456" id="h11-0-456" class="i">+
</a><a href="#h11-0-457" id="h11-0-457" class="i">+void
</a><a href="#h11-0-458" id="h11-0-458" class="i">+checkotherwm(void)
</a><a href="#h11-0-459" id="h11-0-459" class="i">+{
</a><a href="#h11-0-460" id="h11-0-460" class="i">+	xerrorxlib = XSetErrorHandler(xerrorstart);
</a><a href="#h11-0-461" id="h11-0-461" class="i">+	/* this causes an error if some other window manager is running */
</a><a href="#h11-0-462" id="h11-0-462" class="i">+	XSelectInput(dpy, DefaultRootWindow(dpy), SubstructureRedirectMask);
</a><a href="#h11-0-463" id="h11-0-463" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-464" id="h11-0-464" class="i">+	XSetErrorHandler(xerror);
</a><a href="#h11-0-465" id="h11-0-465" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-466" id="h11-0-466" class="i">+}
</a><a href="#h11-0-467" id="h11-0-467" class="i">+
</a><a href="#h11-0-468" id="h11-0-468" class="i">+void
</a><a href="#h11-0-469" id="h11-0-469" class="i">+cleanup(void)
</a><a href="#h11-0-470" id="h11-0-470" class="i">+{
</a><a href="#h11-0-471" id="h11-0-471" class="i">+	Arg a = {.ui = ~0};
</a><a href="#h11-0-472" id="h11-0-472" class="i">+	Layout foo = { &quot;&quot;, NULL };
</a><a href="#h11-0-473" id="h11-0-473" class="i">+	Monitor *m;
</a><a href="#h11-0-474" id="h11-0-474" class="i">+	size_t i;
</a><a href="#h11-0-475" id="h11-0-475" class="i">+
</a><a href="#h11-0-476" id="h11-0-476" class="i">+	view(&amp;a);
</a><a href="#h11-0-477" id="h11-0-477" class="i">+	selmon-&gt;lt[selmon-&gt;sellt] = &amp;foo;
</a><a href="#h11-0-478" id="h11-0-478" class="i">+	for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-479" id="h11-0-479" class="i">+		while (m-&gt;stack)
</a><a href="#h11-0-480" id="h11-0-480" class="i">+			unmanage(m-&gt;stack, 0);
</a><a href="#h11-0-481" id="h11-0-481" class="i">+	XUngrabKey(dpy, AnyKey, AnyModifier, root);
</a><a href="#h11-0-482" id="h11-0-482" class="i">+	while (mons)
</a><a href="#h11-0-483" id="h11-0-483" class="i">+		cleanupmon(mons);
</a><a href="#h11-0-484" id="h11-0-484" class="i">+	for (i = 0; i &lt; CurLast; i++)
</a><a href="#h11-0-485" id="h11-0-485" class="i">+		drw_cur_free(drw, cursor[i]);
</a><a href="#h11-0-486" id="h11-0-486" class="i">+	for (i = 0; i &lt; LENGTH(colors); i++)
</a><a href="#h11-0-487" id="h11-0-487" class="i">+		free(scheme[i]);
</a><a href="#h11-0-488" id="h11-0-488" class="i">+	XDestroyWindow(dpy, wmcheckwin);
</a><a href="#h11-0-489" id="h11-0-489" class="i">+	drw_free(drw);
</a><a href="#h11-0-490" id="h11-0-490" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-491" id="h11-0-491" class="i">+	XSetInputFocus(dpy, PointerRoot, RevertToPointerRoot, CurrentTime);
</a><a href="#h11-0-492" id="h11-0-492" class="i">+	XDeleteProperty(dpy, root, netatom[NetActiveWindow]);
</a><a href="#h11-0-493" id="h11-0-493" class="i">+}
</a><a href="#h11-0-494" id="h11-0-494" class="i">+
</a><a href="#h11-0-495" id="h11-0-495" class="i">+void
</a><a href="#h11-0-496" id="h11-0-496" class="i">+cleanupmon(Monitor *mon)
</a><a href="#h11-0-497" id="h11-0-497" class="i">+{
</a><a href="#h11-0-498" id="h11-0-498" class="i">+	Monitor *m;
</a><a href="#h11-0-499" id="h11-0-499" class="i">+
</a><a href="#h11-0-500" id="h11-0-500" class="i">+	if (mon == mons)
</a><a href="#h11-0-501" id="h11-0-501" class="i">+		mons = mons-&gt;next;
</a><a href="#h11-0-502" id="h11-0-502" class="i">+	else {
</a><a href="#h11-0-503" id="h11-0-503" class="i">+		for (m = mons; m &amp;&amp; m-&gt;next != mon; m = m-&gt;next);
</a><a href="#h11-0-504" id="h11-0-504" class="i">+		m-&gt;next = mon-&gt;next;
</a><a href="#h11-0-505" id="h11-0-505" class="i">+	}
</a><a href="#h11-0-506" id="h11-0-506" class="i">+	XUnmapWindow(dpy, mon-&gt;barwin);
</a><a href="#h11-0-507" id="h11-0-507" class="i">+	XDestroyWindow(dpy, mon-&gt;barwin);
</a><a href="#h11-0-508" id="h11-0-508" class="i">+	free(mon);
</a><a href="#h11-0-509" id="h11-0-509" class="i">+}
</a><a href="#h11-0-510" id="h11-0-510" class="i">+
</a><a href="#h11-0-511" id="h11-0-511" class="i">+void
</a><a href="#h11-0-512" id="h11-0-512" class="i">+clientmessage(XEvent *e)
</a><a href="#h11-0-513" id="h11-0-513" class="i">+{
</a><a href="#h11-0-514" id="h11-0-514" class="i">+	XClientMessageEvent *cme = &amp;e-&gt;xclient;
</a><a href="#h11-0-515" id="h11-0-515" class="i">+	Client *c = wintoclient(cme-&gt;window);
</a><a href="#h11-0-516" id="h11-0-516" class="i">+
</a><a href="#h11-0-517" id="h11-0-517" class="i">+	if (!c)
</a><a href="#h11-0-518" id="h11-0-518" class="i">+		return;
</a><a href="#h11-0-519" id="h11-0-519" class="i">+	if (cme-&gt;message_type == netatom[NetWMState]) {
</a><a href="#h11-0-520" id="h11-0-520" class="i">+		if (cme-&gt;data.l[1] == netatom[NetWMFullscreen]
</a><a href="#h11-0-521" id="h11-0-521" class="i">+		|| cme-&gt;data.l[2] == netatom[NetWMFullscreen])
</a><a href="#h11-0-522" id="h11-0-522" class="i">+			setfullscreen(c, (cme-&gt;data.l[0] == 1 /* _NET_WM_STATE_ADD    */
</a><a href="#h11-0-523" id="h11-0-523" class="i">+				|| (cme-&gt;data.l[0] == 2 /* _NET_WM_STATE_TOGGLE */ &amp;&amp; !c-&gt;isfullscreen)));
</a><a href="#h11-0-524" id="h11-0-524" class="i">+	} else if (cme-&gt;message_type == netatom[NetActiveWindow]) {
</a><a href="#h11-0-525" id="h11-0-525" class="i">+		if (c != selmon-&gt;sel &amp;&amp; !c-&gt;isurgent)
</a><a href="#h11-0-526" id="h11-0-526" class="i">+			seturgent(c, 1);
</a><a href="#h11-0-527" id="h11-0-527" class="i">+	}
</a><a href="#h11-0-528" id="h11-0-528" class="i">+}
</a><a href="#h11-0-529" id="h11-0-529" class="i">+
</a><a href="#h11-0-530" id="h11-0-530" class="i">+void
</a><a href="#h11-0-531" id="h11-0-531" class="i">+configure(Client *c)
</a><a href="#h11-0-532" id="h11-0-532" class="i">+{
</a><a href="#h11-0-533" id="h11-0-533" class="i">+	XConfigureEvent ce;
</a><a href="#h11-0-534" id="h11-0-534" class="i">+
</a><a href="#h11-0-535" id="h11-0-535" class="i">+	ce.type = ConfigureNotify;
</a><a href="#h11-0-536" id="h11-0-536" class="i">+	ce.display = dpy;
</a><a href="#h11-0-537" id="h11-0-537" class="i">+	ce.event = c-&gt;win;
</a><a href="#h11-0-538" id="h11-0-538" class="i">+	ce.window = c-&gt;win;
</a><a href="#h11-0-539" id="h11-0-539" class="i">+	ce.x = c-&gt;x;
</a><a href="#h11-0-540" id="h11-0-540" class="i">+	ce.y = c-&gt;y;
</a><a href="#h11-0-541" id="h11-0-541" class="i">+	ce.width = c-&gt;w;
</a><a href="#h11-0-542" id="h11-0-542" class="i">+	ce.height = c-&gt;h;
</a><a href="#h11-0-543" id="h11-0-543" class="i">+	ce.border_width = c-&gt;bw;
</a><a href="#h11-0-544" id="h11-0-544" class="i">+	ce.above = None;
</a><a href="#h11-0-545" id="h11-0-545" class="i">+	ce.override_redirect = False;
</a><a href="#h11-0-546" id="h11-0-546" class="i">+	XSendEvent(dpy, c-&gt;win, False, StructureNotifyMask, (XEvent *)&amp;ce);
</a><a href="#h11-0-547" id="h11-0-547" class="i">+}
</a><a href="#h11-0-548" id="h11-0-548" class="i">+
</a><a href="#h11-0-549" id="h11-0-549" class="i">+void
</a><a href="#h11-0-550" id="h11-0-550" class="i">+configurenotify(XEvent *e)
</a><a href="#h11-0-551" id="h11-0-551" class="i">+{
</a><a href="#h11-0-552" id="h11-0-552" class="i">+	Monitor *m;
</a><a href="#h11-0-553" id="h11-0-553" class="i">+	Client *c;
</a><a href="#h11-0-554" id="h11-0-554" class="i">+	XConfigureEvent *ev = &amp;e-&gt;xconfigure;
</a><a href="#h11-0-555" id="h11-0-555" class="i">+	int dirty;
</a><a href="#h11-0-556" id="h11-0-556" class="i">+
</a><a href="#h11-0-557" id="h11-0-557" class="i">+	/* TODO: updategeom handling sucks, needs to be simplified */
</a><a href="#h11-0-558" id="h11-0-558" class="i">+	if (ev-&gt;window == root) {
</a><a href="#h11-0-559" id="h11-0-559" class="i">+		dirty = (sw != ev-&gt;width || sh != ev-&gt;height);
</a><a href="#h11-0-560" id="h11-0-560" class="i">+		sw = ev-&gt;width;
</a><a href="#h11-0-561" id="h11-0-561" class="i">+		sh = ev-&gt;height;
</a><a href="#h11-0-562" id="h11-0-562" class="i">+		if (updategeom() || dirty) {
</a><a href="#h11-0-563" id="h11-0-563" class="i">+			drw_resize(drw, sw, bh);
</a><a href="#h11-0-564" id="h11-0-564" class="i">+			updatebars();
</a><a href="#h11-0-565" id="h11-0-565" class="i">+			for (m = mons; m; m = m-&gt;next) {
</a><a href="#h11-0-566" id="h11-0-566" class="i">+				for (c = m-&gt;clients; c; c = c-&gt;next)
</a><a href="#h11-0-567" id="h11-0-567" class="i">+					if (c-&gt;isfullscreen)
</a><a href="#h11-0-568" id="h11-0-568" class="i">+						resizeclient(c, m-&gt;mx, m-&gt;my, m-&gt;mw, m-&gt;mh);
</a><a href="#h11-0-569" id="h11-0-569" class="i">+				XMoveResizeWindow(dpy, m-&gt;barwin, m-&gt;wx, m-&gt;by, m-&gt;ww, bh);
</a><a href="#h11-0-570" id="h11-0-570" class="i">+			}
</a><a href="#h11-0-571" id="h11-0-571" class="i">+			focus(NULL);
</a><a href="#h11-0-572" id="h11-0-572" class="i">+			arrange(NULL);
</a><a href="#h11-0-573" id="h11-0-573" class="i">+		}
</a><a href="#h11-0-574" id="h11-0-574" class="i">+	}
</a><a href="#h11-0-575" id="h11-0-575" class="i">+}
</a><a href="#h11-0-576" id="h11-0-576" class="i">+
</a><a href="#h11-0-577" id="h11-0-577" class="i">+void
</a><a href="#h11-0-578" id="h11-0-578" class="i">+configurerequest(XEvent *e)
</a><a href="#h11-0-579" id="h11-0-579" class="i">+{
</a><a href="#h11-0-580" id="h11-0-580" class="i">+	Client *c;
</a><a href="#h11-0-581" id="h11-0-581" class="i">+	Monitor *m;
</a><a href="#h11-0-582" id="h11-0-582" class="i">+	XConfigureRequestEvent *ev = &amp;e-&gt;xconfigurerequest;
</a><a href="#h11-0-583" id="h11-0-583" class="i">+	XWindowChanges wc;
</a><a href="#h11-0-584" id="h11-0-584" class="i">+
</a><a href="#h11-0-585" id="h11-0-585" class="i">+	if ((c = wintoclient(ev-&gt;window))) {
</a><a href="#h11-0-586" id="h11-0-586" class="i">+		if (ev-&gt;value_mask &amp; CWBorderWidth)
</a><a href="#h11-0-587" id="h11-0-587" class="i">+			c-&gt;bw = ev-&gt;border_width;
</a><a href="#h11-0-588" id="h11-0-588" class="i">+		else if (c-&gt;isfloating || !selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange) {
</a><a href="#h11-0-589" id="h11-0-589" class="i">+			m = c-&gt;mon;
</a><a href="#h11-0-590" id="h11-0-590" class="i">+			if (ev-&gt;value_mask &amp; CWX) {
</a><a href="#h11-0-591" id="h11-0-591" class="i">+				c-&gt;oldx = c-&gt;x;
</a><a href="#h11-0-592" id="h11-0-592" class="i">+				c-&gt;x = m-&gt;mx + ev-&gt;x;
</a><a href="#h11-0-593" id="h11-0-593" class="i">+			}
</a><a href="#h11-0-594" id="h11-0-594" class="i">+			if (ev-&gt;value_mask &amp; CWY) {
</a><a href="#h11-0-595" id="h11-0-595" class="i">+				c-&gt;oldy = c-&gt;y;
</a><a href="#h11-0-596" id="h11-0-596" class="i">+				c-&gt;y = m-&gt;my + ev-&gt;y;
</a><a href="#h11-0-597" id="h11-0-597" class="i">+			}
</a><a href="#h11-0-598" id="h11-0-598" class="i">+			if (ev-&gt;value_mask &amp; CWWidth) {
</a><a href="#h11-0-599" id="h11-0-599" class="i">+				c-&gt;oldw = c-&gt;w;
</a><a href="#h11-0-600" id="h11-0-600" class="i">+				c-&gt;w = ev-&gt;width;
</a><a href="#h11-0-601" id="h11-0-601" class="i">+			}
</a><a href="#h11-0-602" id="h11-0-602" class="i">+			if (ev-&gt;value_mask &amp; CWHeight) {
</a><a href="#h11-0-603" id="h11-0-603" class="i">+				c-&gt;oldh = c-&gt;h;
</a><a href="#h11-0-604" id="h11-0-604" class="i">+				c-&gt;h = ev-&gt;height;
</a><a href="#h11-0-605" id="h11-0-605" class="i">+			}
</a><a href="#h11-0-606" id="h11-0-606" class="i">+			if ((c-&gt;x + c-&gt;w) &gt; m-&gt;mx + m-&gt;mw &amp;&amp; c-&gt;isfloating)
</a><a href="#h11-0-607" id="h11-0-607" class="i">+				c-&gt;x = m-&gt;mx + (m-&gt;mw / 2 - WIDTH(c) / 2); /* center in x direction */
</a><a href="#h11-0-608" id="h11-0-608" class="i">+			if ((c-&gt;y + c-&gt;h) &gt; m-&gt;my + m-&gt;mh &amp;&amp; c-&gt;isfloating)
</a><a href="#h11-0-609" id="h11-0-609" class="i">+				c-&gt;y = m-&gt;my + (m-&gt;mh / 2 - HEIGHT(c) / 2); /* center in y direction */
</a><a href="#h11-0-610" id="h11-0-610" class="i">+			if ((ev-&gt;value_mask &amp; (CWX|CWY)) &amp;&amp; !(ev-&gt;value_mask &amp; (CWWidth|CWHeight)))
</a><a href="#h11-0-611" id="h11-0-611" class="i">+				configure(c);
</a><a href="#h11-0-612" id="h11-0-612" class="i">+			if (ISVISIBLE(c))
</a><a href="#h11-0-613" id="h11-0-613" class="i">+				XMoveResizeWindow(dpy, c-&gt;win, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h);
</a><a href="#h11-0-614" id="h11-0-614" class="i">+		} else
</a><a href="#h11-0-615" id="h11-0-615" class="i">+			configure(c);
</a><a href="#h11-0-616" id="h11-0-616" class="i">+	} else {
</a><a href="#h11-0-617" id="h11-0-617" class="i">+		wc.x = ev-&gt;x;
</a><a href="#h11-0-618" id="h11-0-618" class="i">+		wc.y = ev-&gt;y;
</a><a href="#h11-0-619" id="h11-0-619" class="i">+		wc.width = ev-&gt;width;
</a><a href="#h11-0-620" id="h11-0-620" class="i">+		wc.height = ev-&gt;height;
</a><a href="#h11-0-621" id="h11-0-621" class="i">+		wc.border_width = ev-&gt;border_width;
</a><a href="#h11-0-622" id="h11-0-622" class="i">+		wc.sibling = ev-&gt;above;
</a><a href="#h11-0-623" id="h11-0-623" class="i">+		wc.stack_mode = ev-&gt;detail;
</a><a href="#h11-0-624" id="h11-0-624" class="i">+		XConfigureWindow(dpy, ev-&gt;window, ev-&gt;value_mask, &amp;wc);
</a><a href="#h11-0-625" id="h11-0-625" class="i">+	}
</a><a href="#h11-0-626" id="h11-0-626" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-627" id="h11-0-627" class="i">+}
</a><a href="#h11-0-628" id="h11-0-628" class="i">+
</a><a href="#h11-0-629" id="h11-0-629" class="i">+Monitor *
</a><a href="#h11-0-630" id="h11-0-630" class="i">+createmon(void)
</a><a href="#h11-0-631" id="h11-0-631" class="i">+{
</a><a href="#h11-0-632" id="h11-0-632" class="i">+	Monitor *m;
</a><a href="#h11-0-633" id="h11-0-633" class="i">+
</a><a href="#h11-0-634" id="h11-0-634" class="i">+	m = ecalloc(1, sizeof(Monitor));
</a><a href="#h11-0-635" id="h11-0-635" class="i">+	m-&gt;tagset[0] = m-&gt;tagset[1] = 1;
</a><a href="#h11-0-636" id="h11-0-636" class="i">+	m-&gt;mfact = mfact;
</a><a href="#h11-0-637" id="h11-0-637" class="i">+	m-&gt;nmaster = nmaster;
</a><a href="#h11-0-638" id="h11-0-638" class="i">+	m-&gt;showbar = showbar;
</a><a href="#h11-0-639" id="h11-0-639" class="i">+	m-&gt;topbar = topbar;
</a><a href="#h11-0-640" id="h11-0-640" class="i">+	m-&gt;lt[0] = &amp;layouts[0];
</a><a href="#h11-0-641" id="h11-0-641" class="i">+	m-&gt;lt[1] = &amp;layouts[1 % LENGTH(layouts)];
</a><a href="#h11-0-642" id="h11-0-642" class="i">+	strncpy(m-&gt;ltsymbol, layouts[0].symbol, sizeof m-&gt;ltsymbol);
</a><a href="#h11-0-643" id="h11-0-643" class="i">+	return m;
</a><a href="#h11-0-644" id="h11-0-644" class="i">+}
</a><a href="#h11-0-645" id="h11-0-645" class="i">+
</a><a href="#h11-0-646" id="h11-0-646" class="i">+void
</a><a href="#h11-0-647" id="h11-0-647" class="i">+destroynotify(XEvent *e)
</a><a href="#h11-0-648" id="h11-0-648" class="i">+{
</a><a href="#h11-0-649" id="h11-0-649" class="i">+	Client *c;
</a><a href="#h11-0-650" id="h11-0-650" class="i">+	XDestroyWindowEvent *ev = &amp;e-&gt;xdestroywindow;
</a><a href="#h11-0-651" id="h11-0-651" class="i">+
</a><a href="#h11-0-652" id="h11-0-652" class="i">+	if ((c = wintoclient(ev-&gt;window)))
</a><a href="#h11-0-653" id="h11-0-653" class="i">+		unmanage(c, 1);
</a><a href="#h11-0-654" id="h11-0-654" class="i">+}
</a><a href="#h11-0-655" id="h11-0-655" class="i">+
</a><a href="#h11-0-656" id="h11-0-656" class="i">+void
</a><a href="#h11-0-657" id="h11-0-657" class="i">+detach(Client *c)
</a><a href="#h11-0-658" id="h11-0-658" class="i">+{
</a><a href="#h11-0-659" id="h11-0-659" class="i">+	Client **tc;
</a><a href="#h11-0-660" id="h11-0-660" class="i">+
</a><a href="#h11-0-661" id="h11-0-661" class="i">+	for (tc = &amp;c-&gt;mon-&gt;clients; *tc &amp;&amp; *tc != c; tc = &amp;(*tc)-&gt;next);
</a><a href="#h11-0-662" id="h11-0-662" class="i">+	*tc = c-&gt;next;
</a><a href="#h11-0-663" id="h11-0-663" class="i">+}
</a><a href="#h11-0-664" id="h11-0-664" class="i">+
</a><a href="#h11-0-665" id="h11-0-665" class="i">+void
</a><a href="#h11-0-666" id="h11-0-666" class="i">+detachstack(Client *c)
</a><a href="#h11-0-667" id="h11-0-667" class="i">+{
</a><a href="#h11-0-668" id="h11-0-668" class="i">+	Client **tc, *t;
</a><a href="#h11-0-669" id="h11-0-669" class="i">+
</a><a href="#h11-0-670" id="h11-0-670" class="i">+	for (tc = &amp;c-&gt;mon-&gt;stack; *tc &amp;&amp; *tc != c; tc = &amp;(*tc)-&gt;snext);
</a><a href="#h11-0-671" id="h11-0-671" class="i">+	*tc = c-&gt;snext;
</a><a href="#h11-0-672" id="h11-0-672" class="i">+
</a><a href="#h11-0-673" id="h11-0-673" class="i">+	if (c == c-&gt;mon-&gt;sel) {
</a><a href="#h11-0-674" id="h11-0-674" class="i">+		for (t = c-&gt;mon-&gt;stack; t &amp;&amp; !ISVISIBLE(t); t = t-&gt;snext);
</a><a href="#h11-0-675" id="h11-0-675" class="i">+		c-&gt;mon-&gt;sel = t;
</a><a href="#h11-0-676" id="h11-0-676" class="i">+	}
</a><a href="#h11-0-677" id="h11-0-677" class="i">+}
</a><a href="#h11-0-678" id="h11-0-678" class="i">+
</a><a href="#h11-0-679" id="h11-0-679" class="i">+Monitor *
</a><a href="#h11-0-680" id="h11-0-680" class="i">+dirtomon(int dir)
</a><a href="#h11-0-681" id="h11-0-681" class="i">+{
</a><a href="#h11-0-682" id="h11-0-682" class="i">+	Monitor *m = NULL;
</a><a href="#h11-0-683" id="h11-0-683" class="i">+
</a><a href="#h11-0-684" id="h11-0-684" class="i">+	if (dir &gt; 0) {
</a><a href="#h11-0-685" id="h11-0-685" class="i">+		if (!(m = selmon-&gt;next))
</a><a href="#h11-0-686" id="h11-0-686" class="i">+			m = mons;
</a><a href="#h11-0-687" id="h11-0-687" class="i">+	} else if (selmon == mons)
</a><a href="#h11-0-688" id="h11-0-688" class="i">+		for (m = mons; m-&gt;next; m = m-&gt;next);
</a><a href="#h11-0-689" id="h11-0-689" class="i">+	else
</a><a href="#h11-0-690" id="h11-0-690" class="i">+		for (m = mons; m-&gt;next != selmon; m = m-&gt;next);
</a><a href="#h11-0-691" id="h11-0-691" class="i">+	return m;
</a><a href="#h11-0-692" id="h11-0-692" class="i">+}
</a><a href="#h11-0-693" id="h11-0-693" class="i">+
</a><a href="#h11-0-694" id="h11-0-694" class="i">+void
</a><a href="#h11-0-695" id="h11-0-695" class="i">+drawbar(Monitor *m)
</a><a href="#h11-0-696" id="h11-0-696" class="i">+{
</a><a href="#h11-0-697" id="h11-0-697" class="i">+	int x, w, sw = 0;
</a><a href="#h11-0-698" id="h11-0-698" class="i">+	int boxs = drw-&gt;fonts-&gt;h / 9;
</a><a href="#h11-0-699" id="h11-0-699" class="i">+	int boxw = drw-&gt;fonts-&gt;h / 6 + 2;
</a><a href="#h11-0-700" id="h11-0-700" class="i">+	unsigned int i, occ = 0, urg = 0;
</a><a href="#h11-0-701" id="h11-0-701" class="i">+	Client *c;
</a><a href="#h11-0-702" id="h11-0-702" class="i">+
</a><a href="#h11-0-703" id="h11-0-703" class="i">+	/* draw status first so it can be overdrawn by tags later */
</a><a href="#h11-0-704" id="h11-0-704" class="i">+	if (m == selmon) { /* status is only drawn on selected monitor */
</a><a href="#h11-0-705" id="h11-0-705" class="i">+		drw_setscheme(drw, scheme[SchemeNorm]);
</a><a href="#h11-0-706" id="h11-0-706" class="i">+		sw = TEXTW(stext) - lrpad + 2; /* 2px right padding */
</a><a href="#h11-0-707" id="h11-0-707" class="i">+		drw_text(drw, m-&gt;ww - sw, 0, sw, bh, 0, stext, 0);
</a><a href="#h11-0-708" id="h11-0-708" class="i">+	}
</a><a href="#h11-0-709" id="h11-0-709" class="i">+
</a><a href="#h11-0-710" id="h11-0-710" class="i">+	for (c = m-&gt;clients; c; c = c-&gt;next) {
</a><a href="#h11-0-711" id="h11-0-711" class="i">+		occ |= c-&gt;tags;
</a><a href="#h11-0-712" id="h11-0-712" class="i">+		if (c-&gt;isurgent)
</a><a href="#h11-0-713" id="h11-0-713" class="i">+			urg |= c-&gt;tags;
</a><a href="#h11-0-714" id="h11-0-714" class="i">+	}
</a><a href="#h11-0-715" id="h11-0-715" class="i">+	x = 0;
</a><a href="#h11-0-716" id="h11-0-716" class="i">+	for (i = 0; i &lt; LENGTH(tags); i++) {
</a><a href="#h11-0-717" id="h11-0-717" class="i">+		w = TEXTW(tags[i]);
</a><a href="#h11-0-718" id="h11-0-718" class="i">+		drw_setscheme(drw, scheme[m-&gt;tagset[m-&gt;seltags] &amp; 1 &lt;&lt; i ? SchemeSel : SchemeNorm]);
</a><a href="#h11-0-719" id="h11-0-719" class="i">+		drw_text(drw, x, 0, w, bh, lrpad / 2, tags[i], urg &amp; 1 &lt;&lt; i);
</a><a href="#h11-0-720" id="h11-0-720" class="i">+		if (occ &amp; 1 &lt;&lt; i)
</a><a href="#h11-0-721" id="h11-0-721" class="i">+			drw_rect(drw, x + boxs, boxs, boxw, boxw,
</a><a href="#h11-0-722" id="h11-0-722" class="i">+				m == selmon &amp;&amp; selmon-&gt;sel &amp;&amp; selmon-&gt;sel-&gt;tags &amp; 1 &lt;&lt; i,
</a><a href="#h11-0-723" id="h11-0-723" class="i">+				urg &amp; 1 &lt;&lt; i);
</a><a href="#h11-0-724" id="h11-0-724" class="i">+		x += w;
</a><a href="#h11-0-725" id="h11-0-725" class="i">+	}
</a><a href="#h11-0-726" id="h11-0-726" class="i">+	w = blw = TEXTW(m-&gt;ltsymbol);
</a><a href="#h11-0-727" id="h11-0-727" class="i">+	drw_setscheme(drw, scheme[SchemeNorm]);
</a><a href="#h11-0-728" id="h11-0-728" class="i">+	x = drw_text(drw, x, 0, w, bh, lrpad / 2, m-&gt;ltsymbol, 0);
</a><a href="#h11-0-729" id="h11-0-729" class="i">+
</a><a href="#h11-0-730" id="h11-0-730" class="i">+	if ((w = m-&gt;ww - sw - x) &gt; bh) {
</a><a href="#h11-0-731" id="h11-0-731" class="i">+		if (m-&gt;sel) {
</a><a href="#h11-0-732" id="h11-0-732" class="i">+			drw_setscheme(drw, scheme[m == selmon ? SchemeSel : SchemeNorm]);
</a><a href="#h11-0-733" id="h11-0-733" class="i">+			drw_text(drw, x, 0, w, bh, lrpad / 2, m-&gt;sel-&gt;name, 0);
</a><a href="#h11-0-734" id="h11-0-734" class="i">+			if (m-&gt;sel-&gt;isfloating)
</a><a href="#h11-0-735" id="h11-0-735" class="i">+				drw_rect(drw, x + boxs, boxs, boxw, boxw, m-&gt;sel-&gt;isfixed, 0);
</a><a href="#h11-0-736" id="h11-0-736" class="i">+		} else {
</a><a href="#h11-0-737" id="h11-0-737" class="i">+			drw_setscheme(drw, scheme[SchemeNorm]);
</a><a href="#h11-0-738" id="h11-0-738" class="i">+			drw_rect(drw, x, 0, w, bh, 1, 1);
</a><a href="#h11-0-739" id="h11-0-739" class="i">+		}
</a><a href="#h11-0-740" id="h11-0-740" class="i">+	}
</a><a href="#h11-0-741" id="h11-0-741" class="i">+	drw_map(drw, m-&gt;barwin, 0, 0, m-&gt;ww, bh);
</a><a href="#h11-0-742" id="h11-0-742" class="i">+}
</a><a href="#h11-0-743" id="h11-0-743" class="i">+
</a><a href="#h11-0-744" id="h11-0-744" class="i">+void
</a><a href="#h11-0-745" id="h11-0-745" class="i">+drawbars(void)
</a><a href="#h11-0-746" id="h11-0-746" class="i">+{
</a><a href="#h11-0-747" id="h11-0-747" class="i">+	Monitor *m;
</a><a href="#h11-0-748" id="h11-0-748" class="i">+
</a><a href="#h11-0-749" id="h11-0-749" class="i">+	for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-750" id="h11-0-750" class="i">+		drawbar(m);
</a><a href="#h11-0-751" id="h11-0-751" class="i">+}
</a><a href="#h11-0-752" id="h11-0-752" class="i">+
</a><a href="#h11-0-753" id="h11-0-753" class="i">+void
</a><a href="#h11-0-754" id="h11-0-754" class="i">+enternotify(XEvent *e)
</a><a href="#h11-0-755" id="h11-0-755" class="i">+{
</a><a href="#h11-0-756" id="h11-0-756" class="i">+	Client *c;
</a><a href="#h11-0-757" id="h11-0-757" class="i">+	Monitor *m;
</a><a href="#h11-0-758" id="h11-0-758" class="i">+	XCrossingEvent *ev = &amp;e-&gt;xcrossing;
</a><a href="#h11-0-759" id="h11-0-759" class="i">+
</a><a href="#h11-0-760" id="h11-0-760" class="i">+	if ((ev-&gt;mode != NotifyNormal || ev-&gt;detail == NotifyInferior) &amp;&amp; ev-&gt;window != root)
</a><a href="#h11-0-761" id="h11-0-761" class="i">+		return;
</a><a href="#h11-0-762" id="h11-0-762" class="i">+	c = wintoclient(ev-&gt;window);
</a><a href="#h11-0-763" id="h11-0-763" class="i">+	m = c ? c-&gt;mon : wintomon(ev-&gt;window);
</a><a href="#h11-0-764" id="h11-0-764" class="i">+	if (m != selmon) {
</a><a href="#h11-0-765" id="h11-0-765" class="i">+		unfocus(selmon-&gt;sel, 1);
</a><a href="#h11-0-766" id="h11-0-766" class="i">+		selmon = m;
</a><a href="#h11-0-767" id="h11-0-767" class="i">+	} else if (!c || c == selmon-&gt;sel)
</a><a href="#h11-0-768" id="h11-0-768" class="i">+		return;
</a><a href="#h11-0-769" id="h11-0-769" class="i">+	focus(c);
</a><a href="#h11-0-770" id="h11-0-770" class="i">+}
</a><a href="#h11-0-771" id="h11-0-771" class="i">+
</a><a href="#h11-0-772" id="h11-0-772" class="i">+void
</a><a href="#h11-0-773" id="h11-0-773" class="i">+expose(XEvent *e)
</a><a href="#h11-0-774" id="h11-0-774" class="i">+{
</a><a href="#h11-0-775" id="h11-0-775" class="i">+	Monitor *m;
</a><a href="#h11-0-776" id="h11-0-776" class="i">+	XExposeEvent *ev = &amp;e-&gt;xexpose;
</a><a href="#h11-0-777" id="h11-0-777" class="i">+
</a><a href="#h11-0-778" id="h11-0-778" class="i">+	if (ev-&gt;count == 0 &amp;&amp; (m = wintomon(ev-&gt;window)))
</a><a href="#h11-0-779" id="h11-0-779" class="i">+		drawbar(m);
</a><a href="#h11-0-780" id="h11-0-780" class="i">+}
</a><a href="#h11-0-781" id="h11-0-781" class="i">+
</a><a href="#h11-0-782" id="h11-0-782" class="i">+void
</a><a href="#h11-0-783" id="h11-0-783" class="i">+focus(Client *c)
</a><a href="#h11-0-784" id="h11-0-784" class="i">+{
</a><a href="#h11-0-785" id="h11-0-785" class="i">+	if (!c || !ISVISIBLE(c))
</a><a href="#h11-0-786" id="h11-0-786" class="i">+		for (c = selmon-&gt;stack; c &amp;&amp; !ISVISIBLE(c); c = c-&gt;snext);
</a><a href="#h11-0-787" id="h11-0-787" class="i">+	if (selmon-&gt;sel &amp;&amp; selmon-&gt;sel != c)
</a><a href="#h11-0-788" id="h11-0-788" class="i">+		unfocus(selmon-&gt;sel, 0);
</a><a href="#h11-0-789" id="h11-0-789" class="i">+	if (c) {
</a><a href="#h11-0-790" id="h11-0-790" class="i">+		if (c-&gt;mon != selmon)
</a><a href="#h11-0-791" id="h11-0-791" class="i">+			selmon = c-&gt;mon;
</a><a href="#h11-0-792" id="h11-0-792" class="i">+		if (c-&gt;isurgent)
</a><a href="#h11-0-793" id="h11-0-793" class="i">+			seturgent(c, 0);
</a><a href="#h11-0-794" id="h11-0-794" class="i">+		detachstack(c);
</a><a href="#h11-0-795" id="h11-0-795" class="i">+		attachstack(c);
</a><a href="#h11-0-796" id="h11-0-796" class="i">+		grabbuttons(c, 1);
</a><a href="#h11-0-797" id="h11-0-797" class="i">+		XSetWindowBorder(dpy, c-&gt;win, scheme[SchemeSel][ColBorder].pixel);
</a><a href="#h11-0-798" id="h11-0-798" class="i">+		setfocus(c);
</a><a href="#h11-0-799" id="h11-0-799" class="i">+	} else {
</a><a href="#h11-0-800" id="h11-0-800" class="i">+		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a><a href="#h11-0-801" id="h11-0-801" class="i">+		XDeleteProperty(dpy, root, netatom[NetActiveWindow]);
</a><a href="#h11-0-802" id="h11-0-802" class="i">+	}
</a><a href="#h11-0-803" id="h11-0-803" class="i">+	selmon-&gt;sel = c;
</a><a href="#h11-0-804" id="h11-0-804" class="i">+	drawbars();
</a><a href="#h11-0-805" id="h11-0-805" class="i">+}
</a><a href="#h11-0-806" id="h11-0-806" class="i">+
</a><a href="#h11-0-807" id="h11-0-807" class="i">+/* there are some broken focus acquiring clients needing extra handling */
</a><a href="#h11-0-808" id="h11-0-808" class="i">+void
</a><a href="#h11-0-809" id="h11-0-809" class="i">+focusin(XEvent *e)
</a><a href="#h11-0-810" id="h11-0-810" class="i">+{
</a><a href="#h11-0-811" id="h11-0-811" class="i">+	XFocusChangeEvent *ev = &amp;e-&gt;xfocus;
</a><a href="#h11-0-812" id="h11-0-812" class="i">+
</a><a href="#h11-0-813" id="h11-0-813" class="i">+	if (selmon-&gt;sel &amp;&amp; ev-&gt;window != selmon-&gt;sel-&gt;win)
</a><a href="#h11-0-814" id="h11-0-814" class="i">+		setfocus(selmon-&gt;sel);
</a><a href="#h11-0-815" id="h11-0-815" class="i">+}
</a><a href="#h11-0-816" id="h11-0-816" class="i">+
</a><a href="#h11-0-817" id="h11-0-817" class="i">+void
</a><a href="#h11-0-818" id="h11-0-818" class="i">+focusmon(const Arg *arg)
</a><a href="#h11-0-819" id="h11-0-819" class="i">+{
</a><a href="#h11-0-820" id="h11-0-820" class="i">+	Monitor *m;
</a><a href="#h11-0-821" id="h11-0-821" class="i">+
</a><a href="#h11-0-822" id="h11-0-822" class="i">+	if (!mons-&gt;next)
</a><a href="#h11-0-823" id="h11-0-823" class="i">+		return;
</a><a href="#h11-0-824" id="h11-0-824" class="i">+	if ((m = dirtomon(arg-&gt;i)) == selmon)
</a><a href="#h11-0-825" id="h11-0-825" class="i">+		return;
</a><a href="#h11-0-826" id="h11-0-826" class="i">+	unfocus(selmon-&gt;sel, 0);
</a><a href="#h11-0-827" id="h11-0-827" class="i">+	selmon = m;
</a><a href="#h11-0-828" id="h11-0-828" class="i">+	focus(NULL);
</a><a href="#h11-0-829" id="h11-0-829" class="i">+}
</a><a href="#h11-0-830" id="h11-0-830" class="i">+
</a><a href="#h11-0-831" id="h11-0-831" class="i">+void
</a><a href="#h11-0-832" id="h11-0-832" class="i">+focusstack(const Arg *arg)
</a><a href="#h11-0-833" id="h11-0-833" class="i">+{
</a><a href="#h11-0-834" id="h11-0-834" class="i">+	Client *c = NULL, *i;
</a><a href="#h11-0-835" id="h11-0-835" class="i">+
</a><a href="#h11-0-836" id="h11-0-836" class="i">+	if (!selmon-&gt;sel)
</a><a href="#h11-0-837" id="h11-0-837" class="i">+		return;
</a><a href="#h11-0-838" id="h11-0-838" class="i">+	if (arg-&gt;i &gt; 0) {
</a><a href="#h11-0-839" id="h11-0-839" class="i">+		for (c = selmon-&gt;sel-&gt;next; c &amp;&amp; !ISVISIBLE(c); c = c-&gt;next);
</a><a href="#h11-0-840" id="h11-0-840" class="i">+		if (!c)
</a><a href="#h11-0-841" id="h11-0-841" class="i">+			for (c = selmon-&gt;clients; c &amp;&amp; !ISVISIBLE(c); c = c-&gt;next);
</a><a href="#h11-0-842" id="h11-0-842" class="i">+	} else {
</a><a href="#h11-0-843" id="h11-0-843" class="i">+		for (i = selmon-&gt;clients; i != selmon-&gt;sel; i = i-&gt;next)
</a><a href="#h11-0-844" id="h11-0-844" class="i">+			if (ISVISIBLE(i))
</a><a href="#h11-0-845" id="h11-0-845" class="i">+				c = i;
</a><a href="#h11-0-846" id="h11-0-846" class="i">+		if (!c)
</a><a href="#h11-0-847" id="h11-0-847" class="i">+			for (; i; i = i-&gt;next)
</a><a href="#h11-0-848" id="h11-0-848" class="i">+				if (ISVISIBLE(i))
</a><a href="#h11-0-849" id="h11-0-849" class="i">+					c = i;
</a><a href="#h11-0-850" id="h11-0-850" class="i">+	}
</a><a href="#h11-0-851" id="h11-0-851" class="i">+	if (c) {
</a><a href="#h11-0-852" id="h11-0-852" class="i">+		focus(c);
</a><a href="#h11-0-853" id="h11-0-853" class="i">+		restack(selmon);
</a><a href="#h11-0-854" id="h11-0-854" class="i">+	}
</a><a href="#h11-0-855" id="h11-0-855" class="i">+}
</a><a href="#h11-0-856" id="h11-0-856" class="i">+
</a><a href="#h11-0-857" id="h11-0-857" class="i">+Atom
</a><a href="#h11-0-858" id="h11-0-858" class="i">+getatomprop(Client *c, Atom prop)
</a><a href="#h11-0-859" id="h11-0-859" class="i">+{
</a><a href="#h11-0-860" id="h11-0-860" class="i">+	int di;
</a><a href="#h11-0-861" id="h11-0-861" class="i">+	unsigned long dl;
</a><a href="#h11-0-862" id="h11-0-862" class="i">+	unsigned char *p = NULL;
</a><a href="#h11-0-863" id="h11-0-863" class="i">+	Atom da, atom = None;
</a><a href="#h11-0-864" id="h11-0-864" class="i">+
</a><a href="#h11-0-865" id="h11-0-865" class="i">+	if (XGetWindowProperty(dpy, c-&gt;win, prop, 0L, sizeof atom, False, XA_ATOM,
</a><a href="#h11-0-866" id="h11-0-866" class="i">+		&amp;da, &amp;di, &amp;dl, &amp;dl, &amp;p) == Success &amp;&amp; p) {
</a><a href="#h11-0-867" id="h11-0-867" class="i">+		atom = *(Atom *)p;
</a><a href="#h11-0-868" id="h11-0-868" class="i">+		XFree(p);
</a><a href="#h11-0-869" id="h11-0-869" class="i">+	}
</a><a href="#h11-0-870" id="h11-0-870" class="i">+	return atom;
</a><a href="#h11-0-871" id="h11-0-871" class="i">+}
</a><a href="#h11-0-872" id="h11-0-872" class="i">+
</a><a href="#h11-0-873" id="h11-0-873" class="i">+int
</a><a href="#h11-0-874" id="h11-0-874" class="i">+getrootptr(int *x, int *y)
</a><a href="#h11-0-875" id="h11-0-875" class="i">+{
</a><a href="#h11-0-876" id="h11-0-876" class="i">+	int di;
</a><a href="#h11-0-877" id="h11-0-877" class="i">+	unsigned int dui;
</a><a href="#h11-0-878" id="h11-0-878" class="i">+	Window dummy;
</a><a href="#h11-0-879" id="h11-0-879" class="i">+
</a><a href="#h11-0-880" id="h11-0-880" class="i">+	return XQueryPointer(dpy, root, &amp;dummy, &amp;dummy, x, y, &amp;di, &amp;di, &amp;dui);
</a><a href="#h11-0-881" id="h11-0-881" class="i">+}
</a><a href="#h11-0-882" id="h11-0-882" class="i">+
</a><a href="#h11-0-883" id="h11-0-883" class="i">+long
</a><a href="#h11-0-884" id="h11-0-884" class="i">+getstate(Window w)
</a><a href="#h11-0-885" id="h11-0-885" class="i">+{
</a><a href="#h11-0-886" id="h11-0-886" class="i">+	int format;
</a><a href="#h11-0-887" id="h11-0-887" class="i">+	long result = -1;
</a><a href="#h11-0-888" id="h11-0-888" class="i">+	unsigned char *p = NULL;
</a><a href="#h11-0-889" id="h11-0-889" class="i">+	unsigned long n, extra;
</a><a href="#h11-0-890" id="h11-0-890" class="i">+	Atom real;
</a><a href="#h11-0-891" id="h11-0-891" class="i">+
</a><a href="#h11-0-892" id="h11-0-892" class="i">+	if (XGetWindowProperty(dpy, w, wmatom[WMState], 0L, 2L, False, wmatom[WMState],
</a><a href="#h11-0-893" id="h11-0-893" class="i">+		&amp;real, &amp;format, &amp;n, &amp;extra, (unsigned char **)&amp;p) != Success)
</a><a href="#h11-0-894" id="h11-0-894" class="i">+		return -1;
</a><a href="#h11-0-895" id="h11-0-895" class="i">+	if (n != 0)
</a><a href="#h11-0-896" id="h11-0-896" class="i">+		result = *p;
</a><a href="#h11-0-897" id="h11-0-897" class="i">+	XFree(p);
</a><a href="#h11-0-898" id="h11-0-898" class="i">+	return result;
</a><a href="#h11-0-899" id="h11-0-899" class="i">+}
</a><a href="#h11-0-900" id="h11-0-900" class="i">+
</a><a href="#h11-0-901" id="h11-0-901" class="i">+int
</a><a href="#h11-0-902" id="h11-0-902" class="i">+gettextprop(Window w, Atom atom, char *text, unsigned int size)
</a><a href="#h11-0-903" id="h11-0-903" class="i">+{
</a><a href="#h11-0-904" id="h11-0-904" class="i">+	char **list = NULL;
</a><a href="#h11-0-905" id="h11-0-905" class="i">+	int n;
</a><a href="#h11-0-906" id="h11-0-906" class="i">+	XTextProperty name;
</a><a href="#h11-0-907" id="h11-0-907" class="i">+
</a><a href="#h11-0-908" id="h11-0-908" class="i">+	if (!text || size == 0)
</a><a href="#h11-0-909" id="h11-0-909" class="i">+		return 0;
</a><a href="#h11-0-910" id="h11-0-910" class="i">+	text[0] = &#39;\0&#39;;
</a><a href="#h11-0-911" id="h11-0-911" class="i">+	if (!XGetTextProperty(dpy, w, &amp;name, atom) || !name.nitems)
</a><a href="#h11-0-912" id="h11-0-912" class="i">+		return 0;
</a><a href="#h11-0-913" id="h11-0-913" class="i">+	if (name.encoding == XA_STRING)
</a><a href="#h11-0-914" id="h11-0-914" class="i">+		strncpy(text, (char *)name.value, size - 1);
</a><a href="#h11-0-915" id="h11-0-915" class="i">+	else {
</a><a href="#h11-0-916" id="h11-0-916" class="i">+		if (XmbTextPropertyToTextList(dpy, &amp;name, &amp;list, &amp;n) &gt;= Success &amp;&amp; n &gt; 0 &amp;&amp; *list) {
</a><a href="#h11-0-917" id="h11-0-917" class="i">+			strncpy(text, *list, size - 1);
</a><a href="#h11-0-918" id="h11-0-918" class="i">+			XFreeStringList(list);
</a><a href="#h11-0-919" id="h11-0-919" class="i">+		}
</a><a href="#h11-0-920" id="h11-0-920" class="i">+	}
</a><a href="#h11-0-921" id="h11-0-921" class="i">+	text[size - 1] = &#39;\0&#39;;
</a><a href="#h11-0-922" id="h11-0-922" class="i">+	XFree(name.value);
</a><a href="#h11-0-923" id="h11-0-923" class="i">+	return 1;
</a><a href="#h11-0-924" id="h11-0-924" class="i">+}
</a><a href="#h11-0-925" id="h11-0-925" class="i">+
</a><a href="#h11-0-926" id="h11-0-926" class="i">+void
</a><a href="#h11-0-927" id="h11-0-927" class="i">+grabbuttons(Client *c, int focused)
</a><a href="#h11-0-928" id="h11-0-928" class="i">+{
</a><a href="#h11-0-929" id="h11-0-929" class="i">+	updatenumlockmask();
</a><a href="#h11-0-930" id="h11-0-930" class="i">+	{
</a><a href="#h11-0-931" id="h11-0-931" class="i">+		unsigned int i, j;
</a><a href="#h11-0-932" id="h11-0-932" class="i">+		unsigned int modifiers[] = { 0, LockMask, numlockmask, numlockmask|LockMask };
</a><a href="#h11-0-933" id="h11-0-933" class="i">+		XUngrabButton(dpy, AnyButton, AnyModifier, c-&gt;win);
</a><a href="#h11-0-934" id="h11-0-934" class="i">+		if (!focused)
</a><a href="#h11-0-935" id="h11-0-935" class="i">+			XGrabButton(dpy, AnyButton, AnyModifier, c-&gt;win, False,
</a><a href="#h11-0-936" id="h11-0-936" class="i">+				BUTTONMASK, GrabModeSync, GrabModeSync, None, None);
</a><a href="#h11-0-937" id="h11-0-937" class="i">+		for (i = 0; i &lt; LENGTH(buttons); i++)
</a><a href="#h11-0-938" id="h11-0-938" class="i">+			if (buttons[i].click == ClkClientWin)
</a><a href="#h11-0-939" id="h11-0-939" class="i">+				for (j = 0; j &lt; LENGTH(modifiers); j++)
</a><a href="#h11-0-940" id="h11-0-940" class="i">+					XGrabButton(dpy, buttons[i].button,
</a><a href="#h11-0-941" id="h11-0-941" class="i">+						buttons[i].mask | modifiers[j],
</a><a href="#h11-0-942" id="h11-0-942" class="i">+						c-&gt;win, False, BUTTONMASK,
</a><a href="#h11-0-943" id="h11-0-943" class="i">+						GrabModeAsync, GrabModeSync, None, None);
</a><a href="#h11-0-944" id="h11-0-944" class="i">+	}
</a><a href="#h11-0-945" id="h11-0-945" class="i">+}
</a><a href="#h11-0-946" id="h11-0-946" class="i">+
</a><a href="#h11-0-947" id="h11-0-947" class="i">+void
</a><a href="#h11-0-948" id="h11-0-948" class="i">+grabkeys(void)
</a><a href="#h11-0-949" id="h11-0-949" class="i">+{
</a><a href="#h11-0-950" id="h11-0-950" class="i">+	updatenumlockmask();
</a><a href="#h11-0-951" id="h11-0-951" class="i">+	{
</a><a href="#h11-0-952" id="h11-0-952" class="i">+		unsigned int i, j;
</a><a href="#h11-0-953" id="h11-0-953" class="i">+		unsigned int modifiers[] = { 0, LockMask, numlockmask, numlockmask|LockMask };
</a><a href="#h11-0-954" id="h11-0-954" class="i">+		KeyCode code;
</a><a href="#h11-0-955" id="h11-0-955" class="i">+
</a><a href="#h11-0-956" id="h11-0-956" class="i">+		XUngrabKey(dpy, AnyKey, AnyModifier, root);
</a><a href="#h11-0-957" id="h11-0-957" class="i">+		for (i = 0; i &lt; LENGTH(keys); i++)
</a><a href="#h11-0-958" id="h11-0-958" class="i">+			if ((code = XKeysymToKeycode(dpy, keys[i].keysym)))
</a><a href="#h11-0-959" id="h11-0-959" class="i">+				for (j = 0; j &lt; LENGTH(modifiers); j++)
</a><a href="#h11-0-960" id="h11-0-960" class="i">+					XGrabKey(dpy, code, keys[i].mod | modifiers[j], root,
</a><a href="#h11-0-961" id="h11-0-961" class="i">+						True, GrabModeAsync, GrabModeAsync);
</a><a href="#h11-0-962" id="h11-0-962" class="i">+	}
</a><a href="#h11-0-963" id="h11-0-963" class="i">+}
</a><a href="#h11-0-964" id="h11-0-964" class="i">+
</a><a href="#h11-0-965" id="h11-0-965" class="i">+void
</a><a href="#h11-0-966" id="h11-0-966" class="i">+incnmaster(const Arg *arg)
</a><a href="#h11-0-967" id="h11-0-967" class="i">+{
</a><a href="#h11-0-968" id="h11-0-968" class="i">+	selmon-&gt;nmaster = MAX(selmon-&gt;nmaster + arg-&gt;i, 0);
</a><a href="#h11-0-969" id="h11-0-969" class="i">+	arrange(selmon);
</a><a href="#h11-0-970" id="h11-0-970" class="i">+}
</a><a href="#h11-0-971" id="h11-0-971" class="i">+
</a><a href="#h11-0-972" id="h11-0-972" class="i">+#ifdef XINERAMA
</a><a href="#h11-0-973" id="h11-0-973" class="i">+static int
</a><a href="#h11-0-974" id="h11-0-974" class="i">+isuniquegeom(XineramaScreenInfo *unique, size_t n, XineramaScreenInfo *info)
</a><a href="#h11-0-975" id="h11-0-975" class="i">+{
</a><a href="#h11-0-976" id="h11-0-976" class="i">+	while (n--)
</a><a href="#h11-0-977" id="h11-0-977" class="i">+		if (unique[n].x_org == info-&gt;x_org &amp;&amp; unique[n].y_org == info-&gt;y_org
</a><a href="#h11-0-978" id="h11-0-978" class="i">+		&amp;&amp; unique[n].width == info-&gt;width &amp;&amp; unique[n].height == info-&gt;height)
</a><a href="#h11-0-979" id="h11-0-979" class="i">+			return 0;
</a><a href="#h11-0-980" id="h11-0-980" class="i">+	return 1;
</a><a href="#h11-0-981" id="h11-0-981" class="i">+}
</a><a href="#h11-0-982" id="h11-0-982" class="i">+#endif /* XINERAMA */
</a><a href="#h11-0-983" id="h11-0-983" class="i">+
</a><a href="#h11-0-984" id="h11-0-984" class="i">+void
</a><a href="#h11-0-985" id="h11-0-985" class="i">+keypress(XEvent *e)
</a><a href="#h11-0-986" id="h11-0-986" class="i">+{
</a><a href="#h11-0-987" id="h11-0-987" class="i">+	unsigned int i;
</a><a href="#h11-0-988" id="h11-0-988" class="i">+	KeySym keysym;
</a><a href="#h11-0-989" id="h11-0-989" class="i">+	XKeyEvent *ev;
</a><a href="#h11-0-990" id="h11-0-990" class="i">+
</a><a href="#h11-0-991" id="h11-0-991" class="i">+	ev = &amp;e-&gt;xkey;
</a><a href="#h11-0-992" id="h11-0-992" class="i">+	keysym = XKeycodeToKeysym(dpy, (KeyCode)ev-&gt;keycode, 0);
</a><a href="#h11-0-993" id="h11-0-993" class="i">+	for (i = 0; i &lt; LENGTH(keys); i++)
</a><a href="#h11-0-994" id="h11-0-994" class="i">+		if (keysym == keys[i].keysym
</a><a href="#h11-0-995" id="h11-0-995" class="i">+		&amp;&amp; CLEANMASK(keys[i].mod) == CLEANMASK(ev-&gt;state)
</a><a href="#h11-0-996" id="h11-0-996" class="i">+		&amp;&amp; keys[i].func)
</a><a href="#h11-0-997" id="h11-0-997" class="i">+			keys[i].func(&amp;(keys[i].arg));
</a><a href="#h11-0-998" id="h11-0-998" class="i">+}
</a><a href="#h11-0-999" id="h11-0-999" class="i">+
</a><a href="#h11-0-1000" id="h11-0-1000" class="i">+void
</a><a href="#h11-0-1001" id="h11-0-1001" class="i">+killclient(const Arg *arg)
</a><a href="#h11-0-1002" id="h11-0-1002" class="i">+{
</a><a href="#h11-0-1003" id="h11-0-1003" class="i">+	if (!selmon-&gt;sel)
</a><a href="#h11-0-1004" id="h11-0-1004" class="i">+		return;
</a><a href="#h11-0-1005" id="h11-0-1005" class="i">+	if (!sendevent(selmon-&gt;sel, wmatom[WMDelete])) {
</a><a href="#h11-0-1006" id="h11-0-1006" class="i">+		XGrabServer(dpy);
</a><a href="#h11-0-1007" id="h11-0-1007" class="i">+		XSetErrorHandler(xerrordummy);
</a><a href="#h11-0-1008" id="h11-0-1008" class="i">+		XSetCloseDownMode(dpy, DestroyAll);
</a><a href="#h11-0-1009" id="h11-0-1009" class="i">+		XKillClient(dpy, selmon-&gt;sel-&gt;win);
</a><a href="#h11-0-1010" id="h11-0-1010" class="i">+		XSync(dpy, False);
</a><a href="#h11-0-1011" id="h11-0-1011" class="i">+		XSetErrorHandler(xerror);
</a><a href="#h11-0-1012" id="h11-0-1012" class="i">+		XUngrabServer(dpy);
</a><a href="#h11-0-1013" id="h11-0-1013" class="i">+	}
</a><a href="#h11-0-1014" id="h11-0-1014" class="i">+}
</a><a href="#h11-0-1015" id="h11-0-1015" class="i">+
</a><a href="#h11-0-1016" id="h11-0-1016" class="i">+void
</a><a href="#h11-0-1017" id="h11-0-1017" class="i">+manage(Window w, XWindowAttributes *wa)
</a><a href="#h11-0-1018" id="h11-0-1018" class="i">+{
</a><a href="#h11-0-1019" id="h11-0-1019" class="i">+	Client *c, *t = NULL;
</a><a href="#h11-0-1020" id="h11-0-1020" class="i">+	Window trans = None;
</a><a href="#h11-0-1021" id="h11-0-1021" class="i">+	XWindowChanges wc;
</a><a href="#h11-0-1022" id="h11-0-1022" class="i">+
</a><a href="#h11-0-1023" id="h11-0-1023" class="i">+	c = ecalloc(1, sizeof(Client));
</a><a href="#h11-0-1024" id="h11-0-1024" class="i">+	c-&gt;win = w;
</a><a href="#h11-0-1025" id="h11-0-1025" class="i">+	/* geometry */
</a><a href="#h11-0-1026" id="h11-0-1026" class="i">+	c-&gt;x = c-&gt;oldx = wa-&gt;x;
</a><a href="#h11-0-1027" id="h11-0-1027" class="i">+	c-&gt;y = c-&gt;oldy = wa-&gt;y;
</a><a href="#h11-0-1028" id="h11-0-1028" class="i">+	c-&gt;w = c-&gt;oldw = wa-&gt;width;
</a><a href="#h11-0-1029" id="h11-0-1029" class="i">+	c-&gt;h = c-&gt;oldh = wa-&gt;height;
</a><a href="#h11-0-1030" id="h11-0-1030" class="i">+	c-&gt;oldbw = wa-&gt;border_width;
</a><a href="#h11-0-1031" id="h11-0-1031" class="i">+
</a><a href="#h11-0-1032" id="h11-0-1032" class="i">+	updatetitle(c);
</a><a href="#h11-0-1033" id="h11-0-1033" class="i">+	if (XGetTransientForHint(dpy, w, &amp;trans) &amp;&amp; (t = wintoclient(trans))) {
</a><a href="#h11-0-1034" id="h11-0-1034" class="i">+		c-&gt;mon = t-&gt;mon;
</a><a href="#h11-0-1035" id="h11-0-1035" class="i">+		c-&gt;tags = t-&gt;tags;
</a><a href="#h11-0-1036" id="h11-0-1036" class="i">+	} else {
</a><a href="#h11-0-1037" id="h11-0-1037" class="i">+		c-&gt;mon = selmon;
</a><a href="#h11-0-1038" id="h11-0-1038" class="i">+		applyrules(c);
</a><a href="#h11-0-1039" id="h11-0-1039" class="i">+	}
</a><a href="#h11-0-1040" id="h11-0-1040" class="i">+
</a><a href="#h11-0-1041" id="h11-0-1041" class="i">+	if (c-&gt;x + WIDTH(c) &gt; c-&gt;mon-&gt;mx + c-&gt;mon-&gt;mw)
</a><a href="#h11-0-1042" id="h11-0-1042" class="i">+		c-&gt;x = c-&gt;mon-&gt;mx + c-&gt;mon-&gt;mw - WIDTH(c);
</a><a href="#h11-0-1043" id="h11-0-1043" class="i">+	if (c-&gt;y + HEIGHT(c) &gt; c-&gt;mon-&gt;my + c-&gt;mon-&gt;mh)
</a><a href="#h11-0-1044" id="h11-0-1044" class="i">+		c-&gt;y = c-&gt;mon-&gt;my + c-&gt;mon-&gt;mh - HEIGHT(c);
</a><a href="#h11-0-1045" id="h11-0-1045" class="i">+	c-&gt;x = MAX(c-&gt;x, c-&gt;mon-&gt;mx);
</a><a href="#h11-0-1046" id="h11-0-1046" class="i">+	/* only fix client y-offset, if the client center might cover the bar */
</a><a href="#h11-0-1047" id="h11-0-1047" class="i">+	c-&gt;y = MAX(c-&gt;y, ((c-&gt;mon-&gt;by == c-&gt;mon-&gt;my) &amp;&amp; (c-&gt;x + (c-&gt;w / 2) &gt;= c-&gt;mon-&gt;wx)
</a><a href="#h11-0-1048" id="h11-0-1048" class="i">+		&amp;&amp; (c-&gt;x + (c-&gt;w / 2) &lt; c-&gt;mon-&gt;wx + c-&gt;mon-&gt;ww)) ? bh : c-&gt;mon-&gt;my);
</a><a href="#h11-0-1049" id="h11-0-1049" class="i">+	c-&gt;bw = borderpx;
</a><a href="#h11-0-1050" id="h11-0-1050" class="i">+
</a><a href="#h11-0-1051" id="h11-0-1051" class="i">+	wc.border_width = c-&gt;bw;
</a><a href="#h11-0-1052" id="h11-0-1052" class="i">+	XConfigureWindow(dpy, w, CWBorderWidth, &amp;wc);
</a><a href="#h11-0-1053" id="h11-0-1053" class="i">+	XSetWindowBorder(dpy, w, scheme[SchemeNorm][ColBorder].pixel);
</a><a href="#h11-0-1054" id="h11-0-1054" class="i">+	configure(c); /* propagates border_width, if size doesn&#39;t change */
</a><a href="#h11-0-1055" id="h11-0-1055" class="i">+	updatewindowtype(c);
</a><a href="#h11-0-1056" id="h11-0-1056" class="i">+	updatesizehints(c);
</a><a href="#h11-0-1057" id="h11-0-1057" class="i">+	updatewmhints(c);
</a><a href="#h11-0-1058" id="h11-0-1058" class="i">+	XSelectInput(dpy, w, EnterWindowMask|FocusChangeMask|PropertyChangeMask|StructureNotifyMask);
</a><a href="#h11-0-1059" id="h11-0-1059" class="i">+	grabbuttons(c, 0);
</a><a href="#h11-0-1060" id="h11-0-1060" class="i">+	if (!c-&gt;isfloating)
</a><a href="#h11-0-1061" id="h11-0-1061" class="i">+		c-&gt;isfloating = c-&gt;oldstate = trans != None || c-&gt;isfixed;
</a><a href="#h11-0-1062" id="h11-0-1062" class="i">+	if (c-&gt;isfloating)
</a><a href="#h11-0-1063" id="h11-0-1063" class="i">+		XRaiseWindow(dpy, c-&gt;win);
</a><a href="#h11-0-1064" id="h11-0-1064" class="i">+	attach(c);
</a><a href="#h11-0-1065" id="h11-0-1065" class="i">+	attachstack(c);
</a><a href="#h11-0-1066" id="h11-0-1066" class="i">+	XChangeProperty(dpy, root, netatom[NetClientList], XA_WINDOW, 32, PropModeAppend,
</a><a href="#h11-0-1067" id="h11-0-1067" class="i">+		(unsigned char *) &amp;(c-&gt;win), 1);
</a><a href="#h11-0-1068" id="h11-0-1068" class="i">+	XMoveResizeWindow(dpy, c-&gt;win, c-&gt;x + 2 * sw, c-&gt;y, c-&gt;w, c-&gt;h); /* some windows require this */
</a><a href="#h11-0-1069" id="h11-0-1069" class="i">+	setclientstate(c, NormalState);
</a><a href="#h11-0-1070" id="h11-0-1070" class="i">+	if (c-&gt;mon == selmon)
</a><a href="#h11-0-1071" id="h11-0-1071" class="i">+		unfocus(selmon-&gt;sel, 0);
</a><a href="#h11-0-1072" id="h11-0-1072" class="i">+	c-&gt;mon-&gt;sel = c;
</a><a href="#h11-0-1073" id="h11-0-1073" class="i">+	arrange(c-&gt;mon);
</a><a href="#h11-0-1074" id="h11-0-1074" class="i">+	XMapWindow(dpy, c-&gt;win);
</a><a href="#h11-0-1075" id="h11-0-1075" class="i">+	focus(NULL);
</a><a href="#h11-0-1076" id="h11-0-1076" class="i">+}
</a><a href="#h11-0-1077" id="h11-0-1077" class="i">+
</a><a href="#h11-0-1078" id="h11-0-1078" class="i">+void
</a><a href="#h11-0-1079" id="h11-0-1079" class="i">+mappingnotify(XEvent *e)
</a><a href="#h11-0-1080" id="h11-0-1080" class="i">+{
</a><a href="#h11-0-1081" id="h11-0-1081" class="i">+	XMappingEvent *ev = &amp;e-&gt;xmapping;
</a><a href="#h11-0-1082" id="h11-0-1082" class="i">+
</a><a href="#h11-0-1083" id="h11-0-1083" class="i">+	XRefreshKeyboardMapping(ev);
</a><a href="#h11-0-1084" id="h11-0-1084" class="i">+	if (ev-&gt;request == MappingKeyboard)
</a><a href="#h11-0-1085" id="h11-0-1085" class="i">+		grabkeys();
</a><a href="#h11-0-1086" id="h11-0-1086" class="i">+}
</a><a href="#h11-0-1087" id="h11-0-1087" class="i">+
</a><a href="#h11-0-1088" id="h11-0-1088" class="i">+void
</a><a href="#h11-0-1089" id="h11-0-1089" class="i">+maprequest(XEvent *e)
</a><a href="#h11-0-1090" id="h11-0-1090" class="i">+{
</a><a href="#h11-0-1091" id="h11-0-1091" class="i">+	static XWindowAttributes wa;
</a><a href="#h11-0-1092" id="h11-0-1092" class="i">+	XMapRequestEvent *ev = &amp;e-&gt;xmaprequest;
</a><a href="#h11-0-1093" id="h11-0-1093" class="i">+
</a><a href="#h11-0-1094" id="h11-0-1094" class="i">+	if (!XGetWindowAttributes(dpy, ev-&gt;window, &amp;wa))
</a><a href="#h11-0-1095" id="h11-0-1095" class="i">+		return;
</a><a href="#h11-0-1096" id="h11-0-1096" class="i">+	if (wa.override_redirect)
</a><a href="#h11-0-1097" id="h11-0-1097" class="i">+		return;
</a><a href="#h11-0-1098" id="h11-0-1098" class="i">+	if (!wintoclient(ev-&gt;window))
</a><a href="#h11-0-1099" id="h11-0-1099" class="i">+		manage(ev-&gt;window, &amp;wa);
</a><a href="#h11-0-1100" id="h11-0-1100" class="i">+}
</a><a href="#h11-0-1101" id="h11-0-1101" class="i">+
</a><a href="#h11-0-1102" id="h11-0-1102" class="i">+void
</a><a href="#h11-0-1103" id="h11-0-1103" class="i">+monocle(Monitor *m)
</a><a href="#h11-0-1104" id="h11-0-1104" class="i">+{
</a><a href="#h11-0-1105" id="h11-0-1105" class="i">+	unsigned int n = 0;
</a><a href="#h11-0-1106" id="h11-0-1106" class="i">+	Client *c;
</a><a href="#h11-0-1107" id="h11-0-1107" class="i">+
</a><a href="#h11-0-1108" id="h11-0-1108" class="i">+	for (c = m-&gt;clients; c; c = c-&gt;next)
</a><a href="#h11-0-1109" id="h11-0-1109" class="i">+		if (ISVISIBLE(c))
</a><a href="#h11-0-1110" id="h11-0-1110" class="i">+			n++;
</a><a href="#h11-0-1111" id="h11-0-1111" class="i">+	if (n &gt; 0) /* override layout symbol */
</a><a href="#h11-0-1112" id="h11-0-1112" class="i">+		snprintf(m-&gt;ltsymbol, sizeof m-&gt;ltsymbol, &quot;[%d]&quot;, n);
</a><a href="#h11-0-1113" id="h11-0-1113" class="i">+	for (c = nexttiled(m-&gt;clients); c; c = nexttiled(c-&gt;next))
</a><a href="#h11-0-1114" id="h11-0-1114" class="i">+		resize(c, m-&gt;wx, m-&gt;wy, m-&gt;ww - 2 * c-&gt;bw, m-&gt;wh - 2 * c-&gt;bw, 0);
</a><a href="#h11-0-1115" id="h11-0-1115" class="i">+}
</a><a href="#h11-0-1116" id="h11-0-1116" class="i">+
</a><a href="#h11-0-1117" id="h11-0-1117" class="i">+void
</a><a href="#h11-0-1118" id="h11-0-1118" class="i">+motionnotify(XEvent *e)
</a><a href="#h11-0-1119" id="h11-0-1119" class="i">+{
</a><a href="#h11-0-1120" id="h11-0-1120" class="i">+	static Monitor *mon = NULL;
</a><a href="#h11-0-1121" id="h11-0-1121" class="i">+	Monitor *m;
</a><a href="#h11-0-1122" id="h11-0-1122" class="i">+	XMotionEvent *ev = &amp;e-&gt;xmotion;
</a><a href="#h11-0-1123" id="h11-0-1123" class="i">+
</a><a href="#h11-0-1124" id="h11-0-1124" class="i">+	if (ev-&gt;window != root)
</a><a href="#h11-0-1125" id="h11-0-1125" class="i">+		return;
</a><a href="#h11-0-1126" id="h11-0-1126" class="i">+	if ((m = recttomon(ev-&gt;x_root, ev-&gt;y_root, 1, 1)) != mon &amp;&amp; mon) {
</a><a href="#h11-0-1127" id="h11-0-1127" class="i">+		unfocus(selmon-&gt;sel, 1);
</a><a href="#h11-0-1128" id="h11-0-1128" class="i">+		selmon = m;
</a><a href="#h11-0-1129" id="h11-0-1129" class="i">+		focus(NULL);
</a><a href="#h11-0-1130" id="h11-0-1130" class="i">+	}
</a><a href="#h11-0-1131" id="h11-0-1131" class="i">+	mon = m;
</a><a href="#h11-0-1132" id="h11-0-1132" class="i">+}
</a><a href="#h11-0-1133" id="h11-0-1133" class="i">+
</a><a href="#h11-0-1134" id="h11-0-1134" class="i">+void
</a><a href="#h11-0-1135" id="h11-0-1135" class="i">+movemouse(const Arg *arg)
</a><a href="#h11-0-1136" id="h11-0-1136" class="i">+{
</a><a href="#h11-0-1137" id="h11-0-1137" class="i">+	int x, y, ocx, ocy, nx, ny;
</a><a href="#h11-0-1138" id="h11-0-1138" class="i">+	Client *c;
</a><a href="#h11-0-1139" id="h11-0-1139" class="i">+	Monitor *m;
</a><a href="#h11-0-1140" id="h11-0-1140" class="i">+	XEvent ev;
</a><a href="#h11-0-1141" id="h11-0-1141" class="i">+	Time lasttime = 0;
</a><a href="#h11-0-1142" id="h11-0-1142" class="i">+
</a><a href="#h11-0-1143" id="h11-0-1143" class="i">+	if (!(c = selmon-&gt;sel))
</a><a href="#h11-0-1144" id="h11-0-1144" class="i">+		return;
</a><a href="#h11-0-1145" id="h11-0-1145" class="i">+	if (c-&gt;isfullscreen) /* no support moving fullscreen windows by mouse */
</a><a href="#h11-0-1146" id="h11-0-1146" class="i">+		return;
</a><a href="#h11-0-1147" id="h11-0-1147" class="i">+	restack(selmon);
</a><a href="#h11-0-1148" id="h11-0-1148" class="i">+	ocx = c-&gt;x;
</a><a href="#h11-0-1149" id="h11-0-1149" class="i">+	ocy = c-&gt;y;
</a><a href="#h11-0-1150" id="h11-0-1150" class="i">+	if (XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
</a><a href="#h11-0-1151" id="h11-0-1151" class="i">+		None, cursor[CurMove]-&gt;cursor, CurrentTime) != GrabSuccess)
</a><a href="#h11-0-1152" id="h11-0-1152" class="i">+		return;
</a><a href="#h11-0-1153" id="h11-0-1153" class="i">+	if (!getrootptr(&amp;x, &amp;y))
</a><a href="#h11-0-1154" id="h11-0-1154" class="i">+		return;
</a><a href="#h11-0-1155" id="h11-0-1155" class="i">+	do {
</a><a href="#h11-0-1156" id="h11-0-1156" class="i">+		XMaskEvent(dpy, MOUSEMASK|ExposureMask|SubstructureRedirectMask, &amp;ev);
</a><a href="#h11-0-1157" id="h11-0-1157" class="i">+		switch(ev.type) {
</a><a href="#h11-0-1158" id="h11-0-1158" class="i">+		case ConfigureRequest:
</a><a href="#h11-0-1159" id="h11-0-1159" class="i">+		case Expose:
</a><a href="#h11-0-1160" id="h11-0-1160" class="i">+		case MapRequest:
</a><a href="#h11-0-1161" id="h11-0-1161" class="i">+			handler[ev.type](&amp;ev);
</a><a href="#h11-0-1162" id="h11-0-1162" class="i">+			break;
</a><a href="#h11-0-1163" id="h11-0-1163" class="i">+		case MotionNotify:
</a><a href="#h11-0-1164" id="h11-0-1164" class="i">+			if ((ev.xmotion.time - lasttime) &lt;= (1000 / 60))
</a><a href="#h11-0-1165" id="h11-0-1165" class="i">+				continue;
</a><a href="#h11-0-1166" id="h11-0-1166" class="i">+			lasttime = ev.xmotion.time;
</a><a href="#h11-0-1167" id="h11-0-1167" class="i">+
</a><a href="#h11-0-1168" id="h11-0-1168" class="i">+			nx = ocx + (ev.xmotion.x - x);
</a><a href="#h11-0-1169" id="h11-0-1169" class="i">+			ny = ocy + (ev.xmotion.y - y);
</a><a href="#h11-0-1170" id="h11-0-1170" class="i">+			if (abs(selmon-&gt;wx - nx) &lt; snap)
</a><a href="#h11-0-1171" id="h11-0-1171" class="i">+				nx = selmon-&gt;wx;
</a><a href="#h11-0-1172" id="h11-0-1172" class="i">+			else if (abs((selmon-&gt;wx + selmon-&gt;ww) - (nx + WIDTH(c))) &lt; snap)
</a><a href="#h11-0-1173" id="h11-0-1173" class="i">+				nx = selmon-&gt;wx + selmon-&gt;ww - WIDTH(c);
</a><a href="#h11-0-1174" id="h11-0-1174" class="i">+			if (abs(selmon-&gt;wy - ny) &lt; snap)
</a><a href="#h11-0-1175" id="h11-0-1175" class="i">+				ny = selmon-&gt;wy;
</a><a href="#h11-0-1176" id="h11-0-1176" class="i">+			else if (abs((selmon-&gt;wy + selmon-&gt;wh) - (ny + HEIGHT(c))) &lt; snap)
</a><a href="#h11-0-1177" id="h11-0-1177" class="i">+				ny = selmon-&gt;wy + selmon-&gt;wh - HEIGHT(c);
</a><a href="#h11-0-1178" id="h11-0-1178" class="i">+			if (!c-&gt;isfloating &amp;&amp; selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange
</a><a href="#h11-0-1179" id="h11-0-1179" class="i">+			&amp;&amp; (abs(nx - c-&gt;x) &gt; snap || abs(ny - c-&gt;y) &gt; snap))
</a><a href="#h11-0-1180" id="h11-0-1180" class="i">+				togglefloating(NULL);
</a><a href="#h11-0-1181" id="h11-0-1181" class="i">+			if (!selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange || c-&gt;isfloating)
</a><a href="#h11-0-1182" id="h11-0-1182" class="i">+				resize(c, nx, ny, c-&gt;w, c-&gt;h, 1);
</a><a href="#h11-0-1183" id="h11-0-1183" class="i">+			break;
</a><a href="#h11-0-1184" id="h11-0-1184" class="i">+		}
</a><a href="#h11-0-1185" id="h11-0-1185" class="i">+	} while (ev.type != ButtonRelease);
</a><a href="#h11-0-1186" id="h11-0-1186" class="i">+	XUngrabPointer(dpy, CurrentTime);
</a><a href="#h11-0-1187" id="h11-0-1187" class="i">+	if ((m = recttomon(c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h)) != selmon) {
</a><a href="#h11-0-1188" id="h11-0-1188" class="i">+		sendmon(c, m);
</a><a href="#h11-0-1189" id="h11-0-1189" class="i">+		selmon = m;
</a><a href="#h11-0-1190" id="h11-0-1190" class="i">+		focus(NULL);
</a><a href="#h11-0-1191" id="h11-0-1191" class="i">+	}
</a><a href="#h11-0-1192" id="h11-0-1192" class="i">+}
</a><a href="#h11-0-1193" id="h11-0-1193" class="i">+
</a><a href="#h11-0-1194" id="h11-0-1194" class="i">+Client *
</a><a href="#h11-0-1195" id="h11-0-1195" class="i">+nexttiled(Client *c)
</a><a href="#h11-0-1196" id="h11-0-1196" class="i">+{
</a><a href="#h11-0-1197" id="h11-0-1197" class="i">+	for (; c &amp;&amp; (c-&gt;isfloating || !ISVISIBLE(c)); c = c-&gt;next);
</a><a href="#h11-0-1198" id="h11-0-1198" class="i">+	return c;
</a><a href="#h11-0-1199" id="h11-0-1199" class="i">+}
</a><a href="#h11-0-1200" id="h11-0-1200" class="i">+
</a><a href="#h11-0-1201" id="h11-0-1201" class="i">+void
</a><a href="#h11-0-1202" id="h11-0-1202" class="i">+pop(Client *c)
</a><a href="#h11-0-1203" id="h11-0-1203" class="i">+{
</a><a href="#h11-0-1204" id="h11-0-1204" class="i">+	detach(c);
</a><a href="#h11-0-1205" id="h11-0-1205" class="i">+	attach(c);
</a><a href="#h11-0-1206" id="h11-0-1206" class="i">+	focus(c);
</a><a href="#h11-0-1207" id="h11-0-1207" class="i">+	arrange(c-&gt;mon);
</a><a href="#h11-0-1208" id="h11-0-1208" class="i">+}
</a><a href="#h11-0-1209" id="h11-0-1209" class="i">+
</a><a href="#h11-0-1210" id="h11-0-1210" class="i">+void
</a><a href="#h11-0-1211" id="h11-0-1211" class="i">+propertynotify(XEvent *e)
</a><a href="#h11-0-1212" id="h11-0-1212" class="i">+{
</a><a href="#h11-0-1213" id="h11-0-1213" class="i">+	Client *c;
</a><a href="#h11-0-1214" id="h11-0-1214" class="i">+	Window trans;
</a><a href="#h11-0-1215" id="h11-0-1215" class="i">+	XPropertyEvent *ev = &amp;e-&gt;xproperty;
</a><a href="#h11-0-1216" id="h11-0-1216" class="i">+
</a><a href="#h11-0-1217" id="h11-0-1217" class="i">+	if ((ev-&gt;window == root) &amp;&amp; (ev-&gt;atom == XA_WM_NAME))
</a><a href="#h11-0-1218" id="h11-0-1218" class="i">+		updatestatus();
</a><a href="#h11-0-1219" id="h11-0-1219" class="i">+	else if (ev-&gt;state == PropertyDelete)
</a><a href="#h11-0-1220" id="h11-0-1220" class="i">+		return; /* ignore */
</a><a href="#h11-0-1221" id="h11-0-1221" class="i">+	else if ((c = wintoclient(ev-&gt;window))) {
</a><a href="#h11-0-1222" id="h11-0-1222" class="i">+		switch(ev-&gt;atom) {
</a><a href="#h11-0-1223" id="h11-0-1223" class="i">+		default: break;
</a><a href="#h11-0-1224" id="h11-0-1224" class="i">+		case XA_WM_TRANSIENT_FOR:
</a><a href="#h11-0-1225" id="h11-0-1225" class="i">+			if (!c-&gt;isfloating &amp;&amp; (XGetTransientForHint(dpy, c-&gt;win, &amp;trans)) &amp;&amp;
</a><a href="#h11-0-1226" id="h11-0-1226" class="i">+				(c-&gt;isfloating = (wintoclient(trans)) != NULL))
</a><a href="#h11-0-1227" id="h11-0-1227" class="i">+				arrange(c-&gt;mon);
</a><a href="#h11-0-1228" id="h11-0-1228" class="i">+			break;
</a><a href="#h11-0-1229" id="h11-0-1229" class="i">+		case XA_WM_NORMAL_HINTS:
</a><a href="#h11-0-1230" id="h11-0-1230" class="i">+			updatesizehints(c);
</a><a href="#h11-0-1231" id="h11-0-1231" class="i">+			break;
</a><a href="#h11-0-1232" id="h11-0-1232" class="i">+		case XA_WM_HINTS:
</a><a href="#h11-0-1233" id="h11-0-1233" class="i">+			updatewmhints(c);
</a><a href="#h11-0-1234" id="h11-0-1234" class="i">+			drawbars();
</a><a href="#h11-0-1235" id="h11-0-1235" class="i">+			break;
</a><a href="#h11-0-1236" id="h11-0-1236" class="i">+		}
</a><a href="#h11-0-1237" id="h11-0-1237" class="i">+		if (ev-&gt;atom == XA_WM_NAME || ev-&gt;atom == netatom[NetWMName]) {
</a><a href="#h11-0-1238" id="h11-0-1238" class="i">+			updatetitle(c);
</a><a href="#h11-0-1239" id="h11-0-1239" class="i">+			if (c == c-&gt;mon-&gt;sel)
</a><a href="#h11-0-1240" id="h11-0-1240" class="i">+				drawbar(c-&gt;mon);
</a><a href="#h11-0-1241" id="h11-0-1241" class="i">+		}
</a><a href="#h11-0-1242" id="h11-0-1242" class="i">+		if (ev-&gt;atom == netatom[NetWMWindowType])
</a><a href="#h11-0-1243" id="h11-0-1243" class="i">+			updatewindowtype(c);
</a><a href="#h11-0-1244" id="h11-0-1244" class="i">+	}
</a><a href="#h11-0-1245" id="h11-0-1245" class="i">+}
</a><a href="#h11-0-1246" id="h11-0-1246" class="i">+
</a><a href="#h11-0-1247" id="h11-0-1247" class="i">+void
</a><a href="#h11-0-1248" id="h11-0-1248" class="i">+quit(const Arg *arg)
</a><a href="#h11-0-1249" id="h11-0-1249" class="i">+{
</a><a href="#h11-0-1250" id="h11-0-1250" class="i">+	running = 0;
</a><a href="#h11-0-1251" id="h11-0-1251" class="i">+}
</a><a href="#h11-0-1252" id="h11-0-1252" class="i">+
</a><a href="#h11-0-1253" id="h11-0-1253" class="i">+Monitor *
</a><a href="#h11-0-1254" id="h11-0-1254" class="i">+recttomon(int x, int y, int w, int h)
</a><a href="#h11-0-1255" id="h11-0-1255" class="i">+{
</a><a href="#h11-0-1256" id="h11-0-1256" class="i">+	Monitor *m, *r = selmon;
</a><a href="#h11-0-1257" id="h11-0-1257" class="i">+	int a, area = 0;
</a><a href="#h11-0-1258" id="h11-0-1258" class="i">+
</a><a href="#h11-0-1259" id="h11-0-1259" class="i">+	for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-1260" id="h11-0-1260" class="i">+		if ((a = INTERSECT(x, y, w, h, m)) &gt; area) {
</a><a href="#h11-0-1261" id="h11-0-1261" class="i">+			area = a;
</a><a href="#h11-0-1262" id="h11-0-1262" class="i">+			r = m;
</a><a href="#h11-0-1263" id="h11-0-1263" class="i">+		}
</a><a href="#h11-0-1264" id="h11-0-1264" class="i">+	return r;
</a><a href="#h11-0-1265" id="h11-0-1265" class="i">+}
</a><a href="#h11-0-1266" id="h11-0-1266" class="i">+
</a><a href="#h11-0-1267" id="h11-0-1267" class="i">+void
</a><a href="#h11-0-1268" id="h11-0-1268" class="i">+resize(Client *c, int x, int y, int w, int h, int interact)
</a><a href="#h11-0-1269" id="h11-0-1269" class="i">+{
</a><a href="#h11-0-1270" id="h11-0-1270" class="i">+	if (applysizehints(c, &amp;x, &amp;y, &amp;w, &amp;h, interact))
</a><a href="#h11-0-1271" id="h11-0-1271" class="i">+		resizeclient(c, x, y, w, h);
</a><a href="#h11-0-1272" id="h11-0-1272" class="i">+}
</a><a href="#h11-0-1273" id="h11-0-1273" class="i">+
</a><a href="#h11-0-1274" id="h11-0-1274" class="i">+void
</a><a href="#h11-0-1275" id="h11-0-1275" class="i">+resizeclient(Client *c, int x, int y, int w, int h)
</a><a href="#h11-0-1276" id="h11-0-1276" class="i">+{
</a><a href="#h11-0-1277" id="h11-0-1277" class="i">+	XWindowChanges wc;
</a><a href="#h11-0-1278" id="h11-0-1278" class="i">+
</a><a href="#h11-0-1279" id="h11-0-1279" class="i">+	c-&gt;oldx = c-&gt;x; c-&gt;x = wc.x = x;
</a><a href="#h11-0-1280" id="h11-0-1280" class="i">+	c-&gt;oldy = c-&gt;y; c-&gt;y = wc.y = y;
</a><a href="#h11-0-1281" id="h11-0-1281" class="i">+	c-&gt;oldw = c-&gt;w; c-&gt;w = wc.width = w;
</a><a href="#h11-0-1282" id="h11-0-1282" class="i">+	c-&gt;oldh = c-&gt;h; c-&gt;h = wc.height = h;
</a><a href="#h11-0-1283" id="h11-0-1283" class="i">+	wc.border_width = c-&gt;bw;
</a><a href="#h11-0-1284" id="h11-0-1284" class="i">+	XConfigureWindow(dpy, c-&gt;win, CWX|CWY|CWWidth|CWHeight|CWBorderWidth, &amp;wc);
</a><a href="#h11-0-1285" id="h11-0-1285" class="i">+	configure(c);
</a><a href="#h11-0-1286" id="h11-0-1286" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-1287" id="h11-0-1287" class="i">+}
</a><a href="#h11-0-1288" id="h11-0-1288" class="i">+
</a><a href="#h11-0-1289" id="h11-0-1289" class="i">+void
</a><a href="#h11-0-1290" id="h11-0-1290" class="i">+resizemouse(const Arg *arg)
</a><a href="#h11-0-1291" id="h11-0-1291" class="i">+{
</a><a href="#h11-0-1292" id="h11-0-1292" class="i">+	int ocx, ocy, nw, nh;
</a><a href="#h11-0-1293" id="h11-0-1293" class="i">+	Client *c;
</a><a href="#h11-0-1294" id="h11-0-1294" class="i">+	Monitor *m;
</a><a href="#h11-0-1295" id="h11-0-1295" class="i">+	XEvent ev;
</a><a href="#h11-0-1296" id="h11-0-1296" class="i">+	Time lasttime = 0;
</a><a href="#h11-0-1297" id="h11-0-1297" class="i">+
</a><a href="#h11-0-1298" id="h11-0-1298" class="i">+	if (!(c = selmon-&gt;sel))
</a><a href="#h11-0-1299" id="h11-0-1299" class="i">+		return;
</a><a href="#h11-0-1300" id="h11-0-1300" class="i">+	if (c-&gt;isfullscreen) /* no support resizing fullscreen windows by mouse */
</a><a href="#h11-0-1301" id="h11-0-1301" class="i">+		return;
</a><a href="#h11-0-1302" id="h11-0-1302" class="i">+	restack(selmon);
</a><a href="#h11-0-1303" id="h11-0-1303" class="i">+	ocx = c-&gt;x;
</a><a href="#h11-0-1304" id="h11-0-1304" class="i">+	ocy = c-&gt;y;
</a><a href="#h11-0-1305" id="h11-0-1305" class="i">+	if (XGrabPointer(dpy, root, False, MOUSEMASK, GrabModeAsync, GrabModeAsync,
</a><a href="#h11-0-1306" id="h11-0-1306" class="i">+		None, cursor[CurResize]-&gt;cursor, CurrentTime) != GrabSuccess)
</a><a href="#h11-0-1307" id="h11-0-1307" class="i">+		return;
</a><a href="#h11-0-1308" id="h11-0-1308" class="i">+	XWarpPointer(dpy, None, c-&gt;win, 0, 0, 0, 0, c-&gt;w + c-&gt;bw - 1, c-&gt;h + c-&gt;bw - 1);
</a><a href="#h11-0-1309" id="h11-0-1309" class="i">+	do {
</a><a href="#h11-0-1310" id="h11-0-1310" class="i">+		XMaskEvent(dpy, MOUSEMASK|ExposureMask|SubstructureRedirectMask, &amp;ev);
</a><a href="#h11-0-1311" id="h11-0-1311" class="i">+		switch(ev.type) {
</a><a href="#h11-0-1312" id="h11-0-1312" class="i">+		case ConfigureRequest:
</a><a href="#h11-0-1313" id="h11-0-1313" class="i">+		case Expose:
</a><a href="#h11-0-1314" id="h11-0-1314" class="i">+		case MapRequest:
</a><a href="#h11-0-1315" id="h11-0-1315" class="i">+			handler[ev.type](&amp;ev);
</a><a href="#h11-0-1316" id="h11-0-1316" class="i">+			break;
</a><a href="#h11-0-1317" id="h11-0-1317" class="i">+		case MotionNotify:
</a><a href="#h11-0-1318" id="h11-0-1318" class="i">+			if ((ev.xmotion.time - lasttime) &lt;= (1000 / 60))
</a><a href="#h11-0-1319" id="h11-0-1319" class="i">+				continue;
</a><a href="#h11-0-1320" id="h11-0-1320" class="i">+			lasttime = ev.xmotion.time;
</a><a href="#h11-0-1321" id="h11-0-1321" class="i">+
</a><a href="#h11-0-1322" id="h11-0-1322" class="i">+			nw = MAX(ev.xmotion.x - ocx - 2 * c-&gt;bw + 1, 1);
</a><a href="#h11-0-1323" id="h11-0-1323" class="i">+			nh = MAX(ev.xmotion.y - ocy - 2 * c-&gt;bw + 1, 1);
</a><a href="#h11-0-1324" id="h11-0-1324" class="i">+			if (c-&gt;mon-&gt;wx + nw &gt;= selmon-&gt;wx &amp;&amp; c-&gt;mon-&gt;wx + nw &lt;= selmon-&gt;wx + selmon-&gt;ww
</a><a href="#h11-0-1325" id="h11-0-1325" class="i">+			&amp;&amp; c-&gt;mon-&gt;wy + nh &gt;= selmon-&gt;wy &amp;&amp; c-&gt;mon-&gt;wy + nh &lt;= selmon-&gt;wy + selmon-&gt;wh)
</a><a href="#h11-0-1326" id="h11-0-1326" class="i">+			{
</a><a href="#h11-0-1327" id="h11-0-1327" class="i">+				if (!c-&gt;isfloating &amp;&amp; selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange
</a><a href="#h11-0-1328" id="h11-0-1328" class="i">+				&amp;&amp; (abs(nw - c-&gt;w) &gt; snap || abs(nh - c-&gt;h) &gt; snap))
</a><a href="#h11-0-1329" id="h11-0-1329" class="i">+					togglefloating(NULL);
</a><a href="#h11-0-1330" id="h11-0-1330" class="i">+			}
</a><a href="#h11-0-1331" id="h11-0-1331" class="i">+			if (!selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange || c-&gt;isfloating)
</a><a href="#h11-0-1332" id="h11-0-1332" class="i">+				resize(c, c-&gt;x, c-&gt;y, nw, nh, 1);
</a><a href="#h11-0-1333" id="h11-0-1333" class="i">+			break;
</a><a href="#h11-0-1334" id="h11-0-1334" class="i">+		}
</a><a href="#h11-0-1335" id="h11-0-1335" class="i">+	} while (ev.type != ButtonRelease);
</a><a href="#h11-0-1336" id="h11-0-1336" class="i">+	XWarpPointer(dpy, None, c-&gt;win, 0, 0, 0, 0, c-&gt;w + c-&gt;bw - 1, c-&gt;h + c-&gt;bw - 1);
</a><a href="#h11-0-1337" id="h11-0-1337" class="i">+	XUngrabPointer(dpy, CurrentTime);
</a><a href="#h11-0-1338" id="h11-0-1338" class="i">+	while (XCheckMaskEvent(dpy, EnterWindowMask, &amp;ev));
</a><a href="#h11-0-1339" id="h11-0-1339" class="i">+	if ((m = recttomon(c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h)) != selmon) {
</a><a href="#h11-0-1340" id="h11-0-1340" class="i">+		sendmon(c, m);
</a><a href="#h11-0-1341" id="h11-0-1341" class="i">+		selmon = m;
</a><a href="#h11-0-1342" id="h11-0-1342" class="i">+		focus(NULL);
</a><a href="#h11-0-1343" id="h11-0-1343" class="i">+	}
</a><a href="#h11-0-1344" id="h11-0-1344" class="i">+}
</a><a href="#h11-0-1345" id="h11-0-1345" class="i">+
</a><a href="#h11-0-1346" id="h11-0-1346" class="i">+void
</a><a href="#h11-0-1347" id="h11-0-1347" class="i">+restack(Monitor *m)
</a><a href="#h11-0-1348" id="h11-0-1348" class="i">+{
</a><a href="#h11-0-1349" id="h11-0-1349" class="i">+	Client *c;
</a><a href="#h11-0-1350" id="h11-0-1350" class="i">+	XEvent ev;
</a><a href="#h11-0-1351" id="h11-0-1351" class="i">+	XWindowChanges wc;
</a><a href="#h11-0-1352" id="h11-0-1352" class="i">+
</a><a href="#h11-0-1353" id="h11-0-1353" class="i">+	drawbar(m);
</a><a href="#h11-0-1354" id="h11-0-1354" class="i">+	if (!m-&gt;sel)
</a><a href="#h11-0-1355" id="h11-0-1355" class="i">+		return;
</a><a href="#h11-0-1356" id="h11-0-1356" class="i">+	if (m-&gt;sel-&gt;isfloating || !m-&gt;lt[m-&gt;sellt]-&gt;arrange)
</a><a href="#h11-0-1357" id="h11-0-1357" class="i">+		XRaiseWindow(dpy, m-&gt;sel-&gt;win);
</a><a href="#h11-0-1358" id="h11-0-1358" class="i">+	if (m-&gt;lt[m-&gt;sellt]-&gt;arrange) {
</a><a href="#h11-0-1359" id="h11-0-1359" class="i">+		wc.stack_mode = Below;
</a><a href="#h11-0-1360" id="h11-0-1360" class="i">+		wc.sibling = m-&gt;barwin;
</a><a href="#h11-0-1361" id="h11-0-1361" class="i">+		for (c = m-&gt;stack; c; c = c-&gt;snext)
</a><a href="#h11-0-1362" id="h11-0-1362" class="i">+			if (!c-&gt;isfloating &amp;&amp; ISVISIBLE(c)) {
</a><a href="#h11-0-1363" id="h11-0-1363" class="i">+				XConfigureWindow(dpy, c-&gt;win, CWSibling|CWStackMode, &amp;wc);
</a><a href="#h11-0-1364" id="h11-0-1364" class="i">+				wc.sibling = c-&gt;win;
</a><a href="#h11-0-1365" id="h11-0-1365" class="i">+			}
</a><a href="#h11-0-1366" id="h11-0-1366" class="i">+	}
</a><a href="#h11-0-1367" id="h11-0-1367" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-1368" id="h11-0-1368" class="i">+	while (XCheckMaskEvent(dpy, EnterWindowMask, &amp;ev));
</a><a href="#h11-0-1369" id="h11-0-1369" class="i">+}
</a><a href="#h11-0-1370" id="h11-0-1370" class="i">+
</a><a href="#h11-0-1371" id="h11-0-1371" class="i">+void
</a><a href="#h11-0-1372" id="h11-0-1372" class="i">+run(void)
</a><a href="#h11-0-1373" id="h11-0-1373" class="i">+{
</a><a href="#h11-0-1374" id="h11-0-1374" class="i">+	XEvent ev;
</a><a href="#h11-0-1375" id="h11-0-1375" class="i">+	/* main event loop */
</a><a href="#h11-0-1376" id="h11-0-1376" class="i">+	XSync(dpy, False);
</a><a href="#h11-0-1377" id="h11-0-1377" class="i">+	while (running &amp;&amp; !XNextEvent(dpy, &amp;ev))
</a><a href="#h11-0-1378" id="h11-0-1378" class="i">+		if (handler[ev.type])
</a><a href="#h11-0-1379" id="h11-0-1379" class="i">+			handler[ev.type](&amp;ev); /* call handler */
</a><a href="#h11-0-1380" id="h11-0-1380" class="i">+}
</a><a href="#h11-0-1381" id="h11-0-1381" class="i">+
</a><a href="#h11-0-1382" id="h11-0-1382" class="i">+void
</a><a href="#h11-0-1383" id="h11-0-1383" class="i">+scan(void)
</a><a href="#h11-0-1384" id="h11-0-1384" class="i">+{
</a><a href="#h11-0-1385" id="h11-0-1385" class="i">+	unsigned int i, num;
</a><a href="#h11-0-1386" id="h11-0-1386" class="i">+	Window d1, d2, *wins = NULL;
</a><a href="#h11-0-1387" id="h11-0-1387" class="i">+	XWindowAttributes wa;
</a><a href="#h11-0-1388" id="h11-0-1388" class="i">+
</a><a href="#h11-0-1389" id="h11-0-1389" class="i">+	if (XQueryTree(dpy, root, &amp;d1, &amp;d2, &amp;wins, &amp;num)) {
</a><a href="#h11-0-1390" id="h11-0-1390" class="i">+		for (i = 0; i &lt; num; i++) {
</a><a href="#h11-0-1391" id="h11-0-1391" class="i">+			if (!XGetWindowAttributes(dpy, wins[i], &amp;wa)
</a><a href="#h11-0-1392" id="h11-0-1392" class="i">+			|| wa.override_redirect || XGetTransientForHint(dpy, wins[i], &amp;d1))
</a><a href="#h11-0-1393" id="h11-0-1393" class="i">+				continue;
</a><a href="#h11-0-1394" id="h11-0-1394" class="i">+			if (wa.map_state == IsViewable || getstate(wins[i]) == IconicState)
</a><a href="#h11-0-1395" id="h11-0-1395" class="i">+				manage(wins[i], &amp;wa);
</a><a href="#h11-0-1396" id="h11-0-1396" class="i">+		}
</a><a href="#h11-0-1397" id="h11-0-1397" class="i">+		for (i = 0; i &lt; num; i++) { /* now the transients */
</a><a href="#h11-0-1398" id="h11-0-1398" class="i">+			if (!XGetWindowAttributes(dpy, wins[i], &amp;wa))
</a><a href="#h11-0-1399" id="h11-0-1399" class="i">+				continue;
</a><a href="#h11-0-1400" id="h11-0-1400" class="i">+			if (XGetTransientForHint(dpy, wins[i], &amp;d1)
</a><a href="#h11-0-1401" id="h11-0-1401" class="i">+			&amp;&amp; (wa.map_state == IsViewable || getstate(wins[i]) == IconicState))
</a><a href="#h11-0-1402" id="h11-0-1402" class="i">+				manage(wins[i], &amp;wa);
</a><a href="#h11-0-1403" id="h11-0-1403" class="i">+		}
</a><a href="#h11-0-1404" id="h11-0-1404" class="i">+		if (wins)
</a><a href="#h11-0-1405" id="h11-0-1405" class="i">+			XFree(wins);
</a><a href="#h11-0-1406" id="h11-0-1406" class="i">+	}
</a><a href="#h11-0-1407" id="h11-0-1407" class="i">+}
</a><a href="#h11-0-1408" id="h11-0-1408" class="i">+
</a><a href="#h11-0-1409" id="h11-0-1409" class="i">+void
</a><a href="#h11-0-1410" id="h11-0-1410" class="i">+sendmon(Client *c, Monitor *m)
</a><a href="#h11-0-1411" id="h11-0-1411" class="i">+{
</a><a href="#h11-0-1412" id="h11-0-1412" class="i">+	if (c-&gt;mon == m)
</a><a href="#h11-0-1413" id="h11-0-1413" class="i">+		return;
</a><a href="#h11-0-1414" id="h11-0-1414" class="i">+	unfocus(c, 1);
</a><a href="#h11-0-1415" id="h11-0-1415" class="i">+	detach(c);
</a><a href="#h11-0-1416" id="h11-0-1416" class="i">+	detachstack(c);
</a><a href="#h11-0-1417" id="h11-0-1417" class="i">+	c-&gt;mon = m;
</a><a href="#h11-0-1418" id="h11-0-1418" class="i">+	c-&gt;tags = m-&gt;tagset[m-&gt;seltags]; /* assign tags of target monitor */
</a><a href="#h11-0-1419" id="h11-0-1419" class="i">+	attach(c);
</a><a href="#h11-0-1420" id="h11-0-1420" class="i">+	attachstack(c);
</a><a href="#h11-0-1421" id="h11-0-1421" class="i">+	focus(NULL);
</a><a href="#h11-0-1422" id="h11-0-1422" class="i">+	arrange(NULL);
</a><a href="#h11-0-1423" id="h11-0-1423" class="i">+}
</a><a href="#h11-0-1424" id="h11-0-1424" class="i">+
</a><a href="#h11-0-1425" id="h11-0-1425" class="i">+void
</a><a href="#h11-0-1426" id="h11-0-1426" class="i">+setclientstate(Client *c, long state)
</a><a href="#h11-0-1427" id="h11-0-1427" class="i">+{
</a><a href="#h11-0-1428" id="h11-0-1428" class="i">+	long data[] = { state, None };
</a><a href="#h11-0-1429" id="h11-0-1429" class="i">+
</a><a href="#h11-0-1430" id="h11-0-1430" class="i">+	XChangeProperty(dpy, c-&gt;win, wmatom[WMState], wmatom[WMState], 32,
</a><a href="#h11-0-1431" id="h11-0-1431" class="i">+		PropModeReplace, (unsigned char *)data, 2);
</a><a href="#h11-0-1432" id="h11-0-1432" class="i">+}
</a><a href="#h11-0-1433" id="h11-0-1433" class="i">+
</a><a href="#h11-0-1434" id="h11-0-1434" class="i">+int
</a><a href="#h11-0-1435" id="h11-0-1435" class="i">+sendevent(Client *c, Atom proto)
</a><a href="#h11-0-1436" id="h11-0-1436" class="i">+{
</a><a href="#h11-0-1437" id="h11-0-1437" class="i">+	int n;
</a><a href="#h11-0-1438" id="h11-0-1438" class="i">+	Atom *protocols;
</a><a href="#h11-0-1439" id="h11-0-1439" class="i">+	int exists = 0;
</a><a href="#h11-0-1440" id="h11-0-1440" class="i">+	XEvent ev;
</a><a href="#h11-0-1441" id="h11-0-1441" class="i">+
</a><a href="#h11-0-1442" id="h11-0-1442" class="i">+	if (XGetWMProtocols(dpy, c-&gt;win, &amp;protocols, &amp;n)) {
</a><a href="#h11-0-1443" id="h11-0-1443" class="i">+		while (!exists &amp;&amp; n--)
</a><a href="#h11-0-1444" id="h11-0-1444" class="i">+			exists = protocols[n] == proto;
</a><a href="#h11-0-1445" id="h11-0-1445" class="i">+		XFree(protocols);
</a><a href="#h11-0-1446" id="h11-0-1446" class="i">+	}
</a><a href="#h11-0-1447" id="h11-0-1447" class="i">+	if (exists) {
</a><a href="#h11-0-1448" id="h11-0-1448" class="i">+		ev.type = ClientMessage;
</a><a href="#h11-0-1449" id="h11-0-1449" class="i">+		ev.xclient.window = c-&gt;win;
</a><a href="#h11-0-1450" id="h11-0-1450" class="i">+		ev.xclient.message_type = wmatom[WMProtocols];
</a><a href="#h11-0-1451" id="h11-0-1451" class="i">+		ev.xclient.format = 32;
</a><a href="#h11-0-1452" id="h11-0-1452" class="i">+		ev.xclient.data.l[0] = proto;
</a><a href="#h11-0-1453" id="h11-0-1453" class="i">+		ev.xclient.data.l[1] = CurrentTime;
</a><a href="#h11-0-1454" id="h11-0-1454" class="i">+		XSendEvent(dpy, c-&gt;win, False, NoEventMask, &amp;ev);
</a><a href="#h11-0-1455" id="h11-0-1455" class="i">+	}
</a><a href="#h11-0-1456" id="h11-0-1456" class="i">+	return exists;
</a><a href="#h11-0-1457" id="h11-0-1457" class="i">+}
</a><a href="#h11-0-1458" id="h11-0-1458" class="i">+
</a><a href="#h11-0-1459" id="h11-0-1459" class="i">+void
</a><a href="#h11-0-1460" id="h11-0-1460" class="i">+setfocus(Client *c)
</a><a href="#h11-0-1461" id="h11-0-1461" class="i">+{
</a><a href="#h11-0-1462" id="h11-0-1462" class="i">+	if (!c-&gt;neverfocus) {
</a><a href="#h11-0-1463" id="h11-0-1463" class="i">+		XSetInputFocus(dpy, c-&gt;win, RevertToPointerRoot, CurrentTime);
</a><a href="#h11-0-1464" id="h11-0-1464" class="i">+		XChangeProperty(dpy, root, netatom[NetActiveWindow],
</a><a href="#h11-0-1465" id="h11-0-1465" class="i">+			XA_WINDOW, 32, PropModeReplace,
</a><a href="#h11-0-1466" id="h11-0-1466" class="i">+			(unsigned char *) &amp;(c-&gt;win), 1);
</a><a href="#h11-0-1467" id="h11-0-1467" class="i">+	}
</a><a href="#h11-0-1468" id="h11-0-1468" class="i">+	sendevent(c, wmatom[WMTakeFocus]);
</a><a href="#h11-0-1469" id="h11-0-1469" class="i">+}
</a><a href="#h11-0-1470" id="h11-0-1470" class="i">+
</a><a href="#h11-0-1471" id="h11-0-1471" class="i">+void
</a><a href="#h11-0-1472" id="h11-0-1472" class="i">+setfullscreen(Client *c, int fullscreen)
</a><a href="#h11-0-1473" id="h11-0-1473" class="i">+{
</a><a href="#h11-0-1474" id="h11-0-1474" class="i">+	if (fullscreen &amp;&amp; !c-&gt;isfullscreen) {
</a><a href="#h11-0-1475" id="h11-0-1475" class="i">+		XChangeProperty(dpy, c-&gt;win, netatom[NetWMState], XA_ATOM, 32,
</a><a href="#h11-0-1476" id="h11-0-1476" class="i">+			PropModeReplace, (unsigned char*)&amp;netatom[NetWMFullscreen], 1);
</a><a href="#h11-0-1477" id="h11-0-1477" class="i">+		c-&gt;isfullscreen = 1;
</a><a href="#h11-0-1478" id="h11-0-1478" class="i">+		c-&gt;oldstate = c-&gt;isfloating;
</a><a href="#h11-0-1479" id="h11-0-1479" class="i">+		c-&gt;oldbw = c-&gt;bw;
</a><a href="#h11-0-1480" id="h11-0-1480" class="i">+		c-&gt;bw = 0;
</a><a href="#h11-0-1481" id="h11-0-1481" class="i">+		c-&gt;isfloating = 1;
</a><a href="#h11-0-1482" id="h11-0-1482" class="i">+		resizeclient(c, c-&gt;mon-&gt;mx, c-&gt;mon-&gt;my, c-&gt;mon-&gt;mw, c-&gt;mon-&gt;mh);
</a><a href="#h11-0-1483" id="h11-0-1483" class="i">+		XRaiseWindow(dpy, c-&gt;win);
</a><a href="#h11-0-1484" id="h11-0-1484" class="i">+	} else if (!fullscreen &amp;&amp; c-&gt;isfullscreen){
</a><a href="#h11-0-1485" id="h11-0-1485" class="i">+		XChangeProperty(dpy, c-&gt;win, netatom[NetWMState], XA_ATOM, 32,
</a><a href="#h11-0-1486" id="h11-0-1486" class="i">+			PropModeReplace, (unsigned char*)0, 0);
</a><a href="#h11-0-1487" id="h11-0-1487" class="i">+		c-&gt;isfullscreen = 0;
</a><a href="#h11-0-1488" id="h11-0-1488" class="i">+		c-&gt;isfloating = c-&gt;oldstate;
</a><a href="#h11-0-1489" id="h11-0-1489" class="i">+		c-&gt;bw = c-&gt;oldbw;
</a><a href="#h11-0-1490" id="h11-0-1490" class="i">+		c-&gt;x = c-&gt;oldx;
</a><a href="#h11-0-1491" id="h11-0-1491" class="i">+		c-&gt;y = c-&gt;oldy;
</a><a href="#h11-0-1492" id="h11-0-1492" class="i">+		c-&gt;w = c-&gt;oldw;
</a><a href="#h11-0-1493" id="h11-0-1493" class="i">+		c-&gt;h = c-&gt;oldh;
</a><a href="#h11-0-1494" id="h11-0-1494" class="i">+		resizeclient(c, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h);
</a><a href="#h11-0-1495" id="h11-0-1495" class="i">+		arrange(c-&gt;mon);
</a><a href="#h11-0-1496" id="h11-0-1496" class="i">+	}
</a><a href="#h11-0-1497" id="h11-0-1497" class="i">+}
</a><a href="#h11-0-1498" id="h11-0-1498" class="i">+
</a><a href="#h11-0-1499" id="h11-0-1499" class="i">+void
</a><a href="#h11-0-1500" id="h11-0-1500" class="i">+setlayout(const Arg *arg)
</a><a href="#h11-0-1501" id="h11-0-1501" class="i">+{
</a><a href="#h11-0-1502" id="h11-0-1502" class="i">+	if (!arg || !arg-&gt;v || arg-&gt;v != selmon-&gt;lt[selmon-&gt;sellt])
</a><a href="#h11-0-1503" id="h11-0-1503" class="i">+		selmon-&gt;sellt ^= 1;
</a><a href="#h11-0-1504" id="h11-0-1504" class="i">+	if (arg &amp;&amp; arg-&gt;v)
</a><a href="#h11-0-1505" id="h11-0-1505" class="i">+		selmon-&gt;lt[selmon-&gt;sellt] = (Layout *)arg-&gt;v;
</a><a href="#h11-0-1506" id="h11-0-1506" class="i">+	strncpy(selmon-&gt;ltsymbol, selmon-&gt;lt[selmon-&gt;sellt]-&gt;symbol, sizeof selmon-&gt;ltsymbol);
</a><a href="#h11-0-1507" id="h11-0-1507" class="i">+	if (selmon-&gt;sel)
</a><a href="#h11-0-1508" id="h11-0-1508" class="i">+		arrange(selmon);
</a><a href="#h11-0-1509" id="h11-0-1509" class="i">+	else
</a><a href="#h11-0-1510" id="h11-0-1510" class="i">+		drawbar(selmon);
</a><a href="#h11-0-1511" id="h11-0-1511" class="i">+}
</a><a href="#h11-0-1512" id="h11-0-1512" class="i">+
</a><a href="#h11-0-1513" id="h11-0-1513" class="i">+/* arg &gt; 1.0 will set mfact absolutely */
</a><a href="#h11-0-1514" id="h11-0-1514" class="i">+void
</a><a href="#h11-0-1515" id="h11-0-1515" class="i">+setmfact(const Arg *arg)
</a><a href="#h11-0-1516" id="h11-0-1516" class="i">+{
</a><a href="#h11-0-1517" id="h11-0-1517" class="i">+	float f;
</a><a href="#h11-0-1518" id="h11-0-1518" class="i">+
</a><a href="#h11-0-1519" id="h11-0-1519" class="i">+	if (!arg || !selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange)
</a><a href="#h11-0-1520" id="h11-0-1520" class="i">+		return;
</a><a href="#h11-0-1521" id="h11-0-1521" class="i">+	f = arg-&gt;f &lt; 1.0 ? arg-&gt;f + selmon-&gt;mfact : arg-&gt;f - 1.0;
</a><a href="#h11-0-1522" id="h11-0-1522" class="i">+	if (f &lt; 0.1 || f &gt; 0.9)
</a><a href="#h11-0-1523" id="h11-0-1523" class="i">+		return;
</a><a href="#h11-0-1524" id="h11-0-1524" class="i">+	selmon-&gt;mfact = f;
</a><a href="#h11-0-1525" id="h11-0-1525" class="i">+	arrange(selmon);
</a><a href="#h11-0-1526" id="h11-0-1526" class="i">+}
</a><a href="#h11-0-1527" id="h11-0-1527" class="i">+
</a><a href="#h11-0-1528" id="h11-0-1528" class="i">+void
</a><a href="#h11-0-1529" id="h11-0-1529" class="i">+setup(void)
</a><a href="#h11-0-1530" id="h11-0-1530" class="i">+{
</a><a href="#h11-0-1531" id="h11-0-1531" class="i">+	int i;
</a><a href="#h11-0-1532" id="h11-0-1532" class="i">+	XSetWindowAttributes wa;
</a><a href="#h11-0-1533" id="h11-0-1533" class="i">+	Atom utf8string;
</a><a href="#h11-0-1534" id="h11-0-1534" class="i">+
</a><a href="#h11-0-1535" id="h11-0-1535" class="i">+	/* clean up any zombies immediately */
</a><a href="#h11-0-1536" id="h11-0-1536" class="i">+	sigchld(0);
</a><a href="#h11-0-1537" id="h11-0-1537" class="i">+
</a><a href="#h11-0-1538" id="h11-0-1538" class="i">+	/* init screen */
</a><a href="#h11-0-1539" id="h11-0-1539" class="i">+	screen = DefaultScreen(dpy);
</a><a href="#h11-0-1540" id="h11-0-1540" class="i">+	sw = DisplayWidth(dpy, screen);
</a><a href="#h11-0-1541" id="h11-0-1541" class="i">+	sh = DisplayHeight(dpy, screen);
</a><a href="#h11-0-1542" id="h11-0-1542" class="i">+	root = RootWindow(dpy, screen);
</a><a href="#h11-0-1543" id="h11-0-1543" class="i">+	drw = drw_create(dpy, screen, root, sw, sh);
</a><a href="#h11-0-1544" id="h11-0-1544" class="i">+	if (!drw_fontset_create(drw, fonts, LENGTH(fonts)))
</a><a href="#h11-0-1545" id="h11-0-1545" class="i">+		die(&quot;no fonts could be loaded.&quot;);
</a><a href="#h11-0-1546" id="h11-0-1546" class="i">+	lrpad = drw-&gt;fonts-&gt;h;
</a><a href="#h11-0-1547" id="h11-0-1547" class="i">+	bh = drw-&gt;fonts-&gt;h + 2;
</a><a href="#h11-0-1548" id="h11-0-1548" class="i">+	updategeom();
</a><a href="#h11-0-1549" id="h11-0-1549" class="i">+	/* init atoms */
</a><a href="#h11-0-1550" id="h11-0-1550" class="i">+	utf8string = XInternAtom(dpy, &quot;UTF8_STRING&quot;, False);
</a><a href="#h11-0-1551" id="h11-0-1551" class="i">+	wmatom[WMProtocols] = XInternAtom(dpy, &quot;WM_PROTOCOLS&quot;, False);
</a><a href="#h11-0-1552" id="h11-0-1552" class="i">+	wmatom[WMDelete] = XInternAtom(dpy, &quot;WM_DELETE_WINDOW&quot;, False);
</a><a href="#h11-0-1553" id="h11-0-1553" class="i">+	wmatom[WMState] = XInternAtom(dpy, &quot;WM_STATE&quot;, False);
</a><a href="#h11-0-1554" id="h11-0-1554" class="i">+	wmatom[WMTakeFocus] = XInternAtom(dpy, &quot;WM_TAKE_FOCUS&quot;, False);
</a><a href="#h11-0-1555" id="h11-0-1555" class="i">+	netatom[NetActiveWindow] = XInternAtom(dpy, &quot;_NET_ACTIVE_WINDOW&quot;, False);
</a><a href="#h11-0-1556" id="h11-0-1556" class="i">+	netatom[NetSupported] = XInternAtom(dpy, &quot;_NET_SUPPORTED&quot;, False);
</a><a href="#h11-0-1557" id="h11-0-1557" class="i">+	netatom[NetWMName] = XInternAtom(dpy, &quot;_NET_WM_NAME&quot;, False);
</a><a href="#h11-0-1558" id="h11-0-1558" class="i">+	netatom[NetWMState] = XInternAtom(dpy, &quot;_NET_WM_STATE&quot;, False);
</a><a href="#h11-0-1559" id="h11-0-1559" class="i">+	netatom[NetWMCheck] = XInternAtom(dpy, &quot;_NET_SUPPORTING_WM_CHECK&quot;, False);
</a><a href="#h11-0-1560" id="h11-0-1560" class="i">+	netatom[NetWMFullscreen] = XInternAtom(dpy, &quot;_NET_WM_STATE_FULLSCREEN&quot;, False);
</a><a href="#h11-0-1561" id="h11-0-1561" class="i">+	netatom[NetWMWindowType] = XInternAtom(dpy, &quot;_NET_WM_WINDOW_TYPE&quot;, False);
</a><a href="#h11-0-1562" id="h11-0-1562" class="i">+	netatom[NetWMWindowTypeDialog] = XInternAtom(dpy, &quot;_NET_WM_WINDOW_TYPE_DIALOG&quot;, False);
</a><a href="#h11-0-1563" id="h11-0-1563" class="i">+	netatom[NetClientList] = XInternAtom(dpy, &quot;_NET_CLIENT_LIST&quot;, False);
</a><a href="#h11-0-1564" id="h11-0-1564" class="i">+	/* init cursors */
</a><a href="#h11-0-1565" id="h11-0-1565" class="i">+	cursor[CurNormal] = drw_cur_create(drw, XC_left_ptr);
</a><a href="#h11-0-1566" id="h11-0-1566" class="i">+	cursor[CurResize] = drw_cur_create(drw, XC_sizing);
</a><a href="#h11-0-1567" id="h11-0-1567" class="i">+	cursor[CurMove] = drw_cur_create(drw, XC_fleur);
</a><a href="#h11-0-1568" id="h11-0-1568" class="i">+	/* init appearance */
</a><a href="#h11-0-1569" id="h11-0-1569" class="i">+	scheme = ecalloc(LENGTH(colors), sizeof(Clr *));
</a><a href="#h11-0-1570" id="h11-0-1570" class="i">+	for (i = 0; i &lt; LENGTH(colors); i++)
</a><a href="#h11-0-1571" id="h11-0-1571" class="i">+		scheme[i] = drw_scm_create(drw, colors[i], 3);
</a><a href="#h11-0-1572" id="h11-0-1572" class="i">+	/* init bars */
</a><a href="#h11-0-1573" id="h11-0-1573" class="i">+	updatebars();
</a><a href="#h11-0-1574" id="h11-0-1574" class="i">+	updatestatus();
</a><a href="#h11-0-1575" id="h11-0-1575" class="i">+	/* supporting window for NetWMCheck */
</a><a href="#h11-0-1576" id="h11-0-1576" class="i">+	wmcheckwin = XCreateSimpleWindow(dpy, root, 0, 0, 1, 1, 0, 0, 0);
</a><a href="#h11-0-1577" id="h11-0-1577" class="i">+	XChangeProperty(dpy, wmcheckwin, netatom[NetWMCheck], XA_WINDOW, 32,
</a><a href="#h11-0-1578" id="h11-0-1578" class="i">+		PropModeReplace, (unsigned char *) &amp;wmcheckwin, 1);
</a><a href="#h11-0-1579" id="h11-0-1579" class="i">+	XChangeProperty(dpy, wmcheckwin, netatom[NetWMName], utf8string, 8,
</a><a href="#h11-0-1580" id="h11-0-1580" class="i">+		PropModeReplace, (unsigned char *) &quot;dwm&quot;, 3);
</a><a href="#h11-0-1581" id="h11-0-1581" class="i">+	XChangeProperty(dpy, root, netatom[NetWMCheck], XA_WINDOW, 32,
</a><a href="#h11-0-1582" id="h11-0-1582" class="i">+		PropModeReplace, (unsigned char *) &amp;wmcheckwin, 1);
</a><a href="#h11-0-1583" id="h11-0-1583" class="i">+	/* EWMH support per view */
</a><a href="#h11-0-1584" id="h11-0-1584" class="i">+	XChangeProperty(dpy, root, netatom[NetSupported], XA_ATOM, 32,
</a><a href="#h11-0-1585" id="h11-0-1585" class="i">+		PropModeReplace, (unsigned char *) netatom, NetLast);
</a><a href="#h11-0-1586" id="h11-0-1586" class="i">+	XDeleteProperty(dpy, root, netatom[NetClientList]);
</a><a href="#h11-0-1587" id="h11-0-1587" class="i">+	/* select events */
</a><a href="#h11-0-1588" id="h11-0-1588" class="i">+	wa.cursor = cursor[CurNormal]-&gt;cursor;
</a><a href="#h11-0-1589" id="h11-0-1589" class="i">+	wa.event_mask = SubstructureRedirectMask|SubstructureNotifyMask
</a><a href="#h11-0-1590" id="h11-0-1590" class="i">+		|ButtonPressMask|PointerMotionMask|EnterWindowMask
</a><a href="#h11-0-1591" id="h11-0-1591" class="i">+		|LeaveWindowMask|StructureNotifyMask|PropertyChangeMask;
</a><a href="#h11-0-1592" id="h11-0-1592" class="i">+	XChangeWindowAttributes(dpy, root, CWEventMask|CWCursor, &amp;wa);
</a><a href="#h11-0-1593" id="h11-0-1593" class="i">+	XSelectInput(dpy, root, wa.event_mask);
</a><a href="#h11-0-1594" id="h11-0-1594" class="i">+	grabkeys();
</a><a href="#h11-0-1595" id="h11-0-1595" class="i">+	focus(NULL);
</a><a href="#h11-0-1596" id="h11-0-1596" class="i">+}
</a><a href="#h11-0-1597" id="h11-0-1597" class="i">+
</a><a href="#h11-0-1598" id="h11-0-1598" class="i">+
</a><a href="#h11-0-1599" id="h11-0-1599" class="i">+void
</a><a href="#h11-0-1600" id="h11-0-1600" class="i">+seturgent(Client *c, int urg)
</a><a href="#h11-0-1601" id="h11-0-1601" class="i">+{
</a><a href="#h11-0-1602" id="h11-0-1602" class="i">+	XWMHints *wmh;
</a><a href="#h11-0-1603" id="h11-0-1603" class="i">+
</a><a href="#h11-0-1604" id="h11-0-1604" class="i">+	c-&gt;isurgent = urg;
</a><a href="#h11-0-1605" id="h11-0-1605" class="i">+	if (!(wmh = XGetWMHints(dpy, c-&gt;win)))
</a><a href="#h11-0-1606" id="h11-0-1606" class="i">+		return;
</a><a href="#h11-0-1607" id="h11-0-1607" class="i">+	wmh-&gt;flags = urg ? (wmh-&gt;flags | XUrgencyHint) : (wmh-&gt;flags &amp; ~XUrgencyHint);
</a><a href="#h11-0-1608" id="h11-0-1608" class="i">+	XSetWMHints(dpy, c-&gt;win, wmh);
</a><a href="#h11-0-1609" id="h11-0-1609" class="i">+	XFree(wmh);
</a><a href="#h11-0-1610" id="h11-0-1610" class="i">+}
</a><a href="#h11-0-1611" id="h11-0-1611" class="i">+
</a><a href="#h11-0-1612" id="h11-0-1612" class="i">+void
</a><a href="#h11-0-1613" id="h11-0-1613" class="i">+showhide(Client *c)
</a><a href="#h11-0-1614" id="h11-0-1614" class="i">+{
</a><a href="#h11-0-1615" id="h11-0-1615" class="i">+	if (!c)
</a><a href="#h11-0-1616" id="h11-0-1616" class="i">+		return;
</a><a href="#h11-0-1617" id="h11-0-1617" class="i">+	if (ISVISIBLE(c)) {
</a><a href="#h11-0-1618" id="h11-0-1618" class="i">+		/* show clients top down */
</a><a href="#h11-0-1619" id="h11-0-1619" class="i">+		XMoveWindow(dpy, c-&gt;win, c-&gt;x, c-&gt;y);
</a><a href="#h11-0-1620" id="h11-0-1620" class="i">+		if ((!c-&gt;mon-&gt;lt[c-&gt;mon-&gt;sellt]-&gt;arrange || c-&gt;isfloating) &amp;&amp; !c-&gt;isfullscreen)
</a><a href="#h11-0-1621" id="h11-0-1621" class="i">+			resize(c, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h, 0);
</a><a href="#h11-0-1622" id="h11-0-1622" class="i">+		showhide(c-&gt;snext);
</a><a href="#h11-0-1623" id="h11-0-1623" class="i">+	} else {
</a><a href="#h11-0-1624" id="h11-0-1624" class="i">+		/* hide clients bottom up */
</a><a href="#h11-0-1625" id="h11-0-1625" class="i">+		showhide(c-&gt;snext);
</a><a href="#h11-0-1626" id="h11-0-1626" class="i">+		XMoveWindow(dpy, c-&gt;win, WIDTH(c) * -2, c-&gt;y);
</a><a href="#h11-0-1627" id="h11-0-1627" class="i">+	}
</a><a href="#h11-0-1628" id="h11-0-1628" class="i">+}
</a><a href="#h11-0-1629" id="h11-0-1629" class="i">+
</a><a href="#h11-0-1630" id="h11-0-1630" class="i">+void
</a><a href="#h11-0-1631" id="h11-0-1631" class="i">+sigchld(int unused)
</a><a href="#h11-0-1632" id="h11-0-1632" class="i">+{
</a><a href="#h11-0-1633" id="h11-0-1633" class="i">+	if (signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h11-0-1634" id="h11-0-1634" class="i">+		die(&quot;can&#39;t install SIGCHLD handler:&quot;);
</a><a href="#h11-0-1635" id="h11-0-1635" class="i">+	while (0 &lt; waitpid(-1, NULL, WNOHANG));
</a><a href="#h11-0-1636" id="h11-0-1636" class="i">+}
</a><a href="#h11-0-1637" id="h11-0-1637" class="i">+
</a><a href="#h11-0-1638" id="h11-0-1638" class="i">+void
</a><a href="#h11-0-1639" id="h11-0-1639" class="i">+spawn(const Arg *arg)
</a><a href="#h11-0-1640" id="h11-0-1640" class="i">+{
</a><a href="#h11-0-1641" id="h11-0-1641" class="i">+	if (arg-&gt;v == dmenucmd)
</a><a href="#h11-0-1642" id="h11-0-1642" class="i">+		dmenumon[0] = &#39;0&#39; + selmon-&gt;num;
</a><a href="#h11-0-1643" id="h11-0-1643" class="i">+	if (fork() == 0) {
</a><a href="#h11-0-1644" id="h11-0-1644" class="i">+		if (dpy)
</a><a href="#h11-0-1645" id="h11-0-1645" class="i">+			close(ConnectionNumber(dpy));
</a><a href="#h11-0-1646" id="h11-0-1646" class="i">+		setsid();
</a><a href="#h11-0-1647" id="h11-0-1647" class="i">+		execvp(((char **)arg-&gt;v)[0], (char **)arg-&gt;v);
</a><a href="#h11-0-1648" id="h11-0-1648" class="i">+		fprintf(stderr, &quot;dwm: execvp %s&quot;, ((char **)arg-&gt;v)[0]);
</a><a href="#h11-0-1649" id="h11-0-1649" class="i">+		perror(&quot; failed&quot;);
</a><a href="#h11-0-1650" id="h11-0-1650" class="i">+		exit(EXIT_SUCCESS);
</a><a href="#h11-0-1651" id="h11-0-1651" class="i">+	}
</a><a href="#h11-0-1652" id="h11-0-1652" class="i">+}
</a><a href="#h11-0-1653" id="h11-0-1653" class="i">+
</a><a href="#h11-0-1654" id="h11-0-1654" class="i">+void
</a><a href="#h11-0-1655" id="h11-0-1655" class="i">+tag(const Arg *arg)
</a><a href="#h11-0-1656" id="h11-0-1656" class="i">+{
</a><a href="#h11-0-1657" id="h11-0-1657" class="i">+	if (selmon-&gt;sel &amp;&amp; arg-&gt;ui &amp; TAGMASK) {
</a><a href="#h11-0-1658" id="h11-0-1658" class="i">+		selmon-&gt;sel-&gt;tags = arg-&gt;ui &amp; TAGMASK;
</a><a href="#h11-0-1659" id="h11-0-1659" class="i">+		focus(NULL);
</a><a href="#h11-0-1660" id="h11-0-1660" class="i">+		arrange(selmon);
</a><a href="#h11-0-1661" id="h11-0-1661" class="i">+	}
</a><a href="#h11-0-1662" id="h11-0-1662" class="i">+}
</a><a href="#h11-0-1663" id="h11-0-1663" class="i">+
</a><a href="#h11-0-1664" id="h11-0-1664" class="i">+void
</a><a href="#h11-0-1665" id="h11-0-1665" class="i">+tagmon(const Arg *arg)
</a><a href="#h11-0-1666" id="h11-0-1666" class="i">+{
</a><a href="#h11-0-1667" id="h11-0-1667" class="i">+	if (!selmon-&gt;sel || !mons-&gt;next)
</a><a href="#h11-0-1668" id="h11-0-1668" class="i">+		return;
</a><a href="#h11-0-1669" id="h11-0-1669" class="i">+	sendmon(selmon-&gt;sel, dirtomon(arg-&gt;i));
</a><a href="#h11-0-1670" id="h11-0-1670" class="i">+}
</a><a href="#h11-0-1671" id="h11-0-1671" class="i">+
</a><a href="#h11-0-1672" id="h11-0-1672" class="i">+void
</a><a href="#h11-0-1673" id="h11-0-1673" class="i">+tile(Monitor *m)
</a><a href="#h11-0-1674" id="h11-0-1674" class="i">+{
</a><a href="#h11-0-1675" id="h11-0-1675" class="i">+	unsigned int i, n, h, mw, my, ty;
</a><a href="#h11-0-1676" id="h11-0-1676" class="i">+	Client *c;
</a><a href="#h11-0-1677" id="h11-0-1677" class="i">+
</a><a href="#h11-0-1678" id="h11-0-1678" class="i">+	for (n = 0, c = nexttiled(m-&gt;clients); c; c = nexttiled(c-&gt;next), n++);
</a><a href="#h11-0-1679" id="h11-0-1679" class="i">+	if (n == 0)
</a><a href="#h11-0-1680" id="h11-0-1680" class="i">+		return;
</a><a href="#h11-0-1681" id="h11-0-1681" class="i">+
</a><a href="#h11-0-1682" id="h11-0-1682" class="i">+	if (n &gt; m-&gt;nmaster)
</a><a href="#h11-0-1683" id="h11-0-1683" class="i">+		mw = m-&gt;nmaster ? m-&gt;ww * m-&gt;mfact : 0;
</a><a href="#h11-0-1684" id="h11-0-1684" class="i">+	else
</a><a href="#h11-0-1685" id="h11-0-1685" class="i">+		mw = m-&gt;ww;
</a><a href="#h11-0-1686" id="h11-0-1686" class="i">+	for (i = my = ty = 0, c = nexttiled(m-&gt;clients); c; c = nexttiled(c-&gt;next), i++)
</a><a href="#h11-0-1687" id="h11-0-1687" class="i">+		if (i &lt; m-&gt;nmaster) {
</a><a href="#h11-0-1688" id="h11-0-1688" class="i">+			h = (m-&gt;wh - my) / (MIN(n, m-&gt;nmaster) - i);
</a><a href="#h11-0-1689" id="h11-0-1689" class="i">+			resize(c, m-&gt;wx, m-&gt;wy + my, mw - (2*c-&gt;bw), h - (2*c-&gt;bw), 0);
</a><a href="#h11-0-1690" id="h11-0-1690" class="i">+			my += HEIGHT(c);
</a><a href="#h11-0-1691" id="h11-0-1691" class="i">+		} else {
</a><a href="#h11-0-1692" id="h11-0-1692" class="i">+			h = (m-&gt;wh - ty) / (n - i);
</a><a href="#h11-0-1693" id="h11-0-1693" class="i">+			resize(c, m-&gt;wx + mw, m-&gt;wy + ty, m-&gt;ww - mw - (2*c-&gt;bw), h - (2*c-&gt;bw), 0);
</a><a href="#h11-0-1694" id="h11-0-1694" class="i">+			ty += HEIGHT(c);
</a><a href="#h11-0-1695" id="h11-0-1695" class="i">+		}
</a><a href="#h11-0-1696" id="h11-0-1696" class="i">+}
</a><a href="#h11-0-1697" id="h11-0-1697" class="i">+
</a><a href="#h11-0-1698" id="h11-0-1698" class="i">+void
</a><a href="#h11-0-1699" id="h11-0-1699" class="i">+togglebar(const Arg *arg)
</a><a href="#h11-0-1700" id="h11-0-1700" class="i">+{
</a><a href="#h11-0-1701" id="h11-0-1701" class="i">+	selmon-&gt;showbar = !selmon-&gt;showbar;
</a><a href="#h11-0-1702" id="h11-0-1702" class="i">+	updatebarpos(selmon);
</a><a href="#h11-0-1703" id="h11-0-1703" class="i">+	XMoveResizeWindow(dpy, selmon-&gt;barwin, selmon-&gt;wx, selmon-&gt;by, selmon-&gt;ww, bh);
</a><a href="#h11-0-1704" id="h11-0-1704" class="i">+	arrange(selmon);
</a><a href="#h11-0-1705" id="h11-0-1705" class="i">+}
</a><a href="#h11-0-1706" id="h11-0-1706" class="i">+
</a><a href="#h11-0-1707" id="h11-0-1707" class="i">+void
</a><a href="#h11-0-1708" id="h11-0-1708" class="i">+togglefloating(const Arg *arg)
</a><a href="#h11-0-1709" id="h11-0-1709" class="i">+{
</a><a href="#h11-0-1710" id="h11-0-1710" class="i">+	if (!selmon-&gt;sel)
</a><a href="#h11-0-1711" id="h11-0-1711" class="i">+		return;
</a><a href="#h11-0-1712" id="h11-0-1712" class="i">+	if (selmon-&gt;sel-&gt;isfullscreen) /* no support for fullscreen windows */
</a><a href="#h11-0-1713" id="h11-0-1713" class="i">+		return;
</a><a href="#h11-0-1714" id="h11-0-1714" class="i">+	selmon-&gt;sel-&gt;isfloating = !selmon-&gt;sel-&gt;isfloating || selmon-&gt;sel-&gt;isfixed;
</a><a href="#h11-0-1715" id="h11-0-1715" class="i">+	if (selmon-&gt;sel-&gt;isfloating)
</a><a href="#h11-0-1716" id="h11-0-1716" class="i">+		resize(selmon-&gt;sel, selmon-&gt;sel-&gt;x, selmon-&gt;sel-&gt;y,
</a><a href="#h11-0-1717" id="h11-0-1717" class="i">+			selmon-&gt;sel-&gt;w, selmon-&gt;sel-&gt;h, 0);
</a><a href="#h11-0-1718" id="h11-0-1718" class="i">+	arrange(selmon);
</a><a href="#h11-0-1719" id="h11-0-1719" class="i">+}
</a><a href="#h11-0-1720" id="h11-0-1720" class="i">+
</a><a href="#h11-0-1721" id="h11-0-1721" class="i">+void
</a><a href="#h11-0-1722" id="h11-0-1722" class="i">+toggletag(const Arg *arg)
</a><a href="#h11-0-1723" id="h11-0-1723" class="i">+{
</a><a href="#h11-0-1724" id="h11-0-1724" class="i">+	unsigned int newtags;
</a><a href="#h11-0-1725" id="h11-0-1725" class="i">+
</a><a href="#h11-0-1726" id="h11-0-1726" class="i">+	if (!selmon-&gt;sel)
</a><a href="#h11-0-1727" id="h11-0-1727" class="i">+		return;
</a><a href="#h11-0-1728" id="h11-0-1728" class="i">+	newtags = selmon-&gt;sel-&gt;tags ^ (arg-&gt;ui &amp; TAGMASK);
</a><a href="#h11-0-1729" id="h11-0-1729" class="i">+	if (newtags) {
</a><a href="#h11-0-1730" id="h11-0-1730" class="i">+		selmon-&gt;sel-&gt;tags = newtags;
</a><a href="#h11-0-1731" id="h11-0-1731" class="i">+		focus(NULL);
</a><a href="#h11-0-1732" id="h11-0-1732" class="i">+		arrange(selmon);
</a><a href="#h11-0-1733" id="h11-0-1733" class="i">+	}
</a><a href="#h11-0-1734" id="h11-0-1734" class="i">+}
</a><a href="#h11-0-1735" id="h11-0-1735" class="i">+
</a><a href="#h11-0-1736" id="h11-0-1736" class="i">+void
</a><a href="#h11-0-1737" id="h11-0-1737" class="i">+toggleview(const Arg *arg)
</a><a href="#h11-0-1738" id="h11-0-1738" class="i">+{
</a><a href="#h11-0-1739" id="h11-0-1739" class="i">+	unsigned int newtagset = selmon-&gt;tagset[selmon-&gt;seltags] ^ (arg-&gt;ui &amp; TAGMASK);
</a><a href="#h11-0-1740" id="h11-0-1740" class="i">+
</a><a href="#h11-0-1741" id="h11-0-1741" class="i">+	if (newtagset) {
</a><a href="#h11-0-1742" id="h11-0-1742" class="i">+		selmon-&gt;tagset[selmon-&gt;seltags] = newtagset;
</a><a href="#h11-0-1743" id="h11-0-1743" class="i">+		focus(NULL);
</a><a href="#h11-0-1744" id="h11-0-1744" class="i">+		arrange(selmon);
</a><a href="#h11-0-1745" id="h11-0-1745" class="i">+	}
</a><a href="#h11-0-1746" id="h11-0-1746" class="i">+}
</a><a href="#h11-0-1747" id="h11-0-1747" class="i">+
</a><a href="#h11-0-1748" id="h11-0-1748" class="i">+void
</a><a href="#h11-0-1749" id="h11-0-1749" class="i">+unfocus(Client *c, int setfocus)
</a><a href="#h11-0-1750" id="h11-0-1750" class="i">+{
</a><a href="#h11-0-1751" id="h11-0-1751" class="i">+	if (!c)
</a><a href="#h11-0-1752" id="h11-0-1752" class="i">+		return;
</a><a href="#h11-0-1753" id="h11-0-1753" class="i">+	grabbuttons(c, 0);
</a><a href="#h11-0-1754" id="h11-0-1754" class="i">+	XSetWindowBorder(dpy, c-&gt;win, scheme[SchemeNorm][ColBorder].pixel);
</a><a href="#h11-0-1755" id="h11-0-1755" class="i">+	if (setfocus) {
</a><a href="#h11-0-1756" id="h11-0-1756" class="i">+		XSetInputFocus(dpy, root, RevertToPointerRoot, CurrentTime);
</a><a href="#h11-0-1757" id="h11-0-1757" class="i">+		XDeleteProperty(dpy, root, netatom[NetActiveWindow]);
</a><a href="#h11-0-1758" id="h11-0-1758" class="i">+	}
</a><a href="#h11-0-1759" id="h11-0-1759" class="i">+}
</a><a href="#h11-0-1760" id="h11-0-1760" class="i">+
</a><a href="#h11-0-1761" id="h11-0-1761" class="i">+void
</a><a href="#h11-0-1762" id="h11-0-1762" class="i">+unmanage(Client *c, int destroyed)
</a><a href="#h11-0-1763" id="h11-0-1763" class="i">+{
</a><a href="#h11-0-1764" id="h11-0-1764" class="i">+	Monitor *m = c-&gt;mon;
</a><a href="#h11-0-1765" id="h11-0-1765" class="i">+	XWindowChanges wc;
</a><a href="#h11-0-1766" id="h11-0-1766" class="i">+
</a><a href="#h11-0-1767" id="h11-0-1767" class="i">+	detach(c);
</a><a href="#h11-0-1768" id="h11-0-1768" class="i">+	detachstack(c);
</a><a href="#h11-0-1769" id="h11-0-1769" class="i">+	if (!destroyed) {
</a><a href="#h11-0-1770" id="h11-0-1770" class="i">+		wc.border_width = c-&gt;oldbw;
</a><a href="#h11-0-1771" id="h11-0-1771" class="i">+		XGrabServer(dpy); /* avoid race conditions */
</a><a href="#h11-0-1772" id="h11-0-1772" class="i">+		XSetErrorHandler(xerrordummy);
</a><a href="#h11-0-1773" id="h11-0-1773" class="i">+		XConfigureWindow(dpy, c-&gt;win, CWBorderWidth, &amp;wc); /* restore border */
</a><a href="#h11-0-1774" id="h11-0-1774" class="i">+		XUngrabButton(dpy, AnyButton, AnyModifier, c-&gt;win);
</a><a href="#h11-0-1775" id="h11-0-1775" class="i">+		setclientstate(c, WithdrawnState);
</a><a href="#h11-0-1776" id="h11-0-1776" class="i">+		XSync(dpy, False);
</a><a href="#h11-0-1777" id="h11-0-1777" class="i">+		XSetErrorHandler(xerror);
</a><a href="#h11-0-1778" id="h11-0-1778" class="i">+		XUngrabServer(dpy);
</a><a href="#h11-0-1779" id="h11-0-1779" class="i">+	}
</a><a href="#h11-0-1780" id="h11-0-1780" class="i">+	free(c);
</a><a href="#h11-0-1781" id="h11-0-1781" class="i">+	focus(NULL);
</a><a href="#h11-0-1782" id="h11-0-1782" class="i">+	updateclientlist();
</a><a href="#h11-0-1783" id="h11-0-1783" class="i">+	arrange(m);
</a><a href="#h11-0-1784" id="h11-0-1784" class="i">+}
</a><a href="#h11-0-1785" id="h11-0-1785" class="i">+
</a><a href="#h11-0-1786" id="h11-0-1786" class="i">+void
</a><a href="#h11-0-1787" id="h11-0-1787" class="i">+unmapnotify(XEvent *e)
</a><a href="#h11-0-1788" id="h11-0-1788" class="i">+{
</a><a href="#h11-0-1789" id="h11-0-1789" class="i">+	Client *c;
</a><a href="#h11-0-1790" id="h11-0-1790" class="i">+	XUnmapEvent *ev = &amp;e-&gt;xunmap;
</a><a href="#h11-0-1791" id="h11-0-1791" class="i">+
</a><a href="#h11-0-1792" id="h11-0-1792" class="i">+	if ((c = wintoclient(ev-&gt;window))) {
</a><a href="#h11-0-1793" id="h11-0-1793" class="i">+		if (ev-&gt;send_event)
</a><a href="#h11-0-1794" id="h11-0-1794" class="i">+			setclientstate(c, WithdrawnState);
</a><a href="#h11-0-1795" id="h11-0-1795" class="i">+		else
</a><a href="#h11-0-1796" id="h11-0-1796" class="i">+			unmanage(c, 0);
</a><a href="#h11-0-1797" id="h11-0-1797" class="i">+	}
</a><a href="#h11-0-1798" id="h11-0-1798" class="i">+}
</a><a href="#h11-0-1799" id="h11-0-1799" class="i">+
</a><a href="#h11-0-1800" id="h11-0-1800" class="i">+void
</a><a href="#h11-0-1801" id="h11-0-1801" class="i">+updatebars(void)
</a><a href="#h11-0-1802" id="h11-0-1802" class="i">+{
</a><a href="#h11-0-1803" id="h11-0-1803" class="i">+	Monitor *m;
</a><a href="#h11-0-1804" id="h11-0-1804" class="i">+	XSetWindowAttributes wa = {
</a><a href="#h11-0-1805" id="h11-0-1805" class="i">+		.override_redirect = True,
</a><a href="#h11-0-1806" id="h11-0-1806" class="i">+		.background_pixmap = ParentRelative,
</a><a href="#h11-0-1807" id="h11-0-1807" class="i">+		.event_mask = ButtonPressMask|ExposureMask
</a><a href="#h11-0-1808" id="h11-0-1808" class="i">+	};
</a><a href="#h11-0-1809" id="h11-0-1809" class="i">+	XClassHint ch = {&quot;dwm&quot;, &quot;dwm&quot;};
</a><a href="#h11-0-1810" id="h11-0-1810" class="i">+	for (m = mons; m; m = m-&gt;next) {
</a><a href="#h11-0-1811" id="h11-0-1811" class="i">+		if (m-&gt;barwin)
</a><a href="#h11-0-1812" id="h11-0-1812" class="i">+			continue;
</a><a href="#h11-0-1813" id="h11-0-1813" class="i">+		m-&gt;barwin = XCreateWindow(dpy, root, m-&gt;wx, m-&gt;by, m-&gt;ww, bh, 0, DefaultDepth(dpy, screen),
</a><a href="#h11-0-1814" id="h11-0-1814" class="i">+				CopyFromParent, DefaultVisual(dpy, screen),
</a><a href="#h11-0-1815" id="h11-0-1815" class="i">+				CWOverrideRedirect|CWBackPixmap|CWEventMask, &amp;wa);
</a><a href="#h11-0-1816" id="h11-0-1816" class="i">+		XDefineCursor(dpy, m-&gt;barwin, cursor[CurNormal]-&gt;cursor);
</a><a href="#h11-0-1817" id="h11-0-1817" class="i">+		XMapRaised(dpy, m-&gt;barwin);
</a><a href="#h11-0-1818" id="h11-0-1818" class="i">+		XSetClassHint(dpy, m-&gt;barwin, &amp;ch);
</a><a href="#h11-0-1819" id="h11-0-1819" class="i">+	}
</a><a href="#h11-0-1820" id="h11-0-1820" class="i">+}
</a><a href="#h11-0-1821" id="h11-0-1821" class="i">+
</a><a href="#h11-0-1822" id="h11-0-1822" class="i">+void
</a><a href="#h11-0-1823" id="h11-0-1823" class="i">+updatebarpos(Monitor *m)
</a><a href="#h11-0-1824" id="h11-0-1824" class="i">+{
</a><a href="#h11-0-1825" id="h11-0-1825" class="i">+	m-&gt;wy = m-&gt;my;
</a><a href="#h11-0-1826" id="h11-0-1826" class="i">+	m-&gt;wh = m-&gt;mh;
</a><a href="#h11-0-1827" id="h11-0-1827" class="i">+	if (m-&gt;showbar) {
</a><a href="#h11-0-1828" id="h11-0-1828" class="i">+		m-&gt;wh -= bh;
</a><a href="#h11-0-1829" id="h11-0-1829" class="i">+		m-&gt;by = m-&gt;topbar ? m-&gt;wy : m-&gt;wy + m-&gt;wh;
</a><a href="#h11-0-1830" id="h11-0-1830" class="i">+		m-&gt;wy = m-&gt;topbar ? m-&gt;wy + bh : m-&gt;wy;
</a><a href="#h11-0-1831" id="h11-0-1831" class="i">+	} else
</a><a href="#h11-0-1832" id="h11-0-1832" class="i">+		m-&gt;by = -bh;
</a><a href="#h11-0-1833" id="h11-0-1833" class="i">+}
</a><a href="#h11-0-1834" id="h11-0-1834" class="i">+
</a><a href="#h11-0-1835" id="h11-0-1835" class="i">+void
</a><a href="#h11-0-1836" id="h11-0-1836" class="i">+updateclientlist()
</a><a href="#h11-0-1837" id="h11-0-1837" class="i">+{
</a><a href="#h11-0-1838" id="h11-0-1838" class="i">+	Client *c;
</a><a href="#h11-0-1839" id="h11-0-1839" class="i">+	Monitor *m;
</a><a href="#h11-0-1840" id="h11-0-1840" class="i">+
</a><a href="#h11-0-1841" id="h11-0-1841" class="i">+	XDeleteProperty(dpy, root, netatom[NetClientList]);
</a><a href="#h11-0-1842" id="h11-0-1842" class="i">+	for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-1843" id="h11-0-1843" class="i">+		for (c = m-&gt;clients; c; c = c-&gt;next)
</a><a href="#h11-0-1844" id="h11-0-1844" class="i">+			XChangeProperty(dpy, root, netatom[NetClientList],
</a><a href="#h11-0-1845" id="h11-0-1845" class="i">+				XA_WINDOW, 32, PropModeAppend,
</a><a href="#h11-0-1846" id="h11-0-1846" class="i">+				(unsigned char *) &amp;(c-&gt;win), 1);
</a><a href="#h11-0-1847" id="h11-0-1847" class="i">+}
</a><a href="#h11-0-1848" id="h11-0-1848" class="i">+
</a><a href="#h11-0-1849" id="h11-0-1849" class="i">+int
</a><a href="#h11-0-1850" id="h11-0-1850" class="i">+updategeom(void)
</a><a href="#h11-0-1851" id="h11-0-1851" class="i">+{
</a><a href="#h11-0-1852" id="h11-0-1852" class="i">+	int dirty = 0;
</a><a href="#h11-0-1853" id="h11-0-1853" class="i">+
</a><a href="#h11-0-1854" id="h11-0-1854" class="i">+#ifdef XINERAMA
</a><a href="#h11-0-1855" id="h11-0-1855" class="i">+	if (XineramaIsActive(dpy)) {
</a><a href="#h11-0-1856" id="h11-0-1856" class="i">+		int i, j, n, nn;
</a><a href="#h11-0-1857" id="h11-0-1857" class="i">+		Client *c;
</a><a href="#h11-0-1858" id="h11-0-1858" class="i">+		Monitor *m;
</a><a href="#h11-0-1859" id="h11-0-1859" class="i">+		XineramaScreenInfo *info = XineramaQueryScreens(dpy, &amp;nn);
</a><a href="#h11-0-1860" id="h11-0-1860" class="i">+		XineramaScreenInfo *unique = NULL;
</a><a href="#h11-0-1861" id="h11-0-1861" class="i">+
</a><a href="#h11-0-1862" id="h11-0-1862" class="i">+		for (n = 0, m = mons; m; m = m-&gt;next, n++);
</a><a href="#h11-0-1863" id="h11-0-1863" class="i">+		/* only consider unique geometries as separate screens */
</a><a href="#h11-0-1864" id="h11-0-1864" class="i">+		unique = ecalloc(nn, sizeof(XineramaScreenInfo));
</a><a href="#h11-0-1865" id="h11-0-1865" class="i">+		for (i = 0, j = 0; i &lt; nn; i++)
</a><a href="#h11-0-1866" id="h11-0-1866" class="i">+			if (isuniquegeom(unique, j, &amp;info[i]))
</a><a href="#h11-0-1867" id="h11-0-1867" class="i">+				memcpy(&amp;unique[j++], &amp;info[i], sizeof(XineramaScreenInfo));
</a><a href="#h11-0-1868" id="h11-0-1868" class="i">+		XFree(info);
</a><a href="#h11-0-1869" id="h11-0-1869" class="i">+		nn = j;
</a><a href="#h11-0-1870" id="h11-0-1870" class="i">+		if (n &lt;= nn) { /* new monitors available */
</a><a href="#h11-0-1871" id="h11-0-1871" class="i">+			for (i = 0; i &lt; (nn - n); i++) {
</a><a href="#h11-0-1872" id="h11-0-1872" class="i">+				for (m = mons; m &amp;&amp; m-&gt;next; m = m-&gt;next);
</a><a href="#h11-0-1873" id="h11-0-1873" class="i">+				if (m)
</a><a href="#h11-0-1874" id="h11-0-1874" class="i">+					m-&gt;next = createmon();
</a><a href="#h11-0-1875" id="h11-0-1875" class="i">+				else
</a><a href="#h11-0-1876" id="h11-0-1876" class="i">+					mons = createmon();
</a><a href="#h11-0-1877" id="h11-0-1877" class="i">+			}
</a><a href="#h11-0-1878" id="h11-0-1878" class="i">+			for (i = 0, m = mons; i &lt; nn &amp;&amp; m; m = m-&gt;next, i++)
</a><a href="#h11-0-1879" id="h11-0-1879" class="i">+				if (i &gt;= n
</a><a href="#h11-0-1880" id="h11-0-1880" class="i">+				|| unique[i].x_org != m-&gt;mx || unique[i].y_org != m-&gt;my
</a><a href="#h11-0-1881" id="h11-0-1881" class="i">+				|| unique[i].width != m-&gt;mw || unique[i].height != m-&gt;mh)
</a><a href="#h11-0-1882" id="h11-0-1882" class="i">+				{
</a><a href="#h11-0-1883" id="h11-0-1883" class="i">+					dirty = 1;
</a><a href="#h11-0-1884" id="h11-0-1884" class="i">+					m-&gt;num = i;
</a><a href="#h11-0-1885" id="h11-0-1885" class="i">+					m-&gt;mx = m-&gt;wx = unique[i].x_org;
</a><a href="#h11-0-1886" id="h11-0-1886" class="i">+					m-&gt;my = m-&gt;wy = unique[i].y_org;
</a><a href="#h11-0-1887" id="h11-0-1887" class="i">+					m-&gt;mw = m-&gt;ww = unique[i].width;
</a><a href="#h11-0-1888" id="h11-0-1888" class="i">+					m-&gt;mh = m-&gt;wh = unique[i].height;
</a><a href="#h11-0-1889" id="h11-0-1889" class="i">+					updatebarpos(m);
</a><a href="#h11-0-1890" id="h11-0-1890" class="i">+				}
</a><a href="#h11-0-1891" id="h11-0-1891" class="i">+		} else { /* less monitors available nn &lt; n */
</a><a href="#h11-0-1892" id="h11-0-1892" class="i">+			for (i = nn; i &lt; n; i++) {
</a><a href="#h11-0-1893" id="h11-0-1893" class="i">+				for (m = mons; m &amp;&amp; m-&gt;next; m = m-&gt;next);
</a><a href="#h11-0-1894" id="h11-0-1894" class="i">+				while ((c = m-&gt;clients)) {
</a><a href="#h11-0-1895" id="h11-0-1895" class="i">+					dirty = 1;
</a><a href="#h11-0-1896" id="h11-0-1896" class="i">+					m-&gt;clients = c-&gt;next;
</a><a href="#h11-0-1897" id="h11-0-1897" class="i">+					detachstack(c);
</a><a href="#h11-0-1898" id="h11-0-1898" class="i">+					c-&gt;mon = mons;
</a><a href="#h11-0-1899" id="h11-0-1899" class="i">+					attach(c);
</a><a href="#h11-0-1900" id="h11-0-1900" class="i">+					attachstack(c);
</a><a href="#h11-0-1901" id="h11-0-1901" class="i">+				}
</a><a href="#h11-0-1902" id="h11-0-1902" class="i">+				if (m == selmon)
</a><a href="#h11-0-1903" id="h11-0-1903" class="i">+					selmon = mons;
</a><a href="#h11-0-1904" id="h11-0-1904" class="i">+				cleanupmon(m);
</a><a href="#h11-0-1905" id="h11-0-1905" class="i">+			}
</a><a href="#h11-0-1906" id="h11-0-1906" class="i">+		}
</a><a href="#h11-0-1907" id="h11-0-1907" class="i">+		free(unique);
</a><a href="#h11-0-1908" id="h11-0-1908" class="i">+	} else
</a><a href="#h11-0-1909" id="h11-0-1909" class="i">+#endif /* XINERAMA */
</a><a href="#h11-0-1910" id="h11-0-1910" class="i">+	{ /* default monitor setup */
</a><a href="#h11-0-1911" id="h11-0-1911" class="i">+		if (!mons)
</a><a href="#h11-0-1912" id="h11-0-1912" class="i">+			mons = createmon();
</a><a href="#h11-0-1913" id="h11-0-1913" class="i">+		if (mons-&gt;mw != sw || mons-&gt;mh != sh) {
</a><a href="#h11-0-1914" id="h11-0-1914" class="i">+			dirty = 1;
</a><a href="#h11-0-1915" id="h11-0-1915" class="i">+			mons-&gt;mw = mons-&gt;ww = sw;
</a><a href="#h11-0-1916" id="h11-0-1916" class="i">+			mons-&gt;mh = mons-&gt;wh = sh;
</a><a href="#h11-0-1917" id="h11-0-1917" class="i">+			updatebarpos(mons);
</a><a href="#h11-0-1918" id="h11-0-1918" class="i">+		}
</a><a href="#h11-0-1919" id="h11-0-1919" class="i">+	}
</a><a href="#h11-0-1920" id="h11-0-1920" class="i">+	if (dirty) {
</a><a href="#h11-0-1921" id="h11-0-1921" class="i">+		selmon = mons;
</a><a href="#h11-0-1922" id="h11-0-1922" class="i">+		selmon = wintomon(root);
</a><a href="#h11-0-1923" id="h11-0-1923" class="i">+	}
</a><a href="#h11-0-1924" id="h11-0-1924" class="i">+	return dirty;
</a><a href="#h11-0-1925" id="h11-0-1925" class="i">+}
</a><a href="#h11-0-1926" id="h11-0-1926" class="i">+
</a><a href="#h11-0-1927" id="h11-0-1927" class="i">+void
</a><a href="#h11-0-1928" id="h11-0-1928" class="i">+updatenumlockmask(void)
</a><a href="#h11-0-1929" id="h11-0-1929" class="i">+{
</a><a href="#h11-0-1930" id="h11-0-1930" class="i">+	unsigned int i, j;
</a><a href="#h11-0-1931" id="h11-0-1931" class="i">+	XModifierKeymap *modmap;
</a><a href="#h11-0-1932" id="h11-0-1932" class="i">+
</a><a href="#h11-0-1933" id="h11-0-1933" class="i">+	numlockmask = 0;
</a><a href="#h11-0-1934" id="h11-0-1934" class="i">+	modmap = XGetModifierMapping(dpy);
</a><a href="#h11-0-1935" id="h11-0-1935" class="i">+	for (i = 0; i &lt; 8; i++)
</a><a href="#h11-0-1936" id="h11-0-1936" class="i">+		for (j = 0; j &lt; modmap-&gt;max_keypermod; j++)
</a><a href="#h11-0-1937" id="h11-0-1937" class="i">+			if (modmap-&gt;modifiermap[i * modmap-&gt;max_keypermod + j]
</a><a href="#h11-0-1938" id="h11-0-1938" class="i">+				== XKeysymToKeycode(dpy, XK_Num_Lock))
</a><a href="#h11-0-1939" id="h11-0-1939" class="i">+				numlockmask = (1 &lt;&lt; i);
</a><a href="#h11-0-1940" id="h11-0-1940" class="i">+	XFreeModifiermap(modmap);
</a><a href="#h11-0-1941" id="h11-0-1941" class="i">+}
</a><a href="#h11-0-1942" id="h11-0-1942" class="i">+
</a><a href="#h11-0-1943" id="h11-0-1943" class="i">+void
</a><a href="#h11-0-1944" id="h11-0-1944" class="i">+updatesizehints(Client *c)
</a><a href="#h11-0-1945" id="h11-0-1945" class="i">+{
</a><a href="#h11-0-1946" id="h11-0-1946" class="i">+	long msize;
</a><a href="#h11-0-1947" id="h11-0-1947" class="i">+	XSizeHints size;
</a><a href="#h11-0-1948" id="h11-0-1948" class="i">+
</a><a href="#h11-0-1949" id="h11-0-1949" class="i">+	if (!XGetWMNormalHints(dpy, c-&gt;win, &amp;size, &amp;msize))
</a><a href="#h11-0-1950" id="h11-0-1950" class="i">+		/* size is uninitialized, ensure that size.flags aren&#39;t used */
</a><a href="#h11-0-1951" id="h11-0-1951" class="i">+		size.flags = PSize;
</a><a href="#h11-0-1952" id="h11-0-1952" class="i">+	if (size.flags &amp; PBaseSize) {
</a><a href="#h11-0-1953" id="h11-0-1953" class="i">+		c-&gt;basew = size.base_width;
</a><a href="#h11-0-1954" id="h11-0-1954" class="i">+		c-&gt;baseh = size.base_height;
</a><a href="#h11-0-1955" id="h11-0-1955" class="i">+	} else if (size.flags &amp; PMinSize) {
</a><a href="#h11-0-1956" id="h11-0-1956" class="i">+		c-&gt;basew = size.min_width;
</a><a href="#h11-0-1957" id="h11-0-1957" class="i">+		c-&gt;baseh = size.min_height;
</a><a href="#h11-0-1958" id="h11-0-1958" class="i">+	} else
</a><a href="#h11-0-1959" id="h11-0-1959" class="i">+		c-&gt;basew = c-&gt;baseh = 0;
</a><a href="#h11-0-1960" id="h11-0-1960" class="i">+	if (size.flags &amp; PResizeInc) {
</a><a href="#h11-0-1961" id="h11-0-1961" class="i">+		c-&gt;incw = size.width_inc;
</a><a href="#h11-0-1962" id="h11-0-1962" class="i">+		c-&gt;inch = size.height_inc;
</a><a href="#h11-0-1963" id="h11-0-1963" class="i">+	} else
</a><a href="#h11-0-1964" id="h11-0-1964" class="i">+		c-&gt;incw = c-&gt;inch = 0;
</a><a href="#h11-0-1965" id="h11-0-1965" class="i">+	if (size.flags &amp; PMaxSize) {
</a><a href="#h11-0-1966" id="h11-0-1966" class="i">+		c-&gt;maxw = size.max_width;
</a><a href="#h11-0-1967" id="h11-0-1967" class="i">+		c-&gt;maxh = size.max_height;
</a><a href="#h11-0-1968" id="h11-0-1968" class="i">+	} else
</a><a href="#h11-0-1969" id="h11-0-1969" class="i">+		c-&gt;maxw = c-&gt;maxh = 0;
</a><a href="#h11-0-1970" id="h11-0-1970" class="i">+	if (size.flags &amp; PMinSize) {
</a><a href="#h11-0-1971" id="h11-0-1971" class="i">+		c-&gt;minw = size.min_width;
</a><a href="#h11-0-1972" id="h11-0-1972" class="i">+		c-&gt;minh = size.min_height;
</a><a href="#h11-0-1973" id="h11-0-1973" class="i">+	} else if (size.flags &amp; PBaseSize) {
</a><a href="#h11-0-1974" id="h11-0-1974" class="i">+		c-&gt;minw = size.base_width;
</a><a href="#h11-0-1975" id="h11-0-1975" class="i">+		c-&gt;minh = size.base_height;
</a><a href="#h11-0-1976" id="h11-0-1976" class="i">+	} else
</a><a href="#h11-0-1977" id="h11-0-1977" class="i">+		c-&gt;minw = c-&gt;minh = 0;
</a><a href="#h11-0-1978" id="h11-0-1978" class="i">+	if (size.flags &amp; PAspect) {
</a><a href="#h11-0-1979" id="h11-0-1979" class="i">+		c-&gt;mina = (float)size.min_aspect.y / size.min_aspect.x;
</a><a href="#h11-0-1980" id="h11-0-1980" class="i">+		c-&gt;maxa = (float)size.max_aspect.x / size.max_aspect.y;
</a><a href="#h11-0-1981" id="h11-0-1981" class="i">+	} else
</a><a href="#h11-0-1982" id="h11-0-1982" class="i">+		c-&gt;maxa = c-&gt;mina = 0.0;
</a><a href="#h11-0-1983" id="h11-0-1983" class="i">+	c-&gt;isfixed = (c-&gt;maxw &amp;&amp; c-&gt;maxh &amp;&amp; c-&gt;maxw == c-&gt;minw &amp;&amp; c-&gt;maxh == c-&gt;minh);
</a><a href="#h11-0-1984" id="h11-0-1984" class="i">+}
</a><a href="#h11-0-1985" id="h11-0-1985" class="i">+
</a><a href="#h11-0-1986" id="h11-0-1986" class="i">+void
</a><a href="#h11-0-1987" id="h11-0-1987" class="i">+updatestatus(void)
</a><a href="#h11-0-1988" id="h11-0-1988" class="i">+{
</a><a href="#h11-0-1989" id="h11-0-1989" class="i">+	if (!gettextprop(root, XA_WM_NAME, stext, sizeof(stext)))
</a><a href="#h11-0-1990" id="h11-0-1990" class="i">+		strcpy(stext, &quot;dwm-&quot;VERSION);
</a><a href="#h11-0-1991" id="h11-0-1991" class="i">+	drawbar(selmon);
</a><a href="#h11-0-1992" id="h11-0-1992" class="i">+}
</a><a href="#h11-0-1993" id="h11-0-1993" class="i">+
</a><a href="#h11-0-1994" id="h11-0-1994" class="i">+void
</a><a href="#h11-0-1995" id="h11-0-1995" class="i">+updatetitle(Client *c)
</a><a href="#h11-0-1996" id="h11-0-1996" class="i">+{
</a><a href="#h11-0-1997" id="h11-0-1997" class="i">+	if (!gettextprop(c-&gt;win, netatom[NetWMName], c-&gt;name, sizeof c-&gt;name))
</a><a href="#h11-0-1998" id="h11-0-1998" class="i">+		gettextprop(c-&gt;win, XA_WM_NAME, c-&gt;name, sizeof c-&gt;name);
</a><a href="#h11-0-1999" id="h11-0-1999" class="i">+	if (c-&gt;name[0] == &#39;\0&#39;) /* hack to mark broken clients */
</a><a href="#h11-0-2000" id="h11-0-2000" class="i">+		strcpy(c-&gt;name, broken);
</a><a href="#h11-0-2001" id="h11-0-2001" class="i">+}
</a><a href="#h11-0-2002" id="h11-0-2002" class="i">+
</a><a href="#h11-0-2003" id="h11-0-2003" class="i">+void
</a><a href="#h11-0-2004" id="h11-0-2004" class="i">+updatewindowtype(Client *c)
</a><a href="#h11-0-2005" id="h11-0-2005" class="i">+{
</a><a href="#h11-0-2006" id="h11-0-2006" class="i">+	Atom state = getatomprop(c, netatom[NetWMState]);
</a><a href="#h11-0-2007" id="h11-0-2007" class="i">+	Atom wtype = getatomprop(c, netatom[NetWMWindowType]);
</a><a href="#h11-0-2008" id="h11-0-2008" class="i">+
</a><a href="#h11-0-2009" id="h11-0-2009" class="i">+	if (state == netatom[NetWMFullscreen])
</a><a href="#h11-0-2010" id="h11-0-2010" class="i">+		setfullscreen(c, 1);
</a><a href="#h11-0-2011" id="h11-0-2011" class="i">+	if (wtype == netatom[NetWMWindowTypeDialog])
</a><a href="#h11-0-2012" id="h11-0-2012" class="i">+		c-&gt;isfloating = 1;
</a><a href="#h11-0-2013" id="h11-0-2013" class="i">+}
</a><a href="#h11-0-2014" id="h11-0-2014" class="i">+
</a><a href="#h11-0-2015" id="h11-0-2015" class="i">+void
</a><a href="#h11-0-2016" id="h11-0-2016" class="i">+updatewmhints(Client *c)
</a><a href="#h11-0-2017" id="h11-0-2017" class="i">+{
</a><a href="#h11-0-2018" id="h11-0-2018" class="i">+	XWMHints *wmh;
</a><a href="#h11-0-2019" id="h11-0-2019" class="i">+
</a><a href="#h11-0-2020" id="h11-0-2020" class="i">+	if ((wmh = XGetWMHints(dpy, c-&gt;win))) {
</a><a href="#h11-0-2021" id="h11-0-2021" class="i">+		if (c == selmon-&gt;sel &amp;&amp; wmh-&gt;flags &amp; XUrgencyHint) {
</a><a href="#h11-0-2022" id="h11-0-2022" class="i">+			wmh-&gt;flags &amp;= ~XUrgencyHint;
</a><a href="#h11-0-2023" id="h11-0-2023" class="i">+			XSetWMHints(dpy, c-&gt;win, wmh);
</a><a href="#h11-0-2024" id="h11-0-2024" class="i">+		} else
</a><a href="#h11-0-2025" id="h11-0-2025" class="i">+			c-&gt;isurgent = (wmh-&gt;flags &amp; XUrgencyHint) ? 1 : 0;
</a><a href="#h11-0-2026" id="h11-0-2026" class="i">+		if (wmh-&gt;flags &amp; InputHint)
</a><a href="#h11-0-2027" id="h11-0-2027" class="i">+			c-&gt;neverfocus = !wmh-&gt;input;
</a><a href="#h11-0-2028" id="h11-0-2028" class="i">+		else
</a><a href="#h11-0-2029" id="h11-0-2029" class="i">+			c-&gt;neverfocus = 0;
</a><a href="#h11-0-2030" id="h11-0-2030" class="i">+		XFree(wmh);
</a><a href="#h11-0-2031" id="h11-0-2031" class="i">+	}
</a><a href="#h11-0-2032" id="h11-0-2032" class="i">+}
</a><a href="#h11-0-2033" id="h11-0-2033" class="i">+
</a><a href="#h11-0-2034" id="h11-0-2034" class="i">+void
</a><a href="#h11-0-2035" id="h11-0-2035" class="i">+view(const Arg *arg)
</a><a href="#h11-0-2036" id="h11-0-2036" class="i">+{
</a><a href="#h11-0-2037" id="h11-0-2037" class="i">+	if ((arg-&gt;ui &amp; TAGMASK) == selmon-&gt;tagset[selmon-&gt;seltags])
</a><a href="#h11-0-2038" id="h11-0-2038" class="i">+		return;
</a><a href="#h11-0-2039" id="h11-0-2039" class="i">+	selmon-&gt;seltags ^= 1; /* toggle sel tagset */
</a><a href="#h11-0-2040" id="h11-0-2040" class="i">+	if (arg-&gt;ui &amp; TAGMASK)
</a><a href="#h11-0-2041" id="h11-0-2041" class="i">+		selmon-&gt;tagset[selmon-&gt;seltags] = arg-&gt;ui &amp; TAGMASK;
</a><a href="#h11-0-2042" id="h11-0-2042" class="i">+	focus(NULL);
</a><a href="#h11-0-2043" id="h11-0-2043" class="i">+	arrange(selmon);
</a><a href="#h11-0-2044" id="h11-0-2044" class="i">+}
</a><a href="#h11-0-2045" id="h11-0-2045" class="i">+
</a><a href="#h11-0-2046" id="h11-0-2046" class="i">+Client *
</a><a href="#h11-0-2047" id="h11-0-2047" class="i">+wintoclient(Window w)
</a><a href="#h11-0-2048" id="h11-0-2048" class="i">+{
</a><a href="#h11-0-2049" id="h11-0-2049" class="i">+	Client *c;
</a><a href="#h11-0-2050" id="h11-0-2050" class="i">+	Monitor *m;
</a><a href="#h11-0-2051" id="h11-0-2051" class="i">+
</a><a href="#h11-0-2052" id="h11-0-2052" class="i">+	for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-2053" id="h11-0-2053" class="i">+		for (c = m-&gt;clients; c; c = c-&gt;next)
</a><a href="#h11-0-2054" id="h11-0-2054" class="i">+			if (c-&gt;win == w)
</a><a href="#h11-0-2055" id="h11-0-2055" class="i">+				return c;
</a><a href="#h11-0-2056" id="h11-0-2056" class="i">+	return NULL;
</a><a href="#h11-0-2057" id="h11-0-2057" class="i">+}
</a><a href="#h11-0-2058" id="h11-0-2058" class="i">+
</a><a href="#h11-0-2059" id="h11-0-2059" class="i">+Monitor *
</a><a href="#h11-0-2060" id="h11-0-2060" class="i">+wintomon(Window w)
</a><a href="#h11-0-2061" id="h11-0-2061" class="i">+{
</a><a href="#h11-0-2062" id="h11-0-2062" class="i">+	int x, y;
</a><a href="#h11-0-2063" id="h11-0-2063" class="i">+	Client *c;
</a><a href="#h11-0-2064" id="h11-0-2064" class="i">+	Monitor *m;
</a><a href="#h11-0-2065" id="h11-0-2065" class="i">+
</a><a href="#h11-0-2066" id="h11-0-2066" class="i">+	if (w == root &amp;&amp; getrootptr(&amp;x, &amp;y))
</a><a href="#h11-0-2067" id="h11-0-2067" class="i">+		return recttomon(x, y, 1, 1);
</a><a href="#h11-0-2068" id="h11-0-2068" class="i">+	for (m = mons; m; m = m-&gt;next)
</a><a href="#h11-0-2069" id="h11-0-2069" class="i">+		if (w == m-&gt;barwin)
</a><a href="#h11-0-2070" id="h11-0-2070" class="i">+			return m;
</a><a href="#h11-0-2071" id="h11-0-2071" class="i">+	if ((c = wintoclient(w)))
</a><a href="#h11-0-2072" id="h11-0-2072" class="i">+		return c-&gt;mon;
</a><a href="#h11-0-2073" id="h11-0-2073" class="i">+	return selmon;
</a><a href="#h11-0-2074" id="h11-0-2074" class="i">+}
</a><a href="#h11-0-2075" id="h11-0-2075" class="i">+
</a><a href="#h11-0-2076" id="h11-0-2076" class="i">+/* There&#39;s no way to check accesses to destroyed windows, thus those cases are
</a><a href="#h11-0-2077" id="h11-0-2077" class="i">+ * ignored (especially on UnmapNotify&#39;s). Other types of errors call Xlibs
</a><a href="#h11-0-2078" id="h11-0-2078" class="i">+ * default error handler, which may call exit. */
</a><a href="#h11-0-2079" id="h11-0-2079" class="i">+int
</a><a href="#h11-0-2080" id="h11-0-2080" class="i">+xerror(Display *dpy, XErrorEvent *ee)
</a><a href="#h11-0-2081" id="h11-0-2081" class="i">+{
</a><a href="#h11-0-2082" id="h11-0-2082" class="i">+	if (ee-&gt;error_code == BadWindow
</a><a href="#h11-0-2083" id="h11-0-2083" class="i">+	|| (ee-&gt;request_code == X_SetInputFocus &amp;&amp; ee-&gt;error_code == BadMatch)
</a><a href="#h11-0-2084" id="h11-0-2084" class="i">+	|| (ee-&gt;request_code == X_PolyText8 &amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h11-0-2085" id="h11-0-2085" class="i">+	|| (ee-&gt;request_code == X_PolyFillRectangle &amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h11-0-2086" id="h11-0-2086" class="i">+	|| (ee-&gt;request_code == X_PolySegment &amp;&amp; ee-&gt;error_code == BadDrawable)
</a><a href="#h11-0-2087" id="h11-0-2087" class="i">+	|| (ee-&gt;request_code == X_ConfigureWindow &amp;&amp; ee-&gt;error_code == BadMatch)
</a><a href="#h11-0-2088" id="h11-0-2088" class="i">+	|| (ee-&gt;request_code == X_GrabButton &amp;&amp; ee-&gt;error_code == BadAccess)
</a><a href="#h11-0-2089" id="h11-0-2089" class="i">+	|| (ee-&gt;request_code == X_GrabKey &amp;&amp; ee-&gt;error_code == BadAccess)
</a><a href="#h11-0-2090" id="h11-0-2090" class="i">+	|| (ee-&gt;request_code == X_CopyArea &amp;&amp; ee-&gt;error_code == BadDrawable))
</a><a href="#h11-0-2091" id="h11-0-2091" class="i">+		return 0;
</a><a href="#h11-0-2092" id="h11-0-2092" class="i">+	fprintf(stderr, &quot;dwm: fatal error: request code=%d, error code=%d\n&quot;,
</a><a href="#h11-0-2093" id="h11-0-2093" class="i">+		ee-&gt;request_code, ee-&gt;error_code);
</a><a href="#h11-0-2094" id="h11-0-2094" class="i">+	return xerrorxlib(dpy, ee); /* may call exit */
</a><a href="#h11-0-2095" id="h11-0-2095" class="i">+}
</a><a href="#h11-0-2096" id="h11-0-2096" class="i">+
</a><a href="#h11-0-2097" id="h11-0-2097" class="i">+int
</a><a href="#h11-0-2098" id="h11-0-2098" class="i">+xerrordummy(Display *dpy, XErrorEvent *ee)
</a><a href="#h11-0-2099" id="h11-0-2099" class="i">+{
</a><a href="#h11-0-2100" id="h11-0-2100" class="i">+	return 0;
</a><a href="#h11-0-2101" id="h11-0-2101" class="i">+}
</a><a href="#h11-0-2102" id="h11-0-2102" class="i">+
</a><a href="#h11-0-2103" id="h11-0-2103" class="i">+/* Startup Error handler to check if another window manager
</a><a href="#h11-0-2104" id="h11-0-2104" class="i">+ * is already running. */
</a><a href="#h11-0-2105" id="h11-0-2105" class="i">+int
</a><a href="#h11-0-2106" id="h11-0-2106" class="i">+xerrorstart(Display *dpy, XErrorEvent *ee)
</a><a href="#h11-0-2107" id="h11-0-2107" class="i">+{
</a><a href="#h11-0-2108" id="h11-0-2108" class="i">+	die(&quot;dwm: another window manager is already running&quot;);
</a><a href="#h11-0-2109" id="h11-0-2109" class="i">+	return -1;
</a><a href="#h11-0-2110" id="h11-0-2110" class="i">+}
</a><a href="#h11-0-2111" id="h11-0-2111" class="i">+
</a><a href="#h11-0-2112" id="h11-0-2112" class="i">+void
</a><a href="#h11-0-2113" id="h11-0-2113" class="i">+zoom(const Arg *arg)
</a><a href="#h11-0-2114" id="h11-0-2114" class="i">+{
</a><a href="#h11-0-2115" id="h11-0-2115" class="i">+	Client *c = selmon-&gt;sel;
</a><a href="#h11-0-2116" id="h11-0-2116" class="i">+
</a><a href="#h11-0-2117" id="h11-0-2117" class="i">+	if (!selmon-&gt;lt[selmon-&gt;sellt]-&gt;arrange
</a><a href="#h11-0-2118" id="h11-0-2118" class="i">+	|| (selmon-&gt;sel &amp;&amp; selmon-&gt;sel-&gt;isfloating))
</a><a href="#h11-0-2119" id="h11-0-2119" class="i">+		return;
</a><a href="#h11-0-2120" id="h11-0-2120" class="i">+	if (c == nexttiled(selmon-&gt;clients))
</a><a href="#h11-0-2121" id="h11-0-2121" class="i">+		if (!c || !(c = nexttiled(c-&gt;next)))
</a><a href="#h11-0-2122" id="h11-0-2122" class="i">+			return;
</a><a href="#h11-0-2123" id="h11-0-2123" class="i">+	pop(c);
</a><a href="#h11-0-2124" id="h11-0-2124" class="i">+}
</a><a href="#h11-0-2125" id="h11-0-2125" class="i">+
</a><a href="#h11-0-2126" id="h11-0-2126" class="i">+int
</a><a href="#h11-0-2127" id="h11-0-2127" class="i">+main(int argc, char *argv[])
</a><a href="#h11-0-2128" id="h11-0-2128" class="i">+{
</a><a href="#h11-0-2129" id="h11-0-2129" class="i">+	if (argc == 2 &amp;&amp; !strcmp(&quot;-v&quot;, argv[1]))
</a><a href="#h11-0-2130" id="h11-0-2130" class="i">+		die(&quot;dwm-&quot;VERSION);
</a><a href="#h11-0-2131" id="h11-0-2131" class="i">+	else if (argc != 1)
</a><a href="#h11-0-2132" id="h11-0-2132" class="i">+		die(&quot;usage: dwm [-v]&quot;);
</a><a href="#h11-0-2133" id="h11-0-2133" class="i">+	if (!setlocale(LC_CTYPE, &quot;&quot;) || !XSupportsLocale())
</a><a href="#h11-0-2134" id="h11-0-2134" class="i">+		fputs(&quot;warning: no locale support\n&quot;, stderr);
</a><a href="#h11-0-2135" id="h11-0-2135" class="i">+	if (!(dpy = XOpenDisplay(NULL)))
</a><a href="#h11-0-2136" id="h11-0-2136" class="i">+		die(&quot;dwm: cannot open display&quot;);
</a><a href="#h11-0-2137" id="h11-0-2137" class="i">+	checkotherwm();
</a><a href="#h11-0-2138" id="h11-0-2138" class="i">+	setup();
</a><a href="#h11-0-2139" id="h11-0-2139" class="i">+#ifdef __OpenBSD__
</a><a href="#h11-0-2140" id="h11-0-2140" class="i">+	if (pledge(&quot;stdio rpath proc exec&quot;, NULL) == -1)
</a><a href="#h11-0-2141" id="h11-0-2141" class="i">+		die(&quot;pledge&quot;);
</a><a href="#h11-0-2142" id="h11-0-2142" class="i">+#endif /* __OpenBSD__ */
</a><a href="#h11-0-2143" id="h11-0-2143" class="i">+	scan();
</a><a href="#h11-0-2144" id="h11-0-2144" class="i">+	run();
</a><a href="#h11-0-2145" id="h11-0-2145" class="i">+	cleanup();
</a><a href="#h11-0-2146" id="h11-0-2146" class="i">+	XCloseDisplay(dpy);
</a><a href="#h11-0-2147" id="h11-0-2147" class="i">+	return EXIT_SUCCESS;
</a><a href="#h11-0-2148" id="h11-0-2148" class="i">+}
</a><b>diff --git a/<a id="h12" href="../file/dwm/dwm.o.html">dwm/dwm.o</a> b/<a href="../file/dwm/dwm.o.html">dwm/dwm.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h13" href="../file/dwm/dwm.png.html">dwm/dwm.png</a> b/<a href="../file/dwm/dwm.png.html">dwm/dwm.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h14" href="../file/dwm/transient.c.html">dwm/transient.c</a> b/<a href="../file/dwm/transient.c.html">dwm/transient.c</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,42 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+/* cc transient.c -o transient -lX11 */
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h14-0-3" id="h14-0-3" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h14-0-4" id="h14-0-4" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h14-0-5" id="h14-0-5" class="i">+#include &lt;X11/Xutil.h&gt;
</a><a href="#h14-0-6" id="h14-0-6" class="i">+
</a><a href="#h14-0-7" id="h14-0-7" class="i">+int main(void) {
</a><a href="#h14-0-8" id="h14-0-8" class="i">+	Display *d;
</a><a href="#h14-0-9" id="h14-0-9" class="i">+	Window r, f, t = None;
</a><a href="#h14-0-10" id="h14-0-10" class="i">+	XSizeHints h;
</a><a href="#h14-0-11" id="h14-0-11" class="i">+	XEvent e;
</a><a href="#h14-0-12" id="h14-0-12" class="i">+
</a><a href="#h14-0-13" id="h14-0-13" class="i">+	d = XOpenDisplay(NULL);
</a><a href="#h14-0-14" id="h14-0-14" class="i">+	if (!d)
</a><a href="#h14-0-15" id="h14-0-15" class="i">+		exit(1);
</a><a href="#h14-0-16" id="h14-0-16" class="i">+	r = DefaultRootWindow(d);
</a><a href="#h14-0-17" id="h14-0-17" class="i">+
</a><a href="#h14-0-18" id="h14-0-18" class="i">+	f = XCreateSimpleWindow(d, r, 100, 100, 400, 400, 0, 0, 0);
</a><a href="#h14-0-19" id="h14-0-19" class="i">+	h.min_width = h.max_width = h.min_height = h.max_height = 400;
</a><a href="#h14-0-20" id="h14-0-20" class="i">+	h.flags = PMinSize | PMaxSize;
</a><a href="#h14-0-21" id="h14-0-21" class="i">+	XSetWMNormalHints(d, f, &amp;h);
</a><a href="#h14-0-22" id="h14-0-22" class="i">+	XStoreName(d, f, &quot;floating&quot;);
</a><a href="#h14-0-23" id="h14-0-23" class="i">+	XMapWindow(d, f);
</a><a href="#h14-0-24" id="h14-0-24" class="i">+
</a><a href="#h14-0-25" id="h14-0-25" class="i">+	XSelectInput(d, f, ExposureMask);
</a><a href="#h14-0-26" id="h14-0-26" class="i">+	while (1) {
</a><a href="#h14-0-27" id="h14-0-27" class="i">+		XNextEvent(d, &amp;e);
</a><a href="#h14-0-28" id="h14-0-28" class="i">+
</a><a href="#h14-0-29" id="h14-0-29" class="i">+		if (t == None) {
</a><a href="#h14-0-30" id="h14-0-30" class="i">+			sleep(5);
</a><a href="#h14-0-31" id="h14-0-31" class="i">+			t = XCreateSimpleWindow(d, r, 50, 50, 100, 100, 0, 0, 0);
</a><a href="#h14-0-32" id="h14-0-32" class="i">+			XSetTransientForHint(d, t, f);
</a><a href="#h14-0-33" id="h14-0-33" class="i">+			XStoreName(d, t, &quot;transient&quot;);
</a><a href="#h14-0-34" id="h14-0-34" class="i">+			XMapWindow(d, t);
</a><a href="#h14-0-35" id="h14-0-35" class="i">+			XSelectInput(d, t, ExposureMask);
</a><a href="#h14-0-36" id="h14-0-36" class="i">+		}
</a><a href="#h14-0-37" id="h14-0-37" class="i">+	}
</a><a href="#h14-0-38" id="h14-0-38" class="i">+
</a><a href="#h14-0-39" id="h14-0-39" class="i">+	XCloseDisplay(d);
</a><a href="#h14-0-40" id="h14-0-40" class="i">+	exit(0);
</a><a href="#h14-0-41" id="h14-0-41" class="i">+}
</a><b>diff --git a/<a id="h15" href="../file/dwm/util.c.html">dwm/util.c</a> b/<a href="../file/dwm/util.c.html">dwm/util.c</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,35 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h15-0-1" id="h15-0-1" class="i">+#include &lt;stdarg.h&gt;
</a><a href="#h15-0-2" id="h15-0-2" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h15-0-3" id="h15-0-3" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h15-0-4" id="h15-0-4" class="i">+#include &lt;string.h&gt;
</a><a href="#h15-0-5" id="h15-0-5" class="i">+
</a><a href="#h15-0-6" id="h15-0-6" class="i">+#include &quot;util.h&quot;
</a><a href="#h15-0-7" id="h15-0-7" class="i">+
</a><a href="#h15-0-8" id="h15-0-8" class="i">+void *
</a><a href="#h15-0-9" id="h15-0-9" class="i">+ecalloc(size_t nmemb, size_t size)
</a><a href="#h15-0-10" id="h15-0-10" class="i">+{
</a><a href="#h15-0-11" id="h15-0-11" class="i">+	void *p;
</a><a href="#h15-0-12" id="h15-0-12" class="i">+
</a><a href="#h15-0-13" id="h15-0-13" class="i">+	if (!(p = calloc(nmemb, size)))
</a><a href="#h15-0-14" id="h15-0-14" class="i">+		die(&quot;calloc:&quot;);
</a><a href="#h15-0-15" id="h15-0-15" class="i">+	return p;
</a><a href="#h15-0-16" id="h15-0-16" class="i">+}
</a><a href="#h15-0-17" id="h15-0-17" class="i">+
</a><a href="#h15-0-18" id="h15-0-18" class="i">+void
</a><a href="#h15-0-19" id="h15-0-19" class="i">+die(const char *fmt, ...) {
</a><a href="#h15-0-20" id="h15-0-20" class="i">+	va_list ap;
</a><a href="#h15-0-21" id="h15-0-21" class="i">+
</a><a href="#h15-0-22" id="h15-0-22" class="i">+	va_start(ap, fmt);
</a><a href="#h15-0-23" id="h15-0-23" class="i">+	vfprintf(stderr, fmt, ap);
</a><a href="#h15-0-24" id="h15-0-24" class="i">+	va_end(ap);
</a><a href="#h15-0-25" id="h15-0-25" class="i">+
</a><a href="#h15-0-26" id="h15-0-26" class="i">+	if (fmt[0] &amp;&amp; fmt[strlen(fmt)-1] == &#39;:&#39;) {
</a><a href="#h15-0-27" id="h15-0-27" class="i">+		fputc(&#39; &#39;, stderr);
</a><a href="#h15-0-28" id="h15-0-28" class="i">+		perror(NULL);
</a><a href="#h15-0-29" id="h15-0-29" class="i">+	} else {
</a><a href="#h15-0-30" id="h15-0-30" class="i">+		fputc(&#39;\n&#39;, stderr);
</a><a href="#h15-0-31" id="h15-0-31" class="i">+	}
</a><a href="#h15-0-32" id="h15-0-32" class="i">+
</a><a href="#h15-0-33" id="h15-0-33" class="i">+	exit(1);
</a><a href="#h15-0-34" id="h15-0-34" class="i">+}
</a><b>diff --git a/<a id="h16" href="../file/dwm/util.h.html">dwm/util.h</a> b/<a href="../file/dwm/util.h.html">dwm/util.h</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,8 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+#define MAX(A, B)               ((A) &gt; (B) ? (A) : (B))
</a><a href="#h16-0-3" id="h16-0-3" class="i">+#define MIN(A, B)               ((A) &lt; (B) ? (A) : (B))
</a><a href="#h16-0-4" id="h16-0-4" class="i">+#define BETWEEN(X, A, B)        ((A) &lt;= (X) &amp;&amp; (X) &lt;= (B))
</a><a href="#h16-0-5" id="h16-0-5" class="i">+
</a><a href="#h16-0-6" id="h16-0-6" class="i">+void die(const char *fmt, ...);
</a><a href="#h16-0-7" id="h16-0-7" class="i">+void *ecalloc(size_t nmemb, size_t size);
</a><b>diff --git a/<a id="h17" href="../file/dwm/util.o.html">dwm/util.o</a> b/<a href="../file/dwm/util.o.html">dwm/util.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h18" href="../file/slock/LICENSE.html">slock/LICENSE</a> b/<a href="../file/slock/LICENSE.html">slock/LICENSE</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,24 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+MIT/X Consortium License
</a><a href="#h18-0-1" id="h18-0-1" class="i">+
</a><a href="#h18-0-2" id="h18-0-2" class="i">+© 2015-2016 Markus Teich &lt;markus.teich@stusta.mhn.de&gt;
</a><a href="#h18-0-3" id="h18-0-3" class="i">+© 2014 Dimitris Papastamos &lt;sin@2f30.org&gt;
</a><a href="#h18-0-4" id="h18-0-4" class="i">+© 2006-2014 Anselm R Garbe &lt;anselm@garbe.us&gt;
</a><a href="#h18-0-5" id="h18-0-5" class="i">+© 2014-2016 Laslo Hunhold &lt;dev@frign.de&gt;
</a><a href="#h18-0-6" id="h18-0-6" class="i">+
</a><a href="#h18-0-7" id="h18-0-7" class="i">+Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h18-0-8" id="h18-0-8" class="i">+copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h18-0-9" id="h18-0-9" class="i">+to deal in the Software without restriction, including without limitation
</a><a href="#h18-0-10" id="h18-0-10" class="i">+the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h18-0-11" id="h18-0-11" class="i">+and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h18-0-12" id="h18-0-12" class="i">+Software is furnished to do so, subject to the following conditions:
</a><a href="#h18-0-13" id="h18-0-13" class="i">+
</a><a href="#h18-0-14" id="h18-0-14" class="i">+The above copyright notice and this permission notice shall be included in
</a><a href="#h18-0-15" id="h18-0-15" class="i">+all copies or substantial portions of the Software.
</a><a href="#h18-0-16" id="h18-0-16" class="i">+
</a><a href="#h18-0-17" id="h18-0-17" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h18-0-18" id="h18-0-18" class="i">+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h18-0-19" id="h18-0-19" class="i">+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h18-0-20" id="h18-0-20" class="i">+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h18-0-21" id="h18-0-21" class="i">+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h18-0-22" id="h18-0-22" class="i">+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h18-0-23" id="h18-0-23" class="i">+DEALINGS IN THE SOFTWARE.
</a><b>diff --git a/<a id="h19" href="../file/slock/Makefile.html">slock/Makefile</a> b/<a href="../file/slock/Makefile.html">slock/Makefile</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,61 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+# slock - simple screen locker
</a><a href="#h19-0-1" id="h19-0-1" class="i">+# See LICENSE file for copyright and license details.
</a><a href="#h19-0-2" id="h19-0-2" class="i">+
</a><a href="#h19-0-3" id="h19-0-3" class="i">+include config.mk
</a><a href="#h19-0-4" id="h19-0-4" class="i">+
</a><a href="#h19-0-5" id="h19-0-5" class="i">+SRC = slock.c ${COMPATSRC}
</a><a href="#h19-0-6" id="h19-0-6" class="i">+OBJ = ${SRC:.c=.o}
</a><a href="#h19-0-7" id="h19-0-7" class="i">+
</a><a href="#h19-0-8" id="h19-0-8" class="i">+all: options slock
</a><a href="#h19-0-9" id="h19-0-9" class="i">+
</a><a href="#h19-0-10" id="h19-0-10" class="i">+options:
</a><a href="#h19-0-11" id="h19-0-11" class="i">+	@echo slock build options:
</a><a href="#h19-0-12" id="h19-0-12" class="i">+	@echo &quot;CFLAGS   = ${CFLAGS}&quot;
</a><a href="#h19-0-13" id="h19-0-13" class="i">+	@echo &quot;LDFLAGS  = ${LDFLAGS}&quot;
</a><a href="#h19-0-14" id="h19-0-14" class="i">+	@echo &quot;CC       = ${CC}&quot;
</a><a href="#h19-0-15" id="h19-0-15" class="i">+
</a><a href="#h19-0-16" id="h19-0-16" class="i">+.c.o:
</a><a href="#h19-0-17" id="h19-0-17" class="i">+	@echo CC $&lt;
</a><a href="#h19-0-18" id="h19-0-18" class="i">+	@${CC} -c ${CFLAGS} $&lt;
</a><a href="#h19-0-19" id="h19-0-19" class="i">+
</a><a href="#h19-0-20" id="h19-0-20" class="i">+${OBJ}: config.h config.mk arg.h util.h
</a><a href="#h19-0-21" id="h19-0-21" class="i">+
</a><a href="#h19-0-22" id="h19-0-22" class="i">+config.h:
</a><a href="#h19-0-23" id="h19-0-23" class="i">+	@echo creating $@ from config.def.h
</a><a href="#h19-0-24" id="h19-0-24" class="i">+	@cp config.def.h $@
</a><a href="#h19-0-25" id="h19-0-25" class="i">+
</a><a href="#h19-0-26" id="h19-0-26" class="i">+slock: ${OBJ}
</a><a href="#h19-0-27" id="h19-0-27" class="i">+	@echo CC -o $@
</a><a href="#h19-0-28" id="h19-0-28" class="i">+	@${CC} -o $@ ${OBJ} ${LDFLAGS}
</a><a href="#h19-0-29" id="h19-0-29" class="i">+
</a><a href="#h19-0-30" id="h19-0-30" class="i">+clean:
</a><a href="#h19-0-31" id="h19-0-31" class="i">+	@echo cleaning
</a><a href="#h19-0-32" id="h19-0-32" class="i">+	@rm -f slock ${OBJ} slock-${VERSION}.tar.gz
</a><a href="#h19-0-33" id="h19-0-33" class="i">+
</a><a href="#h19-0-34" id="h19-0-34" class="i">+dist: clean
</a><a href="#h19-0-35" id="h19-0-35" class="i">+	@echo creating dist tarball
</a><a href="#h19-0-36" id="h19-0-36" class="i">+	@mkdir -p slock-${VERSION}
</a><a href="#h19-0-37" id="h19-0-37" class="i">+	@cp -R LICENSE Makefile README slock.1 config.mk \
</a><a href="#h19-0-38" id="h19-0-38" class="i">+		${SRC} explicit_bzero.c config.def.h arg.h util.h slock-${VERSION}
</a><a href="#h19-0-39" id="h19-0-39" class="i">+	@tar -cf slock-${VERSION}.tar slock-${VERSION}
</a><a href="#h19-0-40" id="h19-0-40" class="i">+	@gzip slock-${VERSION}.tar
</a><a href="#h19-0-41" id="h19-0-41" class="i">+	@rm -rf slock-${VERSION}
</a><a href="#h19-0-42" id="h19-0-42" class="i">+
</a><a href="#h19-0-43" id="h19-0-43" class="i">+install: all
</a><a href="#h19-0-44" id="h19-0-44" class="i">+	@echo installing executable file to ${DESTDIR}${PREFIX}/bin
</a><a href="#h19-0-45" id="h19-0-45" class="i">+	@mkdir -p ${DESTDIR}${PREFIX}/bin
</a><a href="#h19-0-46" id="h19-0-46" class="i">+	@cp -f slock ${DESTDIR}${PREFIX}/bin
</a><a href="#h19-0-47" id="h19-0-47" class="i">+	@chmod 755 ${DESTDIR}${PREFIX}/bin/slock
</a><a href="#h19-0-48" id="h19-0-48" class="i">+	@chmod u+s ${DESTDIR}${PREFIX}/bin/slock
</a><a href="#h19-0-49" id="h19-0-49" class="i">+	@echo installing manual page to ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h19-0-50" id="h19-0-50" class="i">+	@mkdir -p ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h19-0-51" id="h19-0-51" class="i">+	@sed &quot;s/VERSION/${VERSION}/g&quot; &lt;slock.1 &gt;${DESTDIR}${MANPREFIX}/man1/slock.1
</a><a href="#h19-0-52" id="h19-0-52" class="i">+	@chmod 644 ${DESTDIR}${MANPREFIX}/man1/slock.1
</a><a href="#h19-0-53" id="h19-0-53" class="i">+
</a><a href="#h19-0-54" id="h19-0-54" class="i">+uninstall:
</a><a href="#h19-0-55" id="h19-0-55" class="i">+	@echo removing executable file from ${DESTDIR}${PREFIX}/bin
</a><a href="#h19-0-56" id="h19-0-56" class="i">+	@rm -f ${DESTDIR}${PREFIX}/bin/slock
</a><a href="#h19-0-57" id="h19-0-57" class="i">+	@echo removing manual page from ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h19-0-58" id="h19-0-58" class="i">+	@rm -f ${DESTDIR}${MANPREFIX}/man1/slock.1
</a><a href="#h19-0-59" id="h19-0-59" class="i">+
</a><a href="#h19-0-60" id="h19-0-60" class="i">+.PHONY: all options clean dist install uninstall
</a><b>diff --git a/<a id="h20" href="../file/slock/README.html">slock/README</a> b/<a href="../file/slock/README.html">slock/README</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -0,0 +1,24 @@
</a><a href="#h20-0-0" id="h20-0-0" class="i">+slock - simple screen locker
</a><a href="#h20-0-1" id="h20-0-1" class="i">+============================
</a><a href="#h20-0-2" id="h20-0-2" class="i">+simple screen locker utility for X.
</a><a href="#h20-0-3" id="h20-0-3" class="i">+
</a><a href="#h20-0-4" id="h20-0-4" class="i">+
</a><a href="#h20-0-5" id="h20-0-5" class="i">+Requirements
</a><a href="#h20-0-6" id="h20-0-6" class="i">+------------
</a><a href="#h20-0-7" id="h20-0-7" class="i">+In order to build slock you need the Xlib header files.
</a><a href="#h20-0-8" id="h20-0-8" class="i">+
</a><a href="#h20-0-9" id="h20-0-9" class="i">+
</a><a href="#h20-0-10" id="h20-0-10" class="i">+Installation
</a><a href="#h20-0-11" id="h20-0-11" class="i">+------------
</a><a href="#h20-0-12" id="h20-0-12" class="i">+Edit config.mk to match your local setup (slock is installed into
</a><a href="#h20-0-13" id="h20-0-13" class="i">+the /usr/local namespace by default).
</a><a href="#h20-0-14" id="h20-0-14" class="i">+
</a><a href="#h20-0-15" id="h20-0-15" class="i">+Afterwards enter the following command to build and install slock
</a><a href="#h20-0-16" id="h20-0-16" class="i">+(if necessary as root):
</a><a href="#h20-0-17" id="h20-0-17" class="i">+
</a><a href="#h20-0-18" id="h20-0-18" class="i">+    make clean install
</a><a href="#h20-0-19" id="h20-0-19" class="i">+
</a><a href="#h20-0-20" id="h20-0-20" class="i">+
</a><a href="#h20-0-21" id="h20-0-21" class="i">+Running slock
</a><a href="#h20-0-22" id="h20-0-22" class="i">+-------------
</a><a href="#h20-0-23" id="h20-0-23" class="i">+Simply invoke the &#39;slock&#39; command. To get out of it, enter your password.
</a><b>diff --git a/<a id="h21" href="../file/slock/arg.h.html">slock/arg.h</a> b/<a href="../file/slock/arg.h.html">slock/arg.h</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -0,0 +1,65 @@
</a><a href="#h21-0-0" id="h21-0-0" class="i">+/*
</a><a href="#h21-0-1" id="h21-0-1" class="i">+ * Copy me if you can.
</a><a href="#h21-0-2" id="h21-0-2" class="i">+ * by 20h
</a><a href="#h21-0-3" id="h21-0-3" class="i">+ */
</a><a href="#h21-0-4" id="h21-0-4" class="i">+
</a><a href="#h21-0-5" id="h21-0-5" class="i">+#ifndef ARG_H__
</a><a href="#h21-0-6" id="h21-0-6" class="i">+#define ARG_H__
</a><a href="#h21-0-7" id="h21-0-7" class="i">+
</a><a href="#h21-0-8" id="h21-0-8" class="i">+extern char *argv0;
</a><a href="#h21-0-9" id="h21-0-9" class="i">+
</a><a href="#h21-0-10" id="h21-0-10" class="i">+/* use main(int argc, char *argv[]) */
</a><a href="#h21-0-11" id="h21-0-11" class="i">+#define ARGBEGIN	for (argv0 = *argv, argv++, argc--;\
</a><a href="#h21-0-12" id="h21-0-12" class="i">+					argv[0] &amp;&amp; argv[0][0] == &#39;-&#39;\
</a><a href="#h21-0-13" id="h21-0-13" class="i">+					&amp;&amp; argv[0][1];\
</a><a href="#h21-0-14" id="h21-0-14" class="i">+					argc--, argv++) {\
</a><a href="#h21-0-15" id="h21-0-15" class="i">+				char argc_;\
</a><a href="#h21-0-16" id="h21-0-16" class="i">+				char **argv_;\
</a><a href="#h21-0-17" id="h21-0-17" class="i">+				int brk_;\
</a><a href="#h21-0-18" id="h21-0-18" class="i">+				if (argv[0][1] == &#39;-&#39; &amp;&amp; argv[0][2] == &#39;\0&#39;) {\
</a><a href="#h21-0-19" id="h21-0-19" class="i">+					argv++;\
</a><a href="#h21-0-20" id="h21-0-20" class="i">+					argc--;\
</a><a href="#h21-0-21" id="h21-0-21" class="i">+					break;\
</a><a href="#h21-0-22" id="h21-0-22" class="i">+				}\
</a><a href="#h21-0-23" id="h21-0-23" class="i">+				for (brk_ = 0, argv[0]++, argv_ = argv;\
</a><a href="#h21-0-24" id="h21-0-24" class="i">+						argv[0][0] &amp;&amp; !brk_;\
</a><a href="#h21-0-25" id="h21-0-25" class="i">+						argv[0]++) {\
</a><a href="#h21-0-26" id="h21-0-26" class="i">+					if (argv_ != argv)\
</a><a href="#h21-0-27" id="h21-0-27" class="i">+						break;\
</a><a href="#h21-0-28" id="h21-0-28" class="i">+					argc_ = argv[0][0];\
</a><a href="#h21-0-29" id="h21-0-29" class="i">+					switch (argc_)
</a><a href="#h21-0-30" id="h21-0-30" class="i">+
</a><a href="#h21-0-31" id="h21-0-31" class="i">+/* Handles obsolete -NUM syntax */
</a><a href="#h21-0-32" id="h21-0-32" class="i">+#define ARGNUM				case &#39;0&#39;:\
</a><a href="#h21-0-33" id="h21-0-33" class="i">+					case &#39;1&#39;:\
</a><a href="#h21-0-34" id="h21-0-34" class="i">+					case &#39;2&#39;:\
</a><a href="#h21-0-35" id="h21-0-35" class="i">+					case &#39;3&#39;:\
</a><a href="#h21-0-36" id="h21-0-36" class="i">+					case &#39;4&#39;:\
</a><a href="#h21-0-37" id="h21-0-37" class="i">+					case &#39;5&#39;:\
</a><a href="#h21-0-38" id="h21-0-38" class="i">+					case &#39;6&#39;:\
</a><a href="#h21-0-39" id="h21-0-39" class="i">+					case &#39;7&#39;:\
</a><a href="#h21-0-40" id="h21-0-40" class="i">+					case &#39;8&#39;:\
</a><a href="#h21-0-41" id="h21-0-41" class="i">+					case &#39;9&#39;
</a><a href="#h21-0-42" id="h21-0-42" class="i">+
</a><a href="#h21-0-43" id="h21-0-43" class="i">+#define ARGEND			}\
</a><a href="#h21-0-44" id="h21-0-44" class="i">+			}
</a><a href="#h21-0-45" id="h21-0-45" class="i">+
</a><a href="#h21-0-46" id="h21-0-46" class="i">+#define ARGC()		argc_
</a><a href="#h21-0-47" id="h21-0-47" class="i">+
</a><a href="#h21-0-48" id="h21-0-48" class="i">+#define ARGNUMF()	(brk_ = 1, estrtonum(argv[0], 0, INT_MAX))
</a><a href="#h21-0-49" id="h21-0-49" class="i">+
</a><a href="#h21-0-50" id="h21-0-50" class="i">+#define EARGF(x)	((argv[0][1] == &#39;\0&#39; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h21-0-51" id="h21-0-51" class="i">+				((x), abort(), (char *)0) :\
</a><a href="#h21-0-52" id="h21-0-52" class="i">+				(brk_ = 1, (argv[0][1] != &#39;\0&#39;)?\
</a><a href="#h21-0-53" id="h21-0-53" class="i">+					(&amp;argv[0][1]) :\
</a><a href="#h21-0-54" id="h21-0-54" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h21-0-55" id="h21-0-55" class="i">+
</a><a href="#h21-0-56" id="h21-0-56" class="i">+#define ARGF()		((argv[0][1] == &#39;\0&#39; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h21-0-57" id="h21-0-57" class="i">+				(char *)0 :\
</a><a href="#h21-0-58" id="h21-0-58" class="i">+				(brk_ = 1, (argv[0][1] != &#39;\0&#39;)?\
</a><a href="#h21-0-59" id="h21-0-59" class="i">+					(&amp;argv[0][1]) :\
</a><a href="#h21-0-60" id="h21-0-60" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h21-0-61" id="h21-0-61" class="i">+
</a><a href="#h21-0-62" id="h21-0-62" class="i">+#define LNGARG()	&amp;argv[0][0]
</a><a href="#h21-0-63" id="h21-0-63" class="i">+
</a><a href="#h21-0-64" id="h21-0-64" class="i">+#endif
</a><b>diff --git a/<a id="h22" href="../file/slock/config.def.h.html">slock/config.def.h</a> b/<a href="../file/slock/config.def.h.html">slock/config.def.h</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h22-0-0" id="h22-0-0" class="i">+/* user and group to drop privileges to */
</a><a href="#h22-0-1" id="h22-0-1" class="i">+static const char *user  = &quot;nobody&quot;;
</a><a href="#h22-0-2" id="h22-0-2" class="i">+static const char *group = &quot;nogroup&quot;;
</a><a href="#h22-0-3" id="h22-0-3" class="i">+
</a><a href="#h22-0-4" id="h22-0-4" class="i">+static const char *colorname[NUMCOLS] = {
</a><a href="#h22-0-5" id="h22-0-5" class="i">+	[INIT] =   &quot;black&quot;,     /* after initialization */
</a><a href="#h22-0-6" id="h22-0-6" class="i">+	[INPUT] =  &quot;#005577&quot;,   /* during input */
</a><a href="#h22-0-7" id="h22-0-7" class="i">+	[FAILED] = &quot;#CC3333&quot;,   /* wrong password */
</a><a href="#h22-0-8" id="h22-0-8" class="i">+};
</a><a href="#h22-0-9" id="h22-0-9" class="i">+
</a><a href="#h22-0-10" id="h22-0-10" class="i">+/* treat a cleared input like a wrong password (color) */
</a><a href="#h22-0-11" id="h22-0-11" class="i">+static const int failonclear = 1;
</a><b>diff --git a/<a id="h23" href="../file/slock/config.h.html">slock/config.h</a> b/<a href="../file/slock/config.h.html">slock/config.h</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+/* user and group to drop privileges to */
</a><a href="#h23-0-1" id="h23-0-1" class="i">+static const char *user  = &quot;nobody&quot;;
</a><a href="#h23-0-2" id="h23-0-2" class="i">+static const char *group = &quot;nobody&quot;;
</a><a href="#h23-0-3" id="h23-0-3" class="i">+
</a><a href="#h23-0-4" id="h23-0-4" class="i">+static const char *colorname[NUMCOLS] = {
</a><a href="#h23-0-5" id="h23-0-5" class="i">+	[INIT] =   &quot;black&quot;,     /* after initialization */
</a><a href="#h23-0-6" id="h23-0-6" class="i">+	[INPUT] =  &quot;#005577&quot;,   /* during input */
</a><a href="#h23-0-7" id="h23-0-7" class="i">+	[FAILED] = &quot;#CC3333&quot;,   /* wrong password */
</a><a href="#h23-0-8" id="h23-0-8" class="i">+};
</a><a href="#h23-0-9" id="h23-0-9" class="i">+
</a><a href="#h23-0-10" id="h23-0-10" class="i">+/* treat a cleared input like a wrong password (color) */
</a><a href="#h23-0-11" id="h23-0-11" class="i">+static const int failonclear = 1;
</a><b>diff --git a/<a id="h24" href="../file/slock/config.mk.html">slock/config.mk</a> b/<a href="../file/slock/config.mk.html">slock/config.mk</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -0,0 +1,32 @@
</a><a href="#h24-0-0" id="h24-0-0" class="i">+# slock version
</a><a href="#h24-0-1" id="h24-0-1" class="i">+VERSION = 1.4
</a><a href="#h24-0-2" id="h24-0-2" class="i">+
</a><a href="#h24-0-3" id="h24-0-3" class="i">+# Customize below to fit your system
</a><a href="#h24-0-4" id="h24-0-4" class="i">+
</a><a href="#h24-0-5" id="h24-0-5" class="i">+# paths
</a><a href="#h24-0-6" id="h24-0-6" class="i">+PREFIX = /usr/local
</a><a href="#h24-0-7" id="h24-0-7" class="i">+MANPREFIX = ${PREFIX}/share/man
</a><a href="#h24-0-8" id="h24-0-8" class="i">+
</a><a href="#h24-0-9" id="h24-0-9" class="i">+X11INC = /usr/X11R6/include
</a><a href="#h24-0-10" id="h24-0-10" class="i">+X11LIB = /usr/X11R6/lib
</a><a href="#h24-0-11" id="h24-0-11" class="i">+
</a><a href="#h24-0-12" id="h24-0-12" class="i">+# includes and libs
</a><a href="#h24-0-13" id="h24-0-13" class="i">+INCS = -I. -I/usr/include -I${X11INC}
</a><a href="#h24-0-14" id="h24-0-14" class="i">+LIBS = -L/usr/lib -lc -lcrypt -L${X11LIB} -lX11 -lXext -lXrandr
</a><a href="#h24-0-15" id="h24-0-15" class="i">+
</a><a href="#h24-0-16" id="h24-0-16" class="i">+# flags
</a><a href="#h24-0-17" id="h24-0-17" class="i">+CPPFLAGS = -DVERSION=\&quot;${VERSION}\&quot; -D_DEFAULT_SOURCE -DHAVE_SHADOW_H
</a><a href="#h24-0-18" id="h24-0-18" class="i">+CFLAGS = -std=c99 -pedantic -Wall -Os ${INCS} ${CPPFLAGS}
</a><a href="#h24-0-19" id="h24-0-19" class="i">+LDFLAGS = -s ${LIBS}
</a><a href="#h24-0-20" id="h24-0-20" class="i">+COMPATSRC = explicit_bzero.c
</a><a href="#h24-0-21" id="h24-0-21" class="i">+
</a><a href="#h24-0-22" id="h24-0-22" class="i">+# On OpenBSD and Darwin remove -lcrypt from LIBS
</a><a href="#h24-0-23" id="h24-0-23" class="i">+#LIBS = -L/usr/lib -lc -L${X11LIB} -lX11 -lXext -lXrandr
</a><a href="#h24-0-24" id="h24-0-24" class="i">+# On *BSD remove -DHAVE_SHADOW_H from CPPFLAGS
</a><a href="#h24-0-25" id="h24-0-25" class="i">+# On NetBSD add -D_NETBSD_SOURCE to CPPFLAGS
</a><a href="#h24-0-26" id="h24-0-26" class="i">+#CPPFLAGS = -DVERSION=\&quot;${VERSION}\&quot; -D_BSD_SOURCE -D_NETBSD_SOURCE
</a><a href="#h24-0-27" id="h24-0-27" class="i">+# On OpenBSD set COMPATSRC to empty
</a><a href="#h24-0-28" id="h24-0-28" class="i">+#COMPATSRC =
</a><a href="#h24-0-29" id="h24-0-29" class="i">+
</a><a href="#h24-0-30" id="h24-0-30" class="i">+# compiler and linker
</a><a href="#h24-0-31" id="h24-0-31" class="i">+CC = cc
</a><b>diff --git a/<a id="h25" href="../file/slock/explicit_bzero.c.html">slock/explicit_bzero.c</a> b/<a href="../file/slock/explicit_bzero.c.html">slock/explicit_bzero.c</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -0,0 +1,19 @@
</a><a href="#h25-0-0" id="h25-0-0" class="i">+/*	$OpenBSD: explicit_bzero.c,v 1.3 2014/06/21 02:34:26 matthew Exp $ */
</a><a href="#h25-0-1" id="h25-0-1" class="i">+/*
</a><a href="#h25-0-2" id="h25-0-2" class="i">+ * Public domain.
</a><a href="#h25-0-3" id="h25-0-3" class="i">+ * Written by Matthew Dempsky.
</a><a href="#h25-0-4" id="h25-0-4" class="i">+ */
</a><a href="#h25-0-5" id="h25-0-5" class="i">+
</a><a href="#h25-0-6" id="h25-0-6" class="i">+#include &lt;string.h&gt;
</a><a href="#h25-0-7" id="h25-0-7" class="i">+
</a><a href="#h25-0-8" id="h25-0-8" class="i">+__attribute__((weak)) void
</a><a href="#h25-0-9" id="h25-0-9" class="i">+__explicit_bzero_hook(void *buf, size_t len)
</a><a href="#h25-0-10" id="h25-0-10" class="i">+{
</a><a href="#h25-0-11" id="h25-0-11" class="i">+}
</a><a href="#h25-0-12" id="h25-0-12" class="i">+
</a><a href="#h25-0-13" id="h25-0-13" class="i">+void
</a><a href="#h25-0-14" id="h25-0-14" class="i">+explicit_bzero(void *buf, size_t len)
</a><a href="#h25-0-15" id="h25-0-15" class="i">+{
</a><a href="#h25-0-16" id="h25-0-16" class="i">+	memset(buf, 0, len);
</a><a href="#h25-0-17" id="h25-0-17" class="i">+	__explicit_bzero_hook(buf, len);
</a><a href="#h25-0-18" id="h25-0-18" class="i">+}
</a><b>diff --git a/<a id="h26" href="../file/slock/explicit_bzero.o.html">slock/explicit_bzero.o</a> b/<a href="../file/slock/explicit_bzero.o.html">slock/explicit_bzero.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h27" href="../file/slock/slock.html">slock/slock</a> b/<a href="../file/slock/slock.html">slock/slock</a></b>
Binary files differ.
<b>diff --git a/<a id="h28" href="../file/slock/slock.1.html">slock/slock.1</a> b/<a href="../file/slock/slock.1.html">slock/slock.1</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -0,0 +1,39 @@
</a><a href="#h28-0-0" id="h28-0-0" class="i">+.Dd 2016-08-23
</a><a href="#h28-0-1" id="h28-0-1" class="i">+.Dt SLOCK 1
</a><a href="#h28-0-2" id="h28-0-2" class="i">+.Sh NAME
</a><a href="#h28-0-3" id="h28-0-3" class="i">+.Nm slock
</a><a href="#h28-0-4" id="h28-0-4" class="i">+.Nd simple X screen locker
</a><a href="#h28-0-5" id="h28-0-5" class="i">+.Sh SYNOPSIS
</a><a href="#h28-0-6" id="h28-0-6" class="i">+.Nm
</a><a href="#h28-0-7" id="h28-0-7" class="i">+.Op Fl v
</a><a href="#h28-0-8" id="h28-0-8" class="i">+.Op Ar cmd Op Ar arg ...
</a><a href="#h28-0-9" id="h28-0-9" class="i">+.Sh DESCRIPTION
</a><a href="#h28-0-10" id="h28-0-10" class="i">+.Nm
</a><a href="#h28-0-11" id="h28-0-11" class="i">+is a simple X screen locker. If provided,
</a><a href="#h28-0-12" id="h28-0-12" class="i">+.Ar cmd Op Ar arg ...
</a><a href="#h28-0-13" id="h28-0-13" class="i">+is executed after the screen has been locked.
</a><a href="#h28-0-14" id="h28-0-14" class="i">+.Sh OPTIONS
</a><a href="#h28-0-15" id="h28-0-15" class="i">+.Bl -tag -width Ds
</a><a href="#h28-0-16" id="h28-0-16" class="i">+.It Fl v
</a><a href="#h28-0-17" id="h28-0-17" class="i">+Print version information to stdout and exit.
</a><a href="#h28-0-18" id="h28-0-18" class="i">+.El
</a><a href="#h28-0-19" id="h28-0-19" class="i">+.Sh SECURITY CONSIDERATIONS
</a><a href="#h28-0-20" id="h28-0-20" class="i">+To make sure a locked screen can not be bypassed by switching VTs
</a><a href="#h28-0-21" id="h28-0-21" class="i">+or killing the X server with Ctrl+Alt+Backspace, it is recommended
</a><a href="#h28-0-22" id="h28-0-22" class="i">+to disable both in
</a><a href="#h28-0-23" id="h28-0-23" class="i">+.Xr xorg.conf 5
</a><a href="#h28-0-24" id="h28-0-24" class="i">+for maximum security:
</a><a href="#h28-0-25" id="h28-0-25" class="i">+.Bd -literal -offset left
</a><a href="#h28-0-26" id="h28-0-26" class="i">+Section &quot;ServerFlags&quot;
</a><a href="#h28-0-27" id="h28-0-27" class="i">+	Option &quot;DontVTSwitch&quot; &quot;True&quot;
</a><a href="#h28-0-28" id="h28-0-28" class="i">+	Option &quot;DontZap&quot;      &quot;True&quot;
</a><a href="#h28-0-29" id="h28-0-29" class="i">+EndSection
</a><a href="#h28-0-30" id="h28-0-30" class="i">+.Ed
</a><a href="#h28-0-31" id="h28-0-31" class="i">+.Sh EXAMPLES
</a><a href="#h28-0-32" id="h28-0-32" class="i">+$
</a><a href="#h28-0-33" id="h28-0-33" class="i">+.Nm
</a><a href="#h28-0-34" id="h28-0-34" class="i">+/usr/sbin/s2ram
</a><a href="#h28-0-35" id="h28-0-35" class="i">+.Sh CUSTOMIZATION
</a><a href="#h28-0-36" id="h28-0-36" class="i">+.Nm
</a><a href="#h28-0-37" id="h28-0-37" class="i">+can be customized by creating a custom config.h from config.def.h and
</a><a href="#h28-0-38" id="h28-0-38" class="i">+(re)compiling the source code. This keeps it fast, secure and simple.
</a><b>diff --git a/<a id="h29" href="../file/slock/slock.c.html">slock/slock.c</a> b/<a href="../file/slock/slock.c.html">slock/slock.c</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -0,0 +1,395 @@
</a><a href="#h29-0-0" id="h29-0-0" class="i">+/* See LICENSE file for license details. */
</a><a href="#h29-0-1" id="h29-0-1" class="i">+#define _XOPEN_SOURCE 500
</a><a href="#h29-0-2" id="h29-0-2" class="i">+#if HAVE_SHADOW_H
</a><a href="#h29-0-3" id="h29-0-3" class="i">+#include &lt;shadow.h&gt;
</a><a href="#h29-0-4" id="h29-0-4" class="i">+#endif
</a><a href="#h29-0-5" id="h29-0-5" class="i">+
</a><a href="#h29-0-6" id="h29-0-6" class="i">+#include &lt;ctype.h&gt;
</a><a href="#h29-0-7" id="h29-0-7" class="i">+#include &lt;errno.h&gt;
</a><a href="#h29-0-8" id="h29-0-8" class="i">+#include &lt;grp.h&gt;
</a><a href="#h29-0-9" id="h29-0-9" class="i">+#include &lt;pwd.h&gt;
</a><a href="#h29-0-10" id="h29-0-10" class="i">+#include &lt;stdarg.h&gt;
</a><a href="#h29-0-11" id="h29-0-11" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h29-0-12" id="h29-0-12" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h29-0-13" id="h29-0-13" class="i">+#include &lt;string.h&gt;
</a><a href="#h29-0-14" id="h29-0-14" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h29-0-15" id="h29-0-15" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h29-0-16" id="h29-0-16" class="i">+#include &lt;X11/extensions/Xrandr.h&gt;
</a><a href="#h29-0-17" id="h29-0-17" class="i">+#include &lt;X11/keysym.h&gt;
</a><a href="#h29-0-18" id="h29-0-18" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h29-0-19" id="h29-0-19" class="i">+#include &lt;X11/Xutil.h&gt;
</a><a href="#h29-0-20" id="h29-0-20" class="i">+
</a><a href="#h29-0-21" id="h29-0-21" class="i">+#include &quot;arg.h&quot;
</a><a href="#h29-0-22" id="h29-0-22" class="i">+#include &quot;util.h&quot;
</a><a href="#h29-0-23" id="h29-0-23" class="i">+
</a><a href="#h29-0-24" id="h29-0-24" class="i">+char *argv0;
</a><a href="#h29-0-25" id="h29-0-25" class="i">+
</a><a href="#h29-0-26" id="h29-0-26" class="i">+enum {
</a><a href="#h29-0-27" id="h29-0-27" class="i">+	INIT,
</a><a href="#h29-0-28" id="h29-0-28" class="i">+	INPUT,
</a><a href="#h29-0-29" id="h29-0-29" class="i">+	FAILED,
</a><a href="#h29-0-30" id="h29-0-30" class="i">+	NUMCOLS
</a><a href="#h29-0-31" id="h29-0-31" class="i">+};
</a><a href="#h29-0-32" id="h29-0-32" class="i">+
</a><a href="#h29-0-33" id="h29-0-33" class="i">+struct lock {
</a><a href="#h29-0-34" id="h29-0-34" class="i">+	int screen;
</a><a href="#h29-0-35" id="h29-0-35" class="i">+	Window root, win;
</a><a href="#h29-0-36" id="h29-0-36" class="i">+	Pixmap pmap;
</a><a href="#h29-0-37" id="h29-0-37" class="i">+	unsigned long colors[NUMCOLS];
</a><a href="#h29-0-38" id="h29-0-38" class="i">+};
</a><a href="#h29-0-39" id="h29-0-39" class="i">+
</a><a href="#h29-0-40" id="h29-0-40" class="i">+struct xrandr {
</a><a href="#h29-0-41" id="h29-0-41" class="i">+	int active;
</a><a href="#h29-0-42" id="h29-0-42" class="i">+	int evbase;
</a><a href="#h29-0-43" id="h29-0-43" class="i">+	int errbase;
</a><a href="#h29-0-44" id="h29-0-44" class="i">+};
</a><a href="#h29-0-45" id="h29-0-45" class="i">+
</a><a href="#h29-0-46" id="h29-0-46" class="i">+#include &quot;config.h&quot;
</a><a href="#h29-0-47" id="h29-0-47" class="i">+
</a><a href="#h29-0-48" id="h29-0-48" class="i">+static void
</a><a href="#h29-0-49" id="h29-0-49" class="i">+die(const char *errstr, ...)
</a><a href="#h29-0-50" id="h29-0-50" class="i">+{
</a><a href="#h29-0-51" id="h29-0-51" class="i">+	va_list ap;
</a><a href="#h29-0-52" id="h29-0-52" class="i">+
</a><a href="#h29-0-53" id="h29-0-53" class="i">+	va_start(ap, errstr);
</a><a href="#h29-0-54" id="h29-0-54" class="i">+	vfprintf(stderr, errstr, ap);
</a><a href="#h29-0-55" id="h29-0-55" class="i">+	va_end(ap);
</a><a href="#h29-0-56" id="h29-0-56" class="i">+	exit(1);
</a><a href="#h29-0-57" id="h29-0-57" class="i">+}
</a><a href="#h29-0-58" id="h29-0-58" class="i">+
</a><a href="#h29-0-59" id="h29-0-59" class="i">+#ifdef __linux__
</a><a href="#h29-0-60" id="h29-0-60" class="i">+#include &lt;fcntl.h&gt;
</a><a href="#h29-0-61" id="h29-0-61" class="i">+#include &lt;linux/oom.h&gt;
</a><a href="#h29-0-62" id="h29-0-62" class="i">+
</a><a href="#h29-0-63" id="h29-0-63" class="i">+static void
</a><a href="#h29-0-64" id="h29-0-64" class="i">+dontkillme(void)
</a><a href="#h29-0-65" id="h29-0-65" class="i">+{
</a><a href="#h29-0-66" id="h29-0-66" class="i">+	FILE *f;
</a><a href="#h29-0-67" id="h29-0-67" class="i">+	const char oomfile[] = &quot;/proc/self/oom_score_adj&quot;;
</a><a href="#h29-0-68" id="h29-0-68" class="i">+
</a><a href="#h29-0-69" id="h29-0-69" class="i">+	if (!(f = fopen(oomfile, &quot;w&quot;))) {
</a><a href="#h29-0-70" id="h29-0-70" class="i">+		if (errno == ENOENT)
</a><a href="#h29-0-71" id="h29-0-71" class="i">+			return;
</a><a href="#h29-0-72" id="h29-0-72" class="i">+		die(&quot;slock: fopen %s: %s\n&quot;, oomfile, strerror(errno));
</a><a href="#h29-0-73" id="h29-0-73" class="i">+	}
</a><a href="#h29-0-74" id="h29-0-74" class="i">+	fprintf(f, &quot;%d&quot;, OOM_SCORE_ADJ_MIN);
</a><a href="#h29-0-75" id="h29-0-75" class="i">+	if (fclose(f)) {
</a><a href="#h29-0-76" id="h29-0-76" class="i">+		if (errno == EACCES)
</a><a href="#h29-0-77" id="h29-0-77" class="i">+			die(&quot;slock: unable to disable OOM killer. &quot;
</a><a href="#h29-0-78" id="h29-0-78" class="i">+			    &quot;Make sure to suid or sgid slock.\n&quot;);
</a><a href="#h29-0-79" id="h29-0-79" class="i">+		else
</a><a href="#h29-0-80" id="h29-0-80" class="i">+			die(&quot;slock: fclose %s: %s\n&quot;, oomfile, strerror(errno));
</a><a href="#h29-0-81" id="h29-0-81" class="i">+	}
</a><a href="#h29-0-82" id="h29-0-82" class="i">+}
</a><a href="#h29-0-83" id="h29-0-83" class="i">+#endif
</a><a href="#h29-0-84" id="h29-0-84" class="i">+
</a><a href="#h29-0-85" id="h29-0-85" class="i">+static const char *
</a><a href="#h29-0-86" id="h29-0-86" class="i">+gethash(void)
</a><a href="#h29-0-87" id="h29-0-87" class="i">+{
</a><a href="#h29-0-88" id="h29-0-88" class="i">+	const char *hash;
</a><a href="#h29-0-89" id="h29-0-89" class="i">+	struct passwd *pw;
</a><a href="#h29-0-90" id="h29-0-90" class="i">+
</a><a href="#h29-0-91" id="h29-0-91" class="i">+	/* Check if the current user has a password entry */
</a><a href="#h29-0-92" id="h29-0-92" class="i">+	errno = 0;
</a><a href="#h29-0-93" id="h29-0-93" class="i">+	if (!(pw = getpwuid(getuid()))) {
</a><a href="#h29-0-94" id="h29-0-94" class="i">+		if (errno)
</a><a href="#h29-0-95" id="h29-0-95" class="i">+			die(&quot;slock: getpwuid: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-96" id="h29-0-96" class="i">+		else
</a><a href="#h29-0-97" id="h29-0-97" class="i">+			die(&quot;slock: cannot retrieve password entry\n&quot;);
</a><a href="#h29-0-98" id="h29-0-98" class="i">+	}
</a><a href="#h29-0-99" id="h29-0-99" class="i">+	hash = pw-&gt;pw_passwd;
</a><a href="#h29-0-100" id="h29-0-100" class="i">+
</a><a href="#h29-0-101" id="h29-0-101" class="i">+#if HAVE_SHADOW_H
</a><a href="#h29-0-102" id="h29-0-102" class="i">+	if (!strcmp(hash, &quot;x&quot;)) {
</a><a href="#h29-0-103" id="h29-0-103" class="i">+		struct spwd *sp;
</a><a href="#h29-0-104" id="h29-0-104" class="i">+		if (!(sp = getspnam(pw-&gt;pw_name)))
</a><a href="#h29-0-105" id="h29-0-105" class="i">+			die(&quot;slock: getspnam: cannot retrieve shadow entry. &quot;
</a><a href="#h29-0-106" id="h29-0-106" class="i">+			    &quot;Make sure to suid or sgid slock.\n&quot;);
</a><a href="#h29-0-107" id="h29-0-107" class="i">+		hash = sp-&gt;sp_pwdp;
</a><a href="#h29-0-108" id="h29-0-108" class="i">+	}
</a><a href="#h29-0-109" id="h29-0-109" class="i">+#else
</a><a href="#h29-0-110" id="h29-0-110" class="i">+	if (!strcmp(hash, &quot;*&quot;)) {
</a><a href="#h29-0-111" id="h29-0-111" class="i">+#ifdef __OpenBSD__
</a><a href="#h29-0-112" id="h29-0-112" class="i">+		if (!(pw = getpwuid_shadow(getuid())))
</a><a href="#h29-0-113" id="h29-0-113" class="i">+			die(&quot;slock: getpwnam_shadow: cannot retrieve shadow entry. &quot;
</a><a href="#h29-0-114" id="h29-0-114" class="i">+			    &quot;Make sure to suid or sgid slock.\n&quot;);
</a><a href="#h29-0-115" id="h29-0-115" class="i">+		hash = pw-&gt;pw_passwd;
</a><a href="#h29-0-116" id="h29-0-116" class="i">+#else
</a><a href="#h29-0-117" id="h29-0-117" class="i">+		die(&quot;slock: getpwuid: cannot retrieve shadow entry. &quot;
</a><a href="#h29-0-118" id="h29-0-118" class="i">+		    &quot;Make sure to suid or sgid slock.\n&quot;);
</a><a href="#h29-0-119" id="h29-0-119" class="i">+#endif /* __OpenBSD__ */
</a><a href="#h29-0-120" id="h29-0-120" class="i">+	}
</a><a href="#h29-0-121" id="h29-0-121" class="i">+#endif /* HAVE_SHADOW_H */
</a><a href="#h29-0-122" id="h29-0-122" class="i">+
</a><a href="#h29-0-123" id="h29-0-123" class="i">+	return hash;
</a><a href="#h29-0-124" id="h29-0-124" class="i">+}
</a><a href="#h29-0-125" id="h29-0-125" class="i">+
</a><a href="#h29-0-126" id="h29-0-126" class="i">+static void
</a><a href="#h29-0-127" id="h29-0-127" class="i">+readpw(Display *dpy, struct xrandr *rr, struct lock **locks, int nscreens,
</a><a href="#h29-0-128" id="h29-0-128" class="i">+       const char *hash)
</a><a href="#h29-0-129" id="h29-0-129" class="i">+{
</a><a href="#h29-0-130" id="h29-0-130" class="i">+	XRRScreenChangeNotifyEvent *rre;
</a><a href="#h29-0-131" id="h29-0-131" class="i">+	char buf[32], passwd[256], *inputhash;
</a><a href="#h29-0-132" id="h29-0-132" class="i">+	int num, screen, running, failure, oldc;
</a><a href="#h29-0-133" id="h29-0-133" class="i">+	unsigned int len, color;
</a><a href="#h29-0-134" id="h29-0-134" class="i">+	KeySym ksym;
</a><a href="#h29-0-135" id="h29-0-135" class="i">+	XEvent ev;
</a><a href="#h29-0-136" id="h29-0-136" class="i">+
</a><a href="#h29-0-137" id="h29-0-137" class="i">+	len = 0;
</a><a href="#h29-0-138" id="h29-0-138" class="i">+	running = 1;
</a><a href="#h29-0-139" id="h29-0-139" class="i">+	failure = 0;
</a><a href="#h29-0-140" id="h29-0-140" class="i">+	oldc = INIT;
</a><a href="#h29-0-141" id="h29-0-141" class="i">+
</a><a href="#h29-0-142" id="h29-0-142" class="i">+	while (running &amp;&amp; !XNextEvent(dpy, &amp;ev)) {
</a><a href="#h29-0-143" id="h29-0-143" class="i">+		if (ev.type == KeyPress) {
</a><a href="#h29-0-144" id="h29-0-144" class="i">+			explicit_bzero(&amp;buf, sizeof(buf));
</a><a href="#h29-0-145" id="h29-0-145" class="i">+			num = XLookupString(&amp;ev.xkey, buf, sizeof(buf), &amp;ksym, 0);
</a><a href="#h29-0-146" id="h29-0-146" class="i">+			if (IsKeypadKey(ksym)) {
</a><a href="#h29-0-147" id="h29-0-147" class="i">+				if (ksym == XK_KP_Enter)
</a><a href="#h29-0-148" id="h29-0-148" class="i">+					ksym = XK_Return;
</a><a href="#h29-0-149" id="h29-0-149" class="i">+				else if (ksym &gt;= XK_KP_0 &amp;&amp; ksym &lt;= XK_KP_9)
</a><a href="#h29-0-150" id="h29-0-150" class="i">+					ksym = (ksym - XK_KP_0) + XK_0;
</a><a href="#h29-0-151" id="h29-0-151" class="i">+			}
</a><a href="#h29-0-152" id="h29-0-152" class="i">+			if (IsFunctionKey(ksym) ||
</a><a href="#h29-0-153" id="h29-0-153" class="i">+			    IsKeypadKey(ksym) ||
</a><a href="#h29-0-154" id="h29-0-154" class="i">+			    IsMiscFunctionKey(ksym) ||
</a><a href="#h29-0-155" id="h29-0-155" class="i">+			    IsPFKey(ksym) ||
</a><a href="#h29-0-156" id="h29-0-156" class="i">+			    IsPrivateKeypadKey(ksym))
</a><a href="#h29-0-157" id="h29-0-157" class="i">+				continue;
</a><a href="#h29-0-158" id="h29-0-158" class="i">+			switch (ksym) {
</a><a href="#h29-0-159" id="h29-0-159" class="i">+			case XK_Return:
</a><a href="#h29-0-160" id="h29-0-160" class="i">+				passwd[len] = &#39;\0&#39;;
</a><a href="#h29-0-161" id="h29-0-161" class="i">+				errno = 0;
</a><a href="#h29-0-162" id="h29-0-162" class="i">+				if (!(inputhash = crypt(passwd, hash)))
</a><a href="#h29-0-163" id="h29-0-163" class="i">+					fprintf(stderr, &quot;slock: crypt: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-164" id="h29-0-164" class="i">+				else
</a><a href="#h29-0-165" id="h29-0-165" class="i">+					running = !!strcmp(inputhash, hash);
</a><a href="#h29-0-166" id="h29-0-166" class="i">+				if (running) {
</a><a href="#h29-0-167" id="h29-0-167" class="i">+					XBell(dpy, 100);
</a><a href="#h29-0-168" id="h29-0-168" class="i">+					failure = 1;
</a><a href="#h29-0-169" id="h29-0-169" class="i">+				}
</a><a href="#h29-0-170" id="h29-0-170" class="i">+				explicit_bzero(&amp;passwd, sizeof(passwd));
</a><a href="#h29-0-171" id="h29-0-171" class="i">+				len = 0;
</a><a href="#h29-0-172" id="h29-0-172" class="i">+				break;
</a><a href="#h29-0-173" id="h29-0-173" class="i">+			case XK_Escape:
</a><a href="#h29-0-174" id="h29-0-174" class="i">+				explicit_bzero(&amp;passwd, sizeof(passwd));
</a><a href="#h29-0-175" id="h29-0-175" class="i">+				len = 0;
</a><a href="#h29-0-176" id="h29-0-176" class="i">+				break;
</a><a href="#h29-0-177" id="h29-0-177" class="i">+			case XK_BackSpace:
</a><a href="#h29-0-178" id="h29-0-178" class="i">+				if (len)
</a><a href="#h29-0-179" id="h29-0-179" class="i">+					passwd[--len] = &#39;\0&#39;;
</a><a href="#h29-0-180" id="h29-0-180" class="i">+				break;
</a><a href="#h29-0-181" id="h29-0-181" class="i">+			default:
</a><a href="#h29-0-182" id="h29-0-182" class="i">+				if (num &amp;&amp; !iscntrl((int)buf[0]) &amp;&amp;
</a><a href="#h29-0-183" id="h29-0-183" class="i">+				    (len + num &lt; sizeof(passwd))) {
</a><a href="#h29-0-184" id="h29-0-184" class="i">+					memcpy(passwd + len, buf, num);
</a><a href="#h29-0-185" id="h29-0-185" class="i">+					len += num;
</a><a href="#h29-0-186" id="h29-0-186" class="i">+				}
</a><a href="#h29-0-187" id="h29-0-187" class="i">+				break;
</a><a href="#h29-0-188" id="h29-0-188" class="i">+			}
</a><a href="#h29-0-189" id="h29-0-189" class="i">+			color = len ? INPUT : ((failure || failonclear) ? FAILED : INIT);
</a><a href="#h29-0-190" id="h29-0-190" class="i">+			if (running &amp;&amp; oldc != color) {
</a><a href="#h29-0-191" id="h29-0-191" class="i">+				for (screen = 0; screen &lt; nscreens; screen++) {
</a><a href="#h29-0-192" id="h29-0-192" class="i">+					XSetWindowBackground(dpy,
</a><a href="#h29-0-193" id="h29-0-193" class="i">+					                     locks[screen]-&gt;win,
</a><a href="#h29-0-194" id="h29-0-194" class="i">+					                     locks[screen]-&gt;colors[color]);
</a><a href="#h29-0-195" id="h29-0-195" class="i">+					XClearWindow(dpy, locks[screen]-&gt;win);
</a><a href="#h29-0-196" id="h29-0-196" class="i">+				}
</a><a href="#h29-0-197" id="h29-0-197" class="i">+				oldc = color;
</a><a href="#h29-0-198" id="h29-0-198" class="i">+			}
</a><a href="#h29-0-199" id="h29-0-199" class="i">+		} else if (rr-&gt;active &amp;&amp; ev.type == rr-&gt;evbase + RRScreenChangeNotify) {
</a><a href="#h29-0-200" id="h29-0-200" class="i">+			rre = (XRRScreenChangeNotifyEvent*)&amp;ev;
</a><a href="#h29-0-201" id="h29-0-201" class="i">+			for (screen = 0; screen &lt; nscreens; screen++) {
</a><a href="#h29-0-202" id="h29-0-202" class="i">+				if (locks[screen]-&gt;win == rre-&gt;window) {
</a><a href="#h29-0-203" id="h29-0-203" class="i">+					if (rre-&gt;rotation == RR_Rotate_90 ||
</a><a href="#h29-0-204" id="h29-0-204" class="i">+					    rre-&gt;rotation == RR_Rotate_270)
</a><a href="#h29-0-205" id="h29-0-205" class="i">+						XResizeWindow(dpy, locks[screen]-&gt;win,
</a><a href="#h29-0-206" id="h29-0-206" class="i">+						              rre-&gt;height, rre-&gt;width);
</a><a href="#h29-0-207" id="h29-0-207" class="i">+					else
</a><a href="#h29-0-208" id="h29-0-208" class="i">+						XResizeWindow(dpy, locks[screen]-&gt;win,
</a><a href="#h29-0-209" id="h29-0-209" class="i">+						              rre-&gt;width, rre-&gt;height);
</a><a href="#h29-0-210" id="h29-0-210" class="i">+					XClearWindow(dpy, locks[screen]-&gt;win);
</a><a href="#h29-0-211" id="h29-0-211" class="i">+					break;
</a><a href="#h29-0-212" id="h29-0-212" class="i">+				}
</a><a href="#h29-0-213" id="h29-0-213" class="i">+			}
</a><a href="#h29-0-214" id="h29-0-214" class="i">+		} else {
</a><a href="#h29-0-215" id="h29-0-215" class="i">+			for (screen = 0; screen &lt; nscreens; screen++)
</a><a href="#h29-0-216" id="h29-0-216" class="i">+				XRaiseWindow(dpy, locks[screen]-&gt;win);
</a><a href="#h29-0-217" id="h29-0-217" class="i">+		}
</a><a href="#h29-0-218" id="h29-0-218" class="i">+	}
</a><a href="#h29-0-219" id="h29-0-219" class="i">+}
</a><a href="#h29-0-220" id="h29-0-220" class="i">+
</a><a href="#h29-0-221" id="h29-0-221" class="i">+static struct lock *
</a><a href="#h29-0-222" id="h29-0-222" class="i">+lockscreen(Display *dpy, struct xrandr *rr, int screen)
</a><a href="#h29-0-223" id="h29-0-223" class="i">+{
</a><a href="#h29-0-224" id="h29-0-224" class="i">+	char curs[] = {0, 0, 0, 0, 0, 0, 0, 0};
</a><a href="#h29-0-225" id="h29-0-225" class="i">+	int i, ptgrab, kbgrab;
</a><a href="#h29-0-226" id="h29-0-226" class="i">+	struct lock *lock;
</a><a href="#h29-0-227" id="h29-0-227" class="i">+	XColor color, dummy;
</a><a href="#h29-0-228" id="h29-0-228" class="i">+	XSetWindowAttributes wa;
</a><a href="#h29-0-229" id="h29-0-229" class="i">+	Cursor invisible;
</a><a href="#h29-0-230" id="h29-0-230" class="i">+
</a><a href="#h29-0-231" id="h29-0-231" class="i">+	if (dpy == NULL || screen &lt; 0 || !(lock = malloc(sizeof(struct lock))))
</a><a href="#h29-0-232" id="h29-0-232" class="i">+		return NULL;
</a><a href="#h29-0-233" id="h29-0-233" class="i">+
</a><a href="#h29-0-234" id="h29-0-234" class="i">+	lock-&gt;screen = screen;
</a><a href="#h29-0-235" id="h29-0-235" class="i">+	lock-&gt;root = RootWindow(dpy, lock-&gt;screen);
</a><a href="#h29-0-236" id="h29-0-236" class="i">+
</a><a href="#h29-0-237" id="h29-0-237" class="i">+	for (i = 0; i &lt; NUMCOLS; i++) {
</a><a href="#h29-0-238" id="h29-0-238" class="i">+		XAllocNamedColor(dpy, DefaultColormap(dpy, lock-&gt;screen),
</a><a href="#h29-0-239" id="h29-0-239" class="i">+		                 colorname[i], &amp;color, &amp;dummy);
</a><a href="#h29-0-240" id="h29-0-240" class="i">+		lock-&gt;colors[i] = color.pixel;
</a><a href="#h29-0-241" id="h29-0-241" class="i">+	}
</a><a href="#h29-0-242" id="h29-0-242" class="i">+
</a><a href="#h29-0-243" id="h29-0-243" class="i">+	/* init */
</a><a href="#h29-0-244" id="h29-0-244" class="i">+	wa.override_redirect = 1;
</a><a href="#h29-0-245" id="h29-0-245" class="i">+	wa.background_pixel = lock-&gt;colors[INIT];
</a><a href="#h29-0-246" id="h29-0-246" class="i">+	lock-&gt;win = XCreateWindow(dpy, lock-&gt;root, 0, 0,
</a><a href="#h29-0-247" id="h29-0-247" class="i">+	                          DisplayWidth(dpy, lock-&gt;screen),
</a><a href="#h29-0-248" id="h29-0-248" class="i">+	                          DisplayHeight(dpy, lock-&gt;screen),
</a><a href="#h29-0-249" id="h29-0-249" class="i">+	                          0, DefaultDepth(dpy, lock-&gt;screen),
</a><a href="#h29-0-250" id="h29-0-250" class="i">+	                          CopyFromParent,
</a><a href="#h29-0-251" id="h29-0-251" class="i">+	                          DefaultVisual(dpy, lock-&gt;screen),
</a><a href="#h29-0-252" id="h29-0-252" class="i">+	                          CWOverrideRedirect | CWBackPixel, &amp;wa);
</a><a href="#h29-0-253" id="h29-0-253" class="i">+	lock-&gt;pmap = XCreateBitmapFromData(dpy, lock-&gt;win, curs, 8, 8);
</a><a href="#h29-0-254" id="h29-0-254" class="i">+	invisible = XCreatePixmapCursor(dpy, lock-&gt;pmap, lock-&gt;pmap,
</a><a href="#h29-0-255" id="h29-0-255" class="i">+	                                &amp;color, &amp;color, 0, 0);
</a><a href="#h29-0-256" id="h29-0-256" class="i">+	XDefineCursor(dpy, lock-&gt;win, invisible);
</a><a href="#h29-0-257" id="h29-0-257" class="i">+
</a><a href="#h29-0-258" id="h29-0-258" class="i">+	/* Try to grab mouse pointer *and* keyboard for 600ms, else fail the lock */
</a><a href="#h29-0-259" id="h29-0-259" class="i">+	for (i = 0, ptgrab = kbgrab = -1; i &lt; 6; i++) {
</a><a href="#h29-0-260" id="h29-0-260" class="i">+		if (ptgrab != GrabSuccess) {
</a><a href="#h29-0-261" id="h29-0-261" class="i">+			ptgrab = XGrabPointer(dpy, lock-&gt;root, False,
</a><a href="#h29-0-262" id="h29-0-262" class="i">+			                      ButtonPressMask | ButtonReleaseMask |
</a><a href="#h29-0-263" id="h29-0-263" class="i">+			                      PointerMotionMask, GrabModeAsync,
</a><a href="#h29-0-264" id="h29-0-264" class="i">+			                      GrabModeAsync, None, invisible, CurrentTime);
</a><a href="#h29-0-265" id="h29-0-265" class="i">+		}
</a><a href="#h29-0-266" id="h29-0-266" class="i">+		if (kbgrab != GrabSuccess) {
</a><a href="#h29-0-267" id="h29-0-267" class="i">+			kbgrab = XGrabKeyboard(dpy, lock-&gt;root, True,
</a><a href="#h29-0-268" id="h29-0-268" class="i">+			                       GrabModeAsync, GrabModeAsync, CurrentTime);
</a><a href="#h29-0-269" id="h29-0-269" class="i">+		}
</a><a href="#h29-0-270" id="h29-0-270" class="i">+
</a><a href="#h29-0-271" id="h29-0-271" class="i">+		/* input is grabbed: we can lock the screen */
</a><a href="#h29-0-272" id="h29-0-272" class="i">+		if (ptgrab == GrabSuccess &amp;&amp; kbgrab == GrabSuccess) {
</a><a href="#h29-0-273" id="h29-0-273" class="i">+			XMapRaised(dpy, lock-&gt;win);
</a><a href="#h29-0-274" id="h29-0-274" class="i">+			if (rr-&gt;active)
</a><a href="#h29-0-275" id="h29-0-275" class="i">+				XRRSelectInput(dpy, lock-&gt;win, RRScreenChangeNotifyMask);
</a><a href="#h29-0-276" id="h29-0-276" class="i">+
</a><a href="#h29-0-277" id="h29-0-277" class="i">+			XSelectInput(dpy, lock-&gt;root, SubstructureNotifyMask);
</a><a href="#h29-0-278" id="h29-0-278" class="i">+			return lock;
</a><a href="#h29-0-279" id="h29-0-279" class="i">+		}
</a><a href="#h29-0-280" id="h29-0-280" class="i">+
</a><a href="#h29-0-281" id="h29-0-281" class="i">+		/* retry on AlreadyGrabbed but fail on other errors */
</a><a href="#h29-0-282" id="h29-0-282" class="i">+		if ((ptgrab != AlreadyGrabbed &amp;&amp; ptgrab != GrabSuccess) ||
</a><a href="#h29-0-283" id="h29-0-283" class="i">+		    (kbgrab != AlreadyGrabbed &amp;&amp; kbgrab != GrabSuccess))
</a><a href="#h29-0-284" id="h29-0-284" class="i">+			break;
</a><a href="#h29-0-285" id="h29-0-285" class="i">+
</a><a href="#h29-0-286" id="h29-0-286" class="i">+		usleep(100000);
</a><a href="#h29-0-287" id="h29-0-287" class="i">+	}
</a><a href="#h29-0-288" id="h29-0-288" class="i">+
</a><a href="#h29-0-289" id="h29-0-289" class="i">+	/* we couldn&#39;t grab all input: fail out */
</a><a href="#h29-0-290" id="h29-0-290" class="i">+	if (ptgrab != GrabSuccess)
</a><a href="#h29-0-291" id="h29-0-291" class="i">+		fprintf(stderr, &quot;slock: unable to grab mouse pointer for screen %d\n&quot;,
</a><a href="#h29-0-292" id="h29-0-292" class="i">+		        screen);
</a><a href="#h29-0-293" id="h29-0-293" class="i">+	if (kbgrab != GrabSuccess)
</a><a href="#h29-0-294" id="h29-0-294" class="i">+		fprintf(stderr, &quot;slock: unable to grab keyboard for screen %d\n&quot;,
</a><a href="#h29-0-295" id="h29-0-295" class="i">+		        screen);
</a><a href="#h29-0-296" id="h29-0-296" class="i">+	return NULL;
</a><a href="#h29-0-297" id="h29-0-297" class="i">+}
</a><a href="#h29-0-298" id="h29-0-298" class="i">+
</a><a href="#h29-0-299" id="h29-0-299" class="i">+static void
</a><a href="#h29-0-300" id="h29-0-300" class="i">+usage(void)
</a><a href="#h29-0-301" id="h29-0-301" class="i">+{
</a><a href="#h29-0-302" id="h29-0-302" class="i">+	die(&quot;usage: slock [-v] [cmd [arg ...]]\n&quot;);
</a><a href="#h29-0-303" id="h29-0-303" class="i">+}
</a><a href="#h29-0-304" id="h29-0-304" class="i">+
</a><a href="#h29-0-305" id="h29-0-305" class="i">+int
</a><a href="#h29-0-306" id="h29-0-306" class="i">+main(int argc, char **argv) {
</a><a href="#h29-0-307" id="h29-0-307" class="i">+	struct xrandr rr;
</a><a href="#h29-0-308" id="h29-0-308" class="i">+	struct lock **locks;
</a><a href="#h29-0-309" id="h29-0-309" class="i">+	struct passwd *pwd;
</a><a href="#h29-0-310" id="h29-0-310" class="i">+	struct group *grp;
</a><a href="#h29-0-311" id="h29-0-311" class="i">+	uid_t duid;
</a><a href="#h29-0-312" id="h29-0-312" class="i">+	gid_t dgid;
</a><a href="#h29-0-313" id="h29-0-313" class="i">+	const char *hash;
</a><a href="#h29-0-314" id="h29-0-314" class="i">+	Display *dpy;
</a><a href="#h29-0-315" id="h29-0-315" class="i">+	int s, nlocks, nscreens;
</a><a href="#h29-0-316" id="h29-0-316" class="i">+
</a><a href="#h29-0-317" id="h29-0-317" class="i">+	ARGBEGIN {
</a><a href="#h29-0-318" id="h29-0-318" class="i">+	case &#39;v&#39;:
</a><a href="#h29-0-319" id="h29-0-319" class="i">+		fprintf(stderr, &quot;slock-&quot;VERSION&quot;\n&quot;);
</a><a href="#h29-0-320" id="h29-0-320" class="i">+		return 0;
</a><a href="#h29-0-321" id="h29-0-321" class="i">+	default:
</a><a href="#h29-0-322" id="h29-0-322" class="i">+		usage();
</a><a href="#h29-0-323" id="h29-0-323" class="i">+	} ARGEND
</a><a href="#h29-0-324" id="h29-0-324" class="i">+
</a><a href="#h29-0-325" id="h29-0-325" class="i">+	/* validate drop-user and -group */
</a><a href="#h29-0-326" id="h29-0-326" class="i">+	errno = 0;
</a><a href="#h29-0-327" id="h29-0-327" class="i">+	if (!(pwd = getpwnam(user)))
</a><a href="#h29-0-328" id="h29-0-328" class="i">+		die(&quot;slock: getpwnam %s: %s\n&quot;, user,
</a><a href="#h29-0-329" id="h29-0-329" class="i">+		    errno ? strerror(errno) : &quot;user entry not found&quot;);
</a><a href="#h29-0-330" id="h29-0-330" class="i">+	duid = pwd-&gt;pw_uid;
</a><a href="#h29-0-331" id="h29-0-331" class="i">+	errno = 0;
</a><a href="#h29-0-332" id="h29-0-332" class="i">+	if (!(grp = getgrnam(group)))
</a><a href="#h29-0-333" id="h29-0-333" class="i">+		die(&quot;slock: getgrnam %s: %s\n&quot;, group,
</a><a href="#h29-0-334" id="h29-0-334" class="i">+		    errno ? strerror(errno) : &quot;group entry not found&quot;);
</a><a href="#h29-0-335" id="h29-0-335" class="i">+	dgid = grp-&gt;gr_gid;
</a><a href="#h29-0-336" id="h29-0-336" class="i">+
</a><a href="#h29-0-337" id="h29-0-337" class="i">+#ifdef __linux__
</a><a href="#h29-0-338" id="h29-0-338" class="i">+	dontkillme();
</a><a href="#h29-0-339" id="h29-0-339" class="i">+#endif
</a><a href="#h29-0-340" id="h29-0-340" class="i">+
</a><a href="#h29-0-341" id="h29-0-341" class="i">+	hash = gethash();
</a><a href="#h29-0-342" id="h29-0-342" class="i">+	errno = 0;
</a><a href="#h29-0-343" id="h29-0-343" class="i">+	if (!crypt(&quot;&quot;, hash))
</a><a href="#h29-0-344" id="h29-0-344" class="i">+		die(&quot;slock: crypt: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-345" id="h29-0-345" class="i">+
</a><a href="#h29-0-346" id="h29-0-346" class="i">+	if (!(dpy = XOpenDisplay(NULL)))
</a><a href="#h29-0-347" id="h29-0-347" class="i">+		die(&quot;slock: cannot open display\n&quot;);
</a><a href="#h29-0-348" id="h29-0-348" class="i">+
</a><a href="#h29-0-349" id="h29-0-349" class="i">+	/* drop privileges */
</a><a href="#h29-0-350" id="h29-0-350" class="i">+	if (setgroups(0, NULL) &lt; 0)
</a><a href="#h29-0-351" id="h29-0-351" class="i">+		die(&quot;slock: setgroups: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-352" id="h29-0-352" class="i">+	if (setgid(dgid) &lt; 0)
</a><a href="#h29-0-353" id="h29-0-353" class="i">+		die(&quot;slock: setgid: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-354" id="h29-0-354" class="i">+	if (setuid(duid) &lt; 0)
</a><a href="#h29-0-355" id="h29-0-355" class="i">+		die(&quot;slock: setuid: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-356" id="h29-0-356" class="i">+
</a><a href="#h29-0-357" id="h29-0-357" class="i">+	/* check for Xrandr support */
</a><a href="#h29-0-358" id="h29-0-358" class="i">+	rr.active = XRRQueryExtension(dpy, &amp;rr.evbase, &amp;rr.errbase);
</a><a href="#h29-0-359" id="h29-0-359" class="i">+
</a><a href="#h29-0-360" id="h29-0-360" class="i">+	/* get number of screens in display &quot;dpy&quot; and blank them */
</a><a href="#h29-0-361" id="h29-0-361" class="i">+	nscreens = ScreenCount(dpy);
</a><a href="#h29-0-362" id="h29-0-362" class="i">+	if (!(locks = calloc(nscreens, sizeof(struct lock *))))
</a><a href="#h29-0-363" id="h29-0-363" class="i">+		die(&quot;slock: out of memory\n&quot;);
</a><a href="#h29-0-364" id="h29-0-364" class="i">+	for (nlocks = 0, s = 0; s &lt; nscreens; s++) {
</a><a href="#h29-0-365" id="h29-0-365" class="i">+		if ((locks[s] = lockscreen(dpy, &amp;rr, s)) != NULL)
</a><a href="#h29-0-366" id="h29-0-366" class="i">+			nlocks++;
</a><a href="#h29-0-367" id="h29-0-367" class="i">+		else
</a><a href="#h29-0-368" id="h29-0-368" class="i">+			break;
</a><a href="#h29-0-369" id="h29-0-369" class="i">+	}
</a><a href="#h29-0-370" id="h29-0-370" class="i">+	XSync(dpy, 0);
</a><a href="#h29-0-371" id="h29-0-371" class="i">+
</a><a href="#h29-0-372" id="h29-0-372" class="i">+	/* did we manage to lock everything? */
</a><a href="#h29-0-373" id="h29-0-373" class="i">+	if (nlocks != nscreens)
</a><a href="#h29-0-374" id="h29-0-374" class="i">+		return 1;
</a><a href="#h29-0-375" id="h29-0-375" class="i">+
</a><a href="#h29-0-376" id="h29-0-376" class="i">+	/* run post-lock command */
</a><a href="#h29-0-377" id="h29-0-377" class="i">+	if (argc &gt; 0) {
</a><a href="#h29-0-378" id="h29-0-378" class="i">+		switch (fork()) {
</a><a href="#h29-0-379" id="h29-0-379" class="i">+		case -1:
</a><a href="#h29-0-380" id="h29-0-380" class="i">+			die(&quot;slock: fork failed: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-381" id="h29-0-381" class="i">+		case 0:
</a><a href="#h29-0-382" id="h29-0-382" class="i">+			if (close(ConnectionNumber(dpy)) &lt; 0)
</a><a href="#h29-0-383" id="h29-0-383" class="i">+				die(&quot;slock: close: %s\n&quot;, strerror(errno));
</a><a href="#h29-0-384" id="h29-0-384" class="i">+			execvp(argv[0], argv);
</a><a href="#h29-0-385" id="h29-0-385" class="i">+			fprintf(stderr, &quot;slock: execvp %s: %s\n&quot;, argv[0], strerror(errno));
</a><a href="#h29-0-386" id="h29-0-386" class="i">+			_exit(1);
</a><a href="#h29-0-387" id="h29-0-387" class="i">+		}
</a><a href="#h29-0-388" id="h29-0-388" class="i">+	}
</a><a href="#h29-0-389" id="h29-0-389" class="i">+
</a><a href="#h29-0-390" id="h29-0-390" class="i">+	/* everything is now blank. Wait for the correct password */
</a><a href="#h29-0-391" id="h29-0-391" class="i">+	readpw(dpy, &amp;rr, locks, nscreens, hash);
</a><a href="#h29-0-392" id="h29-0-392" class="i">+
</a><a href="#h29-0-393" id="h29-0-393" class="i">+	return 0;
</a><a href="#h29-0-394" id="h29-0-394" class="i">+}
</a><b>diff --git a/<a id="h30" href="../file/slock/slock.o.html">slock/slock.o</a> b/<a href="../file/slock/slock.o.html">slock/slock.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h31" href="../file/slock/util.h.html">slock/util.h</a> b/<a href="../file/slock/util.h.html">slock/util.h</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -0,0 +1,2 @@
</a><a href="#h31-0-0" id="h31-0-0" class="i">+#undef explicit_bzero
</a><a href="#h31-0-1" id="h31-0-1" class="i">+void explicit_bzero(void *, size_t);
</a><b>diff --git a/<a id="h32" href="../file/st/FAQ.html">st/FAQ</a> b/<a href="../file/st/FAQ.html">st/FAQ</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -0,0 +1,167 @@
</a><a href="#h32-0-0" id="h32-0-0" class="i">+## Why does st not handle utmp entries?
</a><a href="#h32-0-1" id="h32-0-1" class="i">+
</a><a href="#h32-0-2" id="h32-0-2" class="i">+Use the excellent tool of [utmp](http://git.suckless.org/utmp/) for this task.
</a><a href="#h32-0-3" id="h32-0-3" class="i">+
</a><a href="#h32-0-4" id="h32-0-4" class="i">+## Some _random program_ complains that st is unknown/not recognised/unsupported/whatever!
</a><a href="#h32-0-5" id="h32-0-5" class="i">+
</a><a href="#h32-0-6" id="h32-0-6" class="i">+It means that st doesn’t have any terminfo entry on your system. Chances are
</a><a href="#h32-0-7" id="h32-0-7" class="i">+you did not `make install`. If you just want to test it without installing it,
</a><a href="#h32-0-8" id="h32-0-8" class="i">+you can manually run `tic -sx st.info`.
</a><a href="#h32-0-9" id="h32-0-9" class="i">+
</a><a href="#h32-0-10" id="h32-0-10" class="i">+## Nothing works, and nothing is said about an unknown terminal!
</a><a href="#h32-0-11" id="h32-0-11" class="i">+
</a><a href="#h32-0-12" id="h32-0-12" class="i">+* Some programs just assume they’re running in xterm i.e. they don’t rely on
</a><a href="#h32-0-13" id="h32-0-13" class="i">+  terminfo. What you see is the current state of the “xterm compliance”.
</a><a href="#h32-0-14" id="h32-0-14" class="i">+* Some programs don’t complain about the lacking st description and default to
</a><a href="#h32-0-15" id="h32-0-15" class="i">+  another terminal. In that case see the question about terminfo.
</a><a href="#h32-0-16" id="h32-0-16" class="i">+
</a><a href="#h32-0-17" id="h32-0-17" class="i">+## I get some weird glitches/visual bug on _random program_!
</a><a href="#h32-0-18" id="h32-0-18" class="i">+
</a><a href="#h32-0-19" id="h32-0-19" class="i">+Try launching it with a different TERM: $ TERM=xterm myapp. toe(1) will give
</a><a href="#h32-0-20" id="h32-0-20" class="i">+you a list of available terminals, but you’ll most likely switch between xterm,
</a><a href="#h32-0-21" id="h32-0-21" class="i">+st or st-256color. The default value for TERM can be changed in config.h
</a><a href="#h32-0-22" id="h32-0-22" class="i">+(TNAME).
</a><a href="#h32-0-23" id="h32-0-23" class="i">+
</a><a href="#h32-0-24" id="h32-0-24" class="i">+## How do I scroll back up?
</a><a href="#h32-0-25" id="h32-0-25" class="i">+
</a><a href="#h32-0-26" id="h32-0-26" class="i">+Using a terminal multiplexer.
</a><a href="#h32-0-27" id="h32-0-27" class="i">+
</a><a href="#h32-0-28" id="h32-0-28" class="i">+* `st -e tmux` using C-b [
</a><a href="#h32-0-29" id="h32-0-29" class="i">+* `st -e screen` using C-a ESC
</a><a href="#h32-0-30" id="h32-0-30" class="i">+
</a><a href="#h32-0-31" id="h32-0-31" class="i">+## Why doesn&#39;t the Del key work in some programs?
</a><a href="#h32-0-32" id="h32-0-32" class="i">+
</a><a href="#h32-0-33" id="h32-0-33" class="i">+Taken from the terminfo manpage:
</a><a href="#h32-0-34" id="h32-0-34" class="i">+
</a><a href="#h32-0-35" id="h32-0-35" class="i">+	If the terminal has a keypad that transmits codes when the keys
</a><a href="#h32-0-36" id="h32-0-36" class="i">+	are pressed, this information can be given. Note that it is not
</a><a href="#h32-0-37" id="h32-0-37" class="i">+	possible to handle terminals where the keypad only works in
</a><a href="#h32-0-38" id="h32-0-38" class="i">+	local (this applies, for example, to the unshifted HP 2621 keys).
</a><a href="#h32-0-39" id="h32-0-39" class="i">+	If the keypad can be set to transmit or not transmit, give these
</a><a href="#h32-0-40" id="h32-0-40" class="i">+	codes as smkx and rmkx. Otherwise the keypad is assumed to
</a><a href="#h32-0-41" id="h32-0-41" class="i">+	always transmit.
</a><a href="#h32-0-42" id="h32-0-42" class="i">+
</a><a href="#h32-0-43" id="h32-0-43" class="i">+In the st case smkx=E[?1hE= and rmkx=E[?1lE&gt;, so it is mandatory that
</a><a href="#h32-0-44" id="h32-0-44" class="i">+applications which want to test against keypad keys send these
</a><a href="#h32-0-45" id="h32-0-45" class="i">+sequences.
</a><a href="#h32-0-46" id="h32-0-46" class="i">+
</a><a href="#h32-0-47" id="h32-0-47" class="i">+But buggy applications (like bash and irssi, for example) don&#39;t do this. A fast
</a><a href="#h32-0-48" id="h32-0-48" class="i">+solution for them is to use the following command:
</a><a href="#h32-0-49" id="h32-0-49" class="i">+
</a><a href="#h32-0-50" id="h32-0-50" class="i">+	$ printf &#39;\033[?1h\033=&#39; &gt;/dev/tty
</a><a href="#h32-0-51" id="h32-0-51" class="i">+
</a><a href="#h32-0-52" id="h32-0-52" class="i">+or
</a><a href="#h32-0-53" id="h32-0-53" class="i">+	$ tput smkx
</a><a href="#h32-0-54" id="h32-0-54" class="i">+
</a><a href="#h32-0-55" id="h32-0-55" class="i">+In the case of bash, readline is used. Readline has a different note in its
</a><a href="#h32-0-56" id="h32-0-56" class="i">+manpage about this issue:
</a><a href="#h32-0-57" id="h32-0-57" class="i">+
</a><a href="#h32-0-58" id="h32-0-58" class="i">+	enable-keypad (Off)
</a><a href="#h32-0-59" id="h32-0-59" class="i">+		When set to On, readline will try to enable the
</a><a href="#h32-0-60" id="h32-0-60" class="i">+		application keypad when it is called. Some systems
</a><a href="#h32-0-61" id="h32-0-61" class="i">+		need this to enable arrow keys.
</a><a href="#h32-0-62" id="h32-0-62" class="i">+
</a><a href="#h32-0-63" id="h32-0-63" class="i">+Adding this option to your .inputrc will fix the keypad problem for all
</a><a href="#h32-0-64" id="h32-0-64" class="i">+applications using readline.
</a><a href="#h32-0-65" id="h32-0-65" class="i">+
</a><a href="#h32-0-66" id="h32-0-66" class="i">+If you are using zsh, then read the zsh FAQ
</a><a href="#h32-0-67" id="h32-0-67" class="i">+&lt;http://zsh.sourceforge.net/FAQ/zshfaq03.html#l25&gt;:
</a><a href="#h32-0-68" id="h32-0-68" class="i">+
</a><a href="#h32-0-69" id="h32-0-69" class="i">+	It should be noted that the O / [ confusion can occur with other keys
</a><a href="#h32-0-70" id="h32-0-70" class="i">+	such as Home and End. Some systems let you query the key sequences
</a><a href="#h32-0-71" id="h32-0-71" class="i">+	sent by these keys from the system&#39;s terminal database, terminfo.
</a><a href="#h32-0-72" id="h32-0-72" class="i">+	Unfortunately, the key sequences given there typically apply to the
</a><a href="#h32-0-73" id="h32-0-73" class="i">+	mode that is not the one zsh uses by default (it&#39;s the &quot;application&quot;
</a><a href="#h32-0-74" id="h32-0-74" class="i">+	mode rather than the &quot;raw&quot; mode). Explaining the use of terminfo is
</a><a href="#h32-0-75" id="h32-0-75" class="i">+	outside of the scope of this FAQ, but if you wish to use the key
</a><a href="#h32-0-76" id="h32-0-76" class="i">+	sequences given there you can tell the line editor to turn on
</a><a href="#h32-0-77" id="h32-0-77" class="i">+	&quot;application&quot; mode when it starts and turn it off when it stops:
</a><a href="#h32-0-78" id="h32-0-78" class="i">+
</a><a href="#h32-0-79" id="h32-0-79" class="i">+		function zle-line-init () { echoti smkx }
</a><a href="#h32-0-80" id="h32-0-80" class="i">+		function zle-line-finish () { echoti rmkx }
</a><a href="#h32-0-81" id="h32-0-81" class="i">+		zle -N zle-line-init
</a><a href="#h32-0-82" id="h32-0-82" class="i">+		zle -N zle-line-finish
</a><a href="#h32-0-83" id="h32-0-83" class="i">+
</a><a href="#h32-0-84" id="h32-0-84" class="i">+Putting these lines into your .zshrc will fix the problems.
</a><a href="#h32-0-85" id="h32-0-85" class="i">+
</a><a href="#h32-0-86" id="h32-0-86" class="i">+## How can I use meta in 8bit mode?
</a><a href="#h32-0-87" id="h32-0-87" class="i">+
</a><a href="#h32-0-88" id="h32-0-88" class="i">+St supports meta in 8bit mode, but the default terminfo entry doesn&#39;t
</a><a href="#h32-0-89" id="h32-0-89" class="i">+use this capability. If you want it, you have to use the &#39;st-meta&#39; value
</a><a href="#h32-0-90" id="h32-0-90" class="i">+in TERM.
</a><a href="#h32-0-91" id="h32-0-91" class="i">+
</a><a href="#h32-0-92" id="h32-0-92" class="i">+## I cannot compile st in OpenBSD
</a><a href="#h32-0-93" id="h32-0-93" class="i">+
</a><a href="#h32-0-94" id="h32-0-94" class="i">+OpenBSD lacks librt, despite it being mandatory in POSIX
</a><a href="#h32-0-95" id="h32-0-95" class="i">+&lt;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/c99.html#tag_20_11_13&gt;.
</a><a href="#h32-0-96" id="h32-0-96" class="i">+If you want to compile st for OpenBSD you have to remove -lrt from config.mk, and
</a><a href="#h32-0-97" id="h32-0-97" class="i">+st will compile without any loss of functionality, because all the functions are
</a><a href="#h32-0-98" id="h32-0-98" class="i">+included in libc on this platform.
</a><a href="#h32-0-99" id="h32-0-99" class="i">+
</a><a href="#h32-0-100" id="h32-0-100" class="i">+## The Backspace Case
</a><a href="#h32-0-101" id="h32-0-101" class="i">+
</a><a href="#h32-0-102" id="h32-0-102" class="i">+St is emulating the Linux way of handling backspace being delete and delete being
</a><a href="#h32-0-103" id="h32-0-103" class="i">+backspace.
</a><a href="#h32-0-104" id="h32-0-104" class="i">+
</a><a href="#h32-0-105" id="h32-0-105" class="i">+This is an issue that was discussed in suckless mailing list
</a><a href="#h32-0-106" id="h32-0-106" class="i">+&lt;http://lists.suckless.org/dev/1404/20697.html&gt;. Here is why some old grumpy
</a><a href="#h32-0-107" id="h32-0-107" class="i">+terminal users wants its backspace to be how he feels it:
</a><a href="#h32-0-108" id="h32-0-108" class="i">+
</a><a href="#h32-0-109" id="h32-0-109" class="i">+	Well, I am going to comment why I want to change the behaviour
</a><a href="#h32-0-110" id="h32-0-110" class="i">+	of this key. When ASCII was defined in 1968, communication
</a><a href="#h32-0-111" id="h32-0-111" class="i">+	with computers was done using punched cards, or hardcopy
</a><a href="#h32-0-112" id="h32-0-112" class="i">+	terminals (basically a typewriter machine connected with the
</a><a href="#h32-0-113" id="h32-0-113" class="i">+	computer using a serial port).  ASCII defines DELETE as 7F,
</a><a href="#h32-0-114" id="h32-0-114" class="i">+	because, in punched-card terms, it means all the holes of the
</a><a href="#h32-0-115" id="h32-0-115" class="i">+	card punched; it is thus a kind of &#39;physical delete&#39;. In the
</a><a href="#h32-0-116" id="h32-0-116" class="i">+	same way, the BACKSPACE key was a non-destructive backspace,
</a><a href="#h32-0-117" id="h32-0-117" class="i">+	as on a typewriter.  So, if you wanted to delete a character,
</a><a href="#h32-0-118" id="h32-0-118" class="i">+	you had to BACKSPACE and then DELETE.  Another use of BACKSPACE
</a><a href="#h32-0-119" id="h32-0-119" class="i">+	was to type accented characters, for example &#39;a BACKSPACE `&#39;.
</a><a href="#h32-0-120" id="h32-0-120" class="i">+	The VT100 had no BACKSPACE key; it was generated using the
</a><a href="#h32-0-121" id="h32-0-121" class="i">+	CONTROL key as another control character (CONTROL key sets to
</a><a href="#h32-0-122" id="h32-0-122" class="i">+	0 b7 b6 b5, so it converts H (code 0x48) into BACKSPACE (code
</a><a href="#h32-0-123" id="h32-0-123" class="i">+	0x08)), but it had a DELETE key in a similar position where
</a><a href="#h32-0-124" id="h32-0-124" class="i">+	the BACKSPACE key is located today on common PC keyboards.
</a><a href="#h32-0-125" id="h32-0-125" class="i">+	All the terminal emulators emulated the difference between
</a><a href="#h32-0-126" id="h32-0-126" class="i">+	these keys correctly: the backspace key generated a BACKSPACE
</a><a href="#h32-0-127" id="h32-0-127" class="i">+	(^H) and delete key generated a DELETE (^?).
</a><a href="#h32-0-128" id="h32-0-128" class="i">+
</a><a href="#h32-0-129" id="h32-0-129" class="i">+	But a problem arose when Linus Torvalds wrote Linux. Unlike
</a><a href="#h32-0-130" id="h32-0-130" class="i">+	earlier terminals, the Linux virtual terminal (the terminal
</a><a href="#h32-0-131" id="h32-0-131" class="i">+	emulator integrated in the kernel) returned a DELETE when
</a><a href="#h32-0-132" id="h32-0-132" class="i">+	backspace was pressed, due to the VT100 having a DELETE key in
</a><a href="#h32-0-133" id="h32-0-133" class="i">+	the same position.  This created a lot of problems (see [1]
</a><a href="#h32-0-134" id="h32-0-134" class="i">+	and [2]). Since Linux has become the king, a lot of terminal
</a><a href="#h32-0-135" id="h32-0-135" class="i">+	emulators today generate a DELETE when the backspace key is
</a><a href="#h32-0-136" id="h32-0-136" class="i">+	pressed in order to avoid problems with Linux. The result is
</a><a href="#h32-0-137" id="h32-0-137" class="i">+	that the only way of generating a BACKSPACE on these systems
</a><a href="#h32-0-138" id="h32-0-138" class="i">+	is by using CONTROL + H. (I also think that emacs had an
</a><a href="#h32-0-139" id="h32-0-139" class="i">+	important point here because the CONTROL + H prefix is used
</a><a href="#h32-0-140" id="h32-0-140" class="i">+	in emacs in some commands (help commands).)
</a><a href="#h32-0-141" id="h32-0-141" class="i">+
</a><a href="#h32-0-142" id="h32-0-142" class="i">+	From point of view of the kernel, you can change the key
</a><a href="#h32-0-143" id="h32-0-143" class="i">+	for deleting a previous character with stty erase. When you
</a><a href="#h32-0-144" id="h32-0-144" class="i">+	connect a real terminal into a machine you describe the type
</a><a href="#h32-0-145" id="h32-0-145" class="i">+	of terminal, so getty configures the correct value of stty
</a><a href="#h32-0-146" id="h32-0-146" class="i">+	erase for this terminal. In the case of terminal emulators,
</a><a href="#h32-0-147" id="h32-0-147" class="i">+	however, you don&#39;t have any getty that can set the correct
</a><a href="#h32-0-148" id="h32-0-148" class="i">+	value of stty erase, so you always get the default value.
</a><a href="#h32-0-149" id="h32-0-149" class="i">+	For this reason, it is necessary to add &#39;stty erase ^H&#39; to your
</a><a href="#h32-0-150" id="h32-0-150" class="i">+	profile if you have changed the value of the backspace key.
</a><a href="#h32-0-151" id="h32-0-151" class="i">+	Of course, another solution is for st itself to modify the
</a><a href="#h32-0-152" id="h32-0-152" class="i">+	value of stty erase.  I usually have the inverse problem:
</a><a href="#h32-0-153" id="h32-0-153" class="i">+	when I connect to non-Unix machines, I have to press CONTROL +
</a><a href="#h32-0-154" id="h32-0-154" class="i">+	h to get a BACKSPACE. The inverse problem occurs when a user
</a><a href="#h32-0-155" id="h32-0-155" class="i">+	connects to my Unix machines from a different system with a
</a><a href="#h32-0-156" id="h32-0-156" class="i">+	correct backspace key.
</a><a href="#h32-0-157" id="h32-0-157" class="i">+
</a><a href="#h32-0-158" id="h32-0-158" class="i">+	[1] http://www.ibb.net/~anne/keyboard.html
</a><a href="#h32-0-159" id="h32-0-159" class="i">+	[2] http://www.tldp.org/HOWTO/Keyboard-and-Console-HOWTO-5.html
</a><a href="#h32-0-160" id="h32-0-160" class="i">+
</a><a href="#h32-0-161" id="h32-0-161" class="i">+## But I really want the old grumpy behaviour of my terminal
</a><a href="#h32-0-162" id="h32-0-162" class="i">+
</a><a href="#h32-0-163" id="h32-0-163" class="i">+Apply [1].
</a><a href="#h32-0-164" id="h32-0-164" class="i">+
</a><a href="#h32-0-165" id="h32-0-165" class="i">+[1] http://st.suckless.org/patches/delkey
</a><a href="#h32-0-166" id="h32-0-166" class="i">+
</a><b>diff --git a/<a id="h33" href="../file/st/LEGACY.html">st/LEGACY</a> b/<a href="../file/st/LEGACY.html">st/LEGACY</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h33-0-0" id="h33-0-0" class="i">+A STATEMENT ON LEGACY SUPPORT
</a><a href="#h33-0-1" id="h33-0-1" class="i">+
</a><a href="#h33-0-2" id="h33-0-2" class="i">+In the terminal world there is much cruft that comes from old and unsup‐
</a><a href="#h33-0-3" id="h33-0-3" class="i">+ported terminals that inherit incompatible modes  and  escape  sequences
</a><a href="#h33-0-4" id="h33-0-4" class="i">+which noone is able to know, except when he/she comes from that time and
</a><a href="#h33-0-5" id="h33-0-5" class="i">+developed a graphical vt100 emulator at that time.
</a><a href="#h33-0-6" id="h33-0-6" class="i">+
</a><a href="#h33-0-7" id="h33-0-7" class="i">+One  goal  of  st is to only support what is really needed. When you en‐
</a><a href="#h33-0-8" id="h33-0-8" class="i">+counter a sequence which you really need, implement it.  But  while  you
</a><a href="#h33-0-9" id="h33-0-9" class="i">+are  at it,  do not add the other cruft you might encounter while sneek‐
</a><a href="#h33-0-10" id="h33-0-10" class="i">+ing at other terminal emulators. History has bloated them and  there  is
</a><a href="#h33-0-11" id="h33-0-11" class="i">+no real evidence that most of the sequences are used today.
</a><a href="#h33-0-12" id="h33-0-12" class="i">+
</a><a href="#h33-0-13" id="h33-0-13" class="i">+
</a><a href="#h33-0-14" id="h33-0-14" class="i">+Christoph Lohmann &lt;20h@r-36.net&gt;
</a><a href="#h33-0-15" id="h33-0-15" class="i">+2012-09-13T07:00:36.081271045+02:00
</a><a href="#h33-0-16" id="h33-0-16" class="i">+
</a><b>diff --git a/<a id="h34" href="../file/st/LICENSE.html">st/LICENSE</a> b/<a href="../file/st/LICENSE.html">st/LICENSE</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h34-0-0" id="h34-0-0" class="i">+MIT/X Consortium License
</a><a href="#h34-0-1" id="h34-0-1" class="i">+
</a><a href="#h34-0-2" id="h34-0-2" class="i">+© 2014-2018 Hiltjo Posthuma &lt;hiltjo at codemadness dot org&gt;
</a><a href="#h34-0-3" id="h34-0-3" class="i">+© 2018 Devin J. Pohly &lt;djpohly at gmail dot com&gt;
</a><a href="#h34-0-4" id="h34-0-4" class="i">+© 2014-2017 Quentin Rameau &lt;quinq at fifth dot space&gt;
</a><a href="#h34-0-5" id="h34-0-5" class="i">+© 2009-2012 Aurélien APTEL &lt;aurelien dot aptel at gmail dot com&gt;
</a><a href="#h34-0-6" id="h34-0-6" class="i">+© 2008-2017 Anselm R Garbe &lt;garbeam at gmail dot com&gt;
</a><a href="#h34-0-7" id="h34-0-7" class="i">+© 2012-2017 Roberto E. Vargas Caballero &lt;k0ga at shike2 dot com&gt;
</a><a href="#h34-0-8" id="h34-0-8" class="i">+© 2012-2016 Christoph Lohmann &lt;20h at r-36 dot net&gt;
</a><a href="#h34-0-9" id="h34-0-9" class="i">+© 2013 Eon S. Jeon &lt;esjeon at hyunmu dot am&gt;
</a><a href="#h34-0-10" id="h34-0-10" class="i">+© 2013 Alexander Sedov &lt;alex0player at gmail dot com&gt;
</a><a href="#h34-0-11" id="h34-0-11" class="i">+© 2013 Mark Edgar &lt;medgar123 at gmail dot com&gt;
</a><a href="#h34-0-12" id="h34-0-12" class="i">+© 2013-2014 Eric Pruitt &lt;eric.pruitt at gmail dot com&gt;
</a><a href="#h34-0-13" id="h34-0-13" class="i">+© 2013 Michael Forney &lt;mforney at mforney dot org&gt;
</a><a href="#h34-0-14" id="h34-0-14" class="i">+© 2013-2014 Markus Teich &lt;markus dot teich at stusta dot mhn dot de&gt;
</a><a href="#h34-0-15" id="h34-0-15" class="i">+© 2014-2015 Laslo Hunhold &lt;dev at frign dot de&gt;
</a><a href="#h34-0-16" id="h34-0-16" class="i">+
</a><a href="#h34-0-17" id="h34-0-17" class="i">+Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h34-0-18" id="h34-0-18" class="i">+copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h34-0-19" id="h34-0-19" class="i">+to deal in the Software without restriction, including without limitation
</a><a href="#h34-0-20" id="h34-0-20" class="i">+the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h34-0-21" id="h34-0-21" class="i">+and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h34-0-22" id="h34-0-22" class="i">+Software is furnished to do so, subject to the following conditions:
</a><a href="#h34-0-23" id="h34-0-23" class="i">+
</a><a href="#h34-0-24" id="h34-0-24" class="i">+The above copyright notice and this permission notice shall be included in
</a><a href="#h34-0-25" id="h34-0-25" class="i">+all copies or substantial portions of the Software.
</a><a href="#h34-0-26" id="h34-0-26" class="i">+
</a><a href="#h34-0-27" id="h34-0-27" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h34-0-28" id="h34-0-28" class="i">+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h34-0-29" id="h34-0-29" class="i">+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h34-0-30" id="h34-0-30" class="i">+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h34-0-31" id="h34-0-31" class="i">+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h34-0-32" id="h34-0-32" class="i">+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h34-0-33" id="h34-0-33" class="i">+DEALINGS IN THE SOFTWARE.
</a><b>diff --git a/<a id="h35" href="../file/st/Makefile.html">st/Makefile</a> b/<a href="../file/st/Makefile.html">st/Makefile</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -0,0 +1,57 @@
</a><a href="#h35-0-0" id="h35-0-0" class="i">+# st - simple terminal
</a><a href="#h35-0-1" id="h35-0-1" class="i">+# See LICENSE file for copyright and license details.
</a><a href="#h35-0-2" id="h35-0-2" class="i">+.POSIX:
</a><a href="#h35-0-3" id="h35-0-3" class="i">+
</a><a href="#h35-0-4" id="h35-0-4" class="i">+include config.mk
</a><a href="#h35-0-5" id="h35-0-5" class="i">+
</a><a href="#h35-0-6" id="h35-0-6" class="i">+SRC = st.c x.c
</a><a href="#h35-0-7" id="h35-0-7" class="i">+OBJ = $(SRC:.c=.o)
</a><a href="#h35-0-8" id="h35-0-8" class="i">+
</a><a href="#h35-0-9" id="h35-0-9" class="i">+all: options st
</a><a href="#h35-0-10" id="h35-0-10" class="i">+
</a><a href="#h35-0-11" id="h35-0-11" class="i">+options:
</a><a href="#h35-0-12" id="h35-0-12" class="i">+	@echo st build options:
</a><a href="#h35-0-13" id="h35-0-13" class="i">+	@echo &quot;CFLAGS  = $(STCFLAGS)&quot;
</a><a href="#h35-0-14" id="h35-0-14" class="i">+	@echo &quot;LDFLAGS = $(STLDFLAGS)&quot;
</a><a href="#h35-0-15" id="h35-0-15" class="i">+	@echo &quot;CC      = $(CC)&quot;
</a><a href="#h35-0-16" id="h35-0-16" class="i">+
</a><a href="#h35-0-17" id="h35-0-17" class="i">+config.h:
</a><a href="#h35-0-18" id="h35-0-18" class="i">+	cp config.def.h config.h
</a><a href="#h35-0-19" id="h35-0-19" class="i">+
</a><a href="#h35-0-20" id="h35-0-20" class="i">+.c.o:
</a><a href="#h35-0-21" id="h35-0-21" class="i">+	$(CC) $(STCFLAGS) -c $&lt;
</a><a href="#h35-0-22" id="h35-0-22" class="i">+
</a><a href="#h35-0-23" id="h35-0-23" class="i">+st.o: config.h st.h win.h
</a><a href="#h35-0-24" id="h35-0-24" class="i">+x.o: arg.h config.h st.h win.h
</a><a href="#h35-0-25" id="h35-0-25" class="i">+
</a><a href="#h35-0-26" id="h35-0-26" class="i">+$(OBJ): config.h config.mk
</a><a href="#h35-0-27" id="h35-0-27" class="i">+
</a><a href="#h35-0-28" id="h35-0-28" class="i">+st: $(OBJ)
</a><a href="#h35-0-29" id="h35-0-29" class="i">+	$(CC) -o $@ $(OBJ) $(STLDFLAGS)
</a><a href="#h35-0-30" id="h35-0-30" class="i">+
</a><a href="#h35-0-31" id="h35-0-31" class="i">+clean:
</a><a href="#h35-0-32" id="h35-0-32" class="i">+	rm -f st $(OBJ) st-$(VERSION).tar.gz
</a><a href="#h35-0-33" id="h35-0-33" class="i">+
</a><a href="#h35-0-34" id="h35-0-34" class="i">+dist: clean
</a><a href="#h35-0-35" id="h35-0-35" class="i">+	mkdir -p st-$(VERSION)
</a><a href="#h35-0-36" id="h35-0-36" class="i">+	cp -R FAQ LEGACY TODO LICENSE Makefile README config.mk\
</a><a href="#h35-0-37" id="h35-0-37" class="i">+		config.def.h st.info st.1 arg.h st.h win.h $(SRC)\
</a><a href="#h35-0-38" id="h35-0-38" class="i">+		st-$(VERSION)
</a><a href="#h35-0-39" id="h35-0-39" class="i">+	tar -cf - st-$(VERSION) | gzip &gt; st-$(VERSION).tar.gz
</a><a href="#h35-0-40" id="h35-0-40" class="i">+	rm -rf st-$(VERSION)
</a><a href="#h35-0-41" id="h35-0-41" class="i">+
</a><a href="#h35-0-42" id="h35-0-42" class="i">+install: st
</a><a href="#h35-0-43" id="h35-0-43" class="i">+	mkdir -p $(DESTDIR)$(PREFIX)/bin
</a><a href="#h35-0-44" id="h35-0-44" class="i">+	cp -f st $(DESTDIR)$(PREFIX)/bin
</a><a href="#h35-0-45" id="h35-0-45" class="i">+	chmod 755 $(DESTDIR)$(PREFIX)/bin/st
</a><a href="#h35-0-46" id="h35-0-46" class="i">+	mkdir -p $(DESTDIR)$(MANPREFIX)/man1
</a><a href="#h35-0-47" id="h35-0-47" class="i">+	sed &quot;s/VERSION/$(VERSION)/g&quot; &lt; st.1 &gt; $(DESTDIR)$(MANPREFIX)/man1/st.1
</a><a href="#h35-0-48" id="h35-0-48" class="i">+	chmod 644 $(DESTDIR)$(MANPREFIX)/man1/st.1
</a><a href="#h35-0-49" id="h35-0-49" class="i">+	tic -sx st.info
</a><a href="#h35-0-50" id="h35-0-50" class="i">+	@echo Please see the README file regarding the terminfo entry of st.
</a><a href="#h35-0-51" id="h35-0-51" class="i">+
</a><a href="#h35-0-52" id="h35-0-52" class="i">+uninstall:
</a><a href="#h35-0-53" id="h35-0-53" class="i">+	rm -f $(DESTDIR)$(PREFIX)/bin/st
</a><a href="#h35-0-54" id="h35-0-54" class="i">+	rm -f $(DESTDIR)$(MANPREFIX)/man1/st.1
</a><a href="#h35-0-55" id="h35-0-55" class="i">+
</a><a href="#h35-0-56" id="h35-0-56" class="i">+.PHONY: all options clean dist install uninstall
</a><b>diff --git a/<a id="h36" href="../file/st/README.html">st/README</a> b/<a href="../file/st/README.html">st/README</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h36-0-0" id="h36-0-0" class="i">+st - simple terminal
</a><a href="#h36-0-1" id="h36-0-1" class="i">+--------------------
</a><a href="#h36-0-2" id="h36-0-2" class="i">+st is a simple terminal emulator for X which sucks less.
</a><a href="#h36-0-3" id="h36-0-3" class="i">+
</a><a href="#h36-0-4" id="h36-0-4" class="i">+
</a><a href="#h36-0-5" id="h36-0-5" class="i">+Requirements
</a><a href="#h36-0-6" id="h36-0-6" class="i">+------------
</a><a href="#h36-0-7" id="h36-0-7" class="i">+In order to build st you need the Xlib header files.
</a><a href="#h36-0-8" id="h36-0-8" class="i">+
</a><a href="#h36-0-9" id="h36-0-9" class="i">+
</a><a href="#h36-0-10" id="h36-0-10" class="i">+Installation
</a><a href="#h36-0-11" id="h36-0-11" class="i">+------------
</a><a href="#h36-0-12" id="h36-0-12" class="i">+Edit config.mk to match your local setup (st is installed into
</a><a href="#h36-0-13" id="h36-0-13" class="i">+the /usr/local namespace by default).
</a><a href="#h36-0-14" id="h36-0-14" class="i">+
</a><a href="#h36-0-15" id="h36-0-15" class="i">+Afterwards enter the following command to build and install st (if
</a><a href="#h36-0-16" id="h36-0-16" class="i">+necessary as root):
</a><a href="#h36-0-17" id="h36-0-17" class="i">+
</a><a href="#h36-0-18" id="h36-0-18" class="i">+    make clean install
</a><a href="#h36-0-19" id="h36-0-19" class="i">+
</a><a href="#h36-0-20" id="h36-0-20" class="i">+
</a><a href="#h36-0-21" id="h36-0-21" class="i">+Running st
</a><a href="#h36-0-22" id="h36-0-22" class="i">+----------
</a><a href="#h36-0-23" id="h36-0-23" class="i">+If you did not install st with make clean install, you must compile
</a><a href="#h36-0-24" id="h36-0-24" class="i">+the st terminfo entry with the following command:
</a><a href="#h36-0-25" id="h36-0-25" class="i">+
</a><a href="#h36-0-26" id="h36-0-26" class="i">+    tic -sx st.info
</a><a href="#h36-0-27" id="h36-0-27" class="i">+
</a><a href="#h36-0-28" id="h36-0-28" class="i">+See the man page for additional details.
</a><a href="#h36-0-29" id="h36-0-29" class="i">+
</a><a href="#h36-0-30" id="h36-0-30" class="i">+Credits
</a><a href="#h36-0-31" id="h36-0-31" class="i">+-------
</a><a href="#h36-0-32" id="h36-0-32" class="i">+Based on Aurélien APTEL &lt;aurelien dot aptel at gmail dot com&gt; bt source code.
</a><a href="#h36-0-33" id="h36-0-33" class="i">+
</a><b>diff --git a/<a id="h37" href="../file/st/TODO.html">st/TODO</a> b/<a href="../file/st/TODO.html">st/TODO</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -0,0 +1,28 @@
</a><a href="#h37-0-0" id="h37-0-0" class="i">+vt emulation
</a><a href="#h37-0-1" id="h37-0-1" class="i">+------------
</a><a href="#h37-0-2" id="h37-0-2" class="i">+
</a><a href="#h37-0-3" id="h37-0-3" class="i">+* double-height support
</a><a href="#h37-0-4" id="h37-0-4" class="i">+
</a><a href="#h37-0-5" id="h37-0-5" class="i">+code &amp; interface
</a><a href="#h37-0-6" id="h37-0-6" class="i">+----------------
</a><a href="#h37-0-7" id="h37-0-7" class="i">+
</a><a href="#h37-0-8" id="h37-0-8" class="i">+* add a simple way to do multiplexing
</a><a href="#h37-0-9" id="h37-0-9" class="i">+
</a><a href="#h37-0-10" id="h37-0-10" class="i">+drawing
</a><a href="#h37-0-11" id="h37-0-11" class="i">+-------
</a><a href="#h37-0-12" id="h37-0-12" class="i">+* add diacritics support to xdraws()
</a><a href="#h37-0-13" id="h37-0-13" class="i">+	* switch to a suckless font drawing library
</a><a href="#h37-0-14" id="h37-0-14" class="i">+* make the font cache simpler
</a><a href="#h37-0-15" id="h37-0-15" class="i">+* add better support for brightening of the upper colors
</a><a href="#h37-0-16" id="h37-0-16" class="i">+
</a><a href="#h37-0-17" id="h37-0-17" class="i">+bugs
</a><a href="#h37-0-18" id="h37-0-18" class="i">+----
</a><a href="#h37-0-19" id="h37-0-19" class="i">+
</a><a href="#h37-0-20" id="h37-0-20" class="i">+* fix shift up/down (shift selection in emacs)
</a><a href="#h37-0-21" id="h37-0-21" class="i">+* remove DEC test sequence when appropriate
</a><a href="#h37-0-22" id="h37-0-22" class="i">+
</a><a href="#h37-0-23" id="h37-0-23" class="i">+misc
</a><a href="#h37-0-24" id="h37-0-24" class="i">+----
</a><a href="#h37-0-25" id="h37-0-25" class="i">+
</a><a href="#h37-0-26" id="h37-0-26" class="i">+    $ grep -nE &#39;XXX|TODO&#39; st.c
</a><a href="#h37-0-27" id="h37-0-27" class="i">+
</a><b>diff --git a/<a id="h38" href="../file/st/arg.h.html">st/arg.h</a> b/<a href="../file/st/arg.h.html">st/arg.h</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -0,0 +1,50 @@
</a><a href="#h38-0-0" id="h38-0-0" class="i">+/*
</a><a href="#h38-0-1" id="h38-0-1" class="i">+ * Copy me if you can.
</a><a href="#h38-0-2" id="h38-0-2" class="i">+ * by 20h
</a><a href="#h38-0-3" id="h38-0-3" class="i">+ */
</a><a href="#h38-0-4" id="h38-0-4" class="i">+
</a><a href="#h38-0-5" id="h38-0-5" class="i">+#ifndef ARG_H__
</a><a href="#h38-0-6" id="h38-0-6" class="i">+#define ARG_H__
</a><a href="#h38-0-7" id="h38-0-7" class="i">+
</a><a href="#h38-0-8" id="h38-0-8" class="i">+extern char *argv0;
</a><a href="#h38-0-9" id="h38-0-9" class="i">+
</a><a href="#h38-0-10" id="h38-0-10" class="i">+/* use main(int argc, char *argv[]) */
</a><a href="#h38-0-11" id="h38-0-11" class="i">+#define ARGBEGIN	for (argv0 = *argv, argv++, argc--;\
</a><a href="#h38-0-12" id="h38-0-12" class="i">+					argv[0] &amp;&amp; argv[0][0] == &#39;-&#39;\
</a><a href="#h38-0-13" id="h38-0-13" class="i">+					&amp;&amp; argv[0][1];\
</a><a href="#h38-0-14" id="h38-0-14" class="i">+					argc--, argv++) {\
</a><a href="#h38-0-15" id="h38-0-15" class="i">+				char argc_;\
</a><a href="#h38-0-16" id="h38-0-16" class="i">+				char **argv_;\
</a><a href="#h38-0-17" id="h38-0-17" class="i">+				int brk_;\
</a><a href="#h38-0-18" id="h38-0-18" class="i">+				if (argv[0][1] == &#39;-&#39; &amp;&amp; argv[0][2] == &#39;\0&#39;) {\
</a><a href="#h38-0-19" id="h38-0-19" class="i">+					argv++;\
</a><a href="#h38-0-20" id="h38-0-20" class="i">+					argc--;\
</a><a href="#h38-0-21" id="h38-0-21" class="i">+					break;\
</a><a href="#h38-0-22" id="h38-0-22" class="i">+				}\
</a><a href="#h38-0-23" id="h38-0-23" class="i">+				int i_;\
</a><a href="#h38-0-24" id="h38-0-24" class="i">+				for (i_ = 1, brk_ = 0, argv_ = argv;\
</a><a href="#h38-0-25" id="h38-0-25" class="i">+						argv[0][i_] &amp;&amp; !brk_;\
</a><a href="#h38-0-26" id="h38-0-26" class="i">+						i_++) {\
</a><a href="#h38-0-27" id="h38-0-27" class="i">+					if (argv_ != argv)\
</a><a href="#h38-0-28" id="h38-0-28" class="i">+						break;\
</a><a href="#h38-0-29" id="h38-0-29" class="i">+					argc_ = argv[0][i_];\
</a><a href="#h38-0-30" id="h38-0-30" class="i">+					switch (argc_)
</a><a href="#h38-0-31" id="h38-0-31" class="i">+
</a><a href="#h38-0-32" id="h38-0-32" class="i">+#define ARGEND			}\
</a><a href="#h38-0-33" id="h38-0-33" class="i">+			}
</a><a href="#h38-0-34" id="h38-0-34" class="i">+
</a><a href="#h38-0-35" id="h38-0-35" class="i">+#define ARGC()		argc_
</a><a href="#h38-0-36" id="h38-0-36" class="i">+
</a><a href="#h38-0-37" id="h38-0-37" class="i">+#define EARGF(x)	((argv[0][i_+1] == &#39;\0&#39; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h38-0-38" id="h38-0-38" class="i">+				((x), abort(), (char *)0) :\
</a><a href="#h38-0-39" id="h38-0-39" class="i">+				(brk_ = 1, (argv[0][i_+1] != &#39;\0&#39;)?\
</a><a href="#h38-0-40" id="h38-0-40" class="i">+					(&amp;argv[0][i_+1]) :\
</a><a href="#h38-0-41" id="h38-0-41" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h38-0-42" id="h38-0-42" class="i">+
</a><a href="#h38-0-43" id="h38-0-43" class="i">+#define ARGF()		((argv[0][i_+1] == &#39;\0&#39; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h38-0-44" id="h38-0-44" class="i">+				(char *)0 :\
</a><a href="#h38-0-45" id="h38-0-45" class="i">+				(brk_ = 1, (argv[0][i_+1] != &#39;\0&#39;)?\
</a><a href="#h38-0-46" id="h38-0-46" class="i">+					(&amp;argv[0][i_+1]) :\
</a><a href="#h38-0-47" id="h38-0-47" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h38-0-48" id="h38-0-48" class="i">+
</a><a href="#h38-0-49" id="h38-0-49" class="i">+#endif
</a><b>diff --git a/<a id="h39" href="../file/st/config.def.h.html">st/config.def.h</a> b/<a href="../file/st/config.def.h.html">st/config.def.h</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -0,0 +1,466 @@
</a><a href="#h39-0-0" id="h39-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h39-0-1" id="h39-0-1" class="i">+
</a><a href="#h39-0-2" id="h39-0-2" class="i">+/*
</a><a href="#h39-0-3" id="h39-0-3" class="i">+ * appearance
</a><a href="#h39-0-4" id="h39-0-4" class="i">+ *
</a><a href="#h39-0-5" id="h39-0-5" class="i">+ * font: see http://freedesktop.org/software/fontconfig/fontconfig-user.html
</a><a href="#h39-0-6" id="h39-0-6" class="i">+ */
</a><a href="#h39-0-7" id="h39-0-7" class="i">+static char *font = &quot;Liberation Mono:pixelsize=12:antialias=true:autohint=true&quot;;
</a><a href="#h39-0-8" id="h39-0-8" class="i">+static int borderpx = 2;
</a><a href="#h39-0-9" id="h39-0-9" class="i">+
</a><a href="#h39-0-10" id="h39-0-10" class="i">+/*
</a><a href="#h39-0-11" id="h39-0-11" class="i">+ * What program is execed by st depends of these precedence rules:
</a><a href="#h39-0-12" id="h39-0-12" class="i">+ * 1: program passed with -e
</a><a href="#h39-0-13" id="h39-0-13" class="i">+ * 2: utmp option
</a><a href="#h39-0-14" id="h39-0-14" class="i">+ * 3: SHELL environment variable
</a><a href="#h39-0-15" id="h39-0-15" class="i">+ * 4: value of shell in /etc/passwd
</a><a href="#h39-0-16" id="h39-0-16" class="i">+ * 5: value of shell in config.h
</a><a href="#h39-0-17" id="h39-0-17" class="i">+ */
</a><a href="#h39-0-18" id="h39-0-18" class="i">+static char *shell = &quot;/bin/sh&quot;;
</a><a href="#h39-0-19" id="h39-0-19" class="i">+char *utmp = NULL;
</a><a href="#h39-0-20" id="h39-0-20" class="i">+char *stty_args = &quot;stty raw pass8 nl -echo -iexten -cstopb 38400&quot;;
</a><a href="#h39-0-21" id="h39-0-21" class="i">+
</a><a href="#h39-0-22" id="h39-0-22" class="i">+/* identification sequence returned in DA and DECID */
</a><a href="#h39-0-23" id="h39-0-23" class="i">+char *vtiden = &quot;\033[?6c&quot;;
</a><a href="#h39-0-24" id="h39-0-24" class="i">+
</a><a href="#h39-0-25" id="h39-0-25" class="i">+/* Kerning / character bounding-box multipliers */
</a><a href="#h39-0-26" id="h39-0-26" class="i">+static float cwscale = 1.0;
</a><a href="#h39-0-27" id="h39-0-27" class="i">+static float chscale = 1.0;
</a><a href="#h39-0-28" id="h39-0-28" class="i">+
</a><a href="#h39-0-29" id="h39-0-29" class="i">+/*
</a><a href="#h39-0-30" id="h39-0-30" class="i">+ * word delimiter string
</a><a href="#h39-0-31" id="h39-0-31" class="i">+ *
</a><a href="#h39-0-32" id="h39-0-32" class="i">+ * More advanced example: &quot; `&#39;\&quot;()[]{}&quot;
</a><a href="#h39-0-33" id="h39-0-33" class="i">+ */
</a><a href="#h39-0-34" id="h39-0-34" class="i">+char *worddelimiters = &quot; &quot;;
</a><a href="#h39-0-35" id="h39-0-35" class="i">+
</a><a href="#h39-0-36" id="h39-0-36" class="i">+/* selection timeouts (in milliseconds) */
</a><a href="#h39-0-37" id="h39-0-37" class="i">+static unsigned int doubleclicktimeout = 300;
</a><a href="#h39-0-38" id="h39-0-38" class="i">+static unsigned int tripleclicktimeout = 600;
</a><a href="#h39-0-39" id="h39-0-39" class="i">+
</a><a href="#h39-0-40" id="h39-0-40" class="i">+/* alt screens */
</a><a href="#h39-0-41" id="h39-0-41" class="i">+int allowaltscreen = 1;
</a><a href="#h39-0-42" id="h39-0-42" class="i">+
</a><a href="#h39-0-43" id="h39-0-43" class="i">+/* frames per second st should at maximum draw to the screen */
</a><a href="#h39-0-44" id="h39-0-44" class="i">+static unsigned int xfps = 120;
</a><a href="#h39-0-45" id="h39-0-45" class="i">+static unsigned int actionfps = 30;
</a><a href="#h39-0-46" id="h39-0-46" class="i">+
</a><a href="#h39-0-47" id="h39-0-47" class="i">+/*
</a><a href="#h39-0-48" id="h39-0-48" class="i">+ * blinking timeout (set to 0 to disable blinking) for the terminal blinking
</a><a href="#h39-0-49" id="h39-0-49" class="i">+ * attribute.
</a><a href="#h39-0-50" id="h39-0-50" class="i">+ */
</a><a href="#h39-0-51" id="h39-0-51" class="i">+static unsigned int blinktimeout = 800;
</a><a href="#h39-0-52" id="h39-0-52" class="i">+
</a><a href="#h39-0-53" id="h39-0-53" class="i">+/*
</a><a href="#h39-0-54" id="h39-0-54" class="i">+ * thickness of underline and bar cursors
</a><a href="#h39-0-55" id="h39-0-55" class="i">+ */
</a><a href="#h39-0-56" id="h39-0-56" class="i">+static unsigned int cursorthickness = 2;
</a><a href="#h39-0-57" id="h39-0-57" class="i">+
</a><a href="#h39-0-58" id="h39-0-58" class="i">+/*
</a><a href="#h39-0-59" id="h39-0-59" class="i">+ * bell volume. It must be a value between -100 and 100. Use 0 for disabling
</a><a href="#h39-0-60" id="h39-0-60" class="i">+ * it
</a><a href="#h39-0-61" id="h39-0-61" class="i">+ */
</a><a href="#h39-0-62" id="h39-0-62" class="i">+static int bellvolume = 0;
</a><a href="#h39-0-63" id="h39-0-63" class="i">+
</a><a href="#h39-0-64" id="h39-0-64" class="i">+/* default TERM value */
</a><a href="#h39-0-65" id="h39-0-65" class="i">+char *termname = &quot;st-256color&quot;;
</a><a href="#h39-0-66" id="h39-0-66" class="i">+
</a><a href="#h39-0-67" id="h39-0-67" class="i">+/*
</a><a href="#h39-0-68" id="h39-0-68" class="i">+ * spaces per tab
</a><a href="#h39-0-69" id="h39-0-69" class="i">+ *
</a><a href="#h39-0-70" id="h39-0-70" class="i">+ * When you are changing this value, don&#39;t forget to adapt the »it« value in
</a><a href="#h39-0-71" id="h39-0-71" class="i">+ * the st.info and appropriately install the st.info in the environment where
</a><a href="#h39-0-72" id="h39-0-72" class="i">+ * you use this st version.
</a><a href="#h39-0-73" id="h39-0-73" class="i">+ *
</a><a href="#h39-0-74" id="h39-0-74" class="i">+ *	it#$tabspaces,
</a><a href="#h39-0-75" id="h39-0-75" class="i">+ *
</a><a href="#h39-0-76" id="h39-0-76" class="i">+ * Secondly make sure your kernel is not expanding tabs. When running `stty
</a><a href="#h39-0-77" id="h39-0-77" class="i">+ * -a` »tab0« should appear. You can tell the terminal to not expand tabs by
</a><a href="#h39-0-78" id="h39-0-78" class="i">+ *  running following command:
</a><a href="#h39-0-79" id="h39-0-79" class="i">+ *
</a><a href="#h39-0-80" id="h39-0-80" class="i">+ *	stty tabs
</a><a href="#h39-0-81" id="h39-0-81" class="i">+ */
</a><a href="#h39-0-82" id="h39-0-82" class="i">+unsigned int tabspaces = 8;
</a><a href="#h39-0-83" id="h39-0-83" class="i">+
</a><a href="#h39-0-84" id="h39-0-84" class="i">+/* bg opacity */
</a><a href="#h39-0-85" id="h39-0-85" class="i">+unsigned int alpha = 0xcc;
</a><a href="#h39-0-86" id="h39-0-86" class="i">+
</a><a href="#h39-0-87" id="h39-0-87" class="i">+/* Terminal colors (16 first used in escape sequence) */
</a><a href="#h39-0-88" id="h39-0-88" class="i">+static const char *colorname[] = {
</a><a href="#h39-0-89" id="h39-0-89" class="i">+	/* 8 normal colors */
</a><a href="#h39-0-90" id="h39-0-90" class="i">+	&quot;black&quot;,
</a><a href="#h39-0-91" id="h39-0-91" class="i">+	&quot;red3&quot;,
</a><a href="#h39-0-92" id="h39-0-92" class="i">+	&quot;green3&quot;,
</a><a href="#h39-0-93" id="h39-0-93" class="i">+	&quot;yellow3&quot;,
</a><a href="#h39-0-94" id="h39-0-94" class="i">+	&quot;blue2&quot;,
</a><a href="#h39-0-95" id="h39-0-95" class="i">+	&quot;magenta3&quot;,
</a><a href="#h39-0-96" id="h39-0-96" class="i">+	&quot;cyan3&quot;,
</a><a href="#h39-0-97" id="h39-0-97" class="i">+	&quot;gray90&quot;,
</a><a href="#h39-0-98" id="h39-0-98" class="i">+
</a><a href="#h39-0-99" id="h39-0-99" class="i">+	/* 8 bright colors */
</a><a href="#h39-0-100" id="h39-0-100" class="i">+	&quot;gray50&quot;,
</a><a href="#h39-0-101" id="h39-0-101" class="i">+	&quot;red&quot;,
</a><a href="#h39-0-102" id="h39-0-102" class="i">+	&quot;green&quot;,
</a><a href="#h39-0-103" id="h39-0-103" class="i">+	&quot;yellow&quot;,
</a><a href="#h39-0-104" id="h39-0-104" class="i">+	&quot;#5c5cff&quot;,
</a><a href="#h39-0-105" id="h39-0-105" class="i">+	&quot;magenta&quot;,
</a><a href="#h39-0-106" id="h39-0-106" class="i">+	&quot;cyan&quot;,
</a><a href="#h39-0-107" id="h39-0-107" class="i">+	&quot;white&quot;,
</a><a href="#h39-0-108" id="h39-0-108" class="i">+
</a><a href="#h39-0-109" id="h39-0-109" class="i">+	[255] = 0,
</a><a href="#h39-0-110" id="h39-0-110" class="i">+
</a><a href="#h39-0-111" id="h39-0-111" class="i">+	/* more colors can be added after 255 to use with DefaultXX */
</a><a href="#h39-0-112" id="h39-0-112" class="i">+	&quot;#cccccc&quot;,
</a><a href="#h39-0-113" id="h39-0-113" class="i">+	&quot;#555555&quot;,
</a><a href="#h39-0-114" id="h39-0-114" class="i">+	&quot;black&quot;,
</a><a href="#h39-0-115" id="h39-0-115" class="i">+};
</a><a href="#h39-0-116" id="h39-0-116" class="i">+
</a><a href="#h39-0-117" id="h39-0-117" class="i">+
</a><a href="#h39-0-118" id="h39-0-118" class="i">+/*
</a><a href="#h39-0-119" id="h39-0-119" class="i">+ * Default colors (colorname index)
</a><a href="#h39-0-120" id="h39-0-120" class="i">+ * foreground, background, cursor, reverse cursor
</a><a href="#h39-0-121" id="h39-0-121" class="i">+ */
</a><a href="#h39-0-122" id="h39-0-122" class="i">+unsigned int defaultfg = 7;
</a><a href="#h39-0-123" id="h39-0-123" class="i">+unsigned int defaultbg = 257;
</a><a href="#h39-0-124" id="h39-0-124" class="i">+static unsigned int defaultcs = 256;
</a><a href="#h39-0-125" id="h39-0-125" class="i">+static unsigned int defaultrcs = 257;
</a><a href="#h39-0-126" id="h39-0-126" class="i">+
</a><a href="#h39-0-127" id="h39-0-127" class="i">+/*
</a><a href="#h39-0-128" id="h39-0-128" class="i">+ * Default shape of cursor
</a><a href="#h39-0-129" id="h39-0-129" class="i">+ * 2: Block (&quot;█&quot;)
</a><a href="#h39-0-130" id="h39-0-130" class="i">+ * 4: Underline (&quot;_&quot;)
</a><a href="#h39-0-131" id="h39-0-131" class="i">+ * 6: Bar (&quot;|&quot;)
</a><a href="#h39-0-132" id="h39-0-132" class="i">+ * 7: Snowman (&quot;☃&quot;)
</a><a href="#h39-0-133" id="h39-0-133" class="i">+ */
</a><a href="#h39-0-134" id="h39-0-134" class="i">+static unsigned int cursorshape = 2;
</a><a href="#h39-0-135" id="h39-0-135" class="i">+
</a><a href="#h39-0-136" id="h39-0-136" class="i">+/*
</a><a href="#h39-0-137" id="h39-0-137" class="i">+ * Default columns and rows numbers
</a><a href="#h39-0-138" id="h39-0-138" class="i">+ */
</a><a href="#h39-0-139" id="h39-0-139" class="i">+
</a><a href="#h39-0-140" id="h39-0-140" class="i">+static unsigned int cols = 80;
</a><a href="#h39-0-141" id="h39-0-141" class="i">+static unsigned int rows = 24;
</a><a href="#h39-0-142" id="h39-0-142" class="i">+
</a><a href="#h39-0-143" id="h39-0-143" class="i">+/*
</a><a href="#h39-0-144" id="h39-0-144" class="i">+ * Default colour and shape of the mouse cursor
</a><a href="#h39-0-145" id="h39-0-145" class="i">+ */
</a><a href="#h39-0-146" id="h39-0-146" class="i">+static unsigned int mouseshape = XC_xterm;
</a><a href="#h39-0-147" id="h39-0-147" class="i">+static unsigned int mousefg = 7;
</a><a href="#h39-0-148" id="h39-0-148" class="i">+static unsigned int mousebg = 0;
</a><a href="#h39-0-149" id="h39-0-149" class="i">+
</a><a href="#h39-0-150" id="h39-0-150" class="i">+/*
</a><a href="#h39-0-151" id="h39-0-151" class="i">+ * Color used to display font attributes when fontconfig selected a font which
</a><a href="#h39-0-152" id="h39-0-152" class="i">+ * doesn&#39;t match the ones requested.
</a><a href="#h39-0-153" id="h39-0-153" class="i">+ */
</a><a href="#h39-0-154" id="h39-0-154" class="i">+static unsigned int defaultattr = 11;
</a><a href="#h39-0-155" id="h39-0-155" class="i">+
</a><a href="#h39-0-156" id="h39-0-156" class="i">+/*
</a><a href="#h39-0-157" id="h39-0-157" class="i">+ * Internal mouse shortcuts.
</a><a href="#h39-0-158" id="h39-0-158" class="i">+ * Beware that overloading Button1 will disable the selection.
</a><a href="#h39-0-159" id="h39-0-159" class="i">+ */
</a><a href="#h39-0-160" id="h39-0-160" class="i">+static MouseShortcut mshortcuts[] = {
</a><a href="#h39-0-161" id="h39-0-161" class="i">+	/* button               mask            string */
</a><a href="#h39-0-162" id="h39-0-162" class="i">+	{ Button4,              XK_ANY_MOD,     &quot;\031&quot; },
</a><a href="#h39-0-163" id="h39-0-163" class="i">+	{ Button5,              XK_ANY_MOD,     &quot;\005&quot; },
</a><a href="#h39-0-164" id="h39-0-164" class="i">+};
</a><a href="#h39-0-165" id="h39-0-165" class="i">+
</a><a href="#h39-0-166" id="h39-0-166" class="i">+/* Internal keyboard shortcuts. */
</a><a href="#h39-0-167" id="h39-0-167" class="i">+#define MODKEY Mod1Mask
</a><a href="#h39-0-168" id="h39-0-168" class="i">+#define TERMMOD (ControlMask|ShiftMask)
</a><a href="#h39-0-169" id="h39-0-169" class="i">+
</a><a href="#h39-0-170" id="h39-0-170" class="i">+static Shortcut shortcuts[] = {
</a><a href="#h39-0-171" id="h39-0-171" class="i">+	/* mask                 keysym          function        argument */
</a><a href="#h39-0-172" id="h39-0-172" class="i">+	{ XK_ANY_MOD,           XK_Break,       sendbreak,      {.i =  0} },
</a><a href="#h39-0-173" id="h39-0-173" class="i">+	{ ControlMask,          XK_Print,       toggleprinter,  {.i =  0} },
</a><a href="#h39-0-174" id="h39-0-174" class="i">+	{ ShiftMask,            XK_Print,       printscreen,    {.i =  0} },
</a><a href="#h39-0-175" id="h39-0-175" class="i">+	{ XK_ANY_MOD,           XK_Print,       printsel,       {.i =  0} },
</a><a href="#h39-0-176" id="h39-0-176" class="i">+	{ TERMMOD,              XK_Prior,       zoom,           {.f = +1} },
</a><a href="#h39-0-177" id="h39-0-177" class="i">+	{ TERMMOD,              XK_Next,        zoom,           {.f = -1} },
</a><a href="#h39-0-178" id="h39-0-178" class="i">+	{ TERMMOD,              XK_Home,        zoomreset,      {.f =  0} },
</a><a href="#h39-0-179" id="h39-0-179" class="i">+	{ TERMMOD,              XK_C,           clipcopy,       {.i =  0} },
</a><a href="#h39-0-180" id="h39-0-180" class="i">+	{ TERMMOD,              XK_V,           clippaste,      {.i =  0} },
</a><a href="#h39-0-181" id="h39-0-181" class="i">+	{ TERMMOD,              XK_Y,           selpaste,       {.i =  0} },
</a><a href="#h39-0-182" id="h39-0-182" class="i">+	{ ShiftMask,            XK_Insert,      selpaste,       {.i =  0} },
</a><a href="#h39-0-183" id="h39-0-183" class="i">+	{ TERMMOD,              XK_Num_Lock,    numlock,        {.i =  0} },
</a><a href="#h39-0-184" id="h39-0-184" class="i">+};
</a><a href="#h39-0-185" id="h39-0-185" class="i">+
</a><a href="#h39-0-186" id="h39-0-186" class="i">+/*
</a><a href="#h39-0-187" id="h39-0-187" class="i">+ * Special keys (change &amp; recompile st.info accordingly)
</a><a href="#h39-0-188" id="h39-0-188" class="i">+ *
</a><a href="#h39-0-189" id="h39-0-189" class="i">+ * Mask value:
</a><a href="#h39-0-190" id="h39-0-190" class="i">+ * * Use XK_ANY_MOD to match the key no matter modifiers state
</a><a href="#h39-0-191" id="h39-0-191" class="i">+ * * Use XK_NO_MOD to match the key alone (no modifiers)
</a><a href="#h39-0-192" id="h39-0-192" class="i">+ * appkey value:
</a><a href="#h39-0-193" id="h39-0-193" class="i">+ * * 0: no value
</a><a href="#h39-0-194" id="h39-0-194" class="i">+ * * &gt; 0: keypad application mode enabled
</a><a href="#h39-0-195" id="h39-0-195" class="i">+ * *   = 2: term.numlock = 1
</a><a href="#h39-0-196" id="h39-0-196" class="i">+ * * &lt; 0: keypad application mode disabled
</a><a href="#h39-0-197" id="h39-0-197" class="i">+ * appcursor value:
</a><a href="#h39-0-198" id="h39-0-198" class="i">+ * * 0: no value
</a><a href="#h39-0-199" id="h39-0-199" class="i">+ * * &gt; 0: cursor application mode enabled
</a><a href="#h39-0-200" id="h39-0-200" class="i">+ * * &lt; 0: cursor application mode disabled
</a><a href="#h39-0-201" id="h39-0-201" class="i">+ * crlf value
</a><a href="#h39-0-202" id="h39-0-202" class="i">+ * * 0: no value
</a><a href="#h39-0-203" id="h39-0-203" class="i">+ * * &gt; 0: crlf mode is enabled
</a><a href="#h39-0-204" id="h39-0-204" class="i">+ * * &lt; 0: crlf mode is disabled
</a><a href="#h39-0-205" id="h39-0-205" class="i">+ *
</a><a href="#h39-0-206" id="h39-0-206" class="i">+ * Be careful with the order of the definitions because st searches in
</a><a href="#h39-0-207" id="h39-0-207" class="i">+ * this table sequentially, so any XK_ANY_MOD must be in the last
</a><a href="#h39-0-208" id="h39-0-208" class="i">+ * position for a key.
</a><a href="#h39-0-209" id="h39-0-209" class="i">+ */
</a><a href="#h39-0-210" id="h39-0-210" class="i">+
</a><a href="#h39-0-211" id="h39-0-211" class="i">+/*
</a><a href="#h39-0-212" id="h39-0-212" class="i">+ * If you want keys other than the X11 function keys (0xFD00 - 0xFFFF)
</a><a href="#h39-0-213" id="h39-0-213" class="i">+ * to be mapped below, add them to this array.
</a><a href="#h39-0-214" id="h39-0-214" class="i">+ */
</a><a href="#h39-0-215" id="h39-0-215" class="i">+static KeySym mappedkeys[] = { -1 };
</a><a href="#h39-0-216" id="h39-0-216" class="i">+
</a><a href="#h39-0-217" id="h39-0-217" class="i">+/*
</a><a href="#h39-0-218" id="h39-0-218" class="i">+ * State bits to ignore when matching key or button events.  By default,
</a><a href="#h39-0-219" id="h39-0-219" class="i">+ * numlock (Mod2Mask) and keyboard layout (XK_SWITCH_MOD) are ignored.
</a><a href="#h39-0-220" id="h39-0-220" class="i">+ */
</a><a href="#h39-0-221" id="h39-0-221" class="i">+static uint ignoremod = Mod2Mask|XK_SWITCH_MOD;
</a><a href="#h39-0-222" id="h39-0-222" class="i">+
</a><a href="#h39-0-223" id="h39-0-223" class="i">+/*
</a><a href="#h39-0-224" id="h39-0-224" class="i">+ * Override mouse-select while mask is active (when MODE_MOUSE is set).
</a><a href="#h39-0-225" id="h39-0-225" class="i">+ * Note that if you want to use ShiftMask with selmasks, set this to an other
</a><a href="#h39-0-226" id="h39-0-226" class="i">+ * modifier, set to 0 to not use it.
</a><a href="#h39-0-227" id="h39-0-227" class="i">+ */
</a><a href="#h39-0-228" id="h39-0-228" class="i">+static uint forceselmod = ShiftMask;
</a><a href="#h39-0-229" id="h39-0-229" class="i">+
</a><a href="#h39-0-230" id="h39-0-230" class="i">+/*
</a><a href="#h39-0-231" id="h39-0-231" class="i">+ * This is the huge key array which defines all compatibility to the Linux
</a><a href="#h39-0-232" id="h39-0-232" class="i">+ * world. Please decide about changes wisely.
</a><a href="#h39-0-233" id="h39-0-233" class="i">+ */
</a><a href="#h39-0-234" id="h39-0-234" class="i">+static Key key[] = {
</a><a href="#h39-0-235" id="h39-0-235" class="i">+	/* keysym           mask            string      appkey appcursor */
</a><a href="#h39-0-236" id="h39-0-236" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[2J&quot;,       0,   -1},
</a><a href="#h39-0-237" id="h39-0-237" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1},
</a><a href="#h39-0-238" id="h39-0-238" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1},
</a><a href="#h39-0-239" id="h39-0-239" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1},
</a><a href="#h39-0-240" id="h39-0-240" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033Ox&quot;,       +1,    0},
</a><a href="#h39-0-241" id="h39-0-241" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1},
</a><a href="#h39-0-242" id="h39-0-242" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1},
</a><a href="#h39-0-243" id="h39-0-243" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033Or&quot;,       +1,    0},
</a><a href="#h39-0-244" id="h39-0-244" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1},
</a><a href="#h39-0-245" id="h39-0-245" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1},
</a><a href="#h39-0-246" id="h39-0-246" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033Ot&quot;,       +1,    0},
</a><a href="#h39-0-247" id="h39-0-247" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1},
</a><a href="#h39-0-248" id="h39-0-248" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1},
</a><a href="#h39-0-249" id="h39-0-249" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033Ov&quot;,       +1,    0},
</a><a href="#h39-0-250" id="h39-0-250" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1},
</a><a href="#h39-0-251" id="h39-0-251" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1},
</a><a href="#h39-0-252" id="h39-0-252" class="i">+	{ XK_KP_Prior,      ShiftMask,      &quot;\033[5;2~&quot;,     0,    0},
</a><a href="#h39-0-253" id="h39-0-253" class="i">+	{ XK_KP_Prior,      XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0},
</a><a href="#h39-0-254" id="h39-0-254" class="i">+	{ XK_KP_Begin,      XK_ANY_MOD,     &quot;\033[E&quot;,        0,    0},
</a><a href="#h39-0-255" id="h39-0-255" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[J&quot;,       -1,    0},
</a><a href="#h39-0-256" id="h39-0-256" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[1;5F&quot;,    +1,    0},
</a><a href="#h39-0-257" id="h39-0-257" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[K&quot;,       -1,    0},
</a><a href="#h39-0-258" id="h39-0-258" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0},
</a><a href="#h39-0-259" id="h39-0-259" class="i">+	{ XK_KP_End,        XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0},
</a><a href="#h39-0-260" id="h39-0-260" class="i">+	{ XK_KP_Next,       ShiftMask,      &quot;\033[6;2~&quot;,     0,    0},
</a><a href="#h39-0-261" id="h39-0-261" class="i">+	{ XK_KP_Next,       XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0},
</a><a href="#h39-0-262" id="h39-0-262" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0},
</a><a href="#h39-0-263" id="h39-0-263" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[4l&quot;,      -1,    0},
</a><a href="#h39-0-264" id="h39-0-264" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[L&quot;,       -1,    0},
</a><a href="#h39-0-265" id="h39-0-265" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[2;5~&quot;,    +1,    0},
</a><a href="#h39-0-266" id="h39-0-266" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0},
</a><a href="#h39-0-267" id="h39-0-267" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0},
</a><a href="#h39-0-268" id="h39-0-268" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[M&quot;,       -1,    0},
</a><a href="#h39-0-269" id="h39-0-269" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[3;5~&quot;,    +1,    0},
</a><a href="#h39-0-270" id="h39-0-270" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[2K&quot;,      -1,    0},
</a><a href="#h39-0-271" id="h39-0-271" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0},
</a><a href="#h39-0-272" id="h39-0-272" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0},
</a><a href="#h39-0-273" id="h39-0-273" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0},
</a><a href="#h39-0-274" id="h39-0-274" class="i">+	{ XK_KP_Multiply,   XK_ANY_MOD,     &quot;\033Oj&quot;,       +2,    0},
</a><a href="#h39-0-275" id="h39-0-275" class="i">+	{ XK_KP_Add,        XK_ANY_MOD,     &quot;\033Ok&quot;,       +2,    0},
</a><a href="#h39-0-276" id="h39-0-276" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\033OM&quot;,       +2,    0},
</a><a href="#h39-0-277" id="h39-0-277" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\r&quot;,           -1,    0},
</a><a href="#h39-0-278" id="h39-0-278" class="i">+	{ XK_KP_Subtract,   XK_ANY_MOD,     &quot;\033Om&quot;,       +2,    0},
</a><a href="#h39-0-279" id="h39-0-279" class="i">+	{ XK_KP_Decimal,    XK_ANY_MOD,     &quot;\033On&quot;,       +2,    0},
</a><a href="#h39-0-280" id="h39-0-280" class="i">+	{ XK_KP_Divide,     XK_ANY_MOD,     &quot;\033Oo&quot;,       +2,    0},
</a><a href="#h39-0-281" id="h39-0-281" class="i">+	{ XK_KP_0,          XK_ANY_MOD,     &quot;\033Op&quot;,       +2,    0},
</a><a href="#h39-0-282" id="h39-0-282" class="i">+	{ XK_KP_1,          XK_ANY_MOD,     &quot;\033Oq&quot;,       +2,    0},
</a><a href="#h39-0-283" id="h39-0-283" class="i">+	{ XK_KP_2,          XK_ANY_MOD,     &quot;\033Or&quot;,       +2,    0},
</a><a href="#h39-0-284" id="h39-0-284" class="i">+	{ XK_KP_3,          XK_ANY_MOD,     &quot;\033Os&quot;,       +2,    0},
</a><a href="#h39-0-285" id="h39-0-285" class="i">+	{ XK_KP_4,          XK_ANY_MOD,     &quot;\033Ot&quot;,       +2,    0},
</a><a href="#h39-0-286" id="h39-0-286" class="i">+	{ XK_KP_5,          XK_ANY_MOD,     &quot;\033Ou&quot;,       +2,    0},
</a><a href="#h39-0-287" id="h39-0-287" class="i">+	{ XK_KP_6,          XK_ANY_MOD,     &quot;\033Ov&quot;,       +2,    0},
</a><a href="#h39-0-288" id="h39-0-288" class="i">+	{ XK_KP_7,          XK_ANY_MOD,     &quot;\033Ow&quot;,       +2,    0},
</a><a href="#h39-0-289" id="h39-0-289" class="i">+	{ XK_KP_8,          XK_ANY_MOD,     &quot;\033Ox&quot;,       +2,    0},
</a><a href="#h39-0-290" id="h39-0-290" class="i">+	{ XK_KP_9,          XK_ANY_MOD,     &quot;\033Oy&quot;,       +2,    0},
</a><a href="#h39-0-291" id="h39-0-291" class="i">+	{ XK_Up,            ShiftMask,      &quot;\033[1;2A&quot;,     0,    0},
</a><a href="#h39-0-292" id="h39-0-292" class="i">+	{ XK_Up,            Mod1Mask,       &quot;\033[1;3A&quot;,     0,    0},
</a><a href="#h39-0-293" id="h39-0-293" class="i">+	{ XK_Up,         ShiftMask|Mod1Mask,&quot;\033[1;4A&quot;,     0,    0},
</a><a href="#h39-0-294" id="h39-0-294" class="i">+	{ XK_Up,            ControlMask,    &quot;\033[1;5A&quot;,     0,    0},
</a><a href="#h39-0-295" id="h39-0-295" class="i">+	{ XK_Up,      ShiftMask|ControlMask,&quot;\033[1;6A&quot;,     0,    0},
</a><a href="#h39-0-296" id="h39-0-296" class="i">+	{ XK_Up,       ControlMask|Mod1Mask,&quot;\033[1;7A&quot;,     0,    0},
</a><a href="#h39-0-297" id="h39-0-297" class="i">+	{ XK_Up,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8A&quot;,  0,    0},
</a><a href="#h39-0-298" id="h39-0-298" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1},
</a><a href="#h39-0-299" id="h39-0-299" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1},
</a><a href="#h39-0-300" id="h39-0-300" class="i">+	{ XK_Down,          ShiftMask,      &quot;\033[1;2B&quot;,     0,    0},
</a><a href="#h39-0-301" id="h39-0-301" class="i">+	{ XK_Down,          Mod1Mask,       &quot;\033[1;3B&quot;,     0,    0},
</a><a href="#h39-0-302" id="h39-0-302" class="i">+	{ XK_Down,       ShiftMask|Mod1Mask,&quot;\033[1;4B&quot;,     0,    0},
</a><a href="#h39-0-303" id="h39-0-303" class="i">+	{ XK_Down,          ControlMask,    &quot;\033[1;5B&quot;,     0,    0},
</a><a href="#h39-0-304" id="h39-0-304" class="i">+	{ XK_Down,    ShiftMask|ControlMask,&quot;\033[1;6B&quot;,     0,    0},
</a><a href="#h39-0-305" id="h39-0-305" class="i">+	{ XK_Down,     ControlMask|Mod1Mask,&quot;\033[1;7B&quot;,     0,    0},
</a><a href="#h39-0-306" id="h39-0-306" class="i">+	{ XK_Down,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8B&quot;,0,    0},
</a><a href="#h39-0-307" id="h39-0-307" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1},
</a><a href="#h39-0-308" id="h39-0-308" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1},
</a><a href="#h39-0-309" id="h39-0-309" class="i">+	{ XK_Left,          ShiftMask,      &quot;\033[1;2D&quot;,     0,    0},
</a><a href="#h39-0-310" id="h39-0-310" class="i">+	{ XK_Left,          Mod1Mask,       &quot;\033[1;3D&quot;,     0,    0},
</a><a href="#h39-0-311" id="h39-0-311" class="i">+	{ XK_Left,       ShiftMask|Mod1Mask,&quot;\033[1;4D&quot;,     0,    0},
</a><a href="#h39-0-312" id="h39-0-312" class="i">+	{ XK_Left,          ControlMask,    &quot;\033[1;5D&quot;,     0,    0},
</a><a href="#h39-0-313" id="h39-0-313" class="i">+	{ XK_Left,    ShiftMask|ControlMask,&quot;\033[1;6D&quot;,     0,    0},
</a><a href="#h39-0-314" id="h39-0-314" class="i">+	{ XK_Left,     ControlMask|Mod1Mask,&quot;\033[1;7D&quot;,     0,    0},
</a><a href="#h39-0-315" id="h39-0-315" class="i">+	{ XK_Left,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8D&quot;,0,    0},
</a><a href="#h39-0-316" id="h39-0-316" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1},
</a><a href="#h39-0-317" id="h39-0-317" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1},
</a><a href="#h39-0-318" id="h39-0-318" class="i">+	{ XK_Right,         ShiftMask,      &quot;\033[1;2C&quot;,     0,    0},
</a><a href="#h39-0-319" id="h39-0-319" class="i">+	{ XK_Right,         Mod1Mask,       &quot;\033[1;3C&quot;,     0,    0},
</a><a href="#h39-0-320" id="h39-0-320" class="i">+	{ XK_Right,      ShiftMask|Mod1Mask,&quot;\033[1;4C&quot;,     0,    0},
</a><a href="#h39-0-321" id="h39-0-321" class="i">+	{ XK_Right,         ControlMask,    &quot;\033[1;5C&quot;,     0,    0},
</a><a href="#h39-0-322" id="h39-0-322" class="i">+	{ XK_Right,   ShiftMask|ControlMask,&quot;\033[1;6C&quot;,     0,    0},
</a><a href="#h39-0-323" id="h39-0-323" class="i">+	{ XK_Right,    ControlMask|Mod1Mask,&quot;\033[1;7C&quot;,     0,    0},
</a><a href="#h39-0-324" id="h39-0-324" class="i">+	{ XK_Right,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8C&quot;,0,   0},
</a><a href="#h39-0-325" id="h39-0-325" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1},
</a><a href="#h39-0-326" id="h39-0-326" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1},
</a><a href="#h39-0-327" id="h39-0-327" class="i">+	{ XK_ISO_Left_Tab,  ShiftMask,      &quot;\033[Z&quot;,        0,    0},
</a><a href="#h39-0-328" id="h39-0-328" class="i">+	{ XK_Return,        Mod1Mask,       &quot;\033\r&quot;,        0,    0},
</a><a href="#h39-0-329" id="h39-0-329" class="i">+	{ XK_Return,        XK_ANY_MOD,     &quot;\r&quot;,            0,    0},
</a><a href="#h39-0-330" id="h39-0-330" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[4l&quot;,      -1,    0},
</a><a href="#h39-0-331" id="h39-0-331" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0},
</a><a href="#h39-0-332" id="h39-0-332" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[L&quot;,       -1,    0},
</a><a href="#h39-0-333" id="h39-0-333" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[2;5~&quot;,    +1,    0},
</a><a href="#h39-0-334" id="h39-0-334" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0},
</a><a href="#h39-0-335" id="h39-0-335" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0},
</a><a href="#h39-0-336" id="h39-0-336" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[M&quot;,       -1,    0},
</a><a href="#h39-0-337" id="h39-0-337" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[3;5~&quot;,    +1,    0},
</a><a href="#h39-0-338" id="h39-0-338" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[2K&quot;,      -1,    0},
</a><a href="#h39-0-339" id="h39-0-339" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0},
</a><a href="#h39-0-340" id="h39-0-340" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0},
</a><a href="#h39-0-341" id="h39-0-341" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0},
</a><a href="#h39-0-342" id="h39-0-342" class="i">+	{ XK_BackSpace,     XK_NO_MOD,      &quot;\177&quot;,          0,    0},
</a><a href="#h39-0-343" id="h39-0-343" class="i">+	{ XK_BackSpace,     Mod1Mask,       &quot;\033\177&quot;,      0,    0},
</a><a href="#h39-0-344" id="h39-0-344" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[2J&quot;,       0,   -1},
</a><a href="#h39-0-345" id="h39-0-345" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1},
</a><a href="#h39-0-346" id="h39-0-346" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1},
</a><a href="#h39-0-347" id="h39-0-347" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1},
</a><a href="#h39-0-348" id="h39-0-348" class="i">+	{ XK_End,           ControlMask,    &quot;\033[J&quot;,       -1,    0},
</a><a href="#h39-0-349" id="h39-0-349" class="i">+	{ XK_End,           ControlMask,    &quot;\033[1;5F&quot;,    +1,    0},
</a><a href="#h39-0-350" id="h39-0-350" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[K&quot;,       -1,    0},
</a><a href="#h39-0-351" id="h39-0-351" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0},
</a><a href="#h39-0-352" id="h39-0-352" class="i">+	{ XK_End,           XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0},
</a><a href="#h39-0-353" id="h39-0-353" class="i">+	{ XK_Prior,         ControlMask,    &quot;\033[5;5~&quot;,     0,    0},
</a><a href="#h39-0-354" id="h39-0-354" class="i">+	{ XK_Prior,         ShiftMask,      &quot;\033[5;2~&quot;,     0,    0},
</a><a href="#h39-0-355" id="h39-0-355" class="i">+	{ XK_Prior,         XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0},
</a><a href="#h39-0-356" id="h39-0-356" class="i">+	{ XK_Next,          ControlMask,    &quot;\033[6;5~&quot;,     0,    0},
</a><a href="#h39-0-357" id="h39-0-357" class="i">+	{ XK_Next,          ShiftMask,      &quot;\033[6;2~&quot;,     0,    0},
</a><a href="#h39-0-358" id="h39-0-358" class="i">+	{ XK_Next,          XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0},
</a><a href="#h39-0-359" id="h39-0-359" class="i">+	{ XK_F1,            XK_NO_MOD,      &quot;\033OP&quot; ,       0,    0},
</a><a href="#h39-0-360" id="h39-0-360" class="i">+	{ XK_F1, /* F13 */  ShiftMask,      &quot;\033[1;2P&quot;,     0,    0},
</a><a href="#h39-0-361" id="h39-0-361" class="i">+	{ XK_F1, /* F25 */  ControlMask,    &quot;\033[1;5P&quot;,     0,    0},
</a><a href="#h39-0-362" id="h39-0-362" class="i">+	{ XK_F1, /* F37 */  Mod4Mask,       &quot;\033[1;6P&quot;,     0,    0},
</a><a href="#h39-0-363" id="h39-0-363" class="i">+	{ XK_F1, /* F49 */  Mod1Mask,       &quot;\033[1;3P&quot;,     0,    0},
</a><a href="#h39-0-364" id="h39-0-364" class="i">+	{ XK_F1, /* F61 */  Mod3Mask,       &quot;\033[1;4P&quot;,     0,    0},
</a><a href="#h39-0-365" id="h39-0-365" class="i">+	{ XK_F2,            XK_NO_MOD,      &quot;\033OQ&quot; ,       0,    0},
</a><a href="#h39-0-366" id="h39-0-366" class="i">+	{ XK_F2, /* F14 */  ShiftMask,      &quot;\033[1;2Q&quot;,     0,    0},
</a><a href="#h39-0-367" id="h39-0-367" class="i">+	{ XK_F2, /* F26 */  ControlMask,    &quot;\033[1;5Q&quot;,     0,    0},
</a><a href="#h39-0-368" id="h39-0-368" class="i">+	{ XK_F2, /* F38 */  Mod4Mask,       &quot;\033[1;6Q&quot;,     0,    0},
</a><a href="#h39-0-369" id="h39-0-369" class="i">+	{ XK_F2, /* F50 */  Mod1Mask,       &quot;\033[1;3Q&quot;,     0,    0},
</a><a href="#h39-0-370" id="h39-0-370" class="i">+	{ XK_F2, /* F62 */  Mod3Mask,       &quot;\033[1;4Q&quot;,     0,    0},
</a><a href="#h39-0-371" id="h39-0-371" class="i">+	{ XK_F3,            XK_NO_MOD,      &quot;\033OR&quot; ,       0,    0},
</a><a href="#h39-0-372" id="h39-0-372" class="i">+	{ XK_F3, /* F15 */  ShiftMask,      &quot;\033[1;2R&quot;,     0,    0},
</a><a href="#h39-0-373" id="h39-0-373" class="i">+	{ XK_F3, /* F27 */  ControlMask,    &quot;\033[1;5R&quot;,     0,    0},
</a><a href="#h39-0-374" id="h39-0-374" class="i">+	{ XK_F3, /* F39 */  Mod4Mask,       &quot;\033[1;6R&quot;,     0,    0},
</a><a href="#h39-0-375" id="h39-0-375" class="i">+	{ XK_F3, /* F51 */  Mod1Mask,       &quot;\033[1;3R&quot;,     0,    0},
</a><a href="#h39-0-376" id="h39-0-376" class="i">+	{ XK_F3, /* F63 */  Mod3Mask,       &quot;\033[1;4R&quot;,     0,    0},
</a><a href="#h39-0-377" id="h39-0-377" class="i">+	{ XK_F4,            XK_NO_MOD,      &quot;\033OS&quot; ,       0,    0},
</a><a href="#h39-0-378" id="h39-0-378" class="i">+	{ XK_F4, /* F16 */  ShiftMask,      &quot;\033[1;2S&quot;,     0,    0},
</a><a href="#h39-0-379" id="h39-0-379" class="i">+	{ XK_F4, /* F28 */  ControlMask,    &quot;\033[1;5S&quot;,     0,    0},
</a><a href="#h39-0-380" id="h39-0-380" class="i">+	{ XK_F4, /* F40 */  Mod4Mask,       &quot;\033[1;6S&quot;,     0,    0},
</a><a href="#h39-0-381" id="h39-0-381" class="i">+	{ XK_F4, /* F52 */  Mod1Mask,       &quot;\033[1;3S&quot;,     0,    0},
</a><a href="#h39-0-382" id="h39-0-382" class="i">+	{ XK_F5,            XK_NO_MOD,      &quot;\033[15~&quot;,      0,    0},
</a><a href="#h39-0-383" id="h39-0-383" class="i">+	{ XK_F5, /* F17 */  ShiftMask,      &quot;\033[15;2~&quot;,    0,    0},
</a><a href="#h39-0-384" id="h39-0-384" class="i">+	{ XK_F5, /* F29 */  ControlMask,    &quot;\033[15;5~&quot;,    0,    0},
</a><a href="#h39-0-385" id="h39-0-385" class="i">+	{ XK_F5, /* F41 */  Mod4Mask,       &quot;\033[15;6~&quot;,    0,    0},
</a><a href="#h39-0-386" id="h39-0-386" class="i">+	{ XK_F5, /* F53 */  Mod1Mask,       &quot;\033[15;3~&quot;,    0,    0},
</a><a href="#h39-0-387" id="h39-0-387" class="i">+	{ XK_F6,            XK_NO_MOD,      &quot;\033[17~&quot;,      0,    0},
</a><a href="#h39-0-388" id="h39-0-388" class="i">+	{ XK_F6, /* F18 */  ShiftMask,      &quot;\033[17;2~&quot;,    0,    0},
</a><a href="#h39-0-389" id="h39-0-389" class="i">+	{ XK_F6, /* F30 */  ControlMask,    &quot;\033[17;5~&quot;,    0,    0},
</a><a href="#h39-0-390" id="h39-0-390" class="i">+	{ XK_F6, /* F42 */  Mod4Mask,       &quot;\033[17;6~&quot;,    0,    0},
</a><a href="#h39-0-391" id="h39-0-391" class="i">+	{ XK_F6, /* F54 */  Mod1Mask,       &quot;\033[17;3~&quot;,    0,    0},
</a><a href="#h39-0-392" id="h39-0-392" class="i">+	{ XK_F7,            XK_NO_MOD,      &quot;\033[18~&quot;,      0,    0},
</a><a href="#h39-0-393" id="h39-0-393" class="i">+	{ XK_F7, /* F19 */  ShiftMask,      &quot;\033[18;2~&quot;,    0,    0},
</a><a href="#h39-0-394" id="h39-0-394" class="i">+	{ XK_F7, /* F31 */  ControlMask,    &quot;\033[18;5~&quot;,    0,    0},
</a><a href="#h39-0-395" id="h39-0-395" class="i">+	{ XK_F7, /* F43 */  Mod4Mask,       &quot;\033[18;6~&quot;,    0,    0},
</a><a href="#h39-0-396" id="h39-0-396" class="i">+	{ XK_F7, /* F55 */  Mod1Mask,       &quot;\033[18;3~&quot;,    0,    0},
</a><a href="#h39-0-397" id="h39-0-397" class="i">+	{ XK_F8,            XK_NO_MOD,      &quot;\033[19~&quot;,      0,    0},
</a><a href="#h39-0-398" id="h39-0-398" class="i">+	{ XK_F8, /* F20 */  ShiftMask,      &quot;\033[19;2~&quot;,    0,    0},
</a><a href="#h39-0-399" id="h39-0-399" class="i">+	{ XK_F8, /* F32 */  ControlMask,    &quot;\033[19;5~&quot;,    0,    0},
</a><a href="#h39-0-400" id="h39-0-400" class="i">+	{ XK_F8, /* F44 */  Mod4Mask,       &quot;\033[19;6~&quot;,    0,    0},
</a><a href="#h39-0-401" id="h39-0-401" class="i">+	{ XK_F8, /* F56 */  Mod1Mask,       &quot;\033[19;3~&quot;,    0,    0},
</a><a href="#h39-0-402" id="h39-0-402" class="i">+	{ XK_F9,            XK_NO_MOD,      &quot;\033[20~&quot;,      0,    0},
</a><a href="#h39-0-403" id="h39-0-403" class="i">+	{ XK_F9, /* F21 */  ShiftMask,      &quot;\033[20;2~&quot;,    0,    0},
</a><a href="#h39-0-404" id="h39-0-404" class="i">+	{ XK_F9, /* F33 */  ControlMask,    &quot;\033[20;5~&quot;,    0,    0},
</a><a href="#h39-0-405" id="h39-0-405" class="i">+	{ XK_F9, /* F45 */  Mod4Mask,       &quot;\033[20;6~&quot;,    0,    0},
</a><a href="#h39-0-406" id="h39-0-406" class="i">+	{ XK_F9, /* F57 */  Mod1Mask,       &quot;\033[20;3~&quot;,    0,    0},
</a><a href="#h39-0-407" id="h39-0-407" class="i">+	{ XK_F10,           XK_NO_MOD,      &quot;\033[21~&quot;,      0,    0},
</a><a href="#h39-0-408" id="h39-0-408" class="i">+	{ XK_F10, /* F22 */ ShiftMask,      &quot;\033[21;2~&quot;,    0,    0},
</a><a href="#h39-0-409" id="h39-0-409" class="i">+	{ XK_F10, /* F34 */ ControlMask,    &quot;\033[21;5~&quot;,    0,    0},
</a><a href="#h39-0-410" id="h39-0-410" class="i">+	{ XK_F10, /* F46 */ Mod4Mask,       &quot;\033[21;6~&quot;,    0,    0},
</a><a href="#h39-0-411" id="h39-0-411" class="i">+	{ XK_F10, /* F58 */ Mod1Mask,       &quot;\033[21;3~&quot;,    0,    0},
</a><a href="#h39-0-412" id="h39-0-412" class="i">+	{ XK_F11,           XK_NO_MOD,      &quot;\033[23~&quot;,      0,    0},
</a><a href="#h39-0-413" id="h39-0-413" class="i">+	{ XK_F11, /* F23 */ ShiftMask,      &quot;\033[23;2~&quot;,    0,    0},
</a><a href="#h39-0-414" id="h39-0-414" class="i">+	{ XK_F11, /* F35 */ ControlMask,    &quot;\033[23;5~&quot;,    0,    0},
</a><a href="#h39-0-415" id="h39-0-415" class="i">+	{ XK_F11, /* F47 */ Mod4Mask,       &quot;\033[23;6~&quot;,    0,    0},
</a><a href="#h39-0-416" id="h39-0-416" class="i">+	{ XK_F11, /* F59 */ Mod1Mask,       &quot;\033[23;3~&quot;,    0,    0},
</a><a href="#h39-0-417" id="h39-0-417" class="i">+	{ XK_F12,           XK_NO_MOD,      &quot;\033[24~&quot;,      0,    0},
</a><a href="#h39-0-418" id="h39-0-418" class="i">+	{ XK_F12, /* F24 */ ShiftMask,      &quot;\033[24;2~&quot;,    0,    0},
</a><a href="#h39-0-419" id="h39-0-419" class="i">+	{ XK_F12, /* F36 */ ControlMask,    &quot;\033[24;5~&quot;,    0,    0},
</a><a href="#h39-0-420" id="h39-0-420" class="i">+	{ XK_F12, /* F48 */ Mod4Mask,       &quot;\033[24;6~&quot;,    0,    0},
</a><a href="#h39-0-421" id="h39-0-421" class="i">+	{ XK_F12, /* F60 */ Mod1Mask,       &quot;\033[24;3~&quot;,    0,    0},
</a><a href="#h39-0-422" id="h39-0-422" class="i">+	{ XK_F13,           XK_NO_MOD,      &quot;\033[1;2P&quot;,     0,    0},
</a><a href="#h39-0-423" id="h39-0-423" class="i">+	{ XK_F14,           XK_NO_MOD,      &quot;\033[1;2Q&quot;,     0,    0},
</a><a href="#h39-0-424" id="h39-0-424" class="i">+	{ XK_F15,           XK_NO_MOD,      &quot;\033[1;2R&quot;,     0,    0},
</a><a href="#h39-0-425" id="h39-0-425" class="i">+	{ XK_F16,           XK_NO_MOD,      &quot;\033[1;2S&quot;,     0,    0},
</a><a href="#h39-0-426" id="h39-0-426" class="i">+	{ XK_F17,           XK_NO_MOD,      &quot;\033[15;2~&quot;,    0,    0},
</a><a href="#h39-0-427" id="h39-0-427" class="i">+	{ XK_F18,           XK_NO_MOD,      &quot;\033[17;2~&quot;,    0,    0},
</a><a href="#h39-0-428" id="h39-0-428" class="i">+	{ XK_F19,           XK_NO_MOD,      &quot;\033[18;2~&quot;,    0,    0},
</a><a href="#h39-0-429" id="h39-0-429" class="i">+	{ XK_F20,           XK_NO_MOD,      &quot;\033[19;2~&quot;,    0,    0},
</a><a href="#h39-0-430" id="h39-0-430" class="i">+	{ XK_F21,           XK_NO_MOD,      &quot;\033[20;2~&quot;,    0,    0},
</a><a href="#h39-0-431" id="h39-0-431" class="i">+	{ XK_F22,           XK_NO_MOD,      &quot;\033[21;2~&quot;,    0,    0},
</a><a href="#h39-0-432" id="h39-0-432" class="i">+	{ XK_F23,           XK_NO_MOD,      &quot;\033[23;2~&quot;,    0,    0},
</a><a href="#h39-0-433" id="h39-0-433" class="i">+	{ XK_F24,           XK_NO_MOD,      &quot;\033[24;2~&quot;,    0,    0},
</a><a href="#h39-0-434" id="h39-0-434" class="i">+	{ XK_F25,           XK_NO_MOD,      &quot;\033[1;5P&quot;,     0,    0},
</a><a href="#h39-0-435" id="h39-0-435" class="i">+	{ XK_F26,           XK_NO_MOD,      &quot;\033[1;5Q&quot;,     0,    0},
</a><a href="#h39-0-436" id="h39-0-436" class="i">+	{ XK_F27,           XK_NO_MOD,      &quot;\033[1;5R&quot;,     0,    0},
</a><a href="#h39-0-437" id="h39-0-437" class="i">+	{ XK_F28,           XK_NO_MOD,      &quot;\033[1;5S&quot;,     0,    0},
</a><a href="#h39-0-438" id="h39-0-438" class="i">+	{ XK_F29,           XK_NO_MOD,      &quot;\033[15;5~&quot;,    0,    0},
</a><a href="#h39-0-439" id="h39-0-439" class="i">+	{ XK_F30,           XK_NO_MOD,      &quot;\033[17;5~&quot;,    0,    0},
</a><a href="#h39-0-440" id="h39-0-440" class="i">+	{ XK_F31,           XK_NO_MOD,      &quot;\033[18;5~&quot;,    0,    0},
</a><a href="#h39-0-441" id="h39-0-441" class="i">+	{ XK_F32,           XK_NO_MOD,      &quot;\033[19;5~&quot;,    0,    0},
</a><a href="#h39-0-442" id="h39-0-442" class="i">+	{ XK_F33,           XK_NO_MOD,      &quot;\033[20;5~&quot;,    0,    0},
</a><a href="#h39-0-443" id="h39-0-443" class="i">+	{ XK_F34,           XK_NO_MOD,      &quot;\033[21;5~&quot;,    0,    0},
</a><a href="#h39-0-444" id="h39-0-444" class="i">+	{ XK_F35,           XK_NO_MOD,      &quot;\033[23;5~&quot;,    0,    0},
</a><a href="#h39-0-445" id="h39-0-445" class="i">+};
</a><a href="#h39-0-446" id="h39-0-446" class="i">+
</a><a href="#h39-0-447" id="h39-0-447" class="i">+/*
</a><a href="#h39-0-448" id="h39-0-448" class="i">+ * Selection types&#39; masks.
</a><a href="#h39-0-449" id="h39-0-449" class="i">+ * Use the same masks as usual.
</a><a href="#h39-0-450" id="h39-0-450" class="i">+ * Button1Mask is always unset, to make masks match between ButtonPress.
</a><a href="#h39-0-451" id="h39-0-451" class="i">+ * ButtonRelease and MotionNotify.
</a><a href="#h39-0-452" id="h39-0-452" class="i">+ * If no match is found, regular selection is used.
</a><a href="#h39-0-453" id="h39-0-453" class="i">+ */
</a><a href="#h39-0-454" id="h39-0-454" class="i">+static uint selmasks[] = {
</a><a href="#h39-0-455" id="h39-0-455" class="i">+	[SEL_RECTANGULAR] = Mod1Mask,
</a><a href="#h39-0-456" id="h39-0-456" class="i">+};
</a><a href="#h39-0-457" id="h39-0-457" class="i">+
</a><a href="#h39-0-458" id="h39-0-458" class="i">+/*
</a><a href="#h39-0-459" id="h39-0-459" class="i">+ * Printable characters in ASCII, used to estimate the advance width
</a><a href="#h39-0-460" id="h39-0-460" class="i">+ * of single wide characters.
</a><a href="#h39-0-461" id="h39-0-461" class="i">+ */
</a><a href="#h39-0-462" id="h39-0-462" class="i">+static char ascii_printable[] =
</a><a href="#h39-0-463" id="h39-0-463" class="i">+	&quot; !\&quot;#$%&amp;&#39;()*+,-./0123456789:;&lt;=&gt;?&quot;
</a><a href="#h39-0-464" id="h39-0-464" class="i">+	&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_&quot;
</a><a href="#h39-0-465" id="h39-0-465" class="i">+	&quot;`abcdefghijklmnopqrstuvwxyz{|}~&quot;;
</a><b>diff --git a/<a id="h40" href="../file/st/config.h.html">st/config.h</a> b/<a href="../file/st/config.h.html">st/config.h</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -0,0 +1,472 @@
</a><a href="#h40-0-0" id="h40-0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h40-0-1" id="h40-0-1" class="i">+
</a><a href="#h40-0-2" id="h40-0-2" class="i">+/*
</a><a href="#h40-0-3" id="h40-0-3" class="i">+ * appearance
</a><a href="#h40-0-4" id="h40-0-4" class="i">+ *
</a><a href="#h40-0-5" id="h40-0-5" class="i">+ * font: see http://freedesktop.org/software/fontconfig/fontconfig-user.html
</a><a href="#h40-0-6" id="h40-0-6" class="i">+ */
</a><a href="#h40-0-7" id="h40-0-7" class="i">+static char *font = &quot;Ubuntu Mono:pixelsize=20:antialias=true:autohint=true&quot;;
</a><a href="#h40-0-8" id="h40-0-8" class="i">+static int borderpx = 2;
</a><a href="#h40-0-9" id="h40-0-9" class="i">+
</a><a href="#h40-0-10" id="h40-0-10" class="i">+/*
</a><a href="#h40-0-11" id="h40-0-11" class="i">+ * What program is execed by st depends of these precedence rules:
</a><a href="#h40-0-12" id="h40-0-12" class="i">+ * 1: program passed with -e
</a><a href="#h40-0-13" id="h40-0-13" class="i">+ * 2: utmp option
</a><a href="#h40-0-14" id="h40-0-14" class="i">+ * 3: SHELL environment variable
</a><a href="#h40-0-15" id="h40-0-15" class="i">+ * 4: value of shell in /etc/passwd
</a><a href="#h40-0-16" id="h40-0-16" class="i">+ * 5: value of shell in config.h
</a><a href="#h40-0-17" id="h40-0-17" class="i">+ */
</a><a href="#h40-0-18" id="h40-0-18" class="i">+static char *shell = &quot;/bin/sh&quot;;
</a><a href="#h40-0-19" id="h40-0-19" class="i">+char *utmp = NULL;
</a><a href="#h40-0-20" id="h40-0-20" class="i">+char *stty_args = &quot;stty raw pass8 nl -echo -iexten -cstopb 38400&quot;;
</a><a href="#h40-0-21" id="h40-0-21" class="i">+
</a><a href="#h40-0-22" id="h40-0-22" class="i">+/* identification sequence returned in DA and DECID */
</a><a href="#h40-0-23" id="h40-0-23" class="i">+char *vtiden = &quot;\033[?6c&quot;;
</a><a href="#h40-0-24" id="h40-0-24" class="i">+
</a><a href="#h40-0-25" id="h40-0-25" class="i">+/* Kerning / character bounding-box multipliers */
</a><a href="#h40-0-26" id="h40-0-26" class="i">+static float cwscale = 1.0;
</a><a href="#h40-0-27" id="h40-0-27" class="i">+static float chscale = 1.0;
</a><a href="#h40-0-28" id="h40-0-28" class="i">+
</a><a href="#h40-0-29" id="h40-0-29" class="i">+/*
</a><a href="#h40-0-30" id="h40-0-30" class="i">+ * word delimiter string
</a><a href="#h40-0-31" id="h40-0-31" class="i">+ *
</a><a href="#h40-0-32" id="h40-0-32" class="i">+ * More advanced example: &quot; `&#39;\&quot;()[]{}&quot;
</a><a href="#h40-0-33" id="h40-0-33" class="i">+ */
</a><a href="#h40-0-34" id="h40-0-34" class="i">+char *worddelimiters = &quot; &quot;;
</a><a href="#h40-0-35" id="h40-0-35" class="i">+
</a><a href="#h40-0-36" id="h40-0-36" class="i">+/* selection timeouts (in milliseconds) */
</a><a href="#h40-0-37" id="h40-0-37" class="i">+static unsigned int doubleclicktimeout = 300;
</a><a href="#h40-0-38" id="h40-0-38" class="i">+static unsigned int tripleclicktimeout = 600;
</a><a href="#h40-0-39" id="h40-0-39" class="i">+
</a><a href="#h40-0-40" id="h40-0-40" class="i">+/* alt screens */
</a><a href="#h40-0-41" id="h40-0-41" class="i">+int allowaltscreen = 1;
</a><a href="#h40-0-42" id="h40-0-42" class="i">+
</a><a href="#h40-0-43" id="h40-0-43" class="i">+/* frames per second st should at maximum draw to the screen */
</a><a href="#h40-0-44" id="h40-0-44" class="i">+static unsigned int xfps = 120;
</a><a href="#h40-0-45" id="h40-0-45" class="i">+static unsigned int actionfps = 30;
</a><a href="#h40-0-46" id="h40-0-46" class="i">+
</a><a href="#h40-0-47" id="h40-0-47" class="i">+/*
</a><a href="#h40-0-48" id="h40-0-48" class="i">+ * blinking timeout (set to 0 to disable blinking) for the terminal blinking
</a><a href="#h40-0-49" id="h40-0-49" class="i">+ * attribute.
</a><a href="#h40-0-50" id="h40-0-50" class="i">+ */
</a><a href="#h40-0-51" id="h40-0-51" class="i">+static unsigned int blinktimeout = 800;
</a><a href="#h40-0-52" id="h40-0-52" class="i">+
</a><a href="#h40-0-53" id="h40-0-53" class="i">+/*
</a><a href="#h40-0-54" id="h40-0-54" class="i">+ * thickness of underline and bar cursors
</a><a href="#h40-0-55" id="h40-0-55" class="i">+ */
</a><a href="#h40-0-56" id="h40-0-56" class="i">+static unsigned int cursorthickness = 2;
</a><a href="#h40-0-57" id="h40-0-57" class="i">+
</a><a href="#h40-0-58" id="h40-0-58" class="i">+/*
</a><a href="#h40-0-59" id="h40-0-59" class="i">+ * bell volume. It must be a value between -100 and 100. Use 0 for disabling
</a><a href="#h40-0-60" id="h40-0-60" class="i">+ * it
</a><a href="#h40-0-61" id="h40-0-61" class="i">+ */
</a><a href="#h40-0-62" id="h40-0-62" class="i">+static int bellvolume = 0;
</a><a href="#h40-0-63" id="h40-0-63" class="i">+
</a><a href="#h40-0-64" id="h40-0-64" class="i">+/* default TERM value */
</a><a href="#h40-0-65" id="h40-0-65" class="i">+char *termname = &quot;st-256color&quot;;
</a><a href="#h40-0-66" id="h40-0-66" class="i">+
</a><a href="#h40-0-67" id="h40-0-67" class="i">+/*
</a><a href="#h40-0-68" id="h40-0-68" class="i">+ * spaces per tab
</a><a href="#h40-0-69" id="h40-0-69" class="i">+ *
</a><a href="#h40-0-70" id="h40-0-70" class="i">+ * When you are changing this value, don&#39;t forget to adapt the »it« value in
</a><a href="#h40-0-71" id="h40-0-71" class="i">+ * the st.info and appropriately install the st.info in the environment where
</a><a href="#h40-0-72" id="h40-0-72" class="i">+ * you use this st version.
</a><a href="#h40-0-73" id="h40-0-73" class="i">+ *
</a><a href="#h40-0-74" id="h40-0-74" class="i">+ *	it#$tabspaces,
</a><a href="#h40-0-75" id="h40-0-75" class="i">+ *
</a><a href="#h40-0-76" id="h40-0-76" class="i">+ * Secondly make sure your kernel is not expanding tabs. When running `stty
</a><a href="#h40-0-77" id="h40-0-77" class="i">+ * -a` »tab0« should appear. You can tell the terminal to not expand tabs by
</a><a href="#h40-0-78" id="h40-0-78" class="i">+ *  running following command:
</a><a href="#h40-0-79" id="h40-0-79" class="i">+ *
</a><a href="#h40-0-80" id="h40-0-80" class="i">+ *	stty tabs
</a><a href="#h40-0-81" id="h40-0-81" class="i">+ */
</a><a href="#h40-0-82" id="h40-0-82" class="i">+unsigned int tabspaces = 8;
</a><a href="#h40-0-83" id="h40-0-83" class="i">+
</a><a href="#h40-0-84" id="h40-0-84" class="i">+/* bg opacity */
</a><a href="#h40-0-85" id="h40-0-85" class="i">+
</a><a href="#h40-0-86" id="h40-0-86" class="i">+/* Terminal colors (16 first used in escape sequence) */
</a><a href="#h40-0-87" id="h40-0-87" class="i">+static const char *colorname[] = {
</a><a href="#h40-0-88" id="h40-0-88" class="i">+
</a><a href="#h40-0-89" id="h40-0-89" class="i">+  /* 8 normal colors */
</a><a href="#h40-0-90" id="h40-0-90" class="i">+  [0] = &quot;#2e3436&quot;, /* black   */
</a><a href="#h40-0-91" id="h40-0-91" class="i">+  [1] = &quot;#cc0000&quot;, /* red     */
</a><a href="#h40-0-92" id="h40-0-92" class="i">+  [2] = &quot;#4e9a06&quot;, /* green   */
</a><a href="#h40-0-93" id="h40-0-93" class="i">+  [3] = &quot;#c4a000&quot;, /* yellow  */
</a><a href="#h40-0-94" id="h40-0-94" class="i">+  [4] = &quot;#3465a4&quot;, /* blue    */
</a><a href="#h40-0-95" id="h40-0-95" class="i">+  [5] = &quot;#75507b&quot;, /* magenta */
</a><a href="#h40-0-96" id="h40-0-96" class="i">+  [6] = &quot;#06989a&quot;, /* cyan    */
</a><a href="#h40-0-97" id="h40-0-97" class="i">+  [7] = &quot;#d3d7cf&quot;, /* white   */
</a><a href="#h40-0-98" id="h40-0-98" class="i">+
</a><a href="#h40-0-99" id="h40-0-99" class="i">+  /* 8 bright colors */
</a><a href="#h40-0-100" id="h40-0-100" class="i">+  [8]  = &quot;#555753&quot;, /* black   */
</a><a href="#h40-0-101" id="h40-0-101" class="i">+  [9]  = &quot;#ef2929&quot;, /* red     */
</a><a href="#h40-0-102" id="h40-0-102" class="i">+  [10] = &quot;#8ae234&quot;, /* green   */
</a><a href="#h40-0-103" id="h40-0-103" class="i">+  [11] = &quot;#fce94f&quot;, /* yellow  */
</a><a href="#h40-0-104" id="h40-0-104" class="i">+  [12] = &quot;#729fcf&quot;, /* blue    */
</a><a href="#h40-0-105" id="h40-0-105" class="i">+  [13] = &quot;#ad7fa8&quot;, /* magenta */
</a><a href="#h40-0-106" id="h40-0-106" class="i">+  [14] = &quot;#34e2e2&quot;, /* cyan    */
</a><a href="#h40-0-107" id="h40-0-107" class="i">+  [15] = &quot;#eeeeec&quot;, /* white   */
</a><a href="#h40-0-108" id="h40-0-108" class="i">+
</a><a href="#h40-0-109" id="h40-0-109" class="i">+  /* special colors */
</a><a href="#h40-0-110" id="h40-0-110" class="i">+  [256] = &quot;#000000&quot;, /* background */
</a><a href="#h40-0-111" id="h40-0-111" class="i">+  [257] = &quot;#babdb6&quot;, /* foreground */
</a><a href="#h40-0-112" id="h40-0-112" class="i">+};
</a><a href="#h40-0-113" id="h40-0-113" class="i">+
</a><a href="#h40-0-114" id="h40-0-114" class="i">+/*
</a><a href="#h40-0-115" id="h40-0-115" class="i">+ * Default colors (colorname index)
</a><a href="#h40-0-116" id="h40-0-116" class="i">+ * foreground, background, cursor
</a><a href="#h40-0-117" id="h40-0-117" class="i">+ */
</a><a href="#h40-0-118" id="h40-0-118" class="i">+
</a><a href="#h40-0-119" id="h40-0-119" class="i">+unsigned int alpha = 0xee;
</a><a href="#h40-0-120" id="h40-0-120" class="i">+unsigned int defaultfg = 257;
</a><a href="#h40-0-121" id="h40-0-121" class="i">+unsigned int defaultbg = 256;
</a><a href="#h40-0-122" id="h40-0-122" class="i">+static unsigned int defaultcs = 257;
</a><a href="#h40-0-123" id="h40-0-123" class="i">+static unsigned int defaultrcs = 257;
</a><a href="#h40-0-124" id="h40-0-124" class="i">+
</a><a href="#h40-0-125" id="h40-0-125" class="i">+/*
</a><a href="#h40-0-126" id="h40-0-126" class="i">+ * Colors used, when the specific fg == defaultfg. So in reverse mode this
</a><a href="#h40-0-127" id="h40-0-127" class="i">+ * will reverse too. Another logic would only make the simple feature too
</a><a href="#h40-0-128" id="h40-0-128" class="i">+ * complex.
</a><a href="#h40-0-129" id="h40-0-129" class="i">+ */
</a><a href="#h40-0-130" id="h40-0-130" class="i">+static unsigned int defaultitalic = 7;
</a><a href="#h40-0-131" id="h40-0-131" class="i">+static unsigned int defaultunderline = 7;
</a><a href="#h40-0-132" id="h40-0-132" class="i">+
</a><a href="#h40-0-133" id="h40-0-133" class="i">+/*
</a><a href="#h40-0-134" id="h40-0-134" class="i">+ * Default shape of cursor
</a><a href="#h40-0-135" id="h40-0-135" class="i">+ * 2: Block (&quot;█&quot;)
</a><a href="#h40-0-136" id="h40-0-136" class="i">+ * 4: Underline (&quot;_&quot;)
</a><a href="#h40-0-137" id="h40-0-137" class="i">+ * 6: Bar (&quot;|&quot;)
</a><a href="#h40-0-138" id="h40-0-138" class="i">+ * 7: Snowman (&quot;☃&quot;)
</a><a href="#h40-0-139" id="h40-0-139" class="i">+ */
</a><a href="#h40-0-140" id="h40-0-140" class="i">+static unsigned int cursorshape = 2;
</a><a href="#h40-0-141" id="h40-0-141" class="i">+
</a><a href="#h40-0-142" id="h40-0-142" class="i">+/*
</a><a href="#h40-0-143" id="h40-0-143" class="i">+ * Default columns and rows numbers
</a><a href="#h40-0-144" id="h40-0-144" class="i">+ */
</a><a href="#h40-0-145" id="h40-0-145" class="i">+
</a><a href="#h40-0-146" id="h40-0-146" class="i">+static unsigned int cols = 80;
</a><a href="#h40-0-147" id="h40-0-147" class="i">+static unsigned int rows = 24;
</a><a href="#h40-0-148" id="h40-0-148" class="i">+
</a><a href="#h40-0-149" id="h40-0-149" class="i">+/*
</a><a href="#h40-0-150" id="h40-0-150" class="i">+ * Default colour and shape of the mouse cursor
</a><a href="#h40-0-151" id="h40-0-151" class="i">+ */
</a><a href="#h40-0-152" id="h40-0-152" class="i">+static unsigned int mouseshape = XC_xterm;
</a><a href="#h40-0-153" id="h40-0-153" class="i">+static unsigned int mousefg = 7;
</a><a href="#h40-0-154" id="h40-0-154" class="i">+static unsigned int mousebg = 0;
</a><a href="#h40-0-155" id="h40-0-155" class="i">+
</a><a href="#h40-0-156" id="h40-0-156" class="i">+/*
</a><a href="#h40-0-157" id="h40-0-157" class="i">+ * Color used to display font attributes when fontconfig selected a font which
</a><a href="#h40-0-158" id="h40-0-158" class="i">+ * doesn&#39;t match the ones requested.
</a><a href="#h40-0-159" id="h40-0-159" class="i">+ */
</a><a href="#h40-0-160" id="h40-0-160" class="i">+static unsigned int defaultattr = 11;
</a><a href="#h40-0-161" id="h40-0-161" class="i">+
</a><a href="#h40-0-162" id="h40-0-162" class="i">+/*
</a><a href="#h40-0-163" id="h40-0-163" class="i">+ * Internal mouse shortcuts.
</a><a href="#h40-0-164" id="h40-0-164" class="i">+ * Beware that overloading Button1 will disable the selection.
</a><a href="#h40-0-165" id="h40-0-165" class="i">+ */
</a><a href="#h40-0-166" id="h40-0-166" class="i">+static MouseShortcut mshortcuts[] = {
</a><a href="#h40-0-167" id="h40-0-167" class="i">+	/* button               mask            string */
</a><a href="#h40-0-168" id="h40-0-168" class="i">+	{ Button4,              XK_ANY_MOD,     &quot;\031&quot; },
</a><a href="#h40-0-169" id="h40-0-169" class="i">+	{ Button5,              XK_ANY_MOD,     &quot;\005&quot; },
</a><a href="#h40-0-170" id="h40-0-170" class="i">+};
</a><a href="#h40-0-171" id="h40-0-171" class="i">+
</a><a href="#h40-0-172" id="h40-0-172" class="i">+/* Internal keyboard shortcuts. */
</a><a href="#h40-0-173" id="h40-0-173" class="i">+#define MODKEY Mod1Mask
</a><a href="#h40-0-174" id="h40-0-174" class="i">+#define TERMMOD (ControlMask|ShiftMask)
</a><a href="#h40-0-175" id="h40-0-175" class="i">+
</a><a href="#h40-0-176" id="h40-0-176" class="i">+static Shortcut shortcuts[] = {
</a><a href="#h40-0-177" id="h40-0-177" class="i">+	/* mask                 keysym          function        argument */
</a><a href="#h40-0-178" id="h40-0-178" class="i">+	{ XK_ANY_MOD,           XK_Break,       sendbreak,      {.i =  0} },
</a><a href="#h40-0-179" id="h40-0-179" class="i">+	{ ControlMask,          XK_Print,       toggleprinter,  {.i =  0} },
</a><a href="#h40-0-180" id="h40-0-180" class="i">+	{ ShiftMask,            XK_Print,       printscreen,    {.i =  0} },
</a><a href="#h40-0-181" id="h40-0-181" class="i">+	{ XK_ANY_MOD,           XK_Print,       printsel,       {.i =  0} },
</a><a href="#h40-0-182" id="h40-0-182" class="i">+	{ TERMMOD,              XK_Prior,       zoom,           {.f = +1} },
</a><a href="#h40-0-183" id="h40-0-183" class="i">+	{ TERMMOD,              XK_Next,        zoom,           {.f = -1} },
</a><a href="#h40-0-184" id="h40-0-184" class="i">+	{ TERMMOD,              XK_Home,        zoomreset,      {.f =  0} },
</a><a href="#h40-0-185" id="h40-0-185" class="i">+	{ TERMMOD,              XK_C,           clipcopy,       {.i =  0} },
</a><a href="#h40-0-186" id="h40-0-186" class="i">+	{ TERMMOD,              XK_V,           clippaste,      {.i =  0} },
</a><a href="#h40-0-187" id="h40-0-187" class="i">+	{ TERMMOD,              XK_Y,           selpaste,       {.i =  0} },
</a><a href="#h40-0-188" id="h40-0-188" class="i">+	{ ShiftMask,            XK_Insert,      selpaste,       {.i =  0} },
</a><a href="#h40-0-189" id="h40-0-189" class="i">+	{ TERMMOD,              XK_Num_Lock,    numlock,        {.i =  0} },
</a><a href="#h40-0-190" id="h40-0-190" class="i">+};
</a><a href="#h40-0-191" id="h40-0-191" class="i">+
</a><a href="#h40-0-192" id="h40-0-192" class="i">+/*
</a><a href="#h40-0-193" id="h40-0-193" class="i">+ * Special keys (change &amp; recompile st.info accordingly)
</a><a href="#h40-0-194" id="h40-0-194" class="i">+ *
</a><a href="#h40-0-195" id="h40-0-195" class="i">+ * Mask value:
</a><a href="#h40-0-196" id="h40-0-196" class="i">+ * * Use XK_ANY_MOD to match the key no matter modifiers state
</a><a href="#h40-0-197" id="h40-0-197" class="i">+ * * Use XK_NO_MOD to match the key alone (no modifiers)
</a><a href="#h40-0-198" id="h40-0-198" class="i">+ * appkey value:
</a><a href="#h40-0-199" id="h40-0-199" class="i">+ * * 0: no value
</a><a href="#h40-0-200" id="h40-0-200" class="i">+ * * &gt; 0: keypad application mode enabled
</a><a href="#h40-0-201" id="h40-0-201" class="i">+ * *   = 2: term.numlock = 1
</a><a href="#h40-0-202" id="h40-0-202" class="i">+ * * &lt; 0: keypad application mode disabled
</a><a href="#h40-0-203" id="h40-0-203" class="i">+ * appcursor value:
</a><a href="#h40-0-204" id="h40-0-204" class="i">+ * * 0: no value
</a><a href="#h40-0-205" id="h40-0-205" class="i">+ * * &gt; 0: cursor application mode enabled
</a><a href="#h40-0-206" id="h40-0-206" class="i">+ * * &lt; 0: cursor application mode disabled
</a><a href="#h40-0-207" id="h40-0-207" class="i">+ * crlf value
</a><a href="#h40-0-208" id="h40-0-208" class="i">+ * * 0: no value
</a><a href="#h40-0-209" id="h40-0-209" class="i">+ * * &gt; 0: crlf mode is enabled
</a><a href="#h40-0-210" id="h40-0-210" class="i">+ * * &lt; 0: crlf mode is disabled
</a><a href="#h40-0-211" id="h40-0-211" class="i">+ *
</a><a href="#h40-0-212" id="h40-0-212" class="i">+ * Be careful with the order of the definitions because st searches in
</a><a href="#h40-0-213" id="h40-0-213" class="i">+ * this table sequentially, so any XK_ANY_MOD must be in the last
</a><a href="#h40-0-214" id="h40-0-214" class="i">+ * position for a key.
</a><a href="#h40-0-215" id="h40-0-215" class="i">+ */
</a><a href="#h40-0-216" id="h40-0-216" class="i">+
</a><a href="#h40-0-217" id="h40-0-217" class="i">+/*
</a><a href="#h40-0-218" id="h40-0-218" class="i">+ * If you want keys other than the X11 function keys (0xFD00 - 0xFFFF)
</a><a href="#h40-0-219" id="h40-0-219" class="i">+ * to be mapped below, add them to this array.
</a><a href="#h40-0-220" id="h40-0-220" class="i">+ */
</a><a href="#h40-0-221" id="h40-0-221" class="i">+static KeySym mappedkeys[] = { -1 };
</a><a href="#h40-0-222" id="h40-0-222" class="i">+
</a><a href="#h40-0-223" id="h40-0-223" class="i">+/*
</a><a href="#h40-0-224" id="h40-0-224" class="i">+ * State bits to ignore when matching key or button events.  By default,
</a><a href="#h40-0-225" id="h40-0-225" class="i">+ * numlock (Mod2Mask) and keyboard layout (XK_SWITCH_MOD) are ignored.
</a><a href="#h40-0-226" id="h40-0-226" class="i">+ */
</a><a href="#h40-0-227" id="h40-0-227" class="i">+static uint ignoremod = Mod2Mask|XK_SWITCH_MOD;
</a><a href="#h40-0-228" id="h40-0-228" class="i">+
</a><a href="#h40-0-229" id="h40-0-229" class="i">+/*
</a><a href="#h40-0-230" id="h40-0-230" class="i">+ * Override mouse-select while mask is active (when MODE_MOUSE is set).
</a><a href="#h40-0-231" id="h40-0-231" class="i">+ * Note that if you want to use ShiftMask with selmasks, set this to an other
</a><a href="#h40-0-232" id="h40-0-232" class="i">+ * modifier, set to 0 to not use it.
</a><a href="#h40-0-233" id="h40-0-233" class="i">+ */
</a><a href="#h40-0-234" id="h40-0-234" class="i">+static uint forceselmod = ShiftMask;
</a><a href="#h40-0-235" id="h40-0-235" class="i">+
</a><a href="#h40-0-236" id="h40-0-236" class="i">+/*
</a><a href="#h40-0-237" id="h40-0-237" class="i">+ * This is the huge key array which defines all compatibility to the Linux
</a><a href="#h40-0-238" id="h40-0-238" class="i">+ * world. Please decide about changes wisely.
</a><a href="#h40-0-239" id="h40-0-239" class="i">+ */
</a><a href="#h40-0-240" id="h40-0-240" class="i">+static Key key[] = {
</a><a href="#h40-0-241" id="h40-0-241" class="i">+	/* keysym           mask            string      appkey appcursor */
</a><a href="#h40-0-242" id="h40-0-242" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[2J&quot;,       0,   -1},
</a><a href="#h40-0-243" id="h40-0-243" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1},
</a><a href="#h40-0-244" id="h40-0-244" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1},
</a><a href="#h40-0-245" id="h40-0-245" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1},
</a><a href="#h40-0-246" id="h40-0-246" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033Ox&quot;,       +1,    0},
</a><a href="#h40-0-247" id="h40-0-247" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1},
</a><a href="#h40-0-248" id="h40-0-248" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1},
</a><a href="#h40-0-249" id="h40-0-249" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033Or&quot;,       +1,    0},
</a><a href="#h40-0-250" id="h40-0-250" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1},
</a><a href="#h40-0-251" id="h40-0-251" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1},
</a><a href="#h40-0-252" id="h40-0-252" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033Ot&quot;,       +1,    0},
</a><a href="#h40-0-253" id="h40-0-253" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1},
</a><a href="#h40-0-254" id="h40-0-254" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1},
</a><a href="#h40-0-255" id="h40-0-255" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033Ov&quot;,       +1,    0},
</a><a href="#h40-0-256" id="h40-0-256" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1},
</a><a href="#h40-0-257" id="h40-0-257" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1},
</a><a href="#h40-0-258" id="h40-0-258" class="i">+	{ XK_KP_Prior,      ShiftMask,      &quot;\033[5;2~&quot;,     0,    0},
</a><a href="#h40-0-259" id="h40-0-259" class="i">+	{ XK_KP_Prior,      XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0},
</a><a href="#h40-0-260" id="h40-0-260" class="i">+	{ XK_KP_Begin,      XK_ANY_MOD,     &quot;\033[E&quot;,        0,    0},
</a><a href="#h40-0-261" id="h40-0-261" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[J&quot;,       -1,    0},
</a><a href="#h40-0-262" id="h40-0-262" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[1;5F&quot;,    +1,    0},
</a><a href="#h40-0-263" id="h40-0-263" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[K&quot;,       -1,    0},
</a><a href="#h40-0-264" id="h40-0-264" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0},
</a><a href="#h40-0-265" id="h40-0-265" class="i">+	{ XK_KP_End,        XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0},
</a><a href="#h40-0-266" id="h40-0-266" class="i">+	{ XK_KP_Next,       ShiftMask,      &quot;\033[6;2~&quot;,     0,    0},
</a><a href="#h40-0-267" id="h40-0-267" class="i">+	{ XK_KP_Next,       XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0},
</a><a href="#h40-0-268" id="h40-0-268" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0},
</a><a href="#h40-0-269" id="h40-0-269" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[4l&quot;,      -1,    0},
</a><a href="#h40-0-270" id="h40-0-270" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[L&quot;,       -1,    0},
</a><a href="#h40-0-271" id="h40-0-271" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[2;5~&quot;,    +1,    0},
</a><a href="#h40-0-272" id="h40-0-272" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0},
</a><a href="#h40-0-273" id="h40-0-273" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0},
</a><a href="#h40-0-274" id="h40-0-274" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[M&quot;,       -1,    0},
</a><a href="#h40-0-275" id="h40-0-275" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[3;5~&quot;,    +1,    0},
</a><a href="#h40-0-276" id="h40-0-276" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[2K&quot;,      -1,    0},
</a><a href="#h40-0-277" id="h40-0-277" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0},
</a><a href="#h40-0-278" id="h40-0-278" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0},
</a><a href="#h40-0-279" id="h40-0-279" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0},
</a><a href="#h40-0-280" id="h40-0-280" class="i">+	{ XK_KP_Multiply,   XK_ANY_MOD,     &quot;\033Oj&quot;,       +2,    0},
</a><a href="#h40-0-281" id="h40-0-281" class="i">+	{ XK_KP_Add,        XK_ANY_MOD,     &quot;\033Ok&quot;,       +2,    0},
</a><a href="#h40-0-282" id="h40-0-282" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\033OM&quot;,       +2,    0},
</a><a href="#h40-0-283" id="h40-0-283" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\r&quot;,           -1,    0},
</a><a href="#h40-0-284" id="h40-0-284" class="i">+	{ XK_KP_Subtract,   XK_ANY_MOD,     &quot;\033Om&quot;,       +2,    0},
</a><a href="#h40-0-285" id="h40-0-285" class="i">+	{ XK_KP_Decimal,    XK_ANY_MOD,     &quot;\033On&quot;,       +2,    0},
</a><a href="#h40-0-286" id="h40-0-286" class="i">+	{ XK_KP_Divide,     XK_ANY_MOD,     &quot;\033Oo&quot;,       +2,    0},
</a><a href="#h40-0-287" id="h40-0-287" class="i">+	{ XK_KP_0,          XK_ANY_MOD,     &quot;\033Op&quot;,       +2,    0},
</a><a href="#h40-0-288" id="h40-0-288" class="i">+	{ XK_KP_1,          XK_ANY_MOD,     &quot;\033Oq&quot;,       +2,    0},
</a><a href="#h40-0-289" id="h40-0-289" class="i">+	{ XK_KP_2,          XK_ANY_MOD,     &quot;\033Or&quot;,       +2,    0},
</a><a href="#h40-0-290" id="h40-0-290" class="i">+	{ XK_KP_3,          XK_ANY_MOD,     &quot;\033Os&quot;,       +2,    0},
</a><a href="#h40-0-291" id="h40-0-291" class="i">+	{ XK_KP_4,          XK_ANY_MOD,     &quot;\033Ot&quot;,       +2,    0},
</a><a href="#h40-0-292" id="h40-0-292" class="i">+	{ XK_KP_5,          XK_ANY_MOD,     &quot;\033Ou&quot;,       +2,    0},
</a><a href="#h40-0-293" id="h40-0-293" class="i">+	{ XK_KP_6,          XK_ANY_MOD,     &quot;\033Ov&quot;,       +2,    0},
</a><a href="#h40-0-294" id="h40-0-294" class="i">+	{ XK_KP_7,          XK_ANY_MOD,     &quot;\033Ow&quot;,       +2,    0},
</a><a href="#h40-0-295" id="h40-0-295" class="i">+	{ XK_KP_8,          XK_ANY_MOD,     &quot;\033Ox&quot;,       +2,    0},
</a><a href="#h40-0-296" id="h40-0-296" class="i">+	{ XK_KP_9,          XK_ANY_MOD,     &quot;\033Oy&quot;,       +2,    0},
</a><a href="#h40-0-297" id="h40-0-297" class="i">+	{ XK_Up,            ShiftMask,      &quot;\033[1;2A&quot;,     0,    0},
</a><a href="#h40-0-298" id="h40-0-298" class="i">+	{ XK_Up,            Mod1Mask,       &quot;\033[1;3A&quot;,     0,    0},
</a><a href="#h40-0-299" id="h40-0-299" class="i">+	{ XK_Up,         ShiftMask|Mod1Mask,&quot;\033[1;4A&quot;,     0,    0},
</a><a href="#h40-0-300" id="h40-0-300" class="i">+	{ XK_Up,            ControlMask,    &quot;\033[1;5A&quot;,     0,    0},
</a><a href="#h40-0-301" id="h40-0-301" class="i">+	{ XK_Up,      ShiftMask|ControlMask,&quot;\033[1;6A&quot;,     0,    0},
</a><a href="#h40-0-302" id="h40-0-302" class="i">+	{ XK_Up,       ControlMask|Mod1Mask,&quot;\033[1;7A&quot;,     0,    0},
</a><a href="#h40-0-303" id="h40-0-303" class="i">+	{ XK_Up,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8A&quot;,  0,    0},
</a><a href="#h40-0-304" id="h40-0-304" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1},
</a><a href="#h40-0-305" id="h40-0-305" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1},
</a><a href="#h40-0-306" id="h40-0-306" class="i">+	{ XK_Down,          ShiftMask,      &quot;\033[1;2B&quot;,     0,    0},
</a><a href="#h40-0-307" id="h40-0-307" class="i">+	{ XK_Down,          Mod1Mask,       &quot;\033[1;3B&quot;,     0,    0},
</a><a href="#h40-0-308" id="h40-0-308" class="i">+	{ XK_Down,       ShiftMask|Mod1Mask,&quot;\033[1;4B&quot;,     0,    0},
</a><a href="#h40-0-309" id="h40-0-309" class="i">+	{ XK_Down,          ControlMask,    &quot;\033[1;5B&quot;,     0,    0},
</a><a href="#h40-0-310" id="h40-0-310" class="i">+	{ XK_Down,    ShiftMask|ControlMask,&quot;\033[1;6B&quot;,     0,    0},
</a><a href="#h40-0-311" id="h40-0-311" class="i">+	{ XK_Down,     ControlMask|Mod1Mask,&quot;\033[1;7B&quot;,     0,    0},
</a><a href="#h40-0-312" id="h40-0-312" class="i">+	{ XK_Down,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8B&quot;,0,    0},
</a><a href="#h40-0-313" id="h40-0-313" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1},
</a><a href="#h40-0-314" id="h40-0-314" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1},
</a><a href="#h40-0-315" id="h40-0-315" class="i">+	{ XK_Left,          ShiftMask,      &quot;\033[1;2D&quot;,     0,    0},
</a><a href="#h40-0-316" id="h40-0-316" class="i">+	{ XK_Left,          Mod1Mask,       &quot;\033[1;3D&quot;,     0,    0},
</a><a href="#h40-0-317" id="h40-0-317" class="i">+	{ XK_Left,       ShiftMask|Mod1Mask,&quot;\033[1;4D&quot;,     0,    0},
</a><a href="#h40-0-318" id="h40-0-318" class="i">+	{ XK_Left,          ControlMask,    &quot;\033[1;5D&quot;,     0,    0},
</a><a href="#h40-0-319" id="h40-0-319" class="i">+	{ XK_Left,    ShiftMask|ControlMask,&quot;\033[1;6D&quot;,     0,    0},
</a><a href="#h40-0-320" id="h40-0-320" class="i">+	{ XK_Left,     ControlMask|Mod1Mask,&quot;\033[1;7D&quot;,     0,    0},
</a><a href="#h40-0-321" id="h40-0-321" class="i">+	{ XK_Left,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8D&quot;,0,    0},
</a><a href="#h40-0-322" id="h40-0-322" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1},
</a><a href="#h40-0-323" id="h40-0-323" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1},
</a><a href="#h40-0-324" id="h40-0-324" class="i">+	{ XK_Right,         ShiftMask,      &quot;\033[1;2C&quot;,     0,    0},
</a><a href="#h40-0-325" id="h40-0-325" class="i">+	{ XK_Right,         Mod1Mask,       &quot;\033[1;3C&quot;,     0,    0},
</a><a href="#h40-0-326" id="h40-0-326" class="i">+	{ XK_Right,      ShiftMask|Mod1Mask,&quot;\033[1;4C&quot;,     0,    0},
</a><a href="#h40-0-327" id="h40-0-327" class="i">+	{ XK_Right,         ControlMask,    &quot;\033[1;5C&quot;,     0,    0},
</a><a href="#h40-0-328" id="h40-0-328" class="i">+	{ XK_Right,   ShiftMask|ControlMask,&quot;\033[1;6C&quot;,     0,    0},
</a><a href="#h40-0-329" id="h40-0-329" class="i">+	{ XK_Right,    ControlMask|Mod1Mask,&quot;\033[1;7C&quot;,     0,    0},
</a><a href="#h40-0-330" id="h40-0-330" class="i">+	{ XK_Right,ShiftMask|ControlMask|Mod1Mask,&quot;\033[1;8C&quot;,0,   0},
</a><a href="#h40-0-331" id="h40-0-331" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1},
</a><a href="#h40-0-332" id="h40-0-332" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1},
</a><a href="#h40-0-333" id="h40-0-333" class="i">+	{ XK_ISO_Left_Tab,  ShiftMask,      &quot;\033[Z&quot;,        0,    0},
</a><a href="#h40-0-334" id="h40-0-334" class="i">+	{ XK_Return,        Mod1Mask,       &quot;\033\r&quot;,        0,    0},
</a><a href="#h40-0-335" id="h40-0-335" class="i">+	{ XK_Return,        XK_ANY_MOD,     &quot;\r&quot;,            0,    0},
</a><a href="#h40-0-336" id="h40-0-336" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[4l&quot;,      -1,    0},
</a><a href="#h40-0-337" id="h40-0-337" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0},
</a><a href="#h40-0-338" id="h40-0-338" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[L&quot;,       -1,    0},
</a><a href="#h40-0-339" id="h40-0-339" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[2;5~&quot;,    +1,    0},
</a><a href="#h40-0-340" id="h40-0-340" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0},
</a><a href="#h40-0-341" id="h40-0-341" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0},
</a><a href="#h40-0-342" id="h40-0-342" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[M&quot;,       -1,    0},
</a><a href="#h40-0-343" id="h40-0-343" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[3;5~&quot;,    +1,    0},
</a><a href="#h40-0-344" id="h40-0-344" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[2K&quot;,      -1,    0},
</a><a href="#h40-0-345" id="h40-0-345" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0},
</a><a href="#h40-0-346" id="h40-0-346" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0},
</a><a href="#h40-0-347" id="h40-0-347" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0},
</a><a href="#h40-0-348" id="h40-0-348" class="i">+	{ XK_BackSpace,     XK_NO_MOD,      &quot;\177&quot;,          0,    0},
</a><a href="#h40-0-349" id="h40-0-349" class="i">+	{ XK_BackSpace,     Mod1Mask,       &quot;\033\177&quot;,      0,    0},
</a><a href="#h40-0-350" id="h40-0-350" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[2J&quot;,       0,   -1},
</a><a href="#h40-0-351" id="h40-0-351" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1},
</a><a href="#h40-0-352" id="h40-0-352" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1},
</a><a href="#h40-0-353" id="h40-0-353" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1},
</a><a href="#h40-0-354" id="h40-0-354" class="i">+	{ XK_End,           ControlMask,    &quot;\033[J&quot;,       -1,    0},
</a><a href="#h40-0-355" id="h40-0-355" class="i">+	{ XK_End,           ControlMask,    &quot;\033[1;5F&quot;,    +1,    0},
</a><a href="#h40-0-356" id="h40-0-356" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[K&quot;,       -1,    0},
</a><a href="#h40-0-357" id="h40-0-357" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0},
</a><a href="#h40-0-358" id="h40-0-358" class="i">+	{ XK_End,           XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0},
</a><a href="#h40-0-359" id="h40-0-359" class="i">+	{ XK_Prior,         ControlMask,    &quot;\033[5;5~&quot;,     0,    0},
</a><a href="#h40-0-360" id="h40-0-360" class="i">+	{ XK_Prior,         ShiftMask,      &quot;\033[5;2~&quot;,     0,    0},
</a><a href="#h40-0-361" id="h40-0-361" class="i">+	{ XK_Prior,         XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0},
</a><a href="#h40-0-362" id="h40-0-362" class="i">+	{ XK_Next,          ControlMask,    &quot;\033[6;5~&quot;,     0,    0},
</a><a href="#h40-0-363" id="h40-0-363" class="i">+	{ XK_Next,          ShiftMask,      &quot;\033[6;2~&quot;,     0,    0},
</a><a href="#h40-0-364" id="h40-0-364" class="i">+	{ XK_Next,          XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0},
</a><a href="#h40-0-365" id="h40-0-365" class="i">+	{ XK_F1,            XK_NO_MOD,      &quot;\033OP&quot; ,       0,    0},
</a><a href="#h40-0-366" id="h40-0-366" class="i">+	{ XK_F1, /* F13 */  ShiftMask,      &quot;\033[1;2P&quot;,     0,    0},
</a><a href="#h40-0-367" id="h40-0-367" class="i">+	{ XK_F1, /* F25 */  ControlMask,    &quot;\033[1;5P&quot;,     0,    0},
</a><a href="#h40-0-368" id="h40-0-368" class="i">+	{ XK_F1, /* F37 */  Mod4Mask,       &quot;\033[1;6P&quot;,     0,    0},
</a><a href="#h40-0-369" id="h40-0-369" class="i">+	{ XK_F1, /* F49 */  Mod1Mask,       &quot;\033[1;3P&quot;,     0,    0},
</a><a href="#h40-0-370" id="h40-0-370" class="i">+	{ XK_F1, /* F61 */  Mod3Mask,       &quot;\033[1;4P&quot;,     0,    0},
</a><a href="#h40-0-371" id="h40-0-371" class="i">+	{ XK_F2,            XK_NO_MOD,      &quot;\033OQ&quot; ,       0,    0},
</a><a href="#h40-0-372" id="h40-0-372" class="i">+	{ XK_F2, /* F14 */  ShiftMask,      &quot;\033[1;2Q&quot;,     0,    0},
</a><a href="#h40-0-373" id="h40-0-373" class="i">+	{ XK_F2, /* F26 */  ControlMask,    &quot;\033[1;5Q&quot;,     0,    0},
</a><a href="#h40-0-374" id="h40-0-374" class="i">+	{ XK_F2, /* F38 */  Mod4Mask,       &quot;\033[1;6Q&quot;,     0,    0},
</a><a href="#h40-0-375" id="h40-0-375" class="i">+	{ XK_F2, /* F50 */  Mod1Mask,       &quot;\033[1;3Q&quot;,     0,    0},
</a><a href="#h40-0-376" id="h40-0-376" class="i">+	{ XK_F2, /* F62 */  Mod3Mask,       &quot;\033[1;4Q&quot;,     0,    0},
</a><a href="#h40-0-377" id="h40-0-377" class="i">+	{ XK_F3,            XK_NO_MOD,      &quot;\033OR&quot; ,       0,    0},
</a><a href="#h40-0-378" id="h40-0-378" class="i">+	{ XK_F3, /* F15 */  ShiftMask,      &quot;\033[1;2R&quot;,     0,    0},
</a><a href="#h40-0-379" id="h40-0-379" class="i">+	{ XK_F3, /* F27 */  ControlMask,    &quot;\033[1;5R&quot;,     0,    0},
</a><a href="#h40-0-380" id="h40-0-380" class="i">+	{ XK_F3, /* F39 */  Mod4Mask,       &quot;\033[1;6R&quot;,     0,    0},
</a><a href="#h40-0-381" id="h40-0-381" class="i">+	{ XK_F3, /* F51 */  Mod1Mask,       &quot;\033[1;3R&quot;,     0,    0},
</a><a href="#h40-0-382" id="h40-0-382" class="i">+	{ XK_F3, /* F63 */  Mod3Mask,       &quot;\033[1;4R&quot;,     0,    0},
</a><a href="#h40-0-383" id="h40-0-383" class="i">+	{ XK_F4,            XK_NO_MOD,      &quot;\033OS&quot; ,       0,    0},
</a><a href="#h40-0-384" id="h40-0-384" class="i">+	{ XK_F4, /* F16 */  ShiftMask,      &quot;\033[1;2S&quot;,     0,    0},
</a><a href="#h40-0-385" id="h40-0-385" class="i">+	{ XK_F4, /* F28 */  ControlMask,    &quot;\033[1;5S&quot;,     0,    0},
</a><a href="#h40-0-386" id="h40-0-386" class="i">+	{ XK_F4, /* F40 */  Mod4Mask,       &quot;\033[1;6S&quot;,     0,    0},
</a><a href="#h40-0-387" id="h40-0-387" class="i">+	{ XK_F4, /* F52 */  Mod1Mask,       &quot;\033[1;3S&quot;,     0,    0},
</a><a href="#h40-0-388" id="h40-0-388" class="i">+	{ XK_F5,            XK_NO_MOD,      &quot;\033[15~&quot;,      0,    0},
</a><a href="#h40-0-389" id="h40-0-389" class="i">+	{ XK_F5, /* F17 */  ShiftMask,      &quot;\033[15;2~&quot;,    0,    0},
</a><a href="#h40-0-390" id="h40-0-390" class="i">+	{ XK_F5, /* F29 */  ControlMask,    &quot;\033[15;5~&quot;,    0,    0},
</a><a href="#h40-0-391" id="h40-0-391" class="i">+	{ XK_F5, /* F41 */  Mod4Mask,       &quot;\033[15;6~&quot;,    0,    0},
</a><a href="#h40-0-392" id="h40-0-392" class="i">+	{ XK_F5, /* F53 */  Mod1Mask,       &quot;\033[15;3~&quot;,    0,    0},
</a><a href="#h40-0-393" id="h40-0-393" class="i">+	{ XK_F6,            XK_NO_MOD,      &quot;\033[17~&quot;,      0,    0},
</a><a href="#h40-0-394" id="h40-0-394" class="i">+	{ XK_F6, /* F18 */  ShiftMask,      &quot;\033[17;2~&quot;,    0,    0},
</a><a href="#h40-0-395" id="h40-0-395" class="i">+	{ XK_F6, /* F30 */  ControlMask,    &quot;\033[17;5~&quot;,    0,    0},
</a><a href="#h40-0-396" id="h40-0-396" class="i">+	{ XK_F6, /* F42 */  Mod4Mask,       &quot;\033[17;6~&quot;,    0,    0},
</a><a href="#h40-0-397" id="h40-0-397" class="i">+	{ XK_F6, /* F54 */  Mod1Mask,       &quot;\033[17;3~&quot;,    0,    0},
</a><a href="#h40-0-398" id="h40-0-398" class="i">+	{ XK_F7,            XK_NO_MOD,      &quot;\033[18~&quot;,      0,    0},
</a><a href="#h40-0-399" id="h40-0-399" class="i">+	{ XK_F7, /* F19 */  ShiftMask,      &quot;\033[18;2~&quot;,    0,    0},
</a><a href="#h40-0-400" id="h40-0-400" class="i">+	{ XK_F7, /* F31 */  ControlMask,    &quot;\033[18;5~&quot;,    0,    0},
</a><a href="#h40-0-401" id="h40-0-401" class="i">+	{ XK_F7, /* F43 */  Mod4Mask,       &quot;\033[18;6~&quot;,    0,    0},
</a><a href="#h40-0-402" id="h40-0-402" class="i">+	{ XK_F7, /* F55 */  Mod1Mask,       &quot;\033[18;3~&quot;,    0,    0},
</a><a href="#h40-0-403" id="h40-0-403" class="i">+	{ XK_F8,            XK_NO_MOD,      &quot;\033[19~&quot;,      0,    0},
</a><a href="#h40-0-404" id="h40-0-404" class="i">+	{ XK_F8, /* F20 */  ShiftMask,      &quot;\033[19;2~&quot;,    0,    0},
</a><a href="#h40-0-405" id="h40-0-405" class="i">+	{ XK_F8, /* F32 */  ControlMask,    &quot;\033[19;5~&quot;,    0,    0},
</a><a href="#h40-0-406" id="h40-0-406" class="i">+	{ XK_F8, /* F44 */  Mod4Mask,       &quot;\033[19;6~&quot;,    0,    0},
</a><a href="#h40-0-407" id="h40-0-407" class="i">+	{ XK_F8, /* F56 */  Mod1Mask,       &quot;\033[19;3~&quot;,    0,    0},
</a><a href="#h40-0-408" id="h40-0-408" class="i">+	{ XK_F9,            XK_NO_MOD,      &quot;\033[20~&quot;,      0,    0},
</a><a href="#h40-0-409" id="h40-0-409" class="i">+	{ XK_F9, /* F21 */  ShiftMask,      &quot;\033[20;2~&quot;,    0,    0},
</a><a href="#h40-0-410" id="h40-0-410" class="i">+	{ XK_F9, /* F33 */  ControlMask,    &quot;\033[20;5~&quot;,    0,    0},
</a><a href="#h40-0-411" id="h40-0-411" class="i">+	{ XK_F9, /* F45 */  Mod4Mask,       &quot;\033[20;6~&quot;,    0,    0},
</a><a href="#h40-0-412" id="h40-0-412" class="i">+	{ XK_F9, /* F57 */  Mod1Mask,       &quot;\033[20;3~&quot;,    0,    0},
</a><a href="#h40-0-413" id="h40-0-413" class="i">+	{ XK_F10,           XK_NO_MOD,      &quot;\033[21~&quot;,      0,    0},
</a><a href="#h40-0-414" id="h40-0-414" class="i">+	{ XK_F10, /* F22 */ ShiftMask,      &quot;\033[21;2~&quot;,    0,    0},
</a><a href="#h40-0-415" id="h40-0-415" class="i">+	{ XK_F10, /* F34 */ ControlMask,    &quot;\033[21;5~&quot;,    0,    0},
</a><a href="#h40-0-416" id="h40-0-416" class="i">+	{ XK_F10, /* F46 */ Mod4Mask,       &quot;\033[21;6~&quot;,    0,    0},
</a><a href="#h40-0-417" id="h40-0-417" class="i">+	{ XK_F10, /* F58 */ Mod1Mask,       &quot;\033[21;3~&quot;,    0,    0},
</a><a href="#h40-0-418" id="h40-0-418" class="i">+	{ XK_F11,           XK_NO_MOD,      &quot;\033[23~&quot;,      0,    0},
</a><a href="#h40-0-419" id="h40-0-419" class="i">+	{ XK_F11, /* F23 */ ShiftMask,      &quot;\033[23;2~&quot;,    0,    0},
</a><a href="#h40-0-420" id="h40-0-420" class="i">+	{ XK_F11, /* F35 */ ControlMask,    &quot;\033[23;5~&quot;,    0,    0},
</a><a href="#h40-0-421" id="h40-0-421" class="i">+	{ XK_F11, /* F47 */ Mod4Mask,       &quot;\033[23;6~&quot;,    0,    0},
</a><a href="#h40-0-422" id="h40-0-422" class="i">+	{ XK_F11, /* F59 */ Mod1Mask,       &quot;\033[23;3~&quot;,    0,    0},
</a><a href="#h40-0-423" id="h40-0-423" class="i">+	{ XK_F12,           XK_NO_MOD,      &quot;\033[24~&quot;,      0,    0},
</a><a href="#h40-0-424" id="h40-0-424" class="i">+	{ XK_F12, /* F24 */ ShiftMask,      &quot;\033[24;2~&quot;,    0,    0},
</a><a href="#h40-0-425" id="h40-0-425" class="i">+	{ XK_F12, /* F36 */ ControlMask,    &quot;\033[24;5~&quot;,    0,    0},
</a><a href="#h40-0-426" id="h40-0-426" class="i">+	{ XK_F12, /* F48 */ Mod4Mask,       &quot;\033[24;6~&quot;,    0,    0},
</a><a href="#h40-0-427" id="h40-0-427" class="i">+	{ XK_F12, /* F60 */ Mod1Mask,       &quot;\033[24;3~&quot;,    0,    0},
</a><a href="#h40-0-428" id="h40-0-428" class="i">+	{ XK_F13,           XK_NO_MOD,      &quot;\033[1;2P&quot;,     0,    0},
</a><a href="#h40-0-429" id="h40-0-429" class="i">+	{ XK_F14,           XK_NO_MOD,      &quot;\033[1;2Q&quot;,     0,    0},
</a><a href="#h40-0-430" id="h40-0-430" class="i">+	{ XK_F15,           XK_NO_MOD,      &quot;\033[1;2R&quot;,     0,    0},
</a><a href="#h40-0-431" id="h40-0-431" class="i">+	{ XK_F16,           XK_NO_MOD,      &quot;\033[1;2S&quot;,     0,    0},
</a><a href="#h40-0-432" id="h40-0-432" class="i">+	{ XK_F17,           XK_NO_MOD,      &quot;\033[15;2~&quot;,    0,    0},
</a><a href="#h40-0-433" id="h40-0-433" class="i">+	{ XK_F18,           XK_NO_MOD,      &quot;\033[17;2~&quot;,    0,    0},
</a><a href="#h40-0-434" id="h40-0-434" class="i">+	{ XK_F19,           XK_NO_MOD,      &quot;\033[18;2~&quot;,    0,    0},
</a><a href="#h40-0-435" id="h40-0-435" class="i">+	{ XK_F20,           XK_NO_MOD,      &quot;\033[19;2~&quot;,    0,    0},
</a><a href="#h40-0-436" id="h40-0-436" class="i">+	{ XK_F21,           XK_NO_MOD,      &quot;\033[20;2~&quot;,    0,    0},
</a><a href="#h40-0-437" id="h40-0-437" class="i">+	{ XK_F22,           XK_NO_MOD,      &quot;\033[21;2~&quot;,    0,    0},
</a><a href="#h40-0-438" id="h40-0-438" class="i">+	{ XK_F23,           XK_NO_MOD,      &quot;\033[23;2~&quot;,    0,    0},
</a><a href="#h40-0-439" id="h40-0-439" class="i">+	{ XK_F24,           XK_NO_MOD,      &quot;\033[24;2~&quot;,    0,    0},
</a><a href="#h40-0-440" id="h40-0-440" class="i">+	{ XK_F25,           XK_NO_MOD,      &quot;\033[1;5P&quot;,     0,    0},
</a><a href="#h40-0-441" id="h40-0-441" class="i">+	{ XK_F26,           XK_NO_MOD,      &quot;\033[1;5Q&quot;,     0,    0},
</a><a href="#h40-0-442" id="h40-0-442" class="i">+	{ XK_F27,           XK_NO_MOD,      &quot;\033[1;5R&quot;,     0,    0},
</a><a href="#h40-0-443" id="h40-0-443" class="i">+	{ XK_F28,           XK_NO_MOD,      &quot;\033[1;5S&quot;,     0,    0},
</a><a href="#h40-0-444" id="h40-0-444" class="i">+	{ XK_F29,           XK_NO_MOD,      &quot;\033[15;5~&quot;,    0,    0},
</a><a href="#h40-0-445" id="h40-0-445" class="i">+	{ XK_F30,           XK_NO_MOD,      &quot;\033[17;5~&quot;,    0,    0},
</a><a href="#h40-0-446" id="h40-0-446" class="i">+	{ XK_F31,           XK_NO_MOD,      &quot;\033[18;5~&quot;,    0,    0},
</a><a href="#h40-0-447" id="h40-0-447" class="i">+	{ XK_F32,           XK_NO_MOD,      &quot;\033[19;5~&quot;,    0,    0},
</a><a href="#h40-0-448" id="h40-0-448" class="i">+	{ XK_F33,           XK_NO_MOD,      &quot;\033[20;5~&quot;,    0,    0},
</a><a href="#h40-0-449" id="h40-0-449" class="i">+	{ XK_F34,           XK_NO_MOD,      &quot;\033[21;5~&quot;,    0,    0},
</a><a href="#h40-0-450" id="h40-0-450" class="i">+	{ XK_F35,           XK_NO_MOD,      &quot;\033[23;5~&quot;,    0,    0},
</a><a href="#h40-0-451" id="h40-0-451" class="i">+};
</a><a href="#h40-0-452" id="h40-0-452" class="i">+
</a><a href="#h40-0-453" id="h40-0-453" class="i">+/*
</a><a href="#h40-0-454" id="h40-0-454" class="i">+ * Selection types&#39; masks.
</a><a href="#h40-0-455" id="h40-0-455" class="i">+ * Use the same masks as usual.
</a><a href="#h40-0-456" id="h40-0-456" class="i">+ * Button1Mask is always unset, to make masks match between ButtonPress.
</a><a href="#h40-0-457" id="h40-0-457" class="i">+ * ButtonRelease and MotionNotify.
</a><a href="#h40-0-458" id="h40-0-458" class="i">+ * If no match is found, regular selection is used.
</a><a href="#h40-0-459" id="h40-0-459" class="i">+ */
</a><a href="#h40-0-460" id="h40-0-460" class="i">+static uint selmasks[] = {
</a><a href="#h40-0-461" id="h40-0-461" class="i">+	[SEL_RECTANGULAR] = Mod1Mask,
</a><a href="#h40-0-462" id="h40-0-462" class="i">+};
</a><a href="#h40-0-463" id="h40-0-463" class="i">+
</a><a href="#h40-0-464" id="h40-0-464" class="i">+/*
</a><a href="#h40-0-465" id="h40-0-465" class="i">+ * Printable characters in ASCII, used to estimate the advance width
</a><a href="#h40-0-466" id="h40-0-466" class="i">+ * of single wide characters.
</a><a href="#h40-0-467" id="h40-0-467" class="i">+ */
</a><a href="#h40-0-468" id="h40-0-468" class="i">+static char ascii_printable[] =
</a><a href="#h40-0-469" id="h40-0-469" class="i">+	&quot; !\&quot;#$%&amp;&#39;()*+,-./0123456789:;&lt;=&gt;?&quot;
</a><a href="#h40-0-470" id="h40-0-470" class="i">+	&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_&quot;
</a><a href="#h40-0-471" id="h40-0-471" class="i">+	&quot;`abcdefghijklmnopqrstuvwxyz{|}~&quot;;
</a><b>diff --git a/<a id="h41" href="../file/st/config.mk.html">st/config.mk</a> b/<a href="../file/st/config.mk.html">st/config.mk</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -0,0 +1,35 @@
</a><a href="#h41-0-0" id="h41-0-0" class="i">+# st version
</a><a href="#h41-0-1" id="h41-0-1" class="i">+VERSION = 0.8.2
</a><a href="#h41-0-2" id="h41-0-2" class="i">+
</a><a href="#h41-0-3" id="h41-0-3" class="i">+# Customize below to fit your system
</a><a href="#h41-0-4" id="h41-0-4" class="i">+
</a><a href="#h41-0-5" id="h41-0-5" class="i">+# paths
</a><a href="#h41-0-6" id="h41-0-6" class="i">+PREFIX = /usr/local
</a><a href="#h41-0-7" id="h41-0-7" class="i">+MANPREFIX = $(PREFIX)/share/man
</a><a href="#h41-0-8" id="h41-0-8" class="i">+
</a><a href="#h41-0-9" id="h41-0-9" class="i">+X11INC = /usr/X11R6/include
</a><a href="#h41-0-10" id="h41-0-10" class="i">+X11LIB = /usr/X11R6/lib
</a><a href="#h41-0-11" id="h41-0-11" class="i">+
</a><a href="#h41-0-12" id="h41-0-12" class="i">+PKG_CONFIG = pkg-config
</a><a href="#h41-0-13" id="h41-0-13" class="i">+
</a><a href="#h41-0-14" id="h41-0-14" class="i">+# includes and libs
</a><a href="#h41-0-15" id="h41-0-15" class="i">+INCS = -I. -I/usr/include -I${X11INC} \
</a><a href="#h41-0-16" id="h41-0-16" class="i">+       `$(PKG_CONFIG) --cflags fontconfig` \
</a><a href="#h41-0-17" id="h41-0-17" class="i">+       `$(PKG_CONFIG) --cflags freetype2`
</a><a href="#h41-0-18" id="h41-0-18" class="i">+LIBS = -L/usr/lib -lc -L${X11LIB} -lm -lrt -lX11 -lutil -lXft -lXrender\
</a><a href="#h41-0-19" id="h41-0-19" class="i">+       `$(PKG_CONFIG) --libs fontconfig` \
</a><a href="#h41-0-20" id="h41-0-20" class="i">+       `$(PKG_CONFIG) --libs freetype2`
</a><a href="#h41-0-21" id="h41-0-21" class="i">+
</a><a href="#h41-0-22" id="h41-0-22" class="i">+# flags
</a><a href="#h41-0-23" id="h41-0-23" class="i">+STCPPFLAGS = -DVERSION=\&quot;$(VERSION)\&quot; -D_XOPEN_SOURCE=600
</a><a href="#h41-0-24" id="h41-0-24" class="i">+STCFLAGS = $(INCS) $(STCPPFLAGS) $(CPPFLAGS) $(CFLAGS)
</a><a href="#h41-0-25" id="h41-0-25" class="i">+STLDFLAGS = $(LIBS) $(LDFLAGS)
</a><a href="#h41-0-26" id="h41-0-26" class="i">+
</a><a href="#h41-0-27" id="h41-0-27" class="i">+# OpenBSD:
</a><a href="#h41-0-28" id="h41-0-28" class="i">+#CPPFLAGS = -DVERSION=\&quot;$(VERSION)\&quot; -D_XOPEN_SOURCE=600 -D_BSD_SOURCE
</a><a href="#h41-0-29" id="h41-0-29" class="i">+#LIBS = -L$(X11LIB) -lm -lX11 -lutil -lXft \
</a><a href="#h41-0-30" id="h41-0-30" class="i">+#       `pkg-config --libs fontconfig` \
</a><a href="#h41-0-31" id="h41-0-31" class="i">+#       `pkg-config --libs freetype2`
</a><a href="#h41-0-32" id="h41-0-32" class="i">+
</a><a href="#h41-0-33" id="h41-0-33" class="i">+# compiler and linker
</a><a href="#h41-0-34" id="h41-0-34" class="i">+# CC = c99
</a><b>diff --git a/<a id="h42" href="../file/st/st.html">st/st</a> b/<a href="../file/st/st.html">st/st</a></b>
Binary files differ.
<b>diff --git a/<a id="h43" href="../file/st/st-alpha-20190116-3be4cf1.diff.html">st/st-alpha-20190116-3be4cf1.diff</a> b/<a href="../file/st/st-alpha-20190116-3be4cf1.diff.html">st/st-alpha-20190116-3be4cf1.diff</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -0,0 +1,200 @@
</a><a href="#h43-0-0" id="h43-0-0" class="i">+diff --git a/config.def.h b/config.def.h
</a><a href="#h43-0-1" id="h43-0-1" class="i">+index 0e01717..007fbd4 100644
</a><a href="#h43-0-2" id="h43-0-2" class="i">+--- a/config.def.h
</a><a href="#h43-0-3" id="h43-0-3" class="i">++++ b/config.def.h
</a><a href="#h43-0-4" id="h43-0-4" class="i">+@@ -82,6 +82,9 @@ char *termname = &quot;st-256color&quot;;
</a><a href="#h43-0-5" id="h43-0-5" class="i">+  */
</a><a href="#h43-0-6" id="h43-0-6" class="i">+ unsigned int tabspaces = 8;
</a><a href="#h43-0-7" id="h43-0-7" class="i">+ 
</a><a href="#h43-0-8" id="h43-0-8" class="i">++/* bg opacity */
</a><a href="#h43-0-9" id="h43-0-9" class="i">++unsigned int alpha = 0xcc;
</a><a href="#h43-0-10" id="h43-0-10" class="i">++
</a><a href="#h43-0-11" id="h43-0-11" class="i">+ /* Terminal colors (16 first used in escape sequence) */
</a><a href="#h43-0-12" id="h43-0-12" class="i">+ static const char *colorname[] = {
</a><a href="#h43-0-13" id="h43-0-13" class="i">+ 	/* 8 normal colors */
</a><a href="#h43-0-14" id="h43-0-14" class="i">+@@ -109,6 +112,7 @@ static const char *colorname[] = {
</a><a href="#h43-0-15" id="h43-0-15" class="i">+ 	/* more colors can be added after 255 to use with DefaultXX */
</a><a href="#h43-0-16" id="h43-0-16" class="i">+ 	&quot;#cccccc&quot;,
</a><a href="#h43-0-17" id="h43-0-17" class="i">+ 	&quot;#555555&quot;,
</a><a href="#h43-0-18" id="h43-0-18" class="i">++	&quot;black&quot;,
</a><a href="#h43-0-19" id="h43-0-19" class="i">+ };
</a><a href="#h43-0-20" id="h43-0-20" class="i">+ 
</a><a href="#h43-0-21" id="h43-0-21" class="i">+ 
</a><a href="#h43-0-22" id="h43-0-22" class="i">+@@ -117,7 +121,7 @@ static const char *colorname[] = {
</a><a href="#h43-0-23" id="h43-0-23" class="i">+  * foreground, background, cursor, reverse cursor
</a><a href="#h43-0-24" id="h43-0-24" class="i">+  */
</a><a href="#h43-0-25" id="h43-0-25" class="i">+ unsigned int defaultfg = 7;
</a><a href="#h43-0-26" id="h43-0-26" class="i">+-unsigned int defaultbg = 0;
</a><a href="#h43-0-27" id="h43-0-27" class="i">++unsigned int defaultbg = 257;
</a><a href="#h43-0-28" id="h43-0-28" class="i">+ static unsigned int defaultcs = 256;
</a><a href="#h43-0-29" id="h43-0-29" class="i">+ static unsigned int defaultrcs = 257;
</a><a href="#h43-0-30" id="h43-0-30" class="i">+ 
</a><a href="#h43-0-31" id="h43-0-31" class="i">+diff --git a/config.mk b/config.mk
</a><a href="#h43-0-32" id="h43-0-32" class="i">+index 5059632..1844c14 100644
</a><a href="#h43-0-33" id="h43-0-33" class="i">+--- a/config.mk
</a><a href="#h43-0-34" id="h43-0-34" class="i">++++ b/config.mk
</a><a href="#h43-0-35" id="h43-0-35" class="i">+@@ -13,10 +13,10 @@ X11LIB = /usr/X11R6/lib
</a><a href="#h43-0-36" id="h43-0-36" class="i">+ PKG_CONFIG = pkg-config
</a><a href="#h43-0-37" id="h43-0-37" class="i">+ 
</a><a href="#h43-0-38" id="h43-0-38" class="i">+ # includes and libs
</a><a href="#h43-0-39" id="h43-0-39" class="i">+-INCS = -I$(X11INC) \
</a><a href="#h43-0-40" id="h43-0-40" class="i">++INCS = -I. -I/usr/include -I${X11INC} \
</a><a href="#h43-0-41" id="h43-0-41" class="i">+        `$(PKG_CONFIG) --cflags fontconfig` \
</a><a href="#h43-0-42" id="h43-0-42" class="i">+        `$(PKG_CONFIG) --cflags freetype2`
</a><a href="#h43-0-43" id="h43-0-43" class="i">+-LIBS = -L$(X11LIB) -lm -lrt -lX11 -lutil -lXft \
</a><a href="#h43-0-44" id="h43-0-44" class="i">++LIBS = -L/usr/lib -lc -L${X11LIB} -lm -lrt -lX11 -lutil -lXft -lXrender\
</a><a href="#h43-0-45" id="h43-0-45" class="i">+        `$(PKG_CONFIG) --libs fontconfig` \
</a><a href="#h43-0-46" id="h43-0-46" class="i">+        `$(PKG_CONFIG) --libs freetype2`
</a><a href="#h43-0-47" id="h43-0-47" class="i">+ 
</a><a href="#h43-0-48" id="h43-0-48" class="i">+diff --git a/st.h b/st.h
</a><a href="#h43-0-49" id="h43-0-49" class="i">+index 38c61c4..935a9d3 100644
</a><a href="#h43-0-50" id="h43-0-50" class="i">+--- a/st.h
</a><a href="#h43-0-51" id="h43-0-51" class="i">++++ b/st.h
</a><a href="#h43-0-52" id="h43-0-52" class="i">+@@ -118,5 +118,6 @@ extern char *worddelimiters;
</a><a href="#h43-0-53" id="h43-0-53" class="i">+ extern int allowaltscreen;
</a><a href="#h43-0-54" id="h43-0-54" class="i">+ extern char *termname;
</a><a href="#h43-0-55" id="h43-0-55" class="i">+ extern unsigned int tabspaces;
</a><a href="#h43-0-56" id="h43-0-56" class="i">++extern unsigned int alpha;
</a><a href="#h43-0-57" id="h43-0-57" class="i">+ extern unsigned int defaultfg;
</a><a href="#h43-0-58" id="h43-0-58" class="i">+ extern unsigned int defaultbg;
</a><a href="#h43-0-59" id="h43-0-59" class="i">+diff --git a/x.c b/x.c
</a><a href="#h43-0-60" id="h43-0-60" class="i">+index 0422421..441bada 100644
</a><a href="#h43-0-61" id="h43-0-61" class="i">+--- a/x.c
</a><a href="#h43-0-62" id="h43-0-62" class="i">++++ b/x.c
</a><a href="#h43-0-63" id="h43-0-63" class="i">+@@ -48,6 +48,10 @@ typedef struct {
</a><a href="#h43-0-64" id="h43-0-64" class="i">+ #define XK_NO_MOD     0
</a><a href="#h43-0-65" id="h43-0-65" class="i">+ #define XK_SWITCH_MOD (1&lt;&lt;13)
</a><a href="#h43-0-66" id="h43-0-66" class="i">+ 
</a><a href="#h43-0-67" id="h43-0-67" class="i">++/* alpha */
</a><a href="#h43-0-68" id="h43-0-68" class="i">++#define OPAQUE 0Xff
</a><a href="#h43-0-69" id="h43-0-69" class="i">++#define USE_ARGB (alpha != OPAQUE &amp;&amp; opt_embed == NULL)
</a><a href="#h43-0-70" id="h43-0-70" class="i">++
</a><a href="#h43-0-71" id="h43-0-71" class="i">+ /* function definitions used in config.h */
</a><a href="#h43-0-72" id="h43-0-72" class="i">+ static void clipcopy(const Arg *);
</a><a href="#h43-0-73" id="h43-0-73" class="i">+ static void clippaste(const Arg *);
</a><a href="#h43-0-74" id="h43-0-74" class="i">+@@ -98,6 +102,7 @@ typedef struct {
</a><a href="#h43-0-75" id="h43-0-75" class="i">+ 	XSetWindowAttributes attrs;
</a><a href="#h43-0-76" id="h43-0-76" class="i">+ 	int scr;
</a><a href="#h43-0-77" id="h43-0-77" class="i">+ 	int isfixed; /* is fixed geometry? */
</a><a href="#h43-0-78" id="h43-0-78" class="i">++	int depth; /* bit depth */
</a><a href="#h43-0-79" id="h43-0-79" class="i">+ 	int l, t; /* left and top offset */
</a><a href="#h43-0-80" id="h43-0-80" class="i">+ 	int gm; /* geometry mask */
</a><a href="#h43-0-81" id="h43-0-81" class="i">+ } XWindow;
</a><a href="#h43-0-82" id="h43-0-82" class="i">+@@ -688,7 +693,7 @@ xresize(int col, int row)
</a><a href="#h43-0-83" id="h43-0-83" class="i">+ 
</a><a href="#h43-0-84" id="h43-0-84" class="i">+ 	XFreePixmap(xw.dpy, xw.buf);
</a><a href="#h43-0-85" id="h43-0-85" class="i">+ 	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h,
</a><a href="#h43-0-86" id="h43-0-86" class="i">+-			DefaultDepth(xw.dpy, xw.scr));
</a><a href="#h43-0-87" id="h43-0-87" class="i">++			xw.depth);
</a><a href="#h43-0-88" id="h43-0-88" class="i">+ 	XftDrawChange(xw.draw, xw.buf);
</a><a href="#h43-0-89" id="h43-0-89" class="i">+ 	xclear(0, 0, win.w, win.h);
</a><a href="#h43-0-90" id="h43-0-90" class="i">+ 
</a><a href="#h43-0-91" id="h43-0-91" class="i">+@@ -748,6 +753,14 @@ xloadcols(void)
</a><a href="#h43-0-92" id="h43-0-92" class="i">+ 			else
</a><a href="#h43-0-93" id="h43-0-93" class="i">+ 				die(&quot;could not allocate color %d\n&quot;, i);
</a><a href="#h43-0-94" id="h43-0-94" class="i">+ 		}
</a><a href="#h43-0-95" id="h43-0-95" class="i">++
</a><a href="#h43-0-96" id="h43-0-96" class="i">++	/* set alpha value of bg color */
</a><a href="#h43-0-97" id="h43-0-97" class="i">++	if (USE_ARGB) {
</a><a href="#h43-0-98" id="h43-0-98" class="i">++		dc.col[defaultbg].color.alpha = alpha &lt;&lt; 8;
</a><a href="#h43-0-99" id="h43-0-99" class="i">++		dc.col[defaultbg].color.red   = ((dc.col[defaultbg].color.red &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h43-0-100" id="h43-0-100" class="i">++		dc.col[defaultbg].color.green = ((dc.col[defaultbg].color.green &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h43-0-101" id="h43-0-101" class="i">++		dc.col[defaultbg].color.blue  = ((dc.col[defaultbg].color.blue &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h43-0-102" id="h43-0-102" class="i">++	}
</a><a href="#h43-0-103" id="h43-0-103" class="i">+ 	loaded = 1;
</a><a href="#h43-0-104" id="h43-0-104" class="i">+ }
</a><a href="#h43-0-105" id="h43-0-105" class="i">+ 
</a><a href="#h43-0-106" id="h43-0-106" class="i">+@@ -769,6 +782,17 @@ xsetcolorname(int x, const char *name)
</a><a href="#h43-0-107" id="h43-0-107" class="i">+ 	return 0;
</a><a href="#h43-0-108" id="h43-0-108" class="i">+ }
</a><a href="#h43-0-109" id="h43-0-109" class="i">+ 
</a><a href="#h43-0-110" id="h43-0-110" class="i">++void
</a><a href="#h43-0-111" id="h43-0-111" class="i">++xtermclear(int col1, int row1, int col2, int row2)
</a><a href="#h43-0-112" id="h43-0-112" class="i">++{
</a><a href="#h43-0-113" id="h43-0-113" class="i">++	XftDrawRect(xw.draw,
</a><a href="#h43-0-114" id="h43-0-114" class="i">++			&amp;dc.col[IS_SET(MODE_REVERSE) ? defaultfg : defaultbg],
</a><a href="#h43-0-115" id="h43-0-115" class="i">++			borderpx + col1 * win.cw,
</a><a href="#h43-0-116" id="h43-0-116" class="i">++			borderpx + row1 * win.ch,
</a><a href="#h43-0-117" id="h43-0-117" class="i">++			(col2-col1+1) * win.cw,
</a><a href="#h43-0-118" id="h43-0-118" class="i">++			(row2-row1+1) * win.ch);
</a><a href="#h43-0-119" id="h43-0-119" class="i">++}
</a><a href="#h43-0-120" id="h43-0-120" class="i">++
</a><a href="#h43-0-121" id="h43-0-121" class="i">+ /*
</a><a href="#h43-0-122" id="h43-0-122" class="i">+  * Absolute coordinates.
</a><a href="#h43-0-123" id="h43-0-123" class="i">+  */
</a><a href="#h43-0-124" id="h43-0-124" class="i">+@@ -1008,7 +1032,40 @@ xinit(int cols, int rows)
</a><a href="#h43-0-125" id="h43-0-125" class="i">+ 	if (!(xw.dpy = XOpenDisplay(NULL)))
</a><a href="#h43-0-126" id="h43-0-126" class="i">+ 		die(&quot;can&#39;t open display\n&quot;);
</a><a href="#h43-0-127" id="h43-0-127" class="i">+ 	xw.scr = XDefaultScreen(xw.dpy);
</a><a href="#h43-0-128" id="h43-0-128" class="i">+-	xw.vis = XDefaultVisual(xw.dpy, xw.scr);
</a><a href="#h43-0-129" id="h43-0-129" class="i">++	xw.depth = (USE_ARGB) ? 32: XDefaultDepth(xw.dpy, xw.scr);
</a><a href="#h43-0-130" id="h43-0-130" class="i">++	if (!USE_ARGB)
</a><a href="#h43-0-131" id="h43-0-131" class="i">++		xw.vis = XDefaultVisual(xw.dpy, xw.scr);
</a><a href="#h43-0-132" id="h43-0-132" class="i">++	else {
</a><a href="#h43-0-133" id="h43-0-133" class="i">++		XVisualInfo *vis;
</a><a href="#h43-0-134" id="h43-0-134" class="i">++		XRenderPictFormat *fmt;
</a><a href="#h43-0-135" id="h43-0-135" class="i">++		int nvi;
</a><a href="#h43-0-136" id="h43-0-136" class="i">++		int i;
</a><a href="#h43-0-137" id="h43-0-137" class="i">++
</a><a href="#h43-0-138" id="h43-0-138" class="i">++		XVisualInfo tpl = {
</a><a href="#h43-0-139" id="h43-0-139" class="i">++			.screen = xw.scr,
</a><a href="#h43-0-140" id="h43-0-140" class="i">++			.depth = 32,
</a><a href="#h43-0-141" id="h43-0-141" class="i">++			.class = TrueColor
</a><a href="#h43-0-142" id="h43-0-142" class="i">++		};
</a><a href="#h43-0-143" id="h43-0-143" class="i">++
</a><a href="#h43-0-144" id="h43-0-144" class="i">++		vis = XGetVisualInfo(xw.dpy,
</a><a href="#h43-0-145" id="h43-0-145" class="i">++				VisualScreenMask | VisualDepthMask | VisualClassMask,
</a><a href="#h43-0-146" id="h43-0-146" class="i">++				&amp;tpl, &amp;nvi);
</a><a href="#h43-0-147" id="h43-0-147" class="i">++		xw.vis = NULL;
</a><a href="#h43-0-148" id="h43-0-148" class="i">++		for (i = 0; i &lt; nvi; i++) {
</a><a href="#h43-0-149" id="h43-0-149" class="i">++			fmt = XRenderFindVisualFormat(xw.dpy, vis[i].visual);
</a><a href="#h43-0-150" id="h43-0-150" class="i">++			if (fmt-&gt;type == PictTypeDirect &amp;&amp; fmt-&gt;direct.alphaMask) {
</a><a href="#h43-0-151" id="h43-0-151" class="i">++				xw.vis = vis[i].visual;
</a><a href="#h43-0-152" id="h43-0-152" class="i">++				break;
</a><a href="#h43-0-153" id="h43-0-153" class="i">++			}
</a><a href="#h43-0-154" id="h43-0-154" class="i">++		}
</a><a href="#h43-0-155" id="h43-0-155" class="i">++
</a><a href="#h43-0-156" id="h43-0-156" class="i">++		XFree(vis);
</a><a href="#h43-0-157" id="h43-0-157" class="i">++
</a><a href="#h43-0-158" id="h43-0-158" class="i">++		if (!xw.vis) {
</a><a href="#h43-0-159" id="h43-0-159" class="i">++			fprintf(stderr, &quot;Couldn&#39;t find ARGB visual.\n&quot;);
</a><a href="#h43-0-160" id="h43-0-160" class="i">++			exit(1);
</a><a href="#h43-0-161" id="h43-0-161" class="i">++		}
</a><a href="#h43-0-162" id="h43-0-162" class="i">++	}
</a><a href="#h43-0-163" id="h43-0-163" class="i">+ 
</a><a href="#h43-0-164" id="h43-0-164" class="i">+ 	/* font */
</a><a href="#h43-0-165" id="h43-0-165" class="i">+ 	if (!FcInit())
</a><a href="#h43-0-166" id="h43-0-166" class="i">+@@ -1018,7 +1075,11 @@ xinit(int cols, int rows)
</a><a href="#h43-0-167" id="h43-0-167" class="i">+ 	xloadfonts(usedfont, 0);
</a><a href="#h43-0-168" id="h43-0-168" class="i">+ 
</a><a href="#h43-0-169" id="h43-0-169" class="i">+ 	/* colors */
</a><a href="#h43-0-170" id="h43-0-170" class="i">+-	xw.cmap = XDefaultColormap(xw.dpy, xw.scr);
</a><a href="#h43-0-171" id="h43-0-171" class="i">++	if (!USE_ARGB)
</a><a href="#h43-0-172" id="h43-0-172" class="i">++		xw.cmap = XDefaultColormap(xw.dpy, xw.scr);
</a><a href="#h43-0-173" id="h43-0-173" class="i">++	else
</a><a href="#h43-0-174" id="h43-0-174" class="i">++		xw.cmap = XCreateColormap(xw.dpy, XRootWindow(xw.dpy, xw.scr),
</a><a href="#h43-0-175" id="h43-0-175" class="i">++				xw.vis, None);
</a><a href="#h43-0-176" id="h43-0-176" class="i">+ 	xloadcols();
</a><a href="#h43-0-177" id="h43-0-177" class="i">+ 
</a><a href="#h43-0-178" id="h43-0-178" class="i">+ 	/* adjust fixed window geometry */
</a><a href="#h43-0-179" id="h43-0-179" class="i">+@@ -1041,16 +1102,15 @@ xinit(int cols, int rows)
</a><a href="#h43-0-180" id="h43-0-180" class="i">+ 	if (!(opt_embed &amp;&amp; (parent = strtol(opt_embed, NULL, 0))))
</a><a href="#h43-0-181" id="h43-0-181" class="i">+ 		parent = XRootWindow(xw.dpy, xw.scr);
</a><a href="#h43-0-182" id="h43-0-182" class="i">+ 	xw.win = XCreateWindow(xw.dpy, parent, xw.l, xw.t,
</a><a href="#h43-0-183" id="h43-0-183" class="i">+-			win.w, win.h, 0, XDefaultDepth(xw.dpy, xw.scr), InputOutput,
</a><a href="#h43-0-184" id="h43-0-184" class="i">++			win.w, win.h, 0, xw.depth, InputOutput,
</a><a href="#h43-0-185" id="h43-0-185" class="i">+ 			xw.vis, CWBackPixel | CWBorderPixel | CWBitGravity
</a><a href="#h43-0-186" id="h43-0-186" class="i">+ 			| CWEventMask | CWColormap, &amp;xw.attrs);
</a><a href="#h43-0-187" id="h43-0-187" class="i">+ 
</a><a href="#h43-0-188" id="h43-0-188" class="i">+ 	memset(&amp;gcvalues, 0, sizeof(gcvalues));
</a><a href="#h43-0-189" id="h43-0-189" class="i">+ 	gcvalues.graphics_exposures = False;
</a><a href="#h43-0-190" id="h43-0-190" class="i">+-	dc.gc = XCreateGC(xw.dpy, parent, GCGraphicsExposures,
</a><a href="#h43-0-191" id="h43-0-191" class="i">+-			&amp;gcvalues);
</a><a href="#h43-0-192" id="h43-0-192" class="i">+-	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h,
</a><a href="#h43-0-193" id="h43-0-193" class="i">+-			DefaultDepth(xw.dpy, xw.scr));
</a><a href="#h43-0-194" id="h43-0-194" class="i">++	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h, xw.depth);
</a><a href="#h43-0-195" id="h43-0-195" class="i">++	dc.gc = XCreateGC(xw.dpy, (USE_ARGB) ? xw.buf: parent,
</a><a href="#h43-0-196" id="h43-0-196" class="i">++			GCGraphicsExposures, &amp;gcvalues);
</a><a href="#h43-0-197" id="h43-0-197" class="i">+ 	XSetForeground(xw.dpy, dc.gc, dc.col[defaultbg].pixel);
</a><a href="#h43-0-198" id="h43-0-198" class="i">+ 	XFillRectangle(xw.dpy, xw.buf, dc.gc, 0, 0, win.w, win.h);
</a><a href="#h43-0-199" id="h43-0-199" class="i">+ 
</a><b>diff --git a/<a id="h44" href="../file/st/st-anysize-0.8.1.diff.html">st/st-anysize-0.8.1.diff</a> b/<a href="../file/st/st-anysize-0.8.1.diff.html">st/st-anysize-0.8.1.diff</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -0,0 +1,152 @@
</a><a href="#h44-0-0" id="h44-0-0" class="i">+diff --git a/x.c b/x.c
</a><a href="#h44-0-1" id="h44-0-1" class="i">+index 00cb6b1..8f87c0f 100644
</a><a href="#h44-0-2" id="h44-0-2" class="i">+--- a/x.c
</a><a href="#h44-0-3" id="h44-0-3" class="i">++++ b/x.c
</a><a href="#h44-0-4" id="h44-0-4" class="i">+@@ -78,6 +78,7 @@ typedef XftGlyphFontSpec GlyphFontSpec;
</a><a href="#h44-0-5" id="h44-0-5" class="i">+ typedef struct {
</a><a href="#h44-0-6" id="h44-0-6" class="i">+ 	int tw, th; /* tty width and height */
</a><a href="#h44-0-7" id="h44-0-7" class="i">+ 	int w, h; /* window width and height */
</a><a href="#h44-0-8" id="h44-0-8" class="i">++	int hborderpx, vborderpx;
</a><a href="#h44-0-9" id="h44-0-9" class="i">+ 	int ch; /* char height */
</a><a href="#h44-0-10" id="h44-0-10" class="i">+ 	int cw; /* char width  */
</a><a href="#h44-0-11" id="h44-0-11" class="i">+ 	int mode; /* window state/mode flags */
</a><a href="#h44-0-12" id="h44-0-12" class="i">+@@ -311,7 +312,7 @@ zoomreset(const Arg *arg)
</a><a href="#h44-0-13" id="h44-0-13" class="i">+ int
</a><a href="#h44-0-14" id="h44-0-14" class="i">+ evcol(XEvent *e)
</a><a href="#h44-0-15" id="h44-0-15" class="i">+ {
</a><a href="#h44-0-16" id="h44-0-16" class="i">+-	int x = e-&gt;xbutton.x - borderpx;
</a><a href="#h44-0-17" id="h44-0-17" class="i">++	int x = e-&gt;xbutton.x - win.hborderpx;
</a><a href="#h44-0-18" id="h44-0-18" class="i">+ 	LIMIT(x, 0, win.tw - 1);
</a><a href="#h44-0-19" id="h44-0-19" class="i">+ 	return x / win.cw;
</a><a href="#h44-0-20" id="h44-0-20" class="i">+ }
</a><a href="#h44-0-21" id="h44-0-21" class="i">+@@ -319,7 +320,7 @@ evcol(XEvent *e)
</a><a href="#h44-0-22" id="h44-0-22" class="i">+ int
</a><a href="#h44-0-23" id="h44-0-23" class="i">+ evrow(XEvent *e)
</a><a href="#h44-0-24" id="h44-0-24" class="i">+ {
</a><a href="#h44-0-25" id="h44-0-25" class="i">+-	int y = e-&gt;xbutton.y - borderpx;
</a><a href="#h44-0-26" id="h44-0-26" class="i">++	int y = e-&gt;xbutton.y - win.vborderpx;
</a><a href="#h44-0-27" id="h44-0-27" class="i">+ 	LIMIT(y, 0, win.th - 1);
</a><a href="#h44-0-28" id="h44-0-28" class="i">+ 	return y / win.ch;
</a><a href="#h44-0-29" id="h44-0-29" class="i">+ }
</a><a href="#h44-0-30" id="h44-0-30" class="i">+@@ -675,6 +676,9 @@ cresize(int width, int height)
</a><a href="#h44-0-31" id="h44-0-31" class="i">+ 	col = MAX(1, col);
</a><a href="#h44-0-32" id="h44-0-32" class="i">+ 	row = MAX(1, row);
</a><a href="#h44-0-33" id="h44-0-33" class="i">+ 
</a><a href="#h44-0-34" id="h44-0-34" class="i">++	win.hborderpx = (win.w - col * win.cw) / 2;
</a><a href="#h44-0-35" id="h44-0-35" class="i">++	win.vborderpx = (win.h - row * win.ch) / 2;
</a><a href="#h44-0-36" id="h44-0-36" class="i">++
</a><a href="#h44-0-37" id="h44-0-37" class="i">+ 	tresize(col, row);
</a><a href="#h44-0-38" id="h44-0-38" class="i">+ 	xresize(col, row);
</a><a href="#h44-0-39" id="h44-0-39" class="i">+ 	ttyresize(win.tw, win.th);
</a><a href="#h44-0-40" id="h44-0-40" class="i">+@@ -793,8 +797,8 @@ xhints(void)
</a><a href="#h44-0-41" id="h44-0-41" class="i">+ 	sizeh-&gt;flags = PSize | PResizeInc | PBaseSize | PMinSize;
</a><a href="#h44-0-42" id="h44-0-42" class="i">+ 	sizeh-&gt;height = win.h;
</a><a href="#h44-0-43" id="h44-0-43" class="i">+ 	sizeh-&gt;width = win.w;
</a><a href="#h44-0-44" id="h44-0-44" class="i">+-	sizeh-&gt;height_inc = win.ch;
</a><a href="#h44-0-45" id="h44-0-45" class="i">+-	sizeh-&gt;width_inc = win.cw;
</a><a href="#h44-0-46" id="h44-0-46" class="i">++	sizeh-&gt;height_inc = 1;
</a><a href="#h44-0-47" id="h44-0-47" class="i">++	sizeh-&gt;width_inc = 1;
</a><a href="#h44-0-48" id="h44-0-48" class="i">+ 	sizeh-&gt;base_height = 2 * borderpx;
</a><a href="#h44-0-49" id="h44-0-49" class="i">+ 	sizeh-&gt;base_width = 2 * borderpx;
</a><a href="#h44-0-50" id="h44-0-50" class="i">+ 	sizeh-&gt;min_height = win.ch + 2 * borderpx;
</a><a href="#h44-0-51" id="h44-0-51" class="i">+@@ -1022,8 +1026,8 @@ xinit(int cols, int rows)
</a><a href="#h44-0-52" id="h44-0-52" class="i">+ 	xloadcols();
</a><a href="#h44-0-53" id="h44-0-53" class="i">+ 
</a><a href="#h44-0-54" id="h44-0-54" class="i">+ 	/* adjust fixed window geometry */
</a><a href="#h44-0-55" id="h44-0-55" class="i">+-	win.w = 2 * borderpx + cols * win.cw;
</a><a href="#h44-0-56" id="h44-0-56" class="i">+-	win.h = 2 * borderpx + rows * win.ch;
</a><a href="#h44-0-57" id="h44-0-57" class="i">++	win.w = 2 * win.hborderpx + cols * win.cw;
</a><a href="#h44-0-58" id="h44-0-58" class="i">++	win.h = 2 * win.vborderpx + rows * win.ch;
</a><a href="#h44-0-59" id="h44-0-59" class="i">+ 	if (xw.gm &amp; XNegative)
</a><a href="#h44-0-60" id="h44-0-60" class="i">+ 		xw.l += DisplayWidth(xw.dpy, xw.scr) - win.w - 2;
</a><a href="#h44-0-61" id="h44-0-61" class="i">+ 	if (xw.gm &amp; YNegative)
</a><a href="#h44-0-62" id="h44-0-62" class="i">+@@ -1123,7 +1127,7 @@ xinit(int cols, int rows)
</a><a href="#h44-0-63" id="h44-0-63" class="i">+ int
</a><a href="#h44-0-64" id="h44-0-64" class="i">+ xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x, int y)
</a><a href="#h44-0-65" id="h44-0-65" class="i">+ {
</a><a href="#h44-0-66" id="h44-0-66" class="i">+-	float winx = borderpx + x * win.cw, winy = borderpx + y * win.ch, xp, yp;
</a><a href="#h44-0-67" id="h44-0-67" class="i">++	float winx = win.hborderpx + x * win.cw, winy = win.vborderpx + y * win.ch, xp, yp;
</a><a href="#h44-0-68" id="h44-0-68" class="i">+ 	ushort mode, prevmode = USHRT_MAX;
</a><a href="#h44-0-69" id="h44-0-69" class="i">+ 	Font *font = &amp;dc.font;
</a><a href="#h44-0-70" id="h44-0-70" class="i">+ 	int frcflags = FRC_NORMAL;
</a><a href="#h44-0-71" id="h44-0-71" class="i">+@@ -1259,7 +1263,7 @@ void
</a><a href="#h44-0-72" id="h44-0-72" class="i">+ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, int y)
</a><a href="#h44-0-73" id="h44-0-73" class="i">+ {
</a><a href="#h44-0-74" id="h44-0-74" class="i">+ 	int charlen = len * ((base.mode &amp; ATTR_WIDE) ? 2 : 1);
</a><a href="#h44-0-75" id="h44-0-75" class="i">+-	int winx = borderpx + x * win.cw, winy = borderpx + y * win.ch,
</a><a href="#h44-0-76" id="h44-0-76" class="i">++	int winx = win.hborderpx + x * win.cw, winy = win.vborderpx + y * win.ch,
</a><a href="#h44-0-77" id="h44-0-77" class="i">+ 	    width = charlen * win.cw;
</a><a href="#h44-0-78" id="h44-0-78" class="i">+ 	Color *fg, *bg, *temp, revfg, revbg, truefg, truebg;
</a><a href="#h44-0-79" id="h44-0-79" class="i">+ 	XRenderColor colfg, colbg;
</a><a href="#h44-0-80" id="h44-0-80" class="i">+@@ -1349,17 +1353,17 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, i
</a><a href="#h44-0-81" id="h44-0-81" class="i">+ 
</a><a href="#h44-0-82" id="h44-0-82" class="i">+ 	/* Intelligent cleaning up of the borders. */
</a><a href="#h44-0-83" id="h44-0-83" class="i">+ 	if (x == 0) {
</a><a href="#h44-0-84" id="h44-0-84" class="i">+-		xclear(0, (y == 0)? 0 : winy, borderpx,
</a><a href="#h44-0-85" id="h44-0-85" class="i">++		xclear(0, (y == 0)? 0 : winy, win.vborderpx,
</a><a href="#h44-0-86" id="h44-0-86" class="i">+ 			winy + win.ch +
</a><a href="#h44-0-87" id="h44-0-87" class="i">+-			((winy + win.ch &gt;= borderpx + win.th)? win.h : 0));
</a><a href="#h44-0-88" id="h44-0-88" class="i">++			((winy + win.ch &gt;= win.vborderpx + win.th)? win.h : 0));
</a><a href="#h44-0-89" id="h44-0-89" class="i">+ 	}
</a><a href="#h44-0-90" id="h44-0-90" class="i">+-	if (winx + width &gt;= borderpx + win.tw) {
</a><a href="#h44-0-91" id="h44-0-91" class="i">++	if (winx + width &gt;= win.hborderpx + win.tw) {
</a><a href="#h44-0-92" id="h44-0-92" class="i">+ 		xclear(winx + width, (y == 0)? 0 : winy, win.w,
</a><a href="#h44-0-93" id="h44-0-93" class="i">+-			((winy + win.ch &gt;= borderpx + win.th)? win.h : (winy + win.ch)));
</a><a href="#h44-0-94" id="h44-0-94" class="i">++			((winy + win.ch &gt;= win.vborderpx + win.th)? win.h : (winy + win.ch)));
</a><a href="#h44-0-95" id="h44-0-95" class="i">+ 	}
</a><a href="#h44-0-96" id="h44-0-96" class="i">+ 	if (y == 0)
</a><a href="#h44-0-97" id="h44-0-97" class="i">+-		xclear(winx, 0, winx + width, borderpx);
</a><a href="#h44-0-98" id="h44-0-98" class="i">+-	if (winy + win.ch &gt;= borderpx + win.th)
</a><a href="#h44-0-99" id="h44-0-99" class="i">++		xclear(winx, 0, winx + width, win.hborderpx);
</a><a href="#h44-0-100" id="h44-0-100" class="i">++	if (winy + win.ch &gt;= win.vborderpx + win.th)
</a><a href="#h44-0-101" id="h44-0-101" class="i">+ 		xclear(winx, winy + win.ch, winx + width, win.h);
</a><a href="#h44-0-102" id="h44-0-102" class="i">+ 
</a><a href="#h44-0-103" id="h44-0-103" class="i">+ 	/* Clean up the region we want to draw to. */
</a><a href="#h44-0-104" id="h44-0-104" class="i">+@@ -1452,35 +1456,35 @@ xdrawcursor(int cx, int cy, Glyph g, int ox, int oy, Glyph og)
</a><a href="#h44-0-105" id="h44-0-105" class="i">+ 		case 3: /* Blinking Underline */
</a><a href="#h44-0-106" id="h44-0-106" class="i">+ 		case 4: /* Steady Underline */
</a><a href="#h44-0-107" id="h44-0-107" class="i">+ 			XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h44-0-108" id="h44-0-108" class="i">+-					borderpx + cx * win.cw,
</a><a href="#h44-0-109" id="h44-0-109" class="i">+-					borderpx + (cy + 1) * win.ch - \
</a><a href="#h44-0-110" id="h44-0-110" class="i">++					win.hborderpx + cx * win.cw,
</a><a href="#h44-0-111" id="h44-0-111" class="i">++					win.vborderpx + (cy + 1) * win.ch - \
</a><a href="#h44-0-112" id="h44-0-112" class="i">+ 						cursorthickness,
</a><a href="#h44-0-113" id="h44-0-113" class="i">+ 					win.cw, cursorthickness);
</a><a href="#h44-0-114" id="h44-0-114" class="i">+ 			break;
</a><a href="#h44-0-115" id="h44-0-115" class="i">+ 		case 5: /* Blinking bar */
</a><a href="#h44-0-116" id="h44-0-116" class="i">+ 		case 6: /* Steady bar */
</a><a href="#h44-0-117" id="h44-0-117" class="i">+ 			XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h44-0-118" id="h44-0-118" class="i">+-					borderpx + cx * win.cw,
</a><a href="#h44-0-119" id="h44-0-119" class="i">+-					borderpx + cy * win.ch,
</a><a href="#h44-0-120" id="h44-0-120" class="i">++					win.hborderpx + cx * win.cw,
</a><a href="#h44-0-121" id="h44-0-121" class="i">++					win.vborderpx + cy * win.ch,
</a><a href="#h44-0-122" id="h44-0-122" class="i">+ 					cursorthickness, win.ch);
</a><a href="#h44-0-123" id="h44-0-123" class="i">+ 			break;
</a><a href="#h44-0-124" id="h44-0-124" class="i">+ 		}
</a><a href="#h44-0-125" id="h44-0-125" class="i">+ 	} else {
</a><a href="#h44-0-126" id="h44-0-126" class="i">+ 		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h44-0-127" id="h44-0-127" class="i">+-				borderpx + cx * win.cw,
</a><a href="#h44-0-128" id="h44-0-128" class="i">+-				borderpx + cy * win.ch,
</a><a href="#h44-0-129" id="h44-0-129" class="i">++				win.hborderpx + cx * win.cw,
</a><a href="#h44-0-130" id="h44-0-130" class="i">++				win.vborderpx + cy * win.ch,
</a><a href="#h44-0-131" id="h44-0-131" class="i">+ 				win.cw - 1, 1);
</a><a href="#h44-0-132" id="h44-0-132" class="i">+ 		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h44-0-133" id="h44-0-133" class="i">+-				borderpx + cx * win.cw,
</a><a href="#h44-0-134" id="h44-0-134" class="i">+-				borderpx + cy * win.ch,
</a><a href="#h44-0-135" id="h44-0-135" class="i">++				win.hborderpx + cx * win.cw,
</a><a href="#h44-0-136" id="h44-0-136" class="i">++				win.vborderpx + cy * win.ch,
</a><a href="#h44-0-137" id="h44-0-137" class="i">+ 				1, win.ch - 1);
</a><a href="#h44-0-138" id="h44-0-138" class="i">+ 		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h44-0-139" id="h44-0-139" class="i">+-				borderpx + (cx + 1) * win.cw - 1,
</a><a href="#h44-0-140" id="h44-0-140" class="i">+-				borderpx + cy * win.ch,
</a><a href="#h44-0-141" id="h44-0-141" class="i">++				win.hborderpx + (cx + 1) * win.cw - 1,
</a><a href="#h44-0-142" id="h44-0-142" class="i">++				win.vborderpx + cy * win.ch,
</a><a href="#h44-0-143" id="h44-0-143" class="i">+ 				1, win.ch - 1);
</a><a href="#h44-0-144" id="h44-0-144" class="i">+ 		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h44-0-145" id="h44-0-145" class="i">+-				borderpx + cx * win.cw,
</a><a href="#h44-0-146" id="h44-0-146" class="i">+-				borderpx + (cy + 1) * win.ch - 1,
</a><a href="#h44-0-147" id="h44-0-147" class="i">++				win.hborderpx + cx * win.cw,
</a><a href="#h44-0-148" id="h44-0-148" class="i">++				win.vborderpx + (cy + 1) * win.ch - 1,
</a><a href="#h44-0-149" id="h44-0-149" class="i">+ 				win.cw, 1);
</a><a href="#h44-0-150" id="h44-0-150" class="i">+ 	}
</a><a href="#h44-0-151" id="h44-0-151" class="i">+ }
</a><b>diff --git a/<a id="h45" href="../file/st/st-clipboard-20180309-c5ba9c0.diff.html">st/st-clipboard-20180309-c5ba9c0.diff</a> b/<a href="../file/st/st-clipboard-20180309-c5ba9c0.diff.html">st/st-clipboard-20180309-c5ba9c0.diff</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h45-0-0" id="h45-0-0" class="i">+diff --git a/x.c b/x.c
</a><a href="#h45-0-1" id="h45-0-1" class="i">+index 13fa9f4..88fd341 100644
</a><a href="#h45-0-2" id="h45-0-2" class="i">+--- a/x.c
</a><a href="#h45-0-3" id="h45-0-3" class="i">++++ b/x.c
</a><a href="#h45-0-4" id="h45-0-4" class="i">+@@ -624,6 +624,8 @@ setsel(char *str, Time t)
</a><a href="#h45-0-5" id="h45-0-5" class="i">+ 	XSetSelectionOwner(xw.dpy, XA_PRIMARY, xw.win, t);
</a><a href="#h45-0-6" id="h45-0-6" class="i">+ 	if (XGetSelectionOwner(xw.dpy, XA_PRIMARY) != xw.win)
</a><a href="#h45-0-7" id="h45-0-7" class="i">+ 		selclear();
</a><a href="#h45-0-8" id="h45-0-8" class="i">++
</a><a href="#h45-0-9" id="h45-0-9" class="i">++	xclipcopy();
</a><a href="#h45-0-10" id="h45-0-10" class="i">+ }
</a><a href="#h45-0-11" id="h45-0-11" class="i">+ 
</a><a href="#h45-0-12" id="h45-0-12" class="i">+ void
</a><b>diff --git a/<a id="h46" href="../file/st/st-hidecursor-0.8.1.diff.html">st/st-hidecursor-0.8.1.diff</a> b/<a href="../file/st/st-hidecursor-0.8.1.diff.html">st/st-hidecursor-0.8.1.diff</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -0,0 +1,88 @@
</a><a href="#h46-0-0" id="h46-0-0" class="i">+diff --git a/x.c b/x.c
</a><a href="#h46-0-1" id="h46-0-1" class="i">+index c343ba2..a40de8c 100644
</a><a href="#h46-0-2" id="h46-0-2" class="i">+--- a/x.c
</a><a href="#h46-0-3" id="h46-0-3" class="i">++++ b/x.c
</a><a href="#h46-0-4" id="h46-0-4" class="i">+@@ -96,6 +96,11 @@ typedef struct {
</a><a href="#h46-0-5" id="h46-0-5" class="i">+ 	Draw draw;
</a><a href="#h46-0-6" id="h46-0-6" class="i">+ 	Visual *vis;
</a><a href="#h46-0-7" id="h46-0-7" class="i">+ 	XSetWindowAttributes attrs;
</a><a href="#h46-0-8" id="h46-0-8" class="i">++	/* Here, we use the term *pointer* to differentiate the cursor
</a><a href="#h46-0-9" id="h46-0-9" class="i">++	 * one sees when hovering the mouse over the terminal from, e.g.,
</a><a href="#h46-0-10" id="h46-0-10" class="i">++	 * a green rectangle where text would be entered. */
</a><a href="#h46-0-11" id="h46-0-11" class="i">++	Cursor vpointer, bpointer; /* visible and hidden pointers */
</a><a href="#h46-0-12" id="h46-0-12" class="i">++	int pointerisvisible;
</a><a href="#h46-0-13" id="h46-0-13" class="i">+ 	int scr;
</a><a href="#h46-0-14" id="h46-0-14" class="i">+ 	int isfixed; /* is fixed geometry? */
</a><a href="#h46-0-15" id="h46-0-15" class="i">+ 	int l, t; /* left and top offset */
</a><a href="#h46-0-16" id="h46-0-16" class="i">+@@ -652,6 +657,13 @@ brelease(XEvent *e)
</a><a href="#h46-0-17" id="h46-0-17" class="i">+ void
</a><a href="#h46-0-18" id="h46-0-18" class="i">+ bmotion(XEvent *e)
</a><a href="#h46-0-19" id="h46-0-19" class="i">+ {
</a><a href="#h46-0-20" id="h46-0-20" class="i">++	if (!xw.pointerisvisible) {
</a><a href="#h46-0-21" id="h46-0-21" class="i">++		XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h46-0-22" id="h46-0-22" class="i">++		xw.pointerisvisible = 1;
</a><a href="#h46-0-23" id="h46-0-23" class="i">++		if (!IS_SET(MODE_MOUSEMANY))
</a><a href="#h46-0-24" id="h46-0-24" class="i">++			xsetpointermotion(0);
</a><a href="#h46-0-25" id="h46-0-25" class="i">++	}
</a><a href="#h46-0-26" id="h46-0-26" class="i">++
</a><a href="#h46-0-27" id="h46-0-27" class="i">+ 	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h46-0-28" id="h46-0-28" class="i">+ 		mousereport(e);
</a><a href="#h46-0-29" id="h46-0-29" class="i">+ 		return;
</a><a href="#h46-0-30" id="h46-0-30" class="i">+@@ -997,10 +1009,10 @@ void
</a><a href="#h46-0-31" id="h46-0-31" class="i">+ xinit(int cols, int rows)
</a><a href="#h46-0-32" id="h46-0-32" class="i">+ {
</a><a href="#h46-0-33" id="h46-0-33" class="i">+ 	XGCValues gcvalues;
</a><a href="#h46-0-34" id="h46-0-34" class="i">+-	Cursor cursor;
</a><a href="#h46-0-35" id="h46-0-35" class="i">+ 	Window parent;
</a><a href="#h46-0-36" id="h46-0-36" class="i">+ 	pid_t thispid = getpid();
</a><a href="#h46-0-37" id="h46-0-37" class="i">+ 	XColor xmousefg, xmousebg;
</a><a href="#h46-0-38" id="h46-0-38" class="i">++	Pixmap blankpm;
</a><a href="#h46-0-39" id="h46-0-39" class="i">+ 
</a><a href="#h46-0-40" id="h46-0-40" class="i">+ 	if (!(xw.dpy = XOpenDisplay(NULL)))
</a><a href="#h46-0-41" id="h46-0-41" class="i">+ 		die(&quot;Can&#39;t open display\n&quot;);
</a><a href="#h46-0-42" id="h46-0-42" class="i">+@@ -1076,8 +1088,9 @@ xinit(int cols, int rows)
</a><a href="#h46-0-43" id="h46-0-43" class="i">+ 		die(&quot;XCreateIC failed. Could not obtain input method.\n&quot;);
</a><a href="#h46-0-44" id="h46-0-44" class="i">+ 
</a><a href="#h46-0-45" id="h46-0-45" class="i">+ 	/* white cursor, black outline */
</a><a href="#h46-0-46" id="h46-0-46" class="i">+-	cursor = XCreateFontCursor(xw.dpy, mouseshape);
</a><a href="#h46-0-47" id="h46-0-47" class="i">+-	XDefineCursor(xw.dpy, xw.win, cursor);
</a><a href="#h46-0-48" id="h46-0-48" class="i">++	xw.pointerisvisible = 1;
</a><a href="#h46-0-49" id="h46-0-49" class="i">++	xw.vpointer = XCreateFontCursor(xw.dpy, mouseshape);
</a><a href="#h46-0-50" id="h46-0-50" class="i">++	XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h46-0-51" id="h46-0-51" class="i">+ 
</a><a href="#h46-0-52" id="h46-0-52" class="i">+ 	if (XParseColor(xw.dpy, xw.cmap, colorname[mousefg], &amp;xmousefg) == 0) {
</a><a href="#h46-0-53" id="h46-0-53" class="i">+ 		xmousefg.red   = 0xffff;
</a><a href="#h46-0-54" id="h46-0-54" class="i">+@@ -1091,7 +1104,10 @@ xinit(int cols, int rows)
</a><a href="#h46-0-55" id="h46-0-55" class="i">+ 		xmousebg.blue  = 0x0000;
</a><a href="#h46-0-56" id="h46-0-56" class="i">+ 	}
</a><a href="#h46-0-57" id="h46-0-57" class="i">+ 
</a><a href="#h46-0-58" id="h46-0-58" class="i">+-	XRecolorCursor(xw.dpy, cursor, &amp;xmousefg, &amp;xmousebg);
</a><a href="#h46-0-59" id="h46-0-59" class="i">++	XRecolorCursor(xw.dpy, xw.vpointer, &amp;xmousefg, &amp;xmousebg);
</a><a href="#h46-0-60" id="h46-0-60" class="i">++	blankpm = XCreateBitmapFromData(xw.dpy, xw.win, &amp;(char){0}, 1, 1);
</a><a href="#h46-0-61" id="h46-0-61" class="i">++	xw.bpointer = XCreatePixmapCursor(xw.dpy, blankpm, blankpm,
</a><a href="#h46-0-62" id="h46-0-62" class="i">++					  &amp;xmousefg, &amp;xmousebg, 0, 0);
</a><a href="#h46-0-63" id="h46-0-63" class="i">+ 
</a><a href="#h46-0-64" id="h46-0-64" class="i">+ 	xw.xembed = XInternAtom(xw.dpy, &quot;_XEMBED&quot;, False);
</a><a href="#h46-0-65" id="h46-0-65" class="i">+ 	xw.wmdeletewin = XInternAtom(xw.dpy, &quot;WM_DELETE_WINDOW&quot;, False);
</a><a href="#h46-0-66" id="h46-0-66" class="i">+@@ -1574,6 +1590,8 @@ unmap(XEvent *ev)
</a><a href="#h46-0-67" id="h46-0-67" class="i">+ void
</a><a href="#h46-0-68" id="h46-0-68" class="i">+ xsetpointermotion(int set)
</a><a href="#h46-0-69" id="h46-0-69" class="i">+ {
</a><a href="#h46-0-70" id="h46-0-70" class="i">++	if (!set &amp;&amp; !xw.pointerisvisible)
</a><a href="#h46-0-71" id="h46-0-71" class="i">++		return;
</a><a href="#h46-0-72" id="h46-0-72" class="i">+ 	MODBIT(xw.attrs.event_mask, set, PointerMotionMask);
</a><a href="#h46-0-73" id="h46-0-73" class="i">+ 	XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask, &amp;xw.attrs);
</a><a href="#h46-0-74" id="h46-0-74" class="i">+ }
</a><a href="#h46-0-75" id="h46-0-75" class="i">+@@ -1692,6 +1710,12 @@ kpress(XEvent *ev)
</a><a href="#h46-0-76" id="h46-0-76" class="i">+ 	Status status;
</a><a href="#h46-0-77" id="h46-0-77" class="i">+ 	Shortcut *bp;
</a><a href="#h46-0-78" id="h46-0-78" class="i">+ 
</a><a href="#h46-0-79" id="h46-0-79" class="i">++	if (xw.pointerisvisible) {
</a><a href="#h46-0-80" id="h46-0-80" class="i">++		XDefineCursor(xw.dpy, xw.win, xw.bpointer);
</a><a href="#h46-0-81" id="h46-0-81" class="i">++		xsetpointermotion(1);
</a><a href="#h46-0-82" id="h46-0-82" class="i">++		xw.pointerisvisible = 0;
</a><a href="#h46-0-83" id="h46-0-83" class="i">++	}
</a><a href="#h46-0-84" id="h46-0-84" class="i">++
</a><a href="#h46-0-85" id="h46-0-85" class="i">+ 	if (IS_SET(MODE_KBDLOCK))
</a><a href="#h46-0-86" id="h46-0-86" class="i">+ 		return;
</a><a href="#h46-0-87" id="h46-0-87" class="i">+ 
</a><b>diff --git a/<a id="h47" href="../file/st/st.1.html">st/st.1</a> b/<a href="../file/st/st.1.html">st/st.1</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -0,0 +1,176 @@
</a><a href="#h47-0-0" id="h47-0-0" class="i">+.TH ST 1 st\-VERSION
</a><a href="#h47-0-1" id="h47-0-1" class="i">+.SH NAME
</a><a href="#h47-0-2" id="h47-0-2" class="i">+st \- simple terminal
</a><a href="#h47-0-3" id="h47-0-3" class="i">+.SH SYNOPSIS
</a><a href="#h47-0-4" id="h47-0-4" class="i">+.B st
</a><a href="#h47-0-5" id="h47-0-5" class="i">+.RB [ \-aiv ]
</a><a href="#h47-0-6" id="h47-0-6" class="i">+.RB [ \-c
</a><a href="#h47-0-7" id="h47-0-7" class="i">+.IR class ]
</a><a href="#h47-0-8" id="h47-0-8" class="i">+.RB [ \-f
</a><a href="#h47-0-9" id="h47-0-9" class="i">+.IR font ]
</a><a href="#h47-0-10" id="h47-0-10" class="i">+.RB [ \-g
</a><a href="#h47-0-11" id="h47-0-11" class="i">+.IR geometry ]
</a><a href="#h47-0-12" id="h47-0-12" class="i">+.RB [ \-n
</a><a href="#h47-0-13" id="h47-0-13" class="i">+.IR name ]
</a><a href="#h47-0-14" id="h47-0-14" class="i">+.RB [ \-o
</a><a href="#h47-0-15" id="h47-0-15" class="i">+.IR iofile ]
</a><a href="#h47-0-16" id="h47-0-16" class="i">+.RB [ \-T
</a><a href="#h47-0-17" id="h47-0-17" class="i">+.IR title ]
</a><a href="#h47-0-18" id="h47-0-18" class="i">+.RB [ \-t
</a><a href="#h47-0-19" id="h47-0-19" class="i">+.IR title ]
</a><a href="#h47-0-20" id="h47-0-20" class="i">+.RB [ \-l
</a><a href="#h47-0-21" id="h47-0-21" class="i">+.IR line ]
</a><a href="#h47-0-22" id="h47-0-22" class="i">+.RB [ \-w
</a><a href="#h47-0-23" id="h47-0-23" class="i">+.IR windowid ]
</a><a href="#h47-0-24" id="h47-0-24" class="i">+.RB [[ \-e ]
</a><a href="#h47-0-25" id="h47-0-25" class="i">+.IR command
</a><a href="#h47-0-26" id="h47-0-26" class="i">+.RI [ arguments ...]]
</a><a href="#h47-0-27" id="h47-0-27" class="i">+.PP
</a><a href="#h47-0-28" id="h47-0-28" class="i">+.B st
</a><a href="#h47-0-29" id="h47-0-29" class="i">+.RB [ \-aiv ]
</a><a href="#h47-0-30" id="h47-0-30" class="i">+.RB [ \-c
</a><a href="#h47-0-31" id="h47-0-31" class="i">+.IR class ]
</a><a href="#h47-0-32" id="h47-0-32" class="i">+.RB [ \-f
</a><a href="#h47-0-33" id="h47-0-33" class="i">+.IR font ]
</a><a href="#h47-0-34" id="h47-0-34" class="i">+.RB [ \-g
</a><a href="#h47-0-35" id="h47-0-35" class="i">+.IR geometry ]
</a><a href="#h47-0-36" id="h47-0-36" class="i">+.RB [ \-n
</a><a href="#h47-0-37" id="h47-0-37" class="i">+.IR name ]
</a><a href="#h47-0-38" id="h47-0-38" class="i">+.RB [ \-o
</a><a href="#h47-0-39" id="h47-0-39" class="i">+.IR iofile ]
</a><a href="#h47-0-40" id="h47-0-40" class="i">+.RB [ \-T
</a><a href="#h47-0-41" id="h47-0-41" class="i">+.IR title ]
</a><a href="#h47-0-42" id="h47-0-42" class="i">+.RB [ \-t
</a><a href="#h47-0-43" id="h47-0-43" class="i">+.IR title ]
</a><a href="#h47-0-44" id="h47-0-44" class="i">+.RB [ \-w
</a><a href="#h47-0-45" id="h47-0-45" class="i">+.IR windowid ]
</a><a href="#h47-0-46" id="h47-0-46" class="i">+.RB \-l
</a><a href="#h47-0-47" id="h47-0-47" class="i">+.IR line
</a><a href="#h47-0-48" id="h47-0-48" class="i">+.RI [ stty_args ...]
</a><a href="#h47-0-49" id="h47-0-49" class="i">+.SH DESCRIPTION
</a><a href="#h47-0-50" id="h47-0-50" class="i">+.B st
</a><a href="#h47-0-51" id="h47-0-51" class="i">+is a simple terminal emulator.
</a><a href="#h47-0-52" id="h47-0-52" class="i">+.SH OPTIONS
</a><a href="#h47-0-53" id="h47-0-53" class="i">+.TP
</a><a href="#h47-0-54" id="h47-0-54" class="i">+.B \-a
</a><a href="#h47-0-55" id="h47-0-55" class="i">+disable alternate screens in terminal
</a><a href="#h47-0-56" id="h47-0-56" class="i">+.TP
</a><a href="#h47-0-57" id="h47-0-57" class="i">+.BI \-c &quot; class&quot;
</a><a href="#h47-0-58" id="h47-0-58" class="i">+defines the window class (default $TERM).
</a><a href="#h47-0-59" id="h47-0-59" class="i">+.TP
</a><a href="#h47-0-60" id="h47-0-60" class="i">+.BI \-f &quot; font&quot;
</a><a href="#h47-0-61" id="h47-0-61" class="i">+defines the
</a><a href="#h47-0-62" id="h47-0-62" class="i">+.I font
</a><a href="#h47-0-63" id="h47-0-63" class="i">+to use when st is run.
</a><a href="#h47-0-64" id="h47-0-64" class="i">+.TP
</a><a href="#h47-0-65" id="h47-0-65" class="i">+.BI \-g &quot; geometry&quot;
</a><a href="#h47-0-66" id="h47-0-66" class="i">+defines the X11 geometry string.
</a><a href="#h47-0-67" id="h47-0-67" class="i">+The form is [=][&lt;cols&gt;{xX}&lt;rows&gt;][{+-}&lt;xoffset&gt;{+-}&lt;yoffset&gt;]. See
</a><a href="#h47-0-68" id="h47-0-68" class="i">+.BR XParseGeometry (3)
</a><a href="#h47-0-69" id="h47-0-69" class="i">+for further details.
</a><a href="#h47-0-70" id="h47-0-70" class="i">+.TP
</a><a href="#h47-0-71" id="h47-0-71" class="i">+.B \-i
</a><a href="#h47-0-72" id="h47-0-72" class="i">+will fixate the position given with the -g option.
</a><a href="#h47-0-73" id="h47-0-73" class="i">+.TP
</a><a href="#h47-0-74" id="h47-0-74" class="i">+.BI \-n &quot; name&quot;
</a><a href="#h47-0-75" id="h47-0-75" class="i">+defines the window instance name (default $TERM).
</a><a href="#h47-0-76" id="h47-0-76" class="i">+.TP
</a><a href="#h47-0-77" id="h47-0-77" class="i">+.BI \-o &quot; iofile&quot;
</a><a href="#h47-0-78" id="h47-0-78" class="i">+writes all the I/O to
</a><a href="#h47-0-79" id="h47-0-79" class="i">+.I iofile.
</a><a href="#h47-0-80" id="h47-0-80" class="i">+This feature is useful when recording st sessions. A value of &quot;-&quot; means
</a><a href="#h47-0-81" id="h47-0-81" class="i">+standard output.
</a><a href="#h47-0-82" id="h47-0-82" class="i">+.TP
</a><a href="#h47-0-83" id="h47-0-83" class="i">+.BI \-T &quot; title&quot;
</a><a href="#h47-0-84" id="h47-0-84" class="i">+defines the window title (default &#39;st&#39;).
</a><a href="#h47-0-85" id="h47-0-85" class="i">+.TP
</a><a href="#h47-0-86" id="h47-0-86" class="i">+.BI \-t &quot; title&quot;
</a><a href="#h47-0-87" id="h47-0-87" class="i">+defines the window title (default &#39;st&#39;).
</a><a href="#h47-0-88" id="h47-0-88" class="i">+.TP
</a><a href="#h47-0-89" id="h47-0-89" class="i">+.BI \-w &quot; windowid&quot;
</a><a href="#h47-0-90" id="h47-0-90" class="i">+embeds st within the window identified by
</a><a href="#h47-0-91" id="h47-0-91" class="i">+.I windowid
</a><a href="#h47-0-92" id="h47-0-92" class="i">+.TP
</a><a href="#h47-0-93" id="h47-0-93" class="i">+.BI \-l &quot; line&quot;
</a><a href="#h47-0-94" id="h47-0-94" class="i">+use a tty
</a><a href="#h47-0-95" id="h47-0-95" class="i">+.I line
</a><a href="#h47-0-96" id="h47-0-96" class="i">+instead of a pseudo terminal.
</a><a href="#h47-0-97" id="h47-0-97" class="i">+.I line
</a><a href="#h47-0-98" id="h47-0-98" class="i">+should be a (pseudo-)serial device (e.g. /dev/ttyS0 on Linux for serial port
</a><a href="#h47-0-99" id="h47-0-99" class="i">+0).
</a><a href="#h47-0-100" id="h47-0-100" class="i">+When this flag is given
</a><a href="#h47-0-101" id="h47-0-101" class="i">+remaining arguments are used as flags for
</a><a href="#h47-0-102" id="h47-0-102" class="i">+.BR stty(1).
</a><a href="#h47-0-103" id="h47-0-103" class="i">+By default st initializes the serial line to 8 bits, no parity, 1 stop bit
</a><a href="#h47-0-104" id="h47-0-104" class="i">+and a 38400 baud rate. The speed is set by appending it as last argument
</a><a href="#h47-0-105" id="h47-0-105" class="i">+(e.g. &#39;st -l /dev/ttyS0 115200&#39;). Arguments before the last one are
</a><a href="#h47-0-106" id="h47-0-106" class="i">+.BR stty(1)
</a><a href="#h47-0-107" id="h47-0-107" class="i">+flags. If you want to set odd parity on 115200 baud use for example &#39;st -l
</a><a href="#h47-0-108" id="h47-0-108" class="i">+/dev/ttyS0 parenb parodd 115200&#39;. Set the number of bits by using for
</a><a href="#h47-0-109" id="h47-0-109" class="i">+example &#39;st -l /dev/ttyS0 cs7 115200&#39;. See
</a><a href="#h47-0-110" id="h47-0-110" class="i">+.BR stty(1)
</a><a href="#h47-0-111" id="h47-0-111" class="i">+for more arguments and cases.
</a><a href="#h47-0-112" id="h47-0-112" class="i">+.TP
</a><a href="#h47-0-113" id="h47-0-113" class="i">+.B \-v
</a><a href="#h47-0-114" id="h47-0-114" class="i">+prints version information to stderr, then exits.
</a><a href="#h47-0-115" id="h47-0-115" class="i">+.TP
</a><a href="#h47-0-116" id="h47-0-116" class="i">+.BI \-e &quot; command &quot; [ &quot; arguments &quot; &quot;... ]&quot;
</a><a href="#h47-0-117" id="h47-0-117" class="i">+st executes
</a><a href="#h47-0-118" id="h47-0-118" class="i">+.I command
</a><a href="#h47-0-119" id="h47-0-119" class="i">+instead of the shell.  If this is used it
</a><a href="#h47-0-120" id="h47-0-120" class="i">+.B must be the last option
</a><a href="#h47-0-121" id="h47-0-121" class="i">+on the command line, as in xterm / rxvt.
</a><a href="#h47-0-122" id="h47-0-122" class="i">+This option is only intended for compatibility,
</a><a href="#h47-0-123" id="h47-0-123" class="i">+and all the remaining arguments are used as a command
</a><a href="#h47-0-124" id="h47-0-124" class="i">+even without it.
</a><a href="#h47-0-125" id="h47-0-125" class="i">+.SH SHORTCUTS
</a><a href="#h47-0-126" id="h47-0-126" class="i">+.TP
</a><a href="#h47-0-127" id="h47-0-127" class="i">+.B Break
</a><a href="#h47-0-128" id="h47-0-128" class="i">+Send a break in the serial line.
</a><a href="#h47-0-129" id="h47-0-129" class="i">+Break key is obtained in PC keyboards
</a><a href="#h47-0-130" id="h47-0-130" class="i">+pressing at the same time control and pause.
</a><a href="#h47-0-131" id="h47-0-131" class="i">+.TP
</a><a href="#h47-0-132" id="h47-0-132" class="i">+.B Ctrl-Print Screen
</a><a href="#h47-0-133" id="h47-0-133" class="i">+Toggle if st should print to the
</a><a href="#h47-0-134" id="h47-0-134" class="i">+.I iofile.
</a><a href="#h47-0-135" id="h47-0-135" class="i">+.TP
</a><a href="#h47-0-136" id="h47-0-136" class="i">+.B Shift-Print Screen
</a><a href="#h47-0-137" id="h47-0-137" class="i">+Print the full screen to the
</a><a href="#h47-0-138" id="h47-0-138" class="i">+.I iofile.
</a><a href="#h47-0-139" id="h47-0-139" class="i">+.TP
</a><a href="#h47-0-140" id="h47-0-140" class="i">+.B Print Screen
</a><a href="#h47-0-141" id="h47-0-141" class="i">+Print the selection to the
</a><a href="#h47-0-142" id="h47-0-142" class="i">+.I iofile.
</a><a href="#h47-0-143" id="h47-0-143" class="i">+.TP
</a><a href="#h47-0-144" id="h47-0-144" class="i">+.B Ctrl-Shift-Page Up
</a><a href="#h47-0-145" id="h47-0-145" class="i">+Increase font size.
</a><a href="#h47-0-146" id="h47-0-146" class="i">+.TP
</a><a href="#h47-0-147" id="h47-0-147" class="i">+.B Ctrl-Shift-Page Down
</a><a href="#h47-0-148" id="h47-0-148" class="i">+Decrease font size.
</a><a href="#h47-0-149" id="h47-0-149" class="i">+.TP
</a><a href="#h47-0-150" id="h47-0-150" class="i">+.B Ctrl-Shift-Home
</a><a href="#h47-0-151" id="h47-0-151" class="i">+Reset to default font size.
</a><a href="#h47-0-152" id="h47-0-152" class="i">+.TP
</a><a href="#h47-0-153" id="h47-0-153" class="i">+.B Ctrl-Shift-y
</a><a href="#h47-0-154" id="h47-0-154" class="i">+Paste from primary selection (middle mouse button).
</a><a href="#h47-0-155" id="h47-0-155" class="i">+.TP
</a><a href="#h47-0-156" id="h47-0-156" class="i">+.B Ctrl-Shift-c
</a><a href="#h47-0-157" id="h47-0-157" class="i">+Copy the selected text to the clipboard selection.
</a><a href="#h47-0-158" id="h47-0-158" class="i">+.TP
</a><a href="#h47-0-159" id="h47-0-159" class="i">+.B Ctrl-Shift-v
</a><a href="#h47-0-160" id="h47-0-160" class="i">+Paste from the clipboard selection.
</a><a href="#h47-0-161" id="h47-0-161" class="i">+.SH CUSTOMIZATION
</a><a href="#h47-0-162" id="h47-0-162" class="i">+.B st
</a><a href="#h47-0-163" id="h47-0-163" class="i">+can be customized by creating a custom config.h and (re)compiling the source
</a><a href="#h47-0-164" id="h47-0-164" class="i">+code. This keeps it fast, secure and simple.
</a><a href="#h47-0-165" id="h47-0-165" class="i">+.SH AUTHORS
</a><a href="#h47-0-166" id="h47-0-166" class="i">+See the LICENSE file for the authors.
</a><a href="#h47-0-167" id="h47-0-167" class="i">+.SH LICENSE
</a><a href="#h47-0-168" id="h47-0-168" class="i">+See the LICENSE file for the terms of redistribution.
</a><a href="#h47-0-169" id="h47-0-169" class="i">+.SH SEE ALSO
</a><a href="#h47-0-170" id="h47-0-170" class="i">+.BR tabbed (1),
</a><a href="#h47-0-171" id="h47-0-171" class="i">+.BR utmp (1),
</a><a href="#h47-0-172" id="h47-0-172" class="i">+.BR stty (1)
</a><a href="#h47-0-173" id="h47-0-173" class="i">+.SH BUGS
</a><a href="#h47-0-174" id="h47-0-174" class="i">+See the TODO file in the distribution.
</a><a href="#h47-0-175" id="h47-0-175" class="i">+
</a><b>diff --git a/<a id="h48" href="../file/st/st.c.html">st/st.c</a> b/<a href="../file/st/st.c.html">st/st.c</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -0,0 +1,2605 @@
</a><a href="#h48-0-0" id="h48-0-0" class="i">+/* See LICENSE for license details. */
</a><a href="#h48-0-1" id="h48-0-1" class="i">+#include &lt;ctype.h&gt;
</a><a href="#h48-0-2" id="h48-0-2" class="i">+#include &lt;errno.h&gt;
</a><a href="#h48-0-3" id="h48-0-3" class="i">+#include &lt;fcntl.h&gt;
</a><a href="#h48-0-4" id="h48-0-4" class="i">+#include &lt;limits.h&gt;
</a><a href="#h48-0-5" id="h48-0-5" class="i">+#include &lt;pwd.h&gt;
</a><a href="#h48-0-6" id="h48-0-6" class="i">+#include &lt;stdarg.h&gt;
</a><a href="#h48-0-7" id="h48-0-7" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h48-0-8" id="h48-0-8" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h48-0-9" id="h48-0-9" class="i">+#include &lt;string.h&gt;
</a><a href="#h48-0-10" id="h48-0-10" class="i">+#include &lt;signal.h&gt;
</a><a href="#h48-0-11" id="h48-0-11" class="i">+#include &lt;sys/ioctl.h&gt;
</a><a href="#h48-0-12" id="h48-0-12" class="i">+#include &lt;sys/select.h&gt;
</a><a href="#h48-0-13" id="h48-0-13" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h48-0-14" id="h48-0-14" class="i">+#include &lt;sys/wait.h&gt;
</a><a href="#h48-0-15" id="h48-0-15" class="i">+#include &lt;termios.h&gt;
</a><a href="#h48-0-16" id="h48-0-16" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h48-0-17" id="h48-0-17" class="i">+#include &lt;wchar.h&gt;
</a><a href="#h48-0-18" id="h48-0-18" class="i">+
</a><a href="#h48-0-19" id="h48-0-19" class="i">+#include &quot;st.h&quot;
</a><a href="#h48-0-20" id="h48-0-20" class="i">+#include &quot;win.h&quot;
</a><a href="#h48-0-21" id="h48-0-21" class="i">+
</a><a href="#h48-0-22" id="h48-0-22" class="i">+#if   defined(__linux)
</a><a href="#h48-0-23" id="h48-0-23" class="i">+ #include &lt;pty.h&gt;
</a><a href="#h48-0-24" id="h48-0-24" class="i">+#elif defined(__OpenBSD__) || defined(__NetBSD__) || defined(__APPLE__)
</a><a href="#h48-0-25" id="h48-0-25" class="i">+ #include &lt;util.h&gt;
</a><a href="#h48-0-26" id="h48-0-26" class="i">+#elif defined(__FreeBSD__) || defined(__DragonFly__)
</a><a href="#h48-0-27" id="h48-0-27" class="i">+ #include &lt;libutil.h&gt;
</a><a href="#h48-0-28" id="h48-0-28" class="i">+#endif
</a><a href="#h48-0-29" id="h48-0-29" class="i">+
</a><a href="#h48-0-30" id="h48-0-30" class="i">+/* Arbitrary sizes */
</a><a href="#h48-0-31" id="h48-0-31" class="i">+#define UTF_INVALID   0xFFFD
</a><a href="#h48-0-32" id="h48-0-32" class="i">+#define UTF_SIZ       4
</a><a href="#h48-0-33" id="h48-0-33" class="i">+#define ESC_BUF_SIZ   (128*UTF_SIZ)
</a><a href="#h48-0-34" id="h48-0-34" class="i">+#define ESC_ARG_SIZ   16
</a><a href="#h48-0-35" id="h48-0-35" class="i">+#define STR_BUF_SIZ   ESC_BUF_SIZ
</a><a href="#h48-0-36" id="h48-0-36" class="i">+#define STR_ARG_SIZ   ESC_ARG_SIZ
</a><a href="#h48-0-37" id="h48-0-37" class="i">+
</a><a href="#h48-0-38" id="h48-0-38" class="i">+/* macros */
</a><a href="#h48-0-39" id="h48-0-39" class="i">+#define IS_SET(flag)		((term.mode &amp; (flag)) != 0)
</a><a href="#h48-0-40" id="h48-0-40" class="i">+#define ISCONTROLC0(c)		(BETWEEN(c, 0, 0x1f) || (c) == &#39;\177&#39;)
</a><a href="#h48-0-41" id="h48-0-41" class="i">+#define ISCONTROLC1(c)		(BETWEEN(c, 0x80, 0x9f))
</a><a href="#h48-0-42" id="h48-0-42" class="i">+#define ISCONTROL(c)		(ISCONTROLC0(c) || ISCONTROLC1(c))
</a><a href="#h48-0-43" id="h48-0-43" class="i">+#define ISDELIM(u)		(utf8strchr(worddelimiters, u) != NULL)
</a><a href="#h48-0-44" id="h48-0-44" class="i">+
</a><a href="#h48-0-45" id="h48-0-45" class="i">+enum term_mode {
</a><a href="#h48-0-46" id="h48-0-46" class="i">+	MODE_WRAP        = 1 &lt;&lt; 0,
</a><a href="#h48-0-47" id="h48-0-47" class="i">+	MODE_INSERT      = 1 &lt;&lt; 1,
</a><a href="#h48-0-48" id="h48-0-48" class="i">+	MODE_ALTSCREEN   = 1 &lt;&lt; 2,
</a><a href="#h48-0-49" id="h48-0-49" class="i">+	MODE_CRLF        = 1 &lt;&lt; 3,
</a><a href="#h48-0-50" id="h48-0-50" class="i">+	MODE_ECHO        = 1 &lt;&lt; 4,
</a><a href="#h48-0-51" id="h48-0-51" class="i">+	MODE_PRINT       = 1 &lt;&lt; 5,
</a><a href="#h48-0-52" id="h48-0-52" class="i">+	MODE_UTF8        = 1 &lt;&lt; 6,
</a><a href="#h48-0-53" id="h48-0-53" class="i">+	MODE_SIXEL       = 1 &lt;&lt; 7,
</a><a href="#h48-0-54" id="h48-0-54" class="i">+};
</a><a href="#h48-0-55" id="h48-0-55" class="i">+
</a><a href="#h48-0-56" id="h48-0-56" class="i">+enum cursor_movement {
</a><a href="#h48-0-57" id="h48-0-57" class="i">+	CURSOR_SAVE,
</a><a href="#h48-0-58" id="h48-0-58" class="i">+	CURSOR_LOAD
</a><a href="#h48-0-59" id="h48-0-59" class="i">+};
</a><a href="#h48-0-60" id="h48-0-60" class="i">+
</a><a href="#h48-0-61" id="h48-0-61" class="i">+enum cursor_state {
</a><a href="#h48-0-62" id="h48-0-62" class="i">+	CURSOR_DEFAULT  = 0,
</a><a href="#h48-0-63" id="h48-0-63" class="i">+	CURSOR_WRAPNEXT = 1,
</a><a href="#h48-0-64" id="h48-0-64" class="i">+	CURSOR_ORIGIN   = 2
</a><a href="#h48-0-65" id="h48-0-65" class="i">+};
</a><a href="#h48-0-66" id="h48-0-66" class="i">+
</a><a href="#h48-0-67" id="h48-0-67" class="i">+enum charset {
</a><a href="#h48-0-68" id="h48-0-68" class="i">+	CS_GRAPHIC0,
</a><a href="#h48-0-69" id="h48-0-69" class="i">+	CS_GRAPHIC1,
</a><a href="#h48-0-70" id="h48-0-70" class="i">+	CS_UK,
</a><a href="#h48-0-71" id="h48-0-71" class="i">+	CS_USA,
</a><a href="#h48-0-72" id="h48-0-72" class="i">+	CS_MULTI,
</a><a href="#h48-0-73" id="h48-0-73" class="i">+	CS_GER,
</a><a href="#h48-0-74" id="h48-0-74" class="i">+	CS_FIN
</a><a href="#h48-0-75" id="h48-0-75" class="i">+};
</a><a href="#h48-0-76" id="h48-0-76" class="i">+
</a><a href="#h48-0-77" id="h48-0-77" class="i">+enum escape_state {
</a><a href="#h48-0-78" id="h48-0-78" class="i">+	ESC_START      = 1,
</a><a href="#h48-0-79" id="h48-0-79" class="i">+	ESC_CSI        = 2,
</a><a href="#h48-0-80" id="h48-0-80" class="i">+	ESC_STR        = 4,  /* OSC, PM, APC */
</a><a href="#h48-0-81" id="h48-0-81" class="i">+	ESC_ALTCHARSET = 8,
</a><a href="#h48-0-82" id="h48-0-82" class="i">+	ESC_STR_END    = 16, /* a final string was encountered */
</a><a href="#h48-0-83" id="h48-0-83" class="i">+	ESC_TEST       = 32, /* Enter in test mode */
</a><a href="#h48-0-84" id="h48-0-84" class="i">+	ESC_UTF8       = 64,
</a><a href="#h48-0-85" id="h48-0-85" class="i">+	ESC_DCS        =128,
</a><a href="#h48-0-86" id="h48-0-86" class="i">+};
</a><a href="#h48-0-87" id="h48-0-87" class="i">+
</a><a href="#h48-0-88" id="h48-0-88" class="i">+typedef struct {
</a><a href="#h48-0-89" id="h48-0-89" class="i">+	Glyph attr; /* current char attributes */
</a><a href="#h48-0-90" id="h48-0-90" class="i">+	int x;
</a><a href="#h48-0-91" id="h48-0-91" class="i">+	int y;
</a><a href="#h48-0-92" id="h48-0-92" class="i">+	char state;
</a><a href="#h48-0-93" id="h48-0-93" class="i">+} TCursor;
</a><a href="#h48-0-94" id="h48-0-94" class="i">+
</a><a href="#h48-0-95" id="h48-0-95" class="i">+typedef struct {
</a><a href="#h48-0-96" id="h48-0-96" class="i">+	int mode;
</a><a href="#h48-0-97" id="h48-0-97" class="i">+	int type;
</a><a href="#h48-0-98" id="h48-0-98" class="i">+	int snap;
</a><a href="#h48-0-99" id="h48-0-99" class="i">+	/*
</a><a href="#h48-0-100" id="h48-0-100" class="i">+	 * Selection variables:
</a><a href="#h48-0-101" id="h48-0-101" class="i">+	 * nb – normalized coordinates of the beginning of the selection
</a><a href="#h48-0-102" id="h48-0-102" class="i">+	 * ne – normalized coordinates of the end of the selection
</a><a href="#h48-0-103" id="h48-0-103" class="i">+	 * ob – original coordinates of the beginning of the selection
</a><a href="#h48-0-104" id="h48-0-104" class="i">+	 * oe – original coordinates of the end of the selection
</a><a href="#h48-0-105" id="h48-0-105" class="i">+	 */
</a><a href="#h48-0-106" id="h48-0-106" class="i">+	struct {
</a><a href="#h48-0-107" id="h48-0-107" class="i">+		int x, y;
</a><a href="#h48-0-108" id="h48-0-108" class="i">+	} nb, ne, ob, oe;
</a><a href="#h48-0-109" id="h48-0-109" class="i">+
</a><a href="#h48-0-110" id="h48-0-110" class="i">+	int alt;
</a><a href="#h48-0-111" id="h48-0-111" class="i">+} Selection;
</a><a href="#h48-0-112" id="h48-0-112" class="i">+
</a><a href="#h48-0-113" id="h48-0-113" class="i">+/* Internal representation of the screen */
</a><a href="#h48-0-114" id="h48-0-114" class="i">+typedef struct {
</a><a href="#h48-0-115" id="h48-0-115" class="i">+	int row;      /* nb row */
</a><a href="#h48-0-116" id="h48-0-116" class="i">+	int col;      /* nb col */
</a><a href="#h48-0-117" id="h48-0-117" class="i">+	Line *line;   /* screen */
</a><a href="#h48-0-118" id="h48-0-118" class="i">+	Line *alt;    /* alternate screen */
</a><a href="#h48-0-119" id="h48-0-119" class="i">+	int *dirty;   /* dirtyness of lines */
</a><a href="#h48-0-120" id="h48-0-120" class="i">+	TCursor c;    /* cursor */
</a><a href="#h48-0-121" id="h48-0-121" class="i">+	int ocx;      /* old cursor col */
</a><a href="#h48-0-122" id="h48-0-122" class="i">+	int ocy;      /* old cursor row */
</a><a href="#h48-0-123" id="h48-0-123" class="i">+	int top;      /* top    scroll limit */
</a><a href="#h48-0-124" id="h48-0-124" class="i">+	int bot;      /* bottom scroll limit */
</a><a href="#h48-0-125" id="h48-0-125" class="i">+	int mode;     /* terminal mode flags */
</a><a href="#h48-0-126" id="h48-0-126" class="i">+	int esc;      /* escape state flags */
</a><a href="#h48-0-127" id="h48-0-127" class="i">+	char trantbl[4]; /* charset table translation */
</a><a href="#h48-0-128" id="h48-0-128" class="i">+	int charset;  /* current charset */
</a><a href="#h48-0-129" id="h48-0-129" class="i">+	int icharset; /* selected charset for sequence */
</a><a href="#h48-0-130" id="h48-0-130" class="i">+	int *tabs;
</a><a href="#h48-0-131" id="h48-0-131" class="i">+} Term;
</a><a href="#h48-0-132" id="h48-0-132" class="i">+
</a><a href="#h48-0-133" id="h48-0-133" class="i">+/* CSI Escape sequence structs */
</a><a href="#h48-0-134" id="h48-0-134" class="i">+/* ESC &#39;[&#39; [[ [&lt;priv&gt;] &lt;arg&gt; [;]] &lt;mode&gt; [&lt;mode&gt;]] */
</a><a href="#h48-0-135" id="h48-0-135" class="i">+typedef struct {
</a><a href="#h48-0-136" id="h48-0-136" class="i">+	char buf[ESC_BUF_SIZ]; /* raw string */
</a><a href="#h48-0-137" id="h48-0-137" class="i">+	int len;               /* raw string length */
</a><a href="#h48-0-138" id="h48-0-138" class="i">+	char priv;
</a><a href="#h48-0-139" id="h48-0-139" class="i">+	int arg[ESC_ARG_SIZ];
</a><a href="#h48-0-140" id="h48-0-140" class="i">+	int narg;              /* nb of args */
</a><a href="#h48-0-141" id="h48-0-141" class="i">+	char mode[2];
</a><a href="#h48-0-142" id="h48-0-142" class="i">+} CSIEscape;
</a><a href="#h48-0-143" id="h48-0-143" class="i">+
</a><a href="#h48-0-144" id="h48-0-144" class="i">+/* STR Escape sequence structs */
</a><a href="#h48-0-145" id="h48-0-145" class="i">+/* ESC type [[ [&lt;priv&gt;] &lt;arg&gt; [;]] &lt;mode&gt;] ESC &#39;\&#39; */
</a><a href="#h48-0-146" id="h48-0-146" class="i">+typedef struct {
</a><a href="#h48-0-147" id="h48-0-147" class="i">+	char type;             /* ESC type ... */
</a><a href="#h48-0-148" id="h48-0-148" class="i">+	char buf[STR_BUF_SIZ]; /* raw string */
</a><a href="#h48-0-149" id="h48-0-149" class="i">+	int len;               /* raw string length */
</a><a href="#h48-0-150" id="h48-0-150" class="i">+	char *args[STR_ARG_SIZ];
</a><a href="#h48-0-151" id="h48-0-151" class="i">+	int narg;              /* nb of args */
</a><a href="#h48-0-152" id="h48-0-152" class="i">+} STREscape;
</a><a href="#h48-0-153" id="h48-0-153" class="i">+
</a><a href="#h48-0-154" id="h48-0-154" class="i">+static void execsh(char *, char **);
</a><a href="#h48-0-155" id="h48-0-155" class="i">+static void stty(char **);
</a><a href="#h48-0-156" id="h48-0-156" class="i">+static void sigchld(int);
</a><a href="#h48-0-157" id="h48-0-157" class="i">+static void ttywriteraw(const char *, size_t);
</a><a href="#h48-0-158" id="h48-0-158" class="i">+
</a><a href="#h48-0-159" id="h48-0-159" class="i">+static void csidump(void);
</a><a href="#h48-0-160" id="h48-0-160" class="i">+static void csihandle(void);
</a><a href="#h48-0-161" id="h48-0-161" class="i">+static void csiparse(void);
</a><a href="#h48-0-162" id="h48-0-162" class="i">+static void csireset(void);
</a><a href="#h48-0-163" id="h48-0-163" class="i">+static int eschandle(uchar);
</a><a href="#h48-0-164" id="h48-0-164" class="i">+static void strdump(void);
</a><a href="#h48-0-165" id="h48-0-165" class="i">+static void strhandle(void);
</a><a href="#h48-0-166" id="h48-0-166" class="i">+static void strparse(void);
</a><a href="#h48-0-167" id="h48-0-167" class="i">+static void strreset(void);
</a><a href="#h48-0-168" id="h48-0-168" class="i">+
</a><a href="#h48-0-169" id="h48-0-169" class="i">+static void tprinter(char *, size_t);
</a><a href="#h48-0-170" id="h48-0-170" class="i">+static void tdumpsel(void);
</a><a href="#h48-0-171" id="h48-0-171" class="i">+static void tdumpline(int);
</a><a href="#h48-0-172" id="h48-0-172" class="i">+static void tdump(void);
</a><a href="#h48-0-173" id="h48-0-173" class="i">+static void tclearregion(int, int, int, int);
</a><a href="#h48-0-174" id="h48-0-174" class="i">+static void tcursor(int);
</a><a href="#h48-0-175" id="h48-0-175" class="i">+static void tdeletechar(int);
</a><a href="#h48-0-176" id="h48-0-176" class="i">+static void tdeleteline(int);
</a><a href="#h48-0-177" id="h48-0-177" class="i">+static void tinsertblank(int);
</a><a href="#h48-0-178" id="h48-0-178" class="i">+static void tinsertblankline(int);
</a><a href="#h48-0-179" id="h48-0-179" class="i">+static int tlinelen(int);
</a><a href="#h48-0-180" id="h48-0-180" class="i">+static void tmoveto(int, int);
</a><a href="#h48-0-181" id="h48-0-181" class="i">+static void tmoveato(int, int);
</a><a href="#h48-0-182" id="h48-0-182" class="i">+static void tnewline(int);
</a><a href="#h48-0-183" id="h48-0-183" class="i">+static void tputtab(int);
</a><a href="#h48-0-184" id="h48-0-184" class="i">+static void tputc(Rune);
</a><a href="#h48-0-185" id="h48-0-185" class="i">+static void treset(void);
</a><a href="#h48-0-186" id="h48-0-186" class="i">+static void tscrollup(int, int);
</a><a href="#h48-0-187" id="h48-0-187" class="i">+static void tscrolldown(int, int);
</a><a href="#h48-0-188" id="h48-0-188" class="i">+static void tsetattr(int *, int);
</a><a href="#h48-0-189" id="h48-0-189" class="i">+static void tsetchar(Rune, Glyph *, int, int);
</a><a href="#h48-0-190" id="h48-0-190" class="i">+static void tsetdirt(int, int);
</a><a href="#h48-0-191" id="h48-0-191" class="i">+static void tsetscroll(int, int);
</a><a href="#h48-0-192" id="h48-0-192" class="i">+static void tswapscreen(void);
</a><a href="#h48-0-193" id="h48-0-193" class="i">+static void tsetmode(int, int, int *, int);
</a><a href="#h48-0-194" id="h48-0-194" class="i">+static int twrite(const char *, int, int);
</a><a href="#h48-0-195" id="h48-0-195" class="i">+static void tfulldirt(void);
</a><a href="#h48-0-196" id="h48-0-196" class="i">+static void tcontrolcode(uchar );
</a><a href="#h48-0-197" id="h48-0-197" class="i">+static void tdectest(char );
</a><a href="#h48-0-198" id="h48-0-198" class="i">+static void tdefutf8(char);
</a><a href="#h48-0-199" id="h48-0-199" class="i">+static int32_t tdefcolor(int *, int *, int);
</a><a href="#h48-0-200" id="h48-0-200" class="i">+static void tdeftran(char);
</a><a href="#h48-0-201" id="h48-0-201" class="i">+static void tstrsequence(uchar);
</a><a href="#h48-0-202" id="h48-0-202" class="i">+
</a><a href="#h48-0-203" id="h48-0-203" class="i">+static void drawregion(int, int, int, int);
</a><a href="#h48-0-204" id="h48-0-204" class="i">+
</a><a href="#h48-0-205" id="h48-0-205" class="i">+static void selnormalize(void);
</a><a href="#h48-0-206" id="h48-0-206" class="i">+static void selscroll(int, int);
</a><a href="#h48-0-207" id="h48-0-207" class="i">+static void selsnap(int *, int *, int);
</a><a href="#h48-0-208" id="h48-0-208" class="i">+
</a><a href="#h48-0-209" id="h48-0-209" class="i">+static size_t utf8decode(const char *, Rune *, size_t);
</a><a href="#h48-0-210" id="h48-0-210" class="i">+static Rune utf8decodebyte(char, size_t *);
</a><a href="#h48-0-211" id="h48-0-211" class="i">+static char utf8encodebyte(Rune, size_t);
</a><a href="#h48-0-212" id="h48-0-212" class="i">+static char *utf8strchr(char *, Rune);
</a><a href="#h48-0-213" id="h48-0-213" class="i">+static size_t utf8validate(Rune *, size_t);
</a><a href="#h48-0-214" id="h48-0-214" class="i">+
</a><a href="#h48-0-215" id="h48-0-215" class="i">+static char *base64dec(const char *);
</a><a href="#h48-0-216" id="h48-0-216" class="i">+static char base64dec_getc(const char **);
</a><a href="#h48-0-217" id="h48-0-217" class="i">+
</a><a href="#h48-0-218" id="h48-0-218" class="i">+static ssize_t xwrite(int, const char *, size_t);
</a><a href="#h48-0-219" id="h48-0-219" class="i">+
</a><a href="#h48-0-220" id="h48-0-220" class="i">+/* Globals */
</a><a href="#h48-0-221" id="h48-0-221" class="i">+static Term term;
</a><a href="#h48-0-222" id="h48-0-222" class="i">+static Selection sel;
</a><a href="#h48-0-223" id="h48-0-223" class="i">+static CSIEscape csiescseq;
</a><a href="#h48-0-224" id="h48-0-224" class="i">+static STREscape strescseq;
</a><a href="#h48-0-225" id="h48-0-225" class="i">+static int iofd = 1;
</a><a href="#h48-0-226" id="h48-0-226" class="i">+static int cmdfd;
</a><a href="#h48-0-227" id="h48-0-227" class="i">+static pid_t pid;
</a><a href="#h48-0-228" id="h48-0-228" class="i">+
</a><a href="#h48-0-229" id="h48-0-229" class="i">+static uchar utfbyte[UTF_SIZ + 1] = {0x80,    0, 0xC0, 0xE0, 0xF0};
</a><a href="#h48-0-230" id="h48-0-230" class="i">+static uchar utfmask[UTF_SIZ + 1] = {0xC0, 0x80, 0xE0, 0xF0, 0xF8};
</a><a href="#h48-0-231" id="h48-0-231" class="i">+static Rune utfmin[UTF_SIZ + 1] = {       0,    0,  0x80,  0x800,  0x10000};
</a><a href="#h48-0-232" id="h48-0-232" class="i">+static Rune utfmax[UTF_SIZ + 1] = {0x10FFFF, 0x7F, 0x7FF, 0xFFFF, 0x10FFFF};
</a><a href="#h48-0-233" id="h48-0-233" class="i">+
</a><a href="#h48-0-234" id="h48-0-234" class="i">+ssize_t
</a><a href="#h48-0-235" id="h48-0-235" class="i">+xwrite(int fd, const char *s, size_t len)
</a><a href="#h48-0-236" id="h48-0-236" class="i">+{
</a><a href="#h48-0-237" id="h48-0-237" class="i">+	size_t aux = len;
</a><a href="#h48-0-238" id="h48-0-238" class="i">+	ssize_t r;
</a><a href="#h48-0-239" id="h48-0-239" class="i">+
</a><a href="#h48-0-240" id="h48-0-240" class="i">+	while (len &gt; 0) {
</a><a href="#h48-0-241" id="h48-0-241" class="i">+		r = write(fd, s, len);
</a><a href="#h48-0-242" id="h48-0-242" class="i">+		if (r &lt; 0)
</a><a href="#h48-0-243" id="h48-0-243" class="i">+			return r;
</a><a href="#h48-0-244" id="h48-0-244" class="i">+		len -= r;
</a><a href="#h48-0-245" id="h48-0-245" class="i">+		s += r;
</a><a href="#h48-0-246" id="h48-0-246" class="i">+	}
</a><a href="#h48-0-247" id="h48-0-247" class="i">+
</a><a href="#h48-0-248" id="h48-0-248" class="i">+	return aux;
</a><a href="#h48-0-249" id="h48-0-249" class="i">+}
</a><a href="#h48-0-250" id="h48-0-250" class="i">+
</a><a href="#h48-0-251" id="h48-0-251" class="i">+void *
</a><a href="#h48-0-252" id="h48-0-252" class="i">+xmalloc(size_t len)
</a><a href="#h48-0-253" id="h48-0-253" class="i">+{
</a><a href="#h48-0-254" id="h48-0-254" class="i">+	void *p;
</a><a href="#h48-0-255" id="h48-0-255" class="i">+
</a><a href="#h48-0-256" id="h48-0-256" class="i">+	if (!(p = malloc(len)))
</a><a href="#h48-0-257" id="h48-0-257" class="i">+		die(&quot;malloc: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-258" id="h48-0-258" class="i">+
</a><a href="#h48-0-259" id="h48-0-259" class="i">+	return p;
</a><a href="#h48-0-260" id="h48-0-260" class="i">+}
</a><a href="#h48-0-261" id="h48-0-261" class="i">+
</a><a href="#h48-0-262" id="h48-0-262" class="i">+void *
</a><a href="#h48-0-263" id="h48-0-263" class="i">+xrealloc(void *p, size_t len)
</a><a href="#h48-0-264" id="h48-0-264" class="i">+{
</a><a href="#h48-0-265" id="h48-0-265" class="i">+	if ((p = realloc(p, len)) == NULL)
</a><a href="#h48-0-266" id="h48-0-266" class="i">+		die(&quot;realloc: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-267" id="h48-0-267" class="i">+
</a><a href="#h48-0-268" id="h48-0-268" class="i">+	return p;
</a><a href="#h48-0-269" id="h48-0-269" class="i">+}
</a><a href="#h48-0-270" id="h48-0-270" class="i">+
</a><a href="#h48-0-271" id="h48-0-271" class="i">+char *
</a><a href="#h48-0-272" id="h48-0-272" class="i">+xstrdup(char *s)
</a><a href="#h48-0-273" id="h48-0-273" class="i">+{
</a><a href="#h48-0-274" id="h48-0-274" class="i">+	if ((s = strdup(s)) == NULL)
</a><a href="#h48-0-275" id="h48-0-275" class="i">+		die(&quot;strdup: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-276" id="h48-0-276" class="i">+
</a><a href="#h48-0-277" id="h48-0-277" class="i">+	return s;
</a><a href="#h48-0-278" id="h48-0-278" class="i">+}
</a><a href="#h48-0-279" id="h48-0-279" class="i">+
</a><a href="#h48-0-280" id="h48-0-280" class="i">+size_t
</a><a href="#h48-0-281" id="h48-0-281" class="i">+utf8decode(const char *c, Rune *u, size_t clen)
</a><a href="#h48-0-282" id="h48-0-282" class="i">+{
</a><a href="#h48-0-283" id="h48-0-283" class="i">+	size_t i, j, len, type;
</a><a href="#h48-0-284" id="h48-0-284" class="i">+	Rune udecoded;
</a><a href="#h48-0-285" id="h48-0-285" class="i">+
</a><a href="#h48-0-286" id="h48-0-286" class="i">+	*u = UTF_INVALID;
</a><a href="#h48-0-287" id="h48-0-287" class="i">+	if (!clen)
</a><a href="#h48-0-288" id="h48-0-288" class="i">+		return 0;
</a><a href="#h48-0-289" id="h48-0-289" class="i">+	udecoded = utf8decodebyte(c[0], &amp;len);
</a><a href="#h48-0-290" id="h48-0-290" class="i">+	if (!BETWEEN(len, 1, UTF_SIZ))
</a><a href="#h48-0-291" id="h48-0-291" class="i">+		return 1;
</a><a href="#h48-0-292" id="h48-0-292" class="i">+	for (i = 1, j = 1; i &lt; clen &amp;&amp; j &lt; len; ++i, ++j) {
</a><a href="#h48-0-293" id="h48-0-293" class="i">+		udecoded = (udecoded &lt;&lt; 6) | utf8decodebyte(c[i], &amp;type);
</a><a href="#h48-0-294" id="h48-0-294" class="i">+		if (type != 0)
</a><a href="#h48-0-295" id="h48-0-295" class="i">+			return j;
</a><a href="#h48-0-296" id="h48-0-296" class="i">+	}
</a><a href="#h48-0-297" id="h48-0-297" class="i">+	if (j &lt; len)
</a><a href="#h48-0-298" id="h48-0-298" class="i">+		return 0;
</a><a href="#h48-0-299" id="h48-0-299" class="i">+	*u = udecoded;
</a><a href="#h48-0-300" id="h48-0-300" class="i">+	utf8validate(u, len);
</a><a href="#h48-0-301" id="h48-0-301" class="i">+
</a><a href="#h48-0-302" id="h48-0-302" class="i">+	return len;
</a><a href="#h48-0-303" id="h48-0-303" class="i">+}
</a><a href="#h48-0-304" id="h48-0-304" class="i">+
</a><a href="#h48-0-305" id="h48-0-305" class="i">+Rune
</a><a href="#h48-0-306" id="h48-0-306" class="i">+utf8decodebyte(char c, size_t *i)
</a><a href="#h48-0-307" id="h48-0-307" class="i">+{
</a><a href="#h48-0-308" id="h48-0-308" class="i">+	for (*i = 0; *i &lt; LEN(utfmask); ++(*i))
</a><a href="#h48-0-309" id="h48-0-309" class="i">+		if (((uchar)c &amp; utfmask[*i]) == utfbyte[*i])
</a><a href="#h48-0-310" id="h48-0-310" class="i">+			return (uchar)c &amp; ~utfmask[*i];
</a><a href="#h48-0-311" id="h48-0-311" class="i">+
</a><a href="#h48-0-312" id="h48-0-312" class="i">+	return 0;
</a><a href="#h48-0-313" id="h48-0-313" class="i">+}
</a><a href="#h48-0-314" id="h48-0-314" class="i">+
</a><a href="#h48-0-315" id="h48-0-315" class="i">+size_t
</a><a href="#h48-0-316" id="h48-0-316" class="i">+utf8encode(Rune u, char *c)
</a><a href="#h48-0-317" id="h48-0-317" class="i">+{
</a><a href="#h48-0-318" id="h48-0-318" class="i">+	size_t len, i;
</a><a href="#h48-0-319" id="h48-0-319" class="i">+
</a><a href="#h48-0-320" id="h48-0-320" class="i">+	len = utf8validate(&amp;u, 0);
</a><a href="#h48-0-321" id="h48-0-321" class="i">+	if (len &gt; UTF_SIZ)
</a><a href="#h48-0-322" id="h48-0-322" class="i">+		return 0;
</a><a href="#h48-0-323" id="h48-0-323" class="i">+
</a><a href="#h48-0-324" id="h48-0-324" class="i">+	for (i = len - 1; i != 0; --i) {
</a><a href="#h48-0-325" id="h48-0-325" class="i">+		c[i] = utf8encodebyte(u, 0);
</a><a href="#h48-0-326" id="h48-0-326" class="i">+		u &gt;&gt;= 6;
</a><a href="#h48-0-327" id="h48-0-327" class="i">+	}
</a><a href="#h48-0-328" id="h48-0-328" class="i">+	c[0] = utf8encodebyte(u, len);
</a><a href="#h48-0-329" id="h48-0-329" class="i">+
</a><a href="#h48-0-330" id="h48-0-330" class="i">+	return len;
</a><a href="#h48-0-331" id="h48-0-331" class="i">+}
</a><a href="#h48-0-332" id="h48-0-332" class="i">+
</a><a href="#h48-0-333" id="h48-0-333" class="i">+char
</a><a href="#h48-0-334" id="h48-0-334" class="i">+utf8encodebyte(Rune u, size_t i)
</a><a href="#h48-0-335" id="h48-0-335" class="i">+{
</a><a href="#h48-0-336" id="h48-0-336" class="i">+	return utfbyte[i] | (u &amp; ~utfmask[i]);
</a><a href="#h48-0-337" id="h48-0-337" class="i">+}
</a><a href="#h48-0-338" id="h48-0-338" class="i">+
</a><a href="#h48-0-339" id="h48-0-339" class="i">+char *
</a><a href="#h48-0-340" id="h48-0-340" class="i">+utf8strchr(char *s, Rune u)
</a><a href="#h48-0-341" id="h48-0-341" class="i">+{
</a><a href="#h48-0-342" id="h48-0-342" class="i">+	Rune r;
</a><a href="#h48-0-343" id="h48-0-343" class="i">+	size_t i, j, len;
</a><a href="#h48-0-344" id="h48-0-344" class="i">+
</a><a href="#h48-0-345" id="h48-0-345" class="i">+	len = strlen(s);
</a><a href="#h48-0-346" id="h48-0-346" class="i">+	for (i = 0, j = 0; i &lt; len; i += j) {
</a><a href="#h48-0-347" id="h48-0-347" class="i">+		if (!(j = utf8decode(&amp;s[i], &amp;r, len - i)))
</a><a href="#h48-0-348" id="h48-0-348" class="i">+			break;
</a><a href="#h48-0-349" id="h48-0-349" class="i">+		if (r == u)
</a><a href="#h48-0-350" id="h48-0-350" class="i">+			return &amp;(s[i]);
</a><a href="#h48-0-351" id="h48-0-351" class="i">+	}
</a><a href="#h48-0-352" id="h48-0-352" class="i">+
</a><a href="#h48-0-353" id="h48-0-353" class="i">+	return NULL;
</a><a href="#h48-0-354" id="h48-0-354" class="i">+}
</a><a href="#h48-0-355" id="h48-0-355" class="i">+
</a><a href="#h48-0-356" id="h48-0-356" class="i">+size_t
</a><a href="#h48-0-357" id="h48-0-357" class="i">+utf8validate(Rune *u, size_t i)
</a><a href="#h48-0-358" id="h48-0-358" class="i">+{
</a><a href="#h48-0-359" id="h48-0-359" class="i">+	if (!BETWEEN(*u, utfmin[i], utfmax[i]) || BETWEEN(*u, 0xD800, 0xDFFF))
</a><a href="#h48-0-360" id="h48-0-360" class="i">+		*u = UTF_INVALID;
</a><a href="#h48-0-361" id="h48-0-361" class="i">+	for (i = 1; *u &gt; utfmax[i]; ++i)
</a><a href="#h48-0-362" id="h48-0-362" class="i">+		;
</a><a href="#h48-0-363" id="h48-0-363" class="i">+
</a><a href="#h48-0-364" id="h48-0-364" class="i">+	return i;
</a><a href="#h48-0-365" id="h48-0-365" class="i">+}
</a><a href="#h48-0-366" id="h48-0-366" class="i">+
</a><a href="#h48-0-367" id="h48-0-367" class="i">+static const char base64_digits[] = {
</a><a href="#h48-0-368" id="h48-0-368" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
</a><a href="#h48-0-369" id="h48-0-369" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 62, 0, 0, 0,
</a><a href="#h48-0-370" id="h48-0-370" class="i">+	63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 0, 0, 0, -1, 0, 0, 0, 0, 1,
</a><a href="#h48-0-371" id="h48-0-371" class="i">+	2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
</a><a href="#h48-0-372" id="h48-0-372" class="i">+	22, 23, 24, 25, 0, 0, 0, 0, 0, 0, 26, 27, 28, 29, 30, 31, 32, 33, 34,
</a><a href="#h48-0-373" id="h48-0-373" class="i">+	35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 0,
</a><a href="#h48-0-374" id="h48-0-374" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
</a><a href="#h48-0-375" id="h48-0-375" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
</a><a href="#h48-0-376" id="h48-0-376" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
</a><a href="#h48-0-377" id="h48-0-377" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
</a><a href="#h48-0-378" id="h48-0-378" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
</a><a href="#h48-0-379" id="h48-0-379" class="i">+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
</a><a href="#h48-0-380" id="h48-0-380" class="i">+};
</a><a href="#h48-0-381" id="h48-0-381" class="i">+
</a><a href="#h48-0-382" id="h48-0-382" class="i">+char
</a><a href="#h48-0-383" id="h48-0-383" class="i">+base64dec_getc(const char **src)
</a><a href="#h48-0-384" id="h48-0-384" class="i">+{
</a><a href="#h48-0-385" id="h48-0-385" class="i">+	while (**src &amp;&amp; !isprint(**src)) (*src)++;
</a><a href="#h48-0-386" id="h48-0-386" class="i">+	return *((*src)++);
</a><a href="#h48-0-387" id="h48-0-387" class="i">+}
</a><a href="#h48-0-388" id="h48-0-388" class="i">+
</a><a href="#h48-0-389" id="h48-0-389" class="i">+char *
</a><a href="#h48-0-390" id="h48-0-390" class="i">+base64dec(const char *src)
</a><a href="#h48-0-391" id="h48-0-391" class="i">+{
</a><a href="#h48-0-392" id="h48-0-392" class="i">+	size_t in_len = strlen(src);
</a><a href="#h48-0-393" id="h48-0-393" class="i">+	char *result, *dst;
</a><a href="#h48-0-394" id="h48-0-394" class="i">+
</a><a href="#h48-0-395" id="h48-0-395" class="i">+	if (in_len % 4)
</a><a href="#h48-0-396" id="h48-0-396" class="i">+		in_len += 4 - (in_len % 4);
</a><a href="#h48-0-397" id="h48-0-397" class="i">+	result = dst = xmalloc(in_len / 4 * 3 + 1);
</a><a href="#h48-0-398" id="h48-0-398" class="i">+	while (*src) {
</a><a href="#h48-0-399" id="h48-0-399" class="i">+		int a = base64_digits[(unsigned char) base64dec_getc(&amp;src)];
</a><a href="#h48-0-400" id="h48-0-400" class="i">+		int b = base64_digits[(unsigned char) base64dec_getc(&amp;src)];
</a><a href="#h48-0-401" id="h48-0-401" class="i">+		int c = base64_digits[(unsigned char) base64dec_getc(&amp;src)];
</a><a href="#h48-0-402" id="h48-0-402" class="i">+		int d = base64_digits[(unsigned char) base64dec_getc(&amp;src)];
</a><a href="#h48-0-403" id="h48-0-403" class="i">+
</a><a href="#h48-0-404" id="h48-0-404" class="i">+		*dst++ = (a &lt;&lt; 2) | ((b &amp; 0x30) &gt;&gt; 4);
</a><a href="#h48-0-405" id="h48-0-405" class="i">+		if (c == -1)
</a><a href="#h48-0-406" id="h48-0-406" class="i">+			break;
</a><a href="#h48-0-407" id="h48-0-407" class="i">+		*dst++ = ((b &amp; 0x0f) &lt;&lt; 4) | ((c &amp; 0x3c) &gt;&gt; 2);
</a><a href="#h48-0-408" id="h48-0-408" class="i">+		if (d == -1)
</a><a href="#h48-0-409" id="h48-0-409" class="i">+			break;
</a><a href="#h48-0-410" id="h48-0-410" class="i">+		*dst++ = ((c &amp; 0x03) &lt;&lt; 6) | d;
</a><a href="#h48-0-411" id="h48-0-411" class="i">+	}
</a><a href="#h48-0-412" id="h48-0-412" class="i">+	*dst = &#39;\0&#39;;
</a><a href="#h48-0-413" id="h48-0-413" class="i">+	return result;
</a><a href="#h48-0-414" id="h48-0-414" class="i">+}
</a><a href="#h48-0-415" id="h48-0-415" class="i">+
</a><a href="#h48-0-416" id="h48-0-416" class="i">+void
</a><a href="#h48-0-417" id="h48-0-417" class="i">+selinit(void)
</a><a href="#h48-0-418" id="h48-0-418" class="i">+{
</a><a href="#h48-0-419" id="h48-0-419" class="i">+	sel.mode = SEL_IDLE;
</a><a href="#h48-0-420" id="h48-0-420" class="i">+	sel.snap = 0;
</a><a href="#h48-0-421" id="h48-0-421" class="i">+	sel.ob.x = -1;
</a><a href="#h48-0-422" id="h48-0-422" class="i">+}
</a><a href="#h48-0-423" id="h48-0-423" class="i">+
</a><a href="#h48-0-424" id="h48-0-424" class="i">+int
</a><a href="#h48-0-425" id="h48-0-425" class="i">+tlinelen(int y)
</a><a href="#h48-0-426" id="h48-0-426" class="i">+{
</a><a href="#h48-0-427" id="h48-0-427" class="i">+	int i = term.col;
</a><a href="#h48-0-428" id="h48-0-428" class="i">+
</a><a href="#h48-0-429" id="h48-0-429" class="i">+	if (term.line[y][i - 1].mode &amp; ATTR_WRAP)
</a><a href="#h48-0-430" id="h48-0-430" class="i">+		return i;
</a><a href="#h48-0-431" id="h48-0-431" class="i">+
</a><a href="#h48-0-432" id="h48-0-432" class="i">+	while (i &gt; 0 &amp;&amp; term.line[y][i - 1].u == &#39; &#39;)
</a><a href="#h48-0-433" id="h48-0-433" class="i">+		--i;
</a><a href="#h48-0-434" id="h48-0-434" class="i">+
</a><a href="#h48-0-435" id="h48-0-435" class="i">+	return i;
</a><a href="#h48-0-436" id="h48-0-436" class="i">+}
</a><a href="#h48-0-437" id="h48-0-437" class="i">+
</a><a href="#h48-0-438" id="h48-0-438" class="i">+void
</a><a href="#h48-0-439" id="h48-0-439" class="i">+selstart(int col, int row, int snap)
</a><a href="#h48-0-440" id="h48-0-440" class="i">+{
</a><a href="#h48-0-441" id="h48-0-441" class="i">+	selclear();
</a><a href="#h48-0-442" id="h48-0-442" class="i">+	sel.mode = SEL_EMPTY;
</a><a href="#h48-0-443" id="h48-0-443" class="i">+	sel.type = SEL_REGULAR;
</a><a href="#h48-0-444" id="h48-0-444" class="i">+	sel.alt = IS_SET(MODE_ALTSCREEN);
</a><a href="#h48-0-445" id="h48-0-445" class="i">+	sel.snap = snap;
</a><a href="#h48-0-446" id="h48-0-446" class="i">+	sel.oe.x = sel.ob.x = col;
</a><a href="#h48-0-447" id="h48-0-447" class="i">+	sel.oe.y = sel.ob.y = row;
</a><a href="#h48-0-448" id="h48-0-448" class="i">+	selnormalize();
</a><a href="#h48-0-449" id="h48-0-449" class="i">+
</a><a href="#h48-0-450" id="h48-0-450" class="i">+	if (sel.snap != 0)
</a><a href="#h48-0-451" id="h48-0-451" class="i">+		sel.mode = SEL_READY;
</a><a href="#h48-0-452" id="h48-0-452" class="i">+	tsetdirt(sel.nb.y, sel.ne.y);
</a><a href="#h48-0-453" id="h48-0-453" class="i">+}
</a><a href="#h48-0-454" id="h48-0-454" class="i">+
</a><a href="#h48-0-455" id="h48-0-455" class="i">+void
</a><a href="#h48-0-456" id="h48-0-456" class="i">+selextend(int col, int row, int type, int done)
</a><a href="#h48-0-457" id="h48-0-457" class="i">+{
</a><a href="#h48-0-458" id="h48-0-458" class="i">+	int oldey, oldex, oldsby, oldsey, oldtype;
</a><a href="#h48-0-459" id="h48-0-459" class="i">+
</a><a href="#h48-0-460" id="h48-0-460" class="i">+	if (sel.mode == SEL_IDLE)
</a><a href="#h48-0-461" id="h48-0-461" class="i">+		return;
</a><a href="#h48-0-462" id="h48-0-462" class="i">+	if (done &amp;&amp; sel.mode == SEL_EMPTY) {
</a><a href="#h48-0-463" id="h48-0-463" class="i">+		selclear();
</a><a href="#h48-0-464" id="h48-0-464" class="i">+		return;
</a><a href="#h48-0-465" id="h48-0-465" class="i">+	}
</a><a href="#h48-0-466" id="h48-0-466" class="i">+
</a><a href="#h48-0-467" id="h48-0-467" class="i">+	oldey = sel.oe.y;
</a><a href="#h48-0-468" id="h48-0-468" class="i">+	oldex = sel.oe.x;
</a><a href="#h48-0-469" id="h48-0-469" class="i">+	oldsby = sel.nb.y;
</a><a href="#h48-0-470" id="h48-0-470" class="i">+	oldsey = sel.ne.y;
</a><a href="#h48-0-471" id="h48-0-471" class="i">+	oldtype = sel.type;
</a><a href="#h48-0-472" id="h48-0-472" class="i">+
</a><a href="#h48-0-473" id="h48-0-473" class="i">+	sel.oe.x = col;
</a><a href="#h48-0-474" id="h48-0-474" class="i">+	sel.oe.y = row;
</a><a href="#h48-0-475" id="h48-0-475" class="i">+	selnormalize();
</a><a href="#h48-0-476" id="h48-0-476" class="i">+	sel.type = type;
</a><a href="#h48-0-477" id="h48-0-477" class="i">+
</a><a href="#h48-0-478" id="h48-0-478" class="i">+	if (oldey != sel.oe.y || oldex != sel.oe.x || oldtype != sel.type)
</a><a href="#h48-0-479" id="h48-0-479" class="i">+		tsetdirt(MIN(sel.nb.y, oldsby), MAX(sel.ne.y, oldsey));
</a><a href="#h48-0-480" id="h48-0-480" class="i">+
</a><a href="#h48-0-481" id="h48-0-481" class="i">+	sel.mode = done ? SEL_IDLE : SEL_READY;
</a><a href="#h48-0-482" id="h48-0-482" class="i">+}
</a><a href="#h48-0-483" id="h48-0-483" class="i">+
</a><a href="#h48-0-484" id="h48-0-484" class="i">+void
</a><a href="#h48-0-485" id="h48-0-485" class="i">+selnormalize(void)
</a><a href="#h48-0-486" id="h48-0-486" class="i">+{
</a><a href="#h48-0-487" id="h48-0-487" class="i">+	int i;
</a><a href="#h48-0-488" id="h48-0-488" class="i">+
</a><a href="#h48-0-489" id="h48-0-489" class="i">+	if (sel.type == SEL_REGULAR &amp;&amp; sel.ob.y != sel.oe.y) {
</a><a href="#h48-0-490" id="h48-0-490" class="i">+		sel.nb.x = sel.ob.y &lt; sel.oe.y ? sel.ob.x : sel.oe.x;
</a><a href="#h48-0-491" id="h48-0-491" class="i">+		sel.ne.x = sel.ob.y &lt; sel.oe.y ? sel.oe.x : sel.ob.x;
</a><a href="#h48-0-492" id="h48-0-492" class="i">+	} else {
</a><a href="#h48-0-493" id="h48-0-493" class="i">+		sel.nb.x = MIN(sel.ob.x, sel.oe.x);
</a><a href="#h48-0-494" id="h48-0-494" class="i">+		sel.ne.x = MAX(sel.ob.x, sel.oe.x);
</a><a href="#h48-0-495" id="h48-0-495" class="i">+	}
</a><a href="#h48-0-496" id="h48-0-496" class="i">+	sel.nb.y = MIN(sel.ob.y, sel.oe.y);
</a><a href="#h48-0-497" id="h48-0-497" class="i">+	sel.ne.y = MAX(sel.ob.y, sel.oe.y);
</a><a href="#h48-0-498" id="h48-0-498" class="i">+
</a><a href="#h48-0-499" id="h48-0-499" class="i">+	selsnap(&amp;sel.nb.x, &amp;sel.nb.y, -1);
</a><a href="#h48-0-500" id="h48-0-500" class="i">+	selsnap(&amp;sel.ne.x, &amp;sel.ne.y, +1);
</a><a href="#h48-0-501" id="h48-0-501" class="i">+
</a><a href="#h48-0-502" id="h48-0-502" class="i">+	/* expand selection over line breaks */
</a><a href="#h48-0-503" id="h48-0-503" class="i">+	if (sel.type == SEL_RECTANGULAR)
</a><a href="#h48-0-504" id="h48-0-504" class="i">+		return;
</a><a href="#h48-0-505" id="h48-0-505" class="i">+	i = tlinelen(sel.nb.y);
</a><a href="#h48-0-506" id="h48-0-506" class="i">+	if (i &lt; sel.nb.x)
</a><a href="#h48-0-507" id="h48-0-507" class="i">+		sel.nb.x = i;
</a><a href="#h48-0-508" id="h48-0-508" class="i">+	if (tlinelen(sel.ne.y) &lt;= sel.ne.x)
</a><a href="#h48-0-509" id="h48-0-509" class="i">+		sel.ne.x = term.col - 1;
</a><a href="#h48-0-510" id="h48-0-510" class="i">+}
</a><a href="#h48-0-511" id="h48-0-511" class="i">+
</a><a href="#h48-0-512" id="h48-0-512" class="i">+int
</a><a href="#h48-0-513" id="h48-0-513" class="i">+selected(int x, int y)
</a><a href="#h48-0-514" id="h48-0-514" class="i">+{
</a><a href="#h48-0-515" id="h48-0-515" class="i">+	if (sel.mode == SEL_EMPTY || sel.ob.x == -1 ||
</a><a href="#h48-0-516" id="h48-0-516" class="i">+			sel.alt != IS_SET(MODE_ALTSCREEN))
</a><a href="#h48-0-517" id="h48-0-517" class="i">+		return 0;
</a><a href="#h48-0-518" id="h48-0-518" class="i">+
</a><a href="#h48-0-519" id="h48-0-519" class="i">+	if (sel.type == SEL_RECTANGULAR)
</a><a href="#h48-0-520" id="h48-0-520" class="i">+		return BETWEEN(y, sel.nb.y, sel.ne.y)
</a><a href="#h48-0-521" id="h48-0-521" class="i">+		    &amp;&amp; BETWEEN(x, sel.nb.x, sel.ne.x);
</a><a href="#h48-0-522" id="h48-0-522" class="i">+
</a><a href="#h48-0-523" id="h48-0-523" class="i">+	return BETWEEN(y, sel.nb.y, sel.ne.y)
</a><a href="#h48-0-524" id="h48-0-524" class="i">+	    &amp;&amp; (y != sel.nb.y || x &gt;= sel.nb.x)
</a><a href="#h48-0-525" id="h48-0-525" class="i">+	    &amp;&amp; (y != sel.ne.y || x &lt;= sel.ne.x);
</a><a href="#h48-0-526" id="h48-0-526" class="i">+}
</a><a href="#h48-0-527" id="h48-0-527" class="i">+
</a><a href="#h48-0-528" id="h48-0-528" class="i">+void
</a><a href="#h48-0-529" id="h48-0-529" class="i">+selsnap(int *x, int *y, int direction)
</a><a href="#h48-0-530" id="h48-0-530" class="i">+{
</a><a href="#h48-0-531" id="h48-0-531" class="i">+	int newx, newy, xt, yt;
</a><a href="#h48-0-532" id="h48-0-532" class="i">+	int delim, prevdelim;
</a><a href="#h48-0-533" id="h48-0-533" class="i">+	Glyph *gp, *prevgp;
</a><a href="#h48-0-534" id="h48-0-534" class="i">+
</a><a href="#h48-0-535" id="h48-0-535" class="i">+	switch (sel.snap) {
</a><a href="#h48-0-536" id="h48-0-536" class="i">+	case SNAP_WORD:
</a><a href="#h48-0-537" id="h48-0-537" class="i">+		/*
</a><a href="#h48-0-538" id="h48-0-538" class="i">+		 * Snap around if the word wraps around at the end or
</a><a href="#h48-0-539" id="h48-0-539" class="i">+		 * beginning of a line.
</a><a href="#h48-0-540" id="h48-0-540" class="i">+		 */
</a><a href="#h48-0-541" id="h48-0-541" class="i">+		prevgp = &amp;term.line[*y][*x];
</a><a href="#h48-0-542" id="h48-0-542" class="i">+		prevdelim = ISDELIM(prevgp-&gt;u);
</a><a href="#h48-0-543" id="h48-0-543" class="i">+		for (;;) {
</a><a href="#h48-0-544" id="h48-0-544" class="i">+			newx = *x + direction;
</a><a href="#h48-0-545" id="h48-0-545" class="i">+			newy = *y;
</a><a href="#h48-0-546" id="h48-0-546" class="i">+			if (!BETWEEN(newx, 0, term.col - 1)) {
</a><a href="#h48-0-547" id="h48-0-547" class="i">+				newy += direction;
</a><a href="#h48-0-548" id="h48-0-548" class="i">+				newx = (newx + term.col) % term.col;
</a><a href="#h48-0-549" id="h48-0-549" class="i">+				if (!BETWEEN(newy, 0, term.row - 1))
</a><a href="#h48-0-550" id="h48-0-550" class="i">+					break;
</a><a href="#h48-0-551" id="h48-0-551" class="i">+
</a><a href="#h48-0-552" id="h48-0-552" class="i">+				if (direction &gt; 0)
</a><a href="#h48-0-553" id="h48-0-553" class="i">+					yt = *y, xt = *x;
</a><a href="#h48-0-554" id="h48-0-554" class="i">+				else
</a><a href="#h48-0-555" id="h48-0-555" class="i">+					yt = newy, xt = newx;
</a><a href="#h48-0-556" id="h48-0-556" class="i">+				if (!(term.line[yt][xt].mode &amp; ATTR_WRAP))
</a><a href="#h48-0-557" id="h48-0-557" class="i">+					break;
</a><a href="#h48-0-558" id="h48-0-558" class="i">+			}
</a><a href="#h48-0-559" id="h48-0-559" class="i">+
</a><a href="#h48-0-560" id="h48-0-560" class="i">+			if (newx &gt;= tlinelen(newy))
</a><a href="#h48-0-561" id="h48-0-561" class="i">+				break;
</a><a href="#h48-0-562" id="h48-0-562" class="i">+
</a><a href="#h48-0-563" id="h48-0-563" class="i">+			gp = &amp;term.line[newy][newx];
</a><a href="#h48-0-564" id="h48-0-564" class="i">+			delim = ISDELIM(gp-&gt;u);
</a><a href="#h48-0-565" id="h48-0-565" class="i">+			if (!(gp-&gt;mode &amp; ATTR_WDUMMY) &amp;&amp; (delim != prevdelim
</a><a href="#h48-0-566" id="h48-0-566" class="i">+					|| (delim &amp;&amp; gp-&gt;u != prevgp-&gt;u)))
</a><a href="#h48-0-567" id="h48-0-567" class="i">+				break;
</a><a href="#h48-0-568" id="h48-0-568" class="i">+
</a><a href="#h48-0-569" id="h48-0-569" class="i">+			*x = newx;
</a><a href="#h48-0-570" id="h48-0-570" class="i">+			*y = newy;
</a><a href="#h48-0-571" id="h48-0-571" class="i">+			prevgp = gp;
</a><a href="#h48-0-572" id="h48-0-572" class="i">+			prevdelim = delim;
</a><a href="#h48-0-573" id="h48-0-573" class="i">+		}
</a><a href="#h48-0-574" id="h48-0-574" class="i">+		break;
</a><a href="#h48-0-575" id="h48-0-575" class="i">+	case SNAP_LINE:
</a><a href="#h48-0-576" id="h48-0-576" class="i">+		/*
</a><a href="#h48-0-577" id="h48-0-577" class="i">+		 * Snap around if the the previous line or the current one
</a><a href="#h48-0-578" id="h48-0-578" class="i">+		 * has set ATTR_WRAP at its end. Then the whole next or
</a><a href="#h48-0-579" id="h48-0-579" class="i">+		 * previous line will be selected.
</a><a href="#h48-0-580" id="h48-0-580" class="i">+		 */
</a><a href="#h48-0-581" id="h48-0-581" class="i">+		*x = (direction &lt; 0) ? 0 : term.col - 1;
</a><a href="#h48-0-582" id="h48-0-582" class="i">+		if (direction &lt; 0) {
</a><a href="#h48-0-583" id="h48-0-583" class="i">+			for (; *y &gt; 0; *y += direction) {
</a><a href="#h48-0-584" id="h48-0-584" class="i">+				if (!(term.line[*y-1][term.col-1].mode
</a><a href="#h48-0-585" id="h48-0-585" class="i">+						&amp; ATTR_WRAP)) {
</a><a href="#h48-0-586" id="h48-0-586" class="i">+					break;
</a><a href="#h48-0-587" id="h48-0-587" class="i">+				}
</a><a href="#h48-0-588" id="h48-0-588" class="i">+			}
</a><a href="#h48-0-589" id="h48-0-589" class="i">+		} else if (direction &gt; 0) {
</a><a href="#h48-0-590" id="h48-0-590" class="i">+			for (; *y &lt; term.row-1; *y += direction) {
</a><a href="#h48-0-591" id="h48-0-591" class="i">+				if (!(term.line[*y][term.col-1].mode
</a><a href="#h48-0-592" id="h48-0-592" class="i">+						&amp; ATTR_WRAP)) {
</a><a href="#h48-0-593" id="h48-0-593" class="i">+					break;
</a><a href="#h48-0-594" id="h48-0-594" class="i">+				}
</a><a href="#h48-0-595" id="h48-0-595" class="i">+			}
</a><a href="#h48-0-596" id="h48-0-596" class="i">+		}
</a><a href="#h48-0-597" id="h48-0-597" class="i">+		break;
</a><a href="#h48-0-598" id="h48-0-598" class="i">+	}
</a><a href="#h48-0-599" id="h48-0-599" class="i">+}
</a><a href="#h48-0-600" id="h48-0-600" class="i">+
</a><a href="#h48-0-601" id="h48-0-601" class="i">+char *
</a><a href="#h48-0-602" id="h48-0-602" class="i">+getsel(void)
</a><a href="#h48-0-603" id="h48-0-603" class="i">+{
</a><a href="#h48-0-604" id="h48-0-604" class="i">+	char *str, *ptr;
</a><a href="#h48-0-605" id="h48-0-605" class="i">+	int y, bufsize, lastx, linelen;
</a><a href="#h48-0-606" id="h48-0-606" class="i">+	Glyph *gp, *last;
</a><a href="#h48-0-607" id="h48-0-607" class="i">+
</a><a href="#h48-0-608" id="h48-0-608" class="i">+	if (sel.ob.x == -1)
</a><a href="#h48-0-609" id="h48-0-609" class="i">+		return NULL;
</a><a href="#h48-0-610" id="h48-0-610" class="i">+
</a><a href="#h48-0-611" id="h48-0-611" class="i">+	bufsize = (term.col+1) * (sel.ne.y-sel.nb.y+1) * UTF_SIZ;
</a><a href="#h48-0-612" id="h48-0-612" class="i">+	ptr = str = xmalloc(bufsize);
</a><a href="#h48-0-613" id="h48-0-613" class="i">+
</a><a href="#h48-0-614" id="h48-0-614" class="i">+	/* append every set &amp; selected glyph to the selection */
</a><a href="#h48-0-615" id="h48-0-615" class="i">+	for (y = sel.nb.y; y &lt;= sel.ne.y; y++) {
</a><a href="#h48-0-616" id="h48-0-616" class="i">+		if ((linelen = tlinelen(y)) == 0) {
</a><a href="#h48-0-617" id="h48-0-617" class="i">+			*ptr++ = &#39;\n&#39;;
</a><a href="#h48-0-618" id="h48-0-618" class="i">+			continue;
</a><a href="#h48-0-619" id="h48-0-619" class="i">+		}
</a><a href="#h48-0-620" id="h48-0-620" class="i">+
</a><a href="#h48-0-621" id="h48-0-621" class="i">+		if (sel.type == SEL_RECTANGULAR) {
</a><a href="#h48-0-622" id="h48-0-622" class="i">+			gp = &amp;term.line[y][sel.nb.x];
</a><a href="#h48-0-623" id="h48-0-623" class="i">+			lastx = sel.ne.x;
</a><a href="#h48-0-624" id="h48-0-624" class="i">+		} else {
</a><a href="#h48-0-625" id="h48-0-625" class="i">+			gp = &amp;term.line[y][sel.nb.y == y ? sel.nb.x : 0];
</a><a href="#h48-0-626" id="h48-0-626" class="i">+			lastx = (sel.ne.y == y) ? sel.ne.x : term.col-1;
</a><a href="#h48-0-627" id="h48-0-627" class="i">+		}
</a><a href="#h48-0-628" id="h48-0-628" class="i">+		last = &amp;term.line[y][MIN(lastx, linelen-1)];
</a><a href="#h48-0-629" id="h48-0-629" class="i">+		while (last &gt;= gp &amp;&amp; last-&gt;u == &#39; &#39;)
</a><a href="#h48-0-630" id="h48-0-630" class="i">+			--last;
</a><a href="#h48-0-631" id="h48-0-631" class="i">+
</a><a href="#h48-0-632" id="h48-0-632" class="i">+		for ( ; gp &lt;= last; ++gp) {
</a><a href="#h48-0-633" id="h48-0-633" class="i">+			if (gp-&gt;mode &amp; ATTR_WDUMMY)
</a><a href="#h48-0-634" id="h48-0-634" class="i">+				continue;
</a><a href="#h48-0-635" id="h48-0-635" class="i">+
</a><a href="#h48-0-636" id="h48-0-636" class="i">+			ptr += utf8encode(gp-&gt;u, ptr);
</a><a href="#h48-0-637" id="h48-0-637" class="i">+		}
</a><a href="#h48-0-638" id="h48-0-638" class="i">+
</a><a href="#h48-0-639" id="h48-0-639" class="i">+		/*
</a><a href="#h48-0-640" id="h48-0-640" class="i">+		 * Copy and pasting of line endings is inconsistent
</a><a href="#h48-0-641" id="h48-0-641" class="i">+		 * in the inconsistent terminal and GUI world.
</a><a href="#h48-0-642" id="h48-0-642" class="i">+		 * The best solution seems like to produce &#39;\n&#39; when
</a><a href="#h48-0-643" id="h48-0-643" class="i">+		 * something is copied from st and convert &#39;\n&#39; to
</a><a href="#h48-0-644" id="h48-0-644" class="i">+		 * &#39;\r&#39;, when something to be pasted is received by
</a><a href="#h48-0-645" id="h48-0-645" class="i">+		 * st.
</a><a href="#h48-0-646" id="h48-0-646" class="i">+		 * FIXME: Fix the computer world.
</a><a href="#h48-0-647" id="h48-0-647" class="i">+		 */
</a><a href="#h48-0-648" id="h48-0-648" class="i">+		if ((y &lt; sel.ne.y || lastx &gt;= linelen) &amp;&amp; !(last-&gt;mode &amp; ATTR_WRAP))
</a><a href="#h48-0-649" id="h48-0-649" class="i">+			*ptr++ = &#39;\n&#39;;
</a><a href="#h48-0-650" id="h48-0-650" class="i">+	}
</a><a href="#h48-0-651" id="h48-0-651" class="i">+	*ptr = 0;
</a><a href="#h48-0-652" id="h48-0-652" class="i">+	return str;
</a><a href="#h48-0-653" id="h48-0-653" class="i">+}
</a><a href="#h48-0-654" id="h48-0-654" class="i">+
</a><a href="#h48-0-655" id="h48-0-655" class="i">+void
</a><a href="#h48-0-656" id="h48-0-656" class="i">+selclear(void)
</a><a href="#h48-0-657" id="h48-0-657" class="i">+{
</a><a href="#h48-0-658" id="h48-0-658" class="i">+	if (sel.ob.x == -1)
</a><a href="#h48-0-659" id="h48-0-659" class="i">+		return;
</a><a href="#h48-0-660" id="h48-0-660" class="i">+	sel.mode = SEL_IDLE;
</a><a href="#h48-0-661" id="h48-0-661" class="i">+	sel.ob.x = -1;
</a><a href="#h48-0-662" id="h48-0-662" class="i">+	tsetdirt(sel.nb.y, sel.ne.y);
</a><a href="#h48-0-663" id="h48-0-663" class="i">+}
</a><a href="#h48-0-664" id="h48-0-664" class="i">+
</a><a href="#h48-0-665" id="h48-0-665" class="i">+void
</a><a href="#h48-0-666" id="h48-0-666" class="i">+die(const char *errstr, ...)
</a><a href="#h48-0-667" id="h48-0-667" class="i">+{
</a><a href="#h48-0-668" id="h48-0-668" class="i">+	va_list ap;
</a><a href="#h48-0-669" id="h48-0-669" class="i">+
</a><a href="#h48-0-670" id="h48-0-670" class="i">+	va_start(ap, errstr);
</a><a href="#h48-0-671" id="h48-0-671" class="i">+	vfprintf(stderr, errstr, ap);
</a><a href="#h48-0-672" id="h48-0-672" class="i">+	va_end(ap);
</a><a href="#h48-0-673" id="h48-0-673" class="i">+	exit(1);
</a><a href="#h48-0-674" id="h48-0-674" class="i">+}
</a><a href="#h48-0-675" id="h48-0-675" class="i">+
</a><a href="#h48-0-676" id="h48-0-676" class="i">+void
</a><a href="#h48-0-677" id="h48-0-677" class="i">+execsh(char *cmd, char **args)
</a><a href="#h48-0-678" id="h48-0-678" class="i">+{
</a><a href="#h48-0-679" id="h48-0-679" class="i">+	char *sh, *prog;
</a><a href="#h48-0-680" id="h48-0-680" class="i">+	const struct passwd *pw;
</a><a href="#h48-0-681" id="h48-0-681" class="i">+
</a><a href="#h48-0-682" id="h48-0-682" class="i">+	errno = 0;
</a><a href="#h48-0-683" id="h48-0-683" class="i">+	if ((pw = getpwuid(getuid())) == NULL) {
</a><a href="#h48-0-684" id="h48-0-684" class="i">+		if (errno)
</a><a href="#h48-0-685" id="h48-0-685" class="i">+			die(&quot;getpwuid: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-686" id="h48-0-686" class="i">+		else
</a><a href="#h48-0-687" id="h48-0-687" class="i">+			die(&quot;who are you?\n&quot;);
</a><a href="#h48-0-688" id="h48-0-688" class="i">+	}
</a><a href="#h48-0-689" id="h48-0-689" class="i">+
</a><a href="#h48-0-690" id="h48-0-690" class="i">+	if ((sh = getenv(&quot;SHELL&quot;)) == NULL)
</a><a href="#h48-0-691" id="h48-0-691" class="i">+		sh = (pw-&gt;pw_shell[0]) ? pw-&gt;pw_shell : cmd;
</a><a href="#h48-0-692" id="h48-0-692" class="i">+
</a><a href="#h48-0-693" id="h48-0-693" class="i">+	if (args)
</a><a href="#h48-0-694" id="h48-0-694" class="i">+		prog = args[0];
</a><a href="#h48-0-695" id="h48-0-695" class="i">+	else if (utmp)
</a><a href="#h48-0-696" id="h48-0-696" class="i">+		prog = utmp;
</a><a href="#h48-0-697" id="h48-0-697" class="i">+	else
</a><a href="#h48-0-698" id="h48-0-698" class="i">+		prog = sh;
</a><a href="#h48-0-699" id="h48-0-699" class="i">+	DEFAULT(args, ((char *[]) {prog, NULL}));
</a><a href="#h48-0-700" id="h48-0-700" class="i">+
</a><a href="#h48-0-701" id="h48-0-701" class="i">+	unsetenv(&quot;COLUMNS&quot;);
</a><a href="#h48-0-702" id="h48-0-702" class="i">+	unsetenv(&quot;LINES&quot;);
</a><a href="#h48-0-703" id="h48-0-703" class="i">+	unsetenv(&quot;TERMCAP&quot;);
</a><a href="#h48-0-704" id="h48-0-704" class="i">+	setenv(&quot;LOGNAME&quot;, pw-&gt;pw_name, 1);
</a><a href="#h48-0-705" id="h48-0-705" class="i">+	setenv(&quot;USER&quot;, pw-&gt;pw_name, 1);
</a><a href="#h48-0-706" id="h48-0-706" class="i">+	setenv(&quot;SHELL&quot;, sh, 1);
</a><a href="#h48-0-707" id="h48-0-707" class="i">+	setenv(&quot;HOME&quot;, pw-&gt;pw_dir, 1);
</a><a href="#h48-0-708" id="h48-0-708" class="i">+	setenv(&quot;TERM&quot;, termname, 1);
</a><a href="#h48-0-709" id="h48-0-709" class="i">+
</a><a href="#h48-0-710" id="h48-0-710" class="i">+	signal(SIGCHLD, SIG_DFL);
</a><a href="#h48-0-711" id="h48-0-711" class="i">+	signal(SIGHUP, SIG_DFL);
</a><a href="#h48-0-712" id="h48-0-712" class="i">+	signal(SIGINT, SIG_DFL);
</a><a href="#h48-0-713" id="h48-0-713" class="i">+	signal(SIGQUIT, SIG_DFL);
</a><a href="#h48-0-714" id="h48-0-714" class="i">+	signal(SIGTERM, SIG_DFL);
</a><a href="#h48-0-715" id="h48-0-715" class="i">+	signal(SIGALRM, SIG_DFL);
</a><a href="#h48-0-716" id="h48-0-716" class="i">+
</a><a href="#h48-0-717" id="h48-0-717" class="i">+	execvp(prog, args);
</a><a href="#h48-0-718" id="h48-0-718" class="i">+	_exit(1);
</a><a href="#h48-0-719" id="h48-0-719" class="i">+}
</a><a href="#h48-0-720" id="h48-0-720" class="i">+
</a><a href="#h48-0-721" id="h48-0-721" class="i">+void
</a><a href="#h48-0-722" id="h48-0-722" class="i">+sigchld(int a)
</a><a href="#h48-0-723" id="h48-0-723" class="i">+{
</a><a href="#h48-0-724" id="h48-0-724" class="i">+	int stat;
</a><a href="#h48-0-725" id="h48-0-725" class="i">+	pid_t p;
</a><a href="#h48-0-726" id="h48-0-726" class="i">+
</a><a href="#h48-0-727" id="h48-0-727" class="i">+	if ((p = waitpid(pid, &amp;stat, WNOHANG)) &lt; 0)
</a><a href="#h48-0-728" id="h48-0-728" class="i">+		die(&quot;waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
</a><a href="#h48-0-729" id="h48-0-729" class="i">+
</a><a href="#h48-0-730" id="h48-0-730" class="i">+	if (pid != p)
</a><a href="#h48-0-731" id="h48-0-731" class="i">+		return;
</a><a href="#h48-0-732" id="h48-0-732" class="i">+
</a><a href="#h48-0-733" id="h48-0-733" class="i">+	if (WIFEXITED(stat) &amp;&amp; WEXITSTATUS(stat))
</a><a href="#h48-0-734" id="h48-0-734" class="i">+		die(&quot;child exited with status %d\n&quot;, WEXITSTATUS(stat));
</a><a href="#h48-0-735" id="h48-0-735" class="i">+	else if (WIFSIGNALED(stat))
</a><a href="#h48-0-736" id="h48-0-736" class="i">+		die(&quot;child terminated due to signal %d\n&quot;, WTERMSIG(stat));
</a><a href="#h48-0-737" id="h48-0-737" class="i">+	exit(0);
</a><a href="#h48-0-738" id="h48-0-738" class="i">+}
</a><a href="#h48-0-739" id="h48-0-739" class="i">+
</a><a href="#h48-0-740" id="h48-0-740" class="i">+void
</a><a href="#h48-0-741" id="h48-0-741" class="i">+stty(char **args)
</a><a href="#h48-0-742" id="h48-0-742" class="i">+{
</a><a href="#h48-0-743" id="h48-0-743" class="i">+	char cmd[_POSIX_ARG_MAX], **p, *q, *s;
</a><a href="#h48-0-744" id="h48-0-744" class="i">+	size_t n, siz;
</a><a href="#h48-0-745" id="h48-0-745" class="i">+
</a><a href="#h48-0-746" id="h48-0-746" class="i">+	if ((n = strlen(stty_args)) &gt; sizeof(cmd)-1)
</a><a href="#h48-0-747" id="h48-0-747" class="i">+		die(&quot;incorrect stty parameters\n&quot;);
</a><a href="#h48-0-748" id="h48-0-748" class="i">+	memcpy(cmd, stty_args, n);
</a><a href="#h48-0-749" id="h48-0-749" class="i">+	q = cmd + n;
</a><a href="#h48-0-750" id="h48-0-750" class="i">+	siz = sizeof(cmd) - n;
</a><a href="#h48-0-751" id="h48-0-751" class="i">+	for (p = args; p &amp;&amp; (s = *p); ++p) {
</a><a href="#h48-0-752" id="h48-0-752" class="i">+		if ((n = strlen(s)) &gt; siz-1)
</a><a href="#h48-0-753" id="h48-0-753" class="i">+			die(&quot;stty parameter length too long\n&quot;);
</a><a href="#h48-0-754" id="h48-0-754" class="i">+		*q++ = &#39; &#39;;
</a><a href="#h48-0-755" id="h48-0-755" class="i">+		memcpy(q, s, n);
</a><a href="#h48-0-756" id="h48-0-756" class="i">+		q += n;
</a><a href="#h48-0-757" id="h48-0-757" class="i">+		siz -= n + 1;
</a><a href="#h48-0-758" id="h48-0-758" class="i">+	}
</a><a href="#h48-0-759" id="h48-0-759" class="i">+	*q = &#39;\0&#39;;
</a><a href="#h48-0-760" id="h48-0-760" class="i">+	if (system(cmd) != 0)
</a><a href="#h48-0-761" id="h48-0-761" class="i">+		perror(&quot;Couldn&#39;t call stty&quot;);
</a><a href="#h48-0-762" id="h48-0-762" class="i">+}
</a><a href="#h48-0-763" id="h48-0-763" class="i">+
</a><a href="#h48-0-764" id="h48-0-764" class="i">+int
</a><a href="#h48-0-765" id="h48-0-765" class="i">+ttynew(char *line, char *cmd, char *out, char **args)
</a><a href="#h48-0-766" id="h48-0-766" class="i">+{
</a><a href="#h48-0-767" id="h48-0-767" class="i">+	int m, s;
</a><a href="#h48-0-768" id="h48-0-768" class="i">+
</a><a href="#h48-0-769" id="h48-0-769" class="i">+	if (out) {
</a><a href="#h48-0-770" id="h48-0-770" class="i">+		term.mode |= MODE_PRINT;
</a><a href="#h48-0-771" id="h48-0-771" class="i">+		iofd = (!strcmp(out, &quot;-&quot;)) ?
</a><a href="#h48-0-772" id="h48-0-772" class="i">+			  1 : open(out, O_WRONLY | O_CREAT, 0666);
</a><a href="#h48-0-773" id="h48-0-773" class="i">+		if (iofd &lt; 0) {
</a><a href="#h48-0-774" id="h48-0-774" class="i">+			fprintf(stderr, &quot;Error opening %s:%s\n&quot;,
</a><a href="#h48-0-775" id="h48-0-775" class="i">+				out, strerror(errno));
</a><a href="#h48-0-776" id="h48-0-776" class="i">+		}
</a><a href="#h48-0-777" id="h48-0-777" class="i">+	}
</a><a href="#h48-0-778" id="h48-0-778" class="i">+
</a><a href="#h48-0-779" id="h48-0-779" class="i">+	if (line) {
</a><a href="#h48-0-780" id="h48-0-780" class="i">+		if ((cmdfd = open(line, O_RDWR)) &lt; 0)
</a><a href="#h48-0-781" id="h48-0-781" class="i">+			die(&quot;open line &#39;%s&#39; failed: %s\n&quot;,
</a><a href="#h48-0-782" id="h48-0-782" class="i">+			    line, strerror(errno));
</a><a href="#h48-0-783" id="h48-0-783" class="i">+		dup2(cmdfd, 0);
</a><a href="#h48-0-784" id="h48-0-784" class="i">+		stty(args);
</a><a href="#h48-0-785" id="h48-0-785" class="i">+		return cmdfd;
</a><a href="#h48-0-786" id="h48-0-786" class="i">+	}
</a><a href="#h48-0-787" id="h48-0-787" class="i">+
</a><a href="#h48-0-788" id="h48-0-788" class="i">+	/* seems to work fine on linux, openbsd and freebsd */
</a><a href="#h48-0-789" id="h48-0-789" class="i">+	if (openpty(&amp;m, &amp;s, NULL, NULL, NULL) &lt; 0)
</a><a href="#h48-0-790" id="h48-0-790" class="i">+		die(&quot;openpty failed: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-791" id="h48-0-791" class="i">+
</a><a href="#h48-0-792" id="h48-0-792" class="i">+	switch (pid = fork()) {
</a><a href="#h48-0-793" id="h48-0-793" class="i">+	case -1:
</a><a href="#h48-0-794" id="h48-0-794" class="i">+		die(&quot;fork failed: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-795" id="h48-0-795" class="i">+		break;
</a><a href="#h48-0-796" id="h48-0-796" class="i">+	case 0:
</a><a href="#h48-0-797" id="h48-0-797" class="i">+		close(iofd);
</a><a href="#h48-0-798" id="h48-0-798" class="i">+		setsid(); /* create a new process group */
</a><a href="#h48-0-799" id="h48-0-799" class="i">+		dup2(s, 0);
</a><a href="#h48-0-800" id="h48-0-800" class="i">+		dup2(s, 1);
</a><a href="#h48-0-801" id="h48-0-801" class="i">+		dup2(s, 2);
</a><a href="#h48-0-802" id="h48-0-802" class="i">+		if (ioctl(s, TIOCSCTTY, NULL) &lt; 0)
</a><a href="#h48-0-803" id="h48-0-803" class="i">+			die(&quot;ioctl TIOCSCTTY failed: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-804" id="h48-0-804" class="i">+		close(s);
</a><a href="#h48-0-805" id="h48-0-805" class="i">+		close(m);
</a><a href="#h48-0-806" id="h48-0-806" class="i">+#ifdef __OpenBSD__
</a><a href="#h48-0-807" id="h48-0-807" class="i">+		if (pledge(&quot;stdio getpw proc exec&quot;, NULL) == -1)
</a><a href="#h48-0-808" id="h48-0-808" class="i">+			die(&quot;pledge\n&quot;);
</a><a href="#h48-0-809" id="h48-0-809" class="i">+#endif
</a><a href="#h48-0-810" id="h48-0-810" class="i">+		execsh(cmd, args);
</a><a href="#h48-0-811" id="h48-0-811" class="i">+		break;
</a><a href="#h48-0-812" id="h48-0-812" class="i">+	default:
</a><a href="#h48-0-813" id="h48-0-813" class="i">+#ifdef __OpenBSD__
</a><a href="#h48-0-814" id="h48-0-814" class="i">+		if (pledge(&quot;stdio rpath tty proc&quot;, NULL) == -1)
</a><a href="#h48-0-815" id="h48-0-815" class="i">+			die(&quot;pledge\n&quot;);
</a><a href="#h48-0-816" id="h48-0-816" class="i">+#endif
</a><a href="#h48-0-817" id="h48-0-817" class="i">+		close(s);
</a><a href="#h48-0-818" id="h48-0-818" class="i">+		cmdfd = m;
</a><a href="#h48-0-819" id="h48-0-819" class="i">+		signal(SIGCHLD, sigchld);
</a><a href="#h48-0-820" id="h48-0-820" class="i">+		break;
</a><a href="#h48-0-821" id="h48-0-821" class="i">+	}
</a><a href="#h48-0-822" id="h48-0-822" class="i">+	return cmdfd;
</a><a href="#h48-0-823" id="h48-0-823" class="i">+}
</a><a href="#h48-0-824" id="h48-0-824" class="i">+
</a><a href="#h48-0-825" id="h48-0-825" class="i">+size_t
</a><a href="#h48-0-826" id="h48-0-826" class="i">+ttyread(void)
</a><a href="#h48-0-827" id="h48-0-827" class="i">+{
</a><a href="#h48-0-828" id="h48-0-828" class="i">+	static char buf[BUFSIZ];
</a><a href="#h48-0-829" id="h48-0-829" class="i">+	static int buflen = 0;
</a><a href="#h48-0-830" id="h48-0-830" class="i">+	int written;
</a><a href="#h48-0-831" id="h48-0-831" class="i">+	int ret;
</a><a href="#h48-0-832" id="h48-0-832" class="i">+
</a><a href="#h48-0-833" id="h48-0-833" class="i">+	/* append read bytes to unprocessed bytes */
</a><a href="#h48-0-834" id="h48-0-834" class="i">+	if ((ret = read(cmdfd, buf+buflen, LEN(buf)-buflen)) &lt; 0)
</a><a href="#h48-0-835" id="h48-0-835" class="i">+		die(&quot;couldn&#39;t read from shell: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-836" id="h48-0-836" class="i">+	buflen += ret;
</a><a href="#h48-0-837" id="h48-0-837" class="i">+
</a><a href="#h48-0-838" id="h48-0-838" class="i">+	written = twrite(buf, buflen, 0);
</a><a href="#h48-0-839" id="h48-0-839" class="i">+	buflen -= written;
</a><a href="#h48-0-840" id="h48-0-840" class="i">+	/* keep any uncomplete utf8 char for the next call */
</a><a href="#h48-0-841" id="h48-0-841" class="i">+	if (buflen &gt; 0)
</a><a href="#h48-0-842" id="h48-0-842" class="i">+		memmove(buf, buf + written, buflen);
</a><a href="#h48-0-843" id="h48-0-843" class="i">+
</a><a href="#h48-0-844" id="h48-0-844" class="i">+	return ret;
</a><a href="#h48-0-845" id="h48-0-845" class="i">+}
</a><a href="#h48-0-846" id="h48-0-846" class="i">+
</a><a href="#h48-0-847" id="h48-0-847" class="i">+void
</a><a href="#h48-0-848" id="h48-0-848" class="i">+ttywrite(const char *s, size_t n, int may_echo)
</a><a href="#h48-0-849" id="h48-0-849" class="i">+{
</a><a href="#h48-0-850" id="h48-0-850" class="i">+	const char *next;
</a><a href="#h48-0-851" id="h48-0-851" class="i">+
</a><a href="#h48-0-852" id="h48-0-852" class="i">+	if (may_echo &amp;&amp; IS_SET(MODE_ECHO))
</a><a href="#h48-0-853" id="h48-0-853" class="i">+		twrite(s, n, 1);
</a><a href="#h48-0-854" id="h48-0-854" class="i">+
</a><a href="#h48-0-855" id="h48-0-855" class="i">+	if (!IS_SET(MODE_CRLF)) {
</a><a href="#h48-0-856" id="h48-0-856" class="i">+		ttywriteraw(s, n);
</a><a href="#h48-0-857" id="h48-0-857" class="i">+		return;
</a><a href="#h48-0-858" id="h48-0-858" class="i">+	}
</a><a href="#h48-0-859" id="h48-0-859" class="i">+
</a><a href="#h48-0-860" id="h48-0-860" class="i">+	/* This is similar to how the kernel handles ONLCR for ttys */
</a><a href="#h48-0-861" id="h48-0-861" class="i">+	while (n &gt; 0) {
</a><a href="#h48-0-862" id="h48-0-862" class="i">+		if (*s == &#39;\r&#39;) {
</a><a href="#h48-0-863" id="h48-0-863" class="i">+			next = s + 1;
</a><a href="#h48-0-864" id="h48-0-864" class="i">+			ttywriteraw(&quot;\r\n&quot;, 2);
</a><a href="#h48-0-865" id="h48-0-865" class="i">+		} else {
</a><a href="#h48-0-866" id="h48-0-866" class="i">+			next = memchr(s, &#39;\r&#39;, n);
</a><a href="#h48-0-867" id="h48-0-867" class="i">+			DEFAULT(next, s + n);
</a><a href="#h48-0-868" id="h48-0-868" class="i">+			ttywriteraw(s, next - s);
</a><a href="#h48-0-869" id="h48-0-869" class="i">+		}
</a><a href="#h48-0-870" id="h48-0-870" class="i">+		n -= next - s;
</a><a href="#h48-0-871" id="h48-0-871" class="i">+		s = next;
</a><a href="#h48-0-872" id="h48-0-872" class="i">+	}
</a><a href="#h48-0-873" id="h48-0-873" class="i">+}
</a><a href="#h48-0-874" id="h48-0-874" class="i">+
</a><a href="#h48-0-875" id="h48-0-875" class="i">+void
</a><a href="#h48-0-876" id="h48-0-876" class="i">+ttywriteraw(const char *s, size_t n)
</a><a href="#h48-0-877" id="h48-0-877" class="i">+{
</a><a href="#h48-0-878" id="h48-0-878" class="i">+	fd_set wfd, rfd;
</a><a href="#h48-0-879" id="h48-0-879" class="i">+	ssize_t r;
</a><a href="#h48-0-880" id="h48-0-880" class="i">+	size_t lim = 256;
</a><a href="#h48-0-881" id="h48-0-881" class="i">+
</a><a href="#h48-0-882" id="h48-0-882" class="i">+	/*
</a><a href="#h48-0-883" id="h48-0-883" class="i">+	 * Remember that we are using a pty, which might be a modem line.
</a><a href="#h48-0-884" id="h48-0-884" class="i">+	 * Writing too much will clog the line. That&#39;s why we are doing this
</a><a href="#h48-0-885" id="h48-0-885" class="i">+	 * dance.
</a><a href="#h48-0-886" id="h48-0-886" class="i">+	 * FIXME: Migrate the world to Plan 9.
</a><a href="#h48-0-887" id="h48-0-887" class="i">+	 */
</a><a href="#h48-0-888" id="h48-0-888" class="i">+	while (n &gt; 0) {
</a><a href="#h48-0-889" id="h48-0-889" class="i">+		FD_ZERO(&amp;wfd);
</a><a href="#h48-0-890" id="h48-0-890" class="i">+		FD_ZERO(&amp;rfd);
</a><a href="#h48-0-891" id="h48-0-891" class="i">+		FD_SET(cmdfd, &amp;wfd);
</a><a href="#h48-0-892" id="h48-0-892" class="i">+		FD_SET(cmdfd, &amp;rfd);
</a><a href="#h48-0-893" id="h48-0-893" class="i">+
</a><a href="#h48-0-894" id="h48-0-894" class="i">+		/* Check if we can write. */
</a><a href="#h48-0-895" id="h48-0-895" class="i">+		if (pselect(cmdfd+1, &amp;rfd, &amp;wfd, NULL, NULL, NULL) &lt; 0) {
</a><a href="#h48-0-896" id="h48-0-896" class="i">+			if (errno == EINTR)
</a><a href="#h48-0-897" id="h48-0-897" class="i">+				continue;
</a><a href="#h48-0-898" id="h48-0-898" class="i">+			die(&quot;select failed: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-899" id="h48-0-899" class="i">+		}
</a><a href="#h48-0-900" id="h48-0-900" class="i">+		if (FD_ISSET(cmdfd, &amp;wfd)) {
</a><a href="#h48-0-901" id="h48-0-901" class="i">+			/*
</a><a href="#h48-0-902" id="h48-0-902" class="i">+			 * Only write the bytes written by ttywrite() or the
</a><a href="#h48-0-903" id="h48-0-903" class="i">+			 * default of 256. This seems to be a reasonable value
</a><a href="#h48-0-904" id="h48-0-904" class="i">+			 * for a serial line. Bigger values might clog the I/O.
</a><a href="#h48-0-905" id="h48-0-905" class="i">+			 */
</a><a href="#h48-0-906" id="h48-0-906" class="i">+			if ((r = write(cmdfd, s, (n &lt; lim)? n : lim)) &lt; 0)
</a><a href="#h48-0-907" id="h48-0-907" class="i">+				goto write_error;
</a><a href="#h48-0-908" id="h48-0-908" class="i">+			if (r &lt; n) {
</a><a href="#h48-0-909" id="h48-0-909" class="i">+				/*
</a><a href="#h48-0-910" id="h48-0-910" class="i">+				 * We weren&#39;t able to write out everything.
</a><a href="#h48-0-911" id="h48-0-911" class="i">+				 * This means the buffer is getting full
</a><a href="#h48-0-912" id="h48-0-912" class="i">+				 * again. Empty it.
</a><a href="#h48-0-913" id="h48-0-913" class="i">+				 */
</a><a href="#h48-0-914" id="h48-0-914" class="i">+				if (n &lt; lim)
</a><a href="#h48-0-915" id="h48-0-915" class="i">+					lim = ttyread();
</a><a href="#h48-0-916" id="h48-0-916" class="i">+				n -= r;
</a><a href="#h48-0-917" id="h48-0-917" class="i">+				s += r;
</a><a href="#h48-0-918" id="h48-0-918" class="i">+			} else {
</a><a href="#h48-0-919" id="h48-0-919" class="i">+				/* All bytes have been written. */
</a><a href="#h48-0-920" id="h48-0-920" class="i">+				break;
</a><a href="#h48-0-921" id="h48-0-921" class="i">+			}
</a><a href="#h48-0-922" id="h48-0-922" class="i">+		}
</a><a href="#h48-0-923" id="h48-0-923" class="i">+		if (FD_ISSET(cmdfd, &amp;rfd))
</a><a href="#h48-0-924" id="h48-0-924" class="i">+			lim = ttyread();
</a><a href="#h48-0-925" id="h48-0-925" class="i">+	}
</a><a href="#h48-0-926" id="h48-0-926" class="i">+	return;
</a><a href="#h48-0-927" id="h48-0-927" class="i">+
</a><a href="#h48-0-928" id="h48-0-928" class="i">+write_error:
</a><a href="#h48-0-929" id="h48-0-929" class="i">+	die(&quot;write error on tty: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-930" id="h48-0-930" class="i">+}
</a><a href="#h48-0-931" id="h48-0-931" class="i">+
</a><a href="#h48-0-932" id="h48-0-932" class="i">+void
</a><a href="#h48-0-933" id="h48-0-933" class="i">+ttyresize(int tw, int th)
</a><a href="#h48-0-934" id="h48-0-934" class="i">+{
</a><a href="#h48-0-935" id="h48-0-935" class="i">+	struct winsize w;
</a><a href="#h48-0-936" id="h48-0-936" class="i">+
</a><a href="#h48-0-937" id="h48-0-937" class="i">+	w.ws_row = term.row;
</a><a href="#h48-0-938" id="h48-0-938" class="i">+	w.ws_col = term.col;
</a><a href="#h48-0-939" id="h48-0-939" class="i">+	w.ws_xpixel = tw;
</a><a href="#h48-0-940" id="h48-0-940" class="i">+	w.ws_ypixel = th;
</a><a href="#h48-0-941" id="h48-0-941" class="i">+	if (ioctl(cmdfd, TIOCSWINSZ, &amp;w) &lt; 0)
</a><a href="#h48-0-942" id="h48-0-942" class="i">+		fprintf(stderr, &quot;Couldn&#39;t set window size: %s\n&quot;, strerror(errno));
</a><a href="#h48-0-943" id="h48-0-943" class="i">+}
</a><a href="#h48-0-944" id="h48-0-944" class="i">+
</a><a href="#h48-0-945" id="h48-0-945" class="i">+void
</a><a href="#h48-0-946" id="h48-0-946" class="i">+ttyhangup()
</a><a href="#h48-0-947" id="h48-0-947" class="i">+{
</a><a href="#h48-0-948" id="h48-0-948" class="i">+	/* Send SIGHUP to shell */
</a><a href="#h48-0-949" id="h48-0-949" class="i">+	kill(pid, SIGHUP);
</a><a href="#h48-0-950" id="h48-0-950" class="i">+}
</a><a href="#h48-0-951" id="h48-0-951" class="i">+
</a><a href="#h48-0-952" id="h48-0-952" class="i">+int
</a><a href="#h48-0-953" id="h48-0-953" class="i">+tattrset(int attr)
</a><a href="#h48-0-954" id="h48-0-954" class="i">+{
</a><a href="#h48-0-955" id="h48-0-955" class="i">+	int i, j;
</a><a href="#h48-0-956" id="h48-0-956" class="i">+
</a><a href="#h48-0-957" id="h48-0-957" class="i">+	for (i = 0; i &lt; term.row-1; i++) {
</a><a href="#h48-0-958" id="h48-0-958" class="i">+		for (j = 0; j &lt; term.col-1; j++) {
</a><a href="#h48-0-959" id="h48-0-959" class="i">+			if (term.line[i][j].mode &amp; attr)
</a><a href="#h48-0-960" id="h48-0-960" class="i">+				return 1;
</a><a href="#h48-0-961" id="h48-0-961" class="i">+		}
</a><a href="#h48-0-962" id="h48-0-962" class="i">+	}
</a><a href="#h48-0-963" id="h48-0-963" class="i">+
</a><a href="#h48-0-964" id="h48-0-964" class="i">+	return 0;
</a><a href="#h48-0-965" id="h48-0-965" class="i">+}
</a><a href="#h48-0-966" id="h48-0-966" class="i">+
</a><a href="#h48-0-967" id="h48-0-967" class="i">+void
</a><a href="#h48-0-968" id="h48-0-968" class="i">+tsetdirt(int top, int bot)
</a><a href="#h48-0-969" id="h48-0-969" class="i">+{
</a><a href="#h48-0-970" id="h48-0-970" class="i">+	int i;
</a><a href="#h48-0-971" id="h48-0-971" class="i">+
</a><a href="#h48-0-972" id="h48-0-972" class="i">+	LIMIT(top, 0, term.row-1);
</a><a href="#h48-0-973" id="h48-0-973" class="i">+	LIMIT(bot, 0, term.row-1);
</a><a href="#h48-0-974" id="h48-0-974" class="i">+
</a><a href="#h48-0-975" id="h48-0-975" class="i">+	for (i = top; i &lt;= bot; i++)
</a><a href="#h48-0-976" id="h48-0-976" class="i">+		term.dirty[i] = 1;
</a><a href="#h48-0-977" id="h48-0-977" class="i">+}
</a><a href="#h48-0-978" id="h48-0-978" class="i">+
</a><a href="#h48-0-979" id="h48-0-979" class="i">+void
</a><a href="#h48-0-980" id="h48-0-980" class="i">+tsetdirtattr(int attr)
</a><a href="#h48-0-981" id="h48-0-981" class="i">+{
</a><a href="#h48-0-982" id="h48-0-982" class="i">+	int i, j;
</a><a href="#h48-0-983" id="h48-0-983" class="i">+
</a><a href="#h48-0-984" id="h48-0-984" class="i">+	for (i = 0; i &lt; term.row-1; i++) {
</a><a href="#h48-0-985" id="h48-0-985" class="i">+		for (j = 0; j &lt; term.col-1; j++) {
</a><a href="#h48-0-986" id="h48-0-986" class="i">+			if (term.line[i][j].mode &amp; attr) {
</a><a href="#h48-0-987" id="h48-0-987" class="i">+				tsetdirt(i, i);
</a><a href="#h48-0-988" id="h48-0-988" class="i">+				break;
</a><a href="#h48-0-989" id="h48-0-989" class="i">+			}
</a><a href="#h48-0-990" id="h48-0-990" class="i">+		}
</a><a href="#h48-0-991" id="h48-0-991" class="i">+	}
</a><a href="#h48-0-992" id="h48-0-992" class="i">+}
</a><a href="#h48-0-993" id="h48-0-993" class="i">+
</a><a href="#h48-0-994" id="h48-0-994" class="i">+void
</a><a href="#h48-0-995" id="h48-0-995" class="i">+tfulldirt(void)
</a><a href="#h48-0-996" id="h48-0-996" class="i">+{
</a><a href="#h48-0-997" id="h48-0-997" class="i">+	tsetdirt(0, term.row-1);
</a><a href="#h48-0-998" id="h48-0-998" class="i">+}
</a><a href="#h48-0-999" id="h48-0-999" class="i">+
</a><a href="#h48-0-1000" id="h48-0-1000" class="i">+void
</a><a href="#h48-0-1001" id="h48-0-1001" class="i">+tcursor(int mode)
</a><a href="#h48-0-1002" id="h48-0-1002" class="i">+{
</a><a href="#h48-0-1003" id="h48-0-1003" class="i">+	static TCursor c[2];
</a><a href="#h48-0-1004" id="h48-0-1004" class="i">+	int alt = IS_SET(MODE_ALTSCREEN);
</a><a href="#h48-0-1005" id="h48-0-1005" class="i">+
</a><a href="#h48-0-1006" id="h48-0-1006" class="i">+	if (mode == CURSOR_SAVE) {
</a><a href="#h48-0-1007" id="h48-0-1007" class="i">+		c[alt] = term.c;
</a><a href="#h48-0-1008" id="h48-0-1008" class="i">+	} else if (mode == CURSOR_LOAD) {
</a><a href="#h48-0-1009" id="h48-0-1009" class="i">+		term.c = c[alt];
</a><a href="#h48-0-1010" id="h48-0-1010" class="i">+		tmoveto(c[alt].x, c[alt].y);
</a><a href="#h48-0-1011" id="h48-0-1011" class="i">+	}
</a><a href="#h48-0-1012" id="h48-0-1012" class="i">+}
</a><a href="#h48-0-1013" id="h48-0-1013" class="i">+
</a><a href="#h48-0-1014" id="h48-0-1014" class="i">+void
</a><a href="#h48-0-1015" id="h48-0-1015" class="i">+treset(void)
</a><a href="#h48-0-1016" id="h48-0-1016" class="i">+{
</a><a href="#h48-0-1017" id="h48-0-1017" class="i">+	uint i;
</a><a href="#h48-0-1018" id="h48-0-1018" class="i">+
</a><a href="#h48-0-1019" id="h48-0-1019" class="i">+	term.c = (TCursor){{
</a><a href="#h48-0-1020" id="h48-0-1020" class="i">+		.mode = ATTR_NULL,
</a><a href="#h48-0-1021" id="h48-0-1021" class="i">+		.fg = defaultfg,
</a><a href="#h48-0-1022" id="h48-0-1022" class="i">+		.bg = defaultbg
</a><a href="#h48-0-1023" id="h48-0-1023" class="i">+	}, .x = 0, .y = 0, .state = CURSOR_DEFAULT};
</a><a href="#h48-0-1024" id="h48-0-1024" class="i">+
</a><a href="#h48-0-1025" id="h48-0-1025" class="i">+	memset(term.tabs, 0, term.col * sizeof(*term.tabs));
</a><a href="#h48-0-1026" id="h48-0-1026" class="i">+	for (i = tabspaces; i &lt; term.col; i += tabspaces)
</a><a href="#h48-0-1027" id="h48-0-1027" class="i">+		term.tabs[i] = 1;
</a><a href="#h48-0-1028" id="h48-0-1028" class="i">+	term.top = 0;
</a><a href="#h48-0-1029" id="h48-0-1029" class="i">+	term.bot = term.row - 1;
</a><a href="#h48-0-1030" id="h48-0-1030" class="i">+	term.mode = MODE_WRAP|MODE_UTF8;
</a><a href="#h48-0-1031" id="h48-0-1031" class="i">+	memset(term.trantbl, CS_USA, sizeof(term.trantbl));
</a><a href="#h48-0-1032" id="h48-0-1032" class="i">+	term.charset = 0;
</a><a href="#h48-0-1033" id="h48-0-1033" class="i">+
</a><a href="#h48-0-1034" id="h48-0-1034" class="i">+	for (i = 0; i &lt; 2; i++) {
</a><a href="#h48-0-1035" id="h48-0-1035" class="i">+		tmoveto(0, 0);
</a><a href="#h48-0-1036" id="h48-0-1036" class="i">+		tcursor(CURSOR_SAVE);
</a><a href="#h48-0-1037" id="h48-0-1037" class="i">+		tclearregion(0, 0, term.col-1, term.row-1);
</a><a href="#h48-0-1038" id="h48-0-1038" class="i">+		tswapscreen();
</a><a href="#h48-0-1039" id="h48-0-1039" class="i">+	}
</a><a href="#h48-0-1040" id="h48-0-1040" class="i">+}
</a><a href="#h48-0-1041" id="h48-0-1041" class="i">+
</a><a href="#h48-0-1042" id="h48-0-1042" class="i">+void
</a><a href="#h48-0-1043" id="h48-0-1043" class="i">+tnew(int col, int row)
</a><a href="#h48-0-1044" id="h48-0-1044" class="i">+{
</a><a href="#h48-0-1045" id="h48-0-1045" class="i">+	term = (Term){ .c = { .attr = { .fg = defaultfg, .bg = defaultbg } } };
</a><a href="#h48-0-1046" id="h48-0-1046" class="i">+	tresize(col, row);
</a><a href="#h48-0-1047" id="h48-0-1047" class="i">+	treset();
</a><a href="#h48-0-1048" id="h48-0-1048" class="i">+}
</a><a href="#h48-0-1049" id="h48-0-1049" class="i">+
</a><a href="#h48-0-1050" id="h48-0-1050" class="i">+void
</a><a href="#h48-0-1051" id="h48-0-1051" class="i">+tswapscreen(void)
</a><a href="#h48-0-1052" id="h48-0-1052" class="i">+{
</a><a href="#h48-0-1053" id="h48-0-1053" class="i">+	Line *tmp = term.line;
</a><a href="#h48-0-1054" id="h48-0-1054" class="i">+
</a><a href="#h48-0-1055" id="h48-0-1055" class="i">+	term.line = term.alt;
</a><a href="#h48-0-1056" id="h48-0-1056" class="i">+	term.alt = tmp;
</a><a href="#h48-0-1057" id="h48-0-1057" class="i">+	term.mode ^= MODE_ALTSCREEN;
</a><a href="#h48-0-1058" id="h48-0-1058" class="i">+	tfulldirt();
</a><a href="#h48-0-1059" id="h48-0-1059" class="i">+}
</a><a href="#h48-0-1060" id="h48-0-1060" class="i">+
</a><a href="#h48-0-1061" id="h48-0-1061" class="i">+void
</a><a href="#h48-0-1062" id="h48-0-1062" class="i">+tscrolldown(int orig, int n)
</a><a href="#h48-0-1063" id="h48-0-1063" class="i">+{
</a><a href="#h48-0-1064" id="h48-0-1064" class="i">+	int i;
</a><a href="#h48-0-1065" id="h48-0-1065" class="i">+	Line temp;
</a><a href="#h48-0-1066" id="h48-0-1066" class="i">+
</a><a href="#h48-0-1067" id="h48-0-1067" class="i">+	LIMIT(n, 0, term.bot-orig+1);
</a><a href="#h48-0-1068" id="h48-0-1068" class="i">+
</a><a href="#h48-0-1069" id="h48-0-1069" class="i">+	tsetdirt(orig, term.bot-n);
</a><a href="#h48-0-1070" id="h48-0-1070" class="i">+	tclearregion(0, term.bot-n+1, term.col-1, term.bot);
</a><a href="#h48-0-1071" id="h48-0-1071" class="i">+
</a><a href="#h48-0-1072" id="h48-0-1072" class="i">+	for (i = term.bot; i &gt;= orig+n; i--) {
</a><a href="#h48-0-1073" id="h48-0-1073" class="i">+		temp = term.line[i];
</a><a href="#h48-0-1074" id="h48-0-1074" class="i">+		term.line[i] = term.line[i-n];
</a><a href="#h48-0-1075" id="h48-0-1075" class="i">+		term.line[i-n] = temp;
</a><a href="#h48-0-1076" id="h48-0-1076" class="i">+	}
</a><a href="#h48-0-1077" id="h48-0-1077" class="i">+
</a><a href="#h48-0-1078" id="h48-0-1078" class="i">+	selscroll(orig, n);
</a><a href="#h48-0-1079" id="h48-0-1079" class="i">+}
</a><a href="#h48-0-1080" id="h48-0-1080" class="i">+
</a><a href="#h48-0-1081" id="h48-0-1081" class="i">+void
</a><a href="#h48-0-1082" id="h48-0-1082" class="i">+tscrollup(int orig, int n)
</a><a href="#h48-0-1083" id="h48-0-1083" class="i">+{
</a><a href="#h48-0-1084" id="h48-0-1084" class="i">+	int i;
</a><a href="#h48-0-1085" id="h48-0-1085" class="i">+	Line temp;
</a><a href="#h48-0-1086" id="h48-0-1086" class="i">+
</a><a href="#h48-0-1087" id="h48-0-1087" class="i">+	LIMIT(n, 0, term.bot-orig+1);
</a><a href="#h48-0-1088" id="h48-0-1088" class="i">+
</a><a href="#h48-0-1089" id="h48-0-1089" class="i">+	tclearregion(0, orig, term.col-1, orig+n-1);
</a><a href="#h48-0-1090" id="h48-0-1090" class="i">+	tsetdirt(orig+n, term.bot);
</a><a href="#h48-0-1091" id="h48-0-1091" class="i">+
</a><a href="#h48-0-1092" id="h48-0-1092" class="i">+	for (i = orig; i &lt;= term.bot-n; i++) {
</a><a href="#h48-0-1093" id="h48-0-1093" class="i">+		temp = term.line[i];
</a><a href="#h48-0-1094" id="h48-0-1094" class="i">+		term.line[i] = term.line[i+n];
</a><a href="#h48-0-1095" id="h48-0-1095" class="i">+		term.line[i+n] = temp;
</a><a href="#h48-0-1096" id="h48-0-1096" class="i">+	}
</a><a href="#h48-0-1097" id="h48-0-1097" class="i">+
</a><a href="#h48-0-1098" id="h48-0-1098" class="i">+	selscroll(orig, -n);
</a><a href="#h48-0-1099" id="h48-0-1099" class="i">+}
</a><a href="#h48-0-1100" id="h48-0-1100" class="i">+
</a><a href="#h48-0-1101" id="h48-0-1101" class="i">+void
</a><a href="#h48-0-1102" id="h48-0-1102" class="i">+selscroll(int orig, int n)
</a><a href="#h48-0-1103" id="h48-0-1103" class="i">+{
</a><a href="#h48-0-1104" id="h48-0-1104" class="i">+	if (sel.ob.x == -1)
</a><a href="#h48-0-1105" id="h48-0-1105" class="i">+		return;
</a><a href="#h48-0-1106" id="h48-0-1106" class="i">+
</a><a href="#h48-0-1107" id="h48-0-1107" class="i">+	if (BETWEEN(sel.ob.y, orig, term.bot) || BETWEEN(sel.oe.y, orig, term.bot)) {
</a><a href="#h48-0-1108" id="h48-0-1108" class="i">+		if ((sel.ob.y += n) &gt; term.bot || (sel.oe.y += n) &lt; term.top) {
</a><a href="#h48-0-1109" id="h48-0-1109" class="i">+			selclear();
</a><a href="#h48-0-1110" id="h48-0-1110" class="i">+			return;
</a><a href="#h48-0-1111" id="h48-0-1111" class="i">+		}
</a><a href="#h48-0-1112" id="h48-0-1112" class="i">+		if (sel.type == SEL_RECTANGULAR) {
</a><a href="#h48-0-1113" id="h48-0-1113" class="i">+			if (sel.ob.y &lt; term.top)
</a><a href="#h48-0-1114" id="h48-0-1114" class="i">+				sel.ob.y = term.top;
</a><a href="#h48-0-1115" id="h48-0-1115" class="i">+			if (sel.oe.y &gt; term.bot)
</a><a href="#h48-0-1116" id="h48-0-1116" class="i">+				sel.oe.y = term.bot;
</a><a href="#h48-0-1117" id="h48-0-1117" class="i">+		} else {
</a><a href="#h48-0-1118" id="h48-0-1118" class="i">+			if (sel.ob.y &lt; term.top) {
</a><a href="#h48-0-1119" id="h48-0-1119" class="i">+				sel.ob.y = term.top;
</a><a href="#h48-0-1120" id="h48-0-1120" class="i">+				sel.ob.x = 0;
</a><a href="#h48-0-1121" id="h48-0-1121" class="i">+			}
</a><a href="#h48-0-1122" id="h48-0-1122" class="i">+			if (sel.oe.y &gt; term.bot) {
</a><a href="#h48-0-1123" id="h48-0-1123" class="i">+				sel.oe.y = term.bot;
</a><a href="#h48-0-1124" id="h48-0-1124" class="i">+				sel.oe.x = term.col;
</a><a href="#h48-0-1125" id="h48-0-1125" class="i">+			}
</a><a href="#h48-0-1126" id="h48-0-1126" class="i">+		}
</a><a href="#h48-0-1127" id="h48-0-1127" class="i">+		selnormalize();
</a><a href="#h48-0-1128" id="h48-0-1128" class="i">+	}
</a><a href="#h48-0-1129" id="h48-0-1129" class="i">+}
</a><a href="#h48-0-1130" id="h48-0-1130" class="i">+
</a><a href="#h48-0-1131" id="h48-0-1131" class="i">+void
</a><a href="#h48-0-1132" id="h48-0-1132" class="i">+tnewline(int first_col)
</a><a href="#h48-0-1133" id="h48-0-1133" class="i">+{
</a><a href="#h48-0-1134" id="h48-0-1134" class="i">+	int y = term.c.y;
</a><a href="#h48-0-1135" id="h48-0-1135" class="i">+
</a><a href="#h48-0-1136" id="h48-0-1136" class="i">+	if (y == term.bot) {
</a><a href="#h48-0-1137" id="h48-0-1137" class="i">+		tscrollup(term.top, 1);
</a><a href="#h48-0-1138" id="h48-0-1138" class="i">+	} else {
</a><a href="#h48-0-1139" id="h48-0-1139" class="i">+		y++;
</a><a href="#h48-0-1140" id="h48-0-1140" class="i">+	}
</a><a href="#h48-0-1141" id="h48-0-1141" class="i">+	tmoveto(first_col ? 0 : term.c.x, y);
</a><a href="#h48-0-1142" id="h48-0-1142" class="i">+}
</a><a href="#h48-0-1143" id="h48-0-1143" class="i">+
</a><a href="#h48-0-1144" id="h48-0-1144" class="i">+void
</a><a href="#h48-0-1145" id="h48-0-1145" class="i">+csiparse(void)
</a><a href="#h48-0-1146" id="h48-0-1146" class="i">+{
</a><a href="#h48-0-1147" id="h48-0-1147" class="i">+	char *p = csiescseq.buf, *np;
</a><a href="#h48-0-1148" id="h48-0-1148" class="i">+	long int v;
</a><a href="#h48-0-1149" id="h48-0-1149" class="i">+
</a><a href="#h48-0-1150" id="h48-0-1150" class="i">+	csiescseq.narg = 0;
</a><a href="#h48-0-1151" id="h48-0-1151" class="i">+	if (*p == &#39;?&#39;) {
</a><a href="#h48-0-1152" id="h48-0-1152" class="i">+		csiescseq.priv = 1;
</a><a href="#h48-0-1153" id="h48-0-1153" class="i">+		p++;
</a><a href="#h48-0-1154" id="h48-0-1154" class="i">+	}
</a><a href="#h48-0-1155" id="h48-0-1155" class="i">+
</a><a href="#h48-0-1156" id="h48-0-1156" class="i">+	csiescseq.buf[csiescseq.len] = &#39;\0&#39;;
</a><a href="#h48-0-1157" id="h48-0-1157" class="i">+	while (p &lt; csiescseq.buf+csiescseq.len) {
</a><a href="#h48-0-1158" id="h48-0-1158" class="i">+		np = NULL;
</a><a href="#h48-0-1159" id="h48-0-1159" class="i">+		v = strtol(p, &amp;np, 10);
</a><a href="#h48-0-1160" id="h48-0-1160" class="i">+		if (np == p)
</a><a href="#h48-0-1161" id="h48-0-1161" class="i">+			v = 0;
</a><a href="#h48-0-1162" id="h48-0-1162" class="i">+		if (v == LONG_MAX || v == LONG_MIN)
</a><a href="#h48-0-1163" id="h48-0-1163" class="i">+			v = -1;
</a><a href="#h48-0-1164" id="h48-0-1164" class="i">+		csiescseq.arg[csiescseq.narg++] = v;
</a><a href="#h48-0-1165" id="h48-0-1165" class="i">+		p = np;
</a><a href="#h48-0-1166" id="h48-0-1166" class="i">+		if (*p != &#39;;&#39; || csiescseq.narg == ESC_ARG_SIZ)
</a><a href="#h48-0-1167" id="h48-0-1167" class="i">+			break;
</a><a href="#h48-0-1168" id="h48-0-1168" class="i">+		p++;
</a><a href="#h48-0-1169" id="h48-0-1169" class="i">+	}
</a><a href="#h48-0-1170" id="h48-0-1170" class="i">+	csiescseq.mode[0] = *p++;
</a><a href="#h48-0-1171" id="h48-0-1171" class="i">+	csiescseq.mode[1] = (p &lt; csiescseq.buf+csiescseq.len) ? *p : &#39;\0&#39;;
</a><a href="#h48-0-1172" id="h48-0-1172" class="i">+}
</a><a href="#h48-0-1173" id="h48-0-1173" class="i">+
</a><a href="#h48-0-1174" id="h48-0-1174" class="i">+/* for absolute user moves, when decom is set */
</a><a href="#h48-0-1175" id="h48-0-1175" class="i">+void
</a><a href="#h48-0-1176" id="h48-0-1176" class="i">+tmoveato(int x, int y)
</a><a href="#h48-0-1177" id="h48-0-1177" class="i">+{
</a><a href="#h48-0-1178" id="h48-0-1178" class="i">+	tmoveto(x, y + ((term.c.state &amp; CURSOR_ORIGIN) ? term.top: 0));
</a><a href="#h48-0-1179" id="h48-0-1179" class="i">+}
</a><a href="#h48-0-1180" id="h48-0-1180" class="i">+
</a><a href="#h48-0-1181" id="h48-0-1181" class="i">+void
</a><a href="#h48-0-1182" id="h48-0-1182" class="i">+tmoveto(int x, int y)
</a><a href="#h48-0-1183" id="h48-0-1183" class="i">+{
</a><a href="#h48-0-1184" id="h48-0-1184" class="i">+	int miny, maxy;
</a><a href="#h48-0-1185" id="h48-0-1185" class="i">+
</a><a href="#h48-0-1186" id="h48-0-1186" class="i">+	if (term.c.state &amp; CURSOR_ORIGIN) {
</a><a href="#h48-0-1187" id="h48-0-1187" class="i">+		miny = term.top;
</a><a href="#h48-0-1188" id="h48-0-1188" class="i">+		maxy = term.bot;
</a><a href="#h48-0-1189" id="h48-0-1189" class="i">+	} else {
</a><a href="#h48-0-1190" id="h48-0-1190" class="i">+		miny = 0;
</a><a href="#h48-0-1191" id="h48-0-1191" class="i">+		maxy = term.row - 1;
</a><a href="#h48-0-1192" id="h48-0-1192" class="i">+	}
</a><a href="#h48-0-1193" id="h48-0-1193" class="i">+	term.c.state &amp;= ~CURSOR_WRAPNEXT;
</a><a href="#h48-0-1194" id="h48-0-1194" class="i">+	term.c.x = LIMIT(x, 0, term.col-1);
</a><a href="#h48-0-1195" id="h48-0-1195" class="i">+	term.c.y = LIMIT(y, miny, maxy);
</a><a href="#h48-0-1196" id="h48-0-1196" class="i">+}
</a><a href="#h48-0-1197" id="h48-0-1197" class="i">+
</a><a href="#h48-0-1198" id="h48-0-1198" class="i">+void
</a><a href="#h48-0-1199" id="h48-0-1199" class="i">+tsetchar(Rune u, Glyph *attr, int x, int y)
</a><a href="#h48-0-1200" id="h48-0-1200" class="i">+{
</a><a href="#h48-0-1201" id="h48-0-1201" class="i">+	static char *vt100_0[62] = { /* 0x41 - 0x7e */
</a><a href="#h48-0-1202" id="h48-0-1202" class="i">+		&quot;↑&quot;, &quot;↓&quot;, &quot;→&quot;, &quot;←&quot;, &quot;█&quot;, &quot;▚&quot;, &quot;☃&quot;, /* A - G */
</a><a href="#h48-0-1203" id="h48-0-1203" class="i">+		0, 0, 0, 0, 0, 0, 0, 0, /* H - O */
</a><a href="#h48-0-1204" id="h48-0-1204" class="i">+		0, 0, 0, 0, 0, 0, 0, 0, /* P - W */
</a><a href="#h48-0-1205" id="h48-0-1205" class="i">+		0, 0, 0, 0, 0, 0, 0, &quot; &quot;, /* X - _ */
</a><a href="#h48-0-1206" id="h48-0-1206" class="i">+		&quot;◆&quot;, &quot;▒&quot;, &quot;␉&quot;, &quot;␌&quot;, &quot;␍&quot;, &quot;␊&quot;, &quot;°&quot;, &quot;±&quot;, /* ` - g */
</a><a href="#h48-0-1207" id="h48-0-1207" class="i">+		&quot;␤&quot;, &quot;␋&quot;, &quot;┘&quot;, &quot;┐&quot;, &quot;┌&quot;, &quot;└&quot;, &quot;┼&quot;, &quot;⎺&quot;, /* h - o */
</a><a href="#h48-0-1208" id="h48-0-1208" class="i">+		&quot;⎻&quot;, &quot;─&quot;, &quot;⎼&quot;, &quot;⎽&quot;, &quot;├&quot;, &quot;┤&quot;, &quot;┴&quot;, &quot;┬&quot;, /* p - w */
</a><a href="#h48-0-1209" id="h48-0-1209" class="i">+		&quot;│&quot;, &quot;≤&quot;, &quot;≥&quot;, &quot;π&quot;, &quot;≠&quot;, &quot;£&quot;, &quot;·&quot;, /* x - ~ */
</a><a href="#h48-0-1210" id="h48-0-1210" class="i">+	};
</a><a href="#h48-0-1211" id="h48-0-1211" class="i">+
</a><a href="#h48-0-1212" id="h48-0-1212" class="i">+	/*
</a><a href="#h48-0-1213" id="h48-0-1213" class="i">+	 * The table is proudly stolen from rxvt.
</a><a href="#h48-0-1214" id="h48-0-1214" class="i">+	 */
</a><a href="#h48-0-1215" id="h48-0-1215" class="i">+	if (term.trantbl[term.charset] == CS_GRAPHIC0 &amp;&amp;
</a><a href="#h48-0-1216" id="h48-0-1216" class="i">+	   BETWEEN(u, 0x41, 0x7e) &amp;&amp; vt100_0[u - 0x41])
</a><a href="#h48-0-1217" id="h48-0-1217" class="i">+		utf8decode(vt100_0[u - 0x41], &amp;u, UTF_SIZ);
</a><a href="#h48-0-1218" id="h48-0-1218" class="i">+
</a><a href="#h48-0-1219" id="h48-0-1219" class="i">+	if (term.line[y][x].mode &amp; ATTR_WIDE) {
</a><a href="#h48-0-1220" id="h48-0-1220" class="i">+		if (x+1 &lt; term.col) {
</a><a href="#h48-0-1221" id="h48-0-1221" class="i">+			term.line[y][x+1].u = &#39; &#39;;
</a><a href="#h48-0-1222" id="h48-0-1222" class="i">+			term.line[y][x+1].mode &amp;= ~ATTR_WDUMMY;
</a><a href="#h48-0-1223" id="h48-0-1223" class="i">+		}
</a><a href="#h48-0-1224" id="h48-0-1224" class="i">+	} else if (term.line[y][x].mode &amp; ATTR_WDUMMY) {
</a><a href="#h48-0-1225" id="h48-0-1225" class="i">+		term.line[y][x-1].u = &#39; &#39;;
</a><a href="#h48-0-1226" id="h48-0-1226" class="i">+		term.line[y][x-1].mode &amp;= ~ATTR_WIDE;
</a><a href="#h48-0-1227" id="h48-0-1227" class="i">+	}
</a><a href="#h48-0-1228" id="h48-0-1228" class="i">+
</a><a href="#h48-0-1229" id="h48-0-1229" class="i">+	term.dirty[y] = 1;
</a><a href="#h48-0-1230" id="h48-0-1230" class="i">+	term.line[y][x] = *attr;
</a><a href="#h48-0-1231" id="h48-0-1231" class="i">+	term.line[y][x].u = u;
</a><a href="#h48-0-1232" id="h48-0-1232" class="i">+}
</a><a href="#h48-0-1233" id="h48-0-1233" class="i">+
</a><a href="#h48-0-1234" id="h48-0-1234" class="i">+void
</a><a href="#h48-0-1235" id="h48-0-1235" class="i">+tclearregion(int x1, int y1, int x2, int y2)
</a><a href="#h48-0-1236" id="h48-0-1236" class="i">+{
</a><a href="#h48-0-1237" id="h48-0-1237" class="i">+	int x, y, temp;
</a><a href="#h48-0-1238" id="h48-0-1238" class="i">+	Glyph *gp;
</a><a href="#h48-0-1239" id="h48-0-1239" class="i">+
</a><a href="#h48-0-1240" id="h48-0-1240" class="i">+	if (x1 &gt; x2)
</a><a href="#h48-0-1241" id="h48-0-1241" class="i">+		temp = x1, x1 = x2, x2 = temp;
</a><a href="#h48-0-1242" id="h48-0-1242" class="i">+	if (y1 &gt; y2)
</a><a href="#h48-0-1243" id="h48-0-1243" class="i">+		temp = y1, y1 = y2, y2 = temp;
</a><a href="#h48-0-1244" id="h48-0-1244" class="i">+
</a><a href="#h48-0-1245" id="h48-0-1245" class="i">+	LIMIT(x1, 0, term.col-1);
</a><a href="#h48-0-1246" id="h48-0-1246" class="i">+	LIMIT(x2, 0, term.col-1);
</a><a href="#h48-0-1247" id="h48-0-1247" class="i">+	LIMIT(y1, 0, term.row-1);
</a><a href="#h48-0-1248" id="h48-0-1248" class="i">+	LIMIT(y2, 0, term.row-1);
</a><a href="#h48-0-1249" id="h48-0-1249" class="i">+
</a><a href="#h48-0-1250" id="h48-0-1250" class="i">+	for (y = y1; y &lt;= y2; y++) {
</a><a href="#h48-0-1251" id="h48-0-1251" class="i">+		term.dirty[y] = 1;
</a><a href="#h48-0-1252" id="h48-0-1252" class="i">+		for (x = x1; x &lt;= x2; x++) {
</a><a href="#h48-0-1253" id="h48-0-1253" class="i">+			gp = &amp;term.line[y][x];
</a><a href="#h48-0-1254" id="h48-0-1254" class="i">+			if (selected(x, y))
</a><a href="#h48-0-1255" id="h48-0-1255" class="i">+				selclear();
</a><a href="#h48-0-1256" id="h48-0-1256" class="i">+			gp-&gt;fg = term.c.attr.fg;
</a><a href="#h48-0-1257" id="h48-0-1257" class="i">+			gp-&gt;bg = term.c.attr.bg;
</a><a href="#h48-0-1258" id="h48-0-1258" class="i">+			gp-&gt;mode = 0;
</a><a href="#h48-0-1259" id="h48-0-1259" class="i">+			gp-&gt;u = &#39; &#39;;
</a><a href="#h48-0-1260" id="h48-0-1260" class="i">+		}
</a><a href="#h48-0-1261" id="h48-0-1261" class="i">+	}
</a><a href="#h48-0-1262" id="h48-0-1262" class="i">+}
</a><a href="#h48-0-1263" id="h48-0-1263" class="i">+
</a><a href="#h48-0-1264" id="h48-0-1264" class="i">+void
</a><a href="#h48-0-1265" id="h48-0-1265" class="i">+tdeletechar(int n)
</a><a href="#h48-0-1266" id="h48-0-1266" class="i">+{
</a><a href="#h48-0-1267" id="h48-0-1267" class="i">+	int dst, src, size;
</a><a href="#h48-0-1268" id="h48-0-1268" class="i">+	Glyph *line;
</a><a href="#h48-0-1269" id="h48-0-1269" class="i">+
</a><a href="#h48-0-1270" id="h48-0-1270" class="i">+	LIMIT(n, 0, term.col - term.c.x);
</a><a href="#h48-0-1271" id="h48-0-1271" class="i">+
</a><a href="#h48-0-1272" id="h48-0-1272" class="i">+	dst = term.c.x;
</a><a href="#h48-0-1273" id="h48-0-1273" class="i">+	src = term.c.x + n;
</a><a href="#h48-0-1274" id="h48-0-1274" class="i">+	size = term.col - src;
</a><a href="#h48-0-1275" id="h48-0-1275" class="i">+	line = term.line[term.c.y];
</a><a href="#h48-0-1276" id="h48-0-1276" class="i">+
</a><a href="#h48-0-1277" id="h48-0-1277" class="i">+	memmove(&amp;line[dst], &amp;line[src], size * sizeof(Glyph));
</a><a href="#h48-0-1278" id="h48-0-1278" class="i">+	tclearregion(term.col-n, term.c.y, term.col-1, term.c.y);
</a><a href="#h48-0-1279" id="h48-0-1279" class="i">+}
</a><a href="#h48-0-1280" id="h48-0-1280" class="i">+
</a><a href="#h48-0-1281" id="h48-0-1281" class="i">+void
</a><a href="#h48-0-1282" id="h48-0-1282" class="i">+tinsertblank(int n)
</a><a href="#h48-0-1283" id="h48-0-1283" class="i">+{
</a><a href="#h48-0-1284" id="h48-0-1284" class="i">+	int dst, src, size;
</a><a href="#h48-0-1285" id="h48-0-1285" class="i">+	Glyph *line;
</a><a href="#h48-0-1286" id="h48-0-1286" class="i">+
</a><a href="#h48-0-1287" id="h48-0-1287" class="i">+	LIMIT(n, 0, term.col - term.c.x);
</a><a href="#h48-0-1288" id="h48-0-1288" class="i">+
</a><a href="#h48-0-1289" id="h48-0-1289" class="i">+	dst = term.c.x + n;
</a><a href="#h48-0-1290" id="h48-0-1290" class="i">+	src = term.c.x;
</a><a href="#h48-0-1291" id="h48-0-1291" class="i">+	size = term.col - dst;
</a><a href="#h48-0-1292" id="h48-0-1292" class="i">+	line = term.line[term.c.y];
</a><a href="#h48-0-1293" id="h48-0-1293" class="i">+
</a><a href="#h48-0-1294" id="h48-0-1294" class="i">+	memmove(&amp;line[dst], &amp;line[src], size * sizeof(Glyph));
</a><a href="#h48-0-1295" id="h48-0-1295" class="i">+	tclearregion(src, term.c.y, dst - 1, term.c.y);
</a><a href="#h48-0-1296" id="h48-0-1296" class="i">+}
</a><a href="#h48-0-1297" id="h48-0-1297" class="i">+
</a><a href="#h48-0-1298" id="h48-0-1298" class="i">+void
</a><a href="#h48-0-1299" id="h48-0-1299" class="i">+tinsertblankline(int n)
</a><a href="#h48-0-1300" id="h48-0-1300" class="i">+{
</a><a href="#h48-0-1301" id="h48-0-1301" class="i">+	if (BETWEEN(term.c.y, term.top, term.bot))
</a><a href="#h48-0-1302" id="h48-0-1302" class="i">+		tscrolldown(term.c.y, n);
</a><a href="#h48-0-1303" id="h48-0-1303" class="i">+}
</a><a href="#h48-0-1304" id="h48-0-1304" class="i">+
</a><a href="#h48-0-1305" id="h48-0-1305" class="i">+void
</a><a href="#h48-0-1306" id="h48-0-1306" class="i">+tdeleteline(int n)
</a><a href="#h48-0-1307" id="h48-0-1307" class="i">+{
</a><a href="#h48-0-1308" id="h48-0-1308" class="i">+	if (BETWEEN(term.c.y, term.top, term.bot))
</a><a href="#h48-0-1309" id="h48-0-1309" class="i">+		tscrollup(term.c.y, n);
</a><a href="#h48-0-1310" id="h48-0-1310" class="i">+}
</a><a href="#h48-0-1311" id="h48-0-1311" class="i">+
</a><a href="#h48-0-1312" id="h48-0-1312" class="i">+int32_t
</a><a href="#h48-0-1313" id="h48-0-1313" class="i">+tdefcolor(int *attr, int *npar, int l)
</a><a href="#h48-0-1314" id="h48-0-1314" class="i">+{
</a><a href="#h48-0-1315" id="h48-0-1315" class="i">+	int32_t idx = -1;
</a><a href="#h48-0-1316" id="h48-0-1316" class="i">+	uint r, g, b;
</a><a href="#h48-0-1317" id="h48-0-1317" class="i">+
</a><a href="#h48-0-1318" id="h48-0-1318" class="i">+	switch (attr[*npar + 1]) {
</a><a href="#h48-0-1319" id="h48-0-1319" class="i">+	case 2: /* direct color in RGB space */
</a><a href="#h48-0-1320" id="h48-0-1320" class="i">+		if (*npar + 4 &gt;= l) {
</a><a href="#h48-0-1321" id="h48-0-1321" class="i">+			fprintf(stderr,
</a><a href="#h48-0-1322" id="h48-0-1322" class="i">+				&quot;erresc(38): Incorrect number of parameters (%d)\n&quot;,
</a><a href="#h48-0-1323" id="h48-0-1323" class="i">+				*npar);
</a><a href="#h48-0-1324" id="h48-0-1324" class="i">+			break;
</a><a href="#h48-0-1325" id="h48-0-1325" class="i">+		}
</a><a href="#h48-0-1326" id="h48-0-1326" class="i">+		r = attr[*npar + 2];
</a><a href="#h48-0-1327" id="h48-0-1327" class="i">+		g = attr[*npar + 3];
</a><a href="#h48-0-1328" id="h48-0-1328" class="i">+		b = attr[*npar + 4];
</a><a href="#h48-0-1329" id="h48-0-1329" class="i">+		*npar += 4;
</a><a href="#h48-0-1330" id="h48-0-1330" class="i">+		if (!BETWEEN(r, 0, 255) || !BETWEEN(g, 0, 255) || !BETWEEN(b, 0, 255))
</a><a href="#h48-0-1331" id="h48-0-1331" class="i">+			fprintf(stderr, &quot;erresc: bad rgb color (%u,%u,%u)\n&quot;,
</a><a href="#h48-0-1332" id="h48-0-1332" class="i">+				r, g, b);
</a><a href="#h48-0-1333" id="h48-0-1333" class="i">+		else
</a><a href="#h48-0-1334" id="h48-0-1334" class="i">+			idx = TRUECOLOR(r, g, b);
</a><a href="#h48-0-1335" id="h48-0-1335" class="i">+		break;
</a><a href="#h48-0-1336" id="h48-0-1336" class="i">+	case 5: /* indexed color */
</a><a href="#h48-0-1337" id="h48-0-1337" class="i">+		if (*npar + 2 &gt;= l) {
</a><a href="#h48-0-1338" id="h48-0-1338" class="i">+			fprintf(stderr,
</a><a href="#h48-0-1339" id="h48-0-1339" class="i">+				&quot;erresc(38): Incorrect number of parameters (%d)\n&quot;,
</a><a href="#h48-0-1340" id="h48-0-1340" class="i">+				*npar);
</a><a href="#h48-0-1341" id="h48-0-1341" class="i">+			break;
</a><a href="#h48-0-1342" id="h48-0-1342" class="i">+		}
</a><a href="#h48-0-1343" id="h48-0-1343" class="i">+		*npar += 2;
</a><a href="#h48-0-1344" id="h48-0-1344" class="i">+		if (!BETWEEN(attr[*npar], 0, 255))
</a><a href="#h48-0-1345" id="h48-0-1345" class="i">+			fprintf(stderr, &quot;erresc: bad fgcolor %d\n&quot;, attr[*npar]);
</a><a href="#h48-0-1346" id="h48-0-1346" class="i">+		else
</a><a href="#h48-0-1347" id="h48-0-1347" class="i">+			idx = attr[*npar];
</a><a href="#h48-0-1348" id="h48-0-1348" class="i">+		break;
</a><a href="#h48-0-1349" id="h48-0-1349" class="i">+	case 0: /* implemented defined (only foreground) */
</a><a href="#h48-0-1350" id="h48-0-1350" class="i">+	case 1: /* transparent */
</a><a href="#h48-0-1351" id="h48-0-1351" class="i">+	case 3: /* direct color in CMY space */
</a><a href="#h48-0-1352" id="h48-0-1352" class="i">+	case 4: /* direct color in CMYK space */
</a><a href="#h48-0-1353" id="h48-0-1353" class="i">+	default:
</a><a href="#h48-0-1354" id="h48-0-1354" class="i">+		fprintf(stderr,
</a><a href="#h48-0-1355" id="h48-0-1355" class="i">+		        &quot;erresc(38): gfx attr %d unknown\n&quot;, attr[*npar]);
</a><a href="#h48-0-1356" id="h48-0-1356" class="i">+		break;
</a><a href="#h48-0-1357" id="h48-0-1357" class="i">+	}
</a><a href="#h48-0-1358" id="h48-0-1358" class="i">+
</a><a href="#h48-0-1359" id="h48-0-1359" class="i">+	return idx;
</a><a href="#h48-0-1360" id="h48-0-1360" class="i">+}
</a><a href="#h48-0-1361" id="h48-0-1361" class="i">+
</a><a href="#h48-0-1362" id="h48-0-1362" class="i">+void
</a><a href="#h48-0-1363" id="h48-0-1363" class="i">+tsetattr(int *attr, int l)
</a><a href="#h48-0-1364" id="h48-0-1364" class="i">+{
</a><a href="#h48-0-1365" id="h48-0-1365" class="i">+	int i;
</a><a href="#h48-0-1366" id="h48-0-1366" class="i">+	int32_t idx;
</a><a href="#h48-0-1367" id="h48-0-1367" class="i">+
</a><a href="#h48-0-1368" id="h48-0-1368" class="i">+	for (i = 0; i &lt; l; i++) {
</a><a href="#h48-0-1369" id="h48-0-1369" class="i">+		switch (attr[i]) {
</a><a href="#h48-0-1370" id="h48-0-1370" class="i">+		case 0:
</a><a href="#h48-0-1371" id="h48-0-1371" class="i">+			term.c.attr.mode &amp;= ~(
</a><a href="#h48-0-1372" id="h48-0-1372" class="i">+				ATTR_BOLD       |
</a><a href="#h48-0-1373" id="h48-0-1373" class="i">+				ATTR_FAINT      |
</a><a href="#h48-0-1374" id="h48-0-1374" class="i">+				ATTR_ITALIC     |
</a><a href="#h48-0-1375" id="h48-0-1375" class="i">+				ATTR_UNDERLINE  |
</a><a href="#h48-0-1376" id="h48-0-1376" class="i">+				ATTR_BLINK      |
</a><a href="#h48-0-1377" id="h48-0-1377" class="i">+				ATTR_REVERSE    |
</a><a href="#h48-0-1378" id="h48-0-1378" class="i">+				ATTR_INVISIBLE  |
</a><a href="#h48-0-1379" id="h48-0-1379" class="i">+				ATTR_STRUCK     );
</a><a href="#h48-0-1380" id="h48-0-1380" class="i">+			term.c.attr.fg = defaultfg;
</a><a href="#h48-0-1381" id="h48-0-1381" class="i">+			term.c.attr.bg = defaultbg;
</a><a href="#h48-0-1382" id="h48-0-1382" class="i">+			break;
</a><a href="#h48-0-1383" id="h48-0-1383" class="i">+		case 1:
</a><a href="#h48-0-1384" id="h48-0-1384" class="i">+			term.c.attr.mode |= ATTR_BOLD;
</a><a href="#h48-0-1385" id="h48-0-1385" class="i">+			break;
</a><a href="#h48-0-1386" id="h48-0-1386" class="i">+		case 2:
</a><a href="#h48-0-1387" id="h48-0-1387" class="i">+			term.c.attr.mode |= ATTR_FAINT;
</a><a href="#h48-0-1388" id="h48-0-1388" class="i">+			break;
</a><a href="#h48-0-1389" id="h48-0-1389" class="i">+		case 3:
</a><a href="#h48-0-1390" id="h48-0-1390" class="i">+			term.c.attr.mode |= ATTR_ITALIC;
</a><a href="#h48-0-1391" id="h48-0-1391" class="i">+			break;
</a><a href="#h48-0-1392" id="h48-0-1392" class="i">+		case 4:
</a><a href="#h48-0-1393" id="h48-0-1393" class="i">+			term.c.attr.mode |= ATTR_UNDERLINE;
</a><a href="#h48-0-1394" id="h48-0-1394" class="i">+			break;
</a><a href="#h48-0-1395" id="h48-0-1395" class="i">+		case 5: /* slow blink */
</a><a href="#h48-0-1396" id="h48-0-1396" class="i">+			/* FALLTHROUGH */
</a><a href="#h48-0-1397" id="h48-0-1397" class="i">+		case 6: /* rapid blink */
</a><a href="#h48-0-1398" id="h48-0-1398" class="i">+			term.c.attr.mode |= ATTR_BLINK;
</a><a href="#h48-0-1399" id="h48-0-1399" class="i">+			break;
</a><a href="#h48-0-1400" id="h48-0-1400" class="i">+		case 7:
</a><a href="#h48-0-1401" id="h48-0-1401" class="i">+			term.c.attr.mode |= ATTR_REVERSE;
</a><a href="#h48-0-1402" id="h48-0-1402" class="i">+			break;
</a><a href="#h48-0-1403" id="h48-0-1403" class="i">+		case 8:
</a><a href="#h48-0-1404" id="h48-0-1404" class="i">+			term.c.attr.mode |= ATTR_INVISIBLE;
</a><a href="#h48-0-1405" id="h48-0-1405" class="i">+			break;
</a><a href="#h48-0-1406" id="h48-0-1406" class="i">+		case 9:
</a><a href="#h48-0-1407" id="h48-0-1407" class="i">+			term.c.attr.mode |= ATTR_STRUCK;
</a><a href="#h48-0-1408" id="h48-0-1408" class="i">+			break;
</a><a href="#h48-0-1409" id="h48-0-1409" class="i">+		case 22:
</a><a href="#h48-0-1410" id="h48-0-1410" class="i">+			term.c.attr.mode &amp;= ~(ATTR_BOLD | ATTR_FAINT);
</a><a href="#h48-0-1411" id="h48-0-1411" class="i">+			break;
</a><a href="#h48-0-1412" id="h48-0-1412" class="i">+		case 23:
</a><a href="#h48-0-1413" id="h48-0-1413" class="i">+			term.c.attr.mode &amp;= ~ATTR_ITALIC;
</a><a href="#h48-0-1414" id="h48-0-1414" class="i">+			break;
</a><a href="#h48-0-1415" id="h48-0-1415" class="i">+		case 24:
</a><a href="#h48-0-1416" id="h48-0-1416" class="i">+			term.c.attr.mode &amp;= ~ATTR_UNDERLINE;
</a><a href="#h48-0-1417" id="h48-0-1417" class="i">+			break;
</a><a href="#h48-0-1418" id="h48-0-1418" class="i">+		case 25:
</a><a href="#h48-0-1419" id="h48-0-1419" class="i">+			term.c.attr.mode &amp;= ~ATTR_BLINK;
</a><a href="#h48-0-1420" id="h48-0-1420" class="i">+			break;
</a><a href="#h48-0-1421" id="h48-0-1421" class="i">+		case 27:
</a><a href="#h48-0-1422" id="h48-0-1422" class="i">+			term.c.attr.mode &amp;= ~ATTR_REVERSE;
</a><a href="#h48-0-1423" id="h48-0-1423" class="i">+			break;
</a><a href="#h48-0-1424" id="h48-0-1424" class="i">+		case 28:
</a><a href="#h48-0-1425" id="h48-0-1425" class="i">+			term.c.attr.mode &amp;= ~ATTR_INVISIBLE;
</a><a href="#h48-0-1426" id="h48-0-1426" class="i">+			break;
</a><a href="#h48-0-1427" id="h48-0-1427" class="i">+		case 29:
</a><a href="#h48-0-1428" id="h48-0-1428" class="i">+			term.c.attr.mode &amp;= ~ATTR_STRUCK;
</a><a href="#h48-0-1429" id="h48-0-1429" class="i">+			break;
</a><a href="#h48-0-1430" id="h48-0-1430" class="i">+		case 38:
</a><a href="#h48-0-1431" id="h48-0-1431" class="i">+			if ((idx = tdefcolor(attr, &amp;i, l)) &gt;= 0)
</a><a href="#h48-0-1432" id="h48-0-1432" class="i">+				term.c.attr.fg = idx;
</a><a href="#h48-0-1433" id="h48-0-1433" class="i">+			break;
</a><a href="#h48-0-1434" id="h48-0-1434" class="i">+		case 39:
</a><a href="#h48-0-1435" id="h48-0-1435" class="i">+			term.c.attr.fg = defaultfg;
</a><a href="#h48-0-1436" id="h48-0-1436" class="i">+			break;
</a><a href="#h48-0-1437" id="h48-0-1437" class="i">+		case 48:
</a><a href="#h48-0-1438" id="h48-0-1438" class="i">+			if ((idx = tdefcolor(attr, &amp;i, l)) &gt;= 0)
</a><a href="#h48-0-1439" id="h48-0-1439" class="i">+				term.c.attr.bg = idx;
</a><a href="#h48-0-1440" id="h48-0-1440" class="i">+			break;
</a><a href="#h48-0-1441" id="h48-0-1441" class="i">+		case 49:
</a><a href="#h48-0-1442" id="h48-0-1442" class="i">+			term.c.attr.bg = defaultbg;
</a><a href="#h48-0-1443" id="h48-0-1443" class="i">+			break;
</a><a href="#h48-0-1444" id="h48-0-1444" class="i">+		default:
</a><a href="#h48-0-1445" id="h48-0-1445" class="i">+			if (BETWEEN(attr[i], 30, 37)) {
</a><a href="#h48-0-1446" id="h48-0-1446" class="i">+				term.c.attr.fg = attr[i] - 30;
</a><a href="#h48-0-1447" id="h48-0-1447" class="i">+			} else if (BETWEEN(attr[i], 40, 47)) {
</a><a href="#h48-0-1448" id="h48-0-1448" class="i">+				term.c.attr.bg = attr[i] - 40;
</a><a href="#h48-0-1449" id="h48-0-1449" class="i">+			} else if (BETWEEN(attr[i], 90, 97)) {
</a><a href="#h48-0-1450" id="h48-0-1450" class="i">+				term.c.attr.fg = attr[i] - 90 + 8;
</a><a href="#h48-0-1451" id="h48-0-1451" class="i">+			} else if (BETWEEN(attr[i], 100, 107)) {
</a><a href="#h48-0-1452" id="h48-0-1452" class="i">+				term.c.attr.bg = attr[i] - 100 + 8;
</a><a href="#h48-0-1453" id="h48-0-1453" class="i">+			} else {
</a><a href="#h48-0-1454" id="h48-0-1454" class="i">+				fprintf(stderr,
</a><a href="#h48-0-1455" id="h48-0-1455" class="i">+					&quot;erresc(default): gfx attr %d unknown\n&quot;,
</a><a href="#h48-0-1456" id="h48-0-1456" class="i">+					attr[i]);
</a><a href="#h48-0-1457" id="h48-0-1457" class="i">+				csidump();
</a><a href="#h48-0-1458" id="h48-0-1458" class="i">+			}
</a><a href="#h48-0-1459" id="h48-0-1459" class="i">+			break;
</a><a href="#h48-0-1460" id="h48-0-1460" class="i">+		}
</a><a href="#h48-0-1461" id="h48-0-1461" class="i">+	}
</a><a href="#h48-0-1462" id="h48-0-1462" class="i">+}
</a><a href="#h48-0-1463" id="h48-0-1463" class="i">+
</a><a href="#h48-0-1464" id="h48-0-1464" class="i">+void
</a><a href="#h48-0-1465" id="h48-0-1465" class="i">+tsetscroll(int t, int b)
</a><a href="#h48-0-1466" id="h48-0-1466" class="i">+{
</a><a href="#h48-0-1467" id="h48-0-1467" class="i">+	int temp;
</a><a href="#h48-0-1468" id="h48-0-1468" class="i">+
</a><a href="#h48-0-1469" id="h48-0-1469" class="i">+	LIMIT(t, 0, term.row-1);
</a><a href="#h48-0-1470" id="h48-0-1470" class="i">+	LIMIT(b, 0, term.row-1);
</a><a href="#h48-0-1471" id="h48-0-1471" class="i">+	if (t &gt; b) {
</a><a href="#h48-0-1472" id="h48-0-1472" class="i">+		temp = t;
</a><a href="#h48-0-1473" id="h48-0-1473" class="i">+		t = b;
</a><a href="#h48-0-1474" id="h48-0-1474" class="i">+		b = temp;
</a><a href="#h48-0-1475" id="h48-0-1475" class="i">+	}
</a><a href="#h48-0-1476" id="h48-0-1476" class="i">+	term.top = t;
</a><a href="#h48-0-1477" id="h48-0-1477" class="i">+	term.bot = b;
</a><a href="#h48-0-1478" id="h48-0-1478" class="i">+}
</a><a href="#h48-0-1479" id="h48-0-1479" class="i">+
</a><a href="#h48-0-1480" id="h48-0-1480" class="i">+void
</a><a href="#h48-0-1481" id="h48-0-1481" class="i">+tsetmode(int priv, int set, int *args, int narg)
</a><a href="#h48-0-1482" id="h48-0-1482" class="i">+{
</a><a href="#h48-0-1483" id="h48-0-1483" class="i">+	int alt, *lim;
</a><a href="#h48-0-1484" id="h48-0-1484" class="i">+
</a><a href="#h48-0-1485" id="h48-0-1485" class="i">+	for (lim = args + narg; args &lt; lim; ++args) {
</a><a href="#h48-0-1486" id="h48-0-1486" class="i">+		if (priv) {
</a><a href="#h48-0-1487" id="h48-0-1487" class="i">+			switch (*args) {
</a><a href="#h48-0-1488" id="h48-0-1488" class="i">+			case 1: /* DECCKM -- Cursor key */
</a><a href="#h48-0-1489" id="h48-0-1489" class="i">+				xsetmode(set, MODE_APPCURSOR);
</a><a href="#h48-0-1490" id="h48-0-1490" class="i">+				break;
</a><a href="#h48-0-1491" id="h48-0-1491" class="i">+			case 5: /* DECSCNM -- Reverse video */
</a><a href="#h48-0-1492" id="h48-0-1492" class="i">+				xsetmode(set, MODE_REVERSE);
</a><a href="#h48-0-1493" id="h48-0-1493" class="i">+				break;
</a><a href="#h48-0-1494" id="h48-0-1494" class="i">+			case 6: /* DECOM -- Origin */
</a><a href="#h48-0-1495" id="h48-0-1495" class="i">+				MODBIT(term.c.state, set, CURSOR_ORIGIN);
</a><a href="#h48-0-1496" id="h48-0-1496" class="i">+				tmoveato(0, 0);
</a><a href="#h48-0-1497" id="h48-0-1497" class="i">+				break;
</a><a href="#h48-0-1498" id="h48-0-1498" class="i">+			case 7: /* DECAWM -- Auto wrap */
</a><a href="#h48-0-1499" id="h48-0-1499" class="i">+				MODBIT(term.mode, set, MODE_WRAP);
</a><a href="#h48-0-1500" id="h48-0-1500" class="i">+				break;
</a><a href="#h48-0-1501" id="h48-0-1501" class="i">+			case 0:  /* Error (IGNORED) */
</a><a href="#h48-0-1502" id="h48-0-1502" class="i">+			case 2:  /* DECANM -- ANSI/VT52 (IGNORED) */
</a><a href="#h48-0-1503" id="h48-0-1503" class="i">+			case 3:  /* DECCOLM -- Column  (IGNORED) */
</a><a href="#h48-0-1504" id="h48-0-1504" class="i">+			case 4:  /* DECSCLM -- Scroll (IGNORED) */
</a><a href="#h48-0-1505" id="h48-0-1505" class="i">+			case 8:  /* DECARM -- Auto repeat (IGNORED) */
</a><a href="#h48-0-1506" id="h48-0-1506" class="i">+			case 18: /* DECPFF -- Printer feed (IGNORED) */
</a><a href="#h48-0-1507" id="h48-0-1507" class="i">+			case 19: /* DECPEX -- Printer extent (IGNORED) */
</a><a href="#h48-0-1508" id="h48-0-1508" class="i">+			case 42: /* DECNRCM -- National characters (IGNORED) */
</a><a href="#h48-0-1509" id="h48-0-1509" class="i">+			case 12: /* att610 -- Start blinking cursor (IGNORED) */
</a><a href="#h48-0-1510" id="h48-0-1510" class="i">+				break;
</a><a href="#h48-0-1511" id="h48-0-1511" class="i">+			case 25: /* DECTCEM -- Text Cursor Enable Mode */
</a><a href="#h48-0-1512" id="h48-0-1512" class="i">+				xsetmode(!set, MODE_HIDE);
</a><a href="#h48-0-1513" id="h48-0-1513" class="i">+				break;
</a><a href="#h48-0-1514" id="h48-0-1514" class="i">+			case 9:    /* X10 mouse compatibility mode */
</a><a href="#h48-0-1515" id="h48-0-1515" class="i">+				xsetpointermotion(0);
</a><a href="#h48-0-1516" id="h48-0-1516" class="i">+				xsetmode(0, MODE_MOUSE);
</a><a href="#h48-0-1517" id="h48-0-1517" class="i">+				xsetmode(set, MODE_MOUSEX10);
</a><a href="#h48-0-1518" id="h48-0-1518" class="i">+				break;
</a><a href="#h48-0-1519" id="h48-0-1519" class="i">+			case 1000: /* 1000: report button press */
</a><a href="#h48-0-1520" id="h48-0-1520" class="i">+				xsetpointermotion(0);
</a><a href="#h48-0-1521" id="h48-0-1521" class="i">+				xsetmode(0, MODE_MOUSE);
</a><a href="#h48-0-1522" id="h48-0-1522" class="i">+				xsetmode(set, MODE_MOUSEBTN);
</a><a href="#h48-0-1523" id="h48-0-1523" class="i">+				break;
</a><a href="#h48-0-1524" id="h48-0-1524" class="i">+			case 1002: /* 1002: report motion on button press */
</a><a href="#h48-0-1525" id="h48-0-1525" class="i">+				xsetpointermotion(0);
</a><a href="#h48-0-1526" id="h48-0-1526" class="i">+				xsetmode(0, MODE_MOUSE);
</a><a href="#h48-0-1527" id="h48-0-1527" class="i">+				xsetmode(set, MODE_MOUSEMOTION);
</a><a href="#h48-0-1528" id="h48-0-1528" class="i">+				break;
</a><a href="#h48-0-1529" id="h48-0-1529" class="i">+			case 1003: /* 1003: enable all mouse motions */
</a><a href="#h48-0-1530" id="h48-0-1530" class="i">+				xsetpointermotion(set);
</a><a href="#h48-0-1531" id="h48-0-1531" class="i">+				xsetmode(0, MODE_MOUSE);
</a><a href="#h48-0-1532" id="h48-0-1532" class="i">+				xsetmode(set, MODE_MOUSEMANY);
</a><a href="#h48-0-1533" id="h48-0-1533" class="i">+				break;
</a><a href="#h48-0-1534" id="h48-0-1534" class="i">+			case 1004: /* 1004: send focus events to tty */
</a><a href="#h48-0-1535" id="h48-0-1535" class="i">+				xsetmode(set, MODE_FOCUS);
</a><a href="#h48-0-1536" id="h48-0-1536" class="i">+				break;
</a><a href="#h48-0-1537" id="h48-0-1537" class="i">+			case 1006: /* 1006: extended reporting mode */
</a><a href="#h48-0-1538" id="h48-0-1538" class="i">+				xsetmode(set, MODE_MOUSESGR);
</a><a href="#h48-0-1539" id="h48-0-1539" class="i">+				break;
</a><a href="#h48-0-1540" id="h48-0-1540" class="i">+			case 1034:
</a><a href="#h48-0-1541" id="h48-0-1541" class="i">+				xsetmode(set, MODE_8BIT);
</a><a href="#h48-0-1542" id="h48-0-1542" class="i">+				break;
</a><a href="#h48-0-1543" id="h48-0-1543" class="i">+			case 1049: /* swap screen &amp; set/restore cursor as xterm */
</a><a href="#h48-0-1544" id="h48-0-1544" class="i">+				if (!allowaltscreen)
</a><a href="#h48-0-1545" id="h48-0-1545" class="i">+					break;
</a><a href="#h48-0-1546" id="h48-0-1546" class="i">+				tcursor((set) ? CURSOR_SAVE : CURSOR_LOAD);
</a><a href="#h48-0-1547" id="h48-0-1547" class="i">+				/* FALLTHROUGH */
</a><a href="#h48-0-1548" id="h48-0-1548" class="i">+			case 47: /* swap screen */
</a><a href="#h48-0-1549" id="h48-0-1549" class="i">+			case 1047:
</a><a href="#h48-0-1550" id="h48-0-1550" class="i">+				if (!allowaltscreen)
</a><a href="#h48-0-1551" id="h48-0-1551" class="i">+					break;
</a><a href="#h48-0-1552" id="h48-0-1552" class="i">+				alt = IS_SET(MODE_ALTSCREEN);
</a><a href="#h48-0-1553" id="h48-0-1553" class="i">+				if (alt) {
</a><a href="#h48-0-1554" id="h48-0-1554" class="i">+					tclearregion(0, 0, term.col-1,
</a><a href="#h48-0-1555" id="h48-0-1555" class="i">+							term.row-1);
</a><a href="#h48-0-1556" id="h48-0-1556" class="i">+				}
</a><a href="#h48-0-1557" id="h48-0-1557" class="i">+				if (set ^ alt) /* set is always 1 or 0 */
</a><a href="#h48-0-1558" id="h48-0-1558" class="i">+					tswapscreen();
</a><a href="#h48-0-1559" id="h48-0-1559" class="i">+				if (*args != 1049)
</a><a href="#h48-0-1560" id="h48-0-1560" class="i">+					break;
</a><a href="#h48-0-1561" id="h48-0-1561" class="i">+				/* FALLTHROUGH */
</a><a href="#h48-0-1562" id="h48-0-1562" class="i">+			case 1048:
</a><a href="#h48-0-1563" id="h48-0-1563" class="i">+				tcursor((set) ? CURSOR_SAVE : CURSOR_LOAD);
</a><a href="#h48-0-1564" id="h48-0-1564" class="i">+				break;
</a><a href="#h48-0-1565" id="h48-0-1565" class="i">+			case 2004: /* 2004: bracketed paste mode */
</a><a href="#h48-0-1566" id="h48-0-1566" class="i">+				xsetmode(set, MODE_BRCKTPASTE);
</a><a href="#h48-0-1567" id="h48-0-1567" class="i">+				break;
</a><a href="#h48-0-1568" id="h48-0-1568" class="i">+			/* Not implemented mouse modes. See comments there. */
</a><a href="#h48-0-1569" id="h48-0-1569" class="i">+			case 1001: /* mouse highlight mode; can hang the
</a><a href="#h48-0-1570" id="h48-0-1570" class="i">+				      terminal by design when implemented. */
</a><a href="#h48-0-1571" id="h48-0-1571" class="i">+			case 1005: /* UTF-8 mouse mode; will confuse
</a><a href="#h48-0-1572" id="h48-0-1572" class="i">+				      applications not supporting UTF-8
</a><a href="#h48-0-1573" id="h48-0-1573" class="i">+				      and luit. */
</a><a href="#h48-0-1574" id="h48-0-1574" class="i">+			case 1015: /* urxvt mangled mouse mode; incompatible
</a><a href="#h48-0-1575" id="h48-0-1575" class="i">+				      and can be mistaken for other control
</a><a href="#h48-0-1576" id="h48-0-1576" class="i">+				      codes. */
</a><a href="#h48-0-1577" id="h48-0-1577" class="i">+			default:
</a><a href="#h48-0-1578" id="h48-0-1578" class="i">+				fprintf(stderr,
</a><a href="#h48-0-1579" id="h48-0-1579" class="i">+					&quot;erresc: unknown private set/reset mode %d\n&quot;,
</a><a href="#h48-0-1580" id="h48-0-1580" class="i">+					*args);
</a><a href="#h48-0-1581" id="h48-0-1581" class="i">+				break;
</a><a href="#h48-0-1582" id="h48-0-1582" class="i">+			}
</a><a href="#h48-0-1583" id="h48-0-1583" class="i">+		} else {
</a><a href="#h48-0-1584" id="h48-0-1584" class="i">+			switch (*args) {
</a><a href="#h48-0-1585" id="h48-0-1585" class="i">+			case 0:  /* Error (IGNORED) */
</a><a href="#h48-0-1586" id="h48-0-1586" class="i">+				break;
</a><a href="#h48-0-1587" id="h48-0-1587" class="i">+			case 2:
</a><a href="#h48-0-1588" id="h48-0-1588" class="i">+				xsetmode(set, MODE_KBDLOCK);
</a><a href="#h48-0-1589" id="h48-0-1589" class="i">+				break;
</a><a href="#h48-0-1590" id="h48-0-1590" class="i">+			case 4:  /* IRM -- Insertion-replacement */
</a><a href="#h48-0-1591" id="h48-0-1591" class="i">+				MODBIT(term.mode, set, MODE_INSERT);
</a><a href="#h48-0-1592" id="h48-0-1592" class="i">+				break;
</a><a href="#h48-0-1593" id="h48-0-1593" class="i">+			case 12: /* SRM -- Send/Receive */
</a><a href="#h48-0-1594" id="h48-0-1594" class="i">+				MODBIT(term.mode, !set, MODE_ECHO);
</a><a href="#h48-0-1595" id="h48-0-1595" class="i">+				break;
</a><a href="#h48-0-1596" id="h48-0-1596" class="i">+			case 20: /* LNM -- Linefeed/new line */
</a><a href="#h48-0-1597" id="h48-0-1597" class="i">+				MODBIT(term.mode, set, MODE_CRLF);
</a><a href="#h48-0-1598" id="h48-0-1598" class="i">+				break;
</a><a href="#h48-0-1599" id="h48-0-1599" class="i">+			default:
</a><a href="#h48-0-1600" id="h48-0-1600" class="i">+				fprintf(stderr,
</a><a href="#h48-0-1601" id="h48-0-1601" class="i">+					&quot;erresc: unknown set/reset mode %d\n&quot;,
</a><a href="#h48-0-1602" id="h48-0-1602" class="i">+					*args);
</a><a href="#h48-0-1603" id="h48-0-1603" class="i">+				break;
</a><a href="#h48-0-1604" id="h48-0-1604" class="i">+			}
</a><a href="#h48-0-1605" id="h48-0-1605" class="i">+		}
</a><a href="#h48-0-1606" id="h48-0-1606" class="i">+	}
</a><a href="#h48-0-1607" id="h48-0-1607" class="i">+}
</a><a href="#h48-0-1608" id="h48-0-1608" class="i">+
</a><a href="#h48-0-1609" id="h48-0-1609" class="i">+void
</a><a href="#h48-0-1610" id="h48-0-1610" class="i">+csihandle(void)
</a><a href="#h48-0-1611" id="h48-0-1611" class="i">+{
</a><a href="#h48-0-1612" id="h48-0-1612" class="i">+	char buf[40];
</a><a href="#h48-0-1613" id="h48-0-1613" class="i">+	int len;
</a><a href="#h48-0-1614" id="h48-0-1614" class="i">+
</a><a href="#h48-0-1615" id="h48-0-1615" class="i">+	switch (csiescseq.mode[0]) {
</a><a href="#h48-0-1616" id="h48-0-1616" class="i">+	default:
</a><a href="#h48-0-1617" id="h48-0-1617" class="i">+	unknown:
</a><a href="#h48-0-1618" id="h48-0-1618" class="i">+		fprintf(stderr, &quot;erresc: unknown csi &quot;);
</a><a href="#h48-0-1619" id="h48-0-1619" class="i">+		csidump();
</a><a href="#h48-0-1620" id="h48-0-1620" class="i">+		/* die(&quot;&quot;); */
</a><a href="#h48-0-1621" id="h48-0-1621" class="i">+		break;
</a><a href="#h48-0-1622" id="h48-0-1622" class="i">+	case &#39;@&#39;: /* ICH -- Insert &lt;n&gt; blank char */
</a><a href="#h48-0-1623" id="h48-0-1623" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1624" id="h48-0-1624" class="i">+		tinsertblank(csiescseq.arg[0]);
</a><a href="#h48-0-1625" id="h48-0-1625" class="i">+		break;
</a><a href="#h48-0-1626" id="h48-0-1626" class="i">+	case &#39;A&#39;: /* CUU -- Cursor &lt;n&gt; Up */
</a><a href="#h48-0-1627" id="h48-0-1627" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1628" id="h48-0-1628" class="i">+		tmoveto(term.c.x, term.c.y-csiescseq.arg[0]);
</a><a href="#h48-0-1629" id="h48-0-1629" class="i">+		break;
</a><a href="#h48-0-1630" id="h48-0-1630" class="i">+	case &#39;B&#39;: /* CUD -- Cursor &lt;n&gt; Down */
</a><a href="#h48-0-1631" id="h48-0-1631" class="i">+	case &#39;e&#39;: /* VPR --Cursor &lt;n&gt; Down */
</a><a href="#h48-0-1632" id="h48-0-1632" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1633" id="h48-0-1633" class="i">+		tmoveto(term.c.x, term.c.y+csiescseq.arg[0]);
</a><a href="#h48-0-1634" id="h48-0-1634" class="i">+		break;
</a><a href="#h48-0-1635" id="h48-0-1635" class="i">+	case &#39;i&#39;: /* MC -- Media Copy */
</a><a href="#h48-0-1636" id="h48-0-1636" class="i">+		switch (csiescseq.arg[0]) {
</a><a href="#h48-0-1637" id="h48-0-1637" class="i">+		case 0:
</a><a href="#h48-0-1638" id="h48-0-1638" class="i">+			tdump();
</a><a href="#h48-0-1639" id="h48-0-1639" class="i">+			break;
</a><a href="#h48-0-1640" id="h48-0-1640" class="i">+		case 1:
</a><a href="#h48-0-1641" id="h48-0-1641" class="i">+			tdumpline(term.c.y);
</a><a href="#h48-0-1642" id="h48-0-1642" class="i">+			break;
</a><a href="#h48-0-1643" id="h48-0-1643" class="i">+		case 2:
</a><a href="#h48-0-1644" id="h48-0-1644" class="i">+			tdumpsel();
</a><a href="#h48-0-1645" id="h48-0-1645" class="i">+			break;
</a><a href="#h48-0-1646" id="h48-0-1646" class="i">+		case 4:
</a><a href="#h48-0-1647" id="h48-0-1647" class="i">+			term.mode &amp;= ~MODE_PRINT;
</a><a href="#h48-0-1648" id="h48-0-1648" class="i">+			break;
</a><a href="#h48-0-1649" id="h48-0-1649" class="i">+		case 5:
</a><a href="#h48-0-1650" id="h48-0-1650" class="i">+			term.mode |= MODE_PRINT;
</a><a href="#h48-0-1651" id="h48-0-1651" class="i">+			break;
</a><a href="#h48-0-1652" id="h48-0-1652" class="i">+		}
</a><a href="#h48-0-1653" id="h48-0-1653" class="i">+		break;
</a><a href="#h48-0-1654" id="h48-0-1654" class="i">+	case &#39;c&#39;: /* DA -- Device Attributes */
</a><a href="#h48-0-1655" id="h48-0-1655" class="i">+		if (csiescseq.arg[0] == 0)
</a><a href="#h48-0-1656" id="h48-0-1656" class="i">+			ttywrite(vtiden, strlen(vtiden), 0);
</a><a href="#h48-0-1657" id="h48-0-1657" class="i">+		break;
</a><a href="#h48-0-1658" id="h48-0-1658" class="i">+	case &#39;C&#39;: /* CUF -- Cursor &lt;n&gt; Forward */
</a><a href="#h48-0-1659" id="h48-0-1659" class="i">+	case &#39;a&#39;: /* HPR -- Cursor &lt;n&gt; Forward */
</a><a href="#h48-0-1660" id="h48-0-1660" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1661" id="h48-0-1661" class="i">+		tmoveto(term.c.x+csiescseq.arg[0], term.c.y);
</a><a href="#h48-0-1662" id="h48-0-1662" class="i">+		break;
</a><a href="#h48-0-1663" id="h48-0-1663" class="i">+	case &#39;D&#39;: /* CUB -- Cursor &lt;n&gt; Backward */
</a><a href="#h48-0-1664" id="h48-0-1664" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1665" id="h48-0-1665" class="i">+		tmoveto(term.c.x-csiescseq.arg[0], term.c.y);
</a><a href="#h48-0-1666" id="h48-0-1666" class="i">+		break;
</a><a href="#h48-0-1667" id="h48-0-1667" class="i">+	case &#39;E&#39;: /* CNL -- Cursor &lt;n&gt; Down and first col */
</a><a href="#h48-0-1668" id="h48-0-1668" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1669" id="h48-0-1669" class="i">+		tmoveto(0, term.c.y+csiescseq.arg[0]);
</a><a href="#h48-0-1670" id="h48-0-1670" class="i">+		break;
</a><a href="#h48-0-1671" id="h48-0-1671" class="i">+	case &#39;F&#39;: /* CPL -- Cursor &lt;n&gt; Up and first col */
</a><a href="#h48-0-1672" id="h48-0-1672" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1673" id="h48-0-1673" class="i">+		tmoveto(0, term.c.y-csiescseq.arg[0]);
</a><a href="#h48-0-1674" id="h48-0-1674" class="i">+		break;
</a><a href="#h48-0-1675" id="h48-0-1675" class="i">+	case &#39;g&#39;: /* TBC -- Tabulation clear */
</a><a href="#h48-0-1676" id="h48-0-1676" class="i">+		switch (csiescseq.arg[0]) {
</a><a href="#h48-0-1677" id="h48-0-1677" class="i">+		case 0: /* clear current tab stop */
</a><a href="#h48-0-1678" id="h48-0-1678" class="i">+			term.tabs[term.c.x] = 0;
</a><a href="#h48-0-1679" id="h48-0-1679" class="i">+			break;
</a><a href="#h48-0-1680" id="h48-0-1680" class="i">+		case 3: /* clear all the tabs */
</a><a href="#h48-0-1681" id="h48-0-1681" class="i">+			memset(term.tabs, 0, term.col * sizeof(*term.tabs));
</a><a href="#h48-0-1682" id="h48-0-1682" class="i">+			break;
</a><a href="#h48-0-1683" id="h48-0-1683" class="i">+		default:
</a><a href="#h48-0-1684" id="h48-0-1684" class="i">+			goto unknown;
</a><a href="#h48-0-1685" id="h48-0-1685" class="i">+		}
</a><a href="#h48-0-1686" id="h48-0-1686" class="i">+		break;
</a><a href="#h48-0-1687" id="h48-0-1687" class="i">+	case &#39;G&#39;: /* CHA -- Move to &lt;col&gt; */
</a><a href="#h48-0-1688" id="h48-0-1688" class="i">+	case &#39;`&#39;: /* HPA */
</a><a href="#h48-0-1689" id="h48-0-1689" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1690" id="h48-0-1690" class="i">+		tmoveto(csiescseq.arg[0]-1, term.c.y);
</a><a href="#h48-0-1691" id="h48-0-1691" class="i">+		break;
</a><a href="#h48-0-1692" id="h48-0-1692" class="i">+	case &#39;H&#39;: /* CUP -- Move to &lt;row&gt; &lt;col&gt; */
</a><a href="#h48-0-1693" id="h48-0-1693" class="i">+	case &#39;f&#39;: /* HVP */
</a><a href="#h48-0-1694" id="h48-0-1694" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1695" id="h48-0-1695" class="i">+		DEFAULT(csiescseq.arg[1], 1);
</a><a href="#h48-0-1696" id="h48-0-1696" class="i">+		tmoveato(csiescseq.arg[1]-1, csiescseq.arg[0]-1);
</a><a href="#h48-0-1697" id="h48-0-1697" class="i">+		break;
</a><a href="#h48-0-1698" id="h48-0-1698" class="i">+	case &#39;I&#39;: /* CHT -- Cursor Forward Tabulation &lt;n&gt; tab stops */
</a><a href="#h48-0-1699" id="h48-0-1699" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1700" id="h48-0-1700" class="i">+		tputtab(csiescseq.arg[0]);
</a><a href="#h48-0-1701" id="h48-0-1701" class="i">+		break;
</a><a href="#h48-0-1702" id="h48-0-1702" class="i">+	case &#39;J&#39;: /* ED -- Clear screen */
</a><a href="#h48-0-1703" id="h48-0-1703" class="i">+		switch (csiescseq.arg[0]) {
</a><a href="#h48-0-1704" id="h48-0-1704" class="i">+		case 0: /* below */
</a><a href="#h48-0-1705" id="h48-0-1705" class="i">+			tclearregion(term.c.x, term.c.y, term.col-1, term.c.y);
</a><a href="#h48-0-1706" id="h48-0-1706" class="i">+			if (term.c.y &lt; term.row-1) {
</a><a href="#h48-0-1707" id="h48-0-1707" class="i">+				tclearregion(0, term.c.y+1, term.col-1,
</a><a href="#h48-0-1708" id="h48-0-1708" class="i">+						term.row-1);
</a><a href="#h48-0-1709" id="h48-0-1709" class="i">+			}
</a><a href="#h48-0-1710" id="h48-0-1710" class="i">+			break;
</a><a href="#h48-0-1711" id="h48-0-1711" class="i">+		case 1: /* above */
</a><a href="#h48-0-1712" id="h48-0-1712" class="i">+			if (term.c.y &gt; 1)
</a><a href="#h48-0-1713" id="h48-0-1713" class="i">+				tclearregion(0, 0, term.col-1, term.c.y-1);
</a><a href="#h48-0-1714" id="h48-0-1714" class="i">+			tclearregion(0, term.c.y, term.c.x, term.c.y);
</a><a href="#h48-0-1715" id="h48-0-1715" class="i">+			break;
</a><a href="#h48-0-1716" id="h48-0-1716" class="i">+		case 2: /* all */
</a><a href="#h48-0-1717" id="h48-0-1717" class="i">+			tclearregion(0, 0, term.col-1, term.row-1);
</a><a href="#h48-0-1718" id="h48-0-1718" class="i">+			break;
</a><a href="#h48-0-1719" id="h48-0-1719" class="i">+		default:
</a><a href="#h48-0-1720" id="h48-0-1720" class="i">+			goto unknown;
</a><a href="#h48-0-1721" id="h48-0-1721" class="i">+		}
</a><a href="#h48-0-1722" id="h48-0-1722" class="i">+		break;
</a><a href="#h48-0-1723" id="h48-0-1723" class="i">+	case &#39;K&#39;: /* EL -- Clear line */
</a><a href="#h48-0-1724" id="h48-0-1724" class="i">+		switch (csiescseq.arg[0]) {
</a><a href="#h48-0-1725" id="h48-0-1725" class="i">+		case 0: /* right */
</a><a href="#h48-0-1726" id="h48-0-1726" class="i">+			tclearregion(term.c.x, term.c.y, term.col-1,
</a><a href="#h48-0-1727" id="h48-0-1727" class="i">+					term.c.y);
</a><a href="#h48-0-1728" id="h48-0-1728" class="i">+			break;
</a><a href="#h48-0-1729" id="h48-0-1729" class="i">+		case 1: /* left */
</a><a href="#h48-0-1730" id="h48-0-1730" class="i">+			tclearregion(0, term.c.y, term.c.x, term.c.y);
</a><a href="#h48-0-1731" id="h48-0-1731" class="i">+			break;
</a><a href="#h48-0-1732" id="h48-0-1732" class="i">+		case 2: /* all */
</a><a href="#h48-0-1733" id="h48-0-1733" class="i">+			tclearregion(0, term.c.y, term.col-1, term.c.y);
</a><a href="#h48-0-1734" id="h48-0-1734" class="i">+			break;
</a><a href="#h48-0-1735" id="h48-0-1735" class="i">+		}
</a><a href="#h48-0-1736" id="h48-0-1736" class="i">+		break;
</a><a href="#h48-0-1737" id="h48-0-1737" class="i">+	case &#39;S&#39;: /* SU -- Scroll &lt;n&gt; line up */
</a><a href="#h48-0-1738" id="h48-0-1738" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1739" id="h48-0-1739" class="i">+		tscrollup(term.top, csiescseq.arg[0]);
</a><a href="#h48-0-1740" id="h48-0-1740" class="i">+		break;
</a><a href="#h48-0-1741" id="h48-0-1741" class="i">+	case &#39;T&#39;: /* SD -- Scroll &lt;n&gt; line down */
</a><a href="#h48-0-1742" id="h48-0-1742" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1743" id="h48-0-1743" class="i">+		tscrolldown(term.top, csiescseq.arg[0]);
</a><a href="#h48-0-1744" id="h48-0-1744" class="i">+		break;
</a><a href="#h48-0-1745" id="h48-0-1745" class="i">+	case &#39;L&#39;: /* IL -- Insert &lt;n&gt; blank lines */
</a><a href="#h48-0-1746" id="h48-0-1746" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1747" id="h48-0-1747" class="i">+		tinsertblankline(csiescseq.arg[0]);
</a><a href="#h48-0-1748" id="h48-0-1748" class="i">+		break;
</a><a href="#h48-0-1749" id="h48-0-1749" class="i">+	case &#39;l&#39;: /* RM -- Reset Mode */
</a><a href="#h48-0-1750" id="h48-0-1750" class="i">+		tsetmode(csiescseq.priv, 0, csiescseq.arg, csiescseq.narg);
</a><a href="#h48-0-1751" id="h48-0-1751" class="i">+		break;
</a><a href="#h48-0-1752" id="h48-0-1752" class="i">+	case &#39;M&#39;: /* DL -- Delete &lt;n&gt; lines */
</a><a href="#h48-0-1753" id="h48-0-1753" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1754" id="h48-0-1754" class="i">+		tdeleteline(csiescseq.arg[0]);
</a><a href="#h48-0-1755" id="h48-0-1755" class="i">+		break;
</a><a href="#h48-0-1756" id="h48-0-1756" class="i">+	case &#39;X&#39;: /* ECH -- Erase &lt;n&gt; char */
</a><a href="#h48-0-1757" id="h48-0-1757" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1758" id="h48-0-1758" class="i">+		tclearregion(term.c.x, term.c.y,
</a><a href="#h48-0-1759" id="h48-0-1759" class="i">+				term.c.x + csiescseq.arg[0] - 1, term.c.y);
</a><a href="#h48-0-1760" id="h48-0-1760" class="i">+		break;
</a><a href="#h48-0-1761" id="h48-0-1761" class="i">+	case &#39;P&#39;: /* DCH -- Delete &lt;n&gt; char */
</a><a href="#h48-0-1762" id="h48-0-1762" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1763" id="h48-0-1763" class="i">+		tdeletechar(csiescseq.arg[0]);
</a><a href="#h48-0-1764" id="h48-0-1764" class="i">+		break;
</a><a href="#h48-0-1765" id="h48-0-1765" class="i">+	case &#39;Z&#39;: /* CBT -- Cursor Backward Tabulation &lt;n&gt; tab stops */
</a><a href="#h48-0-1766" id="h48-0-1766" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1767" id="h48-0-1767" class="i">+		tputtab(-csiescseq.arg[0]);
</a><a href="#h48-0-1768" id="h48-0-1768" class="i">+		break;
</a><a href="#h48-0-1769" id="h48-0-1769" class="i">+	case &#39;d&#39;: /* VPA -- Move to &lt;row&gt; */
</a><a href="#h48-0-1770" id="h48-0-1770" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1771" id="h48-0-1771" class="i">+		tmoveato(term.c.x, csiescseq.arg[0]-1);
</a><a href="#h48-0-1772" id="h48-0-1772" class="i">+		break;
</a><a href="#h48-0-1773" id="h48-0-1773" class="i">+	case &#39;h&#39;: /* SM -- Set terminal mode */
</a><a href="#h48-0-1774" id="h48-0-1774" class="i">+		tsetmode(csiescseq.priv, 1, csiescseq.arg, csiescseq.narg);
</a><a href="#h48-0-1775" id="h48-0-1775" class="i">+		break;
</a><a href="#h48-0-1776" id="h48-0-1776" class="i">+	case &#39;m&#39;: /* SGR -- Terminal attribute (color) */
</a><a href="#h48-0-1777" id="h48-0-1777" class="i">+		tsetattr(csiescseq.arg, csiescseq.narg);
</a><a href="#h48-0-1778" id="h48-0-1778" class="i">+		break;
</a><a href="#h48-0-1779" id="h48-0-1779" class="i">+	case &#39;n&#39;: /* DSR – Device Status Report (cursor position) */
</a><a href="#h48-0-1780" id="h48-0-1780" class="i">+		if (csiescseq.arg[0] == 6) {
</a><a href="#h48-0-1781" id="h48-0-1781" class="i">+			len = snprintf(buf, sizeof(buf),&quot;\033[%i;%iR&quot;,
</a><a href="#h48-0-1782" id="h48-0-1782" class="i">+					term.c.y+1, term.c.x+1);
</a><a href="#h48-0-1783" id="h48-0-1783" class="i">+			ttywrite(buf, len, 0);
</a><a href="#h48-0-1784" id="h48-0-1784" class="i">+		}
</a><a href="#h48-0-1785" id="h48-0-1785" class="i">+		break;
</a><a href="#h48-0-1786" id="h48-0-1786" class="i">+	case &#39;r&#39;: /* DECSTBM -- Set Scrolling Region */
</a><a href="#h48-0-1787" id="h48-0-1787" class="i">+		if (csiescseq.priv) {
</a><a href="#h48-0-1788" id="h48-0-1788" class="i">+			goto unknown;
</a><a href="#h48-0-1789" id="h48-0-1789" class="i">+		} else {
</a><a href="#h48-0-1790" id="h48-0-1790" class="i">+			DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h48-0-1791" id="h48-0-1791" class="i">+			DEFAULT(csiescseq.arg[1], term.row);
</a><a href="#h48-0-1792" id="h48-0-1792" class="i">+			tsetscroll(csiescseq.arg[0]-1, csiescseq.arg[1]-1);
</a><a href="#h48-0-1793" id="h48-0-1793" class="i">+			tmoveato(0, 0);
</a><a href="#h48-0-1794" id="h48-0-1794" class="i">+		}
</a><a href="#h48-0-1795" id="h48-0-1795" class="i">+		break;
</a><a href="#h48-0-1796" id="h48-0-1796" class="i">+	case &#39;s&#39;: /* DECSC -- Save cursor position (ANSI.SYS) */
</a><a href="#h48-0-1797" id="h48-0-1797" class="i">+		tcursor(CURSOR_SAVE);
</a><a href="#h48-0-1798" id="h48-0-1798" class="i">+		break;
</a><a href="#h48-0-1799" id="h48-0-1799" class="i">+	case &#39;u&#39;: /* DECRC -- Restore cursor position (ANSI.SYS) */
</a><a href="#h48-0-1800" id="h48-0-1800" class="i">+		tcursor(CURSOR_LOAD);
</a><a href="#h48-0-1801" id="h48-0-1801" class="i">+		break;
</a><a href="#h48-0-1802" id="h48-0-1802" class="i">+	case &#39; &#39;:
</a><a href="#h48-0-1803" id="h48-0-1803" class="i">+		switch (csiescseq.mode[1]) {
</a><a href="#h48-0-1804" id="h48-0-1804" class="i">+		case &#39;q&#39;: /* DECSCUSR -- Set Cursor Style */
</a><a href="#h48-0-1805" id="h48-0-1805" class="i">+			if (xsetcursor(csiescseq.arg[0]))
</a><a href="#h48-0-1806" id="h48-0-1806" class="i">+				goto unknown;
</a><a href="#h48-0-1807" id="h48-0-1807" class="i">+			break;
</a><a href="#h48-0-1808" id="h48-0-1808" class="i">+		default:
</a><a href="#h48-0-1809" id="h48-0-1809" class="i">+			goto unknown;
</a><a href="#h48-0-1810" id="h48-0-1810" class="i">+		}
</a><a href="#h48-0-1811" id="h48-0-1811" class="i">+		break;
</a><a href="#h48-0-1812" id="h48-0-1812" class="i">+	}
</a><a href="#h48-0-1813" id="h48-0-1813" class="i">+}
</a><a href="#h48-0-1814" id="h48-0-1814" class="i">+
</a><a href="#h48-0-1815" id="h48-0-1815" class="i">+void
</a><a href="#h48-0-1816" id="h48-0-1816" class="i">+csidump(void)
</a><a href="#h48-0-1817" id="h48-0-1817" class="i">+{
</a><a href="#h48-0-1818" id="h48-0-1818" class="i">+	int i;
</a><a href="#h48-0-1819" id="h48-0-1819" class="i">+	uint c;
</a><a href="#h48-0-1820" id="h48-0-1820" class="i">+
</a><a href="#h48-0-1821" id="h48-0-1821" class="i">+	fprintf(stderr, &quot;ESC[&quot;);
</a><a href="#h48-0-1822" id="h48-0-1822" class="i">+	for (i = 0; i &lt; csiescseq.len; i++) {
</a><a href="#h48-0-1823" id="h48-0-1823" class="i">+		c = csiescseq.buf[i] &amp; 0xff;
</a><a href="#h48-0-1824" id="h48-0-1824" class="i">+		if (isprint(c)) {
</a><a href="#h48-0-1825" id="h48-0-1825" class="i">+			putc(c, stderr);
</a><a href="#h48-0-1826" id="h48-0-1826" class="i">+		} else if (c == &#39;\n&#39;) {
</a><a href="#h48-0-1827" id="h48-0-1827" class="i">+			fprintf(stderr, &quot;(\\n)&quot;);
</a><a href="#h48-0-1828" id="h48-0-1828" class="i">+		} else if (c == &#39;\r&#39;) {
</a><a href="#h48-0-1829" id="h48-0-1829" class="i">+			fprintf(stderr, &quot;(\\r)&quot;);
</a><a href="#h48-0-1830" id="h48-0-1830" class="i">+		} else if (c == 0x1b) {
</a><a href="#h48-0-1831" id="h48-0-1831" class="i">+			fprintf(stderr, &quot;(\\e)&quot;);
</a><a href="#h48-0-1832" id="h48-0-1832" class="i">+		} else {
</a><a href="#h48-0-1833" id="h48-0-1833" class="i">+			fprintf(stderr, &quot;(%02x)&quot;, c);
</a><a href="#h48-0-1834" id="h48-0-1834" class="i">+		}
</a><a href="#h48-0-1835" id="h48-0-1835" class="i">+	}
</a><a href="#h48-0-1836" id="h48-0-1836" class="i">+	putc(&#39;\n&#39;, stderr);
</a><a href="#h48-0-1837" id="h48-0-1837" class="i">+}
</a><a href="#h48-0-1838" id="h48-0-1838" class="i">+
</a><a href="#h48-0-1839" id="h48-0-1839" class="i">+void
</a><a href="#h48-0-1840" id="h48-0-1840" class="i">+csireset(void)
</a><a href="#h48-0-1841" id="h48-0-1841" class="i">+{
</a><a href="#h48-0-1842" id="h48-0-1842" class="i">+	memset(&amp;csiescseq, 0, sizeof(csiescseq));
</a><a href="#h48-0-1843" id="h48-0-1843" class="i">+}
</a><a href="#h48-0-1844" id="h48-0-1844" class="i">+
</a><a href="#h48-0-1845" id="h48-0-1845" class="i">+void
</a><a href="#h48-0-1846" id="h48-0-1846" class="i">+strhandle(void)
</a><a href="#h48-0-1847" id="h48-0-1847" class="i">+{
</a><a href="#h48-0-1848" id="h48-0-1848" class="i">+	char *p = NULL;
</a><a href="#h48-0-1849" id="h48-0-1849" class="i">+	int j, narg, par;
</a><a href="#h48-0-1850" id="h48-0-1850" class="i">+
</a><a href="#h48-0-1851" id="h48-0-1851" class="i">+	term.esc &amp;= ~(ESC_STR_END|ESC_STR);
</a><a href="#h48-0-1852" id="h48-0-1852" class="i">+	strparse();
</a><a href="#h48-0-1853" id="h48-0-1853" class="i">+	par = (narg = strescseq.narg) ? atoi(strescseq.args[0]) : 0;
</a><a href="#h48-0-1854" id="h48-0-1854" class="i">+
</a><a href="#h48-0-1855" id="h48-0-1855" class="i">+	switch (strescseq.type) {
</a><a href="#h48-0-1856" id="h48-0-1856" class="i">+	case &#39;]&#39;: /* OSC -- Operating System Command */
</a><a href="#h48-0-1857" id="h48-0-1857" class="i">+		switch (par) {
</a><a href="#h48-0-1858" id="h48-0-1858" class="i">+		case 0:
</a><a href="#h48-0-1859" id="h48-0-1859" class="i">+		case 1:
</a><a href="#h48-0-1860" id="h48-0-1860" class="i">+		case 2:
</a><a href="#h48-0-1861" id="h48-0-1861" class="i">+			if (narg &gt; 1)
</a><a href="#h48-0-1862" id="h48-0-1862" class="i">+				xsettitle(strescseq.args[1]);
</a><a href="#h48-0-1863" id="h48-0-1863" class="i">+			return;
</a><a href="#h48-0-1864" id="h48-0-1864" class="i">+		case 52:
</a><a href="#h48-0-1865" id="h48-0-1865" class="i">+			if (narg &gt; 2) {
</a><a href="#h48-0-1866" id="h48-0-1866" class="i">+				char *dec;
</a><a href="#h48-0-1867" id="h48-0-1867" class="i">+
</a><a href="#h48-0-1868" id="h48-0-1868" class="i">+				dec = base64dec(strescseq.args[2]);
</a><a href="#h48-0-1869" id="h48-0-1869" class="i">+				if (dec) {
</a><a href="#h48-0-1870" id="h48-0-1870" class="i">+					xsetsel(dec);
</a><a href="#h48-0-1871" id="h48-0-1871" class="i">+					xclipcopy();
</a><a href="#h48-0-1872" id="h48-0-1872" class="i">+				} else {
</a><a href="#h48-0-1873" id="h48-0-1873" class="i">+					fprintf(stderr, &quot;erresc: invalid base64\n&quot;);
</a><a href="#h48-0-1874" id="h48-0-1874" class="i">+				}
</a><a href="#h48-0-1875" id="h48-0-1875" class="i">+			}
</a><a href="#h48-0-1876" id="h48-0-1876" class="i">+			return;
</a><a href="#h48-0-1877" id="h48-0-1877" class="i">+		case 4: /* color set */
</a><a href="#h48-0-1878" id="h48-0-1878" class="i">+			if (narg &lt; 3)
</a><a href="#h48-0-1879" id="h48-0-1879" class="i">+				break;
</a><a href="#h48-0-1880" id="h48-0-1880" class="i">+			p = strescseq.args[2];
</a><a href="#h48-0-1881" id="h48-0-1881" class="i">+			/* FALLTHROUGH */
</a><a href="#h48-0-1882" id="h48-0-1882" class="i">+		case 104: /* color reset, here p = NULL */
</a><a href="#h48-0-1883" id="h48-0-1883" class="i">+			j = (narg &gt; 1) ? atoi(strescseq.args[1]) : -1;
</a><a href="#h48-0-1884" id="h48-0-1884" class="i">+			if (xsetcolorname(j, p)) {
</a><a href="#h48-0-1885" id="h48-0-1885" class="i">+				fprintf(stderr, &quot;erresc: invalid color %s\n&quot;, p);
</a><a href="#h48-0-1886" id="h48-0-1886" class="i">+			} else {
</a><a href="#h48-0-1887" id="h48-0-1887" class="i">+				/*
</a><a href="#h48-0-1888" id="h48-0-1888" class="i">+				 * TODO if defaultbg color is changed, borders
</a><a href="#h48-0-1889" id="h48-0-1889" class="i">+				 * are dirty
</a><a href="#h48-0-1890" id="h48-0-1890" class="i">+				 */
</a><a href="#h48-0-1891" id="h48-0-1891" class="i">+				redraw();
</a><a href="#h48-0-1892" id="h48-0-1892" class="i">+			}
</a><a href="#h48-0-1893" id="h48-0-1893" class="i">+			return;
</a><a href="#h48-0-1894" id="h48-0-1894" class="i">+		}
</a><a href="#h48-0-1895" id="h48-0-1895" class="i">+		break;
</a><a href="#h48-0-1896" id="h48-0-1896" class="i">+	case &#39;k&#39;: /* old title set compatibility */
</a><a href="#h48-0-1897" id="h48-0-1897" class="i">+		xsettitle(strescseq.args[0]);
</a><a href="#h48-0-1898" id="h48-0-1898" class="i">+		return;
</a><a href="#h48-0-1899" id="h48-0-1899" class="i">+	case &#39;P&#39;: /* DCS -- Device Control String */
</a><a href="#h48-0-1900" id="h48-0-1900" class="i">+		term.mode |= ESC_DCS;
</a><a href="#h48-0-1901" id="h48-0-1901" class="i">+	case &#39;_&#39;: /* APC -- Application Program Command */
</a><a href="#h48-0-1902" id="h48-0-1902" class="i">+	case &#39;^&#39;: /* PM -- Privacy Message */
</a><a href="#h48-0-1903" id="h48-0-1903" class="i">+		return;
</a><a href="#h48-0-1904" id="h48-0-1904" class="i">+	}
</a><a href="#h48-0-1905" id="h48-0-1905" class="i">+
</a><a href="#h48-0-1906" id="h48-0-1906" class="i">+	fprintf(stderr, &quot;erresc: unknown str &quot;);
</a><a href="#h48-0-1907" id="h48-0-1907" class="i">+	strdump();
</a><a href="#h48-0-1908" id="h48-0-1908" class="i">+}
</a><a href="#h48-0-1909" id="h48-0-1909" class="i">+
</a><a href="#h48-0-1910" id="h48-0-1910" class="i">+void
</a><a href="#h48-0-1911" id="h48-0-1911" class="i">+strparse(void)
</a><a href="#h48-0-1912" id="h48-0-1912" class="i">+{
</a><a href="#h48-0-1913" id="h48-0-1913" class="i">+	int c;
</a><a href="#h48-0-1914" id="h48-0-1914" class="i">+	char *p = strescseq.buf;
</a><a href="#h48-0-1915" id="h48-0-1915" class="i">+
</a><a href="#h48-0-1916" id="h48-0-1916" class="i">+	strescseq.narg = 0;
</a><a href="#h48-0-1917" id="h48-0-1917" class="i">+	strescseq.buf[strescseq.len] = &#39;\0&#39;;
</a><a href="#h48-0-1918" id="h48-0-1918" class="i">+
</a><a href="#h48-0-1919" id="h48-0-1919" class="i">+	if (*p == &#39;\0&#39;)
</a><a href="#h48-0-1920" id="h48-0-1920" class="i">+		return;
</a><a href="#h48-0-1921" id="h48-0-1921" class="i">+
</a><a href="#h48-0-1922" id="h48-0-1922" class="i">+	while (strescseq.narg &lt; STR_ARG_SIZ) {
</a><a href="#h48-0-1923" id="h48-0-1923" class="i">+		strescseq.args[strescseq.narg++] = p;
</a><a href="#h48-0-1924" id="h48-0-1924" class="i">+		while ((c = *p) != &#39;;&#39; &amp;&amp; c != &#39;\0&#39;)
</a><a href="#h48-0-1925" id="h48-0-1925" class="i">+			++p;
</a><a href="#h48-0-1926" id="h48-0-1926" class="i">+		if (c == &#39;\0&#39;)
</a><a href="#h48-0-1927" id="h48-0-1927" class="i">+			return;
</a><a href="#h48-0-1928" id="h48-0-1928" class="i">+		*p++ = &#39;\0&#39;;
</a><a href="#h48-0-1929" id="h48-0-1929" class="i">+	}
</a><a href="#h48-0-1930" id="h48-0-1930" class="i">+}
</a><a href="#h48-0-1931" id="h48-0-1931" class="i">+
</a><a href="#h48-0-1932" id="h48-0-1932" class="i">+void
</a><a href="#h48-0-1933" id="h48-0-1933" class="i">+strdump(void)
</a><a href="#h48-0-1934" id="h48-0-1934" class="i">+{
</a><a href="#h48-0-1935" id="h48-0-1935" class="i">+	int i;
</a><a href="#h48-0-1936" id="h48-0-1936" class="i">+	uint c;
</a><a href="#h48-0-1937" id="h48-0-1937" class="i">+
</a><a href="#h48-0-1938" id="h48-0-1938" class="i">+	fprintf(stderr, &quot;ESC%c&quot;, strescseq.type);
</a><a href="#h48-0-1939" id="h48-0-1939" class="i">+	for (i = 0; i &lt; strescseq.len; i++) {
</a><a href="#h48-0-1940" id="h48-0-1940" class="i">+		c = strescseq.buf[i] &amp; 0xff;
</a><a href="#h48-0-1941" id="h48-0-1941" class="i">+		if (c == &#39;\0&#39;) {
</a><a href="#h48-0-1942" id="h48-0-1942" class="i">+			putc(&#39;\n&#39;, stderr);
</a><a href="#h48-0-1943" id="h48-0-1943" class="i">+			return;
</a><a href="#h48-0-1944" id="h48-0-1944" class="i">+		} else if (isprint(c)) {
</a><a href="#h48-0-1945" id="h48-0-1945" class="i">+			putc(c, stderr);
</a><a href="#h48-0-1946" id="h48-0-1946" class="i">+		} else if (c == &#39;\n&#39;) {
</a><a href="#h48-0-1947" id="h48-0-1947" class="i">+			fprintf(stderr, &quot;(\\n)&quot;);
</a><a href="#h48-0-1948" id="h48-0-1948" class="i">+		} else if (c == &#39;\r&#39;) {
</a><a href="#h48-0-1949" id="h48-0-1949" class="i">+			fprintf(stderr, &quot;(\\r)&quot;);
</a><a href="#h48-0-1950" id="h48-0-1950" class="i">+		} else if (c == 0x1b) {
</a><a href="#h48-0-1951" id="h48-0-1951" class="i">+			fprintf(stderr, &quot;(\\e)&quot;);
</a><a href="#h48-0-1952" id="h48-0-1952" class="i">+		} else {
</a><a href="#h48-0-1953" id="h48-0-1953" class="i">+			fprintf(stderr, &quot;(%02x)&quot;, c);
</a><a href="#h48-0-1954" id="h48-0-1954" class="i">+		}
</a><a href="#h48-0-1955" id="h48-0-1955" class="i">+	}
</a><a href="#h48-0-1956" id="h48-0-1956" class="i">+	fprintf(stderr, &quot;ESC\\\n&quot;);
</a><a href="#h48-0-1957" id="h48-0-1957" class="i">+}
</a><a href="#h48-0-1958" id="h48-0-1958" class="i">+
</a><a href="#h48-0-1959" id="h48-0-1959" class="i">+void
</a><a href="#h48-0-1960" id="h48-0-1960" class="i">+strreset(void)
</a><a href="#h48-0-1961" id="h48-0-1961" class="i">+{
</a><a href="#h48-0-1962" id="h48-0-1962" class="i">+	memset(&amp;strescseq, 0, sizeof(strescseq));
</a><a href="#h48-0-1963" id="h48-0-1963" class="i">+}
</a><a href="#h48-0-1964" id="h48-0-1964" class="i">+
</a><a href="#h48-0-1965" id="h48-0-1965" class="i">+void
</a><a href="#h48-0-1966" id="h48-0-1966" class="i">+sendbreak(const Arg *arg)
</a><a href="#h48-0-1967" id="h48-0-1967" class="i">+{
</a><a href="#h48-0-1968" id="h48-0-1968" class="i">+	if (tcsendbreak(cmdfd, 0))
</a><a href="#h48-0-1969" id="h48-0-1969" class="i">+		perror(&quot;Error sending break&quot;);
</a><a href="#h48-0-1970" id="h48-0-1970" class="i">+}
</a><a href="#h48-0-1971" id="h48-0-1971" class="i">+
</a><a href="#h48-0-1972" id="h48-0-1972" class="i">+void
</a><a href="#h48-0-1973" id="h48-0-1973" class="i">+tprinter(char *s, size_t len)
</a><a href="#h48-0-1974" id="h48-0-1974" class="i">+{
</a><a href="#h48-0-1975" id="h48-0-1975" class="i">+	if (iofd != -1 &amp;&amp; xwrite(iofd, s, len) &lt; 0) {
</a><a href="#h48-0-1976" id="h48-0-1976" class="i">+		perror(&quot;Error writing to output file&quot;);
</a><a href="#h48-0-1977" id="h48-0-1977" class="i">+		close(iofd);
</a><a href="#h48-0-1978" id="h48-0-1978" class="i">+		iofd = -1;
</a><a href="#h48-0-1979" id="h48-0-1979" class="i">+	}
</a><a href="#h48-0-1980" id="h48-0-1980" class="i">+}
</a><a href="#h48-0-1981" id="h48-0-1981" class="i">+
</a><a href="#h48-0-1982" id="h48-0-1982" class="i">+void
</a><a href="#h48-0-1983" id="h48-0-1983" class="i">+toggleprinter(const Arg *arg)
</a><a href="#h48-0-1984" id="h48-0-1984" class="i">+{
</a><a href="#h48-0-1985" id="h48-0-1985" class="i">+	term.mode ^= MODE_PRINT;
</a><a href="#h48-0-1986" id="h48-0-1986" class="i">+}
</a><a href="#h48-0-1987" id="h48-0-1987" class="i">+
</a><a href="#h48-0-1988" id="h48-0-1988" class="i">+void
</a><a href="#h48-0-1989" id="h48-0-1989" class="i">+printscreen(const Arg *arg)
</a><a href="#h48-0-1990" id="h48-0-1990" class="i">+{
</a><a href="#h48-0-1991" id="h48-0-1991" class="i">+	tdump();
</a><a href="#h48-0-1992" id="h48-0-1992" class="i">+}
</a><a href="#h48-0-1993" id="h48-0-1993" class="i">+
</a><a href="#h48-0-1994" id="h48-0-1994" class="i">+void
</a><a href="#h48-0-1995" id="h48-0-1995" class="i">+printsel(const Arg *arg)
</a><a href="#h48-0-1996" id="h48-0-1996" class="i">+{
</a><a href="#h48-0-1997" id="h48-0-1997" class="i">+	tdumpsel();
</a><a href="#h48-0-1998" id="h48-0-1998" class="i">+}
</a><a href="#h48-0-1999" id="h48-0-1999" class="i">+
</a><a href="#h48-0-2000" id="h48-0-2000" class="i">+void
</a><a href="#h48-0-2001" id="h48-0-2001" class="i">+tdumpsel(void)
</a><a href="#h48-0-2002" id="h48-0-2002" class="i">+{
</a><a href="#h48-0-2003" id="h48-0-2003" class="i">+	char *ptr;
</a><a href="#h48-0-2004" id="h48-0-2004" class="i">+
</a><a href="#h48-0-2005" id="h48-0-2005" class="i">+	if ((ptr = getsel())) {
</a><a href="#h48-0-2006" id="h48-0-2006" class="i">+		tprinter(ptr, strlen(ptr));
</a><a href="#h48-0-2007" id="h48-0-2007" class="i">+		free(ptr);
</a><a href="#h48-0-2008" id="h48-0-2008" class="i">+	}
</a><a href="#h48-0-2009" id="h48-0-2009" class="i">+}
</a><a href="#h48-0-2010" id="h48-0-2010" class="i">+
</a><a href="#h48-0-2011" id="h48-0-2011" class="i">+void
</a><a href="#h48-0-2012" id="h48-0-2012" class="i">+tdumpline(int n)
</a><a href="#h48-0-2013" id="h48-0-2013" class="i">+{
</a><a href="#h48-0-2014" id="h48-0-2014" class="i">+	char buf[UTF_SIZ];
</a><a href="#h48-0-2015" id="h48-0-2015" class="i">+	Glyph *bp, *end;
</a><a href="#h48-0-2016" id="h48-0-2016" class="i">+
</a><a href="#h48-0-2017" id="h48-0-2017" class="i">+	bp = &amp;term.line[n][0];
</a><a href="#h48-0-2018" id="h48-0-2018" class="i">+	end = &amp;bp[MIN(tlinelen(n), term.col) - 1];
</a><a href="#h48-0-2019" id="h48-0-2019" class="i">+	if (bp != end || bp-&gt;u != &#39; &#39;) {
</a><a href="#h48-0-2020" id="h48-0-2020" class="i">+		for ( ;bp &lt;= end; ++bp)
</a><a href="#h48-0-2021" id="h48-0-2021" class="i">+			tprinter(buf, utf8encode(bp-&gt;u, buf));
</a><a href="#h48-0-2022" id="h48-0-2022" class="i">+	}
</a><a href="#h48-0-2023" id="h48-0-2023" class="i">+	tprinter(&quot;\n&quot;, 1);
</a><a href="#h48-0-2024" id="h48-0-2024" class="i">+}
</a><a href="#h48-0-2025" id="h48-0-2025" class="i">+
</a><a href="#h48-0-2026" id="h48-0-2026" class="i">+void
</a><a href="#h48-0-2027" id="h48-0-2027" class="i">+tdump(void)
</a><a href="#h48-0-2028" id="h48-0-2028" class="i">+{
</a><a href="#h48-0-2029" id="h48-0-2029" class="i">+	int i;
</a><a href="#h48-0-2030" id="h48-0-2030" class="i">+
</a><a href="#h48-0-2031" id="h48-0-2031" class="i">+	for (i = 0; i &lt; term.row; ++i)
</a><a href="#h48-0-2032" id="h48-0-2032" class="i">+		tdumpline(i);
</a><a href="#h48-0-2033" id="h48-0-2033" class="i">+}
</a><a href="#h48-0-2034" id="h48-0-2034" class="i">+
</a><a href="#h48-0-2035" id="h48-0-2035" class="i">+void
</a><a href="#h48-0-2036" id="h48-0-2036" class="i">+tputtab(int n)
</a><a href="#h48-0-2037" id="h48-0-2037" class="i">+{
</a><a href="#h48-0-2038" id="h48-0-2038" class="i">+	uint x = term.c.x;
</a><a href="#h48-0-2039" id="h48-0-2039" class="i">+
</a><a href="#h48-0-2040" id="h48-0-2040" class="i">+	if (n &gt; 0) {
</a><a href="#h48-0-2041" id="h48-0-2041" class="i">+		while (x &lt; term.col &amp;&amp; n--)
</a><a href="#h48-0-2042" id="h48-0-2042" class="i">+			for (++x; x &lt; term.col &amp;&amp; !term.tabs[x]; ++x)
</a><a href="#h48-0-2043" id="h48-0-2043" class="i">+				/* nothing */ ;
</a><a href="#h48-0-2044" id="h48-0-2044" class="i">+	} else if (n &lt; 0) {
</a><a href="#h48-0-2045" id="h48-0-2045" class="i">+		while (x &gt; 0 &amp;&amp; n++)
</a><a href="#h48-0-2046" id="h48-0-2046" class="i">+			for (--x; x &gt; 0 &amp;&amp; !term.tabs[x]; --x)
</a><a href="#h48-0-2047" id="h48-0-2047" class="i">+				/* nothing */ ;
</a><a href="#h48-0-2048" id="h48-0-2048" class="i">+	}
</a><a href="#h48-0-2049" id="h48-0-2049" class="i">+	term.c.x = LIMIT(x, 0, term.col-1);
</a><a href="#h48-0-2050" id="h48-0-2050" class="i">+}
</a><a href="#h48-0-2051" id="h48-0-2051" class="i">+
</a><a href="#h48-0-2052" id="h48-0-2052" class="i">+void
</a><a href="#h48-0-2053" id="h48-0-2053" class="i">+tdefutf8(char ascii)
</a><a href="#h48-0-2054" id="h48-0-2054" class="i">+{
</a><a href="#h48-0-2055" id="h48-0-2055" class="i">+	if (ascii == &#39;G&#39;)
</a><a href="#h48-0-2056" id="h48-0-2056" class="i">+		term.mode |= MODE_UTF8;
</a><a href="#h48-0-2057" id="h48-0-2057" class="i">+	else if (ascii == &#39;@&#39;)
</a><a href="#h48-0-2058" id="h48-0-2058" class="i">+		term.mode &amp;= ~MODE_UTF8;
</a><a href="#h48-0-2059" id="h48-0-2059" class="i">+}
</a><a href="#h48-0-2060" id="h48-0-2060" class="i">+
</a><a href="#h48-0-2061" id="h48-0-2061" class="i">+void
</a><a href="#h48-0-2062" id="h48-0-2062" class="i">+tdeftran(char ascii)
</a><a href="#h48-0-2063" id="h48-0-2063" class="i">+{
</a><a href="#h48-0-2064" id="h48-0-2064" class="i">+	static char cs[] = &quot;0B&quot;;
</a><a href="#h48-0-2065" id="h48-0-2065" class="i">+	static int vcs[] = {CS_GRAPHIC0, CS_USA};
</a><a href="#h48-0-2066" id="h48-0-2066" class="i">+	char *p;
</a><a href="#h48-0-2067" id="h48-0-2067" class="i">+
</a><a href="#h48-0-2068" id="h48-0-2068" class="i">+	if ((p = strchr(cs, ascii)) == NULL) {
</a><a href="#h48-0-2069" id="h48-0-2069" class="i">+		fprintf(stderr, &quot;esc unhandled charset: ESC ( %c\n&quot;, ascii);
</a><a href="#h48-0-2070" id="h48-0-2070" class="i">+	} else {
</a><a href="#h48-0-2071" id="h48-0-2071" class="i">+		term.trantbl[term.icharset] = vcs[p - cs];
</a><a href="#h48-0-2072" id="h48-0-2072" class="i">+	}
</a><a href="#h48-0-2073" id="h48-0-2073" class="i">+}
</a><a href="#h48-0-2074" id="h48-0-2074" class="i">+
</a><a href="#h48-0-2075" id="h48-0-2075" class="i">+void
</a><a href="#h48-0-2076" id="h48-0-2076" class="i">+tdectest(char c)
</a><a href="#h48-0-2077" id="h48-0-2077" class="i">+{
</a><a href="#h48-0-2078" id="h48-0-2078" class="i">+	int x, y;
</a><a href="#h48-0-2079" id="h48-0-2079" class="i">+
</a><a href="#h48-0-2080" id="h48-0-2080" class="i">+	if (c == &#39;8&#39;) { /* DEC screen alignment test. */
</a><a href="#h48-0-2081" id="h48-0-2081" class="i">+		for (x = 0; x &lt; term.col; ++x) {
</a><a href="#h48-0-2082" id="h48-0-2082" class="i">+			for (y = 0; y &lt; term.row; ++y)
</a><a href="#h48-0-2083" id="h48-0-2083" class="i">+				tsetchar(&#39;E&#39;, &amp;term.c.attr, x, y);
</a><a href="#h48-0-2084" id="h48-0-2084" class="i">+		}
</a><a href="#h48-0-2085" id="h48-0-2085" class="i">+	}
</a><a href="#h48-0-2086" id="h48-0-2086" class="i">+}
</a><a href="#h48-0-2087" id="h48-0-2087" class="i">+
</a><a href="#h48-0-2088" id="h48-0-2088" class="i">+void
</a><a href="#h48-0-2089" id="h48-0-2089" class="i">+tstrsequence(uchar c)
</a><a href="#h48-0-2090" id="h48-0-2090" class="i">+{
</a><a href="#h48-0-2091" id="h48-0-2091" class="i">+	strreset();
</a><a href="#h48-0-2092" id="h48-0-2092" class="i">+
</a><a href="#h48-0-2093" id="h48-0-2093" class="i">+	switch (c) {
</a><a href="#h48-0-2094" id="h48-0-2094" class="i">+	case 0x90:   /* DCS -- Device Control String */
</a><a href="#h48-0-2095" id="h48-0-2095" class="i">+		c = &#39;P&#39;;
</a><a href="#h48-0-2096" id="h48-0-2096" class="i">+		term.esc |= ESC_DCS;
</a><a href="#h48-0-2097" id="h48-0-2097" class="i">+		break;
</a><a href="#h48-0-2098" id="h48-0-2098" class="i">+	case 0x9f:   /* APC -- Application Program Command */
</a><a href="#h48-0-2099" id="h48-0-2099" class="i">+		c = &#39;_&#39;;
</a><a href="#h48-0-2100" id="h48-0-2100" class="i">+		break;
</a><a href="#h48-0-2101" id="h48-0-2101" class="i">+	case 0x9e:   /* PM -- Privacy Message */
</a><a href="#h48-0-2102" id="h48-0-2102" class="i">+		c = &#39;^&#39;;
</a><a href="#h48-0-2103" id="h48-0-2103" class="i">+		break;
</a><a href="#h48-0-2104" id="h48-0-2104" class="i">+	case 0x9d:   /* OSC -- Operating System Command */
</a><a href="#h48-0-2105" id="h48-0-2105" class="i">+		c = &#39;]&#39;;
</a><a href="#h48-0-2106" id="h48-0-2106" class="i">+		break;
</a><a href="#h48-0-2107" id="h48-0-2107" class="i">+	}
</a><a href="#h48-0-2108" id="h48-0-2108" class="i">+	strescseq.type = c;
</a><a href="#h48-0-2109" id="h48-0-2109" class="i">+	term.esc |= ESC_STR;
</a><a href="#h48-0-2110" id="h48-0-2110" class="i">+}
</a><a href="#h48-0-2111" id="h48-0-2111" class="i">+
</a><a href="#h48-0-2112" id="h48-0-2112" class="i">+void
</a><a href="#h48-0-2113" id="h48-0-2113" class="i">+tcontrolcode(uchar ascii)
</a><a href="#h48-0-2114" id="h48-0-2114" class="i">+{
</a><a href="#h48-0-2115" id="h48-0-2115" class="i">+	switch (ascii) {
</a><a href="#h48-0-2116" id="h48-0-2116" class="i">+	case &#39;\t&#39;:   /* HT */
</a><a href="#h48-0-2117" id="h48-0-2117" class="i">+		tputtab(1);
</a><a href="#h48-0-2118" id="h48-0-2118" class="i">+		return;
</a><a href="#h48-0-2119" id="h48-0-2119" class="i">+	case &#39;\b&#39;:   /* BS */
</a><a href="#h48-0-2120" id="h48-0-2120" class="i">+		tmoveto(term.c.x-1, term.c.y);
</a><a href="#h48-0-2121" id="h48-0-2121" class="i">+		return;
</a><a href="#h48-0-2122" id="h48-0-2122" class="i">+	case &#39;\r&#39;:   /* CR */
</a><a href="#h48-0-2123" id="h48-0-2123" class="i">+		tmoveto(0, term.c.y);
</a><a href="#h48-0-2124" id="h48-0-2124" class="i">+		return;
</a><a href="#h48-0-2125" id="h48-0-2125" class="i">+	case &#39;\f&#39;:   /* LF */
</a><a href="#h48-0-2126" id="h48-0-2126" class="i">+	case &#39;\v&#39;:   /* VT */
</a><a href="#h48-0-2127" id="h48-0-2127" class="i">+	case &#39;\n&#39;:   /* LF */
</a><a href="#h48-0-2128" id="h48-0-2128" class="i">+		/* go to first col if the mode is set */
</a><a href="#h48-0-2129" id="h48-0-2129" class="i">+		tnewline(IS_SET(MODE_CRLF));
</a><a href="#h48-0-2130" id="h48-0-2130" class="i">+		return;
</a><a href="#h48-0-2131" id="h48-0-2131" class="i">+	case &#39;\a&#39;:   /* BEL */
</a><a href="#h48-0-2132" id="h48-0-2132" class="i">+		if (term.esc &amp; ESC_STR_END) {
</a><a href="#h48-0-2133" id="h48-0-2133" class="i">+			/* backwards compatibility to xterm */
</a><a href="#h48-0-2134" id="h48-0-2134" class="i">+			strhandle();
</a><a href="#h48-0-2135" id="h48-0-2135" class="i">+		} else {
</a><a href="#h48-0-2136" id="h48-0-2136" class="i">+			xbell();
</a><a href="#h48-0-2137" id="h48-0-2137" class="i">+		}
</a><a href="#h48-0-2138" id="h48-0-2138" class="i">+		break;
</a><a href="#h48-0-2139" id="h48-0-2139" class="i">+	case &#39;\033&#39;: /* ESC */
</a><a href="#h48-0-2140" id="h48-0-2140" class="i">+		csireset();
</a><a href="#h48-0-2141" id="h48-0-2141" class="i">+		term.esc &amp;= ~(ESC_CSI|ESC_ALTCHARSET|ESC_TEST);
</a><a href="#h48-0-2142" id="h48-0-2142" class="i">+		term.esc |= ESC_START;
</a><a href="#h48-0-2143" id="h48-0-2143" class="i">+		return;
</a><a href="#h48-0-2144" id="h48-0-2144" class="i">+	case &#39;\016&#39;: /* SO (LS1 -- Locking shift 1) */
</a><a href="#h48-0-2145" id="h48-0-2145" class="i">+	case &#39;\017&#39;: /* SI (LS0 -- Locking shift 0) */
</a><a href="#h48-0-2146" id="h48-0-2146" class="i">+		term.charset = 1 - (ascii - &#39;\016&#39;);
</a><a href="#h48-0-2147" id="h48-0-2147" class="i">+		return;
</a><a href="#h48-0-2148" id="h48-0-2148" class="i">+	case &#39;\032&#39;: /* SUB */
</a><a href="#h48-0-2149" id="h48-0-2149" class="i">+		tsetchar(&#39;?&#39;, &amp;term.c.attr, term.c.x, term.c.y);
</a><a href="#h48-0-2150" id="h48-0-2150" class="i">+	case &#39;\030&#39;: /* CAN */
</a><a href="#h48-0-2151" id="h48-0-2151" class="i">+		csireset();
</a><a href="#h48-0-2152" id="h48-0-2152" class="i">+		break;
</a><a href="#h48-0-2153" id="h48-0-2153" class="i">+	case &#39;\005&#39;: /* ENQ (IGNORED) */
</a><a href="#h48-0-2154" id="h48-0-2154" class="i">+	case &#39;\000&#39;: /* NUL (IGNORED) */
</a><a href="#h48-0-2155" id="h48-0-2155" class="i">+	case &#39;\021&#39;: /* XON (IGNORED) */
</a><a href="#h48-0-2156" id="h48-0-2156" class="i">+	case &#39;\023&#39;: /* XOFF (IGNORED) */
</a><a href="#h48-0-2157" id="h48-0-2157" class="i">+	case 0177:   /* DEL (IGNORED) */
</a><a href="#h48-0-2158" id="h48-0-2158" class="i">+		return;
</a><a href="#h48-0-2159" id="h48-0-2159" class="i">+	case 0x80:   /* TODO: PAD */
</a><a href="#h48-0-2160" id="h48-0-2160" class="i">+	case 0x81:   /* TODO: HOP */
</a><a href="#h48-0-2161" id="h48-0-2161" class="i">+	case 0x82:   /* TODO: BPH */
</a><a href="#h48-0-2162" id="h48-0-2162" class="i">+	case 0x83:   /* TODO: NBH */
</a><a href="#h48-0-2163" id="h48-0-2163" class="i">+	case 0x84:   /* TODO: IND */
</a><a href="#h48-0-2164" id="h48-0-2164" class="i">+		break;
</a><a href="#h48-0-2165" id="h48-0-2165" class="i">+	case 0x85:   /* NEL -- Next line */
</a><a href="#h48-0-2166" id="h48-0-2166" class="i">+		tnewline(1); /* always go to first col */
</a><a href="#h48-0-2167" id="h48-0-2167" class="i">+		break;
</a><a href="#h48-0-2168" id="h48-0-2168" class="i">+	case 0x86:   /* TODO: SSA */
</a><a href="#h48-0-2169" id="h48-0-2169" class="i">+	case 0x87:   /* TODO: ESA */
</a><a href="#h48-0-2170" id="h48-0-2170" class="i">+		break;
</a><a href="#h48-0-2171" id="h48-0-2171" class="i">+	case 0x88:   /* HTS -- Horizontal tab stop */
</a><a href="#h48-0-2172" id="h48-0-2172" class="i">+		term.tabs[term.c.x] = 1;
</a><a href="#h48-0-2173" id="h48-0-2173" class="i">+		break;
</a><a href="#h48-0-2174" id="h48-0-2174" class="i">+	case 0x89:   /* TODO: HTJ */
</a><a href="#h48-0-2175" id="h48-0-2175" class="i">+	case 0x8a:   /* TODO: VTS */
</a><a href="#h48-0-2176" id="h48-0-2176" class="i">+	case 0x8b:   /* TODO: PLD */
</a><a href="#h48-0-2177" id="h48-0-2177" class="i">+	case 0x8c:   /* TODO: PLU */
</a><a href="#h48-0-2178" id="h48-0-2178" class="i">+	case 0x8d:   /* TODO: RI */
</a><a href="#h48-0-2179" id="h48-0-2179" class="i">+	case 0x8e:   /* TODO: SS2 */
</a><a href="#h48-0-2180" id="h48-0-2180" class="i">+	case 0x8f:   /* TODO: SS3 */
</a><a href="#h48-0-2181" id="h48-0-2181" class="i">+	case 0x91:   /* TODO: PU1 */
</a><a href="#h48-0-2182" id="h48-0-2182" class="i">+	case 0x92:   /* TODO: PU2 */
</a><a href="#h48-0-2183" id="h48-0-2183" class="i">+	case 0x93:   /* TODO: STS */
</a><a href="#h48-0-2184" id="h48-0-2184" class="i">+	case 0x94:   /* TODO: CCH */
</a><a href="#h48-0-2185" id="h48-0-2185" class="i">+	case 0x95:   /* TODO: MW */
</a><a href="#h48-0-2186" id="h48-0-2186" class="i">+	case 0x96:   /* TODO: SPA */
</a><a href="#h48-0-2187" id="h48-0-2187" class="i">+	case 0x97:   /* TODO: EPA */
</a><a href="#h48-0-2188" id="h48-0-2188" class="i">+	case 0x98:   /* TODO: SOS */
</a><a href="#h48-0-2189" id="h48-0-2189" class="i">+	case 0x99:   /* TODO: SGCI */
</a><a href="#h48-0-2190" id="h48-0-2190" class="i">+		break;
</a><a href="#h48-0-2191" id="h48-0-2191" class="i">+	case 0x9a:   /* DECID -- Identify Terminal */
</a><a href="#h48-0-2192" id="h48-0-2192" class="i">+		ttywrite(vtiden, strlen(vtiden), 0);
</a><a href="#h48-0-2193" id="h48-0-2193" class="i">+		break;
</a><a href="#h48-0-2194" id="h48-0-2194" class="i">+	case 0x9b:   /* TODO: CSI */
</a><a href="#h48-0-2195" id="h48-0-2195" class="i">+	case 0x9c:   /* TODO: ST */
</a><a href="#h48-0-2196" id="h48-0-2196" class="i">+		break;
</a><a href="#h48-0-2197" id="h48-0-2197" class="i">+	case 0x90:   /* DCS -- Device Control String */
</a><a href="#h48-0-2198" id="h48-0-2198" class="i">+	case 0x9d:   /* OSC -- Operating System Command */
</a><a href="#h48-0-2199" id="h48-0-2199" class="i">+	case 0x9e:   /* PM -- Privacy Message */
</a><a href="#h48-0-2200" id="h48-0-2200" class="i">+	case 0x9f:   /* APC -- Application Program Command */
</a><a href="#h48-0-2201" id="h48-0-2201" class="i">+		tstrsequence(ascii);
</a><a href="#h48-0-2202" id="h48-0-2202" class="i">+		return;
</a><a href="#h48-0-2203" id="h48-0-2203" class="i">+	}
</a><a href="#h48-0-2204" id="h48-0-2204" class="i">+	/* only CAN, SUB, \a and C1 chars interrupt a sequence */
</a><a href="#h48-0-2205" id="h48-0-2205" class="i">+	term.esc &amp;= ~(ESC_STR_END|ESC_STR);
</a><a href="#h48-0-2206" id="h48-0-2206" class="i">+}
</a><a href="#h48-0-2207" id="h48-0-2207" class="i">+
</a><a href="#h48-0-2208" id="h48-0-2208" class="i">+/*
</a><a href="#h48-0-2209" id="h48-0-2209" class="i">+ * returns 1 when the sequence is finished and it hasn&#39;t to read
</a><a href="#h48-0-2210" id="h48-0-2210" class="i">+ * more characters for this sequence, otherwise 0
</a><a href="#h48-0-2211" id="h48-0-2211" class="i">+ */
</a><a href="#h48-0-2212" id="h48-0-2212" class="i">+int
</a><a href="#h48-0-2213" id="h48-0-2213" class="i">+eschandle(uchar ascii)
</a><a href="#h48-0-2214" id="h48-0-2214" class="i">+{
</a><a href="#h48-0-2215" id="h48-0-2215" class="i">+	switch (ascii) {
</a><a href="#h48-0-2216" id="h48-0-2216" class="i">+	case &#39;[&#39;:
</a><a href="#h48-0-2217" id="h48-0-2217" class="i">+		term.esc |= ESC_CSI;
</a><a href="#h48-0-2218" id="h48-0-2218" class="i">+		return 0;
</a><a href="#h48-0-2219" id="h48-0-2219" class="i">+	case &#39;#&#39;:
</a><a href="#h48-0-2220" id="h48-0-2220" class="i">+		term.esc |= ESC_TEST;
</a><a href="#h48-0-2221" id="h48-0-2221" class="i">+		return 0;
</a><a href="#h48-0-2222" id="h48-0-2222" class="i">+	case &#39;%&#39;:
</a><a href="#h48-0-2223" id="h48-0-2223" class="i">+		term.esc |= ESC_UTF8;
</a><a href="#h48-0-2224" id="h48-0-2224" class="i">+		return 0;
</a><a href="#h48-0-2225" id="h48-0-2225" class="i">+	case &#39;P&#39;: /* DCS -- Device Control String */
</a><a href="#h48-0-2226" id="h48-0-2226" class="i">+	case &#39;_&#39;: /* APC -- Application Program Command */
</a><a href="#h48-0-2227" id="h48-0-2227" class="i">+	case &#39;^&#39;: /* PM -- Privacy Message */
</a><a href="#h48-0-2228" id="h48-0-2228" class="i">+	case &#39;]&#39;: /* OSC -- Operating System Command */
</a><a href="#h48-0-2229" id="h48-0-2229" class="i">+	case &#39;k&#39;: /* old title set compatibility */
</a><a href="#h48-0-2230" id="h48-0-2230" class="i">+		tstrsequence(ascii);
</a><a href="#h48-0-2231" id="h48-0-2231" class="i">+		return 0;
</a><a href="#h48-0-2232" id="h48-0-2232" class="i">+	case &#39;n&#39;: /* LS2 -- Locking shift 2 */
</a><a href="#h48-0-2233" id="h48-0-2233" class="i">+	case &#39;o&#39;: /* LS3 -- Locking shift 3 */
</a><a href="#h48-0-2234" id="h48-0-2234" class="i">+		term.charset = 2 + (ascii - &#39;n&#39;);
</a><a href="#h48-0-2235" id="h48-0-2235" class="i">+		break;
</a><a href="#h48-0-2236" id="h48-0-2236" class="i">+	case &#39;(&#39;: /* GZD4 -- set primary charset G0 */
</a><a href="#h48-0-2237" id="h48-0-2237" class="i">+	case &#39;)&#39;: /* G1D4 -- set secondary charset G1 */
</a><a href="#h48-0-2238" id="h48-0-2238" class="i">+	case &#39;*&#39;: /* G2D4 -- set tertiary charset G2 */
</a><a href="#h48-0-2239" id="h48-0-2239" class="i">+	case &#39;+&#39;: /* G3D4 -- set quaternary charset G3 */
</a><a href="#h48-0-2240" id="h48-0-2240" class="i">+		term.icharset = ascii - &#39;(&#39;;
</a><a href="#h48-0-2241" id="h48-0-2241" class="i">+		term.esc |= ESC_ALTCHARSET;
</a><a href="#h48-0-2242" id="h48-0-2242" class="i">+		return 0;
</a><a href="#h48-0-2243" id="h48-0-2243" class="i">+	case &#39;D&#39;: /* IND -- Linefeed */
</a><a href="#h48-0-2244" id="h48-0-2244" class="i">+		if (term.c.y == term.bot) {
</a><a href="#h48-0-2245" id="h48-0-2245" class="i">+			tscrollup(term.top, 1);
</a><a href="#h48-0-2246" id="h48-0-2246" class="i">+		} else {
</a><a href="#h48-0-2247" id="h48-0-2247" class="i">+			tmoveto(term.c.x, term.c.y+1);
</a><a href="#h48-0-2248" id="h48-0-2248" class="i">+		}
</a><a href="#h48-0-2249" id="h48-0-2249" class="i">+		break;
</a><a href="#h48-0-2250" id="h48-0-2250" class="i">+	case &#39;E&#39;: /* NEL -- Next line */
</a><a href="#h48-0-2251" id="h48-0-2251" class="i">+		tnewline(1); /* always go to first col */
</a><a href="#h48-0-2252" id="h48-0-2252" class="i">+		break;
</a><a href="#h48-0-2253" id="h48-0-2253" class="i">+	case &#39;H&#39;: /* HTS -- Horizontal tab stop */
</a><a href="#h48-0-2254" id="h48-0-2254" class="i">+		term.tabs[term.c.x] = 1;
</a><a href="#h48-0-2255" id="h48-0-2255" class="i">+		break;
</a><a href="#h48-0-2256" id="h48-0-2256" class="i">+	case &#39;M&#39;: /* RI -- Reverse index */
</a><a href="#h48-0-2257" id="h48-0-2257" class="i">+		if (term.c.y == term.top) {
</a><a href="#h48-0-2258" id="h48-0-2258" class="i">+			tscrolldown(term.top, 1);
</a><a href="#h48-0-2259" id="h48-0-2259" class="i">+		} else {
</a><a href="#h48-0-2260" id="h48-0-2260" class="i">+			tmoveto(term.c.x, term.c.y-1);
</a><a href="#h48-0-2261" id="h48-0-2261" class="i">+		}
</a><a href="#h48-0-2262" id="h48-0-2262" class="i">+		break;
</a><a href="#h48-0-2263" id="h48-0-2263" class="i">+	case &#39;Z&#39;: /* DECID -- Identify Terminal */
</a><a href="#h48-0-2264" id="h48-0-2264" class="i">+		ttywrite(vtiden, strlen(vtiden), 0);
</a><a href="#h48-0-2265" id="h48-0-2265" class="i">+		break;
</a><a href="#h48-0-2266" id="h48-0-2266" class="i">+	case &#39;c&#39;: /* RIS -- Reset to initial state */
</a><a href="#h48-0-2267" id="h48-0-2267" class="i">+		treset();
</a><a href="#h48-0-2268" id="h48-0-2268" class="i">+		resettitle();
</a><a href="#h48-0-2269" id="h48-0-2269" class="i">+		xloadcols();
</a><a href="#h48-0-2270" id="h48-0-2270" class="i">+		break;
</a><a href="#h48-0-2271" id="h48-0-2271" class="i">+	case &#39;=&#39;: /* DECPAM -- Application keypad */
</a><a href="#h48-0-2272" id="h48-0-2272" class="i">+		xsetmode(1, MODE_APPKEYPAD);
</a><a href="#h48-0-2273" id="h48-0-2273" class="i">+		break;
</a><a href="#h48-0-2274" id="h48-0-2274" class="i">+	case &#39;&gt;&#39;: /* DECPNM -- Normal keypad */
</a><a href="#h48-0-2275" id="h48-0-2275" class="i">+		xsetmode(0, MODE_APPKEYPAD);
</a><a href="#h48-0-2276" id="h48-0-2276" class="i">+		break;
</a><a href="#h48-0-2277" id="h48-0-2277" class="i">+	case &#39;7&#39;: /* DECSC -- Save Cursor */
</a><a href="#h48-0-2278" id="h48-0-2278" class="i">+		tcursor(CURSOR_SAVE);
</a><a href="#h48-0-2279" id="h48-0-2279" class="i">+		break;
</a><a href="#h48-0-2280" id="h48-0-2280" class="i">+	case &#39;8&#39;: /* DECRC -- Restore Cursor */
</a><a href="#h48-0-2281" id="h48-0-2281" class="i">+		tcursor(CURSOR_LOAD);
</a><a href="#h48-0-2282" id="h48-0-2282" class="i">+		break;
</a><a href="#h48-0-2283" id="h48-0-2283" class="i">+	case &#39;\\&#39;: /* ST -- String Terminator */
</a><a href="#h48-0-2284" id="h48-0-2284" class="i">+		if (term.esc &amp; ESC_STR_END)
</a><a href="#h48-0-2285" id="h48-0-2285" class="i">+			strhandle();
</a><a href="#h48-0-2286" id="h48-0-2286" class="i">+		break;
</a><a href="#h48-0-2287" id="h48-0-2287" class="i">+	default:
</a><a href="#h48-0-2288" id="h48-0-2288" class="i">+		fprintf(stderr, &quot;erresc: unknown sequence ESC 0x%02X &#39;%c&#39;\n&quot;,
</a><a href="#h48-0-2289" id="h48-0-2289" class="i">+			(uchar) ascii, isprint(ascii)? ascii:&#39;.&#39;);
</a><a href="#h48-0-2290" id="h48-0-2290" class="i">+		break;
</a><a href="#h48-0-2291" id="h48-0-2291" class="i">+	}
</a><a href="#h48-0-2292" id="h48-0-2292" class="i">+	return 1;
</a><a href="#h48-0-2293" id="h48-0-2293" class="i">+}
</a><a href="#h48-0-2294" id="h48-0-2294" class="i">+
</a><a href="#h48-0-2295" id="h48-0-2295" class="i">+void
</a><a href="#h48-0-2296" id="h48-0-2296" class="i">+tputc(Rune u)
</a><a href="#h48-0-2297" id="h48-0-2297" class="i">+{
</a><a href="#h48-0-2298" id="h48-0-2298" class="i">+	char c[UTF_SIZ];
</a><a href="#h48-0-2299" id="h48-0-2299" class="i">+	int control;
</a><a href="#h48-0-2300" id="h48-0-2300" class="i">+	int width, len;
</a><a href="#h48-0-2301" id="h48-0-2301" class="i">+	Glyph *gp;
</a><a href="#h48-0-2302" id="h48-0-2302" class="i">+
</a><a href="#h48-0-2303" id="h48-0-2303" class="i">+	control = ISCONTROL(u);
</a><a href="#h48-0-2304" id="h48-0-2304" class="i">+	if (!IS_SET(MODE_UTF8) &amp;&amp; !IS_SET(MODE_SIXEL)) {
</a><a href="#h48-0-2305" id="h48-0-2305" class="i">+		c[0] = u;
</a><a href="#h48-0-2306" id="h48-0-2306" class="i">+		width = len = 1;
</a><a href="#h48-0-2307" id="h48-0-2307" class="i">+	} else {
</a><a href="#h48-0-2308" id="h48-0-2308" class="i">+		len = utf8encode(u, c);
</a><a href="#h48-0-2309" id="h48-0-2309" class="i">+		if (!control &amp;&amp; (width = wcwidth(u)) == -1) {
</a><a href="#h48-0-2310" id="h48-0-2310" class="i">+			memcpy(c, &quot;\357\277\275&quot;, 4); /* UTF_INVALID */
</a><a href="#h48-0-2311" id="h48-0-2311" class="i">+			width = 1;
</a><a href="#h48-0-2312" id="h48-0-2312" class="i">+		}
</a><a href="#h48-0-2313" id="h48-0-2313" class="i">+	}
</a><a href="#h48-0-2314" id="h48-0-2314" class="i">+
</a><a href="#h48-0-2315" id="h48-0-2315" class="i">+	if (IS_SET(MODE_PRINT))
</a><a href="#h48-0-2316" id="h48-0-2316" class="i">+		tprinter(c, len);
</a><a href="#h48-0-2317" id="h48-0-2317" class="i">+
</a><a href="#h48-0-2318" id="h48-0-2318" class="i">+	/*
</a><a href="#h48-0-2319" id="h48-0-2319" class="i">+	 * STR sequence must be checked before anything else
</a><a href="#h48-0-2320" id="h48-0-2320" class="i">+	 * because it uses all following characters until it
</a><a href="#h48-0-2321" id="h48-0-2321" class="i">+	 * receives a ESC, a SUB, a ST or any other C1 control
</a><a href="#h48-0-2322" id="h48-0-2322" class="i">+	 * character.
</a><a href="#h48-0-2323" id="h48-0-2323" class="i">+	 */
</a><a href="#h48-0-2324" id="h48-0-2324" class="i">+	if (term.esc &amp; ESC_STR) {
</a><a href="#h48-0-2325" id="h48-0-2325" class="i">+		if (u == &#39;\a&#39; || u == 030 || u == 032 || u == 033 ||
</a><a href="#h48-0-2326" id="h48-0-2326" class="i">+		   ISCONTROLC1(u)) {
</a><a href="#h48-0-2327" id="h48-0-2327" class="i">+			term.esc &amp;= ~(ESC_START|ESC_STR|ESC_DCS);
</a><a href="#h48-0-2328" id="h48-0-2328" class="i">+			if (IS_SET(MODE_SIXEL)) {
</a><a href="#h48-0-2329" id="h48-0-2329" class="i">+				/* TODO: render sixel */;
</a><a href="#h48-0-2330" id="h48-0-2330" class="i">+				term.mode &amp;= ~MODE_SIXEL;
</a><a href="#h48-0-2331" id="h48-0-2331" class="i">+				return;
</a><a href="#h48-0-2332" id="h48-0-2332" class="i">+			}
</a><a href="#h48-0-2333" id="h48-0-2333" class="i">+			term.esc |= ESC_STR_END;
</a><a href="#h48-0-2334" id="h48-0-2334" class="i">+			goto check_control_code;
</a><a href="#h48-0-2335" id="h48-0-2335" class="i">+		}
</a><a href="#h48-0-2336" id="h48-0-2336" class="i">+
</a><a href="#h48-0-2337" id="h48-0-2337" class="i">+
</a><a href="#h48-0-2338" id="h48-0-2338" class="i">+		if (IS_SET(MODE_SIXEL)) {
</a><a href="#h48-0-2339" id="h48-0-2339" class="i">+			/* TODO: implement sixel mode */
</a><a href="#h48-0-2340" id="h48-0-2340" class="i">+			return;
</a><a href="#h48-0-2341" id="h48-0-2341" class="i">+		}
</a><a href="#h48-0-2342" id="h48-0-2342" class="i">+		if (term.esc&amp;ESC_DCS &amp;&amp; strescseq.len == 0 &amp;&amp; u == &#39;q&#39;)
</a><a href="#h48-0-2343" id="h48-0-2343" class="i">+			term.mode |= MODE_SIXEL;
</a><a href="#h48-0-2344" id="h48-0-2344" class="i">+
</a><a href="#h48-0-2345" id="h48-0-2345" class="i">+		if (strescseq.len+len &gt;= sizeof(strescseq.buf)-1) {
</a><a href="#h48-0-2346" id="h48-0-2346" class="i">+			/*
</a><a href="#h48-0-2347" id="h48-0-2347" class="i">+			 * Here is a bug in terminals. If the user never sends
</a><a href="#h48-0-2348" id="h48-0-2348" class="i">+			 * some code to stop the str or esc command, then st
</a><a href="#h48-0-2349" id="h48-0-2349" class="i">+			 * will stop responding. But this is better than
</a><a href="#h48-0-2350" id="h48-0-2350" class="i">+			 * silently failing with unknown characters. At least
</a><a href="#h48-0-2351" id="h48-0-2351" class="i">+			 * then users will report back.
</a><a href="#h48-0-2352" id="h48-0-2352" class="i">+			 *
</a><a href="#h48-0-2353" id="h48-0-2353" class="i">+			 * In the case users ever get fixed, here is the code:
</a><a href="#h48-0-2354" id="h48-0-2354" class="i">+			 */
</a><a href="#h48-0-2355" id="h48-0-2355" class="i">+			/*
</a><a href="#h48-0-2356" id="h48-0-2356" class="i">+			 * term.esc = 0;
</a><a href="#h48-0-2357" id="h48-0-2357" class="i">+			 * strhandle();
</a><a href="#h48-0-2358" id="h48-0-2358" class="i">+			 */
</a><a href="#h48-0-2359" id="h48-0-2359" class="i">+			return;
</a><a href="#h48-0-2360" id="h48-0-2360" class="i">+		}
</a><a href="#h48-0-2361" id="h48-0-2361" class="i">+
</a><a href="#h48-0-2362" id="h48-0-2362" class="i">+		memmove(&amp;strescseq.buf[strescseq.len], c, len);
</a><a href="#h48-0-2363" id="h48-0-2363" class="i">+		strescseq.len += len;
</a><a href="#h48-0-2364" id="h48-0-2364" class="i">+		return;
</a><a href="#h48-0-2365" id="h48-0-2365" class="i">+	}
</a><a href="#h48-0-2366" id="h48-0-2366" class="i">+
</a><a href="#h48-0-2367" id="h48-0-2367" class="i">+check_control_code:
</a><a href="#h48-0-2368" id="h48-0-2368" class="i">+	/*
</a><a href="#h48-0-2369" id="h48-0-2369" class="i">+	 * Actions of control codes must be performed as soon they arrive
</a><a href="#h48-0-2370" id="h48-0-2370" class="i">+	 * because they can be embedded inside a control sequence, and
</a><a href="#h48-0-2371" id="h48-0-2371" class="i">+	 * they must not cause conflicts with sequences.
</a><a href="#h48-0-2372" id="h48-0-2372" class="i">+	 */
</a><a href="#h48-0-2373" id="h48-0-2373" class="i">+	if (control) {
</a><a href="#h48-0-2374" id="h48-0-2374" class="i">+		tcontrolcode(u);
</a><a href="#h48-0-2375" id="h48-0-2375" class="i">+		/*
</a><a href="#h48-0-2376" id="h48-0-2376" class="i">+		 * control codes are not shown ever
</a><a href="#h48-0-2377" id="h48-0-2377" class="i">+		 */
</a><a href="#h48-0-2378" id="h48-0-2378" class="i">+		return;
</a><a href="#h48-0-2379" id="h48-0-2379" class="i">+	} else if (term.esc &amp; ESC_START) {
</a><a href="#h48-0-2380" id="h48-0-2380" class="i">+		if (term.esc &amp; ESC_CSI) {
</a><a href="#h48-0-2381" id="h48-0-2381" class="i">+			csiescseq.buf[csiescseq.len++] = u;
</a><a href="#h48-0-2382" id="h48-0-2382" class="i">+			if (BETWEEN(u, 0x40, 0x7E)
</a><a href="#h48-0-2383" id="h48-0-2383" class="i">+					|| csiescseq.len &gt;= \
</a><a href="#h48-0-2384" id="h48-0-2384" class="i">+					sizeof(csiescseq.buf)-1) {
</a><a href="#h48-0-2385" id="h48-0-2385" class="i">+				term.esc = 0;
</a><a href="#h48-0-2386" id="h48-0-2386" class="i">+				csiparse();
</a><a href="#h48-0-2387" id="h48-0-2387" class="i">+				csihandle();
</a><a href="#h48-0-2388" id="h48-0-2388" class="i">+			}
</a><a href="#h48-0-2389" id="h48-0-2389" class="i">+			return;
</a><a href="#h48-0-2390" id="h48-0-2390" class="i">+		} else if (term.esc &amp; ESC_UTF8) {
</a><a href="#h48-0-2391" id="h48-0-2391" class="i">+			tdefutf8(u);
</a><a href="#h48-0-2392" id="h48-0-2392" class="i">+		} else if (term.esc &amp; ESC_ALTCHARSET) {
</a><a href="#h48-0-2393" id="h48-0-2393" class="i">+			tdeftran(u);
</a><a href="#h48-0-2394" id="h48-0-2394" class="i">+		} else if (term.esc &amp; ESC_TEST) {
</a><a href="#h48-0-2395" id="h48-0-2395" class="i">+			tdectest(u);
</a><a href="#h48-0-2396" id="h48-0-2396" class="i">+		} else {
</a><a href="#h48-0-2397" id="h48-0-2397" class="i">+			if (!eschandle(u))
</a><a href="#h48-0-2398" id="h48-0-2398" class="i">+				return;
</a><a href="#h48-0-2399" id="h48-0-2399" class="i">+			/* sequence already finished */
</a><a href="#h48-0-2400" id="h48-0-2400" class="i">+		}
</a><a href="#h48-0-2401" id="h48-0-2401" class="i">+		term.esc = 0;
</a><a href="#h48-0-2402" id="h48-0-2402" class="i">+		/*
</a><a href="#h48-0-2403" id="h48-0-2403" class="i">+		 * All characters which form part of a sequence are not
</a><a href="#h48-0-2404" id="h48-0-2404" class="i">+		 * printed
</a><a href="#h48-0-2405" id="h48-0-2405" class="i">+		 */
</a><a href="#h48-0-2406" id="h48-0-2406" class="i">+		return;
</a><a href="#h48-0-2407" id="h48-0-2407" class="i">+	}
</a><a href="#h48-0-2408" id="h48-0-2408" class="i">+	if (sel.ob.x != -1 &amp;&amp; BETWEEN(term.c.y, sel.ob.y, sel.oe.y))
</a><a href="#h48-0-2409" id="h48-0-2409" class="i">+		selclear();
</a><a href="#h48-0-2410" id="h48-0-2410" class="i">+
</a><a href="#h48-0-2411" id="h48-0-2411" class="i">+	gp = &amp;term.line[term.c.y][term.c.x];
</a><a href="#h48-0-2412" id="h48-0-2412" class="i">+	if (IS_SET(MODE_WRAP) &amp;&amp; (term.c.state &amp; CURSOR_WRAPNEXT)) {
</a><a href="#h48-0-2413" id="h48-0-2413" class="i">+		gp-&gt;mode |= ATTR_WRAP;
</a><a href="#h48-0-2414" id="h48-0-2414" class="i">+		tnewline(1);
</a><a href="#h48-0-2415" id="h48-0-2415" class="i">+		gp = &amp;term.line[term.c.y][term.c.x];
</a><a href="#h48-0-2416" id="h48-0-2416" class="i">+	}
</a><a href="#h48-0-2417" id="h48-0-2417" class="i">+
</a><a href="#h48-0-2418" id="h48-0-2418" class="i">+	if (IS_SET(MODE_INSERT) &amp;&amp; term.c.x+width &lt; term.col)
</a><a href="#h48-0-2419" id="h48-0-2419" class="i">+		memmove(gp+width, gp, (term.col - term.c.x - width) * sizeof(Glyph));
</a><a href="#h48-0-2420" id="h48-0-2420" class="i">+
</a><a href="#h48-0-2421" id="h48-0-2421" class="i">+	if (term.c.x+width &gt; term.col) {
</a><a href="#h48-0-2422" id="h48-0-2422" class="i">+		tnewline(1);
</a><a href="#h48-0-2423" id="h48-0-2423" class="i">+		gp = &amp;term.line[term.c.y][term.c.x];
</a><a href="#h48-0-2424" id="h48-0-2424" class="i">+	}
</a><a href="#h48-0-2425" id="h48-0-2425" class="i">+
</a><a href="#h48-0-2426" id="h48-0-2426" class="i">+	tsetchar(u, &amp;term.c.attr, term.c.x, term.c.y);
</a><a href="#h48-0-2427" id="h48-0-2427" class="i">+
</a><a href="#h48-0-2428" id="h48-0-2428" class="i">+	if (width == 2) {
</a><a href="#h48-0-2429" id="h48-0-2429" class="i">+		gp-&gt;mode |= ATTR_WIDE;
</a><a href="#h48-0-2430" id="h48-0-2430" class="i">+		if (term.c.x+1 &lt; term.col) {
</a><a href="#h48-0-2431" id="h48-0-2431" class="i">+			gp[1].u = &#39;\0&#39;;
</a><a href="#h48-0-2432" id="h48-0-2432" class="i">+			gp[1].mode = ATTR_WDUMMY;
</a><a href="#h48-0-2433" id="h48-0-2433" class="i">+		}
</a><a href="#h48-0-2434" id="h48-0-2434" class="i">+	}
</a><a href="#h48-0-2435" id="h48-0-2435" class="i">+	if (term.c.x+width &lt; term.col) {
</a><a href="#h48-0-2436" id="h48-0-2436" class="i">+		tmoveto(term.c.x+width, term.c.y);
</a><a href="#h48-0-2437" id="h48-0-2437" class="i">+	} else {
</a><a href="#h48-0-2438" id="h48-0-2438" class="i">+		term.c.state |= CURSOR_WRAPNEXT;
</a><a href="#h48-0-2439" id="h48-0-2439" class="i">+	}
</a><a href="#h48-0-2440" id="h48-0-2440" class="i">+}
</a><a href="#h48-0-2441" id="h48-0-2441" class="i">+
</a><a href="#h48-0-2442" id="h48-0-2442" class="i">+int
</a><a href="#h48-0-2443" id="h48-0-2443" class="i">+twrite(const char *buf, int buflen, int show_ctrl)
</a><a href="#h48-0-2444" id="h48-0-2444" class="i">+{
</a><a href="#h48-0-2445" id="h48-0-2445" class="i">+	int charsize;
</a><a href="#h48-0-2446" id="h48-0-2446" class="i">+	Rune u;
</a><a href="#h48-0-2447" id="h48-0-2447" class="i">+	int n;
</a><a href="#h48-0-2448" id="h48-0-2448" class="i">+
</a><a href="#h48-0-2449" id="h48-0-2449" class="i">+	for (n = 0; n &lt; buflen; n += charsize) {
</a><a href="#h48-0-2450" id="h48-0-2450" class="i">+		if (IS_SET(MODE_UTF8) &amp;&amp; !IS_SET(MODE_SIXEL)) {
</a><a href="#h48-0-2451" id="h48-0-2451" class="i">+			/* process a complete utf8 char */
</a><a href="#h48-0-2452" id="h48-0-2452" class="i">+			charsize = utf8decode(buf + n, &amp;u, buflen - n);
</a><a href="#h48-0-2453" id="h48-0-2453" class="i">+			if (charsize == 0)
</a><a href="#h48-0-2454" id="h48-0-2454" class="i">+				break;
</a><a href="#h48-0-2455" id="h48-0-2455" class="i">+		} else {
</a><a href="#h48-0-2456" id="h48-0-2456" class="i">+			u = buf[n] &amp; 0xFF;
</a><a href="#h48-0-2457" id="h48-0-2457" class="i">+			charsize = 1;
</a><a href="#h48-0-2458" id="h48-0-2458" class="i">+		}
</a><a href="#h48-0-2459" id="h48-0-2459" class="i">+		if (show_ctrl &amp;&amp; ISCONTROL(u)) {
</a><a href="#h48-0-2460" id="h48-0-2460" class="i">+			if (u &amp; 0x80) {
</a><a href="#h48-0-2461" id="h48-0-2461" class="i">+				u &amp;= 0x7f;
</a><a href="#h48-0-2462" id="h48-0-2462" class="i">+				tputc(&#39;^&#39;);
</a><a href="#h48-0-2463" id="h48-0-2463" class="i">+				tputc(&#39;[&#39;);
</a><a href="#h48-0-2464" id="h48-0-2464" class="i">+			} else if (u != &#39;\n&#39; &amp;&amp; u != &#39;\r&#39; &amp;&amp; u != &#39;\t&#39;) {
</a><a href="#h48-0-2465" id="h48-0-2465" class="i">+				u ^= 0x40;
</a><a href="#h48-0-2466" id="h48-0-2466" class="i">+				tputc(&#39;^&#39;);
</a><a href="#h48-0-2467" id="h48-0-2467" class="i">+			}
</a><a href="#h48-0-2468" id="h48-0-2468" class="i">+		}
</a><a href="#h48-0-2469" id="h48-0-2469" class="i">+		tputc(u);
</a><a href="#h48-0-2470" id="h48-0-2470" class="i">+	}
</a><a href="#h48-0-2471" id="h48-0-2471" class="i">+	return n;
</a><a href="#h48-0-2472" id="h48-0-2472" class="i">+}
</a><a href="#h48-0-2473" id="h48-0-2473" class="i">+
</a><a href="#h48-0-2474" id="h48-0-2474" class="i">+void
</a><a href="#h48-0-2475" id="h48-0-2475" class="i">+tresize(int col, int row)
</a><a href="#h48-0-2476" id="h48-0-2476" class="i">+{
</a><a href="#h48-0-2477" id="h48-0-2477" class="i">+	int i;
</a><a href="#h48-0-2478" id="h48-0-2478" class="i">+	int minrow = MIN(row, term.row);
</a><a href="#h48-0-2479" id="h48-0-2479" class="i">+	int mincol = MIN(col, term.col);
</a><a href="#h48-0-2480" id="h48-0-2480" class="i">+	int *bp;
</a><a href="#h48-0-2481" id="h48-0-2481" class="i">+	TCursor c;
</a><a href="#h48-0-2482" id="h48-0-2482" class="i">+
</a><a href="#h48-0-2483" id="h48-0-2483" class="i">+	if (col &lt; 1 || row &lt; 1) {
</a><a href="#h48-0-2484" id="h48-0-2484" class="i">+		fprintf(stderr,
</a><a href="#h48-0-2485" id="h48-0-2485" class="i">+		        &quot;tresize: error resizing to %dx%d\n&quot;, col, row);
</a><a href="#h48-0-2486" id="h48-0-2486" class="i">+		return;
</a><a href="#h48-0-2487" id="h48-0-2487" class="i">+	}
</a><a href="#h48-0-2488" id="h48-0-2488" class="i">+
</a><a href="#h48-0-2489" id="h48-0-2489" class="i">+	/*
</a><a href="#h48-0-2490" id="h48-0-2490" class="i">+	 * slide screen to keep cursor where we expect it -
</a><a href="#h48-0-2491" id="h48-0-2491" class="i">+	 * tscrollup would work here, but we can optimize to
</a><a href="#h48-0-2492" id="h48-0-2492" class="i">+	 * memmove because we&#39;re freeing the earlier lines
</a><a href="#h48-0-2493" id="h48-0-2493" class="i">+	 */
</a><a href="#h48-0-2494" id="h48-0-2494" class="i">+	for (i = 0; i &lt;= term.c.y - row; i++) {
</a><a href="#h48-0-2495" id="h48-0-2495" class="i">+		free(term.line[i]);
</a><a href="#h48-0-2496" id="h48-0-2496" class="i">+		free(term.alt[i]);
</a><a href="#h48-0-2497" id="h48-0-2497" class="i">+	}
</a><a href="#h48-0-2498" id="h48-0-2498" class="i">+	/* ensure that both src and dst are not NULL */
</a><a href="#h48-0-2499" id="h48-0-2499" class="i">+	if (i &gt; 0) {
</a><a href="#h48-0-2500" id="h48-0-2500" class="i">+		memmove(term.line, term.line + i, row * sizeof(Line));
</a><a href="#h48-0-2501" id="h48-0-2501" class="i">+		memmove(term.alt, term.alt + i, row * sizeof(Line));
</a><a href="#h48-0-2502" id="h48-0-2502" class="i">+	}
</a><a href="#h48-0-2503" id="h48-0-2503" class="i">+	for (i += row; i &lt; term.row; i++) {
</a><a href="#h48-0-2504" id="h48-0-2504" class="i">+		free(term.line[i]);
</a><a href="#h48-0-2505" id="h48-0-2505" class="i">+		free(term.alt[i]);
</a><a href="#h48-0-2506" id="h48-0-2506" class="i">+	}
</a><a href="#h48-0-2507" id="h48-0-2507" class="i">+
</a><a href="#h48-0-2508" id="h48-0-2508" class="i">+	/* resize to new height */
</a><a href="#h48-0-2509" id="h48-0-2509" class="i">+	term.line = xrealloc(term.line, row * sizeof(Line));
</a><a href="#h48-0-2510" id="h48-0-2510" class="i">+	term.alt  = xrealloc(term.alt,  row * sizeof(Line));
</a><a href="#h48-0-2511" id="h48-0-2511" class="i">+	term.dirty = xrealloc(term.dirty, row * sizeof(*term.dirty));
</a><a href="#h48-0-2512" id="h48-0-2512" class="i">+	term.tabs = xrealloc(term.tabs, col * sizeof(*term.tabs));
</a><a href="#h48-0-2513" id="h48-0-2513" class="i">+
</a><a href="#h48-0-2514" id="h48-0-2514" class="i">+	/* resize each row to new width, zero-pad if needed */
</a><a href="#h48-0-2515" id="h48-0-2515" class="i">+	for (i = 0; i &lt; minrow; i++) {
</a><a href="#h48-0-2516" id="h48-0-2516" class="i">+		term.line[i] = xrealloc(term.line[i], col * sizeof(Glyph));
</a><a href="#h48-0-2517" id="h48-0-2517" class="i">+		term.alt[i]  = xrealloc(term.alt[i],  col * sizeof(Glyph));
</a><a href="#h48-0-2518" id="h48-0-2518" class="i">+	}
</a><a href="#h48-0-2519" id="h48-0-2519" class="i">+
</a><a href="#h48-0-2520" id="h48-0-2520" class="i">+	/* allocate any new rows */
</a><a href="#h48-0-2521" id="h48-0-2521" class="i">+	for (/* i = minrow */; i &lt; row; i++) {
</a><a href="#h48-0-2522" id="h48-0-2522" class="i">+		term.line[i] = xmalloc(col * sizeof(Glyph));
</a><a href="#h48-0-2523" id="h48-0-2523" class="i">+		term.alt[i] = xmalloc(col * sizeof(Glyph));
</a><a href="#h48-0-2524" id="h48-0-2524" class="i">+	}
</a><a href="#h48-0-2525" id="h48-0-2525" class="i">+	if (col &gt; term.col) {
</a><a href="#h48-0-2526" id="h48-0-2526" class="i">+		bp = term.tabs + term.col;
</a><a href="#h48-0-2527" id="h48-0-2527" class="i">+
</a><a href="#h48-0-2528" id="h48-0-2528" class="i">+		memset(bp, 0, sizeof(*term.tabs) * (col - term.col));
</a><a href="#h48-0-2529" id="h48-0-2529" class="i">+		while (--bp &gt; term.tabs &amp;&amp; !*bp)
</a><a href="#h48-0-2530" id="h48-0-2530" class="i">+			/* nothing */ ;
</a><a href="#h48-0-2531" id="h48-0-2531" class="i">+		for (bp += tabspaces; bp &lt; term.tabs + col; bp += tabspaces)
</a><a href="#h48-0-2532" id="h48-0-2532" class="i">+			*bp = 1;
</a><a href="#h48-0-2533" id="h48-0-2533" class="i">+	}
</a><a href="#h48-0-2534" id="h48-0-2534" class="i">+	/* update terminal size */
</a><a href="#h48-0-2535" id="h48-0-2535" class="i">+	term.col = col;
</a><a href="#h48-0-2536" id="h48-0-2536" class="i">+	term.row = row;
</a><a href="#h48-0-2537" id="h48-0-2537" class="i">+	/* reset scrolling region */
</a><a href="#h48-0-2538" id="h48-0-2538" class="i">+	tsetscroll(0, row-1);
</a><a href="#h48-0-2539" id="h48-0-2539" class="i">+	/* make use of the LIMIT in tmoveto */
</a><a href="#h48-0-2540" id="h48-0-2540" class="i">+	tmoveto(term.c.x, term.c.y);
</a><a href="#h48-0-2541" id="h48-0-2541" class="i">+	/* Clearing both screens (it makes dirty all lines) */
</a><a href="#h48-0-2542" id="h48-0-2542" class="i">+	c = term.c;
</a><a href="#h48-0-2543" id="h48-0-2543" class="i">+	for (i = 0; i &lt; 2; i++) {
</a><a href="#h48-0-2544" id="h48-0-2544" class="i">+		if (mincol &lt; col &amp;&amp; 0 &lt; minrow) {
</a><a href="#h48-0-2545" id="h48-0-2545" class="i">+			tclearregion(mincol, 0, col - 1, minrow - 1);
</a><a href="#h48-0-2546" id="h48-0-2546" class="i">+		}
</a><a href="#h48-0-2547" id="h48-0-2547" class="i">+		if (0 &lt; col &amp;&amp; minrow &lt; row) {
</a><a href="#h48-0-2548" id="h48-0-2548" class="i">+			tclearregion(0, minrow, col - 1, row - 1);
</a><a href="#h48-0-2549" id="h48-0-2549" class="i">+		}
</a><a href="#h48-0-2550" id="h48-0-2550" class="i">+		tswapscreen();
</a><a href="#h48-0-2551" id="h48-0-2551" class="i">+		tcursor(CURSOR_LOAD);
</a><a href="#h48-0-2552" id="h48-0-2552" class="i">+	}
</a><a href="#h48-0-2553" id="h48-0-2553" class="i">+	term.c = c;
</a><a href="#h48-0-2554" id="h48-0-2554" class="i">+}
</a><a href="#h48-0-2555" id="h48-0-2555" class="i">+
</a><a href="#h48-0-2556" id="h48-0-2556" class="i">+void
</a><a href="#h48-0-2557" id="h48-0-2557" class="i">+resettitle(void)
</a><a href="#h48-0-2558" id="h48-0-2558" class="i">+{
</a><a href="#h48-0-2559" id="h48-0-2559" class="i">+	xsettitle(NULL);
</a><a href="#h48-0-2560" id="h48-0-2560" class="i">+}
</a><a href="#h48-0-2561" id="h48-0-2561" class="i">+
</a><a href="#h48-0-2562" id="h48-0-2562" class="i">+void
</a><a href="#h48-0-2563" id="h48-0-2563" class="i">+drawregion(int x1, int y1, int x2, int y2)
</a><a href="#h48-0-2564" id="h48-0-2564" class="i">+{
</a><a href="#h48-0-2565" id="h48-0-2565" class="i">+	int y;
</a><a href="#h48-0-2566" id="h48-0-2566" class="i">+	for (y = y1; y &lt; y2; y++) {
</a><a href="#h48-0-2567" id="h48-0-2567" class="i">+		if (!term.dirty[y])
</a><a href="#h48-0-2568" id="h48-0-2568" class="i">+			continue;
</a><a href="#h48-0-2569" id="h48-0-2569" class="i">+
</a><a href="#h48-0-2570" id="h48-0-2570" class="i">+		term.dirty[y] = 0;
</a><a href="#h48-0-2571" id="h48-0-2571" class="i">+		xdrawline(term.line[y], x1, y, x2);
</a><a href="#h48-0-2572" id="h48-0-2572" class="i">+	}
</a><a href="#h48-0-2573" id="h48-0-2573" class="i">+}
</a><a href="#h48-0-2574" id="h48-0-2574" class="i">+
</a><a href="#h48-0-2575" id="h48-0-2575" class="i">+void
</a><a href="#h48-0-2576" id="h48-0-2576" class="i">+draw(void)
</a><a href="#h48-0-2577" id="h48-0-2577" class="i">+{
</a><a href="#h48-0-2578" id="h48-0-2578" class="i">+	int cx = term.c.x;
</a><a href="#h48-0-2579" id="h48-0-2579" class="i">+
</a><a href="#h48-0-2580" id="h48-0-2580" class="i">+	if (!xstartdraw())
</a><a href="#h48-0-2581" id="h48-0-2581" class="i">+		return;
</a><a href="#h48-0-2582" id="h48-0-2582" class="i">+
</a><a href="#h48-0-2583" id="h48-0-2583" class="i">+	/* adjust cursor position */
</a><a href="#h48-0-2584" id="h48-0-2584" class="i">+	LIMIT(term.ocx, 0, term.col-1);
</a><a href="#h48-0-2585" id="h48-0-2585" class="i">+	LIMIT(term.ocy, 0, term.row-1);
</a><a href="#h48-0-2586" id="h48-0-2586" class="i">+	if (term.line[term.ocy][term.ocx].mode &amp; ATTR_WDUMMY)
</a><a href="#h48-0-2587" id="h48-0-2587" class="i">+		term.ocx--;
</a><a href="#h48-0-2588" id="h48-0-2588" class="i">+	if (term.line[term.c.y][cx].mode &amp; ATTR_WDUMMY)
</a><a href="#h48-0-2589" id="h48-0-2589" class="i">+		cx--;
</a><a href="#h48-0-2590" id="h48-0-2590" class="i">+
</a><a href="#h48-0-2591" id="h48-0-2591" class="i">+	drawregion(0, 0, term.col, term.row);
</a><a href="#h48-0-2592" id="h48-0-2592" class="i">+	xdrawcursor(cx, term.c.y, term.line[term.c.y][cx],
</a><a href="#h48-0-2593" id="h48-0-2593" class="i">+			term.ocx, term.ocy, term.line[term.ocy][term.ocx]);
</a><a href="#h48-0-2594" id="h48-0-2594" class="i">+	term.ocx = cx, term.ocy = term.c.y;
</a><a href="#h48-0-2595" id="h48-0-2595" class="i">+	xfinishdraw();
</a><a href="#h48-0-2596" id="h48-0-2596" class="i">+	xximspot(term.ocx, term.ocy);
</a><a href="#h48-0-2597" id="h48-0-2597" class="i">+}
</a><a href="#h48-0-2598" id="h48-0-2598" class="i">+
</a><a href="#h48-0-2599" id="h48-0-2599" class="i">+void
</a><a href="#h48-0-2600" id="h48-0-2600" class="i">+redraw(void)
</a><a href="#h48-0-2601" id="h48-0-2601" class="i">+{
</a><a href="#h48-0-2602" id="h48-0-2602" class="i">+	tfulldirt();
</a><a href="#h48-0-2603" id="h48-0-2603" class="i">+	draw();
</a><a href="#h48-0-2604" id="h48-0-2604" class="i">+}
</a><b>diff --git a/<a id="h49" href="../file/st/st.h.html">st/st.h</a> b/<a href="../file/st/st.h.html">st/st.h</a></b>
<a href="#h49-0" id="h49-0" class="h">@@ -0,0 +1,123 @@
</a><a href="#h49-0-0" id="h49-0-0" class="i">+/* See LICENSE for license details. */
</a><a href="#h49-0-1" id="h49-0-1" class="i">+
</a><a href="#h49-0-2" id="h49-0-2" class="i">+#include &lt;stdint.h&gt;
</a><a href="#h49-0-3" id="h49-0-3" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h49-0-4" id="h49-0-4" class="i">+
</a><a href="#h49-0-5" id="h49-0-5" class="i">+/* macros */
</a><a href="#h49-0-6" id="h49-0-6" class="i">+#define MIN(a, b)		((a) &lt; (b) ? (a) : (b))
</a><a href="#h49-0-7" id="h49-0-7" class="i">+#define MAX(a, b)		((a) &lt; (b) ? (b) : (a))
</a><a href="#h49-0-8" id="h49-0-8" class="i">+#define LEN(a)			(sizeof(a) / sizeof(a)[0])
</a><a href="#h49-0-9" id="h49-0-9" class="i">+#define BETWEEN(x, a, b)	((a) &lt;= (x) &amp;&amp; (x) &lt;= (b))
</a><a href="#h49-0-10" id="h49-0-10" class="i">+#define DIVCEIL(n, d)		(((n) + ((d) - 1)) / (d))
</a><a href="#h49-0-11" id="h49-0-11" class="i">+#define DEFAULT(a, b)		(a) = (a) ? (a) : (b)
</a><a href="#h49-0-12" id="h49-0-12" class="i">+#define LIMIT(x, a, b)		(x) = (x) &lt; (a) ? (a) : (x) &gt; (b) ? (b) : (x)
</a><a href="#h49-0-13" id="h49-0-13" class="i">+#define ATTRCMP(a, b)		((a).mode != (b).mode || (a).fg != (b).fg || \
</a><a href="#h49-0-14" id="h49-0-14" class="i">+				(a).bg != (b).bg)
</a><a href="#h49-0-15" id="h49-0-15" class="i">+#define TIMEDIFF(t1, t2)	((t1.tv_sec-t2.tv_sec)*1000 + \
</a><a href="#h49-0-16" id="h49-0-16" class="i">+				(t1.tv_nsec-t2.tv_nsec)/1E6)
</a><a href="#h49-0-17" id="h49-0-17" class="i">+#define MODBIT(x, set, bit)	((set) ? ((x) |= (bit)) : ((x) &amp;= ~(bit)))
</a><a href="#h49-0-18" id="h49-0-18" class="i">+
</a><a href="#h49-0-19" id="h49-0-19" class="i">+#define TRUECOLOR(r,g,b)	(1 &lt;&lt; 24 | (r) &lt;&lt; 16 | (g) &lt;&lt; 8 | (b))
</a><a href="#h49-0-20" id="h49-0-20" class="i">+#define IS_TRUECOL(x)		(1 &lt;&lt; 24 &amp; (x))
</a><a href="#h49-0-21" id="h49-0-21" class="i">+
</a><a href="#h49-0-22" id="h49-0-22" class="i">+enum glyph_attribute {
</a><a href="#h49-0-23" id="h49-0-23" class="i">+	ATTR_NULL       = 0,
</a><a href="#h49-0-24" id="h49-0-24" class="i">+	ATTR_BOLD       = 1 &lt;&lt; 0,
</a><a href="#h49-0-25" id="h49-0-25" class="i">+	ATTR_FAINT      = 1 &lt;&lt; 1,
</a><a href="#h49-0-26" id="h49-0-26" class="i">+	ATTR_ITALIC     = 1 &lt;&lt; 2,
</a><a href="#h49-0-27" id="h49-0-27" class="i">+	ATTR_UNDERLINE  = 1 &lt;&lt; 3,
</a><a href="#h49-0-28" id="h49-0-28" class="i">+	ATTR_BLINK      = 1 &lt;&lt; 4,
</a><a href="#h49-0-29" id="h49-0-29" class="i">+	ATTR_REVERSE    = 1 &lt;&lt; 5,
</a><a href="#h49-0-30" id="h49-0-30" class="i">+	ATTR_INVISIBLE  = 1 &lt;&lt; 6,
</a><a href="#h49-0-31" id="h49-0-31" class="i">+	ATTR_STRUCK     = 1 &lt;&lt; 7,
</a><a href="#h49-0-32" id="h49-0-32" class="i">+	ATTR_WRAP       = 1 &lt;&lt; 8,
</a><a href="#h49-0-33" id="h49-0-33" class="i">+	ATTR_WIDE       = 1 &lt;&lt; 9,
</a><a href="#h49-0-34" id="h49-0-34" class="i">+	ATTR_WDUMMY     = 1 &lt;&lt; 10,
</a><a href="#h49-0-35" id="h49-0-35" class="i">+	ATTR_BOLD_FAINT = ATTR_BOLD | ATTR_FAINT,
</a><a href="#h49-0-36" id="h49-0-36" class="i">+};
</a><a href="#h49-0-37" id="h49-0-37" class="i">+
</a><a href="#h49-0-38" id="h49-0-38" class="i">+enum selection_mode {
</a><a href="#h49-0-39" id="h49-0-39" class="i">+	SEL_IDLE = 0,
</a><a href="#h49-0-40" id="h49-0-40" class="i">+	SEL_EMPTY = 1,
</a><a href="#h49-0-41" id="h49-0-41" class="i">+	SEL_READY = 2
</a><a href="#h49-0-42" id="h49-0-42" class="i">+};
</a><a href="#h49-0-43" id="h49-0-43" class="i">+
</a><a href="#h49-0-44" id="h49-0-44" class="i">+enum selection_type {
</a><a href="#h49-0-45" id="h49-0-45" class="i">+	SEL_REGULAR = 1,
</a><a href="#h49-0-46" id="h49-0-46" class="i">+	SEL_RECTANGULAR = 2
</a><a href="#h49-0-47" id="h49-0-47" class="i">+};
</a><a href="#h49-0-48" id="h49-0-48" class="i">+
</a><a href="#h49-0-49" id="h49-0-49" class="i">+enum selection_snap {
</a><a href="#h49-0-50" id="h49-0-50" class="i">+	SNAP_WORD = 1,
</a><a href="#h49-0-51" id="h49-0-51" class="i">+	SNAP_LINE = 2
</a><a href="#h49-0-52" id="h49-0-52" class="i">+};
</a><a href="#h49-0-53" id="h49-0-53" class="i">+
</a><a href="#h49-0-54" id="h49-0-54" class="i">+typedef unsigned char uchar;
</a><a href="#h49-0-55" id="h49-0-55" class="i">+typedef unsigned int uint;
</a><a href="#h49-0-56" id="h49-0-56" class="i">+typedef unsigned long ulong;
</a><a href="#h49-0-57" id="h49-0-57" class="i">+typedef unsigned short ushort;
</a><a href="#h49-0-58" id="h49-0-58" class="i">+
</a><a href="#h49-0-59" id="h49-0-59" class="i">+typedef uint_least32_t Rune;
</a><a href="#h49-0-60" id="h49-0-60" class="i">+
</a><a href="#h49-0-61" id="h49-0-61" class="i">+#define Glyph Glyph_
</a><a href="#h49-0-62" id="h49-0-62" class="i">+typedef struct {
</a><a href="#h49-0-63" id="h49-0-63" class="i">+	Rune u;           /* character code */
</a><a href="#h49-0-64" id="h49-0-64" class="i">+	ushort mode;      /* attribute flags */
</a><a href="#h49-0-65" id="h49-0-65" class="i">+	uint32_t fg;      /* foreground  */
</a><a href="#h49-0-66" id="h49-0-66" class="i">+	uint32_t bg;      /* background  */
</a><a href="#h49-0-67" id="h49-0-67" class="i">+} Glyph;
</a><a href="#h49-0-68" id="h49-0-68" class="i">+
</a><a href="#h49-0-69" id="h49-0-69" class="i">+typedef Glyph *Line;
</a><a href="#h49-0-70" id="h49-0-70" class="i">+
</a><a href="#h49-0-71" id="h49-0-71" class="i">+typedef union {
</a><a href="#h49-0-72" id="h49-0-72" class="i">+	int i;
</a><a href="#h49-0-73" id="h49-0-73" class="i">+	uint ui;
</a><a href="#h49-0-74" id="h49-0-74" class="i">+	float f;
</a><a href="#h49-0-75" id="h49-0-75" class="i">+	const void *v;
</a><a href="#h49-0-76" id="h49-0-76" class="i">+} Arg;
</a><a href="#h49-0-77" id="h49-0-77" class="i">+
</a><a href="#h49-0-78" id="h49-0-78" class="i">+void die(const char *, ...);
</a><a href="#h49-0-79" id="h49-0-79" class="i">+void redraw(void);
</a><a href="#h49-0-80" id="h49-0-80" class="i">+void draw(void);
</a><a href="#h49-0-81" id="h49-0-81" class="i">+
</a><a href="#h49-0-82" id="h49-0-82" class="i">+void printscreen(const Arg *);
</a><a href="#h49-0-83" id="h49-0-83" class="i">+void printsel(const Arg *);
</a><a href="#h49-0-84" id="h49-0-84" class="i">+void sendbreak(const Arg *);
</a><a href="#h49-0-85" id="h49-0-85" class="i">+void toggleprinter(const Arg *);
</a><a href="#h49-0-86" id="h49-0-86" class="i">+
</a><a href="#h49-0-87" id="h49-0-87" class="i">+int tattrset(int);
</a><a href="#h49-0-88" id="h49-0-88" class="i">+void tnew(int, int);
</a><a href="#h49-0-89" id="h49-0-89" class="i">+void tresize(int, int);
</a><a href="#h49-0-90" id="h49-0-90" class="i">+void tsetdirtattr(int);
</a><a href="#h49-0-91" id="h49-0-91" class="i">+void ttyhangup(void);
</a><a href="#h49-0-92" id="h49-0-92" class="i">+int ttynew(char *, char *, char *, char **);
</a><a href="#h49-0-93" id="h49-0-93" class="i">+size_t ttyread(void);
</a><a href="#h49-0-94" id="h49-0-94" class="i">+void ttyresize(int, int);
</a><a href="#h49-0-95" id="h49-0-95" class="i">+void ttywrite(const char *, size_t, int);
</a><a href="#h49-0-96" id="h49-0-96" class="i">+
</a><a href="#h49-0-97" id="h49-0-97" class="i">+void resettitle(void);
</a><a href="#h49-0-98" id="h49-0-98" class="i">+
</a><a href="#h49-0-99" id="h49-0-99" class="i">+void selclear(void);
</a><a href="#h49-0-100" id="h49-0-100" class="i">+void selinit(void);
</a><a href="#h49-0-101" id="h49-0-101" class="i">+void selstart(int, int, int);
</a><a href="#h49-0-102" id="h49-0-102" class="i">+void selextend(int, int, int, int);
</a><a href="#h49-0-103" id="h49-0-103" class="i">+int selected(int, int);
</a><a href="#h49-0-104" id="h49-0-104" class="i">+char *getsel(void);
</a><a href="#h49-0-105" id="h49-0-105" class="i">+
</a><a href="#h49-0-106" id="h49-0-106" class="i">+size_t utf8encode(Rune, char *);
</a><a href="#h49-0-107" id="h49-0-107" class="i">+
</a><a href="#h49-0-108" id="h49-0-108" class="i">+void *xmalloc(size_t);
</a><a href="#h49-0-109" id="h49-0-109" class="i">+void *xrealloc(void *, size_t);
</a><a href="#h49-0-110" id="h49-0-110" class="i">+char *xstrdup(char *);
</a><a href="#h49-0-111" id="h49-0-111" class="i">+
</a><a href="#h49-0-112" id="h49-0-112" class="i">+/* config.h globals */
</a><a href="#h49-0-113" id="h49-0-113" class="i">+extern char *utmp;
</a><a href="#h49-0-114" id="h49-0-114" class="i">+extern char *stty_args;
</a><a href="#h49-0-115" id="h49-0-115" class="i">+extern char *vtiden;
</a><a href="#h49-0-116" id="h49-0-116" class="i">+extern char *worddelimiters;
</a><a href="#h49-0-117" id="h49-0-117" class="i">+extern int allowaltscreen;
</a><a href="#h49-0-118" id="h49-0-118" class="i">+extern char *termname;
</a><a href="#h49-0-119" id="h49-0-119" class="i">+extern unsigned int tabspaces;
</a><a href="#h49-0-120" id="h49-0-120" class="i">+extern unsigned int alpha;
</a><a href="#h49-0-121" id="h49-0-121" class="i">+extern unsigned int defaultfg;
</a><a href="#h49-0-122" id="h49-0-122" class="i">+extern unsigned int defaultbg;
</a><b>diff --git a/<a id="h50" href="../file/st/st.info.html">st/st.info</a> b/<a href="../file/st/st.info.html">st/st.info</a></b>
<a href="#h50-0" id="h50-0" class="h">@@ -0,0 +1,222 @@
</a><a href="#h50-0-0" id="h50-0-0" class="i">+st| simpleterm,
</a><a href="#h50-0-1" id="h50-0-1" class="i">+	acsc=+C\,D-A.B0E``aaffgghFiGjjkkllmmnnooppqqrrssttuuvvwwxxyyzz{{||}}~~,
</a><a href="#h50-0-2" id="h50-0-2" class="i">+	am,
</a><a href="#h50-0-3" id="h50-0-3" class="i">+	bce,
</a><a href="#h50-0-4" id="h50-0-4" class="i">+	bel=^G,
</a><a href="#h50-0-5" id="h50-0-5" class="i">+	blink=\E[5m,
</a><a href="#h50-0-6" id="h50-0-6" class="i">+	bold=\E[1m,
</a><a href="#h50-0-7" id="h50-0-7" class="i">+	cbt=\E[Z,
</a><a href="#h50-0-8" id="h50-0-8" class="i">+	cvvis=\E[?25h,
</a><a href="#h50-0-9" id="h50-0-9" class="i">+	civis=\E[?25l,
</a><a href="#h50-0-10" id="h50-0-10" class="i">+	clear=\E[H\E[2J,
</a><a href="#h50-0-11" id="h50-0-11" class="i">+	cnorm=\E[?12l\E[?25h,
</a><a href="#h50-0-12" id="h50-0-12" class="i">+	colors#8,
</a><a href="#h50-0-13" id="h50-0-13" class="i">+	cols#80,
</a><a href="#h50-0-14" id="h50-0-14" class="i">+	cr=^M,
</a><a href="#h50-0-15" id="h50-0-15" class="i">+	csr=\E[%i%p1%d;%p2%dr,
</a><a href="#h50-0-16" id="h50-0-16" class="i">+	cub=\E[%p1%dD,
</a><a href="#h50-0-17" id="h50-0-17" class="i">+	cub1=^H,
</a><a href="#h50-0-18" id="h50-0-18" class="i">+	cud1=^J,
</a><a href="#h50-0-19" id="h50-0-19" class="i">+	cud=\E[%p1%dB,
</a><a href="#h50-0-20" id="h50-0-20" class="i">+	cuf1=\E[C,
</a><a href="#h50-0-21" id="h50-0-21" class="i">+	cuf=\E[%p1%dC,
</a><a href="#h50-0-22" id="h50-0-22" class="i">+	cup=\E[%i%p1%d;%p2%dH,
</a><a href="#h50-0-23" id="h50-0-23" class="i">+	cuu1=\E[A,
</a><a href="#h50-0-24" id="h50-0-24" class="i">+	cuu=\E[%p1%dA,
</a><a href="#h50-0-25" id="h50-0-25" class="i">+	dch=\E[%p1%dP,
</a><a href="#h50-0-26" id="h50-0-26" class="i">+	dch1=\E[P,
</a><a href="#h50-0-27" id="h50-0-27" class="i">+	dim=\E[2m,
</a><a href="#h50-0-28" id="h50-0-28" class="i">+	dl=\E[%p1%dM,
</a><a href="#h50-0-29" id="h50-0-29" class="i">+	dl1=\E[M,
</a><a href="#h50-0-30" id="h50-0-30" class="i">+	ech=\E[%p1%dX,
</a><a href="#h50-0-31" id="h50-0-31" class="i">+	ed=\E[J,
</a><a href="#h50-0-32" id="h50-0-32" class="i">+	el=\E[K,
</a><a href="#h50-0-33" id="h50-0-33" class="i">+	el1=\E[1K,
</a><a href="#h50-0-34" id="h50-0-34" class="i">+	enacs=\E)0,
</a><a href="#h50-0-35" id="h50-0-35" class="i">+	flash=\E[?5h$&lt;80/&gt;\E[?5l,
</a><a href="#h50-0-36" id="h50-0-36" class="i">+	fsl=^G,
</a><a href="#h50-0-37" id="h50-0-37" class="i">+	home=\E[H,
</a><a href="#h50-0-38" id="h50-0-38" class="i">+	hpa=\E[%i%p1%dG,
</a><a href="#h50-0-39" id="h50-0-39" class="i">+	hs,
</a><a href="#h50-0-40" id="h50-0-40" class="i">+	ht=^I,
</a><a href="#h50-0-41" id="h50-0-41" class="i">+	hts=\EH,
</a><a href="#h50-0-42" id="h50-0-42" class="i">+	ich=\E[%p1%d@,
</a><a href="#h50-0-43" id="h50-0-43" class="i">+	il1=\E[L,
</a><a href="#h50-0-44" id="h50-0-44" class="i">+	il=\E[%p1%dL,
</a><a href="#h50-0-45" id="h50-0-45" class="i">+	ind=^J,
</a><a href="#h50-0-46" id="h50-0-46" class="i">+	indn=\E[%p1%dS,
</a><a href="#h50-0-47" id="h50-0-47" class="i">+	invis=\E[8m,
</a><a href="#h50-0-48" id="h50-0-48" class="i">+	is2=\E[4l\E&gt;\E[?1034l,
</a><a href="#h50-0-49" id="h50-0-49" class="i">+	it#8,
</a><a href="#h50-0-50" id="h50-0-50" class="i">+	kel=\E[1;2F,
</a><a href="#h50-0-51" id="h50-0-51" class="i">+	ked=\E[1;5F,
</a><a href="#h50-0-52" id="h50-0-52" class="i">+	ka1=\E[1~,
</a><a href="#h50-0-53" id="h50-0-53" class="i">+	ka3=\E[5~,
</a><a href="#h50-0-54" id="h50-0-54" class="i">+	kc1=\E[4~,
</a><a href="#h50-0-55" id="h50-0-55" class="i">+	kc3=\E[6~,
</a><a href="#h50-0-56" id="h50-0-56" class="i">+	kbs=\177,
</a><a href="#h50-0-57" id="h50-0-57" class="i">+	kcbt=\E[Z,
</a><a href="#h50-0-58" id="h50-0-58" class="i">+	kb2=\EOu,
</a><a href="#h50-0-59" id="h50-0-59" class="i">+	kcub1=\EOD,
</a><a href="#h50-0-60" id="h50-0-60" class="i">+	kcud1=\EOB,
</a><a href="#h50-0-61" id="h50-0-61" class="i">+	kcuf1=\EOC,
</a><a href="#h50-0-62" id="h50-0-62" class="i">+	kcuu1=\EOA,
</a><a href="#h50-0-63" id="h50-0-63" class="i">+	kDC=\E[3;2~,
</a><a href="#h50-0-64" id="h50-0-64" class="i">+	kent=\EOM,
</a><a href="#h50-0-65" id="h50-0-65" class="i">+	kEND=\E[1;2F,
</a><a href="#h50-0-66" id="h50-0-66" class="i">+	kIC=\E[2;2~,
</a><a href="#h50-0-67" id="h50-0-67" class="i">+	kNXT=\E[6;2~,
</a><a href="#h50-0-68" id="h50-0-68" class="i">+	kPRV=\E[5;2~,
</a><a href="#h50-0-69" id="h50-0-69" class="i">+	kHOM=\E[1;2H,
</a><a href="#h50-0-70" id="h50-0-70" class="i">+	kLFT=\E[1;2D,
</a><a href="#h50-0-71" id="h50-0-71" class="i">+	kRIT=\E[1;2C,
</a><a href="#h50-0-72" id="h50-0-72" class="i">+	kind=\E[1;2B,
</a><a href="#h50-0-73" id="h50-0-73" class="i">+	kri=\E[1;2A,
</a><a href="#h50-0-74" id="h50-0-74" class="i">+	kclr=\E[3;5~,
</a><a href="#h50-0-75" id="h50-0-75" class="i">+	kdl1=\E[3;2~,
</a><a href="#h50-0-76" id="h50-0-76" class="i">+	kdch1=\E[3~,
</a><a href="#h50-0-77" id="h50-0-77" class="i">+	kich1=\E[2~,
</a><a href="#h50-0-78" id="h50-0-78" class="i">+	kend=\E[4~,
</a><a href="#h50-0-79" id="h50-0-79" class="i">+	kf1=\EOP,
</a><a href="#h50-0-80" id="h50-0-80" class="i">+	kf2=\EOQ,
</a><a href="#h50-0-81" id="h50-0-81" class="i">+	kf3=\EOR,
</a><a href="#h50-0-82" id="h50-0-82" class="i">+	kf4=\EOS,
</a><a href="#h50-0-83" id="h50-0-83" class="i">+	kf5=\E[15~,
</a><a href="#h50-0-84" id="h50-0-84" class="i">+	kf6=\E[17~,
</a><a href="#h50-0-85" id="h50-0-85" class="i">+	kf7=\E[18~,
</a><a href="#h50-0-86" id="h50-0-86" class="i">+	kf8=\E[19~,
</a><a href="#h50-0-87" id="h50-0-87" class="i">+	kf9=\E[20~,
</a><a href="#h50-0-88" id="h50-0-88" class="i">+	kf10=\E[21~,
</a><a href="#h50-0-89" id="h50-0-89" class="i">+	kf11=\E[23~,
</a><a href="#h50-0-90" id="h50-0-90" class="i">+	kf12=\E[24~,
</a><a href="#h50-0-91" id="h50-0-91" class="i">+	kf13=\E[1;2P,
</a><a href="#h50-0-92" id="h50-0-92" class="i">+	kf14=\E[1;2Q,
</a><a href="#h50-0-93" id="h50-0-93" class="i">+	kf15=\E[1;2R,
</a><a href="#h50-0-94" id="h50-0-94" class="i">+	kf16=\E[1;2S,
</a><a href="#h50-0-95" id="h50-0-95" class="i">+	kf17=\E[15;2~,
</a><a href="#h50-0-96" id="h50-0-96" class="i">+	kf18=\E[17;2~,
</a><a href="#h50-0-97" id="h50-0-97" class="i">+	kf19=\E[18;2~,
</a><a href="#h50-0-98" id="h50-0-98" class="i">+	kf20=\E[19;2~,
</a><a href="#h50-0-99" id="h50-0-99" class="i">+	kf21=\E[20;2~,
</a><a href="#h50-0-100" id="h50-0-100" class="i">+	kf22=\E[21;2~,
</a><a href="#h50-0-101" id="h50-0-101" class="i">+	kf23=\E[23;2~,
</a><a href="#h50-0-102" id="h50-0-102" class="i">+	kf24=\E[24;2~,
</a><a href="#h50-0-103" id="h50-0-103" class="i">+	kf25=\E[1;5P,
</a><a href="#h50-0-104" id="h50-0-104" class="i">+	kf26=\E[1;5Q,
</a><a href="#h50-0-105" id="h50-0-105" class="i">+	kf27=\E[1;5R,
</a><a href="#h50-0-106" id="h50-0-106" class="i">+	kf28=\E[1;5S,
</a><a href="#h50-0-107" id="h50-0-107" class="i">+	kf29=\E[15;5~,
</a><a href="#h50-0-108" id="h50-0-108" class="i">+	kf30=\E[17;5~,
</a><a href="#h50-0-109" id="h50-0-109" class="i">+	kf31=\E[18;5~,
</a><a href="#h50-0-110" id="h50-0-110" class="i">+	kf32=\E[19;5~,
</a><a href="#h50-0-111" id="h50-0-111" class="i">+	kf33=\E[20;5~,
</a><a href="#h50-0-112" id="h50-0-112" class="i">+	kf34=\E[21;5~,
</a><a href="#h50-0-113" id="h50-0-113" class="i">+	kf35=\E[23;5~,
</a><a href="#h50-0-114" id="h50-0-114" class="i">+	kf36=\E[24;5~,
</a><a href="#h50-0-115" id="h50-0-115" class="i">+	kf37=\E[1;6P,
</a><a href="#h50-0-116" id="h50-0-116" class="i">+	kf38=\E[1;6Q,
</a><a href="#h50-0-117" id="h50-0-117" class="i">+	kf39=\E[1;6R,
</a><a href="#h50-0-118" id="h50-0-118" class="i">+	kf40=\E[1;6S,
</a><a href="#h50-0-119" id="h50-0-119" class="i">+	kf41=\E[15;6~,
</a><a href="#h50-0-120" id="h50-0-120" class="i">+	kf42=\E[17;6~,
</a><a href="#h50-0-121" id="h50-0-121" class="i">+	kf43=\E[18;6~,
</a><a href="#h50-0-122" id="h50-0-122" class="i">+	kf44=\E[19;6~,
</a><a href="#h50-0-123" id="h50-0-123" class="i">+	kf45=\E[20;6~,
</a><a href="#h50-0-124" id="h50-0-124" class="i">+	kf46=\E[21;6~,
</a><a href="#h50-0-125" id="h50-0-125" class="i">+	kf47=\E[23;6~,
</a><a href="#h50-0-126" id="h50-0-126" class="i">+	kf48=\E[24;6~,
</a><a href="#h50-0-127" id="h50-0-127" class="i">+	kf49=\E[1;3P,
</a><a href="#h50-0-128" id="h50-0-128" class="i">+	kf50=\E[1;3Q,
</a><a href="#h50-0-129" id="h50-0-129" class="i">+	kf51=\E[1;3R,
</a><a href="#h50-0-130" id="h50-0-130" class="i">+	kf52=\E[1;3S,
</a><a href="#h50-0-131" id="h50-0-131" class="i">+	kf53=\E[15;3~,
</a><a href="#h50-0-132" id="h50-0-132" class="i">+	kf54=\E[17;3~,
</a><a href="#h50-0-133" id="h50-0-133" class="i">+	kf55=\E[18;3~,
</a><a href="#h50-0-134" id="h50-0-134" class="i">+	kf56=\E[19;3~,
</a><a href="#h50-0-135" id="h50-0-135" class="i">+	kf57=\E[20;3~,
</a><a href="#h50-0-136" id="h50-0-136" class="i">+	kf58=\E[21;3~,
</a><a href="#h50-0-137" id="h50-0-137" class="i">+	kf59=\E[23;3~,
</a><a href="#h50-0-138" id="h50-0-138" class="i">+	kf60=\E[24;3~,
</a><a href="#h50-0-139" id="h50-0-139" class="i">+	kf61=\E[1;4P,
</a><a href="#h50-0-140" id="h50-0-140" class="i">+	kf62=\E[1;4Q,
</a><a href="#h50-0-141" id="h50-0-141" class="i">+	kf63=\E[1;4R,
</a><a href="#h50-0-142" id="h50-0-142" class="i">+	khome=\E[1~,
</a><a href="#h50-0-143" id="h50-0-143" class="i">+	kil1=\E[2;5~,
</a><a href="#h50-0-144" id="h50-0-144" class="i">+	krmir=\E[2;2~,
</a><a href="#h50-0-145" id="h50-0-145" class="i">+	knp=\E[6~,
</a><a href="#h50-0-146" id="h50-0-146" class="i">+	kmous=\E[M,
</a><a href="#h50-0-147" id="h50-0-147" class="i">+	kpp=\E[5~,
</a><a href="#h50-0-148" id="h50-0-148" class="i">+	lines#24,
</a><a href="#h50-0-149" id="h50-0-149" class="i">+	mir,
</a><a href="#h50-0-150" id="h50-0-150" class="i">+	msgr,
</a><a href="#h50-0-151" id="h50-0-151" class="i">+	npc,
</a><a href="#h50-0-152" id="h50-0-152" class="i">+	op=\E[39;49m,
</a><a href="#h50-0-153" id="h50-0-153" class="i">+	pairs#64,
</a><a href="#h50-0-154" id="h50-0-154" class="i">+	mc0=\E[i,
</a><a href="#h50-0-155" id="h50-0-155" class="i">+	mc4=\E[4i,
</a><a href="#h50-0-156" id="h50-0-156" class="i">+	mc5=\E[5i,
</a><a href="#h50-0-157" id="h50-0-157" class="i">+	rc=\E8,
</a><a href="#h50-0-158" id="h50-0-158" class="i">+	rev=\E[7m,
</a><a href="#h50-0-159" id="h50-0-159" class="i">+	ri=\EM,
</a><a href="#h50-0-160" id="h50-0-160" class="i">+	ritm=\E[23m,
</a><a href="#h50-0-161" id="h50-0-161" class="i">+	rmacs=\E(B,
</a><a href="#h50-0-162" id="h50-0-162" class="i">+	rmcup=\E[?1049l,
</a><a href="#h50-0-163" id="h50-0-163" class="i">+	rmir=\E[4l,
</a><a href="#h50-0-164" id="h50-0-164" class="i">+	rmkx=\E[?1l\E&gt;,
</a><a href="#h50-0-165" id="h50-0-165" class="i">+	rmso=\E[27m,
</a><a href="#h50-0-166" id="h50-0-166" class="i">+	rmul=\E[24m,
</a><a href="#h50-0-167" id="h50-0-167" class="i">+	rs1=\Ec,
</a><a href="#h50-0-168" id="h50-0-168" class="i">+	rs2=\E[4l\E&gt;\E[?1034l,
</a><a href="#h50-0-169" id="h50-0-169" class="i">+	sc=\E7,
</a><a href="#h50-0-170" id="h50-0-170" class="i">+	setab=\E[4%p1%dm,
</a><a href="#h50-0-171" id="h50-0-171" class="i">+	setaf=\E[3%p1%dm,
</a><a href="#h50-0-172" id="h50-0-172" class="i">+	setb=\E[4%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m,
</a><a href="#h50-0-173" id="h50-0-173" class="i">+	setf=\E[3%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m,
</a><a href="#h50-0-174" id="h50-0-174" class="i">+	sgr0=\E[0m,
</a><a href="#h50-0-175" id="h50-0-175" class="i">+	sgr=%?%p9%t\E(0%e\E(B%;\E[0%?%p6%t;1%;%?%p2%t;4%;%?%p1%p3%|%t;7%;%?%p4%t;5%;%?%p7%t;8%;m,
</a><a href="#h50-0-176" id="h50-0-176" class="i">+	sitm=\E[3m,
</a><a href="#h50-0-177" id="h50-0-177" class="i">+	smacs=\E(0,
</a><a href="#h50-0-178" id="h50-0-178" class="i">+	smcup=\E[?1049h,
</a><a href="#h50-0-179" id="h50-0-179" class="i">+	smir=\E[4h,
</a><a href="#h50-0-180" id="h50-0-180" class="i">+	smkx=\E[?1h\E=,
</a><a href="#h50-0-181" id="h50-0-181" class="i">+	smso=\E[7m,
</a><a href="#h50-0-182" id="h50-0-182" class="i">+	smul=\E[4m,
</a><a href="#h50-0-183" id="h50-0-183" class="i">+	tbc=\E[3g,
</a><a href="#h50-0-184" id="h50-0-184" class="i">+	tsl=\E]0;,
</a><a href="#h50-0-185" id="h50-0-185" class="i">+	xenl,
</a><a href="#h50-0-186" id="h50-0-186" class="i">+	vpa=\E[%i%p1%dd,
</a><a href="#h50-0-187" id="h50-0-187" class="i">+# XTerm extensions
</a><a href="#h50-0-188" id="h50-0-188" class="i">+	rmxx=\E[29m,
</a><a href="#h50-0-189" id="h50-0-189" class="i">+	smxx=\E[9m,
</a><a href="#h50-0-190" id="h50-0-190" class="i">+# tmux extensions, see TERMINFO EXTENSIONS in tmux(1)
</a><a href="#h50-0-191" id="h50-0-191" class="i">+	Se,
</a><a href="#h50-0-192" id="h50-0-192" class="i">+	Ss,
</a><a href="#h50-0-193" id="h50-0-193" class="i">+	Tc,
</a><a href="#h50-0-194" id="h50-0-194" class="i">+	Ms=\E]52;%p1%s;%p2%s\007,
</a><a href="#h50-0-195" id="h50-0-195" class="i">+
</a><a href="#h50-0-196" id="h50-0-196" class="i">+st-256color| simpleterm with 256 colors,
</a><a href="#h50-0-197" id="h50-0-197" class="i">+	use=st,
</a><a href="#h50-0-198" id="h50-0-198" class="i">+	ccc,
</a><a href="#h50-0-199" id="h50-0-199" class="i">+	colors#256,
</a><a href="#h50-0-200" id="h50-0-200" class="i">+	oc=\E]104\007,
</a><a href="#h50-0-201" id="h50-0-201" class="i">+	pairs#32767,
</a><a href="#h50-0-202" id="h50-0-202" class="i">+#	Nicked from xterm-256color
</a><a href="#h50-0-203" id="h50-0-203" class="i">+	initc=\E]4;%p1%d;rgb\:%p2%{255}%*%{1000}%/%2.2X/%p3%{255}%*%{1000}%/%2.2X/%p4%{255}%*%{1000}%/%2.2X\E\\,
</a><a href="#h50-0-204" id="h50-0-204" class="i">+	setab=\E[%?%p1%{8}%&lt;%t4%p1%d%e%p1%{16}%&lt;%t10%p1%{8}%-%d%e48;5;%p1%d%;m,
</a><a href="#h50-0-205" id="h50-0-205" class="i">+	setaf=\E[%?%p1%{8}%&lt;%t3%p1%d%e%p1%{16}%&lt;%t9%p1%{8}%-%d%e38;5;%p1%d%;m,
</a><a href="#h50-0-206" id="h50-0-206" class="i">+
</a><a href="#h50-0-207" id="h50-0-207" class="i">+st-meta| simpleterm with meta key,
</a><a href="#h50-0-208" id="h50-0-208" class="i">+	use=st,
</a><a href="#h50-0-209" id="h50-0-209" class="i">+	km,
</a><a href="#h50-0-210" id="h50-0-210" class="i">+	rmm=\E[?1034l,
</a><a href="#h50-0-211" id="h50-0-211" class="i">+	smm=\E[?1034h,
</a><a href="#h50-0-212" id="h50-0-212" class="i">+	rs2=\E[4l\E&gt;\E[?1034h,
</a><a href="#h50-0-213" id="h50-0-213" class="i">+	is2=\E[4l\E&gt;\E[?1034h,
</a><a href="#h50-0-214" id="h50-0-214" class="i">+
</a><a href="#h50-0-215" id="h50-0-215" class="i">+st-meta-256color| simpleterm with meta key and 256 colors,
</a><a href="#h50-0-216" id="h50-0-216" class="i">+	use=st-256color,
</a><a href="#h50-0-217" id="h50-0-217" class="i">+	km,
</a><a href="#h50-0-218" id="h50-0-218" class="i">+	rmm=\E[?1034l,
</a><a href="#h50-0-219" id="h50-0-219" class="i">+	smm=\E[?1034h,
</a><a href="#h50-0-220" id="h50-0-220" class="i">+	rs2=\E[4l\E&gt;\E[?1034h,
</a><a href="#h50-0-221" id="h50-0-221" class="i">+	is2=\E[4l\E&gt;\E[?1034h,
</a><b>diff --git a/<a id="h51" href="../file/st/st.o.html">st/st.o</a> b/<a href="../file/st/st.o.html">st/st.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h52" href="../file/st/win.h.html">st/win.h</a> b/<a href="../file/st/win.h.html">st/win.h</a></b>
<a href="#h52-0" id="h52-0" class="h">@@ -0,0 +1,39 @@
</a><a href="#h52-0-0" id="h52-0-0" class="i">+/* See LICENSE for license details. */
</a><a href="#h52-0-1" id="h52-0-1" class="i">+
</a><a href="#h52-0-2" id="h52-0-2" class="i">+enum win_mode {
</a><a href="#h52-0-3" id="h52-0-3" class="i">+	MODE_VISIBLE     = 1 &lt;&lt; 0,
</a><a href="#h52-0-4" id="h52-0-4" class="i">+	MODE_FOCUSED     = 1 &lt;&lt; 1,
</a><a href="#h52-0-5" id="h52-0-5" class="i">+	MODE_APPKEYPAD   = 1 &lt;&lt; 2,
</a><a href="#h52-0-6" id="h52-0-6" class="i">+	MODE_MOUSEBTN    = 1 &lt;&lt; 3,
</a><a href="#h52-0-7" id="h52-0-7" class="i">+	MODE_MOUSEMOTION = 1 &lt;&lt; 4,
</a><a href="#h52-0-8" id="h52-0-8" class="i">+	MODE_REVERSE     = 1 &lt;&lt; 5,
</a><a href="#h52-0-9" id="h52-0-9" class="i">+	MODE_KBDLOCK     = 1 &lt;&lt; 6,
</a><a href="#h52-0-10" id="h52-0-10" class="i">+	MODE_HIDE        = 1 &lt;&lt; 7,
</a><a href="#h52-0-11" id="h52-0-11" class="i">+	MODE_APPCURSOR   = 1 &lt;&lt; 8,
</a><a href="#h52-0-12" id="h52-0-12" class="i">+	MODE_MOUSESGR    = 1 &lt;&lt; 9,
</a><a href="#h52-0-13" id="h52-0-13" class="i">+	MODE_8BIT        = 1 &lt;&lt; 10,
</a><a href="#h52-0-14" id="h52-0-14" class="i">+	MODE_BLINK       = 1 &lt;&lt; 11,
</a><a href="#h52-0-15" id="h52-0-15" class="i">+	MODE_FBLINK      = 1 &lt;&lt; 12,
</a><a href="#h52-0-16" id="h52-0-16" class="i">+	MODE_FOCUS       = 1 &lt;&lt; 13,
</a><a href="#h52-0-17" id="h52-0-17" class="i">+	MODE_MOUSEX10    = 1 &lt;&lt; 14,
</a><a href="#h52-0-18" id="h52-0-18" class="i">+	MODE_MOUSEMANY   = 1 &lt;&lt; 15,
</a><a href="#h52-0-19" id="h52-0-19" class="i">+	MODE_BRCKTPASTE  = 1 &lt;&lt; 16,
</a><a href="#h52-0-20" id="h52-0-20" class="i">+	MODE_NUMLOCK     = 1 &lt;&lt; 17,
</a><a href="#h52-0-21" id="h52-0-21" class="i">+	MODE_MOUSE       = MODE_MOUSEBTN|MODE_MOUSEMOTION|MODE_MOUSEX10\
</a><a href="#h52-0-22" id="h52-0-22" class="i">+	                  |MODE_MOUSEMANY,
</a><a href="#h52-0-23" id="h52-0-23" class="i">+};
</a><a href="#h52-0-24" id="h52-0-24" class="i">+
</a><a href="#h52-0-25" id="h52-0-25" class="i">+void xbell(void);
</a><a href="#h52-0-26" id="h52-0-26" class="i">+void xclipcopy(void);
</a><a href="#h52-0-27" id="h52-0-27" class="i">+void xdrawcursor(int, int, Glyph, int, int, Glyph);
</a><a href="#h52-0-28" id="h52-0-28" class="i">+void xdrawline(Line, int, int, int);
</a><a href="#h52-0-29" id="h52-0-29" class="i">+void xfinishdraw(void);
</a><a href="#h52-0-30" id="h52-0-30" class="i">+void xloadcols(void);
</a><a href="#h52-0-31" id="h52-0-31" class="i">+int xsetcolorname(int, const char *);
</a><a href="#h52-0-32" id="h52-0-32" class="i">+void xsettitle(char *);
</a><a href="#h52-0-33" id="h52-0-33" class="i">+int xsetcursor(int);
</a><a href="#h52-0-34" id="h52-0-34" class="i">+void xsetmode(int, unsigned int);
</a><a href="#h52-0-35" id="h52-0-35" class="i">+void xsetpointermotion(int);
</a><a href="#h52-0-36" id="h52-0-36" class="i">+void xsetsel(char *);
</a><a href="#h52-0-37" id="h52-0-37" class="i">+int xstartdraw(void);
</a><a href="#h52-0-38" id="h52-0-38" class="i">+void xximspot(int, int);
</a><b>diff --git a/<a id="h53" href="../file/st/x.c.html">st/x.c</a> b/<a href="../file/st/x.c.html">st/x.c</a></b>
<a href="#h53-0" id="h53-0" class="h">@@ -0,0 +1,2080 @@
</a><a href="#h53-0-0" id="h53-0-0" class="i">+/* See LICENSE for license details. */
</a><a href="#h53-0-1" id="h53-0-1" class="i">+#include &lt;errno.h&gt;
</a><a href="#h53-0-2" id="h53-0-2" class="i">+#include &lt;math.h&gt;
</a><a href="#h53-0-3" id="h53-0-3" class="i">+#include &lt;limits.h&gt;
</a><a href="#h53-0-4" id="h53-0-4" class="i">+#include &lt;locale.h&gt;
</a><a href="#h53-0-5" id="h53-0-5" class="i">+#include &lt;signal.h&gt;
</a><a href="#h53-0-6" id="h53-0-6" class="i">+#include &lt;sys/select.h&gt;
</a><a href="#h53-0-7" id="h53-0-7" class="i">+#include &lt;time.h&gt;
</a><a href="#h53-0-8" id="h53-0-8" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h53-0-9" id="h53-0-9" class="i">+#include &lt;libgen.h&gt;
</a><a href="#h53-0-10" id="h53-0-10" class="i">+#include &lt;X11/Xatom.h&gt;
</a><a href="#h53-0-11" id="h53-0-11" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h53-0-12" id="h53-0-12" class="i">+#include &lt;X11/cursorfont.h&gt;
</a><a href="#h53-0-13" id="h53-0-13" class="i">+#include &lt;X11/keysym.h&gt;
</a><a href="#h53-0-14" id="h53-0-14" class="i">+#include &lt;X11/Xft/Xft.h&gt;
</a><a href="#h53-0-15" id="h53-0-15" class="i">+#include &lt;X11/XKBlib.h&gt;
</a><a href="#h53-0-16" id="h53-0-16" class="i">+
</a><a href="#h53-0-17" id="h53-0-17" class="i">+static char *argv0;
</a><a href="#h53-0-18" id="h53-0-18" class="i">+#include &quot;arg.h&quot;
</a><a href="#h53-0-19" id="h53-0-19" class="i">+#include &quot;st.h&quot;
</a><a href="#h53-0-20" id="h53-0-20" class="i">+#include &quot;win.h&quot;
</a><a href="#h53-0-21" id="h53-0-21" class="i">+
</a><a href="#h53-0-22" id="h53-0-22" class="i">+/* types used in config.h */
</a><a href="#h53-0-23" id="h53-0-23" class="i">+typedef struct {
</a><a href="#h53-0-24" id="h53-0-24" class="i">+	uint mod;
</a><a href="#h53-0-25" id="h53-0-25" class="i">+	KeySym keysym;
</a><a href="#h53-0-26" id="h53-0-26" class="i">+	void (*func)(const Arg *);
</a><a href="#h53-0-27" id="h53-0-27" class="i">+	const Arg arg;
</a><a href="#h53-0-28" id="h53-0-28" class="i">+} Shortcut;
</a><a href="#h53-0-29" id="h53-0-29" class="i">+
</a><a href="#h53-0-30" id="h53-0-30" class="i">+typedef struct {
</a><a href="#h53-0-31" id="h53-0-31" class="i">+	uint b;
</a><a href="#h53-0-32" id="h53-0-32" class="i">+	uint mask;
</a><a href="#h53-0-33" id="h53-0-33" class="i">+	char *s;
</a><a href="#h53-0-34" id="h53-0-34" class="i">+} MouseShortcut;
</a><a href="#h53-0-35" id="h53-0-35" class="i">+
</a><a href="#h53-0-36" id="h53-0-36" class="i">+typedef struct {
</a><a href="#h53-0-37" id="h53-0-37" class="i">+	KeySym k;
</a><a href="#h53-0-38" id="h53-0-38" class="i">+	uint mask;
</a><a href="#h53-0-39" id="h53-0-39" class="i">+	char *s;
</a><a href="#h53-0-40" id="h53-0-40" class="i">+	/* three-valued logic variables: 0 indifferent, 1 on, -1 off */
</a><a href="#h53-0-41" id="h53-0-41" class="i">+	signed char appkey;    /* application keypad */
</a><a href="#h53-0-42" id="h53-0-42" class="i">+	signed char appcursor; /* application cursor */
</a><a href="#h53-0-43" id="h53-0-43" class="i">+} Key;
</a><a href="#h53-0-44" id="h53-0-44" class="i">+
</a><a href="#h53-0-45" id="h53-0-45" class="i">+/* X modifiers */
</a><a href="#h53-0-46" id="h53-0-46" class="i">+#define XK_ANY_MOD    UINT_MAX
</a><a href="#h53-0-47" id="h53-0-47" class="i">+#define XK_NO_MOD     0
</a><a href="#h53-0-48" id="h53-0-48" class="i">+#define XK_SWITCH_MOD (1&lt;&lt;13)
</a><a href="#h53-0-49" id="h53-0-49" class="i">+
</a><a href="#h53-0-50" id="h53-0-50" class="i">+/* alpha */
</a><a href="#h53-0-51" id="h53-0-51" class="i">+#define OPAQUE 0Xff
</a><a href="#h53-0-52" id="h53-0-52" class="i">+#define USE_ARGB (alpha != OPAQUE &amp;&amp; opt_embed == NULL)
</a><a href="#h53-0-53" id="h53-0-53" class="i">+
</a><a href="#h53-0-54" id="h53-0-54" class="i">+/* function definitions used in config.h */
</a><a href="#h53-0-55" id="h53-0-55" class="i">+static void clipcopy(const Arg *);
</a><a href="#h53-0-56" id="h53-0-56" class="i">+static void clippaste(const Arg *);
</a><a href="#h53-0-57" id="h53-0-57" class="i">+static void numlock(const Arg *);
</a><a href="#h53-0-58" id="h53-0-58" class="i">+static void selpaste(const Arg *);
</a><a href="#h53-0-59" id="h53-0-59" class="i">+static void zoom(const Arg *);
</a><a href="#h53-0-60" id="h53-0-60" class="i">+static void zoomabs(const Arg *);
</a><a href="#h53-0-61" id="h53-0-61" class="i">+static void zoomreset(const Arg *);
</a><a href="#h53-0-62" id="h53-0-62" class="i">+
</a><a href="#h53-0-63" id="h53-0-63" class="i">+/* config.h for applying patches and the configuration. */
</a><a href="#h53-0-64" id="h53-0-64" class="i">+#include &quot;config.h&quot;
</a><a href="#h53-0-65" id="h53-0-65" class="i">+
</a><a href="#h53-0-66" id="h53-0-66" class="i">+/* XEMBED messages */
</a><a href="#h53-0-67" id="h53-0-67" class="i">+#define XEMBED_FOCUS_IN  4
</a><a href="#h53-0-68" id="h53-0-68" class="i">+#define XEMBED_FOCUS_OUT 5
</a><a href="#h53-0-69" id="h53-0-69" class="i">+
</a><a href="#h53-0-70" id="h53-0-70" class="i">+/* macros */
</a><a href="#h53-0-71" id="h53-0-71" class="i">+#define IS_SET(flag)		((win.mode &amp; (flag)) != 0)
</a><a href="#h53-0-72" id="h53-0-72" class="i">+#define TRUERED(x)		(((x) &amp; 0xff0000) &gt;&gt; 8)
</a><a href="#h53-0-73" id="h53-0-73" class="i">+#define TRUEGREEN(x)		(((x) &amp; 0xff00))
</a><a href="#h53-0-74" id="h53-0-74" class="i">+#define TRUEBLUE(x)		(((x) &amp; 0xff) &lt;&lt; 8)
</a><a href="#h53-0-75" id="h53-0-75" class="i">+
</a><a href="#h53-0-76" id="h53-0-76" class="i">+typedef XftDraw *Draw;
</a><a href="#h53-0-77" id="h53-0-77" class="i">+typedef XftColor Color;
</a><a href="#h53-0-78" id="h53-0-78" class="i">+typedef XftGlyphFontSpec GlyphFontSpec;
</a><a href="#h53-0-79" id="h53-0-79" class="i">+
</a><a href="#h53-0-80" id="h53-0-80" class="i">+/* Purely graphic info */
</a><a href="#h53-0-81" id="h53-0-81" class="i">+typedef struct {
</a><a href="#h53-0-82" id="h53-0-82" class="i">+	int tw, th; /* tty width and height */
</a><a href="#h53-0-83" id="h53-0-83" class="i">+	int w, h; /* window width and height */
</a><a href="#h53-0-84" id="h53-0-84" class="i">+	int hborderpx, vborderpx;
</a><a href="#h53-0-85" id="h53-0-85" class="i">+	int ch; /* char height */
</a><a href="#h53-0-86" id="h53-0-86" class="i">+	int cw; /* char width  */
</a><a href="#h53-0-87" id="h53-0-87" class="i">+	int mode; /* window state/mode flags */
</a><a href="#h53-0-88" id="h53-0-88" class="i">+	int cursor; /* cursor style */
</a><a href="#h53-0-89" id="h53-0-89" class="i">+} TermWindow;
</a><a href="#h53-0-90" id="h53-0-90" class="i">+
</a><a href="#h53-0-91" id="h53-0-91" class="i">+typedef struct {
</a><a href="#h53-0-92" id="h53-0-92" class="i">+	Display *dpy;
</a><a href="#h53-0-93" id="h53-0-93" class="i">+	Colormap cmap;
</a><a href="#h53-0-94" id="h53-0-94" class="i">+	Window win;
</a><a href="#h53-0-95" id="h53-0-95" class="i">+	Drawable buf;
</a><a href="#h53-0-96" id="h53-0-96" class="i">+	GlyphFontSpec *specbuf; /* font spec buffer used for rendering */
</a><a href="#h53-0-97" id="h53-0-97" class="i">+	Atom xembed, wmdeletewin, netwmname, netwmpid;
</a><a href="#h53-0-98" id="h53-0-98" class="i">+	XIM xim;
</a><a href="#h53-0-99" id="h53-0-99" class="i">+	XIC xic;
</a><a href="#h53-0-100" id="h53-0-100" class="i">+	Draw draw;
</a><a href="#h53-0-101" id="h53-0-101" class="i">+	Visual *vis;
</a><a href="#h53-0-102" id="h53-0-102" class="i">+	XSetWindowAttributes attrs;
</a><a href="#h53-0-103" id="h53-0-103" class="i">+	/* Here, we use the term *pointer* to differentiate the cursor
</a><a href="#h53-0-104" id="h53-0-104" class="i">+	 * one sees when hovering the mouse over the terminal from, e.g.,
</a><a href="#h53-0-105" id="h53-0-105" class="i">+	 * a green rectangle where text would be entered. */
</a><a href="#h53-0-106" id="h53-0-106" class="i">+	Cursor vpointer, bpointer; /* visible and hidden pointers */
</a><a href="#h53-0-107" id="h53-0-107" class="i">+	int pointerisvisible;
</a><a href="#h53-0-108" id="h53-0-108" class="i">+	int scr;
</a><a href="#h53-0-109" id="h53-0-109" class="i">+	int isfixed; /* is fixed geometry? */
</a><a href="#h53-0-110" id="h53-0-110" class="i">+	int depth; /* bit depth */
</a><a href="#h53-0-111" id="h53-0-111" class="i">+	int l, t; /* left and top offset */
</a><a href="#h53-0-112" id="h53-0-112" class="i">+	int gm; /* geometry mask */
</a><a href="#h53-0-113" id="h53-0-113" class="i">+} XWindow;
</a><a href="#h53-0-114" id="h53-0-114" class="i">+
</a><a href="#h53-0-115" id="h53-0-115" class="i">+typedef struct {
</a><a href="#h53-0-116" id="h53-0-116" class="i">+	Atom xtarget;
</a><a href="#h53-0-117" id="h53-0-117" class="i">+	char *primary, *clipboard;
</a><a href="#h53-0-118" id="h53-0-118" class="i">+	struct timespec tclick1;
</a><a href="#h53-0-119" id="h53-0-119" class="i">+	struct timespec tclick2;
</a><a href="#h53-0-120" id="h53-0-120" class="i">+} XSelection;
</a><a href="#h53-0-121" id="h53-0-121" class="i">+
</a><a href="#h53-0-122" id="h53-0-122" class="i">+/* Font structure */
</a><a href="#h53-0-123" id="h53-0-123" class="i">+#define Font Font_
</a><a href="#h53-0-124" id="h53-0-124" class="i">+typedef struct {
</a><a href="#h53-0-125" id="h53-0-125" class="i">+	int height;
</a><a href="#h53-0-126" id="h53-0-126" class="i">+	int width;
</a><a href="#h53-0-127" id="h53-0-127" class="i">+	int ascent;
</a><a href="#h53-0-128" id="h53-0-128" class="i">+	int descent;
</a><a href="#h53-0-129" id="h53-0-129" class="i">+	int badslant;
</a><a href="#h53-0-130" id="h53-0-130" class="i">+	int badweight;
</a><a href="#h53-0-131" id="h53-0-131" class="i">+	short lbearing;
</a><a href="#h53-0-132" id="h53-0-132" class="i">+	short rbearing;
</a><a href="#h53-0-133" id="h53-0-133" class="i">+	XftFont *match;
</a><a href="#h53-0-134" id="h53-0-134" class="i">+	FcFontSet *set;
</a><a href="#h53-0-135" id="h53-0-135" class="i">+	FcPattern *pattern;
</a><a href="#h53-0-136" id="h53-0-136" class="i">+} Font;
</a><a href="#h53-0-137" id="h53-0-137" class="i">+
</a><a href="#h53-0-138" id="h53-0-138" class="i">+/* Drawing Context */
</a><a href="#h53-0-139" id="h53-0-139" class="i">+typedef struct {
</a><a href="#h53-0-140" id="h53-0-140" class="i">+	Color *col;
</a><a href="#h53-0-141" id="h53-0-141" class="i">+	size_t collen;
</a><a href="#h53-0-142" id="h53-0-142" class="i">+	Font font, bfont, ifont, ibfont;
</a><a href="#h53-0-143" id="h53-0-143" class="i">+	GC gc;
</a><a href="#h53-0-144" id="h53-0-144" class="i">+} DC;
</a><a href="#h53-0-145" id="h53-0-145" class="i">+
</a><a href="#h53-0-146" id="h53-0-146" class="i">+static inline ushort sixd_to_16bit(int);
</a><a href="#h53-0-147" id="h53-0-147" class="i">+static int xmakeglyphfontspecs(XftGlyphFontSpec *, const Glyph *, int, int, int);
</a><a href="#h53-0-148" id="h53-0-148" class="i">+static void xdrawglyphfontspecs(const XftGlyphFontSpec *, Glyph, int, int, int);
</a><a href="#h53-0-149" id="h53-0-149" class="i">+static void xdrawglyph(Glyph, int, int);
</a><a href="#h53-0-150" id="h53-0-150" class="i">+static void xclear(int, int, int, int);
</a><a href="#h53-0-151" id="h53-0-151" class="i">+static int xgeommasktogravity(int);
</a><a href="#h53-0-152" id="h53-0-152" class="i">+static void ximopen(Display *);
</a><a href="#h53-0-153" id="h53-0-153" class="i">+static void ximinstantiate(Display *, XPointer, XPointer);
</a><a href="#h53-0-154" id="h53-0-154" class="i">+static void ximdestroy(XIM, XPointer, XPointer);
</a><a href="#h53-0-155" id="h53-0-155" class="i">+static void xinit(int, int);
</a><a href="#h53-0-156" id="h53-0-156" class="i">+static void cresize(int, int);
</a><a href="#h53-0-157" id="h53-0-157" class="i">+static void xresize(int, int);
</a><a href="#h53-0-158" id="h53-0-158" class="i">+static void xhints(void);
</a><a href="#h53-0-159" id="h53-0-159" class="i">+static int xloadcolor(int, const char *, Color *);
</a><a href="#h53-0-160" id="h53-0-160" class="i">+static int xloadfont(Font *, FcPattern *);
</a><a href="#h53-0-161" id="h53-0-161" class="i">+static void xloadfonts(char *, double);
</a><a href="#h53-0-162" id="h53-0-162" class="i">+static void xunloadfont(Font *);
</a><a href="#h53-0-163" id="h53-0-163" class="i">+static void xunloadfonts(void);
</a><a href="#h53-0-164" id="h53-0-164" class="i">+static void xsetenv(void);
</a><a href="#h53-0-165" id="h53-0-165" class="i">+static void xseturgency(int);
</a><a href="#h53-0-166" id="h53-0-166" class="i">+static int evcol(XEvent *);
</a><a href="#h53-0-167" id="h53-0-167" class="i">+static int evrow(XEvent *);
</a><a href="#h53-0-168" id="h53-0-168" class="i">+
</a><a href="#h53-0-169" id="h53-0-169" class="i">+static void expose(XEvent *);
</a><a href="#h53-0-170" id="h53-0-170" class="i">+static void visibility(XEvent *);
</a><a href="#h53-0-171" id="h53-0-171" class="i">+static void unmap(XEvent *);
</a><a href="#h53-0-172" id="h53-0-172" class="i">+static void kpress(XEvent *);
</a><a href="#h53-0-173" id="h53-0-173" class="i">+static void cmessage(XEvent *);
</a><a href="#h53-0-174" id="h53-0-174" class="i">+static void resize(XEvent *);
</a><a href="#h53-0-175" id="h53-0-175" class="i">+static void focus(XEvent *);
</a><a href="#h53-0-176" id="h53-0-176" class="i">+static void brelease(XEvent *);
</a><a href="#h53-0-177" id="h53-0-177" class="i">+static void bpress(XEvent *);
</a><a href="#h53-0-178" id="h53-0-178" class="i">+static void bmotion(XEvent *);
</a><a href="#h53-0-179" id="h53-0-179" class="i">+static void propnotify(XEvent *);
</a><a href="#h53-0-180" id="h53-0-180" class="i">+static void selnotify(XEvent *);
</a><a href="#h53-0-181" id="h53-0-181" class="i">+static void selclear_(XEvent *);
</a><a href="#h53-0-182" id="h53-0-182" class="i">+static void selrequest(XEvent *);
</a><a href="#h53-0-183" id="h53-0-183" class="i">+static void setsel(char *, Time);
</a><a href="#h53-0-184" id="h53-0-184" class="i">+static void mousesel(XEvent *, int);
</a><a href="#h53-0-185" id="h53-0-185" class="i">+static void mousereport(XEvent *);
</a><a href="#h53-0-186" id="h53-0-186" class="i">+static char *kmap(KeySym, uint);
</a><a href="#h53-0-187" id="h53-0-187" class="i">+static int match(uint, uint);
</a><a href="#h53-0-188" id="h53-0-188" class="i">+
</a><a href="#h53-0-189" id="h53-0-189" class="i">+static void run(void);
</a><a href="#h53-0-190" id="h53-0-190" class="i">+static void usage(void);
</a><a href="#h53-0-191" id="h53-0-191" class="i">+
</a><a href="#h53-0-192" id="h53-0-192" class="i">+static void (*handler[LASTEvent])(XEvent *) = {
</a><a href="#h53-0-193" id="h53-0-193" class="i">+	[KeyPress] = kpress,
</a><a href="#h53-0-194" id="h53-0-194" class="i">+	[ClientMessage] = cmessage,
</a><a href="#h53-0-195" id="h53-0-195" class="i">+	[ConfigureNotify] = resize,
</a><a href="#h53-0-196" id="h53-0-196" class="i">+	[VisibilityNotify] = visibility,
</a><a href="#h53-0-197" id="h53-0-197" class="i">+	[UnmapNotify] = unmap,
</a><a href="#h53-0-198" id="h53-0-198" class="i">+	[Expose] = expose,
</a><a href="#h53-0-199" id="h53-0-199" class="i">+	[FocusIn] = focus,
</a><a href="#h53-0-200" id="h53-0-200" class="i">+	[FocusOut] = focus,
</a><a href="#h53-0-201" id="h53-0-201" class="i">+	[MotionNotify] = bmotion,
</a><a href="#h53-0-202" id="h53-0-202" class="i">+	[ButtonPress] = bpress,
</a><a href="#h53-0-203" id="h53-0-203" class="i">+	[ButtonRelease] = brelease,
</a><a href="#h53-0-204" id="h53-0-204" class="i">+/*
</a><a href="#h53-0-205" id="h53-0-205" class="i">+ * Uncomment if you want the selection to disappear when you select something
</a><a href="#h53-0-206" id="h53-0-206" class="i">+ * different in another window.
</a><a href="#h53-0-207" id="h53-0-207" class="i">+ */
</a><a href="#h53-0-208" id="h53-0-208" class="i">+/*	[SelectionClear] = selclear_, */
</a><a href="#h53-0-209" id="h53-0-209" class="i">+	[SelectionNotify] = selnotify,
</a><a href="#h53-0-210" id="h53-0-210" class="i">+/*
</a><a href="#h53-0-211" id="h53-0-211" class="i">+ * PropertyNotify is only turned on when there is some INCR transfer happening
</a><a href="#h53-0-212" id="h53-0-212" class="i">+ * for the selection retrieval.
</a><a href="#h53-0-213" id="h53-0-213" class="i">+ */
</a><a href="#h53-0-214" id="h53-0-214" class="i">+	[PropertyNotify] = propnotify,
</a><a href="#h53-0-215" id="h53-0-215" class="i">+	[SelectionRequest] = selrequest,
</a><a href="#h53-0-216" id="h53-0-216" class="i">+};
</a><a href="#h53-0-217" id="h53-0-217" class="i">+
</a><a href="#h53-0-218" id="h53-0-218" class="i">+/* Globals */
</a><a href="#h53-0-219" id="h53-0-219" class="i">+static DC dc;
</a><a href="#h53-0-220" id="h53-0-220" class="i">+static XWindow xw;
</a><a href="#h53-0-221" id="h53-0-221" class="i">+static XSelection xsel;
</a><a href="#h53-0-222" id="h53-0-222" class="i">+static TermWindow win;
</a><a href="#h53-0-223" id="h53-0-223" class="i">+
</a><a href="#h53-0-224" id="h53-0-224" class="i">+/* Font Ring Cache */
</a><a href="#h53-0-225" id="h53-0-225" class="i">+enum {
</a><a href="#h53-0-226" id="h53-0-226" class="i">+	FRC_NORMAL,
</a><a href="#h53-0-227" id="h53-0-227" class="i">+	FRC_ITALIC,
</a><a href="#h53-0-228" id="h53-0-228" class="i">+	FRC_BOLD,
</a><a href="#h53-0-229" id="h53-0-229" class="i">+	FRC_ITALICBOLD
</a><a href="#h53-0-230" id="h53-0-230" class="i">+};
</a><a href="#h53-0-231" id="h53-0-231" class="i">+
</a><a href="#h53-0-232" id="h53-0-232" class="i">+typedef struct {
</a><a href="#h53-0-233" id="h53-0-233" class="i">+	XftFont *font;
</a><a href="#h53-0-234" id="h53-0-234" class="i">+	int flags;
</a><a href="#h53-0-235" id="h53-0-235" class="i">+	Rune unicodep;
</a><a href="#h53-0-236" id="h53-0-236" class="i">+} Fontcache;
</a><a href="#h53-0-237" id="h53-0-237" class="i">+
</a><a href="#h53-0-238" id="h53-0-238" class="i">+/* Fontcache is an array now. A new font will be appended to the array. */
</a><a href="#h53-0-239" id="h53-0-239" class="i">+static Fontcache frc[16];
</a><a href="#h53-0-240" id="h53-0-240" class="i">+static int frclen = 0;
</a><a href="#h53-0-241" id="h53-0-241" class="i">+static char *usedfont = NULL;
</a><a href="#h53-0-242" id="h53-0-242" class="i">+static double usedfontsize = 0;
</a><a href="#h53-0-243" id="h53-0-243" class="i">+static double defaultfontsize = 0;
</a><a href="#h53-0-244" id="h53-0-244" class="i">+
</a><a href="#h53-0-245" id="h53-0-245" class="i">+static char *opt_class = NULL;
</a><a href="#h53-0-246" id="h53-0-246" class="i">+static char **opt_cmd  = NULL;
</a><a href="#h53-0-247" id="h53-0-247" class="i">+static char *opt_embed = NULL;
</a><a href="#h53-0-248" id="h53-0-248" class="i">+static char *opt_font  = NULL;
</a><a href="#h53-0-249" id="h53-0-249" class="i">+static char *opt_io    = NULL;
</a><a href="#h53-0-250" id="h53-0-250" class="i">+static char *opt_line  = NULL;
</a><a href="#h53-0-251" id="h53-0-251" class="i">+static char *opt_name  = NULL;
</a><a href="#h53-0-252" id="h53-0-252" class="i">+static char *opt_title = NULL;
</a><a href="#h53-0-253" id="h53-0-253" class="i">+
</a><a href="#h53-0-254" id="h53-0-254" class="i">+static int oldbutton = 3; /* button event on startup: 3 = release */
</a><a href="#h53-0-255" id="h53-0-255" class="i">+
</a><a href="#h53-0-256" id="h53-0-256" class="i">+void
</a><a href="#h53-0-257" id="h53-0-257" class="i">+clipcopy(const Arg *dummy)
</a><a href="#h53-0-258" id="h53-0-258" class="i">+{
</a><a href="#h53-0-259" id="h53-0-259" class="i">+	Atom clipboard;
</a><a href="#h53-0-260" id="h53-0-260" class="i">+
</a><a href="#h53-0-261" id="h53-0-261" class="i">+	free(xsel.clipboard);
</a><a href="#h53-0-262" id="h53-0-262" class="i">+	xsel.clipboard = NULL;
</a><a href="#h53-0-263" id="h53-0-263" class="i">+
</a><a href="#h53-0-264" id="h53-0-264" class="i">+	if (xsel.primary != NULL) {
</a><a href="#h53-0-265" id="h53-0-265" class="i">+		xsel.clipboard = xstrdup(xsel.primary);
</a><a href="#h53-0-266" id="h53-0-266" class="i">+		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h53-0-267" id="h53-0-267" class="i">+		XSetSelectionOwner(xw.dpy, clipboard, xw.win, CurrentTime);
</a><a href="#h53-0-268" id="h53-0-268" class="i">+	}
</a><a href="#h53-0-269" id="h53-0-269" class="i">+}
</a><a href="#h53-0-270" id="h53-0-270" class="i">+
</a><a href="#h53-0-271" id="h53-0-271" class="i">+void
</a><a href="#h53-0-272" id="h53-0-272" class="i">+clippaste(const Arg *dummy)
</a><a href="#h53-0-273" id="h53-0-273" class="i">+{
</a><a href="#h53-0-274" id="h53-0-274" class="i">+	Atom clipboard;
</a><a href="#h53-0-275" id="h53-0-275" class="i">+
</a><a href="#h53-0-276" id="h53-0-276" class="i">+	clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h53-0-277" id="h53-0-277" class="i">+	XConvertSelection(xw.dpy, clipboard, xsel.xtarget, clipboard,
</a><a href="#h53-0-278" id="h53-0-278" class="i">+			xw.win, CurrentTime);
</a><a href="#h53-0-279" id="h53-0-279" class="i">+}
</a><a href="#h53-0-280" id="h53-0-280" class="i">+
</a><a href="#h53-0-281" id="h53-0-281" class="i">+void
</a><a href="#h53-0-282" id="h53-0-282" class="i">+selpaste(const Arg *dummy)
</a><a href="#h53-0-283" id="h53-0-283" class="i">+{
</a><a href="#h53-0-284" id="h53-0-284" class="i">+	XConvertSelection(xw.dpy, XA_PRIMARY, xsel.xtarget, XA_PRIMARY,
</a><a href="#h53-0-285" id="h53-0-285" class="i">+			xw.win, CurrentTime);
</a><a href="#h53-0-286" id="h53-0-286" class="i">+}
</a><a href="#h53-0-287" id="h53-0-287" class="i">+
</a><a href="#h53-0-288" id="h53-0-288" class="i">+void
</a><a href="#h53-0-289" id="h53-0-289" class="i">+numlock(const Arg *dummy)
</a><a href="#h53-0-290" id="h53-0-290" class="i">+{
</a><a href="#h53-0-291" id="h53-0-291" class="i">+	win.mode ^= MODE_NUMLOCK;
</a><a href="#h53-0-292" id="h53-0-292" class="i">+}
</a><a href="#h53-0-293" id="h53-0-293" class="i">+
</a><a href="#h53-0-294" id="h53-0-294" class="i">+void
</a><a href="#h53-0-295" id="h53-0-295" class="i">+zoom(const Arg *arg)
</a><a href="#h53-0-296" id="h53-0-296" class="i">+{
</a><a href="#h53-0-297" id="h53-0-297" class="i">+	Arg larg;
</a><a href="#h53-0-298" id="h53-0-298" class="i">+
</a><a href="#h53-0-299" id="h53-0-299" class="i">+	larg.f = usedfontsize + arg-&gt;f;
</a><a href="#h53-0-300" id="h53-0-300" class="i">+	zoomabs(&amp;larg);
</a><a href="#h53-0-301" id="h53-0-301" class="i">+}
</a><a href="#h53-0-302" id="h53-0-302" class="i">+
</a><a href="#h53-0-303" id="h53-0-303" class="i">+void
</a><a href="#h53-0-304" id="h53-0-304" class="i">+zoomabs(const Arg *arg)
</a><a href="#h53-0-305" id="h53-0-305" class="i">+{
</a><a href="#h53-0-306" id="h53-0-306" class="i">+	xunloadfonts();
</a><a href="#h53-0-307" id="h53-0-307" class="i">+	xloadfonts(usedfont, arg-&gt;f);
</a><a href="#h53-0-308" id="h53-0-308" class="i">+	cresize(0, 0);
</a><a href="#h53-0-309" id="h53-0-309" class="i">+	redraw();
</a><a href="#h53-0-310" id="h53-0-310" class="i">+	xhints();
</a><a href="#h53-0-311" id="h53-0-311" class="i">+}
</a><a href="#h53-0-312" id="h53-0-312" class="i">+
</a><a href="#h53-0-313" id="h53-0-313" class="i">+void
</a><a href="#h53-0-314" id="h53-0-314" class="i">+zoomreset(const Arg *arg)
</a><a href="#h53-0-315" id="h53-0-315" class="i">+{
</a><a href="#h53-0-316" id="h53-0-316" class="i">+	Arg larg;
</a><a href="#h53-0-317" id="h53-0-317" class="i">+
</a><a href="#h53-0-318" id="h53-0-318" class="i">+	if (defaultfontsize &gt; 0) {
</a><a href="#h53-0-319" id="h53-0-319" class="i">+		larg.f = defaultfontsize;
</a><a href="#h53-0-320" id="h53-0-320" class="i">+		zoomabs(&amp;larg);
</a><a href="#h53-0-321" id="h53-0-321" class="i">+	}
</a><a href="#h53-0-322" id="h53-0-322" class="i">+}
</a><a href="#h53-0-323" id="h53-0-323" class="i">+
</a><a href="#h53-0-324" id="h53-0-324" class="i">+int
</a><a href="#h53-0-325" id="h53-0-325" class="i">+evcol(XEvent *e)
</a><a href="#h53-0-326" id="h53-0-326" class="i">+{
</a><a href="#h53-0-327" id="h53-0-327" class="i">+	int x = e-&gt;xbutton.x - win.hborderpx;
</a><a href="#h53-0-328" id="h53-0-328" class="i">+	LIMIT(x, 0, win.tw - 1);
</a><a href="#h53-0-329" id="h53-0-329" class="i">+	return x / win.cw;
</a><a href="#h53-0-330" id="h53-0-330" class="i">+}
</a><a href="#h53-0-331" id="h53-0-331" class="i">+
</a><a href="#h53-0-332" id="h53-0-332" class="i">+int
</a><a href="#h53-0-333" id="h53-0-333" class="i">+evrow(XEvent *e)
</a><a href="#h53-0-334" id="h53-0-334" class="i">+{
</a><a href="#h53-0-335" id="h53-0-335" class="i">+	int y = e-&gt;xbutton.y - win.vborderpx;
</a><a href="#h53-0-336" id="h53-0-336" class="i">+	LIMIT(y, 0, win.th - 1);
</a><a href="#h53-0-337" id="h53-0-337" class="i">+	return y / win.ch;
</a><a href="#h53-0-338" id="h53-0-338" class="i">+}
</a><a href="#h53-0-339" id="h53-0-339" class="i">+
</a><a href="#h53-0-340" id="h53-0-340" class="i">+void
</a><a href="#h53-0-341" id="h53-0-341" class="i">+mousesel(XEvent *e, int done)
</a><a href="#h53-0-342" id="h53-0-342" class="i">+{
</a><a href="#h53-0-343" id="h53-0-343" class="i">+	int type, seltype = SEL_REGULAR;
</a><a href="#h53-0-344" id="h53-0-344" class="i">+	uint state = e-&gt;xbutton.state &amp; ~(Button1Mask | forceselmod);
</a><a href="#h53-0-345" id="h53-0-345" class="i">+
</a><a href="#h53-0-346" id="h53-0-346" class="i">+	for (type = 1; type &lt; LEN(selmasks); ++type) {
</a><a href="#h53-0-347" id="h53-0-347" class="i">+		if (match(selmasks[type], state)) {
</a><a href="#h53-0-348" id="h53-0-348" class="i">+			seltype = type;
</a><a href="#h53-0-349" id="h53-0-349" class="i">+			break;
</a><a href="#h53-0-350" id="h53-0-350" class="i">+		}
</a><a href="#h53-0-351" id="h53-0-351" class="i">+	}
</a><a href="#h53-0-352" id="h53-0-352" class="i">+	selextend(evcol(e), evrow(e), seltype, done);
</a><a href="#h53-0-353" id="h53-0-353" class="i">+	if (done)
</a><a href="#h53-0-354" id="h53-0-354" class="i">+		setsel(getsel(), e-&gt;xbutton.time);
</a><a href="#h53-0-355" id="h53-0-355" class="i">+}
</a><a href="#h53-0-356" id="h53-0-356" class="i">+
</a><a href="#h53-0-357" id="h53-0-357" class="i">+void
</a><a href="#h53-0-358" id="h53-0-358" class="i">+mousereport(XEvent *e)
</a><a href="#h53-0-359" id="h53-0-359" class="i">+{
</a><a href="#h53-0-360" id="h53-0-360" class="i">+	int len, x = evcol(e), y = evrow(e),
</a><a href="#h53-0-361" id="h53-0-361" class="i">+	    button = e-&gt;xbutton.button, state = e-&gt;xbutton.state;
</a><a href="#h53-0-362" id="h53-0-362" class="i">+	char buf[40];
</a><a href="#h53-0-363" id="h53-0-363" class="i">+	static int ox, oy;
</a><a href="#h53-0-364" id="h53-0-364" class="i">+
</a><a href="#h53-0-365" id="h53-0-365" class="i">+	/* from urxvt */
</a><a href="#h53-0-366" id="h53-0-366" class="i">+	if (e-&gt;xbutton.type == MotionNotify) {
</a><a href="#h53-0-367" id="h53-0-367" class="i">+		if (x == ox &amp;&amp; y == oy)
</a><a href="#h53-0-368" id="h53-0-368" class="i">+			return;
</a><a href="#h53-0-369" id="h53-0-369" class="i">+		if (!IS_SET(MODE_MOUSEMOTION) &amp;&amp; !IS_SET(MODE_MOUSEMANY))
</a><a href="#h53-0-370" id="h53-0-370" class="i">+			return;
</a><a href="#h53-0-371" id="h53-0-371" class="i">+		/* MOUSE_MOTION: no reporting if no button is pressed */
</a><a href="#h53-0-372" id="h53-0-372" class="i">+		if (IS_SET(MODE_MOUSEMOTION) &amp;&amp; oldbutton == 3)
</a><a href="#h53-0-373" id="h53-0-373" class="i">+			return;
</a><a href="#h53-0-374" id="h53-0-374" class="i">+
</a><a href="#h53-0-375" id="h53-0-375" class="i">+		button = oldbutton + 32;
</a><a href="#h53-0-376" id="h53-0-376" class="i">+		ox = x;
</a><a href="#h53-0-377" id="h53-0-377" class="i">+		oy = y;
</a><a href="#h53-0-378" id="h53-0-378" class="i">+	} else {
</a><a href="#h53-0-379" id="h53-0-379" class="i">+		if (!IS_SET(MODE_MOUSESGR) &amp;&amp; e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h53-0-380" id="h53-0-380" class="i">+			button = 3;
</a><a href="#h53-0-381" id="h53-0-381" class="i">+		} else {
</a><a href="#h53-0-382" id="h53-0-382" class="i">+			button -= Button1;
</a><a href="#h53-0-383" id="h53-0-383" class="i">+			if (button &gt;= 3)
</a><a href="#h53-0-384" id="h53-0-384" class="i">+				button += 64 - 3;
</a><a href="#h53-0-385" id="h53-0-385" class="i">+		}
</a><a href="#h53-0-386" id="h53-0-386" class="i">+		if (e-&gt;xbutton.type == ButtonPress) {
</a><a href="#h53-0-387" id="h53-0-387" class="i">+			oldbutton = button;
</a><a href="#h53-0-388" id="h53-0-388" class="i">+			ox = x;
</a><a href="#h53-0-389" id="h53-0-389" class="i">+			oy = y;
</a><a href="#h53-0-390" id="h53-0-390" class="i">+		} else if (e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h53-0-391" id="h53-0-391" class="i">+			oldbutton = 3;
</a><a href="#h53-0-392" id="h53-0-392" class="i">+			/* MODE_MOUSEX10: no button release reporting */
</a><a href="#h53-0-393" id="h53-0-393" class="i">+			if (IS_SET(MODE_MOUSEX10))
</a><a href="#h53-0-394" id="h53-0-394" class="i">+				return;
</a><a href="#h53-0-395" id="h53-0-395" class="i">+			if (button == 64 || button == 65)
</a><a href="#h53-0-396" id="h53-0-396" class="i">+				return;
</a><a href="#h53-0-397" id="h53-0-397" class="i">+		}
</a><a href="#h53-0-398" id="h53-0-398" class="i">+	}
</a><a href="#h53-0-399" id="h53-0-399" class="i">+
</a><a href="#h53-0-400" id="h53-0-400" class="i">+	if (!IS_SET(MODE_MOUSEX10)) {
</a><a href="#h53-0-401" id="h53-0-401" class="i">+		button += ((state &amp; ShiftMask  ) ? 4  : 0)
</a><a href="#h53-0-402" id="h53-0-402" class="i">+			+ ((state &amp; Mod4Mask   ) ? 8  : 0)
</a><a href="#h53-0-403" id="h53-0-403" class="i">+			+ ((state &amp; ControlMask) ? 16 : 0);
</a><a href="#h53-0-404" id="h53-0-404" class="i">+	}
</a><a href="#h53-0-405" id="h53-0-405" class="i">+
</a><a href="#h53-0-406" id="h53-0-406" class="i">+	if (IS_SET(MODE_MOUSESGR)) {
</a><a href="#h53-0-407" id="h53-0-407" class="i">+		len = snprintf(buf, sizeof(buf), &quot;\033[&lt;%d;%d;%d%c&quot;,
</a><a href="#h53-0-408" id="h53-0-408" class="i">+				button, x+1, y+1,
</a><a href="#h53-0-409" id="h53-0-409" class="i">+				e-&gt;xbutton.type == ButtonRelease ? &#39;m&#39; : &#39;M&#39;);
</a><a href="#h53-0-410" id="h53-0-410" class="i">+	} else if (x &lt; 223 &amp;&amp; y &lt; 223) {
</a><a href="#h53-0-411" id="h53-0-411" class="i">+		len = snprintf(buf, sizeof(buf), &quot;\033[M%c%c%c&quot;,
</a><a href="#h53-0-412" id="h53-0-412" class="i">+				32+button, 32+x+1, 32+y+1);
</a><a href="#h53-0-413" id="h53-0-413" class="i">+	} else {
</a><a href="#h53-0-414" id="h53-0-414" class="i">+		return;
</a><a href="#h53-0-415" id="h53-0-415" class="i">+	}
</a><a href="#h53-0-416" id="h53-0-416" class="i">+
</a><a href="#h53-0-417" id="h53-0-417" class="i">+	ttywrite(buf, len, 0);
</a><a href="#h53-0-418" id="h53-0-418" class="i">+}
</a><a href="#h53-0-419" id="h53-0-419" class="i">+
</a><a href="#h53-0-420" id="h53-0-420" class="i">+void
</a><a href="#h53-0-421" id="h53-0-421" class="i">+bpress(XEvent *e)
</a><a href="#h53-0-422" id="h53-0-422" class="i">+{
</a><a href="#h53-0-423" id="h53-0-423" class="i">+	struct timespec now;
</a><a href="#h53-0-424" id="h53-0-424" class="i">+	MouseShortcut *ms;
</a><a href="#h53-0-425" id="h53-0-425" class="i">+	int snap;
</a><a href="#h53-0-426" id="h53-0-426" class="i">+
</a><a href="#h53-0-427" id="h53-0-427" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h53-0-428" id="h53-0-428" class="i">+		mousereport(e);
</a><a href="#h53-0-429" id="h53-0-429" class="i">+		return;
</a><a href="#h53-0-430" id="h53-0-430" class="i">+	}
</a><a href="#h53-0-431" id="h53-0-431" class="i">+
</a><a href="#h53-0-432" id="h53-0-432" class="i">+	for (ms = mshortcuts; ms &lt; mshortcuts + LEN(mshortcuts); ms++) {
</a><a href="#h53-0-433" id="h53-0-433" class="i">+		if (e-&gt;xbutton.button == ms-&gt;b
</a><a href="#h53-0-434" id="h53-0-434" class="i">+				&amp;&amp; match(ms-&gt;mask, e-&gt;xbutton.state)) {
</a><a href="#h53-0-435" id="h53-0-435" class="i">+			ttywrite(ms-&gt;s, strlen(ms-&gt;s), 1);
</a><a href="#h53-0-436" id="h53-0-436" class="i">+			return;
</a><a href="#h53-0-437" id="h53-0-437" class="i">+		}
</a><a href="#h53-0-438" id="h53-0-438" class="i">+	}
</a><a href="#h53-0-439" id="h53-0-439" class="i">+
</a><a href="#h53-0-440" id="h53-0-440" class="i">+	if (e-&gt;xbutton.button == Button1) {
</a><a href="#h53-0-441" id="h53-0-441" class="i">+		/*
</a><a href="#h53-0-442" id="h53-0-442" class="i">+		 * If the user clicks below predefined timeouts specific
</a><a href="#h53-0-443" id="h53-0-443" class="i">+		 * snapping behaviour is exposed.
</a><a href="#h53-0-444" id="h53-0-444" class="i">+		 */
</a><a href="#h53-0-445" id="h53-0-445" class="i">+		clock_gettime(CLOCK_MONOTONIC, &amp;now);
</a><a href="#h53-0-446" id="h53-0-446" class="i">+		if (TIMEDIFF(now, xsel.tclick2) &lt;= tripleclicktimeout) {
</a><a href="#h53-0-447" id="h53-0-447" class="i">+			snap = SNAP_LINE;
</a><a href="#h53-0-448" id="h53-0-448" class="i">+		} else if (TIMEDIFF(now, xsel.tclick1) &lt;= doubleclicktimeout) {
</a><a href="#h53-0-449" id="h53-0-449" class="i">+			snap = SNAP_WORD;
</a><a href="#h53-0-450" id="h53-0-450" class="i">+		} else {
</a><a href="#h53-0-451" id="h53-0-451" class="i">+			snap = 0;
</a><a href="#h53-0-452" id="h53-0-452" class="i">+		}
</a><a href="#h53-0-453" id="h53-0-453" class="i">+		xsel.tclick2 = xsel.tclick1;
</a><a href="#h53-0-454" id="h53-0-454" class="i">+		xsel.tclick1 = now;
</a><a href="#h53-0-455" id="h53-0-455" class="i">+
</a><a href="#h53-0-456" id="h53-0-456" class="i">+		selstart(evcol(e), evrow(e), snap);
</a><a href="#h53-0-457" id="h53-0-457" class="i">+	}
</a><a href="#h53-0-458" id="h53-0-458" class="i">+}
</a><a href="#h53-0-459" id="h53-0-459" class="i">+
</a><a href="#h53-0-460" id="h53-0-460" class="i">+void
</a><a href="#h53-0-461" id="h53-0-461" class="i">+propnotify(XEvent *e)
</a><a href="#h53-0-462" id="h53-0-462" class="i">+{
</a><a href="#h53-0-463" id="h53-0-463" class="i">+	XPropertyEvent *xpev;
</a><a href="#h53-0-464" id="h53-0-464" class="i">+	Atom clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h53-0-465" id="h53-0-465" class="i">+
</a><a href="#h53-0-466" id="h53-0-466" class="i">+	xpev = &amp;e-&gt;xproperty;
</a><a href="#h53-0-467" id="h53-0-467" class="i">+	if (xpev-&gt;state == PropertyNewValue &amp;&amp;
</a><a href="#h53-0-468" id="h53-0-468" class="i">+			(xpev-&gt;atom == XA_PRIMARY ||
</a><a href="#h53-0-469" id="h53-0-469" class="i">+			 xpev-&gt;atom == clipboard)) {
</a><a href="#h53-0-470" id="h53-0-470" class="i">+		selnotify(e);
</a><a href="#h53-0-471" id="h53-0-471" class="i">+	}
</a><a href="#h53-0-472" id="h53-0-472" class="i">+}
</a><a href="#h53-0-473" id="h53-0-473" class="i">+
</a><a href="#h53-0-474" id="h53-0-474" class="i">+void
</a><a href="#h53-0-475" id="h53-0-475" class="i">+selnotify(XEvent *e)
</a><a href="#h53-0-476" id="h53-0-476" class="i">+{
</a><a href="#h53-0-477" id="h53-0-477" class="i">+	ulong nitems, ofs, rem;
</a><a href="#h53-0-478" id="h53-0-478" class="i">+	int format;
</a><a href="#h53-0-479" id="h53-0-479" class="i">+	uchar *data, *last, *repl;
</a><a href="#h53-0-480" id="h53-0-480" class="i">+	Atom type, incratom, property = None;
</a><a href="#h53-0-481" id="h53-0-481" class="i">+
</a><a href="#h53-0-482" id="h53-0-482" class="i">+	incratom = XInternAtom(xw.dpy, &quot;INCR&quot;, 0);
</a><a href="#h53-0-483" id="h53-0-483" class="i">+
</a><a href="#h53-0-484" id="h53-0-484" class="i">+	ofs = 0;
</a><a href="#h53-0-485" id="h53-0-485" class="i">+	if (e-&gt;type == SelectionNotify)
</a><a href="#h53-0-486" id="h53-0-486" class="i">+		property = e-&gt;xselection.property;
</a><a href="#h53-0-487" id="h53-0-487" class="i">+	else if (e-&gt;type == PropertyNotify)
</a><a href="#h53-0-488" id="h53-0-488" class="i">+		property = e-&gt;xproperty.atom;
</a><a href="#h53-0-489" id="h53-0-489" class="i">+
</a><a href="#h53-0-490" id="h53-0-490" class="i">+	if (property == None)
</a><a href="#h53-0-491" id="h53-0-491" class="i">+		return;
</a><a href="#h53-0-492" id="h53-0-492" class="i">+
</a><a href="#h53-0-493" id="h53-0-493" class="i">+	do {
</a><a href="#h53-0-494" id="h53-0-494" class="i">+		if (XGetWindowProperty(xw.dpy, xw.win, property, ofs,
</a><a href="#h53-0-495" id="h53-0-495" class="i">+					BUFSIZ/4, False, AnyPropertyType,
</a><a href="#h53-0-496" id="h53-0-496" class="i">+					&amp;type, &amp;format, &amp;nitems, &amp;rem,
</a><a href="#h53-0-497" id="h53-0-497" class="i">+					&amp;data)) {
</a><a href="#h53-0-498" id="h53-0-498" class="i">+			fprintf(stderr, &quot;Clipboard allocation failed\n&quot;);
</a><a href="#h53-0-499" id="h53-0-499" class="i">+			return;
</a><a href="#h53-0-500" id="h53-0-500" class="i">+		}
</a><a href="#h53-0-501" id="h53-0-501" class="i">+
</a><a href="#h53-0-502" id="h53-0-502" class="i">+		if (e-&gt;type == PropertyNotify &amp;&amp; nitems == 0 &amp;&amp; rem == 0) {
</a><a href="#h53-0-503" id="h53-0-503" class="i">+			/*
</a><a href="#h53-0-504" id="h53-0-504" class="i">+			 * If there is some PropertyNotify with no data, then
</a><a href="#h53-0-505" id="h53-0-505" class="i">+			 * this is the signal of the selection owner that all
</a><a href="#h53-0-506" id="h53-0-506" class="i">+			 * data has been transferred. We won&#39;t need to receive
</a><a href="#h53-0-507" id="h53-0-507" class="i">+			 * PropertyNotify events anymore.
</a><a href="#h53-0-508" id="h53-0-508" class="i">+			 */
</a><a href="#h53-0-509" id="h53-0-509" class="i">+			MODBIT(xw.attrs.event_mask, 0, PropertyChangeMask);
</a><a href="#h53-0-510" id="h53-0-510" class="i">+			XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask,
</a><a href="#h53-0-511" id="h53-0-511" class="i">+					&amp;xw.attrs);
</a><a href="#h53-0-512" id="h53-0-512" class="i">+		}
</a><a href="#h53-0-513" id="h53-0-513" class="i">+
</a><a href="#h53-0-514" id="h53-0-514" class="i">+		if (type == incratom) {
</a><a href="#h53-0-515" id="h53-0-515" class="i">+			/*
</a><a href="#h53-0-516" id="h53-0-516" class="i">+			 * Activate the PropertyNotify events so we receive
</a><a href="#h53-0-517" id="h53-0-517" class="i">+			 * when the selection owner does send us the next
</a><a href="#h53-0-518" id="h53-0-518" class="i">+			 * chunk of data.
</a><a href="#h53-0-519" id="h53-0-519" class="i">+			 */
</a><a href="#h53-0-520" id="h53-0-520" class="i">+			MODBIT(xw.attrs.event_mask, 1, PropertyChangeMask);
</a><a href="#h53-0-521" id="h53-0-521" class="i">+			XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask,
</a><a href="#h53-0-522" id="h53-0-522" class="i">+					&amp;xw.attrs);
</a><a href="#h53-0-523" id="h53-0-523" class="i">+
</a><a href="#h53-0-524" id="h53-0-524" class="i">+			/*
</a><a href="#h53-0-525" id="h53-0-525" class="i">+			 * Deleting the property is the transfer start signal.
</a><a href="#h53-0-526" id="h53-0-526" class="i">+			 */
</a><a href="#h53-0-527" id="h53-0-527" class="i">+			XDeleteProperty(xw.dpy, xw.win, (int)property);
</a><a href="#h53-0-528" id="h53-0-528" class="i">+			continue;
</a><a href="#h53-0-529" id="h53-0-529" class="i">+		}
</a><a href="#h53-0-530" id="h53-0-530" class="i">+
</a><a href="#h53-0-531" id="h53-0-531" class="i">+		/*
</a><a href="#h53-0-532" id="h53-0-532" class="i">+		 * As seen in getsel:
</a><a href="#h53-0-533" id="h53-0-533" class="i">+		 * Line endings are inconsistent in the terminal and GUI world
</a><a href="#h53-0-534" id="h53-0-534" class="i">+		 * copy and pasting. When receiving some selection data,
</a><a href="#h53-0-535" id="h53-0-535" class="i">+		 * replace all &#39;\n&#39; with &#39;\r&#39;.
</a><a href="#h53-0-536" id="h53-0-536" class="i">+		 * FIXME: Fix the computer world.
</a><a href="#h53-0-537" id="h53-0-537" class="i">+		 */
</a><a href="#h53-0-538" id="h53-0-538" class="i">+		repl = data;
</a><a href="#h53-0-539" id="h53-0-539" class="i">+		last = data + nitems * format / 8;
</a><a href="#h53-0-540" id="h53-0-540" class="i">+		while ((repl = memchr(repl, &#39;\n&#39;, last - repl))) {
</a><a href="#h53-0-541" id="h53-0-541" class="i">+			*repl++ = &#39;\r&#39;;
</a><a href="#h53-0-542" id="h53-0-542" class="i">+		}
</a><a href="#h53-0-543" id="h53-0-543" class="i">+
</a><a href="#h53-0-544" id="h53-0-544" class="i">+		if (IS_SET(MODE_BRCKTPASTE) &amp;&amp; ofs == 0)
</a><a href="#h53-0-545" id="h53-0-545" class="i">+			ttywrite(&quot;\033[200~&quot;, 6, 0);
</a><a href="#h53-0-546" id="h53-0-546" class="i">+		ttywrite((char *)data, nitems * format / 8, 1);
</a><a href="#h53-0-547" id="h53-0-547" class="i">+		if (IS_SET(MODE_BRCKTPASTE) &amp;&amp; rem == 0)
</a><a href="#h53-0-548" id="h53-0-548" class="i">+			ttywrite(&quot;\033[201~&quot;, 6, 0);
</a><a href="#h53-0-549" id="h53-0-549" class="i">+		XFree(data);
</a><a href="#h53-0-550" id="h53-0-550" class="i">+		/* number of 32-bit chunks returned */
</a><a href="#h53-0-551" id="h53-0-551" class="i">+		ofs += nitems * format / 32;
</a><a href="#h53-0-552" id="h53-0-552" class="i">+	} while (rem &gt; 0);
</a><a href="#h53-0-553" id="h53-0-553" class="i">+
</a><a href="#h53-0-554" id="h53-0-554" class="i">+	/*
</a><a href="#h53-0-555" id="h53-0-555" class="i">+	 * Deleting the property again tells the selection owner to send the
</a><a href="#h53-0-556" id="h53-0-556" class="i">+	 * next data chunk in the property.
</a><a href="#h53-0-557" id="h53-0-557" class="i">+	 */
</a><a href="#h53-0-558" id="h53-0-558" class="i">+	XDeleteProperty(xw.dpy, xw.win, (int)property);
</a><a href="#h53-0-559" id="h53-0-559" class="i">+}
</a><a href="#h53-0-560" id="h53-0-560" class="i">+
</a><a href="#h53-0-561" id="h53-0-561" class="i">+void
</a><a href="#h53-0-562" id="h53-0-562" class="i">+xclipcopy(void)
</a><a href="#h53-0-563" id="h53-0-563" class="i">+{
</a><a href="#h53-0-564" id="h53-0-564" class="i">+	clipcopy(NULL);
</a><a href="#h53-0-565" id="h53-0-565" class="i">+}
</a><a href="#h53-0-566" id="h53-0-566" class="i">+
</a><a href="#h53-0-567" id="h53-0-567" class="i">+void
</a><a href="#h53-0-568" id="h53-0-568" class="i">+selclear_(XEvent *e)
</a><a href="#h53-0-569" id="h53-0-569" class="i">+{
</a><a href="#h53-0-570" id="h53-0-570" class="i">+	selclear();
</a><a href="#h53-0-571" id="h53-0-571" class="i">+}
</a><a href="#h53-0-572" id="h53-0-572" class="i">+
</a><a href="#h53-0-573" id="h53-0-573" class="i">+void
</a><a href="#h53-0-574" id="h53-0-574" class="i">+selrequest(XEvent *e)
</a><a href="#h53-0-575" id="h53-0-575" class="i">+{
</a><a href="#h53-0-576" id="h53-0-576" class="i">+	XSelectionRequestEvent *xsre;
</a><a href="#h53-0-577" id="h53-0-577" class="i">+	XSelectionEvent xev;
</a><a href="#h53-0-578" id="h53-0-578" class="i">+	Atom xa_targets, string, clipboard;
</a><a href="#h53-0-579" id="h53-0-579" class="i">+	char *seltext;
</a><a href="#h53-0-580" id="h53-0-580" class="i">+
</a><a href="#h53-0-581" id="h53-0-581" class="i">+	xsre = (XSelectionRequestEvent *) e;
</a><a href="#h53-0-582" id="h53-0-582" class="i">+	xev.type = SelectionNotify;
</a><a href="#h53-0-583" id="h53-0-583" class="i">+	xev.requestor = xsre-&gt;requestor;
</a><a href="#h53-0-584" id="h53-0-584" class="i">+	xev.selection = xsre-&gt;selection;
</a><a href="#h53-0-585" id="h53-0-585" class="i">+	xev.target = xsre-&gt;target;
</a><a href="#h53-0-586" id="h53-0-586" class="i">+	xev.time = xsre-&gt;time;
</a><a href="#h53-0-587" id="h53-0-587" class="i">+	if (xsre-&gt;property == None)
</a><a href="#h53-0-588" id="h53-0-588" class="i">+		xsre-&gt;property = xsre-&gt;target;
</a><a href="#h53-0-589" id="h53-0-589" class="i">+
</a><a href="#h53-0-590" id="h53-0-590" class="i">+	/* reject */
</a><a href="#h53-0-591" id="h53-0-591" class="i">+	xev.property = None;
</a><a href="#h53-0-592" id="h53-0-592" class="i">+
</a><a href="#h53-0-593" id="h53-0-593" class="i">+	xa_targets = XInternAtom(xw.dpy, &quot;TARGETS&quot;, 0);
</a><a href="#h53-0-594" id="h53-0-594" class="i">+	if (xsre-&gt;target == xa_targets) {
</a><a href="#h53-0-595" id="h53-0-595" class="i">+		/* respond with the supported type */
</a><a href="#h53-0-596" id="h53-0-596" class="i">+		string = xsel.xtarget;
</a><a href="#h53-0-597" id="h53-0-597" class="i">+		XChangeProperty(xsre-&gt;display, xsre-&gt;requestor, xsre-&gt;property,
</a><a href="#h53-0-598" id="h53-0-598" class="i">+				XA_ATOM, 32, PropModeReplace,
</a><a href="#h53-0-599" id="h53-0-599" class="i">+				(uchar *) &amp;string, 1);
</a><a href="#h53-0-600" id="h53-0-600" class="i">+		xev.property = xsre-&gt;property;
</a><a href="#h53-0-601" id="h53-0-601" class="i">+	} else if (xsre-&gt;target == xsel.xtarget || xsre-&gt;target == XA_STRING) {
</a><a href="#h53-0-602" id="h53-0-602" class="i">+		/*
</a><a href="#h53-0-603" id="h53-0-603" class="i">+		 * xith XA_STRING non ascii characters may be incorrect in the
</a><a href="#h53-0-604" id="h53-0-604" class="i">+		 * requestor. It is not our problem, use utf8.
</a><a href="#h53-0-605" id="h53-0-605" class="i">+		 */
</a><a href="#h53-0-606" id="h53-0-606" class="i">+		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h53-0-607" id="h53-0-607" class="i">+		if (xsre-&gt;selection == XA_PRIMARY) {
</a><a href="#h53-0-608" id="h53-0-608" class="i">+			seltext = xsel.primary;
</a><a href="#h53-0-609" id="h53-0-609" class="i">+		} else if (xsre-&gt;selection == clipboard) {
</a><a href="#h53-0-610" id="h53-0-610" class="i">+			seltext = xsel.clipboard;
</a><a href="#h53-0-611" id="h53-0-611" class="i">+		} else {
</a><a href="#h53-0-612" id="h53-0-612" class="i">+			fprintf(stderr,
</a><a href="#h53-0-613" id="h53-0-613" class="i">+				&quot;Unhandled clipboard selection 0x%lx\n&quot;,
</a><a href="#h53-0-614" id="h53-0-614" class="i">+				xsre-&gt;selection);
</a><a href="#h53-0-615" id="h53-0-615" class="i">+			return;
</a><a href="#h53-0-616" id="h53-0-616" class="i">+		}
</a><a href="#h53-0-617" id="h53-0-617" class="i">+		if (seltext != NULL) {
</a><a href="#h53-0-618" id="h53-0-618" class="i">+			XChangeProperty(xsre-&gt;display, xsre-&gt;requestor,
</a><a href="#h53-0-619" id="h53-0-619" class="i">+					xsre-&gt;property, xsre-&gt;target,
</a><a href="#h53-0-620" id="h53-0-620" class="i">+					8, PropModeReplace,
</a><a href="#h53-0-621" id="h53-0-621" class="i">+					(uchar *)seltext, strlen(seltext));
</a><a href="#h53-0-622" id="h53-0-622" class="i">+			xev.property = xsre-&gt;property;
</a><a href="#h53-0-623" id="h53-0-623" class="i">+		}
</a><a href="#h53-0-624" id="h53-0-624" class="i">+	}
</a><a href="#h53-0-625" id="h53-0-625" class="i">+
</a><a href="#h53-0-626" id="h53-0-626" class="i">+	/* all done, send a notification to the listener */
</a><a href="#h53-0-627" id="h53-0-627" class="i">+	if (!XSendEvent(xsre-&gt;display, xsre-&gt;requestor, 1, 0, (XEvent *) &amp;xev))
</a><a href="#h53-0-628" id="h53-0-628" class="i">+		fprintf(stderr, &quot;Error sending SelectionNotify event\n&quot;);
</a><a href="#h53-0-629" id="h53-0-629" class="i">+}
</a><a href="#h53-0-630" id="h53-0-630" class="i">+
</a><a href="#h53-0-631" id="h53-0-631" class="i">+void
</a><a href="#h53-0-632" id="h53-0-632" class="i">+setsel(char *str, Time t)
</a><a href="#h53-0-633" id="h53-0-633" class="i">+{
</a><a href="#h53-0-634" id="h53-0-634" class="i">+	if (!str)
</a><a href="#h53-0-635" id="h53-0-635" class="i">+		return;
</a><a href="#h53-0-636" id="h53-0-636" class="i">+
</a><a href="#h53-0-637" id="h53-0-637" class="i">+	free(xsel.primary);
</a><a href="#h53-0-638" id="h53-0-638" class="i">+	xsel.primary = str;
</a><a href="#h53-0-639" id="h53-0-639" class="i">+
</a><a href="#h53-0-640" id="h53-0-640" class="i">+	XSetSelectionOwner(xw.dpy, XA_PRIMARY, xw.win, t);
</a><a href="#h53-0-641" id="h53-0-641" class="i">+	if (XGetSelectionOwner(xw.dpy, XA_PRIMARY) != xw.win)
</a><a href="#h53-0-642" id="h53-0-642" class="i">+		selclear();
</a><a href="#h53-0-643" id="h53-0-643" class="i">+
</a><a href="#h53-0-644" id="h53-0-644" class="i">+	xclipcopy();
</a><a href="#h53-0-645" id="h53-0-645" class="i">+}
</a><a href="#h53-0-646" id="h53-0-646" class="i">+
</a><a href="#h53-0-647" id="h53-0-647" class="i">+void
</a><a href="#h53-0-648" id="h53-0-648" class="i">+xsetsel(char *str)
</a><a href="#h53-0-649" id="h53-0-649" class="i">+{
</a><a href="#h53-0-650" id="h53-0-650" class="i">+	setsel(str, CurrentTime);
</a><a href="#h53-0-651" id="h53-0-651" class="i">+}
</a><a href="#h53-0-652" id="h53-0-652" class="i">+
</a><a href="#h53-0-653" id="h53-0-653" class="i">+void
</a><a href="#h53-0-654" id="h53-0-654" class="i">+brelease(XEvent *e)
</a><a href="#h53-0-655" id="h53-0-655" class="i">+{
</a><a href="#h53-0-656" id="h53-0-656" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h53-0-657" id="h53-0-657" class="i">+		mousereport(e);
</a><a href="#h53-0-658" id="h53-0-658" class="i">+		return;
</a><a href="#h53-0-659" id="h53-0-659" class="i">+	}
</a><a href="#h53-0-660" id="h53-0-660" class="i">+
</a><a href="#h53-0-661" id="h53-0-661" class="i">+	if (e-&gt;xbutton.button == Button2)
</a><a href="#h53-0-662" id="h53-0-662" class="i">+		selpaste(NULL);
</a><a href="#h53-0-663" id="h53-0-663" class="i">+	else if (e-&gt;xbutton.button == Button1)
</a><a href="#h53-0-664" id="h53-0-664" class="i">+		mousesel(e, 1);
</a><a href="#h53-0-665" id="h53-0-665" class="i">+}
</a><a href="#h53-0-666" id="h53-0-666" class="i">+
</a><a href="#h53-0-667" id="h53-0-667" class="i">+void
</a><a href="#h53-0-668" id="h53-0-668" class="i">+bmotion(XEvent *e)
</a><a href="#h53-0-669" id="h53-0-669" class="i">+{
</a><a href="#h53-0-670" id="h53-0-670" class="i">+	if (!xw.pointerisvisible) {
</a><a href="#h53-0-671" id="h53-0-671" class="i">+		XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h53-0-672" id="h53-0-672" class="i">+		xw.pointerisvisible = 1;
</a><a href="#h53-0-673" id="h53-0-673" class="i">+		if (!IS_SET(MODE_MOUSEMANY))
</a><a href="#h53-0-674" id="h53-0-674" class="i">+			xsetpointermotion(0);
</a><a href="#h53-0-675" id="h53-0-675" class="i">+	}
</a><a href="#h53-0-676" id="h53-0-676" class="i">+
</a><a href="#h53-0-677" id="h53-0-677" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h53-0-678" id="h53-0-678" class="i">+		mousereport(e);
</a><a href="#h53-0-679" id="h53-0-679" class="i">+		return;
</a><a href="#h53-0-680" id="h53-0-680" class="i">+	}
</a><a href="#h53-0-681" id="h53-0-681" class="i">+
</a><a href="#h53-0-682" id="h53-0-682" class="i">+	mousesel(e, 0);
</a><a href="#h53-0-683" id="h53-0-683" class="i">+}
</a><a href="#h53-0-684" id="h53-0-684" class="i">+
</a><a href="#h53-0-685" id="h53-0-685" class="i">+void
</a><a href="#h53-0-686" id="h53-0-686" class="i">+cresize(int width, int height)
</a><a href="#h53-0-687" id="h53-0-687" class="i">+{
</a><a href="#h53-0-688" id="h53-0-688" class="i">+	int col, row;
</a><a href="#h53-0-689" id="h53-0-689" class="i">+
</a><a href="#h53-0-690" id="h53-0-690" class="i">+	if (width != 0)
</a><a href="#h53-0-691" id="h53-0-691" class="i">+		win.w = width;
</a><a href="#h53-0-692" id="h53-0-692" class="i">+	if (height != 0)
</a><a href="#h53-0-693" id="h53-0-693" class="i">+		win.h = height;
</a><a href="#h53-0-694" id="h53-0-694" class="i">+
</a><a href="#h53-0-695" id="h53-0-695" class="i">+	col = (win.w - 2 * borderpx) / win.cw;
</a><a href="#h53-0-696" id="h53-0-696" class="i">+	row = (win.h - 2 * borderpx) / win.ch;
</a><a href="#h53-0-697" id="h53-0-697" class="i">+	col = MAX(1, col);
</a><a href="#h53-0-698" id="h53-0-698" class="i">+	row = MAX(1, row);
</a><a href="#h53-0-699" id="h53-0-699" class="i">+
</a><a href="#h53-0-700" id="h53-0-700" class="i">+	win.hborderpx = (win.w - col * win.cw) / 2;
</a><a href="#h53-0-701" id="h53-0-701" class="i">+	win.vborderpx = (win.h - row * win.ch) / 2;
</a><a href="#h53-0-702" id="h53-0-702" class="i">+
</a><a href="#h53-0-703" id="h53-0-703" class="i">+	tresize(col, row);
</a><a href="#h53-0-704" id="h53-0-704" class="i">+	xresize(col, row);
</a><a href="#h53-0-705" id="h53-0-705" class="i">+	ttyresize(win.tw, win.th);
</a><a href="#h53-0-706" id="h53-0-706" class="i">+}
</a><a href="#h53-0-707" id="h53-0-707" class="i">+
</a><a href="#h53-0-708" id="h53-0-708" class="i">+void
</a><a href="#h53-0-709" id="h53-0-709" class="i">+xresize(int col, int row)
</a><a href="#h53-0-710" id="h53-0-710" class="i">+{
</a><a href="#h53-0-711" id="h53-0-711" class="i">+	win.tw = col * win.cw;
</a><a href="#h53-0-712" id="h53-0-712" class="i">+	win.th = row * win.ch;
</a><a href="#h53-0-713" id="h53-0-713" class="i">+
</a><a href="#h53-0-714" id="h53-0-714" class="i">+	XFreePixmap(xw.dpy, xw.buf);
</a><a href="#h53-0-715" id="h53-0-715" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h,
</a><a href="#h53-0-716" id="h53-0-716" class="i">+			xw.depth);
</a><a href="#h53-0-717" id="h53-0-717" class="i">+	XftDrawChange(xw.draw, xw.buf);
</a><a href="#h53-0-718" id="h53-0-718" class="i">+	xclear(0, 0, win.w, win.h);
</a><a href="#h53-0-719" id="h53-0-719" class="i">+
</a><a href="#h53-0-720" id="h53-0-720" class="i">+	/* resize to new width */
</a><a href="#h53-0-721" id="h53-0-721" class="i">+	xw.specbuf = xrealloc(xw.specbuf, col * sizeof(GlyphFontSpec));
</a><a href="#h53-0-722" id="h53-0-722" class="i">+}
</a><a href="#h53-0-723" id="h53-0-723" class="i">+
</a><a href="#h53-0-724" id="h53-0-724" class="i">+ushort
</a><a href="#h53-0-725" id="h53-0-725" class="i">+sixd_to_16bit(int x)
</a><a href="#h53-0-726" id="h53-0-726" class="i">+{
</a><a href="#h53-0-727" id="h53-0-727" class="i">+	return x == 0 ? 0 : 0x3737 + 0x2828 * x;
</a><a href="#h53-0-728" id="h53-0-728" class="i">+}
</a><a href="#h53-0-729" id="h53-0-729" class="i">+
</a><a href="#h53-0-730" id="h53-0-730" class="i">+int
</a><a href="#h53-0-731" id="h53-0-731" class="i">+xloadcolor(int i, const char *name, Color *ncolor)
</a><a href="#h53-0-732" id="h53-0-732" class="i">+{
</a><a href="#h53-0-733" id="h53-0-733" class="i">+	XRenderColor color = { .alpha = 0xffff };
</a><a href="#h53-0-734" id="h53-0-734" class="i">+
</a><a href="#h53-0-735" id="h53-0-735" class="i">+	if (!name) {
</a><a href="#h53-0-736" id="h53-0-736" class="i">+		if (BETWEEN(i, 16, 255)) { /* 256 color */
</a><a href="#h53-0-737" id="h53-0-737" class="i">+			if (i &lt; 6*6*6+16) { /* same colors as xterm */
</a><a href="#h53-0-738" id="h53-0-738" class="i">+				color.red   = sixd_to_16bit( ((i-16)/36)%6 );
</a><a href="#h53-0-739" id="h53-0-739" class="i">+				color.green = sixd_to_16bit( ((i-16)/6) %6 );
</a><a href="#h53-0-740" id="h53-0-740" class="i">+				color.blue  = sixd_to_16bit( ((i-16)/1) %6 );
</a><a href="#h53-0-741" id="h53-0-741" class="i">+			} else { /* greyscale */
</a><a href="#h53-0-742" id="h53-0-742" class="i">+				color.red = 0x0808 + 0x0a0a * (i - (6*6*6+16));
</a><a href="#h53-0-743" id="h53-0-743" class="i">+				color.green = color.blue = color.red;
</a><a href="#h53-0-744" id="h53-0-744" class="i">+			}
</a><a href="#h53-0-745" id="h53-0-745" class="i">+			return XftColorAllocValue(xw.dpy, xw.vis,
</a><a href="#h53-0-746" id="h53-0-746" class="i">+			                          xw.cmap, &amp;color, ncolor);
</a><a href="#h53-0-747" id="h53-0-747" class="i">+		} else
</a><a href="#h53-0-748" id="h53-0-748" class="i">+			name = colorname[i];
</a><a href="#h53-0-749" id="h53-0-749" class="i">+	}
</a><a href="#h53-0-750" id="h53-0-750" class="i">+
</a><a href="#h53-0-751" id="h53-0-751" class="i">+	return XftColorAllocName(xw.dpy, xw.vis, xw.cmap, name, ncolor);
</a><a href="#h53-0-752" id="h53-0-752" class="i">+}
</a><a href="#h53-0-753" id="h53-0-753" class="i">+
</a><a href="#h53-0-754" id="h53-0-754" class="i">+void
</a><a href="#h53-0-755" id="h53-0-755" class="i">+xloadcols(void)
</a><a href="#h53-0-756" id="h53-0-756" class="i">+{
</a><a href="#h53-0-757" id="h53-0-757" class="i">+	int i;
</a><a href="#h53-0-758" id="h53-0-758" class="i">+	static int loaded;
</a><a href="#h53-0-759" id="h53-0-759" class="i">+	Color *cp;
</a><a href="#h53-0-760" id="h53-0-760" class="i">+
</a><a href="#h53-0-761" id="h53-0-761" class="i">+	if (loaded) {
</a><a href="#h53-0-762" id="h53-0-762" class="i">+		for (cp = dc.col; cp &lt; &amp;dc.col[dc.collen]; ++cp)
</a><a href="#h53-0-763" id="h53-0-763" class="i">+			XftColorFree(xw.dpy, xw.vis, xw.cmap, cp);
</a><a href="#h53-0-764" id="h53-0-764" class="i">+	} else {
</a><a href="#h53-0-765" id="h53-0-765" class="i">+		dc.collen = MAX(LEN(colorname), 256);
</a><a href="#h53-0-766" id="h53-0-766" class="i">+		dc.col = xmalloc(dc.collen * sizeof(Color));
</a><a href="#h53-0-767" id="h53-0-767" class="i">+	}
</a><a href="#h53-0-768" id="h53-0-768" class="i">+
</a><a href="#h53-0-769" id="h53-0-769" class="i">+	for (i = 0; i &lt; dc.collen; i++)
</a><a href="#h53-0-770" id="h53-0-770" class="i">+		if (!xloadcolor(i, NULL, &amp;dc.col[i])) {
</a><a href="#h53-0-771" id="h53-0-771" class="i">+			if (colorname[i])
</a><a href="#h53-0-772" id="h53-0-772" class="i">+				die(&quot;could not allocate color &#39;%s&#39;\n&quot;, colorname[i]);
</a><a href="#h53-0-773" id="h53-0-773" class="i">+			else
</a><a href="#h53-0-774" id="h53-0-774" class="i">+				die(&quot;could not allocate color %d\n&quot;, i);
</a><a href="#h53-0-775" id="h53-0-775" class="i">+		}
</a><a href="#h53-0-776" id="h53-0-776" class="i">+
</a><a href="#h53-0-777" id="h53-0-777" class="i">+	/* set alpha value of bg color */
</a><a href="#h53-0-778" id="h53-0-778" class="i">+	if (USE_ARGB) {
</a><a href="#h53-0-779" id="h53-0-779" class="i">+		dc.col[defaultbg].color.alpha = alpha &lt;&lt; 8;
</a><a href="#h53-0-780" id="h53-0-780" class="i">+		dc.col[defaultbg].color.red   = ((dc.col[defaultbg].color.red &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h53-0-781" id="h53-0-781" class="i">+		dc.col[defaultbg].color.green = ((dc.col[defaultbg].color.green &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h53-0-782" id="h53-0-782" class="i">+		dc.col[defaultbg].color.blue  = ((dc.col[defaultbg].color.blue &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h53-0-783" id="h53-0-783" class="i">+	}
</a><a href="#h53-0-784" id="h53-0-784" class="i">+	loaded = 1;
</a><a href="#h53-0-785" id="h53-0-785" class="i">+}
</a><a href="#h53-0-786" id="h53-0-786" class="i">+
</a><a href="#h53-0-787" id="h53-0-787" class="i">+int
</a><a href="#h53-0-788" id="h53-0-788" class="i">+xsetcolorname(int x, const char *name)
</a><a href="#h53-0-789" id="h53-0-789" class="i">+{
</a><a href="#h53-0-790" id="h53-0-790" class="i">+	Color ncolor;
</a><a href="#h53-0-791" id="h53-0-791" class="i">+
</a><a href="#h53-0-792" id="h53-0-792" class="i">+	if (!BETWEEN(x, 0, dc.collen))
</a><a href="#h53-0-793" id="h53-0-793" class="i">+		return 1;
</a><a href="#h53-0-794" id="h53-0-794" class="i">+
</a><a href="#h53-0-795" id="h53-0-795" class="i">+
</a><a href="#h53-0-796" id="h53-0-796" class="i">+	if (!xloadcolor(x, name, &amp;ncolor))
</a><a href="#h53-0-797" id="h53-0-797" class="i">+		return 1;
</a><a href="#h53-0-798" id="h53-0-798" class="i">+
</a><a href="#h53-0-799" id="h53-0-799" class="i">+	XftColorFree(xw.dpy, xw.vis, xw.cmap, &amp;dc.col[x]);
</a><a href="#h53-0-800" id="h53-0-800" class="i">+	dc.col[x] = ncolor;
</a><a href="#h53-0-801" id="h53-0-801" class="i">+
</a><a href="#h53-0-802" id="h53-0-802" class="i">+	return 0;
</a><a href="#h53-0-803" id="h53-0-803" class="i">+}
</a><a href="#h53-0-804" id="h53-0-804" class="i">+
</a><a href="#h53-0-805" id="h53-0-805" class="i">+void
</a><a href="#h53-0-806" id="h53-0-806" class="i">+xtermclear(int col1, int row1, int col2, int row2)
</a><a href="#h53-0-807" id="h53-0-807" class="i">+{
</a><a href="#h53-0-808" id="h53-0-808" class="i">+	XftDrawRect(xw.draw,
</a><a href="#h53-0-809" id="h53-0-809" class="i">+			&amp;dc.col[IS_SET(MODE_REVERSE) ? defaultfg : defaultbg],
</a><a href="#h53-0-810" id="h53-0-810" class="i">+			borderpx + col1 * win.cw,
</a><a href="#h53-0-811" id="h53-0-811" class="i">+			borderpx + row1 * win.ch,
</a><a href="#h53-0-812" id="h53-0-812" class="i">+			(col2-col1+1) * win.cw,
</a><a href="#h53-0-813" id="h53-0-813" class="i">+			(row2-row1+1) * win.ch);
</a><a href="#h53-0-814" id="h53-0-814" class="i">+}
</a><a href="#h53-0-815" id="h53-0-815" class="i">+
</a><a href="#h53-0-816" id="h53-0-816" class="i">+/*
</a><a href="#h53-0-817" id="h53-0-817" class="i">+ * Absolute coordinates.
</a><a href="#h53-0-818" id="h53-0-818" class="i">+ */
</a><a href="#h53-0-819" id="h53-0-819" class="i">+void
</a><a href="#h53-0-820" id="h53-0-820" class="i">+xclear(int x1, int y1, int x2, int y2)
</a><a href="#h53-0-821" id="h53-0-821" class="i">+{
</a><a href="#h53-0-822" id="h53-0-822" class="i">+	XftDrawRect(xw.draw,
</a><a href="#h53-0-823" id="h53-0-823" class="i">+			&amp;dc.col[IS_SET(MODE_REVERSE)? defaultfg : defaultbg],
</a><a href="#h53-0-824" id="h53-0-824" class="i">+			x1, y1, x2-x1, y2-y1);
</a><a href="#h53-0-825" id="h53-0-825" class="i">+}
</a><a href="#h53-0-826" id="h53-0-826" class="i">+
</a><a href="#h53-0-827" id="h53-0-827" class="i">+void
</a><a href="#h53-0-828" id="h53-0-828" class="i">+xhints(void)
</a><a href="#h53-0-829" id="h53-0-829" class="i">+{
</a><a href="#h53-0-830" id="h53-0-830" class="i">+	XClassHint class = {opt_name ? opt_name : termname,
</a><a href="#h53-0-831" id="h53-0-831" class="i">+	                    opt_class ? opt_class : termname};
</a><a href="#h53-0-832" id="h53-0-832" class="i">+	XWMHints wm = {.flags = InputHint, .input = 1};
</a><a href="#h53-0-833" id="h53-0-833" class="i">+	XSizeHints *sizeh;
</a><a href="#h53-0-834" id="h53-0-834" class="i">+
</a><a href="#h53-0-835" id="h53-0-835" class="i">+	sizeh = XAllocSizeHints();
</a><a href="#h53-0-836" id="h53-0-836" class="i">+
</a><a href="#h53-0-837" id="h53-0-837" class="i">+	sizeh-&gt;flags = PSize | PResizeInc | PBaseSize | PMinSize;
</a><a href="#h53-0-838" id="h53-0-838" class="i">+	sizeh-&gt;height = win.h;
</a><a href="#h53-0-839" id="h53-0-839" class="i">+	sizeh-&gt;width = win.w;
</a><a href="#h53-0-840" id="h53-0-840" class="i">+	sizeh-&gt;height_inc = 1;
</a><a href="#h53-0-841" id="h53-0-841" class="i">+	sizeh-&gt;width_inc = 1;
</a><a href="#h53-0-842" id="h53-0-842" class="i">+	sizeh-&gt;base_height = 2 * borderpx;
</a><a href="#h53-0-843" id="h53-0-843" class="i">+	sizeh-&gt;base_width = 2 * borderpx;
</a><a href="#h53-0-844" id="h53-0-844" class="i">+	sizeh-&gt;min_height = win.ch + 2 * borderpx;
</a><a href="#h53-0-845" id="h53-0-845" class="i">+	sizeh-&gt;min_width = win.cw + 2 * borderpx;
</a><a href="#h53-0-846" id="h53-0-846" class="i">+	if (xw.isfixed) {
</a><a href="#h53-0-847" id="h53-0-847" class="i">+		sizeh-&gt;flags |= PMaxSize;
</a><a href="#h53-0-848" id="h53-0-848" class="i">+		sizeh-&gt;min_width = sizeh-&gt;max_width = win.w;
</a><a href="#h53-0-849" id="h53-0-849" class="i">+		sizeh-&gt;min_height = sizeh-&gt;max_height = win.h;
</a><a href="#h53-0-850" id="h53-0-850" class="i">+	}
</a><a href="#h53-0-851" id="h53-0-851" class="i">+	if (xw.gm &amp; (XValue|YValue)) {
</a><a href="#h53-0-852" id="h53-0-852" class="i">+		sizeh-&gt;flags |= USPosition | PWinGravity;
</a><a href="#h53-0-853" id="h53-0-853" class="i">+		sizeh-&gt;x = xw.l;
</a><a href="#h53-0-854" id="h53-0-854" class="i">+		sizeh-&gt;y = xw.t;
</a><a href="#h53-0-855" id="h53-0-855" class="i">+		sizeh-&gt;win_gravity = xgeommasktogravity(xw.gm);
</a><a href="#h53-0-856" id="h53-0-856" class="i">+	}
</a><a href="#h53-0-857" id="h53-0-857" class="i">+
</a><a href="#h53-0-858" id="h53-0-858" class="i">+	XSetWMProperties(xw.dpy, xw.win, NULL, NULL, NULL, 0, sizeh, &amp;wm,
</a><a href="#h53-0-859" id="h53-0-859" class="i">+			&amp;class);
</a><a href="#h53-0-860" id="h53-0-860" class="i">+	XFree(sizeh);
</a><a href="#h53-0-861" id="h53-0-861" class="i">+}
</a><a href="#h53-0-862" id="h53-0-862" class="i">+
</a><a href="#h53-0-863" id="h53-0-863" class="i">+int
</a><a href="#h53-0-864" id="h53-0-864" class="i">+xgeommasktogravity(int mask)
</a><a href="#h53-0-865" id="h53-0-865" class="i">+{
</a><a href="#h53-0-866" id="h53-0-866" class="i">+	switch (mask &amp; (XNegative|YNegative)) {
</a><a href="#h53-0-867" id="h53-0-867" class="i">+	case 0:
</a><a href="#h53-0-868" id="h53-0-868" class="i">+		return NorthWestGravity;
</a><a href="#h53-0-869" id="h53-0-869" class="i">+	case XNegative:
</a><a href="#h53-0-870" id="h53-0-870" class="i">+		return NorthEastGravity;
</a><a href="#h53-0-871" id="h53-0-871" class="i">+	case YNegative:
</a><a href="#h53-0-872" id="h53-0-872" class="i">+		return SouthWestGravity;
</a><a href="#h53-0-873" id="h53-0-873" class="i">+	}
</a><a href="#h53-0-874" id="h53-0-874" class="i">+
</a><a href="#h53-0-875" id="h53-0-875" class="i">+	return SouthEastGravity;
</a><a href="#h53-0-876" id="h53-0-876" class="i">+}
</a><a href="#h53-0-877" id="h53-0-877" class="i">+
</a><a href="#h53-0-878" id="h53-0-878" class="i">+int
</a><a href="#h53-0-879" id="h53-0-879" class="i">+xloadfont(Font *f, FcPattern *pattern)
</a><a href="#h53-0-880" id="h53-0-880" class="i">+{
</a><a href="#h53-0-881" id="h53-0-881" class="i">+	FcPattern *configured;
</a><a href="#h53-0-882" id="h53-0-882" class="i">+	FcPattern *match;
</a><a href="#h53-0-883" id="h53-0-883" class="i">+	FcResult result;
</a><a href="#h53-0-884" id="h53-0-884" class="i">+	XGlyphInfo extents;
</a><a href="#h53-0-885" id="h53-0-885" class="i">+	int wantattr, haveattr;
</a><a href="#h53-0-886" id="h53-0-886" class="i">+
</a><a href="#h53-0-887" id="h53-0-887" class="i">+	/*
</a><a href="#h53-0-888" id="h53-0-888" class="i">+	 * Manually configure instead of calling XftMatchFont
</a><a href="#h53-0-889" id="h53-0-889" class="i">+	 * so that we can use the configured pattern for
</a><a href="#h53-0-890" id="h53-0-890" class="i">+	 * &quot;missing glyph&quot; lookups.
</a><a href="#h53-0-891" id="h53-0-891" class="i">+	 */
</a><a href="#h53-0-892" id="h53-0-892" class="i">+	configured = FcPatternDuplicate(pattern);
</a><a href="#h53-0-893" id="h53-0-893" class="i">+	if (!configured)
</a><a href="#h53-0-894" id="h53-0-894" class="i">+		return 1;
</a><a href="#h53-0-895" id="h53-0-895" class="i">+
</a><a href="#h53-0-896" id="h53-0-896" class="i">+	FcConfigSubstitute(NULL, configured, FcMatchPattern);
</a><a href="#h53-0-897" id="h53-0-897" class="i">+	XftDefaultSubstitute(xw.dpy, xw.scr, configured);
</a><a href="#h53-0-898" id="h53-0-898" class="i">+
</a><a href="#h53-0-899" id="h53-0-899" class="i">+	match = FcFontMatch(NULL, configured, &amp;result);
</a><a href="#h53-0-900" id="h53-0-900" class="i">+	if (!match) {
</a><a href="#h53-0-901" id="h53-0-901" class="i">+		FcPatternDestroy(configured);
</a><a href="#h53-0-902" id="h53-0-902" class="i">+		return 1;
</a><a href="#h53-0-903" id="h53-0-903" class="i">+	}
</a><a href="#h53-0-904" id="h53-0-904" class="i">+
</a><a href="#h53-0-905" id="h53-0-905" class="i">+	if (!(f-&gt;match = XftFontOpenPattern(xw.dpy, match))) {
</a><a href="#h53-0-906" id="h53-0-906" class="i">+		FcPatternDestroy(configured);
</a><a href="#h53-0-907" id="h53-0-907" class="i">+		FcPatternDestroy(match);
</a><a href="#h53-0-908" id="h53-0-908" class="i">+		return 1;
</a><a href="#h53-0-909" id="h53-0-909" class="i">+	}
</a><a href="#h53-0-910" id="h53-0-910" class="i">+
</a><a href="#h53-0-911" id="h53-0-911" class="i">+	if ((XftPatternGetInteger(pattern, &quot;slant&quot;, 0, &amp;wantattr) ==
</a><a href="#h53-0-912" id="h53-0-912" class="i">+	    XftResultMatch)) {
</a><a href="#h53-0-913" id="h53-0-913" class="i">+		/*
</a><a href="#h53-0-914" id="h53-0-914" class="i">+		 * Check if xft was unable to find a font with the appropriate
</a><a href="#h53-0-915" id="h53-0-915" class="i">+		 * slant but gave us one anyway. Try to mitigate.
</a><a href="#h53-0-916" id="h53-0-916" class="i">+		 */
</a><a href="#h53-0-917" id="h53-0-917" class="i">+		if ((XftPatternGetInteger(f-&gt;match-&gt;pattern, &quot;slant&quot;, 0,
</a><a href="#h53-0-918" id="h53-0-918" class="i">+		    &amp;haveattr) != XftResultMatch) || haveattr &lt; wantattr) {
</a><a href="#h53-0-919" id="h53-0-919" class="i">+			f-&gt;badslant = 1;
</a><a href="#h53-0-920" id="h53-0-920" class="i">+			fputs(&quot;font slant does not match\n&quot;, stderr);
</a><a href="#h53-0-921" id="h53-0-921" class="i">+		}
</a><a href="#h53-0-922" id="h53-0-922" class="i">+	}
</a><a href="#h53-0-923" id="h53-0-923" class="i">+
</a><a href="#h53-0-924" id="h53-0-924" class="i">+	if ((XftPatternGetInteger(pattern, &quot;weight&quot;, 0, &amp;wantattr) ==
</a><a href="#h53-0-925" id="h53-0-925" class="i">+	    XftResultMatch)) {
</a><a href="#h53-0-926" id="h53-0-926" class="i">+		if ((XftPatternGetInteger(f-&gt;match-&gt;pattern, &quot;weight&quot;, 0,
</a><a href="#h53-0-927" id="h53-0-927" class="i">+		    &amp;haveattr) != XftResultMatch) || haveattr != wantattr) {
</a><a href="#h53-0-928" id="h53-0-928" class="i">+			f-&gt;badweight = 1;
</a><a href="#h53-0-929" id="h53-0-929" class="i">+			fputs(&quot;font weight does not match\n&quot;, stderr);
</a><a href="#h53-0-930" id="h53-0-930" class="i">+		}
</a><a href="#h53-0-931" id="h53-0-931" class="i">+	}
</a><a href="#h53-0-932" id="h53-0-932" class="i">+
</a><a href="#h53-0-933" id="h53-0-933" class="i">+	XftTextExtentsUtf8(xw.dpy, f-&gt;match,
</a><a href="#h53-0-934" id="h53-0-934" class="i">+		(const FcChar8 *) ascii_printable,
</a><a href="#h53-0-935" id="h53-0-935" class="i">+		strlen(ascii_printable), &amp;extents);
</a><a href="#h53-0-936" id="h53-0-936" class="i">+
</a><a href="#h53-0-937" id="h53-0-937" class="i">+	f-&gt;set = NULL;
</a><a href="#h53-0-938" id="h53-0-938" class="i">+	f-&gt;pattern = configured;
</a><a href="#h53-0-939" id="h53-0-939" class="i">+
</a><a href="#h53-0-940" id="h53-0-940" class="i">+	f-&gt;ascent = f-&gt;match-&gt;ascent;
</a><a href="#h53-0-941" id="h53-0-941" class="i">+	f-&gt;descent = f-&gt;match-&gt;descent;
</a><a href="#h53-0-942" id="h53-0-942" class="i">+	f-&gt;lbearing = 0;
</a><a href="#h53-0-943" id="h53-0-943" class="i">+	f-&gt;rbearing = f-&gt;match-&gt;max_advance_width;
</a><a href="#h53-0-944" id="h53-0-944" class="i">+
</a><a href="#h53-0-945" id="h53-0-945" class="i">+	f-&gt;height = f-&gt;ascent + f-&gt;descent;
</a><a href="#h53-0-946" id="h53-0-946" class="i">+	f-&gt;width = DIVCEIL(extents.xOff, strlen(ascii_printable));
</a><a href="#h53-0-947" id="h53-0-947" class="i">+
</a><a href="#h53-0-948" id="h53-0-948" class="i">+	return 0;
</a><a href="#h53-0-949" id="h53-0-949" class="i">+}
</a><a href="#h53-0-950" id="h53-0-950" class="i">+
</a><a href="#h53-0-951" id="h53-0-951" class="i">+void
</a><a href="#h53-0-952" id="h53-0-952" class="i">+xloadfonts(char *fontstr, double fontsize)
</a><a href="#h53-0-953" id="h53-0-953" class="i">+{
</a><a href="#h53-0-954" id="h53-0-954" class="i">+	FcPattern *pattern;
</a><a href="#h53-0-955" id="h53-0-955" class="i">+	double fontval;
</a><a href="#h53-0-956" id="h53-0-956" class="i">+
</a><a href="#h53-0-957" id="h53-0-957" class="i">+	if (fontstr[0] == &#39;-&#39;)
</a><a href="#h53-0-958" id="h53-0-958" class="i">+		pattern = XftXlfdParse(fontstr, False, False);
</a><a href="#h53-0-959" id="h53-0-959" class="i">+	else
</a><a href="#h53-0-960" id="h53-0-960" class="i">+		pattern = FcNameParse((FcChar8 *)fontstr);
</a><a href="#h53-0-961" id="h53-0-961" class="i">+
</a><a href="#h53-0-962" id="h53-0-962" class="i">+	if (!pattern)
</a><a href="#h53-0-963" id="h53-0-963" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h53-0-964" id="h53-0-964" class="i">+
</a><a href="#h53-0-965" id="h53-0-965" class="i">+	if (fontsize &gt; 1) {
</a><a href="#h53-0-966" id="h53-0-966" class="i">+		FcPatternDel(pattern, FC_PIXEL_SIZE);
</a><a href="#h53-0-967" id="h53-0-967" class="i">+		FcPatternDel(pattern, FC_SIZE);
</a><a href="#h53-0-968" id="h53-0-968" class="i">+		FcPatternAddDouble(pattern, FC_PIXEL_SIZE, (double)fontsize);
</a><a href="#h53-0-969" id="h53-0-969" class="i">+		usedfontsize = fontsize;
</a><a href="#h53-0-970" id="h53-0-970" class="i">+	} else {
</a><a href="#h53-0-971" id="h53-0-971" class="i">+		if (FcPatternGetDouble(pattern, FC_PIXEL_SIZE, 0, &amp;fontval) ==
</a><a href="#h53-0-972" id="h53-0-972" class="i">+				FcResultMatch) {
</a><a href="#h53-0-973" id="h53-0-973" class="i">+			usedfontsize = fontval;
</a><a href="#h53-0-974" id="h53-0-974" class="i">+		} else if (FcPatternGetDouble(pattern, FC_SIZE, 0, &amp;fontval) ==
</a><a href="#h53-0-975" id="h53-0-975" class="i">+				FcResultMatch) {
</a><a href="#h53-0-976" id="h53-0-976" class="i">+			usedfontsize = -1;
</a><a href="#h53-0-977" id="h53-0-977" class="i">+		} else {
</a><a href="#h53-0-978" id="h53-0-978" class="i">+			/*
</a><a href="#h53-0-979" id="h53-0-979" class="i">+			 * Default font size is 12, if none given. This is to
</a><a href="#h53-0-980" id="h53-0-980" class="i">+			 * have a known usedfontsize value.
</a><a href="#h53-0-981" id="h53-0-981" class="i">+			 */
</a><a href="#h53-0-982" id="h53-0-982" class="i">+			FcPatternAddDouble(pattern, FC_PIXEL_SIZE, 12);
</a><a href="#h53-0-983" id="h53-0-983" class="i">+			usedfontsize = 12;
</a><a href="#h53-0-984" id="h53-0-984" class="i">+		}
</a><a href="#h53-0-985" id="h53-0-985" class="i">+		defaultfontsize = usedfontsize;
</a><a href="#h53-0-986" id="h53-0-986" class="i">+	}
</a><a href="#h53-0-987" id="h53-0-987" class="i">+
</a><a href="#h53-0-988" id="h53-0-988" class="i">+	if (xloadfont(&amp;dc.font, pattern))
</a><a href="#h53-0-989" id="h53-0-989" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h53-0-990" id="h53-0-990" class="i">+
</a><a href="#h53-0-991" id="h53-0-991" class="i">+	if (usedfontsize &lt; 0) {
</a><a href="#h53-0-992" id="h53-0-992" class="i">+		FcPatternGetDouble(dc.font.match-&gt;pattern,
</a><a href="#h53-0-993" id="h53-0-993" class="i">+		                   FC_PIXEL_SIZE, 0, &amp;fontval);
</a><a href="#h53-0-994" id="h53-0-994" class="i">+		usedfontsize = fontval;
</a><a href="#h53-0-995" id="h53-0-995" class="i">+		if (fontsize == 0)
</a><a href="#h53-0-996" id="h53-0-996" class="i">+			defaultfontsize = fontval;
</a><a href="#h53-0-997" id="h53-0-997" class="i">+	}
</a><a href="#h53-0-998" id="h53-0-998" class="i">+
</a><a href="#h53-0-999" id="h53-0-999" class="i">+	/* Setting character width and height. */
</a><a href="#h53-0-1000" id="h53-0-1000" class="i">+	win.cw = ceilf(dc.font.width * cwscale);
</a><a href="#h53-0-1001" id="h53-0-1001" class="i">+	win.ch = ceilf(dc.font.height * chscale);
</a><a href="#h53-0-1002" id="h53-0-1002" class="i">+
</a><a href="#h53-0-1003" id="h53-0-1003" class="i">+	FcPatternDel(pattern, FC_SLANT);
</a><a href="#h53-0-1004" id="h53-0-1004" class="i">+	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ITALIC);
</a><a href="#h53-0-1005" id="h53-0-1005" class="i">+	if (xloadfont(&amp;dc.ifont, pattern))
</a><a href="#h53-0-1006" id="h53-0-1006" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h53-0-1007" id="h53-0-1007" class="i">+
</a><a href="#h53-0-1008" id="h53-0-1008" class="i">+	FcPatternDel(pattern, FC_WEIGHT);
</a><a href="#h53-0-1009" id="h53-0-1009" class="i">+	FcPatternAddInteger(pattern, FC_WEIGHT, FC_WEIGHT_BOLD);
</a><a href="#h53-0-1010" id="h53-0-1010" class="i">+	if (xloadfont(&amp;dc.ibfont, pattern))
</a><a href="#h53-0-1011" id="h53-0-1011" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h53-0-1012" id="h53-0-1012" class="i">+
</a><a href="#h53-0-1013" id="h53-0-1013" class="i">+	FcPatternDel(pattern, FC_SLANT);
</a><a href="#h53-0-1014" id="h53-0-1014" class="i">+	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ROMAN);
</a><a href="#h53-0-1015" id="h53-0-1015" class="i">+	if (xloadfont(&amp;dc.bfont, pattern))
</a><a href="#h53-0-1016" id="h53-0-1016" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h53-0-1017" id="h53-0-1017" class="i">+
</a><a href="#h53-0-1018" id="h53-0-1018" class="i">+	FcPatternDestroy(pattern);
</a><a href="#h53-0-1019" id="h53-0-1019" class="i">+}
</a><a href="#h53-0-1020" id="h53-0-1020" class="i">+
</a><a href="#h53-0-1021" id="h53-0-1021" class="i">+void
</a><a href="#h53-0-1022" id="h53-0-1022" class="i">+xunloadfont(Font *f)
</a><a href="#h53-0-1023" id="h53-0-1023" class="i">+{
</a><a href="#h53-0-1024" id="h53-0-1024" class="i">+	XftFontClose(xw.dpy, f-&gt;match);
</a><a href="#h53-0-1025" id="h53-0-1025" class="i">+	FcPatternDestroy(f-&gt;pattern);
</a><a href="#h53-0-1026" id="h53-0-1026" class="i">+	if (f-&gt;set)
</a><a href="#h53-0-1027" id="h53-0-1027" class="i">+		FcFontSetDestroy(f-&gt;set);
</a><a href="#h53-0-1028" id="h53-0-1028" class="i">+}
</a><a href="#h53-0-1029" id="h53-0-1029" class="i">+
</a><a href="#h53-0-1030" id="h53-0-1030" class="i">+void
</a><a href="#h53-0-1031" id="h53-0-1031" class="i">+xunloadfonts(void)
</a><a href="#h53-0-1032" id="h53-0-1032" class="i">+{
</a><a href="#h53-0-1033" id="h53-0-1033" class="i">+	/* Free the loaded fonts in the font cache.  */
</a><a href="#h53-0-1034" id="h53-0-1034" class="i">+	while (frclen &gt; 0)
</a><a href="#h53-0-1035" id="h53-0-1035" class="i">+		XftFontClose(xw.dpy, frc[--frclen].font);
</a><a href="#h53-0-1036" id="h53-0-1036" class="i">+
</a><a href="#h53-0-1037" id="h53-0-1037" class="i">+	xunloadfont(&amp;dc.font);
</a><a href="#h53-0-1038" id="h53-0-1038" class="i">+	xunloadfont(&amp;dc.bfont);
</a><a href="#h53-0-1039" id="h53-0-1039" class="i">+	xunloadfont(&amp;dc.ifont);
</a><a href="#h53-0-1040" id="h53-0-1040" class="i">+	xunloadfont(&amp;dc.ibfont);
</a><a href="#h53-0-1041" id="h53-0-1041" class="i">+}
</a><a href="#h53-0-1042" id="h53-0-1042" class="i">+
</a><a href="#h53-0-1043" id="h53-0-1043" class="i">+void
</a><a href="#h53-0-1044" id="h53-0-1044" class="i">+ximopen(Display *dpy)
</a><a href="#h53-0-1045" id="h53-0-1045" class="i">+{
</a><a href="#h53-0-1046" id="h53-0-1046" class="i">+	XIMCallback destroy = { .client_data = NULL, .callback = ximdestroy };
</a><a href="#h53-0-1047" id="h53-0-1047" class="i">+
</a><a href="#h53-0-1048" id="h53-0-1048" class="i">+	if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h53-0-1049" id="h53-0-1049" class="i">+		XSetLocaleModifiers(&quot;@im=local&quot;);
</a><a href="#h53-0-1050" id="h53-0-1050" class="i">+		if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h53-0-1051" id="h53-0-1051" class="i">+			XSetLocaleModifiers(&quot;@im=&quot;);
</a><a href="#h53-0-1052" id="h53-0-1052" class="i">+			if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL)
</a><a href="#h53-0-1053" id="h53-0-1053" class="i">+				die(&quot;XOpenIM failed. Could not open input device.\n&quot;);
</a><a href="#h53-0-1054" id="h53-0-1054" class="i">+		}
</a><a href="#h53-0-1055" id="h53-0-1055" class="i">+	}
</a><a href="#h53-0-1056" id="h53-0-1056" class="i">+	if (XSetIMValues(xw.xim, XNDestroyCallback, &amp;destroy, NULL) != NULL)
</a><a href="#h53-0-1057" id="h53-0-1057" class="i">+		die(&quot;XSetIMValues failed. Could not set input method value.\n&quot;);
</a><a href="#h53-0-1058" id="h53-0-1058" class="i">+	xw.xic = XCreateIC(xw.xim, XNInputStyle, XIMPreeditNothing | XIMStatusNothing,
</a><a href="#h53-0-1059" id="h53-0-1059" class="i">+				XNClientWindow, xw.win, XNFocusWindow, xw.win, NULL);
</a><a href="#h53-0-1060" id="h53-0-1060" class="i">+	if (xw.xic == NULL)
</a><a href="#h53-0-1061" id="h53-0-1061" class="i">+		die(&quot;XCreateIC failed. Could not obtain input method.\n&quot;);
</a><a href="#h53-0-1062" id="h53-0-1062" class="i">+}
</a><a href="#h53-0-1063" id="h53-0-1063" class="i">+
</a><a href="#h53-0-1064" id="h53-0-1064" class="i">+void
</a><a href="#h53-0-1065" id="h53-0-1065" class="i">+ximinstantiate(Display *dpy, XPointer client, XPointer call)
</a><a href="#h53-0-1066" id="h53-0-1066" class="i">+{
</a><a href="#h53-0-1067" id="h53-0-1067" class="i">+	ximopen(dpy);
</a><a href="#h53-0-1068" id="h53-0-1068" class="i">+	XUnregisterIMInstantiateCallback(xw.dpy, NULL, NULL, NULL,
</a><a href="#h53-0-1069" id="h53-0-1069" class="i">+					ximinstantiate, NULL);
</a><a href="#h53-0-1070" id="h53-0-1070" class="i">+}
</a><a href="#h53-0-1071" id="h53-0-1071" class="i">+
</a><a href="#h53-0-1072" id="h53-0-1072" class="i">+void
</a><a href="#h53-0-1073" id="h53-0-1073" class="i">+ximdestroy(XIM xim, XPointer client, XPointer call)
</a><a href="#h53-0-1074" id="h53-0-1074" class="i">+{
</a><a href="#h53-0-1075" id="h53-0-1075" class="i">+	xw.xim = NULL;
</a><a href="#h53-0-1076" id="h53-0-1076" class="i">+	XRegisterIMInstantiateCallback(xw.dpy, NULL, NULL, NULL,
</a><a href="#h53-0-1077" id="h53-0-1077" class="i">+					ximinstantiate, NULL);
</a><a href="#h53-0-1078" id="h53-0-1078" class="i">+}
</a><a href="#h53-0-1079" id="h53-0-1079" class="i">+
</a><a href="#h53-0-1080" id="h53-0-1080" class="i">+void
</a><a href="#h53-0-1081" id="h53-0-1081" class="i">+xinit(int cols, int rows)
</a><a href="#h53-0-1082" id="h53-0-1082" class="i">+{
</a><a href="#h53-0-1083" id="h53-0-1083" class="i">+	XGCValues gcvalues;
</a><a href="#h53-0-1084" id="h53-0-1084" class="i">+	Window parent;
</a><a href="#h53-0-1085" id="h53-0-1085" class="i">+	pid_t thispid = getpid();
</a><a href="#h53-0-1086" id="h53-0-1086" class="i">+	XColor xmousefg, xmousebg;
</a><a href="#h53-0-1087" id="h53-0-1087" class="i">+	Pixmap blankpm;
</a><a href="#h53-0-1088" id="h53-0-1088" class="i">+
</a><a href="#h53-0-1089" id="h53-0-1089" class="i">+	if (!(xw.dpy = XOpenDisplay(NULL)))
</a><a href="#h53-0-1090" id="h53-0-1090" class="i">+		die(&quot;can&#39;t open display\n&quot;);
</a><a href="#h53-0-1091" id="h53-0-1091" class="i">+	xw.scr = XDefaultScreen(xw.dpy);
</a><a href="#h53-0-1092" id="h53-0-1092" class="i">+	xw.depth = (USE_ARGB) ? 32: XDefaultDepth(xw.dpy, xw.scr);
</a><a href="#h53-0-1093" id="h53-0-1093" class="i">+	if (!USE_ARGB)
</a><a href="#h53-0-1094" id="h53-0-1094" class="i">+		xw.vis = XDefaultVisual(xw.dpy, xw.scr);
</a><a href="#h53-0-1095" id="h53-0-1095" class="i">+	else {
</a><a href="#h53-0-1096" id="h53-0-1096" class="i">+		XVisualInfo *vis;
</a><a href="#h53-0-1097" id="h53-0-1097" class="i">+		XRenderPictFormat *fmt;
</a><a href="#h53-0-1098" id="h53-0-1098" class="i">+		int nvi;
</a><a href="#h53-0-1099" id="h53-0-1099" class="i">+		int i;
</a><a href="#h53-0-1100" id="h53-0-1100" class="i">+
</a><a href="#h53-0-1101" id="h53-0-1101" class="i">+		XVisualInfo tpl = {
</a><a href="#h53-0-1102" id="h53-0-1102" class="i">+			.screen = xw.scr,
</a><a href="#h53-0-1103" id="h53-0-1103" class="i">+			.depth = 32,
</a><a href="#h53-0-1104" id="h53-0-1104" class="i">+			.class = TrueColor
</a><a href="#h53-0-1105" id="h53-0-1105" class="i">+		};
</a><a href="#h53-0-1106" id="h53-0-1106" class="i">+
</a><a href="#h53-0-1107" id="h53-0-1107" class="i">+		vis = XGetVisualInfo(xw.dpy,
</a><a href="#h53-0-1108" id="h53-0-1108" class="i">+				VisualScreenMask | VisualDepthMask | VisualClassMask,
</a><a href="#h53-0-1109" id="h53-0-1109" class="i">+				&amp;tpl, &amp;nvi);
</a><a href="#h53-0-1110" id="h53-0-1110" class="i">+		xw.vis = NULL;
</a><a href="#h53-0-1111" id="h53-0-1111" class="i">+		for (i = 0; i &lt; nvi; i++) {
</a><a href="#h53-0-1112" id="h53-0-1112" class="i">+			fmt = XRenderFindVisualFormat(xw.dpy, vis[i].visual);
</a><a href="#h53-0-1113" id="h53-0-1113" class="i">+			if (fmt-&gt;type == PictTypeDirect &amp;&amp; fmt-&gt;direct.alphaMask) {
</a><a href="#h53-0-1114" id="h53-0-1114" class="i">+				xw.vis = vis[i].visual;
</a><a href="#h53-0-1115" id="h53-0-1115" class="i">+				break;
</a><a href="#h53-0-1116" id="h53-0-1116" class="i">+			}
</a><a href="#h53-0-1117" id="h53-0-1117" class="i">+		}
</a><a href="#h53-0-1118" id="h53-0-1118" class="i">+
</a><a href="#h53-0-1119" id="h53-0-1119" class="i">+		XFree(vis);
</a><a href="#h53-0-1120" id="h53-0-1120" class="i">+
</a><a href="#h53-0-1121" id="h53-0-1121" class="i">+		if (!xw.vis) {
</a><a href="#h53-0-1122" id="h53-0-1122" class="i">+			fprintf(stderr, &quot;Couldn&#39;t find ARGB visual.\n&quot;);
</a><a href="#h53-0-1123" id="h53-0-1123" class="i">+			exit(1);
</a><a href="#h53-0-1124" id="h53-0-1124" class="i">+		}
</a><a href="#h53-0-1125" id="h53-0-1125" class="i">+	}
</a><a href="#h53-0-1126" id="h53-0-1126" class="i">+
</a><a href="#h53-0-1127" id="h53-0-1127" class="i">+	/* font */
</a><a href="#h53-0-1128" id="h53-0-1128" class="i">+	if (!FcInit())
</a><a href="#h53-0-1129" id="h53-0-1129" class="i">+		die(&quot;could not init fontconfig.\n&quot;);
</a><a href="#h53-0-1130" id="h53-0-1130" class="i">+
</a><a href="#h53-0-1131" id="h53-0-1131" class="i">+	usedfont = (opt_font == NULL)? font : opt_font;
</a><a href="#h53-0-1132" id="h53-0-1132" class="i">+	xloadfonts(usedfont, 0);
</a><a href="#h53-0-1133" id="h53-0-1133" class="i">+
</a><a href="#h53-0-1134" id="h53-0-1134" class="i">+	/* colors */
</a><a href="#h53-0-1135" id="h53-0-1135" class="i">+	if (!USE_ARGB)
</a><a href="#h53-0-1136" id="h53-0-1136" class="i">+		xw.cmap = XDefaultColormap(xw.dpy, xw.scr);
</a><a href="#h53-0-1137" id="h53-0-1137" class="i">+	else
</a><a href="#h53-0-1138" id="h53-0-1138" class="i">+		xw.cmap = XCreateColormap(xw.dpy, XRootWindow(xw.dpy, xw.scr),
</a><a href="#h53-0-1139" id="h53-0-1139" class="i">+				xw.vis, None);
</a><a href="#h53-0-1140" id="h53-0-1140" class="i">+	xloadcols();
</a><a href="#h53-0-1141" id="h53-0-1141" class="i">+
</a><a href="#h53-0-1142" id="h53-0-1142" class="i">+	/* adjust fixed window geometry */
</a><a href="#h53-0-1143" id="h53-0-1143" class="i">+	win.w = 2 * win.hborderpx + cols * win.cw;
</a><a href="#h53-0-1144" id="h53-0-1144" class="i">+	win.h = 2 * win.vborderpx + rows * win.ch;
</a><a href="#h53-0-1145" id="h53-0-1145" class="i">+	if (xw.gm &amp; XNegative)
</a><a href="#h53-0-1146" id="h53-0-1146" class="i">+		xw.l += DisplayWidth(xw.dpy, xw.scr) - win.w - 2;
</a><a href="#h53-0-1147" id="h53-0-1147" class="i">+	if (xw.gm &amp; YNegative)
</a><a href="#h53-0-1148" id="h53-0-1148" class="i">+		xw.t += DisplayHeight(xw.dpy, xw.scr) - win.h - 2;
</a><a href="#h53-0-1149" id="h53-0-1149" class="i">+
</a><a href="#h53-0-1150" id="h53-0-1150" class="i">+	/* Events */
</a><a href="#h53-0-1151" id="h53-0-1151" class="i">+	xw.attrs.background_pixel = dc.col[defaultbg].pixel;
</a><a href="#h53-0-1152" id="h53-0-1152" class="i">+	xw.attrs.border_pixel = dc.col[defaultbg].pixel;
</a><a href="#h53-0-1153" id="h53-0-1153" class="i">+	xw.attrs.bit_gravity = NorthWestGravity;
</a><a href="#h53-0-1154" id="h53-0-1154" class="i">+	xw.attrs.event_mask = FocusChangeMask | KeyPressMask | KeyReleaseMask
</a><a href="#h53-0-1155" id="h53-0-1155" class="i">+		| ExposureMask | VisibilityChangeMask | StructureNotifyMask
</a><a href="#h53-0-1156" id="h53-0-1156" class="i">+		| ButtonMotionMask | ButtonPressMask | ButtonReleaseMask;
</a><a href="#h53-0-1157" id="h53-0-1157" class="i">+	xw.attrs.colormap = xw.cmap;
</a><a href="#h53-0-1158" id="h53-0-1158" class="i">+
</a><a href="#h53-0-1159" id="h53-0-1159" class="i">+	if (!(opt_embed &amp;&amp; (parent = strtol(opt_embed, NULL, 0))))
</a><a href="#h53-0-1160" id="h53-0-1160" class="i">+		parent = XRootWindow(xw.dpy, xw.scr);
</a><a href="#h53-0-1161" id="h53-0-1161" class="i">+	xw.win = XCreateWindow(xw.dpy, parent, xw.l, xw.t,
</a><a href="#h53-0-1162" id="h53-0-1162" class="i">+			win.w, win.h, 0, xw.depth, InputOutput,
</a><a href="#h53-0-1163" id="h53-0-1163" class="i">+			xw.vis, CWBackPixel | CWBorderPixel | CWBitGravity
</a><a href="#h53-0-1164" id="h53-0-1164" class="i">+			| CWEventMask | CWColormap, &amp;xw.attrs);
</a><a href="#h53-0-1165" id="h53-0-1165" class="i">+
</a><a href="#h53-0-1166" id="h53-0-1166" class="i">+	memset(&amp;gcvalues, 0, sizeof(gcvalues));
</a><a href="#h53-0-1167" id="h53-0-1167" class="i">+	gcvalues.graphics_exposures = False;
</a><a href="#h53-0-1168" id="h53-0-1168" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h, xw.depth);
</a><a href="#h53-0-1169" id="h53-0-1169" class="i">+	dc.gc = XCreateGC(xw.dpy, (USE_ARGB) ? xw.buf: parent,
</a><a href="#h53-0-1170" id="h53-0-1170" class="i">+			GCGraphicsExposures, &amp;gcvalues);
</a><a href="#h53-0-1171" id="h53-0-1171" class="i">+	XSetForeground(xw.dpy, dc.gc, dc.col[defaultbg].pixel);
</a><a href="#h53-0-1172" id="h53-0-1172" class="i">+	XFillRectangle(xw.dpy, xw.buf, dc.gc, 0, 0, win.w, win.h);
</a><a href="#h53-0-1173" id="h53-0-1173" class="i">+
</a><a href="#h53-0-1174" id="h53-0-1174" class="i">+	/* font spec buffer */
</a><a href="#h53-0-1175" id="h53-0-1175" class="i">+	xw.specbuf = xmalloc(cols * sizeof(GlyphFontSpec));
</a><a href="#h53-0-1176" id="h53-0-1176" class="i">+
</a><a href="#h53-0-1177" id="h53-0-1177" class="i">+	/* Xft rendering context */
</a><a href="#h53-0-1178" id="h53-0-1178" class="i">+	xw.draw = XftDrawCreate(xw.dpy, xw.buf, xw.vis, xw.cmap);
</a><a href="#h53-0-1179" id="h53-0-1179" class="i">+
</a><a href="#h53-0-1180" id="h53-0-1180" class="i">+	/* input methods */
</a><a href="#h53-0-1181" id="h53-0-1181" class="i">+	ximopen(xw.dpy);
</a><a href="#h53-0-1182" id="h53-0-1182" class="i">+
</a><a href="#h53-0-1183" id="h53-0-1183" class="i">+	/* white cursor, black outline */
</a><a href="#h53-0-1184" id="h53-0-1184" class="i">+	xw.pointerisvisible = 1;
</a><a href="#h53-0-1185" id="h53-0-1185" class="i">+	xw.vpointer = XCreateFontCursor(xw.dpy, mouseshape);
</a><a href="#h53-0-1186" id="h53-0-1186" class="i">+	XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h53-0-1187" id="h53-0-1187" class="i">+
</a><a href="#h53-0-1188" id="h53-0-1188" class="i">+	if (XParseColor(xw.dpy, xw.cmap, colorname[mousefg], &amp;xmousefg) == 0) {
</a><a href="#h53-0-1189" id="h53-0-1189" class="i">+		xmousefg.red   = 0xffff;
</a><a href="#h53-0-1190" id="h53-0-1190" class="i">+		xmousefg.green = 0xffff;
</a><a href="#h53-0-1191" id="h53-0-1191" class="i">+		xmousefg.blue  = 0xffff;
</a><a href="#h53-0-1192" id="h53-0-1192" class="i">+	}
</a><a href="#h53-0-1193" id="h53-0-1193" class="i">+
</a><a href="#h53-0-1194" id="h53-0-1194" class="i">+	if (XParseColor(xw.dpy, xw.cmap, colorname[mousebg], &amp;xmousebg) == 0) {
</a><a href="#h53-0-1195" id="h53-0-1195" class="i">+		xmousebg.red   = 0x0000;
</a><a href="#h53-0-1196" id="h53-0-1196" class="i">+		xmousebg.green = 0x0000;
</a><a href="#h53-0-1197" id="h53-0-1197" class="i">+		xmousebg.blue  = 0x0000;
</a><a href="#h53-0-1198" id="h53-0-1198" class="i">+	}
</a><a href="#h53-0-1199" id="h53-0-1199" class="i">+
</a><a href="#h53-0-1200" id="h53-0-1200" class="i">+	XRecolorCursor(xw.dpy, xw.vpointer, &amp;xmousefg, &amp;xmousebg);
</a><a href="#h53-0-1201" id="h53-0-1201" class="i">+	blankpm = XCreateBitmapFromData(xw.dpy, xw.win, &amp;(char){0}, 1, 1);
</a><a href="#h53-0-1202" id="h53-0-1202" class="i">+	xw.bpointer = XCreatePixmapCursor(xw.dpy, blankpm, blankpm,
</a><a href="#h53-0-1203" id="h53-0-1203" class="i">+					  &amp;xmousefg, &amp;xmousebg, 0, 0);
</a><a href="#h53-0-1204" id="h53-0-1204" class="i">+
</a><a href="#h53-0-1205" id="h53-0-1205" class="i">+	xw.xembed = XInternAtom(xw.dpy, &quot;_XEMBED&quot;, False);
</a><a href="#h53-0-1206" id="h53-0-1206" class="i">+	xw.wmdeletewin = XInternAtom(xw.dpy, &quot;WM_DELETE_WINDOW&quot;, False);
</a><a href="#h53-0-1207" id="h53-0-1207" class="i">+	xw.netwmname = XInternAtom(xw.dpy, &quot;_NET_WM_NAME&quot;, False);
</a><a href="#h53-0-1208" id="h53-0-1208" class="i">+	XSetWMProtocols(xw.dpy, xw.win, &amp;xw.wmdeletewin, 1);
</a><a href="#h53-0-1209" id="h53-0-1209" class="i">+
</a><a href="#h53-0-1210" id="h53-0-1210" class="i">+	xw.netwmpid = XInternAtom(xw.dpy, &quot;_NET_WM_PID&quot;, False);
</a><a href="#h53-0-1211" id="h53-0-1211" class="i">+	XChangeProperty(xw.dpy, xw.win, xw.netwmpid, XA_CARDINAL, 32,
</a><a href="#h53-0-1212" id="h53-0-1212" class="i">+			PropModeReplace, (uchar *)&amp;thispid, 1);
</a><a href="#h53-0-1213" id="h53-0-1213" class="i">+
</a><a href="#h53-0-1214" id="h53-0-1214" class="i">+	win.mode = MODE_NUMLOCK;
</a><a href="#h53-0-1215" id="h53-0-1215" class="i">+	resettitle();
</a><a href="#h53-0-1216" id="h53-0-1216" class="i">+	XMapWindow(xw.dpy, xw.win);
</a><a href="#h53-0-1217" id="h53-0-1217" class="i">+	xhints();
</a><a href="#h53-0-1218" id="h53-0-1218" class="i">+	XSync(xw.dpy, False);
</a><a href="#h53-0-1219" id="h53-0-1219" class="i">+
</a><a href="#h53-0-1220" id="h53-0-1220" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;xsel.tclick1);
</a><a href="#h53-0-1221" id="h53-0-1221" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;xsel.tclick2);
</a><a href="#h53-0-1222" id="h53-0-1222" class="i">+	xsel.primary = NULL;
</a><a href="#h53-0-1223" id="h53-0-1223" class="i">+	xsel.clipboard = NULL;
</a><a href="#h53-0-1224" id="h53-0-1224" class="i">+	xsel.xtarget = XInternAtom(xw.dpy, &quot;UTF8_STRING&quot;, 0);
</a><a href="#h53-0-1225" id="h53-0-1225" class="i">+	if (xsel.xtarget == None)
</a><a href="#h53-0-1226" id="h53-0-1226" class="i">+		xsel.xtarget = XA_STRING;
</a><a href="#h53-0-1227" id="h53-0-1227" class="i">+}
</a><a href="#h53-0-1228" id="h53-0-1228" class="i">+
</a><a href="#h53-0-1229" id="h53-0-1229" class="i">+int
</a><a href="#h53-0-1230" id="h53-0-1230" class="i">+xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x, int y)
</a><a href="#h53-0-1231" id="h53-0-1231" class="i">+{
</a><a href="#h53-0-1232" id="h53-0-1232" class="i">+	float winx = win.hborderpx + x * win.cw, winy = win.vborderpx + y * win.ch, xp, yp;
</a><a href="#h53-0-1233" id="h53-0-1233" class="i">+	ushort mode, prevmode = USHRT_MAX;
</a><a href="#h53-0-1234" id="h53-0-1234" class="i">+	Font *font = &amp;dc.font;
</a><a href="#h53-0-1235" id="h53-0-1235" class="i">+	int frcflags = FRC_NORMAL;
</a><a href="#h53-0-1236" id="h53-0-1236" class="i">+	float runewidth = win.cw;
</a><a href="#h53-0-1237" id="h53-0-1237" class="i">+	Rune rune;
</a><a href="#h53-0-1238" id="h53-0-1238" class="i">+	FT_UInt glyphidx;
</a><a href="#h53-0-1239" id="h53-0-1239" class="i">+	FcResult fcres;
</a><a href="#h53-0-1240" id="h53-0-1240" class="i">+	FcPattern *fcpattern, *fontpattern;
</a><a href="#h53-0-1241" id="h53-0-1241" class="i">+	FcFontSet *fcsets[] = { NULL };
</a><a href="#h53-0-1242" id="h53-0-1242" class="i">+	FcCharSet *fccharset;
</a><a href="#h53-0-1243" id="h53-0-1243" class="i">+	int i, f, numspecs = 0;
</a><a href="#h53-0-1244" id="h53-0-1244" class="i">+
</a><a href="#h53-0-1245" id="h53-0-1245" class="i">+	for (i = 0, xp = winx, yp = winy + font-&gt;ascent; i &lt; len; ++i) {
</a><a href="#h53-0-1246" id="h53-0-1246" class="i">+		/* Fetch rune and mode for current glyph. */
</a><a href="#h53-0-1247" id="h53-0-1247" class="i">+		rune = glyphs[i].u;
</a><a href="#h53-0-1248" id="h53-0-1248" class="i">+		mode = glyphs[i].mode;
</a><a href="#h53-0-1249" id="h53-0-1249" class="i">+
</a><a href="#h53-0-1250" id="h53-0-1250" class="i">+		/* Skip dummy wide-character spacing. */
</a><a href="#h53-0-1251" id="h53-0-1251" class="i">+		if (mode == ATTR_WDUMMY)
</a><a href="#h53-0-1252" id="h53-0-1252" class="i">+			continue;
</a><a href="#h53-0-1253" id="h53-0-1253" class="i">+
</a><a href="#h53-0-1254" id="h53-0-1254" class="i">+		/* Determine font for glyph if different from previous glyph. */
</a><a href="#h53-0-1255" id="h53-0-1255" class="i">+		if (prevmode != mode) {
</a><a href="#h53-0-1256" id="h53-0-1256" class="i">+			prevmode = mode;
</a><a href="#h53-0-1257" id="h53-0-1257" class="i">+			font = &amp;dc.font;
</a><a href="#h53-0-1258" id="h53-0-1258" class="i">+			frcflags = FRC_NORMAL;
</a><a href="#h53-0-1259" id="h53-0-1259" class="i">+			runewidth = win.cw * ((mode &amp; ATTR_WIDE) ? 2.0f : 1.0f);
</a><a href="#h53-0-1260" id="h53-0-1260" class="i">+			if ((mode &amp; ATTR_ITALIC) &amp;&amp; (mode &amp; ATTR_BOLD)) {
</a><a href="#h53-0-1261" id="h53-0-1261" class="i">+				font = &amp;dc.ibfont;
</a><a href="#h53-0-1262" id="h53-0-1262" class="i">+				frcflags = FRC_ITALICBOLD;
</a><a href="#h53-0-1263" id="h53-0-1263" class="i">+			} else if (mode &amp; ATTR_ITALIC) {
</a><a href="#h53-0-1264" id="h53-0-1264" class="i">+				font = &amp;dc.ifont;
</a><a href="#h53-0-1265" id="h53-0-1265" class="i">+				frcflags = FRC_ITALIC;
</a><a href="#h53-0-1266" id="h53-0-1266" class="i">+			} else if (mode &amp; ATTR_BOLD) {
</a><a href="#h53-0-1267" id="h53-0-1267" class="i">+				font = &amp;dc.bfont;
</a><a href="#h53-0-1268" id="h53-0-1268" class="i">+				frcflags = FRC_BOLD;
</a><a href="#h53-0-1269" id="h53-0-1269" class="i">+			}
</a><a href="#h53-0-1270" id="h53-0-1270" class="i">+			yp = winy + font-&gt;ascent;
</a><a href="#h53-0-1271" id="h53-0-1271" class="i">+		}
</a><a href="#h53-0-1272" id="h53-0-1272" class="i">+
</a><a href="#h53-0-1273" id="h53-0-1273" class="i">+		/* Lookup character index with default font. */
</a><a href="#h53-0-1274" id="h53-0-1274" class="i">+		glyphidx = XftCharIndex(xw.dpy, font-&gt;match, rune);
</a><a href="#h53-0-1275" id="h53-0-1275" class="i">+		if (glyphidx) {
</a><a href="#h53-0-1276" id="h53-0-1276" class="i">+			specs[numspecs].font = font-&gt;match;
</a><a href="#h53-0-1277" id="h53-0-1277" class="i">+			specs[numspecs].glyph = glyphidx;
</a><a href="#h53-0-1278" id="h53-0-1278" class="i">+			specs[numspecs].x = (short)xp;
</a><a href="#h53-0-1279" id="h53-0-1279" class="i">+			specs[numspecs].y = (short)yp;
</a><a href="#h53-0-1280" id="h53-0-1280" class="i">+			xp += runewidth;
</a><a href="#h53-0-1281" id="h53-0-1281" class="i">+			numspecs++;
</a><a href="#h53-0-1282" id="h53-0-1282" class="i">+			continue;
</a><a href="#h53-0-1283" id="h53-0-1283" class="i">+		}
</a><a href="#h53-0-1284" id="h53-0-1284" class="i">+
</a><a href="#h53-0-1285" id="h53-0-1285" class="i">+		/* Fallback on font cache, search the font cache for match. */
</a><a href="#h53-0-1286" id="h53-0-1286" class="i">+		for (f = 0; f &lt; frclen; f++) {
</a><a href="#h53-0-1287" id="h53-0-1287" class="i">+			glyphidx = XftCharIndex(xw.dpy, frc[f].font, rune);
</a><a href="#h53-0-1288" id="h53-0-1288" class="i">+			/* Everything correct. */
</a><a href="#h53-0-1289" id="h53-0-1289" class="i">+			if (glyphidx &amp;&amp; frc[f].flags == frcflags)
</a><a href="#h53-0-1290" id="h53-0-1290" class="i">+				break;
</a><a href="#h53-0-1291" id="h53-0-1291" class="i">+			/* We got a default font for a not found glyph. */
</a><a href="#h53-0-1292" id="h53-0-1292" class="i">+			if (!glyphidx &amp;&amp; frc[f].flags == frcflags
</a><a href="#h53-0-1293" id="h53-0-1293" class="i">+					&amp;&amp; frc[f].unicodep == rune) {
</a><a href="#h53-0-1294" id="h53-0-1294" class="i">+				break;
</a><a href="#h53-0-1295" id="h53-0-1295" class="i">+			}
</a><a href="#h53-0-1296" id="h53-0-1296" class="i">+		}
</a><a href="#h53-0-1297" id="h53-0-1297" class="i">+
</a><a href="#h53-0-1298" id="h53-0-1298" class="i">+		/* Nothing was found. Use fontconfig to find matching font. */
</a><a href="#h53-0-1299" id="h53-0-1299" class="i">+		if (f &gt;= frclen) {
</a><a href="#h53-0-1300" id="h53-0-1300" class="i">+			if (!font-&gt;set)
</a><a href="#h53-0-1301" id="h53-0-1301" class="i">+				font-&gt;set = FcFontSort(0, font-&gt;pattern,
</a><a href="#h53-0-1302" id="h53-0-1302" class="i">+				                       1, 0, &amp;fcres);
</a><a href="#h53-0-1303" id="h53-0-1303" class="i">+			fcsets[0] = font-&gt;set;
</a><a href="#h53-0-1304" id="h53-0-1304" class="i">+
</a><a href="#h53-0-1305" id="h53-0-1305" class="i">+			/*
</a><a href="#h53-0-1306" id="h53-0-1306" class="i">+			 * Nothing was found in the cache. Now use
</a><a href="#h53-0-1307" id="h53-0-1307" class="i">+			 * some dozen of Fontconfig calls to get the
</a><a href="#h53-0-1308" id="h53-0-1308" class="i">+			 * font for one single character.
</a><a href="#h53-0-1309" id="h53-0-1309" class="i">+			 *
</a><a href="#h53-0-1310" id="h53-0-1310" class="i">+			 * Xft and fontconfig are design failures.
</a><a href="#h53-0-1311" id="h53-0-1311" class="i">+			 */
</a><a href="#h53-0-1312" id="h53-0-1312" class="i">+			fcpattern = FcPatternDuplicate(font-&gt;pattern);
</a><a href="#h53-0-1313" id="h53-0-1313" class="i">+			fccharset = FcCharSetCreate();
</a><a href="#h53-0-1314" id="h53-0-1314" class="i">+
</a><a href="#h53-0-1315" id="h53-0-1315" class="i">+			FcCharSetAddChar(fccharset, rune);
</a><a href="#h53-0-1316" id="h53-0-1316" class="i">+			FcPatternAddCharSet(fcpattern, FC_CHARSET,
</a><a href="#h53-0-1317" id="h53-0-1317" class="i">+					fccharset);
</a><a href="#h53-0-1318" id="h53-0-1318" class="i">+			FcPatternAddBool(fcpattern, FC_SCALABLE, 1);
</a><a href="#h53-0-1319" id="h53-0-1319" class="i">+
</a><a href="#h53-0-1320" id="h53-0-1320" class="i">+			FcConfigSubstitute(0, fcpattern,
</a><a href="#h53-0-1321" id="h53-0-1321" class="i">+					FcMatchPattern);
</a><a href="#h53-0-1322" id="h53-0-1322" class="i">+			FcDefaultSubstitute(fcpattern);
</a><a href="#h53-0-1323" id="h53-0-1323" class="i">+
</a><a href="#h53-0-1324" id="h53-0-1324" class="i">+			fontpattern = FcFontSetMatch(0, fcsets, 1,
</a><a href="#h53-0-1325" id="h53-0-1325" class="i">+					fcpattern, &amp;fcres);
</a><a href="#h53-0-1326" id="h53-0-1326" class="i">+
</a><a href="#h53-0-1327" id="h53-0-1327" class="i">+			/*
</a><a href="#h53-0-1328" id="h53-0-1328" class="i">+			 * Overwrite or create the new cache entry.
</a><a href="#h53-0-1329" id="h53-0-1329" class="i">+			 */
</a><a href="#h53-0-1330" id="h53-0-1330" class="i">+			if (frclen &gt;= LEN(frc)) {
</a><a href="#h53-0-1331" id="h53-0-1331" class="i">+				frclen = LEN(frc) - 1;
</a><a href="#h53-0-1332" id="h53-0-1332" class="i">+				XftFontClose(xw.dpy, frc[frclen].font);
</a><a href="#h53-0-1333" id="h53-0-1333" class="i">+				frc[frclen].unicodep = 0;
</a><a href="#h53-0-1334" id="h53-0-1334" class="i">+			}
</a><a href="#h53-0-1335" id="h53-0-1335" class="i">+
</a><a href="#h53-0-1336" id="h53-0-1336" class="i">+			frc[frclen].font = XftFontOpenPattern(xw.dpy,
</a><a href="#h53-0-1337" id="h53-0-1337" class="i">+					fontpattern);
</a><a href="#h53-0-1338" id="h53-0-1338" class="i">+			if (!frc[frclen].font)
</a><a href="#h53-0-1339" id="h53-0-1339" class="i">+				die(&quot;XftFontOpenPattern failed seeking fallback font: %s\n&quot;,
</a><a href="#h53-0-1340" id="h53-0-1340" class="i">+					strerror(errno));
</a><a href="#h53-0-1341" id="h53-0-1341" class="i">+			frc[frclen].flags = frcflags;
</a><a href="#h53-0-1342" id="h53-0-1342" class="i">+			frc[frclen].unicodep = rune;
</a><a href="#h53-0-1343" id="h53-0-1343" class="i">+
</a><a href="#h53-0-1344" id="h53-0-1344" class="i">+			glyphidx = XftCharIndex(xw.dpy, frc[frclen].font, rune);
</a><a href="#h53-0-1345" id="h53-0-1345" class="i">+
</a><a href="#h53-0-1346" id="h53-0-1346" class="i">+			f = frclen;
</a><a href="#h53-0-1347" id="h53-0-1347" class="i">+			frclen++;
</a><a href="#h53-0-1348" id="h53-0-1348" class="i">+
</a><a href="#h53-0-1349" id="h53-0-1349" class="i">+			FcPatternDestroy(fcpattern);
</a><a href="#h53-0-1350" id="h53-0-1350" class="i">+			FcCharSetDestroy(fccharset);
</a><a href="#h53-0-1351" id="h53-0-1351" class="i">+		}
</a><a href="#h53-0-1352" id="h53-0-1352" class="i">+
</a><a href="#h53-0-1353" id="h53-0-1353" class="i">+		specs[numspecs].font = frc[f].font;
</a><a href="#h53-0-1354" id="h53-0-1354" class="i">+		specs[numspecs].glyph = glyphidx;
</a><a href="#h53-0-1355" id="h53-0-1355" class="i">+		specs[numspecs].x = (short)xp;
</a><a href="#h53-0-1356" id="h53-0-1356" class="i">+		specs[numspecs].y = (short)yp;
</a><a href="#h53-0-1357" id="h53-0-1357" class="i">+		xp += runewidth;
</a><a href="#h53-0-1358" id="h53-0-1358" class="i">+		numspecs++;
</a><a href="#h53-0-1359" id="h53-0-1359" class="i">+	}
</a><a href="#h53-0-1360" id="h53-0-1360" class="i">+
</a><a href="#h53-0-1361" id="h53-0-1361" class="i">+	return numspecs;
</a><a href="#h53-0-1362" id="h53-0-1362" class="i">+}
</a><a href="#h53-0-1363" id="h53-0-1363" class="i">+
</a><a href="#h53-0-1364" id="h53-0-1364" class="i">+void
</a><a href="#h53-0-1365" id="h53-0-1365" class="i">+xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, int y)
</a><a href="#h53-0-1366" id="h53-0-1366" class="i">+{
</a><a href="#h53-0-1367" id="h53-0-1367" class="i">+	int charlen = len * ((base.mode &amp; ATTR_WIDE) ? 2 : 1);
</a><a href="#h53-0-1368" id="h53-0-1368" class="i">+	int winx = win.hborderpx + x * win.cw, winy = win.vborderpx + y * win.ch,
</a><a href="#h53-0-1369" id="h53-0-1369" class="i">+	    width = charlen * win.cw;
</a><a href="#h53-0-1370" id="h53-0-1370" class="i">+	Color *fg, *bg, *temp, revfg, revbg, truefg, truebg;
</a><a href="#h53-0-1371" id="h53-0-1371" class="i">+	XRenderColor colfg, colbg;
</a><a href="#h53-0-1372" id="h53-0-1372" class="i">+	XRectangle r;
</a><a href="#h53-0-1373" id="h53-0-1373" class="i">+
</a><a href="#h53-0-1374" id="h53-0-1374" class="i">+	/* Fallback on color display for attributes not supported by the font */
</a><a href="#h53-0-1375" id="h53-0-1375" class="i">+	if (base.mode &amp; ATTR_ITALIC &amp;&amp; base.mode &amp; ATTR_BOLD) {
</a><a href="#h53-0-1376" id="h53-0-1376" class="i">+		if (dc.ibfont.badslant || dc.ibfont.badweight)
</a><a href="#h53-0-1377" id="h53-0-1377" class="i">+			base.fg = defaultattr;
</a><a href="#h53-0-1378" id="h53-0-1378" class="i">+	} else if ((base.mode &amp; ATTR_ITALIC &amp;&amp; dc.ifont.badslant) ||
</a><a href="#h53-0-1379" id="h53-0-1379" class="i">+	    (base.mode &amp; ATTR_BOLD &amp;&amp; dc.bfont.badweight)) {
</a><a href="#h53-0-1380" id="h53-0-1380" class="i">+		base.fg = defaultattr;
</a><a href="#h53-0-1381" id="h53-0-1381" class="i">+	}
</a><a href="#h53-0-1382" id="h53-0-1382" class="i">+
</a><a href="#h53-0-1383" id="h53-0-1383" class="i">+	if (IS_TRUECOL(base.fg)) {
</a><a href="#h53-0-1384" id="h53-0-1384" class="i">+		colfg.alpha = 0xffff;
</a><a href="#h53-0-1385" id="h53-0-1385" class="i">+		colfg.red = TRUERED(base.fg);
</a><a href="#h53-0-1386" id="h53-0-1386" class="i">+		colfg.green = TRUEGREEN(base.fg);
</a><a href="#h53-0-1387" id="h53-0-1387" class="i">+		colfg.blue = TRUEBLUE(base.fg);
</a><a href="#h53-0-1388" id="h53-0-1388" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg, &amp;truefg);
</a><a href="#h53-0-1389" id="h53-0-1389" class="i">+		fg = &amp;truefg;
</a><a href="#h53-0-1390" id="h53-0-1390" class="i">+	} else {
</a><a href="#h53-0-1391" id="h53-0-1391" class="i">+		fg = &amp;dc.col[base.fg];
</a><a href="#h53-0-1392" id="h53-0-1392" class="i">+	}
</a><a href="#h53-0-1393" id="h53-0-1393" class="i">+
</a><a href="#h53-0-1394" id="h53-0-1394" class="i">+	if (IS_TRUECOL(base.bg)) {
</a><a href="#h53-0-1395" id="h53-0-1395" class="i">+		colbg.alpha = 0xffff;
</a><a href="#h53-0-1396" id="h53-0-1396" class="i">+		colbg.green = TRUEGREEN(base.bg);
</a><a href="#h53-0-1397" id="h53-0-1397" class="i">+		colbg.red = TRUERED(base.bg);
</a><a href="#h53-0-1398" id="h53-0-1398" class="i">+		colbg.blue = TRUEBLUE(base.bg);
</a><a href="#h53-0-1399" id="h53-0-1399" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colbg, &amp;truebg);
</a><a href="#h53-0-1400" id="h53-0-1400" class="i">+		bg = &amp;truebg;
</a><a href="#h53-0-1401" id="h53-0-1401" class="i">+	} else {
</a><a href="#h53-0-1402" id="h53-0-1402" class="i">+		bg = &amp;dc.col[base.bg];
</a><a href="#h53-0-1403" id="h53-0-1403" class="i">+	}
</a><a href="#h53-0-1404" id="h53-0-1404" class="i">+
</a><a href="#h53-0-1405" id="h53-0-1405" class="i">+	/* Change basic system colors [0-7] to bright system colors [8-15] */
</a><a href="#h53-0-1406" id="h53-0-1406" class="i">+	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_BOLD &amp;&amp; BETWEEN(base.fg, 0, 7))
</a><a href="#h53-0-1407" id="h53-0-1407" class="i">+		fg = &amp;dc.col[base.fg + 8];
</a><a href="#h53-0-1408" id="h53-0-1408" class="i">+
</a><a href="#h53-0-1409" id="h53-0-1409" class="i">+	if (IS_SET(MODE_REVERSE)) {
</a><a href="#h53-0-1410" id="h53-0-1410" class="i">+		if (fg == &amp;dc.col[defaultfg]) {
</a><a href="#h53-0-1411" id="h53-0-1411" class="i">+			fg = &amp;dc.col[defaultbg];
</a><a href="#h53-0-1412" id="h53-0-1412" class="i">+		} else {
</a><a href="#h53-0-1413" id="h53-0-1413" class="i">+			colfg.red = ~fg-&gt;color.red;
</a><a href="#h53-0-1414" id="h53-0-1414" class="i">+			colfg.green = ~fg-&gt;color.green;
</a><a href="#h53-0-1415" id="h53-0-1415" class="i">+			colfg.blue = ~fg-&gt;color.blue;
</a><a href="#h53-0-1416" id="h53-0-1416" class="i">+			colfg.alpha = fg-&gt;color.alpha;
</a><a href="#h53-0-1417" id="h53-0-1417" class="i">+			XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg,
</a><a href="#h53-0-1418" id="h53-0-1418" class="i">+					&amp;revfg);
</a><a href="#h53-0-1419" id="h53-0-1419" class="i">+			fg = &amp;revfg;
</a><a href="#h53-0-1420" id="h53-0-1420" class="i">+		}
</a><a href="#h53-0-1421" id="h53-0-1421" class="i">+
</a><a href="#h53-0-1422" id="h53-0-1422" class="i">+		if (bg == &amp;dc.col[defaultbg]) {
</a><a href="#h53-0-1423" id="h53-0-1423" class="i">+			bg = &amp;dc.col[defaultfg];
</a><a href="#h53-0-1424" id="h53-0-1424" class="i">+		} else {
</a><a href="#h53-0-1425" id="h53-0-1425" class="i">+			colbg.red = ~bg-&gt;color.red;
</a><a href="#h53-0-1426" id="h53-0-1426" class="i">+			colbg.green = ~bg-&gt;color.green;
</a><a href="#h53-0-1427" id="h53-0-1427" class="i">+			colbg.blue = ~bg-&gt;color.blue;
</a><a href="#h53-0-1428" id="h53-0-1428" class="i">+			colbg.alpha = bg-&gt;color.alpha;
</a><a href="#h53-0-1429" id="h53-0-1429" class="i">+			XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colbg,
</a><a href="#h53-0-1430" id="h53-0-1430" class="i">+					&amp;revbg);
</a><a href="#h53-0-1431" id="h53-0-1431" class="i">+			bg = &amp;revbg;
</a><a href="#h53-0-1432" id="h53-0-1432" class="i">+		}
</a><a href="#h53-0-1433" id="h53-0-1433" class="i">+	}
</a><a href="#h53-0-1434" id="h53-0-1434" class="i">+
</a><a href="#h53-0-1435" id="h53-0-1435" class="i">+	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_FAINT) {
</a><a href="#h53-0-1436" id="h53-0-1436" class="i">+		colfg.red = fg-&gt;color.red / 2;
</a><a href="#h53-0-1437" id="h53-0-1437" class="i">+		colfg.green = fg-&gt;color.green / 2;
</a><a href="#h53-0-1438" id="h53-0-1438" class="i">+		colfg.blue = fg-&gt;color.blue / 2;
</a><a href="#h53-0-1439" id="h53-0-1439" class="i">+		colfg.alpha = fg-&gt;color.alpha;
</a><a href="#h53-0-1440" id="h53-0-1440" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg, &amp;revfg);
</a><a href="#h53-0-1441" id="h53-0-1441" class="i">+		fg = &amp;revfg;
</a><a href="#h53-0-1442" id="h53-0-1442" class="i">+	}
</a><a href="#h53-0-1443" id="h53-0-1443" class="i">+
</a><a href="#h53-0-1444" id="h53-0-1444" class="i">+	if (base.mode &amp; ATTR_REVERSE) {
</a><a href="#h53-0-1445" id="h53-0-1445" class="i">+		temp = fg;
</a><a href="#h53-0-1446" id="h53-0-1446" class="i">+		fg = bg;
</a><a href="#h53-0-1447" id="h53-0-1447" class="i">+		bg = temp;
</a><a href="#h53-0-1448" id="h53-0-1448" class="i">+	}
</a><a href="#h53-0-1449" id="h53-0-1449" class="i">+
</a><a href="#h53-0-1450" id="h53-0-1450" class="i">+	if (base.mode &amp; ATTR_BLINK &amp;&amp; win.mode &amp; MODE_BLINK)
</a><a href="#h53-0-1451" id="h53-0-1451" class="i">+		fg = bg;
</a><a href="#h53-0-1452" id="h53-0-1452" class="i">+
</a><a href="#h53-0-1453" id="h53-0-1453" class="i">+	if (base.mode &amp; ATTR_INVISIBLE)
</a><a href="#h53-0-1454" id="h53-0-1454" class="i">+		fg = bg;
</a><a href="#h53-0-1455" id="h53-0-1455" class="i">+
</a><a href="#h53-0-1456" id="h53-0-1456" class="i">+	/* Intelligent cleaning up of the borders. */
</a><a href="#h53-0-1457" id="h53-0-1457" class="i">+	if (x == 0) {
</a><a href="#h53-0-1458" id="h53-0-1458" class="i">+		xclear(0, (y == 0)? 0 : winy, win.vborderpx,
</a><a href="#h53-0-1459" id="h53-0-1459" class="i">+			winy + win.ch +
</a><a href="#h53-0-1460" id="h53-0-1460" class="i">+			((winy + win.ch &gt;= win.vborderpx + win.th)? win.h : 0));
</a><a href="#h53-0-1461" id="h53-0-1461" class="i">+	}
</a><a href="#h53-0-1462" id="h53-0-1462" class="i">+	if (winx + width &gt;= win.hborderpx + win.tw) {
</a><a href="#h53-0-1463" id="h53-0-1463" class="i">+		xclear(winx + width, (y == 0)? 0 : winy, win.w,
</a><a href="#h53-0-1464" id="h53-0-1464" class="i">+			((winy + win.ch &gt;= win.vborderpx + win.th)? win.h : (winy + win.ch)));
</a><a href="#h53-0-1465" id="h53-0-1465" class="i">+	}
</a><a href="#h53-0-1466" id="h53-0-1466" class="i">+	if (y == 0)
</a><a href="#h53-0-1467" id="h53-0-1467" class="i">+		xclear(winx, 0, winx + width, win.hborderpx);
</a><a href="#h53-0-1468" id="h53-0-1468" class="i">+	if (winy + win.ch &gt;= win.vborderpx + win.th)
</a><a href="#h53-0-1469" id="h53-0-1469" class="i">+		xclear(winx, winy + win.ch, winx + width, win.h);
</a><a href="#h53-0-1470" id="h53-0-1470" class="i">+
</a><a href="#h53-0-1471" id="h53-0-1471" class="i">+	/* Clean up the region we want to draw to. */
</a><a href="#h53-0-1472" id="h53-0-1472" class="i">+	XftDrawRect(xw.draw, bg, winx, winy, width, win.ch);
</a><a href="#h53-0-1473" id="h53-0-1473" class="i">+
</a><a href="#h53-0-1474" id="h53-0-1474" class="i">+	/* Set the clip region because Xft is sometimes dirty. */
</a><a href="#h53-0-1475" id="h53-0-1475" class="i">+	r.x = 0;
</a><a href="#h53-0-1476" id="h53-0-1476" class="i">+	r.y = 0;
</a><a href="#h53-0-1477" id="h53-0-1477" class="i">+	r.height = win.ch;
</a><a href="#h53-0-1478" id="h53-0-1478" class="i">+	r.width = width;
</a><a href="#h53-0-1479" id="h53-0-1479" class="i">+	XftDrawSetClipRectangles(xw.draw, winx, winy, &amp;r, 1);
</a><a href="#h53-0-1480" id="h53-0-1480" class="i">+
</a><a href="#h53-0-1481" id="h53-0-1481" class="i">+	/* Render the glyphs. */
</a><a href="#h53-0-1482" id="h53-0-1482" class="i">+	XftDrawGlyphFontSpec(xw.draw, fg, specs, len);
</a><a href="#h53-0-1483" id="h53-0-1483" class="i">+
</a><a href="#h53-0-1484" id="h53-0-1484" class="i">+	/* Render underline and strikethrough. */
</a><a href="#h53-0-1485" id="h53-0-1485" class="i">+	if (base.mode &amp; ATTR_UNDERLINE) {
</a><a href="#h53-0-1486" id="h53-0-1486" class="i">+		XftDrawRect(xw.draw, fg, winx, winy + dc.font.ascent + 1,
</a><a href="#h53-0-1487" id="h53-0-1487" class="i">+				width, 1);
</a><a href="#h53-0-1488" id="h53-0-1488" class="i">+	}
</a><a href="#h53-0-1489" id="h53-0-1489" class="i">+
</a><a href="#h53-0-1490" id="h53-0-1490" class="i">+	if (base.mode &amp; ATTR_STRUCK) {
</a><a href="#h53-0-1491" id="h53-0-1491" class="i">+		XftDrawRect(xw.draw, fg, winx, winy + 2 * dc.font.ascent / 3,
</a><a href="#h53-0-1492" id="h53-0-1492" class="i">+				width, 1);
</a><a href="#h53-0-1493" id="h53-0-1493" class="i">+	}
</a><a href="#h53-0-1494" id="h53-0-1494" class="i">+
</a><a href="#h53-0-1495" id="h53-0-1495" class="i">+	/* Reset clip to none. */
</a><a href="#h53-0-1496" id="h53-0-1496" class="i">+	XftDrawSetClip(xw.draw, 0);
</a><a href="#h53-0-1497" id="h53-0-1497" class="i">+}
</a><a href="#h53-0-1498" id="h53-0-1498" class="i">+
</a><a href="#h53-0-1499" id="h53-0-1499" class="i">+void
</a><a href="#h53-0-1500" id="h53-0-1500" class="i">+xdrawglyph(Glyph g, int x, int y)
</a><a href="#h53-0-1501" id="h53-0-1501" class="i">+{
</a><a href="#h53-0-1502" id="h53-0-1502" class="i">+	int numspecs;
</a><a href="#h53-0-1503" id="h53-0-1503" class="i">+	XftGlyphFontSpec spec;
</a><a href="#h53-0-1504" id="h53-0-1504" class="i">+
</a><a href="#h53-0-1505" id="h53-0-1505" class="i">+	numspecs = xmakeglyphfontspecs(&amp;spec, &amp;g, 1, x, y);
</a><a href="#h53-0-1506" id="h53-0-1506" class="i">+	xdrawglyphfontspecs(&amp;spec, g, numspecs, x, y);
</a><a href="#h53-0-1507" id="h53-0-1507" class="i">+}
</a><a href="#h53-0-1508" id="h53-0-1508" class="i">+
</a><a href="#h53-0-1509" id="h53-0-1509" class="i">+void
</a><a href="#h53-0-1510" id="h53-0-1510" class="i">+xdrawcursor(int cx, int cy, Glyph g, int ox, int oy, Glyph og)
</a><a href="#h53-0-1511" id="h53-0-1511" class="i">+{
</a><a href="#h53-0-1512" id="h53-0-1512" class="i">+	Color drawcol;
</a><a href="#h53-0-1513" id="h53-0-1513" class="i">+
</a><a href="#h53-0-1514" id="h53-0-1514" class="i">+	/* remove the old cursor */
</a><a href="#h53-0-1515" id="h53-0-1515" class="i">+	if (selected(ox, oy))
</a><a href="#h53-0-1516" id="h53-0-1516" class="i">+		og.mode ^= ATTR_REVERSE;
</a><a href="#h53-0-1517" id="h53-0-1517" class="i">+	xdrawglyph(og, ox, oy);
</a><a href="#h53-0-1518" id="h53-0-1518" class="i">+
</a><a href="#h53-0-1519" id="h53-0-1519" class="i">+	if (IS_SET(MODE_HIDE))
</a><a href="#h53-0-1520" id="h53-0-1520" class="i">+		return;
</a><a href="#h53-0-1521" id="h53-0-1521" class="i">+
</a><a href="#h53-0-1522" id="h53-0-1522" class="i">+	/*
</a><a href="#h53-0-1523" id="h53-0-1523" class="i">+	 * Select the right color for the right mode.
</a><a href="#h53-0-1524" id="h53-0-1524" class="i">+	 */
</a><a href="#h53-0-1525" id="h53-0-1525" class="i">+	g.mode &amp;= ATTR_BOLD|ATTR_ITALIC|ATTR_UNDERLINE|ATTR_STRUCK|ATTR_WIDE;
</a><a href="#h53-0-1526" id="h53-0-1526" class="i">+
</a><a href="#h53-0-1527" id="h53-0-1527" class="i">+	if (IS_SET(MODE_REVERSE)) {
</a><a href="#h53-0-1528" id="h53-0-1528" class="i">+		g.mode |= ATTR_REVERSE;
</a><a href="#h53-0-1529" id="h53-0-1529" class="i">+		g.bg = defaultfg;
</a><a href="#h53-0-1530" id="h53-0-1530" class="i">+		if (selected(cx, cy)) {
</a><a href="#h53-0-1531" id="h53-0-1531" class="i">+			drawcol = dc.col[defaultcs];
</a><a href="#h53-0-1532" id="h53-0-1532" class="i">+			g.fg = defaultrcs;
</a><a href="#h53-0-1533" id="h53-0-1533" class="i">+		} else {
</a><a href="#h53-0-1534" id="h53-0-1534" class="i">+			drawcol = dc.col[defaultrcs];
</a><a href="#h53-0-1535" id="h53-0-1535" class="i">+			g.fg = defaultcs;
</a><a href="#h53-0-1536" id="h53-0-1536" class="i">+		}
</a><a href="#h53-0-1537" id="h53-0-1537" class="i">+	} else {
</a><a href="#h53-0-1538" id="h53-0-1538" class="i">+		if (selected(cx, cy)) {
</a><a href="#h53-0-1539" id="h53-0-1539" class="i">+			g.fg = defaultfg;
</a><a href="#h53-0-1540" id="h53-0-1540" class="i">+			g.bg = defaultrcs;
</a><a href="#h53-0-1541" id="h53-0-1541" class="i">+		} else {
</a><a href="#h53-0-1542" id="h53-0-1542" class="i">+			g.fg = defaultbg;
</a><a href="#h53-0-1543" id="h53-0-1543" class="i">+			g.bg = defaultcs;
</a><a href="#h53-0-1544" id="h53-0-1544" class="i">+		}
</a><a href="#h53-0-1545" id="h53-0-1545" class="i">+		drawcol = dc.col[g.bg];
</a><a href="#h53-0-1546" id="h53-0-1546" class="i">+	}
</a><a href="#h53-0-1547" id="h53-0-1547" class="i">+
</a><a href="#h53-0-1548" id="h53-0-1548" class="i">+	/* draw the new one */
</a><a href="#h53-0-1549" id="h53-0-1549" class="i">+	if (IS_SET(MODE_FOCUSED)) {
</a><a href="#h53-0-1550" id="h53-0-1550" class="i">+		switch (win.cursor) {
</a><a href="#h53-0-1551" id="h53-0-1551" class="i">+		case 7: /* st extension: snowman (U+2603) */
</a><a href="#h53-0-1552" id="h53-0-1552" class="i">+			g.u = 0x2603;
</a><a href="#h53-0-1553" id="h53-0-1553" class="i">+		case 0: /* Blinking Block */
</a><a href="#h53-0-1554" id="h53-0-1554" class="i">+		case 1: /* Blinking Block (Default) */
</a><a href="#h53-0-1555" id="h53-0-1555" class="i">+		case 2: /* Steady Block */
</a><a href="#h53-0-1556" id="h53-0-1556" class="i">+			xdrawglyph(g, cx, cy);
</a><a href="#h53-0-1557" id="h53-0-1557" class="i">+			break;
</a><a href="#h53-0-1558" id="h53-0-1558" class="i">+		case 3: /* Blinking Underline */
</a><a href="#h53-0-1559" id="h53-0-1559" class="i">+		case 4: /* Steady Underline */
</a><a href="#h53-0-1560" id="h53-0-1560" class="i">+			XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h53-0-1561" id="h53-0-1561" class="i">+					win.hborderpx + cx * win.cw,
</a><a href="#h53-0-1562" id="h53-0-1562" class="i">+					win.vborderpx + (cy + 1) * win.ch - \
</a><a href="#h53-0-1563" id="h53-0-1563" class="i">+						cursorthickness,
</a><a href="#h53-0-1564" id="h53-0-1564" class="i">+					win.cw, cursorthickness);
</a><a href="#h53-0-1565" id="h53-0-1565" class="i">+			break;
</a><a href="#h53-0-1566" id="h53-0-1566" class="i">+		case 5: /* Blinking bar */
</a><a href="#h53-0-1567" id="h53-0-1567" class="i">+		case 6: /* Steady bar */
</a><a href="#h53-0-1568" id="h53-0-1568" class="i">+			XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h53-0-1569" id="h53-0-1569" class="i">+					win.hborderpx + cx * win.cw,
</a><a href="#h53-0-1570" id="h53-0-1570" class="i">+					win.vborderpx + cy * win.ch,
</a><a href="#h53-0-1571" id="h53-0-1571" class="i">+					cursorthickness, win.ch);
</a><a href="#h53-0-1572" id="h53-0-1572" class="i">+			break;
</a><a href="#h53-0-1573" id="h53-0-1573" class="i">+		}
</a><a href="#h53-0-1574" id="h53-0-1574" class="i">+	} else {
</a><a href="#h53-0-1575" id="h53-0-1575" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h53-0-1576" id="h53-0-1576" class="i">+				win.hborderpx + cx * win.cw,
</a><a href="#h53-0-1577" id="h53-0-1577" class="i">+				win.vborderpx + cy * win.ch,
</a><a href="#h53-0-1578" id="h53-0-1578" class="i">+				win.cw - 1, 1);
</a><a href="#h53-0-1579" id="h53-0-1579" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h53-0-1580" id="h53-0-1580" class="i">+				win.hborderpx + cx * win.cw,
</a><a href="#h53-0-1581" id="h53-0-1581" class="i">+				win.vborderpx + cy * win.ch,
</a><a href="#h53-0-1582" id="h53-0-1582" class="i">+				1, win.ch - 1);
</a><a href="#h53-0-1583" id="h53-0-1583" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h53-0-1584" id="h53-0-1584" class="i">+				win.hborderpx + (cx + 1) * win.cw - 1,
</a><a href="#h53-0-1585" id="h53-0-1585" class="i">+				win.vborderpx + cy * win.ch,
</a><a href="#h53-0-1586" id="h53-0-1586" class="i">+				1, win.ch - 1);
</a><a href="#h53-0-1587" id="h53-0-1587" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h53-0-1588" id="h53-0-1588" class="i">+				win.hborderpx + cx * win.cw,
</a><a href="#h53-0-1589" id="h53-0-1589" class="i">+				win.vborderpx + (cy + 1) * win.ch - 1,
</a><a href="#h53-0-1590" id="h53-0-1590" class="i">+				win.cw, 1);
</a><a href="#h53-0-1591" id="h53-0-1591" class="i">+	}
</a><a href="#h53-0-1592" id="h53-0-1592" class="i">+}
</a><a href="#h53-0-1593" id="h53-0-1593" class="i">+
</a><a href="#h53-0-1594" id="h53-0-1594" class="i">+void
</a><a href="#h53-0-1595" id="h53-0-1595" class="i">+xsetenv(void)
</a><a href="#h53-0-1596" id="h53-0-1596" class="i">+{
</a><a href="#h53-0-1597" id="h53-0-1597" class="i">+	char buf[sizeof(long) * 8 + 1];
</a><a href="#h53-0-1598" id="h53-0-1598" class="i">+
</a><a href="#h53-0-1599" id="h53-0-1599" class="i">+	snprintf(buf, sizeof(buf), &quot;%lu&quot;, xw.win);
</a><a href="#h53-0-1600" id="h53-0-1600" class="i">+	setenv(&quot;WINDOWID&quot;, buf, 1);
</a><a href="#h53-0-1601" id="h53-0-1601" class="i">+}
</a><a href="#h53-0-1602" id="h53-0-1602" class="i">+
</a><a href="#h53-0-1603" id="h53-0-1603" class="i">+void
</a><a href="#h53-0-1604" id="h53-0-1604" class="i">+xsettitle(char *p)
</a><a href="#h53-0-1605" id="h53-0-1605" class="i">+{
</a><a href="#h53-0-1606" id="h53-0-1606" class="i">+	XTextProperty prop;
</a><a href="#h53-0-1607" id="h53-0-1607" class="i">+	DEFAULT(p, opt_title);
</a><a href="#h53-0-1608" id="h53-0-1608" class="i">+
</a><a href="#h53-0-1609" id="h53-0-1609" class="i">+	Xutf8TextListToTextProperty(xw.dpy, &amp;p, 1, XUTF8StringStyle,
</a><a href="#h53-0-1610" id="h53-0-1610" class="i">+			&amp;prop);
</a><a href="#h53-0-1611" id="h53-0-1611" class="i">+	XSetWMName(xw.dpy, xw.win, &amp;prop);
</a><a href="#h53-0-1612" id="h53-0-1612" class="i">+	XSetTextProperty(xw.dpy, xw.win, &amp;prop, xw.netwmname);
</a><a href="#h53-0-1613" id="h53-0-1613" class="i">+	XFree(prop.value);
</a><a href="#h53-0-1614" id="h53-0-1614" class="i">+}
</a><a href="#h53-0-1615" id="h53-0-1615" class="i">+
</a><a href="#h53-0-1616" id="h53-0-1616" class="i">+int
</a><a href="#h53-0-1617" id="h53-0-1617" class="i">+xstartdraw(void)
</a><a href="#h53-0-1618" id="h53-0-1618" class="i">+{
</a><a href="#h53-0-1619" id="h53-0-1619" class="i">+	return IS_SET(MODE_VISIBLE);
</a><a href="#h53-0-1620" id="h53-0-1620" class="i">+}
</a><a href="#h53-0-1621" id="h53-0-1621" class="i">+
</a><a href="#h53-0-1622" id="h53-0-1622" class="i">+void
</a><a href="#h53-0-1623" id="h53-0-1623" class="i">+xdrawline(Line line, int x1, int y1, int x2)
</a><a href="#h53-0-1624" id="h53-0-1624" class="i">+{
</a><a href="#h53-0-1625" id="h53-0-1625" class="i">+	int i, x, ox, numspecs;
</a><a href="#h53-0-1626" id="h53-0-1626" class="i">+	Glyph base, new;
</a><a href="#h53-0-1627" id="h53-0-1627" class="i">+	XftGlyphFontSpec *specs = xw.specbuf;
</a><a href="#h53-0-1628" id="h53-0-1628" class="i">+
</a><a href="#h53-0-1629" id="h53-0-1629" class="i">+	numspecs = xmakeglyphfontspecs(specs, &amp;line[x1], x2 - x1, x1, y1);
</a><a href="#h53-0-1630" id="h53-0-1630" class="i">+	i = ox = 0;
</a><a href="#h53-0-1631" id="h53-0-1631" class="i">+	for (x = x1; x &lt; x2 &amp;&amp; i &lt; numspecs; x++) {
</a><a href="#h53-0-1632" id="h53-0-1632" class="i">+		new = line[x];
</a><a href="#h53-0-1633" id="h53-0-1633" class="i">+		if (new.mode == ATTR_WDUMMY)
</a><a href="#h53-0-1634" id="h53-0-1634" class="i">+			continue;
</a><a href="#h53-0-1635" id="h53-0-1635" class="i">+		if (selected(x, y1))
</a><a href="#h53-0-1636" id="h53-0-1636" class="i">+			new.mode ^= ATTR_REVERSE;
</a><a href="#h53-0-1637" id="h53-0-1637" class="i">+		if (i &gt; 0 &amp;&amp; ATTRCMP(base, new)) {
</a><a href="#h53-0-1638" id="h53-0-1638" class="i">+			xdrawglyphfontspecs(specs, base, i, ox, y1);
</a><a href="#h53-0-1639" id="h53-0-1639" class="i">+			specs += i;
</a><a href="#h53-0-1640" id="h53-0-1640" class="i">+			numspecs -= i;
</a><a href="#h53-0-1641" id="h53-0-1641" class="i">+			i = 0;
</a><a href="#h53-0-1642" id="h53-0-1642" class="i">+		}
</a><a href="#h53-0-1643" id="h53-0-1643" class="i">+		if (i == 0) {
</a><a href="#h53-0-1644" id="h53-0-1644" class="i">+			ox = x;
</a><a href="#h53-0-1645" id="h53-0-1645" class="i">+			base = new;
</a><a href="#h53-0-1646" id="h53-0-1646" class="i">+		}
</a><a href="#h53-0-1647" id="h53-0-1647" class="i">+		i++;
</a><a href="#h53-0-1648" id="h53-0-1648" class="i">+	}
</a><a href="#h53-0-1649" id="h53-0-1649" class="i">+	if (i &gt; 0)
</a><a href="#h53-0-1650" id="h53-0-1650" class="i">+		xdrawglyphfontspecs(specs, base, i, ox, y1);
</a><a href="#h53-0-1651" id="h53-0-1651" class="i">+}
</a><a href="#h53-0-1652" id="h53-0-1652" class="i">+
</a><a href="#h53-0-1653" id="h53-0-1653" class="i">+void
</a><a href="#h53-0-1654" id="h53-0-1654" class="i">+xfinishdraw(void)
</a><a href="#h53-0-1655" id="h53-0-1655" class="i">+{
</a><a href="#h53-0-1656" id="h53-0-1656" class="i">+	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, 0, 0, win.w,
</a><a href="#h53-0-1657" id="h53-0-1657" class="i">+			win.h, 0, 0);
</a><a href="#h53-0-1658" id="h53-0-1658" class="i">+	XSetForeground(xw.dpy, dc.gc,
</a><a href="#h53-0-1659" id="h53-0-1659" class="i">+			dc.col[IS_SET(MODE_REVERSE)?
</a><a href="#h53-0-1660" id="h53-0-1660" class="i">+				defaultfg : defaultbg].pixel);
</a><a href="#h53-0-1661" id="h53-0-1661" class="i">+}
</a><a href="#h53-0-1662" id="h53-0-1662" class="i">+
</a><a href="#h53-0-1663" id="h53-0-1663" class="i">+void
</a><a href="#h53-0-1664" id="h53-0-1664" class="i">+xximspot(int x, int y)
</a><a href="#h53-0-1665" id="h53-0-1665" class="i">+{
</a><a href="#h53-0-1666" id="h53-0-1666" class="i">+	XPoint spot = { borderpx + x * win.cw, borderpx + (y + 1) * win.ch };
</a><a href="#h53-0-1667" id="h53-0-1667" class="i">+	XVaNestedList attr = XVaCreateNestedList(0, XNSpotLocation, &amp;spot, NULL);
</a><a href="#h53-0-1668" id="h53-0-1668" class="i">+
</a><a href="#h53-0-1669" id="h53-0-1669" class="i">+	XSetICValues(xw.xic, XNPreeditAttributes, attr, NULL);
</a><a href="#h53-0-1670" id="h53-0-1670" class="i">+	XFree(attr);
</a><a href="#h53-0-1671" id="h53-0-1671" class="i">+}
</a><a href="#h53-0-1672" id="h53-0-1672" class="i">+
</a><a href="#h53-0-1673" id="h53-0-1673" class="i">+void
</a><a href="#h53-0-1674" id="h53-0-1674" class="i">+expose(XEvent *ev)
</a><a href="#h53-0-1675" id="h53-0-1675" class="i">+{
</a><a href="#h53-0-1676" id="h53-0-1676" class="i">+	redraw();
</a><a href="#h53-0-1677" id="h53-0-1677" class="i">+}
</a><a href="#h53-0-1678" id="h53-0-1678" class="i">+
</a><a href="#h53-0-1679" id="h53-0-1679" class="i">+void
</a><a href="#h53-0-1680" id="h53-0-1680" class="i">+visibility(XEvent *ev)
</a><a href="#h53-0-1681" id="h53-0-1681" class="i">+{
</a><a href="#h53-0-1682" id="h53-0-1682" class="i">+	XVisibilityEvent *e = &amp;ev-&gt;xvisibility;
</a><a href="#h53-0-1683" id="h53-0-1683" class="i">+
</a><a href="#h53-0-1684" id="h53-0-1684" class="i">+	MODBIT(win.mode, e-&gt;state != VisibilityFullyObscured, MODE_VISIBLE);
</a><a href="#h53-0-1685" id="h53-0-1685" class="i">+}
</a><a href="#h53-0-1686" id="h53-0-1686" class="i">+
</a><a href="#h53-0-1687" id="h53-0-1687" class="i">+void
</a><a href="#h53-0-1688" id="h53-0-1688" class="i">+unmap(XEvent *ev)
</a><a href="#h53-0-1689" id="h53-0-1689" class="i">+{
</a><a href="#h53-0-1690" id="h53-0-1690" class="i">+	win.mode &amp;= ~MODE_VISIBLE;
</a><a href="#h53-0-1691" id="h53-0-1691" class="i">+}
</a><a href="#h53-0-1692" id="h53-0-1692" class="i">+
</a><a href="#h53-0-1693" id="h53-0-1693" class="i">+void
</a><a href="#h53-0-1694" id="h53-0-1694" class="i">+xsetpointermotion(int set)
</a><a href="#h53-0-1695" id="h53-0-1695" class="i">+{
</a><a href="#h53-0-1696" id="h53-0-1696" class="i">+	if (!set &amp;&amp; !xw.pointerisvisible)
</a><a href="#h53-0-1697" id="h53-0-1697" class="i">+		return;
</a><a href="#h53-0-1698" id="h53-0-1698" class="i">+	MODBIT(xw.attrs.event_mask, set, PointerMotionMask);
</a><a href="#h53-0-1699" id="h53-0-1699" class="i">+	XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask, &amp;xw.attrs);
</a><a href="#h53-0-1700" id="h53-0-1700" class="i">+}
</a><a href="#h53-0-1701" id="h53-0-1701" class="i">+
</a><a href="#h53-0-1702" id="h53-0-1702" class="i">+void
</a><a href="#h53-0-1703" id="h53-0-1703" class="i">+xsetmode(int set, unsigned int flags)
</a><a href="#h53-0-1704" id="h53-0-1704" class="i">+{
</a><a href="#h53-0-1705" id="h53-0-1705" class="i">+	int mode = win.mode;
</a><a href="#h53-0-1706" id="h53-0-1706" class="i">+	MODBIT(win.mode, set, flags);
</a><a href="#h53-0-1707" id="h53-0-1707" class="i">+	if ((win.mode &amp; MODE_REVERSE) != (mode &amp; MODE_REVERSE))
</a><a href="#h53-0-1708" id="h53-0-1708" class="i">+		redraw();
</a><a href="#h53-0-1709" id="h53-0-1709" class="i">+}
</a><a href="#h53-0-1710" id="h53-0-1710" class="i">+
</a><a href="#h53-0-1711" id="h53-0-1711" class="i">+int
</a><a href="#h53-0-1712" id="h53-0-1712" class="i">+xsetcursor(int cursor)
</a><a href="#h53-0-1713" id="h53-0-1713" class="i">+{
</a><a href="#h53-0-1714" id="h53-0-1714" class="i">+	DEFAULT(cursor, 1);
</a><a href="#h53-0-1715" id="h53-0-1715" class="i">+	if (!BETWEEN(cursor, 0, 6))
</a><a href="#h53-0-1716" id="h53-0-1716" class="i">+		return 1;
</a><a href="#h53-0-1717" id="h53-0-1717" class="i">+	win.cursor = cursor;
</a><a href="#h53-0-1718" id="h53-0-1718" class="i">+	return 0;
</a><a href="#h53-0-1719" id="h53-0-1719" class="i">+}
</a><a href="#h53-0-1720" id="h53-0-1720" class="i">+
</a><a href="#h53-0-1721" id="h53-0-1721" class="i">+void
</a><a href="#h53-0-1722" id="h53-0-1722" class="i">+xseturgency(int add)
</a><a href="#h53-0-1723" id="h53-0-1723" class="i">+{
</a><a href="#h53-0-1724" id="h53-0-1724" class="i">+	XWMHints *h = XGetWMHints(xw.dpy, xw.win);
</a><a href="#h53-0-1725" id="h53-0-1725" class="i">+
</a><a href="#h53-0-1726" id="h53-0-1726" class="i">+	MODBIT(h-&gt;flags, add, XUrgencyHint);
</a><a href="#h53-0-1727" id="h53-0-1727" class="i">+	XSetWMHints(xw.dpy, xw.win, h);
</a><a href="#h53-0-1728" id="h53-0-1728" class="i">+	XFree(h);
</a><a href="#h53-0-1729" id="h53-0-1729" class="i">+}
</a><a href="#h53-0-1730" id="h53-0-1730" class="i">+
</a><a href="#h53-0-1731" id="h53-0-1731" class="i">+void
</a><a href="#h53-0-1732" id="h53-0-1732" class="i">+xbell(void)
</a><a href="#h53-0-1733" id="h53-0-1733" class="i">+{
</a><a href="#h53-0-1734" id="h53-0-1734" class="i">+	if (!(IS_SET(MODE_FOCUSED)))
</a><a href="#h53-0-1735" id="h53-0-1735" class="i">+		xseturgency(1);
</a><a href="#h53-0-1736" id="h53-0-1736" class="i">+	if (bellvolume)
</a><a href="#h53-0-1737" id="h53-0-1737" class="i">+		XkbBell(xw.dpy, xw.win, bellvolume, (Atom)NULL);
</a><a href="#h53-0-1738" id="h53-0-1738" class="i">+}
</a><a href="#h53-0-1739" id="h53-0-1739" class="i">+
</a><a href="#h53-0-1740" id="h53-0-1740" class="i">+void
</a><a href="#h53-0-1741" id="h53-0-1741" class="i">+focus(XEvent *ev)
</a><a href="#h53-0-1742" id="h53-0-1742" class="i">+{
</a><a href="#h53-0-1743" id="h53-0-1743" class="i">+	XFocusChangeEvent *e = &amp;ev-&gt;xfocus;
</a><a href="#h53-0-1744" id="h53-0-1744" class="i">+
</a><a href="#h53-0-1745" id="h53-0-1745" class="i">+	if (e-&gt;mode == NotifyGrab)
</a><a href="#h53-0-1746" id="h53-0-1746" class="i">+		return;
</a><a href="#h53-0-1747" id="h53-0-1747" class="i">+
</a><a href="#h53-0-1748" id="h53-0-1748" class="i">+	if (ev-&gt;type == FocusIn) {
</a><a href="#h53-0-1749" id="h53-0-1749" class="i">+		XSetICFocus(xw.xic);
</a><a href="#h53-0-1750" id="h53-0-1750" class="i">+		win.mode |= MODE_FOCUSED;
</a><a href="#h53-0-1751" id="h53-0-1751" class="i">+		xseturgency(0);
</a><a href="#h53-0-1752" id="h53-0-1752" class="i">+		if (IS_SET(MODE_FOCUS))
</a><a href="#h53-0-1753" id="h53-0-1753" class="i">+			ttywrite(&quot;\033[I&quot;, 3, 0);
</a><a href="#h53-0-1754" id="h53-0-1754" class="i">+	} else {
</a><a href="#h53-0-1755" id="h53-0-1755" class="i">+		XUnsetICFocus(xw.xic);
</a><a href="#h53-0-1756" id="h53-0-1756" class="i">+		win.mode &amp;= ~MODE_FOCUSED;
</a><a href="#h53-0-1757" id="h53-0-1757" class="i">+		if (IS_SET(MODE_FOCUS))
</a><a href="#h53-0-1758" id="h53-0-1758" class="i">+			ttywrite(&quot;\033[O&quot;, 3, 0);
</a><a href="#h53-0-1759" id="h53-0-1759" class="i">+	}
</a><a href="#h53-0-1760" id="h53-0-1760" class="i">+}
</a><a href="#h53-0-1761" id="h53-0-1761" class="i">+
</a><a href="#h53-0-1762" id="h53-0-1762" class="i">+int
</a><a href="#h53-0-1763" id="h53-0-1763" class="i">+match(uint mask, uint state)
</a><a href="#h53-0-1764" id="h53-0-1764" class="i">+{
</a><a href="#h53-0-1765" id="h53-0-1765" class="i">+	return mask == XK_ANY_MOD || mask == (state &amp; ~ignoremod);
</a><a href="#h53-0-1766" id="h53-0-1766" class="i">+}
</a><a href="#h53-0-1767" id="h53-0-1767" class="i">+
</a><a href="#h53-0-1768" id="h53-0-1768" class="i">+char*
</a><a href="#h53-0-1769" id="h53-0-1769" class="i">+kmap(KeySym k, uint state)
</a><a href="#h53-0-1770" id="h53-0-1770" class="i">+{
</a><a href="#h53-0-1771" id="h53-0-1771" class="i">+	Key *kp;
</a><a href="#h53-0-1772" id="h53-0-1772" class="i">+	int i;
</a><a href="#h53-0-1773" id="h53-0-1773" class="i">+
</a><a href="#h53-0-1774" id="h53-0-1774" class="i">+	/* Check for mapped keys out of X11 function keys. */
</a><a href="#h53-0-1775" id="h53-0-1775" class="i">+	for (i = 0; i &lt; LEN(mappedkeys); i++) {
</a><a href="#h53-0-1776" id="h53-0-1776" class="i">+		if (mappedkeys[i] == k)
</a><a href="#h53-0-1777" id="h53-0-1777" class="i">+			break;
</a><a href="#h53-0-1778" id="h53-0-1778" class="i">+	}
</a><a href="#h53-0-1779" id="h53-0-1779" class="i">+	if (i == LEN(mappedkeys)) {
</a><a href="#h53-0-1780" id="h53-0-1780" class="i">+		if ((k &amp; 0xFFFF) &lt; 0xFD00)
</a><a href="#h53-0-1781" id="h53-0-1781" class="i">+			return NULL;
</a><a href="#h53-0-1782" id="h53-0-1782" class="i">+	}
</a><a href="#h53-0-1783" id="h53-0-1783" class="i">+
</a><a href="#h53-0-1784" id="h53-0-1784" class="i">+	for (kp = key; kp &lt; key + LEN(key); kp++) {
</a><a href="#h53-0-1785" id="h53-0-1785" class="i">+		if (kp-&gt;k != k)
</a><a href="#h53-0-1786" id="h53-0-1786" class="i">+			continue;
</a><a href="#h53-0-1787" id="h53-0-1787" class="i">+
</a><a href="#h53-0-1788" id="h53-0-1788" class="i">+		if (!match(kp-&gt;mask, state))
</a><a href="#h53-0-1789" id="h53-0-1789" class="i">+			continue;
</a><a href="#h53-0-1790" id="h53-0-1790" class="i">+
</a><a href="#h53-0-1791" id="h53-0-1791" class="i">+		if (IS_SET(MODE_APPKEYPAD) ? kp-&gt;appkey &lt; 0 : kp-&gt;appkey &gt; 0)
</a><a href="#h53-0-1792" id="h53-0-1792" class="i">+			continue;
</a><a href="#h53-0-1793" id="h53-0-1793" class="i">+		if (IS_SET(MODE_NUMLOCK) &amp;&amp; kp-&gt;appkey == 2)
</a><a href="#h53-0-1794" id="h53-0-1794" class="i">+			continue;
</a><a href="#h53-0-1795" id="h53-0-1795" class="i">+
</a><a href="#h53-0-1796" id="h53-0-1796" class="i">+		if (IS_SET(MODE_APPCURSOR) ? kp-&gt;appcursor &lt; 0 : kp-&gt;appcursor &gt; 0)
</a><a href="#h53-0-1797" id="h53-0-1797" class="i">+			continue;
</a><a href="#h53-0-1798" id="h53-0-1798" class="i">+
</a><a href="#h53-0-1799" id="h53-0-1799" class="i">+		return kp-&gt;s;
</a><a href="#h53-0-1800" id="h53-0-1800" class="i">+	}
</a><a href="#h53-0-1801" id="h53-0-1801" class="i">+
</a><a href="#h53-0-1802" id="h53-0-1802" class="i">+	return NULL;
</a><a href="#h53-0-1803" id="h53-0-1803" class="i">+}
</a><a href="#h53-0-1804" id="h53-0-1804" class="i">+
</a><a href="#h53-0-1805" id="h53-0-1805" class="i">+void
</a><a href="#h53-0-1806" id="h53-0-1806" class="i">+kpress(XEvent *ev)
</a><a href="#h53-0-1807" id="h53-0-1807" class="i">+{
</a><a href="#h53-0-1808" id="h53-0-1808" class="i">+	XKeyEvent *e = &amp;ev-&gt;xkey;
</a><a href="#h53-0-1809" id="h53-0-1809" class="i">+	KeySym ksym;
</a><a href="#h53-0-1810" id="h53-0-1810" class="i">+	char buf[32], *customkey;
</a><a href="#h53-0-1811" id="h53-0-1811" class="i">+	int len;
</a><a href="#h53-0-1812" id="h53-0-1812" class="i">+	Rune c;
</a><a href="#h53-0-1813" id="h53-0-1813" class="i">+	Status status;
</a><a href="#h53-0-1814" id="h53-0-1814" class="i">+	Shortcut *bp;
</a><a href="#h53-0-1815" id="h53-0-1815" class="i">+
</a><a href="#h53-0-1816" id="h53-0-1816" class="i">+	if (xw.pointerisvisible) {
</a><a href="#h53-0-1817" id="h53-0-1817" class="i">+		XDefineCursor(xw.dpy, xw.win, xw.bpointer);
</a><a href="#h53-0-1818" id="h53-0-1818" class="i">+		xsetpointermotion(1);
</a><a href="#h53-0-1819" id="h53-0-1819" class="i">+		xw.pointerisvisible = 0;
</a><a href="#h53-0-1820" id="h53-0-1820" class="i">+	}
</a><a href="#h53-0-1821" id="h53-0-1821" class="i">+
</a><a href="#h53-0-1822" id="h53-0-1822" class="i">+	if (IS_SET(MODE_KBDLOCK))
</a><a href="#h53-0-1823" id="h53-0-1823" class="i">+		return;
</a><a href="#h53-0-1824" id="h53-0-1824" class="i">+
</a><a href="#h53-0-1825" id="h53-0-1825" class="i">+	len = XmbLookupString(xw.xic, e, buf, sizeof buf, &amp;ksym, &amp;status);
</a><a href="#h53-0-1826" id="h53-0-1826" class="i">+	/* 1. shortcuts */
</a><a href="#h53-0-1827" id="h53-0-1827" class="i">+	for (bp = shortcuts; bp &lt; shortcuts + LEN(shortcuts); bp++) {
</a><a href="#h53-0-1828" id="h53-0-1828" class="i">+		if (ksym == bp-&gt;keysym &amp;&amp; match(bp-&gt;mod, e-&gt;state)) {
</a><a href="#h53-0-1829" id="h53-0-1829" class="i">+			bp-&gt;func(&amp;(bp-&gt;arg));
</a><a href="#h53-0-1830" id="h53-0-1830" class="i">+			return;
</a><a href="#h53-0-1831" id="h53-0-1831" class="i">+		}
</a><a href="#h53-0-1832" id="h53-0-1832" class="i">+	}
</a><a href="#h53-0-1833" id="h53-0-1833" class="i">+
</a><a href="#h53-0-1834" id="h53-0-1834" class="i">+	/* 2. custom keys from config.h */
</a><a href="#h53-0-1835" id="h53-0-1835" class="i">+	if ((customkey = kmap(ksym, e-&gt;state))) {
</a><a href="#h53-0-1836" id="h53-0-1836" class="i">+		ttywrite(customkey, strlen(customkey), 1);
</a><a href="#h53-0-1837" id="h53-0-1837" class="i">+		return;
</a><a href="#h53-0-1838" id="h53-0-1838" class="i">+	}
</a><a href="#h53-0-1839" id="h53-0-1839" class="i">+
</a><a href="#h53-0-1840" id="h53-0-1840" class="i">+	/* 3. composed string from input method */
</a><a href="#h53-0-1841" id="h53-0-1841" class="i">+	if (len == 0)
</a><a href="#h53-0-1842" id="h53-0-1842" class="i">+		return;
</a><a href="#h53-0-1843" id="h53-0-1843" class="i">+	if (len == 1 &amp;&amp; e-&gt;state &amp; Mod1Mask) {
</a><a href="#h53-0-1844" id="h53-0-1844" class="i">+		if (IS_SET(MODE_8BIT)) {
</a><a href="#h53-0-1845" id="h53-0-1845" class="i">+			if (*buf &lt; 0177) {
</a><a href="#h53-0-1846" id="h53-0-1846" class="i">+				c = *buf | 0x80;
</a><a href="#h53-0-1847" id="h53-0-1847" class="i">+				len = utf8encode(c, buf);
</a><a href="#h53-0-1848" id="h53-0-1848" class="i">+			}
</a><a href="#h53-0-1849" id="h53-0-1849" class="i">+		} else {
</a><a href="#h53-0-1850" id="h53-0-1850" class="i">+			buf[1] = buf[0];
</a><a href="#h53-0-1851" id="h53-0-1851" class="i">+			buf[0] = &#39;\033&#39;;
</a><a href="#h53-0-1852" id="h53-0-1852" class="i">+			len = 2;
</a><a href="#h53-0-1853" id="h53-0-1853" class="i">+		}
</a><a href="#h53-0-1854" id="h53-0-1854" class="i">+	}
</a><a href="#h53-0-1855" id="h53-0-1855" class="i">+	ttywrite(buf, len, 1);
</a><a href="#h53-0-1856" id="h53-0-1856" class="i">+}
</a><a href="#h53-0-1857" id="h53-0-1857" class="i">+
</a><a href="#h53-0-1858" id="h53-0-1858" class="i">+
</a><a href="#h53-0-1859" id="h53-0-1859" class="i">+void
</a><a href="#h53-0-1860" id="h53-0-1860" class="i">+cmessage(XEvent *e)
</a><a href="#h53-0-1861" id="h53-0-1861" class="i">+{
</a><a href="#h53-0-1862" id="h53-0-1862" class="i">+	/*
</a><a href="#h53-0-1863" id="h53-0-1863" class="i">+	 * See xembed specs
</a><a href="#h53-0-1864" id="h53-0-1864" class="i">+	 *  http://standards.freedesktop.org/xembed-spec/xembed-spec-latest.html
</a><a href="#h53-0-1865" id="h53-0-1865" class="i">+	 */
</a><a href="#h53-0-1866" id="h53-0-1866" class="i">+	if (e-&gt;xclient.message_type == xw.xembed &amp;&amp; e-&gt;xclient.format == 32) {
</a><a href="#h53-0-1867" id="h53-0-1867" class="i">+		if (e-&gt;xclient.data.l[1] == XEMBED_FOCUS_IN) {
</a><a href="#h53-0-1868" id="h53-0-1868" class="i">+			win.mode |= MODE_FOCUSED;
</a><a href="#h53-0-1869" id="h53-0-1869" class="i">+			xseturgency(0);
</a><a href="#h53-0-1870" id="h53-0-1870" class="i">+		} else if (e-&gt;xclient.data.l[1] == XEMBED_FOCUS_OUT) {
</a><a href="#h53-0-1871" id="h53-0-1871" class="i">+			win.mode &amp;= ~MODE_FOCUSED;
</a><a href="#h53-0-1872" id="h53-0-1872" class="i">+		}
</a><a href="#h53-0-1873" id="h53-0-1873" class="i">+	} else if (e-&gt;xclient.data.l[0] == xw.wmdeletewin) {
</a><a href="#h53-0-1874" id="h53-0-1874" class="i">+		ttyhangup();
</a><a href="#h53-0-1875" id="h53-0-1875" class="i">+		exit(0);
</a><a href="#h53-0-1876" id="h53-0-1876" class="i">+	}
</a><a href="#h53-0-1877" id="h53-0-1877" class="i">+}
</a><a href="#h53-0-1878" id="h53-0-1878" class="i">+
</a><a href="#h53-0-1879" id="h53-0-1879" class="i">+void
</a><a href="#h53-0-1880" id="h53-0-1880" class="i">+resize(XEvent *e)
</a><a href="#h53-0-1881" id="h53-0-1881" class="i">+{
</a><a href="#h53-0-1882" id="h53-0-1882" class="i">+	if (e-&gt;xconfigure.width == win.w &amp;&amp; e-&gt;xconfigure.height == win.h)
</a><a href="#h53-0-1883" id="h53-0-1883" class="i">+		return;
</a><a href="#h53-0-1884" id="h53-0-1884" class="i">+
</a><a href="#h53-0-1885" id="h53-0-1885" class="i">+	cresize(e-&gt;xconfigure.width, e-&gt;xconfigure.height);
</a><a href="#h53-0-1886" id="h53-0-1886" class="i">+}
</a><a href="#h53-0-1887" id="h53-0-1887" class="i">+
</a><a href="#h53-0-1888" id="h53-0-1888" class="i">+void
</a><a href="#h53-0-1889" id="h53-0-1889" class="i">+run(void)
</a><a href="#h53-0-1890" id="h53-0-1890" class="i">+{
</a><a href="#h53-0-1891" id="h53-0-1891" class="i">+	XEvent ev;
</a><a href="#h53-0-1892" id="h53-0-1892" class="i">+	int w = win.w, h = win.h;
</a><a href="#h53-0-1893" id="h53-0-1893" class="i">+	fd_set rfd;
</a><a href="#h53-0-1894" id="h53-0-1894" class="i">+	int xfd = XConnectionNumber(xw.dpy), xev, blinkset = 0, dodraw = 0;
</a><a href="#h53-0-1895" id="h53-0-1895" class="i">+	int ttyfd;
</a><a href="#h53-0-1896" id="h53-0-1896" class="i">+	struct timespec drawtimeout, *tv = NULL, now, last, lastblink;
</a><a href="#h53-0-1897" id="h53-0-1897" class="i">+	long deltatime;
</a><a href="#h53-0-1898" id="h53-0-1898" class="i">+
</a><a href="#h53-0-1899" id="h53-0-1899" class="i">+	/* Waiting for window mapping */
</a><a href="#h53-0-1900" id="h53-0-1900" class="i">+	do {
</a><a href="#h53-0-1901" id="h53-0-1901" class="i">+		XNextEvent(xw.dpy, &amp;ev);
</a><a href="#h53-0-1902" id="h53-0-1902" class="i">+		/*
</a><a href="#h53-0-1903" id="h53-0-1903" class="i">+		 * This XFilterEvent call is required because of XOpenIM. It
</a><a href="#h53-0-1904" id="h53-0-1904" class="i">+		 * does filter out the key event and some client message for
</a><a href="#h53-0-1905" id="h53-0-1905" class="i">+		 * the input method too.
</a><a href="#h53-0-1906" id="h53-0-1906" class="i">+		 */
</a><a href="#h53-0-1907" id="h53-0-1907" class="i">+		if (XFilterEvent(&amp;ev, None))
</a><a href="#h53-0-1908" id="h53-0-1908" class="i">+			continue;
</a><a href="#h53-0-1909" id="h53-0-1909" class="i">+		if (ev.type == ConfigureNotify) {
</a><a href="#h53-0-1910" id="h53-0-1910" class="i">+			w = ev.xconfigure.width;
</a><a href="#h53-0-1911" id="h53-0-1911" class="i">+			h = ev.xconfigure.height;
</a><a href="#h53-0-1912" id="h53-0-1912" class="i">+		}
</a><a href="#h53-0-1913" id="h53-0-1913" class="i">+	} while (ev.type != MapNotify);
</a><a href="#h53-0-1914" id="h53-0-1914" class="i">+
</a><a href="#h53-0-1915" id="h53-0-1915" class="i">+	ttyfd = ttynew(opt_line, shell, opt_io, opt_cmd);
</a><a href="#h53-0-1916" id="h53-0-1916" class="i">+	cresize(w, h);
</a><a href="#h53-0-1917" id="h53-0-1917" class="i">+
</a><a href="#h53-0-1918" id="h53-0-1918" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;last);
</a><a href="#h53-0-1919" id="h53-0-1919" class="i">+	lastblink = last;
</a><a href="#h53-0-1920" id="h53-0-1920" class="i">+
</a><a href="#h53-0-1921" id="h53-0-1921" class="i">+	for (xev = actionfps;;) {
</a><a href="#h53-0-1922" id="h53-0-1922" class="i">+		FD_ZERO(&amp;rfd);
</a><a href="#h53-0-1923" id="h53-0-1923" class="i">+		FD_SET(ttyfd, &amp;rfd);
</a><a href="#h53-0-1924" id="h53-0-1924" class="i">+		FD_SET(xfd, &amp;rfd);
</a><a href="#h53-0-1925" id="h53-0-1925" class="i">+
</a><a href="#h53-0-1926" id="h53-0-1926" class="i">+		if (pselect(MAX(xfd, ttyfd)+1, &amp;rfd, NULL, NULL, tv, NULL) &lt; 0) {
</a><a href="#h53-0-1927" id="h53-0-1927" class="i">+			if (errno == EINTR)
</a><a href="#h53-0-1928" id="h53-0-1928" class="i">+				continue;
</a><a href="#h53-0-1929" id="h53-0-1929" class="i">+			die(&quot;select failed: %s\n&quot;, strerror(errno));
</a><a href="#h53-0-1930" id="h53-0-1930" class="i">+		}
</a><a href="#h53-0-1931" id="h53-0-1931" class="i">+		if (FD_ISSET(ttyfd, &amp;rfd)) {
</a><a href="#h53-0-1932" id="h53-0-1932" class="i">+			ttyread();
</a><a href="#h53-0-1933" id="h53-0-1933" class="i">+			if (blinktimeout) {
</a><a href="#h53-0-1934" id="h53-0-1934" class="i">+				blinkset = tattrset(ATTR_BLINK);
</a><a href="#h53-0-1935" id="h53-0-1935" class="i">+				if (!blinkset)
</a><a href="#h53-0-1936" id="h53-0-1936" class="i">+					MODBIT(win.mode, 0, MODE_BLINK);
</a><a href="#h53-0-1937" id="h53-0-1937" class="i">+			}
</a><a href="#h53-0-1938" id="h53-0-1938" class="i">+		}
</a><a href="#h53-0-1939" id="h53-0-1939" class="i">+
</a><a href="#h53-0-1940" id="h53-0-1940" class="i">+		if (FD_ISSET(xfd, &amp;rfd))
</a><a href="#h53-0-1941" id="h53-0-1941" class="i">+			xev = actionfps;
</a><a href="#h53-0-1942" id="h53-0-1942" class="i">+
</a><a href="#h53-0-1943" id="h53-0-1943" class="i">+		clock_gettime(CLOCK_MONOTONIC, &amp;now);
</a><a href="#h53-0-1944" id="h53-0-1944" class="i">+		drawtimeout.tv_sec = 0;
</a><a href="#h53-0-1945" id="h53-0-1945" class="i">+		drawtimeout.tv_nsec =  (1000 * 1E6)/ xfps;
</a><a href="#h53-0-1946" id="h53-0-1946" class="i">+		tv = &amp;drawtimeout;
</a><a href="#h53-0-1947" id="h53-0-1947" class="i">+
</a><a href="#h53-0-1948" id="h53-0-1948" class="i">+		dodraw = 0;
</a><a href="#h53-0-1949" id="h53-0-1949" class="i">+		if (blinktimeout &amp;&amp; TIMEDIFF(now, lastblink) &gt; blinktimeout) {
</a><a href="#h53-0-1950" id="h53-0-1950" class="i">+			tsetdirtattr(ATTR_BLINK);
</a><a href="#h53-0-1951" id="h53-0-1951" class="i">+			win.mode ^= MODE_BLINK;
</a><a href="#h53-0-1952" id="h53-0-1952" class="i">+			lastblink = now;
</a><a href="#h53-0-1953" id="h53-0-1953" class="i">+			dodraw = 1;
</a><a href="#h53-0-1954" id="h53-0-1954" class="i">+		}
</a><a href="#h53-0-1955" id="h53-0-1955" class="i">+		deltatime = TIMEDIFF(now, last);
</a><a href="#h53-0-1956" id="h53-0-1956" class="i">+		if (deltatime &gt; 1000 / (xev ? xfps : actionfps)) {
</a><a href="#h53-0-1957" id="h53-0-1957" class="i">+			dodraw = 1;
</a><a href="#h53-0-1958" id="h53-0-1958" class="i">+			last = now;
</a><a href="#h53-0-1959" id="h53-0-1959" class="i">+		}
</a><a href="#h53-0-1960" id="h53-0-1960" class="i">+
</a><a href="#h53-0-1961" id="h53-0-1961" class="i">+		if (dodraw) {
</a><a href="#h53-0-1962" id="h53-0-1962" class="i">+			while (XPending(xw.dpy)) {
</a><a href="#h53-0-1963" id="h53-0-1963" class="i">+				XNextEvent(xw.dpy, &amp;ev);
</a><a href="#h53-0-1964" id="h53-0-1964" class="i">+				if (XFilterEvent(&amp;ev, None))
</a><a href="#h53-0-1965" id="h53-0-1965" class="i">+					continue;
</a><a href="#h53-0-1966" id="h53-0-1966" class="i">+				if (handler[ev.type])
</a><a href="#h53-0-1967" id="h53-0-1967" class="i">+					(handler[ev.type])(&amp;ev);
</a><a href="#h53-0-1968" id="h53-0-1968" class="i">+			}
</a><a href="#h53-0-1969" id="h53-0-1969" class="i">+
</a><a href="#h53-0-1970" id="h53-0-1970" class="i">+			draw();
</a><a href="#h53-0-1971" id="h53-0-1971" class="i">+			XFlush(xw.dpy);
</a><a href="#h53-0-1972" id="h53-0-1972" class="i">+
</a><a href="#h53-0-1973" id="h53-0-1973" class="i">+			if (xev &amp;&amp; !FD_ISSET(xfd, &amp;rfd))
</a><a href="#h53-0-1974" id="h53-0-1974" class="i">+				xev--;
</a><a href="#h53-0-1975" id="h53-0-1975" class="i">+			if (!FD_ISSET(ttyfd, &amp;rfd) &amp;&amp; !FD_ISSET(xfd, &amp;rfd)) {
</a><a href="#h53-0-1976" id="h53-0-1976" class="i">+				if (blinkset) {
</a><a href="#h53-0-1977" id="h53-0-1977" class="i">+					if (TIMEDIFF(now, lastblink) \
</a><a href="#h53-0-1978" id="h53-0-1978" class="i">+							&gt; blinktimeout) {
</a><a href="#h53-0-1979" id="h53-0-1979" class="i">+						drawtimeout.tv_nsec = 1000;
</a><a href="#h53-0-1980" id="h53-0-1980" class="i">+					} else {
</a><a href="#h53-0-1981" id="h53-0-1981" class="i">+						drawtimeout.tv_nsec = (1E6 * \
</a><a href="#h53-0-1982" id="h53-0-1982" class="i">+							(blinktimeout - \
</a><a href="#h53-0-1983" id="h53-0-1983" class="i">+							TIMEDIFF(now,
</a><a href="#h53-0-1984" id="h53-0-1984" class="i">+								lastblink)));
</a><a href="#h53-0-1985" id="h53-0-1985" class="i">+					}
</a><a href="#h53-0-1986" id="h53-0-1986" class="i">+					drawtimeout.tv_sec = \
</a><a href="#h53-0-1987" id="h53-0-1987" class="i">+					    drawtimeout.tv_nsec / 1E9;
</a><a href="#h53-0-1988" id="h53-0-1988" class="i">+					drawtimeout.tv_nsec %= (long)1E9;
</a><a href="#h53-0-1989" id="h53-0-1989" class="i">+				} else {
</a><a href="#h53-0-1990" id="h53-0-1990" class="i">+					tv = NULL;
</a><a href="#h53-0-1991" id="h53-0-1991" class="i">+				}
</a><a href="#h53-0-1992" id="h53-0-1992" class="i">+			}
</a><a href="#h53-0-1993" id="h53-0-1993" class="i">+		}
</a><a href="#h53-0-1994" id="h53-0-1994" class="i">+	}
</a><a href="#h53-0-1995" id="h53-0-1995" class="i">+}
</a><a href="#h53-0-1996" id="h53-0-1996" class="i">+
</a><a href="#h53-0-1997" id="h53-0-1997" class="i">+void
</a><a href="#h53-0-1998" id="h53-0-1998" class="i">+usage(void)
</a><a href="#h53-0-1999" id="h53-0-1999" class="i">+{
</a><a href="#h53-0-2000" id="h53-0-2000" class="i">+	die(&quot;usage: %s [-aiv] [-c class] [-f font] [-g geometry]&quot;
</a><a href="#h53-0-2001" id="h53-0-2001" class="i">+	    &quot; [-n name] [-o file]\n&quot;
</a><a href="#h53-0-2002" id="h53-0-2002" class="i">+	    &quot;          [-T title] [-t title] [-w windowid]&quot;
</a><a href="#h53-0-2003" id="h53-0-2003" class="i">+	    &quot; [[-e] command [args ...]]\n&quot;
</a><a href="#h53-0-2004" id="h53-0-2004" class="i">+	    &quot;       %s [-aiv] [-c class] [-f font] [-g geometry]&quot;
</a><a href="#h53-0-2005" id="h53-0-2005" class="i">+	    &quot; [-n name] [-o file]\n&quot;
</a><a href="#h53-0-2006" id="h53-0-2006" class="i">+	    &quot;          [-T title] [-t title] [-w windowid] -l line&quot;
</a><a href="#h53-0-2007" id="h53-0-2007" class="i">+	    &quot; [stty_args ...]\n&quot;, argv0, argv0);
</a><a href="#h53-0-2008" id="h53-0-2008" class="i">+}
</a><a href="#h53-0-2009" id="h53-0-2009" class="i">+
</a><a href="#h53-0-2010" id="h53-0-2010" class="i">+int
</a><a href="#h53-0-2011" id="h53-0-2011" class="i">+main(int argc, char *argv[])
</a><a href="#h53-0-2012" id="h53-0-2012" class="i">+{
</a><a href="#h53-0-2013" id="h53-0-2013" class="i">+	xw.l = xw.t = 0;
</a><a href="#h53-0-2014" id="h53-0-2014" class="i">+	xw.isfixed = False;
</a><a href="#h53-0-2015" id="h53-0-2015" class="i">+	win.cursor = cursorshape;
</a><a href="#h53-0-2016" id="h53-0-2016" class="i">+
</a><a href="#h53-0-2017" id="h53-0-2017" class="i">+	ARGBEGIN {
</a><a href="#h53-0-2018" id="h53-0-2018" class="i">+	case &#39;a&#39;:
</a><a href="#h53-0-2019" id="h53-0-2019" class="i">+		allowaltscreen = 0;
</a><a href="#h53-0-2020" id="h53-0-2020" class="i">+		break;
</a><a href="#h53-0-2021" id="h53-0-2021" class="i">+	case &#39;c&#39;:
</a><a href="#h53-0-2022" id="h53-0-2022" class="i">+		opt_class = EARGF(usage());
</a><a href="#h53-0-2023" id="h53-0-2023" class="i">+		break;
</a><a href="#h53-0-2024" id="h53-0-2024" class="i">+	case &#39;e&#39;:
</a><a href="#h53-0-2025" id="h53-0-2025" class="i">+		if (argc &gt; 0)
</a><a href="#h53-0-2026" id="h53-0-2026" class="i">+			--argc, ++argv;
</a><a href="#h53-0-2027" id="h53-0-2027" class="i">+		goto run;
</a><a href="#h53-0-2028" id="h53-0-2028" class="i">+	case &#39;f&#39;:
</a><a href="#h53-0-2029" id="h53-0-2029" class="i">+		opt_font = EARGF(usage());
</a><a href="#h53-0-2030" id="h53-0-2030" class="i">+		break;
</a><a href="#h53-0-2031" id="h53-0-2031" class="i">+	case &#39;g&#39;:
</a><a href="#h53-0-2032" id="h53-0-2032" class="i">+		xw.gm = XParseGeometry(EARGF(usage()),
</a><a href="#h53-0-2033" id="h53-0-2033" class="i">+				&amp;xw.l, &amp;xw.t, &amp;cols, &amp;rows);
</a><a href="#h53-0-2034" id="h53-0-2034" class="i">+		break;
</a><a href="#h53-0-2035" id="h53-0-2035" class="i">+	case &#39;i&#39;:
</a><a href="#h53-0-2036" id="h53-0-2036" class="i">+		xw.isfixed = 1;
</a><a href="#h53-0-2037" id="h53-0-2037" class="i">+		break;
</a><a href="#h53-0-2038" id="h53-0-2038" class="i">+	case &#39;o&#39;:
</a><a href="#h53-0-2039" id="h53-0-2039" class="i">+		opt_io = EARGF(usage());
</a><a href="#h53-0-2040" id="h53-0-2040" class="i">+		break;
</a><a href="#h53-0-2041" id="h53-0-2041" class="i">+	case &#39;l&#39;:
</a><a href="#h53-0-2042" id="h53-0-2042" class="i">+		opt_line = EARGF(usage());
</a><a href="#h53-0-2043" id="h53-0-2043" class="i">+		break;
</a><a href="#h53-0-2044" id="h53-0-2044" class="i">+	case &#39;n&#39;:
</a><a href="#h53-0-2045" id="h53-0-2045" class="i">+		opt_name = EARGF(usage());
</a><a href="#h53-0-2046" id="h53-0-2046" class="i">+		break;
</a><a href="#h53-0-2047" id="h53-0-2047" class="i">+	case &#39;t&#39;:
</a><a href="#h53-0-2048" id="h53-0-2048" class="i">+	case &#39;T&#39;:
</a><a href="#h53-0-2049" id="h53-0-2049" class="i">+		opt_title = EARGF(usage());
</a><a href="#h53-0-2050" id="h53-0-2050" class="i">+		break;
</a><a href="#h53-0-2051" id="h53-0-2051" class="i">+	case &#39;w&#39;:
</a><a href="#h53-0-2052" id="h53-0-2052" class="i">+		opt_embed = EARGF(usage());
</a><a href="#h53-0-2053" id="h53-0-2053" class="i">+		break;
</a><a href="#h53-0-2054" id="h53-0-2054" class="i">+	case &#39;v&#39;:
</a><a href="#h53-0-2055" id="h53-0-2055" class="i">+		die(&quot;%s &quot; VERSION &quot;\n&quot;, argv0);
</a><a href="#h53-0-2056" id="h53-0-2056" class="i">+		break;
</a><a href="#h53-0-2057" id="h53-0-2057" class="i">+	default:
</a><a href="#h53-0-2058" id="h53-0-2058" class="i">+		usage();
</a><a href="#h53-0-2059" id="h53-0-2059" class="i">+	} ARGEND;
</a><a href="#h53-0-2060" id="h53-0-2060" class="i">+
</a><a href="#h53-0-2061" id="h53-0-2061" class="i">+run:
</a><a href="#h53-0-2062" id="h53-0-2062" class="i">+	if (argc &gt; 0) /* eat all remaining arguments */
</a><a href="#h53-0-2063" id="h53-0-2063" class="i">+		opt_cmd = argv;
</a><a href="#h53-0-2064" id="h53-0-2064" class="i">+
</a><a href="#h53-0-2065" id="h53-0-2065" class="i">+	if (!opt_title)
</a><a href="#h53-0-2066" id="h53-0-2066" class="i">+		opt_title = (opt_line || !opt_cmd) ? &quot;st&quot; : opt_cmd[0];
</a><a href="#h53-0-2067" id="h53-0-2067" class="i">+
</a><a href="#h53-0-2068" id="h53-0-2068" class="i">+	setlocale(LC_CTYPE, &quot;&quot;);
</a><a href="#h53-0-2069" id="h53-0-2069" class="i">+	XSetLocaleModifiers(&quot;&quot;);
</a><a href="#h53-0-2070" id="h53-0-2070" class="i">+	cols = MAX(cols, 1);
</a><a href="#h53-0-2071" id="h53-0-2071" class="i">+	rows = MAX(rows, 1);
</a><a href="#h53-0-2072" id="h53-0-2072" class="i">+	tnew(cols, rows);
</a><a href="#h53-0-2073" id="h53-0-2073" class="i">+	xinit(cols, rows);
</a><a href="#h53-0-2074" id="h53-0-2074" class="i">+	xsetenv();
</a><a href="#h53-0-2075" id="h53-0-2075" class="i">+	selinit();
</a><a href="#h53-0-2076" id="h53-0-2076" class="i">+	run();
</a><a href="#h53-0-2077" id="h53-0-2077" class="i">+
</a><a href="#h53-0-2078" id="h53-0-2078" class="i">+	return 0;
</a><a href="#h53-0-2079" id="h53-0-2079" class="i">+}
</a><b>diff --git a/<a id="h54" href="../file/st/x.c.orig.html">st/x.c.orig</a> b/<a href="../file/st/x.c.orig.html">st/x.c.orig</a></b>
<a href="#h54-0" id="h54-0" class="h">@@ -0,0 +1,2076 @@
</a><a href="#h54-0-0" id="h54-0-0" class="i">+/* See LICENSE for license details. */
</a><a href="#h54-0-1" id="h54-0-1" class="i">+#include &lt;errno.h&gt;
</a><a href="#h54-0-2" id="h54-0-2" class="i">+#include &lt;math.h&gt;
</a><a href="#h54-0-3" id="h54-0-3" class="i">+#include &lt;limits.h&gt;
</a><a href="#h54-0-4" id="h54-0-4" class="i">+#include &lt;locale.h&gt;
</a><a href="#h54-0-5" id="h54-0-5" class="i">+#include &lt;signal.h&gt;
</a><a href="#h54-0-6" id="h54-0-6" class="i">+#include &lt;sys/select.h&gt;
</a><a href="#h54-0-7" id="h54-0-7" class="i">+#include &lt;time.h&gt;
</a><a href="#h54-0-8" id="h54-0-8" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h54-0-9" id="h54-0-9" class="i">+#include &lt;libgen.h&gt;
</a><a href="#h54-0-10" id="h54-0-10" class="i">+#include &lt;X11/Xatom.h&gt;
</a><a href="#h54-0-11" id="h54-0-11" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h54-0-12" id="h54-0-12" class="i">+#include &lt;X11/cursorfont.h&gt;
</a><a href="#h54-0-13" id="h54-0-13" class="i">+#include &lt;X11/keysym.h&gt;
</a><a href="#h54-0-14" id="h54-0-14" class="i">+#include &lt;X11/Xft/Xft.h&gt;
</a><a href="#h54-0-15" id="h54-0-15" class="i">+#include &lt;X11/XKBlib.h&gt;
</a><a href="#h54-0-16" id="h54-0-16" class="i">+
</a><a href="#h54-0-17" id="h54-0-17" class="i">+static char *argv0;
</a><a href="#h54-0-18" id="h54-0-18" class="i">+#include &quot;arg.h&quot;
</a><a href="#h54-0-19" id="h54-0-19" class="i">+#include &quot;st.h&quot;
</a><a href="#h54-0-20" id="h54-0-20" class="i">+#include &quot;win.h&quot;
</a><a href="#h54-0-21" id="h54-0-21" class="i">+
</a><a href="#h54-0-22" id="h54-0-22" class="i">+/* types used in config.h */
</a><a href="#h54-0-23" id="h54-0-23" class="i">+typedef struct {
</a><a href="#h54-0-24" id="h54-0-24" class="i">+	uint mod;
</a><a href="#h54-0-25" id="h54-0-25" class="i">+	KeySym keysym;
</a><a href="#h54-0-26" id="h54-0-26" class="i">+	void (*func)(const Arg *);
</a><a href="#h54-0-27" id="h54-0-27" class="i">+	const Arg arg;
</a><a href="#h54-0-28" id="h54-0-28" class="i">+} Shortcut;
</a><a href="#h54-0-29" id="h54-0-29" class="i">+
</a><a href="#h54-0-30" id="h54-0-30" class="i">+typedef struct {
</a><a href="#h54-0-31" id="h54-0-31" class="i">+	uint b;
</a><a href="#h54-0-32" id="h54-0-32" class="i">+	uint mask;
</a><a href="#h54-0-33" id="h54-0-33" class="i">+	char *s;
</a><a href="#h54-0-34" id="h54-0-34" class="i">+} MouseShortcut;
</a><a href="#h54-0-35" id="h54-0-35" class="i">+
</a><a href="#h54-0-36" id="h54-0-36" class="i">+typedef struct {
</a><a href="#h54-0-37" id="h54-0-37" class="i">+	KeySym k;
</a><a href="#h54-0-38" id="h54-0-38" class="i">+	uint mask;
</a><a href="#h54-0-39" id="h54-0-39" class="i">+	char *s;
</a><a href="#h54-0-40" id="h54-0-40" class="i">+	/* three-valued logic variables: 0 indifferent, 1 on, -1 off */
</a><a href="#h54-0-41" id="h54-0-41" class="i">+	signed char appkey;    /* application keypad */
</a><a href="#h54-0-42" id="h54-0-42" class="i">+	signed char appcursor; /* application cursor */
</a><a href="#h54-0-43" id="h54-0-43" class="i">+} Key;
</a><a href="#h54-0-44" id="h54-0-44" class="i">+
</a><a href="#h54-0-45" id="h54-0-45" class="i">+/* X modifiers */
</a><a href="#h54-0-46" id="h54-0-46" class="i">+#define XK_ANY_MOD    UINT_MAX
</a><a href="#h54-0-47" id="h54-0-47" class="i">+#define XK_NO_MOD     0
</a><a href="#h54-0-48" id="h54-0-48" class="i">+#define XK_SWITCH_MOD (1&lt;&lt;13)
</a><a href="#h54-0-49" id="h54-0-49" class="i">+
</a><a href="#h54-0-50" id="h54-0-50" class="i">+/* alpha */
</a><a href="#h54-0-51" id="h54-0-51" class="i">+#define OPAQUE 0Xff
</a><a href="#h54-0-52" id="h54-0-52" class="i">+#define USE_ARGB (alpha != OPAQUE &amp;&amp; opt_embed == NULL)
</a><a href="#h54-0-53" id="h54-0-53" class="i">+
</a><a href="#h54-0-54" id="h54-0-54" class="i">+/* function definitions used in config.h */
</a><a href="#h54-0-55" id="h54-0-55" class="i">+static void clipcopy(const Arg *);
</a><a href="#h54-0-56" id="h54-0-56" class="i">+static void clippaste(const Arg *);
</a><a href="#h54-0-57" id="h54-0-57" class="i">+static void numlock(const Arg *);
</a><a href="#h54-0-58" id="h54-0-58" class="i">+static void selpaste(const Arg *);
</a><a href="#h54-0-59" id="h54-0-59" class="i">+static void zoom(const Arg *);
</a><a href="#h54-0-60" id="h54-0-60" class="i">+static void zoomabs(const Arg *);
</a><a href="#h54-0-61" id="h54-0-61" class="i">+static void zoomreset(const Arg *);
</a><a href="#h54-0-62" id="h54-0-62" class="i">+
</a><a href="#h54-0-63" id="h54-0-63" class="i">+/* config.h for applying patches and the configuration. */
</a><a href="#h54-0-64" id="h54-0-64" class="i">+#include &quot;config.h&quot;
</a><a href="#h54-0-65" id="h54-0-65" class="i">+
</a><a href="#h54-0-66" id="h54-0-66" class="i">+/* XEMBED messages */
</a><a href="#h54-0-67" id="h54-0-67" class="i">+#define XEMBED_FOCUS_IN  4
</a><a href="#h54-0-68" id="h54-0-68" class="i">+#define XEMBED_FOCUS_OUT 5
</a><a href="#h54-0-69" id="h54-0-69" class="i">+
</a><a href="#h54-0-70" id="h54-0-70" class="i">+/* macros */
</a><a href="#h54-0-71" id="h54-0-71" class="i">+#define IS_SET(flag)		((win.mode &amp; (flag)) != 0)
</a><a href="#h54-0-72" id="h54-0-72" class="i">+#define TRUERED(x)		(((x) &amp; 0xff0000) &gt;&gt; 8)
</a><a href="#h54-0-73" id="h54-0-73" class="i">+#define TRUEGREEN(x)		(((x) &amp; 0xff00))
</a><a href="#h54-0-74" id="h54-0-74" class="i">+#define TRUEBLUE(x)		(((x) &amp; 0xff) &lt;&lt; 8)
</a><a href="#h54-0-75" id="h54-0-75" class="i">+
</a><a href="#h54-0-76" id="h54-0-76" class="i">+typedef XftDraw *Draw;
</a><a href="#h54-0-77" id="h54-0-77" class="i">+typedef XftColor Color;
</a><a href="#h54-0-78" id="h54-0-78" class="i">+typedef XftGlyphFontSpec GlyphFontSpec;
</a><a href="#h54-0-79" id="h54-0-79" class="i">+
</a><a href="#h54-0-80" id="h54-0-80" class="i">+/* Purely graphic info */
</a><a href="#h54-0-81" id="h54-0-81" class="i">+typedef struct {
</a><a href="#h54-0-82" id="h54-0-82" class="i">+	int tw, th; /* tty width and height */
</a><a href="#h54-0-83" id="h54-0-83" class="i">+	int w, h; /* window width and height */
</a><a href="#h54-0-84" id="h54-0-84" class="i">+	int ch; /* char height */
</a><a href="#h54-0-85" id="h54-0-85" class="i">+	int cw; /* char width  */
</a><a href="#h54-0-86" id="h54-0-86" class="i">+	int mode; /* window state/mode flags */
</a><a href="#h54-0-87" id="h54-0-87" class="i">+	int cursor; /* cursor style */
</a><a href="#h54-0-88" id="h54-0-88" class="i">+} TermWindow;
</a><a href="#h54-0-89" id="h54-0-89" class="i">+
</a><a href="#h54-0-90" id="h54-0-90" class="i">+typedef struct {
</a><a href="#h54-0-91" id="h54-0-91" class="i">+	Display *dpy;
</a><a href="#h54-0-92" id="h54-0-92" class="i">+	Colormap cmap;
</a><a href="#h54-0-93" id="h54-0-93" class="i">+	Window win;
</a><a href="#h54-0-94" id="h54-0-94" class="i">+	Drawable buf;
</a><a href="#h54-0-95" id="h54-0-95" class="i">+	GlyphFontSpec *specbuf; /* font spec buffer used for rendering */
</a><a href="#h54-0-96" id="h54-0-96" class="i">+	Atom xembed, wmdeletewin, netwmname, netwmpid;
</a><a href="#h54-0-97" id="h54-0-97" class="i">+	XIM xim;
</a><a href="#h54-0-98" id="h54-0-98" class="i">+	XIC xic;
</a><a href="#h54-0-99" id="h54-0-99" class="i">+	Draw draw;
</a><a href="#h54-0-100" id="h54-0-100" class="i">+	Visual *vis;
</a><a href="#h54-0-101" id="h54-0-101" class="i">+	XSetWindowAttributes attrs;
</a><a href="#h54-0-102" id="h54-0-102" class="i">+	/* Here, we use the term *pointer* to differentiate the cursor
</a><a href="#h54-0-103" id="h54-0-103" class="i">+	 * one sees when hovering the mouse over the terminal from, e.g.,
</a><a href="#h54-0-104" id="h54-0-104" class="i">+	 * a green rectangle where text would be entered. */
</a><a href="#h54-0-105" id="h54-0-105" class="i">+	Cursor vpointer, bpointer; /* visible and hidden pointers */
</a><a href="#h54-0-106" id="h54-0-106" class="i">+	int pointerisvisible;
</a><a href="#h54-0-107" id="h54-0-107" class="i">+	int scr;
</a><a href="#h54-0-108" id="h54-0-108" class="i">+	int isfixed; /* is fixed geometry? */
</a><a href="#h54-0-109" id="h54-0-109" class="i">+	int depth; /* bit depth */
</a><a href="#h54-0-110" id="h54-0-110" class="i">+	int l, t; /* left and top offset */
</a><a href="#h54-0-111" id="h54-0-111" class="i">+	int gm; /* geometry mask */
</a><a href="#h54-0-112" id="h54-0-112" class="i">+} XWindow;
</a><a href="#h54-0-113" id="h54-0-113" class="i">+
</a><a href="#h54-0-114" id="h54-0-114" class="i">+typedef struct {
</a><a href="#h54-0-115" id="h54-0-115" class="i">+	Atom xtarget;
</a><a href="#h54-0-116" id="h54-0-116" class="i">+	char *primary, *clipboard;
</a><a href="#h54-0-117" id="h54-0-117" class="i">+	struct timespec tclick1;
</a><a href="#h54-0-118" id="h54-0-118" class="i">+	struct timespec tclick2;
</a><a href="#h54-0-119" id="h54-0-119" class="i">+} XSelection;
</a><a href="#h54-0-120" id="h54-0-120" class="i">+
</a><a href="#h54-0-121" id="h54-0-121" class="i">+/* Font structure */
</a><a href="#h54-0-122" id="h54-0-122" class="i">+#define Font Font_
</a><a href="#h54-0-123" id="h54-0-123" class="i">+typedef struct {
</a><a href="#h54-0-124" id="h54-0-124" class="i">+	int height;
</a><a href="#h54-0-125" id="h54-0-125" class="i">+	int width;
</a><a href="#h54-0-126" id="h54-0-126" class="i">+	int ascent;
</a><a href="#h54-0-127" id="h54-0-127" class="i">+	int descent;
</a><a href="#h54-0-128" id="h54-0-128" class="i">+	int badslant;
</a><a href="#h54-0-129" id="h54-0-129" class="i">+	int badweight;
</a><a href="#h54-0-130" id="h54-0-130" class="i">+	short lbearing;
</a><a href="#h54-0-131" id="h54-0-131" class="i">+	short rbearing;
</a><a href="#h54-0-132" id="h54-0-132" class="i">+	XftFont *match;
</a><a href="#h54-0-133" id="h54-0-133" class="i">+	FcFontSet *set;
</a><a href="#h54-0-134" id="h54-0-134" class="i">+	FcPattern *pattern;
</a><a href="#h54-0-135" id="h54-0-135" class="i">+} Font;
</a><a href="#h54-0-136" id="h54-0-136" class="i">+
</a><a href="#h54-0-137" id="h54-0-137" class="i">+/* Drawing Context */
</a><a href="#h54-0-138" id="h54-0-138" class="i">+typedef struct {
</a><a href="#h54-0-139" id="h54-0-139" class="i">+	Color *col;
</a><a href="#h54-0-140" id="h54-0-140" class="i">+	size_t collen;
</a><a href="#h54-0-141" id="h54-0-141" class="i">+	Font font, bfont, ifont, ibfont;
</a><a href="#h54-0-142" id="h54-0-142" class="i">+	GC gc;
</a><a href="#h54-0-143" id="h54-0-143" class="i">+} DC;
</a><a href="#h54-0-144" id="h54-0-144" class="i">+
</a><a href="#h54-0-145" id="h54-0-145" class="i">+static inline ushort sixd_to_16bit(int);
</a><a href="#h54-0-146" id="h54-0-146" class="i">+static int xmakeglyphfontspecs(XftGlyphFontSpec *, const Glyph *, int, int, int);
</a><a href="#h54-0-147" id="h54-0-147" class="i">+static void xdrawglyphfontspecs(const XftGlyphFontSpec *, Glyph, int, int, int);
</a><a href="#h54-0-148" id="h54-0-148" class="i">+static void xdrawglyph(Glyph, int, int);
</a><a href="#h54-0-149" id="h54-0-149" class="i">+static void xclear(int, int, int, int);
</a><a href="#h54-0-150" id="h54-0-150" class="i">+static int xgeommasktogravity(int);
</a><a href="#h54-0-151" id="h54-0-151" class="i">+static void ximopen(Display *);
</a><a href="#h54-0-152" id="h54-0-152" class="i">+static void ximinstantiate(Display *, XPointer, XPointer);
</a><a href="#h54-0-153" id="h54-0-153" class="i">+static void ximdestroy(XIM, XPointer, XPointer);
</a><a href="#h54-0-154" id="h54-0-154" class="i">+static void xinit(int, int);
</a><a href="#h54-0-155" id="h54-0-155" class="i">+static void cresize(int, int);
</a><a href="#h54-0-156" id="h54-0-156" class="i">+static void xresize(int, int);
</a><a href="#h54-0-157" id="h54-0-157" class="i">+static void xhints(void);
</a><a href="#h54-0-158" id="h54-0-158" class="i">+static int xloadcolor(int, const char *, Color *);
</a><a href="#h54-0-159" id="h54-0-159" class="i">+static int xloadfont(Font *, FcPattern *);
</a><a href="#h54-0-160" id="h54-0-160" class="i">+static void xloadfonts(char *, double);
</a><a href="#h54-0-161" id="h54-0-161" class="i">+static void xunloadfont(Font *);
</a><a href="#h54-0-162" id="h54-0-162" class="i">+static void xunloadfonts(void);
</a><a href="#h54-0-163" id="h54-0-163" class="i">+static void xsetenv(void);
</a><a href="#h54-0-164" id="h54-0-164" class="i">+static void xseturgency(int);
</a><a href="#h54-0-165" id="h54-0-165" class="i">+static int evcol(XEvent *);
</a><a href="#h54-0-166" id="h54-0-166" class="i">+static int evrow(XEvent *);
</a><a href="#h54-0-167" id="h54-0-167" class="i">+
</a><a href="#h54-0-168" id="h54-0-168" class="i">+static void expose(XEvent *);
</a><a href="#h54-0-169" id="h54-0-169" class="i">+static void visibility(XEvent *);
</a><a href="#h54-0-170" id="h54-0-170" class="i">+static void unmap(XEvent *);
</a><a href="#h54-0-171" id="h54-0-171" class="i">+static void kpress(XEvent *);
</a><a href="#h54-0-172" id="h54-0-172" class="i">+static void cmessage(XEvent *);
</a><a href="#h54-0-173" id="h54-0-173" class="i">+static void resize(XEvent *);
</a><a href="#h54-0-174" id="h54-0-174" class="i">+static void focus(XEvent *);
</a><a href="#h54-0-175" id="h54-0-175" class="i">+static void brelease(XEvent *);
</a><a href="#h54-0-176" id="h54-0-176" class="i">+static void bpress(XEvent *);
</a><a href="#h54-0-177" id="h54-0-177" class="i">+static void bmotion(XEvent *);
</a><a href="#h54-0-178" id="h54-0-178" class="i">+static void propnotify(XEvent *);
</a><a href="#h54-0-179" id="h54-0-179" class="i">+static void selnotify(XEvent *);
</a><a href="#h54-0-180" id="h54-0-180" class="i">+static void selclear_(XEvent *);
</a><a href="#h54-0-181" id="h54-0-181" class="i">+static void selrequest(XEvent *);
</a><a href="#h54-0-182" id="h54-0-182" class="i">+static void setsel(char *, Time);
</a><a href="#h54-0-183" id="h54-0-183" class="i">+static void mousesel(XEvent *, int);
</a><a href="#h54-0-184" id="h54-0-184" class="i">+static void mousereport(XEvent *);
</a><a href="#h54-0-185" id="h54-0-185" class="i">+static char *kmap(KeySym, uint);
</a><a href="#h54-0-186" id="h54-0-186" class="i">+static int match(uint, uint);
</a><a href="#h54-0-187" id="h54-0-187" class="i">+
</a><a href="#h54-0-188" id="h54-0-188" class="i">+static void run(void);
</a><a href="#h54-0-189" id="h54-0-189" class="i">+static void usage(void);
</a><a href="#h54-0-190" id="h54-0-190" class="i">+
</a><a href="#h54-0-191" id="h54-0-191" class="i">+static void (*handler[LASTEvent])(XEvent *) = {
</a><a href="#h54-0-192" id="h54-0-192" class="i">+	[KeyPress] = kpress,
</a><a href="#h54-0-193" id="h54-0-193" class="i">+	[ClientMessage] = cmessage,
</a><a href="#h54-0-194" id="h54-0-194" class="i">+	[ConfigureNotify] = resize,
</a><a href="#h54-0-195" id="h54-0-195" class="i">+	[VisibilityNotify] = visibility,
</a><a href="#h54-0-196" id="h54-0-196" class="i">+	[UnmapNotify] = unmap,
</a><a href="#h54-0-197" id="h54-0-197" class="i">+	[Expose] = expose,
</a><a href="#h54-0-198" id="h54-0-198" class="i">+	[FocusIn] = focus,
</a><a href="#h54-0-199" id="h54-0-199" class="i">+	[FocusOut] = focus,
</a><a href="#h54-0-200" id="h54-0-200" class="i">+	[MotionNotify] = bmotion,
</a><a href="#h54-0-201" id="h54-0-201" class="i">+	[ButtonPress] = bpress,
</a><a href="#h54-0-202" id="h54-0-202" class="i">+	[ButtonRelease] = brelease,
</a><a href="#h54-0-203" id="h54-0-203" class="i">+/*
</a><a href="#h54-0-204" id="h54-0-204" class="i">+ * Uncomment if you want the selection to disappear when you select something
</a><a href="#h54-0-205" id="h54-0-205" class="i">+ * different in another window.
</a><a href="#h54-0-206" id="h54-0-206" class="i">+ */
</a><a href="#h54-0-207" id="h54-0-207" class="i">+/*	[SelectionClear] = selclear_, */
</a><a href="#h54-0-208" id="h54-0-208" class="i">+	[SelectionNotify] = selnotify,
</a><a href="#h54-0-209" id="h54-0-209" class="i">+/*
</a><a href="#h54-0-210" id="h54-0-210" class="i">+ * PropertyNotify is only turned on when there is some INCR transfer happening
</a><a href="#h54-0-211" id="h54-0-211" class="i">+ * for the selection retrieval.
</a><a href="#h54-0-212" id="h54-0-212" class="i">+ */
</a><a href="#h54-0-213" id="h54-0-213" class="i">+	[PropertyNotify] = propnotify,
</a><a href="#h54-0-214" id="h54-0-214" class="i">+	[SelectionRequest] = selrequest,
</a><a href="#h54-0-215" id="h54-0-215" class="i">+};
</a><a href="#h54-0-216" id="h54-0-216" class="i">+
</a><a href="#h54-0-217" id="h54-0-217" class="i">+/* Globals */
</a><a href="#h54-0-218" id="h54-0-218" class="i">+static DC dc;
</a><a href="#h54-0-219" id="h54-0-219" class="i">+static XWindow xw;
</a><a href="#h54-0-220" id="h54-0-220" class="i">+static XSelection xsel;
</a><a href="#h54-0-221" id="h54-0-221" class="i">+static TermWindow win;
</a><a href="#h54-0-222" id="h54-0-222" class="i">+
</a><a href="#h54-0-223" id="h54-0-223" class="i">+/* Font Ring Cache */
</a><a href="#h54-0-224" id="h54-0-224" class="i">+enum {
</a><a href="#h54-0-225" id="h54-0-225" class="i">+	FRC_NORMAL,
</a><a href="#h54-0-226" id="h54-0-226" class="i">+	FRC_ITALIC,
</a><a href="#h54-0-227" id="h54-0-227" class="i">+	FRC_BOLD,
</a><a href="#h54-0-228" id="h54-0-228" class="i">+	FRC_ITALICBOLD
</a><a href="#h54-0-229" id="h54-0-229" class="i">+};
</a><a href="#h54-0-230" id="h54-0-230" class="i">+
</a><a href="#h54-0-231" id="h54-0-231" class="i">+typedef struct {
</a><a href="#h54-0-232" id="h54-0-232" class="i">+	XftFont *font;
</a><a href="#h54-0-233" id="h54-0-233" class="i">+	int flags;
</a><a href="#h54-0-234" id="h54-0-234" class="i">+	Rune unicodep;
</a><a href="#h54-0-235" id="h54-0-235" class="i">+} Fontcache;
</a><a href="#h54-0-236" id="h54-0-236" class="i">+
</a><a href="#h54-0-237" id="h54-0-237" class="i">+/* Fontcache is an array now. A new font will be appended to the array. */
</a><a href="#h54-0-238" id="h54-0-238" class="i">+static Fontcache frc[16];
</a><a href="#h54-0-239" id="h54-0-239" class="i">+static int frclen = 0;
</a><a href="#h54-0-240" id="h54-0-240" class="i">+static char *usedfont = NULL;
</a><a href="#h54-0-241" id="h54-0-241" class="i">+static double usedfontsize = 0;
</a><a href="#h54-0-242" id="h54-0-242" class="i">+static double defaultfontsize = 0;
</a><a href="#h54-0-243" id="h54-0-243" class="i">+
</a><a href="#h54-0-244" id="h54-0-244" class="i">+static char *opt_class = NULL;
</a><a href="#h54-0-245" id="h54-0-245" class="i">+static char **opt_cmd  = NULL;
</a><a href="#h54-0-246" id="h54-0-246" class="i">+static char *opt_embed = NULL;
</a><a href="#h54-0-247" id="h54-0-247" class="i">+static char *opt_font  = NULL;
</a><a href="#h54-0-248" id="h54-0-248" class="i">+static char *opt_io    = NULL;
</a><a href="#h54-0-249" id="h54-0-249" class="i">+static char *opt_line  = NULL;
</a><a href="#h54-0-250" id="h54-0-250" class="i">+static char *opt_name  = NULL;
</a><a href="#h54-0-251" id="h54-0-251" class="i">+static char *opt_title = NULL;
</a><a href="#h54-0-252" id="h54-0-252" class="i">+
</a><a href="#h54-0-253" id="h54-0-253" class="i">+static int oldbutton = 3; /* button event on startup: 3 = release */
</a><a href="#h54-0-254" id="h54-0-254" class="i">+
</a><a href="#h54-0-255" id="h54-0-255" class="i">+void
</a><a href="#h54-0-256" id="h54-0-256" class="i">+clipcopy(const Arg *dummy)
</a><a href="#h54-0-257" id="h54-0-257" class="i">+{
</a><a href="#h54-0-258" id="h54-0-258" class="i">+	Atom clipboard;
</a><a href="#h54-0-259" id="h54-0-259" class="i">+
</a><a href="#h54-0-260" id="h54-0-260" class="i">+	free(xsel.clipboard);
</a><a href="#h54-0-261" id="h54-0-261" class="i">+	xsel.clipboard = NULL;
</a><a href="#h54-0-262" id="h54-0-262" class="i">+
</a><a href="#h54-0-263" id="h54-0-263" class="i">+	if (xsel.primary != NULL) {
</a><a href="#h54-0-264" id="h54-0-264" class="i">+		xsel.clipboard = xstrdup(xsel.primary);
</a><a href="#h54-0-265" id="h54-0-265" class="i">+		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h54-0-266" id="h54-0-266" class="i">+		XSetSelectionOwner(xw.dpy, clipboard, xw.win, CurrentTime);
</a><a href="#h54-0-267" id="h54-0-267" class="i">+	}
</a><a href="#h54-0-268" id="h54-0-268" class="i">+}
</a><a href="#h54-0-269" id="h54-0-269" class="i">+
</a><a href="#h54-0-270" id="h54-0-270" class="i">+void
</a><a href="#h54-0-271" id="h54-0-271" class="i">+clippaste(const Arg *dummy)
</a><a href="#h54-0-272" id="h54-0-272" class="i">+{
</a><a href="#h54-0-273" id="h54-0-273" class="i">+	Atom clipboard;
</a><a href="#h54-0-274" id="h54-0-274" class="i">+
</a><a href="#h54-0-275" id="h54-0-275" class="i">+	clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h54-0-276" id="h54-0-276" class="i">+	XConvertSelection(xw.dpy, clipboard, xsel.xtarget, clipboard,
</a><a href="#h54-0-277" id="h54-0-277" class="i">+			xw.win, CurrentTime);
</a><a href="#h54-0-278" id="h54-0-278" class="i">+}
</a><a href="#h54-0-279" id="h54-0-279" class="i">+
</a><a href="#h54-0-280" id="h54-0-280" class="i">+void
</a><a href="#h54-0-281" id="h54-0-281" class="i">+selpaste(const Arg *dummy)
</a><a href="#h54-0-282" id="h54-0-282" class="i">+{
</a><a href="#h54-0-283" id="h54-0-283" class="i">+	XConvertSelection(xw.dpy, XA_PRIMARY, xsel.xtarget, XA_PRIMARY,
</a><a href="#h54-0-284" id="h54-0-284" class="i">+			xw.win, CurrentTime);
</a><a href="#h54-0-285" id="h54-0-285" class="i">+}
</a><a href="#h54-0-286" id="h54-0-286" class="i">+
</a><a href="#h54-0-287" id="h54-0-287" class="i">+void
</a><a href="#h54-0-288" id="h54-0-288" class="i">+numlock(const Arg *dummy)
</a><a href="#h54-0-289" id="h54-0-289" class="i">+{
</a><a href="#h54-0-290" id="h54-0-290" class="i">+	win.mode ^= MODE_NUMLOCK;
</a><a href="#h54-0-291" id="h54-0-291" class="i">+}
</a><a href="#h54-0-292" id="h54-0-292" class="i">+
</a><a href="#h54-0-293" id="h54-0-293" class="i">+void
</a><a href="#h54-0-294" id="h54-0-294" class="i">+zoom(const Arg *arg)
</a><a href="#h54-0-295" id="h54-0-295" class="i">+{
</a><a href="#h54-0-296" id="h54-0-296" class="i">+	Arg larg;
</a><a href="#h54-0-297" id="h54-0-297" class="i">+
</a><a href="#h54-0-298" id="h54-0-298" class="i">+	larg.f = usedfontsize + arg-&gt;f;
</a><a href="#h54-0-299" id="h54-0-299" class="i">+	zoomabs(&amp;larg);
</a><a href="#h54-0-300" id="h54-0-300" class="i">+}
</a><a href="#h54-0-301" id="h54-0-301" class="i">+
</a><a href="#h54-0-302" id="h54-0-302" class="i">+void
</a><a href="#h54-0-303" id="h54-0-303" class="i">+zoomabs(const Arg *arg)
</a><a href="#h54-0-304" id="h54-0-304" class="i">+{
</a><a href="#h54-0-305" id="h54-0-305" class="i">+	xunloadfonts();
</a><a href="#h54-0-306" id="h54-0-306" class="i">+	xloadfonts(usedfont, arg-&gt;f);
</a><a href="#h54-0-307" id="h54-0-307" class="i">+	cresize(0, 0);
</a><a href="#h54-0-308" id="h54-0-308" class="i">+	redraw();
</a><a href="#h54-0-309" id="h54-0-309" class="i">+	xhints();
</a><a href="#h54-0-310" id="h54-0-310" class="i">+}
</a><a href="#h54-0-311" id="h54-0-311" class="i">+
</a><a href="#h54-0-312" id="h54-0-312" class="i">+void
</a><a href="#h54-0-313" id="h54-0-313" class="i">+zoomreset(const Arg *arg)
</a><a href="#h54-0-314" id="h54-0-314" class="i">+{
</a><a href="#h54-0-315" id="h54-0-315" class="i">+	Arg larg;
</a><a href="#h54-0-316" id="h54-0-316" class="i">+
</a><a href="#h54-0-317" id="h54-0-317" class="i">+	if (defaultfontsize &gt; 0) {
</a><a href="#h54-0-318" id="h54-0-318" class="i">+		larg.f = defaultfontsize;
</a><a href="#h54-0-319" id="h54-0-319" class="i">+		zoomabs(&amp;larg);
</a><a href="#h54-0-320" id="h54-0-320" class="i">+	}
</a><a href="#h54-0-321" id="h54-0-321" class="i">+}
</a><a href="#h54-0-322" id="h54-0-322" class="i">+
</a><a href="#h54-0-323" id="h54-0-323" class="i">+int
</a><a href="#h54-0-324" id="h54-0-324" class="i">+evcol(XEvent *e)
</a><a href="#h54-0-325" id="h54-0-325" class="i">+{
</a><a href="#h54-0-326" id="h54-0-326" class="i">+	int x = e-&gt;xbutton.x - borderpx;
</a><a href="#h54-0-327" id="h54-0-327" class="i">+	LIMIT(x, 0, win.tw - 1);
</a><a href="#h54-0-328" id="h54-0-328" class="i">+	return x / win.cw;
</a><a href="#h54-0-329" id="h54-0-329" class="i">+}
</a><a href="#h54-0-330" id="h54-0-330" class="i">+
</a><a href="#h54-0-331" id="h54-0-331" class="i">+int
</a><a href="#h54-0-332" id="h54-0-332" class="i">+evrow(XEvent *e)
</a><a href="#h54-0-333" id="h54-0-333" class="i">+{
</a><a href="#h54-0-334" id="h54-0-334" class="i">+	int y = e-&gt;xbutton.y - borderpx;
</a><a href="#h54-0-335" id="h54-0-335" class="i">+	LIMIT(y, 0, win.th - 1);
</a><a href="#h54-0-336" id="h54-0-336" class="i">+	return y / win.ch;
</a><a href="#h54-0-337" id="h54-0-337" class="i">+}
</a><a href="#h54-0-338" id="h54-0-338" class="i">+
</a><a href="#h54-0-339" id="h54-0-339" class="i">+void
</a><a href="#h54-0-340" id="h54-0-340" class="i">+mousesel(XEvent *e, int done)
</a><a href="#h54-0-341" id="h54-0-341" class="i">+{
</a><a href="#h54-0-342" id="h54-0-342" class="i">+	int type, seltype = SEL_REGULAR;
</a><a href="#h54-0-343" id="h54-0-343" class="i">+	uint state = e-&gt;xbutton.state &amp; ~(Button1Mask | forceselmod);
</a><a href="#h54-0-344" id="h54-0-344" class="i">+
</a><a href="#h54-0-345" id="h54-0-345" class="i">+	for (type = 1; type &lt; LEN(selmasks); ++type) {
</a><a href="#h54-0-346" id="h54-0-346" class="i">+		if (match(selmasks[type], state)) {
</a><a href="#h54-0-347" id="h54-0-347" class="i">+			seltype = type;
</a><a href="#h54-0-348" id="h54-0-348" class="i">+			break;
</a><a href="#h54-0-349" id="h54-0-349" class="i">+		}
</a><a href="#h54-0-350" id="h54-0-350" class="i">+	}
</a><a href="#h54-0-351" id="h54-0-351" class="i">+	selextend(evcol(e), evrow(e), seltype, done);
</a><a href="#h54-0-352" id="h54-0-352" class="i">+	if (done)
</a><a href="#h54-0-353" id="h54-0-353" class="i">+		setsel(getsel(), e-&gt;xbutton.time);
</a><a href="#h54-0-354" id="h54-0-354" class="i">+}
</a><a href="#h54-0-355" id="h54-0-355" class="i">+
</a><a href="#h54-0-356" id="h54-0-356" class="i">+void
</a><a href="#h54-0-357" id="h54-0-357" class="i">+mousereport(XEvent *e)
</a><a href="#h54-0-358" id="h54-0-358" class="i">+{
</a><a href="#h54-0-359" id="h54-0-359" class="i">+	int len, x = evcol(e), y = evrow(e),
</a><a href="#h54-0-360" id="h54-0-360" class="i">+	    button = e-&gt;xbutton.button, state = e-&gt;xbutton.state;
</a><a href="#h54-0-361" id="h54-0-361" class="i">+	char buf[40];
</a><a href="#h54-0-362" id="h54-0-362" class="i">+	static int ox, oy;
</a><a href="#h54-0-363" id="h54-0-363" class="i">+
</a><a href="#h54-0-364" id="h54-0-364" class="i">+	/* from urxvt */
</a><a href="#h54-0-365" id="h54-0-365" class="i">+	if (e-&gt;xbutton.type == MotionNotify) {
</a><a href="#h54-0-366" id="h54-0-366" class="i">+		if (x == ox &amp;&amp; y == oy)
</a><a href="#h54-0-367" id="h54-0-367" class="i">+			return;
</a><a href="#h54-0-368" id="h54-0-368" class="i">+		if (!IS_SET(MODE_MOUSEMOTION) &amp;&amp; !IS_SET(MODE_MOUSEMANY))
</a><a href="#h54-0-369" id="h54-0-369" class="i">+			return;
</a><a href="#h54-0-370" id="h54-0-370" class="i">+		/* MOUSE_MOTION: no reporting if no button is pressed */
</a><a href="#h54-0-371" id="h54-0-371" class="i">+		if (IS_SET(MODE_MOUSEMOTION) &amp;&amp; oldbutton == 3)
</a><a href="#h54-0-372" id="h54-0-372" class="i">+			return;
</a><a href="#h54-0-373" id="h54-0-373" class="i">+
</a><a href="#h54-0-374" id="h54-0-374" class="i">+		button = oldbutton + 32;
</a><a href="#h54-0-375" id="h54-0-375" class="i">+		ox = x;
</a><a href="#h54-0-376" id="h54-0-376" class="i">+		oy = y;
</a><a href="#h54-0-377" id="h54-0-377" class="i">+	} else {
</a><a href="#h54-0-378" id="h54-0-378" class="i">+		if (!IS_SET(MODE_MOUSESGR) &amp;&amp; e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h54-0-379" id="h54-0-379" class="i">+			button = 3;
</a><a href="#h54-0-380" id="h54-0-380" class="i">+		} else {
</a><a href="#h54-0-381" id="h54-0-381" class="i">+			button -= Button1;
</a><a href="#h54-0-382" id="h54-0-382" class="i">+			if (button &gt;= 3)
</a><a href="#h54-0-383" id="h54-0-383" class="i">+				button += 64 - 3;
</a><a href="#h54-0-384" id="h54-0-384" class="i">+		}
</a><a href="#h54-0-385" id="h54-0-385" class="i">+		if (e-&gt;xbutton.type == ButtonPress) {
</a><a href="#h54-0-386" id="h54-0-386" class="i">+			oldbutton = button;
</a><a href="#h54-0-387" id="h54-0-387" class="i">+			ox = x;
</a><a href="#h54-0-388" id="h54-0-388" class="i">+			oy = y;
</a><a href="#h54-0-389" id="h54-0-389" class="i">+		} else if (e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h54-0-390" id="h54-0-390" class="i">+			oldbutton = 3;
</a><a href="#h54-0-391" id="h54-0-391" class="i">+			/* MODE_MOUSEX10: no button release reporting */
</a><a href="#h54-0-392" id="h54-0-392" class="i">+			if (IS_SET(MODE_MOUSEX10))
</a><a href="#h54-0-393" id="h54-0-393" class="i">+				return;
</a><a href="#h54-0-394" id="h54-0-394" class="i">+			if (button == 64 || button == 65)
</a><a href="#h54-0-395" id="h54-0-395" class="i">+				return;
</a><a href="#h54-0-396" id="h54-0-396" class="i">+		}
</a><a href="#h54-0-397" id="h54-0-397" class="i">+	}
</a><a href="#h54-0-398" id="h54-0-398" class="i">+
</a><a href="#h54-0-399" id="h54-0-399" class="i">+	if (!IS_SET(MODE_MOUSEX10)) {
</a><a href="#h54-0-400" id="h54-0-400" class="i">+		button += ((state &amp; ShiftMask  ) ? 4  : 0)
</a><a href="#h54-0-401" id="h54-0-401" class="i">+			+ ((state &amp; Mod4Mask   ) ? 8  : 0)
</a><a href="#h54-0-402" id="h54-0-402" class="i">+			+ ((state &amp; ControlMask) ? 16 : 0);
</a><a href="#h54-0-403" id="h54-0-403" class="i">+	}
</a><a href="#h54-0-404" id="h54-0-404" class="i">+
</a><a href="#h54-0-405" id="h54-0-405" class="i">+	if (IS_SET(MODE_MOUSESGR)) {
</a><a href="#h54-0-406" id="h54-0-406" class="i">+		len = snprintf(buf, sizeof(buf), &quot;\033[&lt;%d;%d;%d%c&quot;,
</a><a href="#h54-0-407" id="h54-0-407" class="i">+				button, x+1, y+1,
</a><a href="#h54-0-408" id="h54-0-408" class="i">+				e-&gt;xbutton.type == ButtonRelease ? &#39;m&#39; : &#39;M&#39;);
</a><a href="#h54-0-409" id="h54-0-409" class="i">+	} else if (x &lt; 223 &amp;&amp; y &lt; 223) {
</a><a href="#h54-0-410" id="h54-0-410" class="i">+		len = snprintf(buf, sizeof(buf), &quot;\033[M%c%c%c&quot;,
</a><a href="#h54-0-411" id="h54-0-411" class="i">+				32+button, 32+x+1, 32+y+1);
</a><a href="#h54-0-412" id="h54-0-412" class="i">+	} else {
</a><a href="#h54-0-413" id="h54-0-413" class="i">+		return;
</a><a href="#h54-0-414" id="h54-0-414" class="i">+	}
</a><a href="#h54-0-415" id="h54-0-415" class="i">+
</a><a href="#h54-0-416" id="h54-0-416" class="i">+	ttywrite(buf, len, 0);
</a><a href="#h54-0-417" id="h54-0-417" class="i">+}
</a><a href="#h54-0-418" id="h54-0-418" class="i">+
</a><a href="#h54-0-419" id="h54-0-419" class="i">+void
</a><a href="#h54-0-420" id="h54-0-420" class="i">+bpress(XEvent *e)
</a><a href="#h54-0-421" id="h54-0-421" class="i">+{
</a><a href="#h54-0-422" id="h54-0-422" class="i">+	struct timespec now;
</a><a href="#h54-0-423" id="h54-0-423" class="i">+	MouseShortcut *ms;
</a><a href="#h54-0-424" id="h54-0-424" class="i">+	int snap;
</a><a href="#h54-0-425" id="h54-0-425" class="i">+
</a><a href="#h54-0-426" id="h54-0-426" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h54-0-427" id="h54-0-427" class="i">+		mousereport(e);
</a><a href="#h54-0-428" id="h54-0-428" class="i">+		return;
</a><a href="#h54-0-429" id="h54-0-429" class="i">+	}
</a><a href="#h54-0-430" id="h54-0-430" class="i">+
</a><a href="#h54-0-431" id="h54-0-431" class="i">+	for (ms = mshortcuts; ms &lt; mshortcuts + LEN(mshortcuts); ms++) {
</a><a href="#h54-0-432" id="h54-0-432" class="i">+		if (e-&gt;xbutton.button == ms-&gt;b
</a><a href="#h54-0-433" id="h54-0-433" class="i">+				&amp;&amp; match(ms-&gt;mask, e-&gt;xbutton.state)) {
</a><a href="#h54-0-434" id="h54-0-434" class="i">+			ttywrite(ms-&gt;s, strlen(ms-&gt;s), 1);
</a><a href="#h54-0-435" id="h54-0-435" class="i">+			return;
</a><a href="#h54-0-436" id="h54-0-436" class="i">+		}
</a><a href="#h54-0-437" id="h54-0-437" class="i">+	}
</a><a href="#h54-0-438" id="h54-0-438" class="i">+
</a><a href="#h54-0-439" id="h54-0-439" class="i">+	if (e-&gt;xbutton.button == Button1) {
</a><a href="#h54-0-440" id="h54-0-440" class="i">+		/*
</a><a href="#h54-0-441" id="h54-0-441" class="i">+		 * If the user clicks below predefined timeouts specific
</a><a href="#h54-0-442" id="h54-0-442" class="i">+		 * snapping behaviour is exposed.
</a><a href="#h54-0-443" id="h54-0-443" class="i">+		 */
</a><a href="#h54-0-444" id="h54-0-444" class="i">+		clock_gettime(CLOCK_MONOTONIC, &amp;now);
</a><a href="#h54-0-445" id="h54-0-445" class="i">+		if (TIMEDIFF(now, xsel.tclick2) &lt;= tripleclicktimeout) {
</a><a href="#h54-0-446" id="h54-0-446" class="i">+			snap = SNAP_LINE;
</a><a href="#h54-0-447" id="h54-0-447" class="i">+		} else if (TIMEDIFF(now, xsel.tclick1) &lt;= doubleclicktimeout) {
</a><a href="#h54-0-448" id="h54-0-448" class="i">+			snap = SNAP_WORD;
</a><a href="#h54-0-449" id="h54-0-449" class="i">+		} else {
</a><a href="#h54-0-450" id="h54-0-450" class="i">+			snap = 0;
</a><a href="#h54-0-451" id="h54-0-451" class="i">+		}
</a><a href="#h54-0-452" id="h54-0-452" class="i">+		xsel.tclick2 = xsel.tclick1;
</a><a href="#h54-0-453" id="h54-0-453" class="i">+		xsel.tclick1 = now;
</a><a href="#h54-0-454" id="h54-0-454" class="i">+
</a><a href="#h54-0-455" id="h54-0-455" class="i">+		selstart(evcol(e), evrow(e), snap);
</a><a href="#h54-0-456" id="h54-0-456" class="i">+	}
</a><a href="#h54-0-457" id="h54-0-457" class="i">+}
</a><a href="#h54-0-458" id="h54-0-458" class="i">+
</a><a href="#h54-0-459" id="h54-0-459" class="i">+void
</a><a href="#h54-0-460" id="h54-0-460" class="i">+propnotify(XEvent *e)
</a><a href="#h54-0-461" id="h54-0-461" class="i">+{
</a><a href="#h54-0-462" id="h54-0-462" class="i">+	XPropertyEvent *xpev;
</a><a href="#h54-0-463" id="h54-0-463" class="i">+	Atom clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h54-0-464" id="h54-0-464" class="i">+
</a><a href="#h54-0-465" id="h54-0-465" class="i">+	xpev = &amp;e-&gt;xproperty;
</a><a href="#h54-0-466" id="h54-0-466" class="i">+	if (xpev-&gt;state == PropertyNewValue &amp;&amp;
</a><a href="#h54-0-467" id="h54-0-467" class="i">+			(xpev-&gt;atom == XA_PRIMARY ||
</a><a href="#h54-0-468" id="h54-0-468" class="i">+			 xpev-&gt;atom == clipboard)) {
</a><a href="#h54-0-469" id="h54-0-469" class="i">+		selnotify(e);
</a><a href="#h54-0-470" id="h54-0-470" class="i">+	}
</a><a href="#h54-0-471" id="h54-0-471" class="i">+}
</a><a href="#h54-0-472" id="h54-0-472" class="i">+
</a><a href="#h54-0-473" id="h54-0-473" class="i">+void
</a><a href="#h54-0-474" id="h54-0-474" class="i">+selnotify(XEvent *e)
</a><a href="#h54-0-475" id="h54-0-475" class="i">+{
</a><a href="#h54-0-476" id="h54-0-476" class="i">+	ulong nitems, ofs, rem;
</a><a href="#h54-0-477" id="h54-0-477" class="i">+	int format;
</a><a href="#h54-0-478" id="h54-0-478" class="i">+	uchar *data, *last, *repl;
</a><a href="#h54-0-479" id="h54-0-479" class="i">+	Atom type, incratom, property = None;
</a><a href="#h54-0-480" id="h54-0-480" class="i">+
</a><a href="#h54-0-481" id="h54-0-481" class="i">+	incratom = XInternAtom(xw.dpy, &quot;INCR&quot;, 0);
</a><a href="#h54-0-482" id="h54-0-482" class="i">+
</a><a href="#h54-0-483" id="h54-0-483" class="i">+	ofs = 0;
</a><a href="#h54-0-484" id="h54-0-484" class="i">+	if (e-&gt;type == SelectionNotify)
</a><a href="#h54-0-485" id="h54-0-485" class="i">+		property = e-&gt;xselection.property;
</a><a href="#h54-0-486" id="h54-0-486" class="i">+	else if (e-&gt;type == PropertyNotify)
</a><a href="#h54-0-487" id="h54-0-487" class="i">+		property = e-&gt;xproperty.atom;
</a><a href="#h54-0-488" id="h54-0-488" class="i">+
</a><a href="#h54-0-489" id="h54-0-489" class="i">+	if (property == None)
</a><a href="#h54-0-490" id="h54-0-490" class="i">+		return;
</a><a href="#h54-0-491" id="h54-0-491" class="i">+
</a><a href="#h54-0-492" id="h54-0-492" class="i">+	do {
</a><a href="#h54-0-493" id="h54-0-493" class="i">+		if (XGetWindowProperty(xw.dpy, xw.win, property, ofs,
</a><a href="#h54-0-494" id="h54-0-494" class="i">+					BUFSIZ/4, False, AnyPropertyType,
</a><a href="#h54-0-495" id="h54-0-495" class="i">+					&amp;type, &amp;format, &amp;nitems, &amp;rem,
</a><a href="#h54-0-496" id="h54-0-496" class="i">+					&amp;data)) {
</a><a href="#h54-0-497" id="h54-0-497" class="i">+			fprintf(stderr, &quot;Clipboard allocation failed\n&quot;);
</a><a href="#h54-0-498" id="h54-0-498" class="i">+			return;
</a><a href="#h54-0-499" id="h54-0-499" class="i">+		}
</a><a href="#h54-0-500" id="h54-0-500" class="i">+
</a><a href="#h54-0-501" id="h54-0-501" class="i">+		if (e-&gt;type == PropertyNotify &amp;&amp; nitems == 0 &amp;&amp; rem == 0) {
</a><a href="#h54-0-502" id="h54-0-502" class="i">+			/*
</a><a href="#h54-0-503" id="h54-0-503" class="i">+			 * If there is some PropertyNotify with no data, then
</a><a href="#h54-0-504" id="h54-0-504" class="i">+			 * this is the signal of the selection owner that all
</a><a href="#h54-0-505" id="h54-0-505" class="i">+			 * data has been transferred. We won&#39;t need to receive
</a><a href="#h54-0-506" id="h54-0-506" class="i">+			 * PropertyNotify events anymore.
</a><a href="#h54-0-507" id="h54-0-507" class="i">+			 */
</a><a href="#h54-0-508" id="h54-0-508" class="i">+			MODBIT(xw.attrs.event_mask, 0, PropertyChangeMask);
</a><a href="#h54-0-509" id="h54-0-509" class="i">+			XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask,
</a><a href="#h54-0-510" id="h54-0-510" class="i">+					&amp;xw.attrs);
</a><a href="#h54-0-511" id="h54-0-511" class="i">+		}
</a><a href="#h54-0-512" id="h54-0-512" class="i">+
</a><a href="#h54-0-513" id="h54-0-513" class="i">+		if (type == incratom) {
</a><a href="#h54-0-514" id="h54-0-514" class="i">+			/*
</a><a href="#h54-0-515" id="h54-0-515" class="i">+			 * Activate the PropertyNotify events so we receive
</a><a href="#h54-0-516" id="h54-0-516" class="i">+			 * when the selection owner does send us the next
</a><a href="#h54-0-517" id="h54-0-517" class="i">+			 * chunk of data.
</a><a href="#h54-0-518" id="h54-0-518" class="i">+			 */
</a><a href="#h54-0-519" id="h54-0-519" class="i">+			MODBIT(xw.attrs.event_mask, 1, PropertyChangeMask);
</a><a href="#h54-0-520" id="h54-0-520" class="i">+			XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask,
</a><a href="#h54-0-521" id="h54-0-521" class="i">+					&amp;xw.attrs);
</a><a href="#h54-0-522" id="h54-0-522" class="i">+
</a><a href="#h54-0-523" id="h54-0-523" class="i">+			/*
</a><a href="#h54-0-524" id="h54-0-524" class="i">+			 * Deleting the property is the transfer start signal.
</a><a href="#h54-0-525" id="h54-0-525" class="i">+			 */
</a><a href="#h54-0-526" id="h54-0-526" class="i">+			XDeleteProperty(xw.dpy, xw.win, (int)property);
</a><a href="#h54-0-527" id="h54-0-527" class="i">+			continue;
</a><a href="#h54-0-528" id="h54-0-528" class="i">+		}
</a><a href="#h54-0-529" id="h54-0-529" class="i">+
</a><a href="#h54-0-530" id="h54-0-530" class="i">+		/*
</a><a href="#h54-0-531" id="h54-0-531" class="i">+		 * As seen in getsel:
</a><a href="#h54-0-532" id="h54-0-532" class="i">+		 * Line endings are inconsistent in the terminal and GUI world
</a><a href="#h54-0-533" id="h54-0-533" class="i">+		 * copy and pasting. When receiving some selection data,
</a><a href="#h54-0-534" id="h54-0-534" class="i">+		 * replace all &#39;\n&#39; with &#39;\r&#39;.
</a><a href="#h54-0-535" id="h54-0-535" class="i">+		 * FIXME: Fix the computer world.
</a><a href="#h54-0-536" id="h54-0-536" class="i">+		 */
</a><a href="#h54-0-537" id="h54-0-537" class="i">+		repl = data;
</a><a href="#h54-0-538" id="h54-0-538" class="i">+		last = data + nitems * format / 8;
</a><a href="#h54-0-539" id="h54-0-539" class="i">+		while ((repl = memchr(repl, &#39;\n&#39;, last - repl))) {
</a><a href="#h54-0-540" id="h54-0-540" class="i">+			*repl++ = &#39;\r&#39;;
</a><a href="#h54-0-541" id="h54-0-541" class="i">+		}
</a><a href="#h54-0-542" id="h54-0-542" class="i">+
</a><a href="#h54-0-543" id="h54-0-543" class="i">+		if (IS_SET(MODE_BRCKTPASTE) &amp;&amp; ofs == 0)
</a><a href="#h54-0-544" id="h54-0-544" class="i">+			ttywrite(&quot;\033[200~&quot;, 6, 0);
</a><a href="#h54-0-545" id="h54-0-545" class="i">+		ttywrite((char *)data, nitems * format / 8, 1);
</a><a href="#h54-0-546" id="h54-0-546" class="i">+		if (IS_SET(MODE_BRCKTPASTE) &amp;&amp; rem == 0)
</a><a href="#h54-0-547" id="h54-0-547" class="i">+			ttywrite(&quot;\033[201~&quot;, 6, 0);
</a><a href="#h54-0-548" id="h54-0-548" class="i">+		XFree(data);
</a><a href="#h54-0-549" id="h54-0-549" class="i">+		/* number of 32-bit chunks returned */
</a><a href="#h54-0-550" id="h54-0-550" class="i">+		ofs += nitems * format / 32;
</a><a href="#h54-0-551" id="h54-0-551" class="i">+	} while (rem &gt; 0);
</a><a href="#h54-0-552" id="h54-0-552" class="i">+
</a><a href="#h54-0-553" id="h54-0-553" class="i">+	/*
</a><a href="#h54-0-554" id="h54-0-554" class="i">+	 * Deleting the property again tells the selection owner to send the
</a><a href="#h54-0-555" id="h54-0-555" class="i">+	 * next data chunk in the property.
</a><a href="#h54-0-556" id="h54-0-556" class="i">+	 */
</a><a href="#h54-0-557" id="h54-0-557" class="i">+	XDeleteProperty(xw.dpy, xw.win, (int)property);
</a><a href="#h54-0-558" id="h54-0-558" class="i">+}
</a><a href="#h54-0-559" id="h54-0-559" class="i">+
</a><a href="#h54-0-560" id="h54-0-560" class="i">+void
</a><a href="#h54-0-561" id="h54-0-561" class="i">+xclipcopy(void)
</a><a href="#h54-0-562" id="h54-0-562" class="i">+{
</a><a href="#h54-0-563" id="h54-0-563" class="i">+	clipcopy(NULL);
</a><a href="#h54-0-564" id="h54-0-564" class="i">+}
</a><a href="#h54-0-565" id="h54-0-565" class="i">+
</a><a href="#h54-0-566" id="h54-0-566" class="i">+void
</a><a href="#h54-0-567" id="h54-0-567" class="i">+selclear_(XEvent *e)
</a><a href="#h54-0-568" id="h54-0-568" class="i">+{
</a><a href="#h54-0-569" id="h54-0-569" class="i">+	selclear();
</a><a href="#h54-0-570" id="h54-0-570" class="i">+}
</a><a href="#h54-0-571" id="h54-0-571" class="i">+
</a><a href="#h54-0-572" id="h54-0-572" class="i">+void
</a><a href="#h54-0-573" id="h54-0-573" class="i">+selrequest(XEvent *e)
</a><a href="#h54-0-574" id="h54-0-574" class="i">+{
</a><a href="#h54-0-575" id="h54-0-575" class="i">+	XSelectionRequestEvent *xsre;
</a><a href="#h54-0-576" id="h54-0-576" class="i">+	XSelectionEvent xev;
</a><a href="#h54-0-577" id="h54-0-577" class="i">+	Atom xa_targets, string, clipboard;
</a><a href="#h54-0-578" id="h54-0-578" class="i">+	char *seltext;
</a><a href="#h54-0-579" id="h54-0-579" class="i">+
</a><a href="#h54-0-580" id="h54-0-580" class="i">+	xsre = (XSelectionRequestEvent *) e;
</a><a href="#h54-0-581" id="h54-0-581" class="i">+	xev.type = SelectionNotify;
</a><a href="#h54-0-582" id="h54-0-582" class="i">+	xev.requestor = xsre-&gt;requestor;
</a><a href="#h54-0-583" id="h54-0-583" class="i">+	xev.selection = xsre-&gt;selection;
</a><a href="#h54-0-584" id="h54-0-584" class="i">+	xev.target = xsre-&gt;target;
</a><a href="#h54-0-585" id="h54-0-585" class="i">+	xev.time = xsre-&gt;time;
</a><a href="#h54-0-586" id="h54-0-586" class="i">+	if (xsre-&gt;property == None)
</a><a href="#h54-0-587" id="h54-0-587" class="i">+		xsre-&gt;property = xsre-&gt;target;
</a><a href="#h54-0-588" id="h54-0-588" class="i">+
</a><a href="#h54-0-589" id="h54-0-589" class="i">+	/* reject */
</a><a href="#h54-0-590" id="h54-0-590" class="i">+	xev.property = None;
</a><a href="#h54-0-591" id="h54-0-591" class="i">+
</a><a href="#h54-0-592" id="h54-0-592" class="i">+	xa_targets = XInternAtom(xw.dpy, &quot;TARGETS&quot;, 0);
</a><a href="#h54-0-593" id="h54-0-593" class="i">+	if (xsre-&gt;target == xa_targets) {
</a><a href="#h54-0-594" id="h54-0-594" class="i">+		/* respond with the supported type */
</a><a href="#h54-0-595" id="h54-0-595" class="i">+		string = xsel.xtarget;
</a><a href="#h54-0-596" id="h54-0-596" class="i">+		XChangeProperty(xsre-&gt;display, xsre-&gt;requestor, xsre-&gt;property,
</a><a href="#h54-0-597" id="h54-0-597" class="i">+				XA_ATOM, 32, PropModeReplace,
</a><a href="#h54-0-598" id="h54-0-598" class="i">+				(uchar *) &amp;string, 1);
</a><a href="#h54-0-599" id="h54-0-599" class="i">+		xev.property = xsre-&gt;property;
</a><a href="#h54-0-600" id="h54-0-600" class="i">+	} else if (xsre-&gt;target == xsel.xtarget || xsre-&gt;target == XA_STRING) {
</a><a href="#h54-0-601" id="h54-0-601" class="i">+		/*
</a><a href="#h54-0-602" id="h54-0-602" class="i">+		 * xith XA_STRING non ascii characters may be incorrect in the
</a><a href="#h54-0-603" id="h54-0-603" class="i">+		 * requestor. It is not our problem, use utf8.
</a><a href="#h54-0-604" id="h54-0-604" class="i">+		 */
</a><a href="#h54-0-605" id="h54-0-605" class="i">+		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h54-0-606" id="h54-0-606" class="i">+		if (xsre-&gt;selection == XA_PRIMARY) {
</a><a href="#h54-0-607" id="h54-0-607" class="i">+			seltext = xsel.primary;
</a><a href="#h54-0-608" id="h54-0-608" class="i">+		} else if (xsre-&gt;selection == clipboard) {
</a><a href="#h54-0-609" id="h54-0-609" class="i">+			seltext = xsel.clipboard;
</a><a href="#h54-0-610" id="h54-0-610" class="i">+		} else {
</a><a href="#h54-0-611" id="h54-0-611" class="i">+			fprintf(stderr,
</a><a href="#h54-0-612" id="h54-0-612" class="i">+				&quot;Unhandled clipboard selection 0x%lx\n&quot;,
</a><a href="#h54-0-613" id="h54-0-613" class="i">+				xsre-&gt;selection);
</a><a href="#h54-0-614" id="h54-0-614" class="i">+			return;
</a><a href="#h54-0-615" id="h54-0-615" class="i">+		}
</a><a href="#h54-0-616" id="h54-0-616" class="i">+		if (seltext != NULL) {
</a><a href="#h54-0-617" id="h54-0-617" class="i">+			XChangeProperty(xsre-&gt;display, xsre-&gt;requestor,
</a><a href="#h54-0-618" id="h54-0-618" class="i">+					xsre-&gt;property, xsre-&gt;target,
</a><a href="#h54-0-619" id="h54-0-619" class="i">+					8, PropModeReplace,
</a><a href="#h54-0-620" id="h54-0-620" class="i">+					(uchar *)seltext, strlen(seltext));
</a><a href="#h54-0-621" id="h54-0-621" class="i">+			xev.property = xsre-&gt;property;
</a><a href="#h54-0-622" id="h54-0-622" class="i">+		}
</a><a href="#h54-0-623" id="h54-0-623" class="i">+	}
</a><a href="#h54-0-624" id="h54-0-624" class="i">+
</a><a href="#h54-0-625" id="h54-0-625" class="i">+	/* all done, send a notification to the listener */
</a><a href="#h54-0-626" id="h54-0-626" class="i">+	if (!XSendEvent(xsre-&gt;display, xsre-&gt;requestor, 1, 0, (XEvent *) &amp;xev))
</a><a href="#h54-0-627" id="h54-0-627" class="i">+		fprintf(stderr, &quot;Error sending SelectionNotify event\n&quot;);
</a><a href="#h54-0-628" id="h54-0-628" class="i">+}
</a><a href="#h54-0-629" id="h54-0-629" class="i">+
</a><a href="#h54-0-630" id="h54-0-630" class="i">+void
</a><a href="#h54-0-631" id="h54-0-631" class="i">+setsel(char *str, Time t)
</a><a href="#h54-0-632" id="h54-0-632" class="i">+{
</a><a href="#h54-0-633" id="h54-0-633" class="i">+	if (!str)
</a><a href="#h54-0-634" id="h54-0-634" class="i">+		return;
</a><a href="#h54-0-635" id="h54-0-635" class="i">+
</a><a href="#h54-0-636" id="h54-0-636" class="i">+	free(xsel.primary);
</a><a href="#h54-0-637" id="h54-0-637" class="i">+	xsel.primary = str;
</a><a href="#h54-0-638" id="h54-0-638" class="i">+
</a><a href="#h54-0-639" id="h54-0-639" class="i">+	XSetSelectionOwner(xw.dpy, XA_PRIMARY, xw.win, t);
</a><a href="#h54-0-640" id="h54-0-640" class="i">+	if (XGetSelectionOwner(xw.dpy, XA_PRIMARY) != xw.win)
</a><a href="#h54-0-641" id="h54-0-641" class="i">+		selclear();
</a><a href="#h54-0-642" id="h54-0-642" class="i">+
</a><a href="#h54-0-643" id="h54-0-643" class="i">+	xclipcopy();
</a><a href="#h54-0-644" id="h54-0-644" class="i">+}
</a><a href="#h54-0-645" id="h54-0-645" class="i">+
</a><a href="#h54-0-646" id="h54-0-646" class="i">+void
</a><a href="#h54-0-647" id="h54-0-647" class="i">+xsetsel(char *str)
</a><a href="#h54-0-648" id="h54-0-648" class="i">+{
</a><a href="#h54-0-649" id="h54-0-649" class="i">+	setsel(str, CurrentTime);
</a><a href="#h54-0-650" id="h54-0-650" class="i">+}
</a><a href="#h54-0-651" id="h54-0-651" class="i">+
</a><a href="#h54-0-652" id="h54-0-652" class="i">+void
</a><a href="#h54-0-653" id="h54-0-653" class="i">+brelease(XEvent *e)
</a><a href="#h54-0-654" id="h54-0-654" class="i">+{
</a><a href="#h54-0-655" id="h54-0-655" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h54-0-656" id="h54-0-656" class="i">+		mousereport(e);
</a><a href="#h54-0-657" id="h54-0-657" class="i">+		return;
</a><a href="#h54-0-658" id="h54-0-658" class="i">+	}
</a><a href="#h54-0-659" id="h54-0-659" class="i">+
</a><a href="#h54-0-660" id="h54-0-660" class="i">+	if (e-&gt;xbutton.button == Button2)
</a><a href="#h54-0-661" id="h54-0-661" class="i">+		selpaste(NULL);
</a><a href="#h54-0-662" id="h54-0-662" class="i">+	else if (e-&gt;xbutton.button == Button1)
</a><a href="#h54-0-663" id="h54-0-663" class="i">+		mousesel(e, 1);
</a><a href="#h54-0-664" id="h54-0-664" class="i">+}
</a><a href="#h54-0-665" id="h54-0-665" class="i">+
</a><a href="#h54-0-666" id="h54-0-666" class="i">+void
</a><a href="#h54-0-667" id="h54-0-667" class="i">+bmotion(XEvent *e)
</a><a href="#h54-0-668" id="h54-0-668" class="i">+{
</a><a href="#h54-0-669" id="h54-0-669" class="i">+	if (!xw.pointerisvisible) {
</a><a href="#h54-0-670" id="h54-0-670" class="i">+		XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h54-0-671" id="h54-0-671" class="i">+		xw.pointerisvisible = 1;
</a><a href="#h54-0-672" id="h54-0-672" class="i">+		if (!IS_SET(MODE_MOUSEMANY))
</a><a href="#h54-0-673" id="h54-0-673" class="i">+			xsetpointermotion(0);
</a><a href="#h54-0-674" id="h54-0-674" class="i">+	}
</a><a href="#h54-0-675" id="h54-0-675" class="i">+
</a><a href="#h54-0-676" id="h54-0-676" class="i">+	if (IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h54-0-677" id="h54-0-677" class="i">+		mousereport(e);
</a><a href="#h54-0-678" id="h54-0-678" class="i">+		return;
</a><a href="#h54-0-679" id="h54-0-679" class="i">+	}
</a><a href="#h54-0-680" id="h54-0-680" class="i">+
</a><a href="#h54-0-681" id="h54-0-681" class="i">+	mousesel(e, 0);
</a><a href="#h54-0-682" id="h54-0-682" class="i">+}
</a><a href="#h54-0-683" id="h54-0-683" class="i">+
</a><a href="#h54-0-684" id="h54-0-684" class="i">+void
</a><a href="#h54-0-685" id="h54-0-685" class="i">+cresize(int width, int height)
</a><a href="#h54-0-686" id="h54-0-686" class="i">+{
</a><a href="#h54-0-687" id="h54-0-687" class="i">+	int col, row;
</a><a href="#h54-0-688" id="h54-0-688" class="i">+
</a><a href="#h54-0-689" id="h54-0-689" class="i">+	if (width != 0)
</a><a href="#h54-0-690" id="h54-0-690" class="i">+		win.w = width;
</a><a href="#h54-0-691" id="h54-0-691" class="i">+	if (height != 0)
</a><a href="#h54-0-692" id="h54-0-692" class="i">+		win.h = height;
</a><a href="#h54-0-693" id="h54-0-693" class="i">+
</a><a href="#h54-0-694" id="h54-0-694" class="i">+	col = (win.w - 2 * borderpx) / win.cw;
</a><a href="#h54-0-695" id="h54-0-695" class="i">+	row = (win.h - 2 * borderpx) / win.ch;
</a><a href="#h54-0-696" id="h54-0-696" class="i">+	col = MAX(1, col);
</a><a href="#h54-0-697" id="h54-0-697" class="i">+	row = MAX(1, row);
</a><a href="#h54-0-698" id="h54-0-698" class="i">+
</a><a href="#h54-0-699" id="h54-0-699" class="i">+	tresize(col, row);
</a><a href="#h54-0-700" id="h54-0-700" class="i">+	xresize(col, row);
</a><a href="#h54-0-701" id="h54-0-701" class="i">+	ttyresize(win.tw, win.th);
</a><a href="#h54-0-702" id="h54-0-702" class="i">+}
</a><a href="#h54-0-703" id="h54-0-703" class="i">+
</a><a href="#h54-0-704" id="h54-0-704" class="i">+void
</a><a href="#h54-0-705" id="h54-0-705" class="i">+xresize(int col, int row)
</a><a href="#h54-0-706" id="h54-0-706" class="i">+{
</a><a href="#h54-0-707" id="h54-0-707" class="i">+	win.tw = col * win.cw;
</a><a href="#h54-0-708" id="h54-0-708" class="i">+	win.th = row * win.ch;
</a><a href="#h54-0-709" id="h54-0-709" class="i">+
</a><a href="#h54-0-710" id="h54-0-710" class="i">+	XFreePixmap(xw.dpy, xw.buf);
</a><a href="#h54-0-711" id="h54-0-711" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h,
</a><a href="#h54-0-712" id="h54-0-712" class="i">+			xw.depth);
</a><a href="#h54-0-713" id="h54-0-713" class="i">+	XftDrawChange(xw.draw, xw.buf);
</a><a href="#h54-0-714" id="h54-0-714" class="i">+	xclear(0, 0, win.w, win.h);
</a><a href="#h54-0-715" id="h54-0-715" class="i">+
</a><a href="#h54-0-716" id="h54-0-716" class="i">+	/* resize to new width */
</a><a href="#h54-0-717" id="h54-0-717" class="i">+	xw.specbuf = xrealloc(xw.specbuf, col * sizeof(GlyphFontSpec));
</a><a href="#h54-0-718" id="h54-0-718" class="i">+}
</a><a href="#h54-0-719" id="h54-0-719" class="i">+
</a><a href="#h54-0-720" id="h54-0-720" class="i">+ushort
</a><a href="#h54-0-721" id="h54-0-721" class="i">+sixd_to_16bit(int x)
</a><a href="#h54-0-722" id="h54-0-722" class="i">+{
</a><a href="#h54-0-723" id="h54-0-723" class="i">+	return x == 0 ? 0 : 0x3737 + 0x2828 * x;
</a><a href="#h54-0-724" id="h54-0-724" class="i">+}
</a><a href="#h54-0-725" id="h54-0-725" class="i">+
</a><a href="#h54-0-726" id="h54-0-726" class="i">+int
</a><a href="#h54-0-727" id="h54-0-727" class="i">+xloadcolor(int i, const char *name, Color *ncolor)
</a><a href="#h54-0-728" id="h54-0-728" class="i">+{
</a><a href="#h54-0-729" id="h54-0-729" class="i">+	XRenderColor color = { .alpha = 0xffff };
</a><a href="#h54-0-730" id="h54-0-730" class="i">+
</a><a href="#h54-0-731" id="h54-0-731" class="i">+	if (!name) {
</a><a href="#h54-0-732" id="h54-0-732" class="i">+		if (BETWEEN(i, 16, 255)) { /* 256 color */
</a><a href="#h54-0-733" id="h54-0-733" class="i">+			if (i &lt; 6*6*6+16) { /* same colors as xterm */
</a><a href="#h54-0-734" id="h54-0-734" class="i">+				color.red   = sixd_to_16bit( ((i-16)/36)%6 );
</a><a href="#h54-0-735" id="h54-0-735" class="i">+				color.green = sixd_to_16bit( ((i-16)/6) %6 );
</a><a href="#h54-0-736" id="h54-0-736" class="i">+				color.blue  = sixd_to_16bit( ((i-16)/1) %6 );
</a><a href="#h54-0-737" id="h54-0-737" class="i">+			} else { /* greyscale */
</a><a href="#h54-0-738" id="h54-0-738" class="i">+				color.red = 0x0808 + 0x0a0a * (i - (6*6*6+16));
</a><a href="#h54-0-739" id="h54-0-739" class="i">+				color.green = color.blue = color.red;
</a><a href="#h54-0-740" id="h54-0-740" class="i">+			}
</a><a href="#h54-0-741" id="h54-0-741" class="i">+			return XftColorAllocValue(xw.dpy, xw.vis,
</a><a href="#h54-0-742" id="h54-0-742" class="i">+			                          xw.cmap, &amp;color, ncolor);
</a><a href="#h54-0-743" id="h54-0-743" class="i">+		} else
</a><a href="#h54-0-744" id="h54-0-744" class="i">+			name = colorname[i];
</a><a href="#h54-0-745" id="h54-0-745" class="i">+	}
</a><a href="#h54-0-746" id="h54-0-746" class="i">+
</a><a href="#h54-0-747" id="h54-0-747" class="i">+	return XftColorAllocName(xw.dpy, xw.vis, xw.cmap, name, ncolor);
</a><a href="#h54-0-748" id="h54-0-748" class="i">+}
</a><a href="#h54-0-749" id="h54-0-749" class="i">+
</a><a href="#h54-0-750" id="h54-0-750" class="i">+void
</a><a href="#h54-0-751" id="h54-0-751" class="i">+xloadcols(void)
</a><a href="#h54-0-752" id="h54-0-752" class="i">+{
</a><a href="#h54-0-753" id="h54-0-753" class="i">+	int i;
</a><a href="#h54-0-754" id="h54-0-754" class="i">+	static int loaded;
</a><a href="#h54-0-755" id="h54-0-755" class="i">+	Color *cp;
</a><a href="#h54-0-756" id="h54-0-756" class="i">+
</a><a href="#h54-0-757" id="h54-0-757" class="i">+	if (loaded) {
</a><a href="#h54-0-758" id="h54-0-758" class="i">+		for (cp = dc.col; cp &lt; &amp;dc.col[dc.collen]; ++cp)
</a><a href="#h54-0-759" id="h54-0-759" class="i">+			XftColorFree(xw.dpy, xw.vis, xw.cmap, cp);
</a><a href="#h54-0-760" id="h54-0-760" class="i">+	} else {
</a><a href="#h54-0-761" id="h54-0-761" class="i">+		dc.collen = MAX(LEN(colorname), 256);
</a><a href="#h54-0-762" id="h54-0-762" class="i">+		dc.col = xmalloc(dc.collen * sizeof(Color));
</a><a href="#h54-0-763" id="h54-0-763" class="i">+	}
</a><a href="#h54-0-764" id="h54-0-764" class="i">+
</a><a href="#h54-0-765" id="h54-0-765" class="i">+	for (i = 0; i &lt; dc.collen; i++)
</a><a href="#h54-0-766" id="h54-0-766" class="i">+		if (!xloadcolor(i, NULL, &amp;dc.col[i])) {
</a><a href="#h54-0-767" id="h54-0-767" class="i">+			if (colorname[i])
</a><a href="#h54-0-768" id="h54-0-768" class="i">+				die(&quot;could not allocate color &#39;%s&#39;\n&quot;, colorname[i]);
</a><a href="#h54-0-769" id="h54-0-769" class="i">+			else
</a><a href="#h54-0-770" id="h54-0-770" class="i">+				die(&quot;could not allocate color %d\n&quot;, i);
</a><a href="#h54-0-771" id="h54-0-771" class="i">+		}
</a><a href="#h54-0-772" id="h54-0-772" class="i">+
</a><a href="#h54-0-773" id="h54-0-773" class="i">+	/* set alpha value of bg color */
</a><a href="#h54-0-774" id="h54-0-774" class="i">+	if (USE_ARGB) {
</a><a href="#h54-0-775" id="h54-0-775" class="i">+		dc.col[defaultbg].color.alpha = alpha &lt;&lt; 8;
</a><a href="#h54-0-776" id="h54-0-776" class="i">+		dc.col[defaultbg].color.red   = ((dc.col[defaultbg].color.red &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h54-0-777" id="h54-0-777" class="i">+		dc.col[defaultbg].color.green = ((dc.col[defaultbg].color.green &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h54-0-778" id="h54-0-778" class="i">+		dc.col[defaultbg].color.blue  = ((dc.col[defaultbg].color.blue &gt;&gt; 8) * alpha / 255) &lt;&lt; 8;
</a><a href="#h54-0-779" id="h54-0-779" class="i">+	}
</a><a href="#h54-0-780" id="h54-0-780" class="i">+	loaded = 1;
</a><a href="#h54-0-781" id="h54-0-781" class="i">+}
</a><a href="#h54-0-782" id="h54-0-782" class="i">+
</a><a href="#h54-0-783" id="h54-0-783" class="i">+int
</a><a href="#h54-0-784" id="h54-0-784" class="i">+xsetcolorname(int x, const char *name)
</a><a href="#h54-0-785" id="h54-0-785" class="i">+{
</a><a href="#h54-0-786" id="h54-0-786" class="i">+	Color ncolor;
</a><a href="#h54-0-787" id="h54-0-787" class="i">+
</a><a href="#h54-0-788" id="h54-0-788" class="i">+	if (!BETWEEN(x, 0, dc.collen))
</a><a href="#h54-0-789" id="h54-0-789" class="i">+		return 1;
</a><a href="#h54-0-790" id="h54-0-790" class="i">+
</a><a href="#h54-0-791" id="h54-0-791" class="i">+
</a><a href="#h54-0-792" id="h54-0-792" class="i">+	if (!xloadcolor(x, name, &amp;ncolor))
</a><a href="#h54-0-793" id="h54-0-793" class="i">+		return 1;
</a><a href="#h54-0-794" id="h54-0-794" class="i">+
</a><a href="#h54-0-795" id="h54-0-795" class="i">+	XftColorFree(xw.dpy, xw.vis, xw.cmap, &amp;dc.col[x]);
</a><a href="#h54-0-796" id="h54-0-796" class="i">+	dc.col[x] = ncolor;
</a><a href="#h54-0-797" id="h54-0-797" class="i">+
</a><a href="#h54-0-798" id="h54-0-798" class="i">+	return 0;
</a><a href="#h54-0-799" id="h54-0-799" class="i">+}
</a><a href="#h54-0-800" id="h54-0-800" class="i">+
</a><a href="#h54-0-801" id="h54-0-801" class="i">+void
</a><a href="#h54-0-802" id="h54-0-802" class="i">+xtermclear(int col1, int row1, int col2, int row2)
</a><a href="#h54-0-803" id="h54-0-803" class="i">+{
</a><a href="#h54-0-804" id="h54-0-804" class="i">+	XftDrawRect(xw.draw,
</a><a href="#h54-0-805" id="h54-0-805" class="i">+			&amp;dc.col[IS_SET(MODE_REVERSE) ? defaultfg : defaultbg],
</a><a href="#h54-0-806" id="h54-0-806" class="i">+			borderpx + col1 * win.cw,
</a><a href="#h54-0-807" id="h54-0-807" class="i">+			borderpx + row1 * win.ch,
</a><a href="#h54-0-808" id="h54-0-808" class="i">+			(col2-col1+1) * win.cw,
</a><a href="#h54-0-809" id="h54-0-809" class="i">+			(row2-row1+1) * win.ch);
</a><a href="#h54-0-810" id="h54-0-810" class="i">+}
</a><a href="#h54-0-811" id="h54-0-811" class="i">+
</a><a href="#h54-0-812" id="h54-0-812" class="i">+/*
</a><a href="#h54-0-813" id="h54-0-813" class="i">+ * Absolute coordinates.
</a><a href="#h54-0-814" id="h54-0-814" class="i">+ */
</a><a href="#h54-0-815" id="h54-0-815" class="i">+void
</a><a href="#h54-0-816" id="h54-0-816" class="i">+xclear(int x1, int y1, int x2, int y2)
</a><a href="#h54-0-817" id="h54-0-817" class="i">+{
</a><a href="#h54-0-818" id="h54-0-818" class="i">+	XftDrawRect(xw.draw,
</a><a href="#h54-0-819" id="h54-0-819" class="i">+			&amp;dc.col[IS_SET(MODE_REVERSE)? defaultfg : defaultbg],
</a><a href="#h54-0-820" id="h54-0-820" class="i">+			x1, y1, x2-x1, y2-y1);
</a><a href="#h54-0-821" id="h54-0-821" class="i">+}
</a><a href="#h54-0-822" id="h54-0-822" class="i">+
</a><a href="#h54-0-823" id="h54-0-823" class="i">+void
</a><a href="#h54-0-824" id="h54-0-824" class="i">+xhints(void)
</a><a href="#h54-0-825" id="h54-0-825" class="i">+{
</a><a href="#h54-0-826" id="h54-0-826" class="i">+	XClassHint class = {opt_name ? opt_name : termname,
</a><a href="#h54-0-827" id="h54-0-827" class="i">+	                    opt_class ? opt_class : termname};
</a><a href="#h54-0-828" id="h54-0-828" class="i">+	XWMHints wm = {.flags = InputHint, .input = 1};
</a><a href="#h54-0-829" id="h54-0-829" class="i">+	XSizeHints *sizeh;
</a><a href="#h54-0-830" id="h54-0-830" class="i">+
</a><a href="#h54-0-831" id="h54-0-831" class="i">+	sizeh = XAllocSizeHints();
</a><a href="#h54-0-832" id="h54-0-832" class="i">+
</a><a href="#h54-0-833" id="h54-0-833" class="i">+	sizeh-&gt;flags = PSize | PResizeInc | PBaseSize | PMinSize;
</a><a href="#h54-0-834" id="h54-0-834" class="i">+	sizeh-&gt;height = win.h;
</a><a href="#h54-0-835" id="h54-0-835" class="i">+	sizeh-&gt;width = win.w;
</a><a href="#h54-0-836" id="h54-0-836" class="i">+	sizeh-&gt;height_inc = win.ch;
</a><a href="#h54-0-837" id="h54-0-837" class="i">+	sizeh-&gt;width_inc = win.cw;
</a><a href="#h54-0-838" id="h54-0-838" class="i">+	sizeh-&gt;base_height = 2 * borderpx;
</a><a href="#h54-0-839" id="h54-0-839" class="i">+	sizeh-&gt;base_width = 2 * borderpx;
</a><a href="#h54-0-840" id="h54-0-840" class="i">+	sizeh-&gt;min_height = win.ch + 2 * borderpx;
</a><a href="#h54-0-841" id="h54-0-841" class="i">+	sizeh-&gt;min_width = win.cw + 2 * borderpx;
</a><a href="#h54-0-842" id="h54-0-842" class="i">+	if (xw.isfixed) {
</a><a href="#h54-0-843" id="h54-0-843" class="i">+		sizeh-&gt;flags |= PMaxSize;
</a><a href="#h54-0-844" id="h54-0-844" class="i">+		sizeh-&gt;min_width = sizeh-&gt;max_width = win.w;
</a><a href="#h54-0-845" id="h54-0-845" class="i">+		sizeh-&gt;min_height = sizeh-&gt;max_height = win.h;
</a><a href="#h54-0-846" id="h54-0-846" class="i">+	}
</a><a href="#h54-0-847" id="h54-0-847" class="i">+	if (xw.gm &amp; (XValue|YValue)) {
</a><a href="#h54-0-848" id="h54-0-848" class="i">+		sizeh-&gt;flags |= USPosition | PWinGravity;
</a><a href="#h54-0-849" id="h54-0-849" class="i">+		sizeh-&gt;x = xw.l;
</a><a href="#h54-0-850" id="h54-0-850" class="i">+		sizeh-&gt;y = xw.t;
</a><a href="#h54-0-851" id="h54-0-851" class="i">+		sizeh-&gt;win_gravity = xgeommasktogravity(xw.gm);
</a><a href="#h54-0-852" id="h54-0-852" class="i">+	}
</a><a href="#h54-0-853" id="h54-0-853" class="i">+
</a><a href="#h54-0-854" id="h54-0-854" class="i">+	XSetWMProperties(xw.dpy, xw.win, NULL, NULL, NULL, 0, sizeh, &amp;wm,
</a><a href="#h54-0-855" id="h54-0-855" class="i">+			&amp;class);
</a><a href="#h54-0-856" id="h54-0-856" class="i">+	XFree(sizeh);
</a><a href="#h54-0-857" id="h54-0-857" class="i">+}
</a><a href="#h54-0-858" id="h54-0-858" class="i">+
</a><a href="#h54-0-859" id="h54-0-859" class="i">+int
</a><a href="#h54-0-860" id="h54-0-860" class="i">+xgeommasktogravity(int mask)
</a><a href="#h54-0-861" id="h54-0-861" class="i">+{
</a><a href="#h54-0-862" id="h54-0-862" class="i">+	switch (mask &amp; (XNegative|YNegative)) {
</a><a href="#h54-0-863" id="h54-0-863" class="i">+	case 0:
</a><a href="#h54-0-864" id="h54-0-864" class="i">+		return NorthWestGravity;
</a><a href="#h54-0-865" id="h54-0-865" class="i">+	case XNegative:
</a><a href="#h54-0-866" id="h54-0-866" class="i">+		return NorthEastGravity;
</a><a href="#h54-0-867" id="h54-0-867" class="i">+	case YNegative:
</a><a href="#h54-0-868" id="h54-0-868" class="i">+		return SouthWestGravity;
</a><a href="#h54-0-869" id="h54-0-869" class="i">+	}
</a><a href="#h54-0-870" id="h54-0-870" class="i">+
</a><a href="#h54-0-871" id="h54-0-871" class="i">+	return SouthEastGravity;
</a><a href="#h54-0-872" id="h54-0-872" class="i">+}
</a><a href="#h54-0-873" id="h54-0-873" class="i">+
</a><a href="#h54-0-874" id="h54-0-874" class="i">+int
</a><a href="#h54-0-875" id="h54-0-875" class="i">+xloadfont(Font *f, FcPattern *pattern)
</a><a href="#h54-0-876" id="h54-0-876" class="i">+{
</a><a href="#h54-0-877" id="h54-0-877" class="i">+	FcPattern *configured;
</a><a href="#h54-0-878" id="h54-0-878" class="i">+	FcPattern *match;
</a><a href="#h54-0-879" id="h54-0-879" class="i">+	FcResult result;
</a><a href="#h54-0-880" id="h54-0-880" class="i">+	XGlyphInfo extents;
</a><a href="#h54-0-881" id="h54-0-881" class="i">+	int wantattr, haveattr;
</a><a href="#h54-0-882" id="h54-0-882" class="i">+
</a><a href="#h54-0-883" id="h54-0-883" class="i">+	/*
</a><a href="#h54-0-884" id="h54-0-884" class="i">+	 * Manually configure instead of calling XftMatchFont
</a><a href="#h54-0-885" id="h54-0-885" class="i">+	 * so that we can use the configured pattern for
</a><a href="#h54-0-886" id="h54-0-886" class="i">+	 * &quot;missing glyph&quot; lookups.
</a><a href="#h54-0-887" id="h54-0-887" class="i">+	 */
</a><a href="#h54-0-888" id="h54-0-888" class="i">+	configured = FcPatternDuplicate(pattern);
</a><a href="#h54-0-889" id="h54-0-889" class="i">+	if (!configured)
</a><a href="#h54-0-890" id="h54-0-890" class="i">+		return 1;
</a><a href="#h54-0-891" id="h54-0-891" class="i">+
</a><a href="#h54-0-892" id="h54-0-892" class="i">+	FcConfigSubstitute(NULL, configured, FcMatchPattern);
</a><a href="#h54-0-893" id="h54-0-893" class="i">+	XftDefaultSubstitute(xw.dpy, xw.scr, configured);
</a><a href="#h54-0-894" id="h54-0-894" class="i">+
</a><a href="#h54-0-895" id="h54-0-895" class="i">+	match = FcFontMatch(NULL, configured, &amp;result);
</a><a href="#h54-0-896" id="h54-0-896" class="i">+	if (!match) {
</a><a href="#h54-0-897" id="h54-0-897" class="i">+		FcPatternDestroy(configured);
</a><a href="#h54-0-898" id="h54-0-898" class="i">+		return 1;
</a><a href="#h54-0-899" id="h54-0-899" class="i">+	}
</a><a href="#h54-0-900" id="h54-0-900" class="i">+
</a><a href="#h54-0-901" id="h54-0-901" class="i">+	if (!(f-&gt;match = XftFontOpenPattern(xw.dpy, match))) {
</a><a href="#h54-0-902" id="h54-0-902" class="i">+		FcPatternDestroy(configured);
</a><a href="#h54-0-903" id="h54-0-903" class="i">+		FcPatternDestroy(match);
</a><a href="#h54-0-904" id="h54-0-904" class="i">+		return 1;
</a><a href="#h54-0-905" id="h54-0-905" class="i">+	}
</a><a href="#h54-0-906" id="h54-0-906" class="i">+
</a><a href="#h54-0-907" id="h54-0-907" class="i">+	if ((XftPatternGetInteger(pattern, &quot;slant&quot;, 0, &amp;wantattr) ==
</a><a href="#h54-0-908" id="h54-0-908" class="i">+	    XftResultMatch)) {
</a><a href="#h54-0-909" id="h54-0-909" class="i">+		/*
</a><a href="#h54-0-910" id="h54-0-910" class="i">+		 * Check if xft was unable to find a font with the appropriate
</a><a href="#h54-0-911" id="h54-0-911" class="i">+		 * slant but gave us one anyway. Try to mitigate.
</a><a href="#h54-0-912" id="h54-0-912" class="i">+		 */
</a><a href="#h54-0-913" id="h54-0-913" class="i">+		if ((XftPatternGetInteger(f-&gt;match-&gt;pattern, &quot;slant&quot;, 0,
</a><a href="#h54-0-914" id="h54-0-914" class="i">+		    &amp;haveattr) != XftResultMatch) || haveattr &lt; wantattr) {
</a><a href="#h54-0-915" id="h54-0-915" class="i">+			f-&gt;badslant = 1;
</a><a href="#h54-0-916" id="h54-0-916" class="i">+			fputs(&quot;font slant does not match\n&quot;, stderr);
</a><a href="#h54-0-917" id="h54-0-917" class="i">+		}
</a><a href="#h54-0-918" id="h54-0-918" class="i">+	}
</a><a href="#h54-0-919" id="h54-0-919" class="i">+
</a><a href="#h54-0-920" id="h54-0-920" class="i">+	if ((XftPatternGetInteger(pattern, &quot;weight&quot;, 0, &amp;wantattr) ==
</a><a href="#h54-0-921" id="h54-0-921" class="i">+	    XftResultMatch)) {
</a><a href="#h54-0-922" id="h54-0-922" class="i">+		if ((XftPatternGetInteger(f-&gt;match-&gt;pattern, &quot;weight&quot;, 0,
</a><a href="#h54-0-923" id="h54-0-923" class="i">+		    &amp;haveattr) != XftResultMatch) || haveattr != wantattr) {
</a><a href="#h54-0-924" id="h54-0-924" class="i">+			f-&gt;badweight = 1;
</a><a href="#h54-0-925" id="h54-0-925" class="i">+			fputs(&quot;font weight does not match\n&quot;, stderr);
</a><a href="#h54-0-926" id="h54-0-926" class="i">+		}
</a><a href="#h54-0-927" id="h54-0-927" class="i">+	}
</a><a href="#h54-0-928" id="h54-0-928" class="i">+
</a><a href="#h54-0-929" id="h54-0-929" class="i">+	XftTextExtentsUtf8(xw.dpy, f-&gt;match,
</a><a href="#h54-0-930" id="h54-0-930" class="i">+		(const FcChar8 *) ascii_printable,
</a><a href="#h54-0-931" id="h54-0-931" class="i">+		strlen(ascii_printable), &amp;extents);
</a><a href="#h54-0-932" id="h54-0-932" class="i">+
</a><a href="#h54-0-933" id="h54-0-933" class="i">+	f-&gt;set = NULL;
</a><a href="#h54-0-934" id="h54-0-934" class="i">+	f-&gt;pattern = configured;
</a><a href="#h54-0-935" id="h54-0-935" class="i">+
</a><a href="#h54-0-936" id="h54-0-936" class="i">+	f-&gt;ascent = f-&gt;match-&gt;ascent;
</a><a href="#h54-0-937" id="h54-0-937" class="i">+	f-&gt;descent = f-&gt;match-&gt;descent;
</a><a href="#h54-0-938" id="h54-0-938" class="i">+	f-&gt;lbearing = 0;
</a><a href="#h54-0-939" id="h54-0-939" class="i">+	f-&gt;rbearing = f-&gt;match-&gt;max_advance_width;
</a><a href="#h54-0-940" id="h54-0-940" class="i">+
</a><a href="#h54-0-941" id="h54-0-941" class="i">+	f-&gt;height = f-&gt;ascent + f-&gt;descent;
</a><a href="#h54-0-942" id="h54-0-942" class="i">+	f-&gt;width = DIVCEIL(extents.xOff, strlen(ascii_printable));
</a><a href="#h54-0-943" id="h54-0-943" class="i">+
</a><a href="#h54-0-944" id="h54-0-944" class="i">+	return 0;
</a><a href="#h54-0-945" id="h54-0-945" class="i">+}
</a><a href="#h54-0-946" id="h54-0-946" class="i">+
</a><a href="#h54-0-947" id="h54-0-947" class="i">+void
</a><a href="#h54-0-948" id="h54-0-948" class="i">+xloadfonts(char *fontstr, double fontsize)
</a><a href="#h54-0-949" id="h54-0-949" class="i">+{
</a><a href="#h54-0-950" id="h54-0-950" class="i">+	FcPattern *pattern;
</a><a href="#h54-0-951" id="h54-0-951" class="i">+	double fontval;
</a><a href="#h54-0-952" id="h54-0-952" class="i">+
</a><a href="#h54-0-953" id="h54-0-953" class="i">+	if (fontstr[0] == &#39;-&#39;)
</a><a href="#h54-0-954" id="h54-0-954" class="i">+		pattern = XftXlfdParse(fontstr, False, False);
</a><a href="#h54-0-955" id="h54-0-955" class="i">+	else
</a><a href="#h54-0-956" id="h54-0-956" class="i">+		pattern = FcNameParse((FcChar8 *)fontstr);
</a><a href="#h54-0-957" id="h54-0-957" class="i">+
</a><a href="#h54-0-958" id="h54-0-958" class="i">+	if (!pattern)
</a><a href="#h54-0-959" id="h54-0-959" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h54-0-960" id="h54-0-960" class="i">+
</a><a href="#h54-0-961" id="h54-0-961" class="i">+	if (fontsize &gt; 1) {
</a><a href="#h54-0-962" id="h54-0-962" class="i">+		FcPatternDel(pattern, FC_PIXEL_SIZE);
</a><a href="#h54-0-963" id="h54-0-963" class="i">+		FcPatternDel(pattern, FC_SIZE);
</a><a href="#h54-0-964" id="h54-0-964" class="i">+		FcPatternAddDouble(pattern, FC_PIXEL_SIZE, (double)fontsize);
</a><a href="#h54-0-965" id="h54-0-965" class="i">+		usedfontsize = fontsize;
</a><a href="#h54-0-966" id="h54-0-966" class="i">+	} else {
</a><a href="#h54-0-967" id="h54-0-967" class="i">+		if (FcPatternGetDouble(pattern, FC_PIXEL_SIZE, 0, &amp;fontval) ==
</a><a href="#h54-0-968" id="h54-0-968" class="i">+				FcResultMatch) {
</a><a href="#h54-0-969" id="h54-0-969" class="i">+			usedfontsize = fontval;
</a><a href="#h54-0-970" id="h54-0-970" class="i">+		} else if (FcPatternGetDouble(pattern, FC_SIZE, 0, &amp;fontval) ==
</a><a href="#h54-0-971" id="h54-0-971" class="i">+				FcResultMatch) {
</a><a href="#h54-0-972" id="h54-0-972" class="i">+			usedfontsize = -1;
</a><a href="#h54-0-973" id="h54-0-973" class="i">+		} else {
</a><a href="#h54-0-974" id="h54-0-974" class="i">+			/*
</a><a href="#h54-0-975" id="h54-0-975" class="i">+			 * Default font size is 12, if none given. This is to
</a><a href="#h54-0-976" id="h54-0-976" class="i">+			 * have a known usedfontsize value.
</a><a href="#h54-0-977" id="h54-0-977" class="i">+			 */
</a><a href="#h54-0-978" id="h54-0-978" class="i">+			FcPatternAddDouble(pattern, FC_PIXEL_SIZE, 12);
</a><a href="#h54-0-979" id="h54-0-979" class="i">+			usedfontsize = 12;
</a><a href="#h54-0-980" id="h54-0-980" class="i">+		}
</a><a href="#h54-0-981" id="h54-0-981" class="i">+		defaultfontsize = usedfontsize;
</a><a href="#h54-0-982" id="h54-0-982" class="i">+	}
</a><a href="#h54-0-983" id="h54-0-983" class="i">+
</a><a href="#h54-0-984" id="h54-0-984" class="i">+	if (xloadfont(&amp;dc.font, pattern))
</a><a href="#h54-0-985" id="h54-0-985" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h54-0-986" id="h54-0-986" class="i">+
</a><a href="#h54-0-987" id="h54-0-987" class="i">+	if (usedfontsize &lt; 0) {
</a><a href="#h54-0-988" id="h54-0-988" class="i">+		FcPatternGetDouble(dc.font.match-&gt;pattern,
</a><a href="#h54-0-989" id="h54-0-989" class="i">+		                   FC_PIXEL_SIZE, 0, &amp;fontval);
</a><a href="#h54-0-990" id="h54-0-990" class="i">+		usedfontsize = fontval;
</a><a href="#h54-0-991" id="h54-0-991" class="i">+		if (fontsize == 0)
</a><a href="#h54-0-992" id="h54-0-992" class="i">+			defaultfontsize = fontval;
</a><a href="#h54-0-993" id="h54-0-993" class="i">+	}
</a><a href="#h54-0-994" id="h54-0-994" class="i">+
</a><a href="#h54-0-995" id="h54-0-995" class="i">+	/* Setting character width and height. */
</a><a href="#h54-0-996" id="h54-0-996" class="i">+	win.cw = ceilf(dc.font.width * cwscale);
</a><a href="#h54-0-997" id="h54-0-997" class="i">+	win.ch = ceilf(dc.font.height * chscale);
</a><a href="#h54-0-998" id="h54-0-998" class="i">+
</a><a href="#h54-0-999" id="h54-0-999" class="i">+	FcPatternDel(pattern, FC_SLANT);
</a><a href="#h54-0-1000" id="h54-0-1000" class="i">+	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ITALIC);
</a><a href="#h54-0-1001" id="h54-0-1001" class="i">+	if (xloadfont(&amp;dc.ifont, pattern))
</a><a href="#h54-0-1002" id="h54-0-1002" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h54-0-1003" id="h54-0-1003" class="i">+
</a><a href="#h54-0-1004" id="h54-0-1004" class="i">+	FcPatternDel(pattern, FC_WEIGHT);
</a><a href="#h54-0-1005" id="h54-0-1005" class="i">+	FcPatternAddInteger(pattern, FC_WEIGHT, FC_WEIGHT_BOLD);
</a><a href="#h54-0-1006" id="h54-0-1006" class="i">+	if (xloadfont(&amp;dc.ibfont, pattern))
</a><a href="#h54-0-1007" id="h54-0-1007" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h54-0-1008" id="h54-0-1008" class="i">+
</a><a href="#h54-0-1009" id="h54-0-1009" class="i">+	FcPatternDel(pattern, FC_SLANT);
</a><a href="#h54-0-1010" id="h54-0-1010" class="i">+	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ROMAN);
</a><a href="#h54-0-1011" id="h54-0-1011" class="i">+	if (xloadfont(&amp;dc.bfont, pattern))
</a><a href="#h54-0-1012" id="h54-0-1012" class="i">+		die(&quot;can&#39;t open font %s\n&quot;, fontstr);
</a><a href="#h54-0-1013" id="h54-0-1013" class="i">+
</a><a href="#h54-0-1014" id="h54-0-1014" class="i">+	FcPatternDestroy(pattern);
</a><a href="#h54-0-1015" id="h54-0-1015" class="i">+}
</a><a href="#h54-0-1016" id="h54-0-1016" class="i">+
</a><a href="#h54-0-1017" id="h54-0-1017" class="i">+void
</a><a href="#h54-0-1018" id="h54-0-1018" class="i">+xunloadfont(Font *f)
</a><a href="#h54-0-1019" id="h54-0-1019" class="i">+{
</a><a href="#h54-0-1020" id="h54-0-1020" class="i">+	XftFontClose(xw.dpy, f-&gt;match);
</a><a href="#h54-0-1021" id="h54-0-1021" class="i">+	FcPatternDestroy(f-&gt;pattern);
</a><a href="#h54-0-1022" id="h54-0-1022" class="i">+	if (f-&gt;set)
</a><a href="#h54-0-1023" id="h54-0-1023" class="i">+		FcFontSetDestroy(f-&gt;set);
</a><a href="#h54-0-1024" id="h54-0-1024" class="i">+}
</a><a href="#h54-0-1025" id="h54-0-1025" class="i">+
</a><a href="#h54-0-1026" id="h54-0-1026" class="i">+void
</a><a href="#h54-0-1027" id="h54-0-1027" class="i">+xunloadfonts(void)
</a><a href="#h54-0-1028" id="h54-0-1028" class="i">+{
</a><a href="#h54-0-1029" id="h54-0-1029" class="i">+	/* Free the loaded fonts in the font cache.  */
</a><a href="#h54-0-1030" id="h54-0-1030" class="i">+	while (frclen &gt; 0)
</a><a href="#h54-0-1031" id="h54-0-1031" class="i">+		XftFontClose(xw.dpy, frc[--frclen].font);
</a><a href="#h54-0-1032" id="h54-0-1032" class="i">+
</a><a href="#h54-0-1033" id="h54-0-1033" class="i">+	xunloadfont(&amp;dc.font);
</a><a href="#h54-0-1034" id="h54-0-1034" class="i">+	xunloadfont(&amp;dc.bfont);
</a><a href="#h54-0-1035" id="h54-0-1035" class="i">+	xunloadfont(&amp;dc.ifont);
</a><a href="#h54-0-1036" id="h54-0-1036" class="i">+	xunloadfont(&amp;dc.ibfont);
</a><a href="#h54-0-1037" id="h54-0-1037" class="i">+}
</a><a href="#h54-0-1038" id="h54-0-1038" class="i">+
</a><a href="#h54-0-1039" id="h54-0-1039" class="i">+void
</a><a href="#h54-0-1040" id="h54-0-1040" class="i">+ximopen(Display *dpy)
</a><a href="#h54-0-1041" id="h54-0-1041" class="i">+{
</a><a href="#h54-0-1042" id="h54-0-1042" class="i">+	XIMCallback destroy = { .client_data = NULL, .callback = ximdestroy };
</a><a href="#h54-0-1043" id="h54-0-1043" class="i">+
</a><a href="#h54-0-1044" id="h54-0-1044" class="i">+	if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h54-0-1045" id="h54-0-1045" class="i">+		XSetLocaleModifiers(&quot;@im=local&quot;);
</a><a href="#h54-0-1046" id="h54-0-1046" class="i">+		if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h54-0-1047" id="h54-0-1047" class="i">+			XSetLocaleModifiers(&quot;@im=&quot;);
</a><a href="#h54-0-1048" id="h54-0-1048" class="i">+			if ((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL)
</a><a href="#h54-0-1049" id="h54-0-1049" class="i">+				die(&quot;XOpenIM failed. Could not open input device.\n&quot;);
</a><a href="#h54-0-1050" id="h54-0-1050" class="i">+		}
</a><a href="#h54-0-1051" id="h54-0-1051" class="i">+	}
</a><a href="#h54-0-1052" id="h54-0-1052" class="i">+	if (XSetIMValues(xw.xim, XNDestroyCallback, &amp;destroy, NULL) != NULL)
</a><a href="#h54-0-1053" id="h54-0-1053" class="i">+		die(&quot;XSetIMValues failed. Could not set input method value.\n&quot;);
</a><a href="#h54-0-1054" id="h54-0-1054" class="i">+	xw.xic = XCreateIC(xw.xim, XNInputStyle, XIMPreeditNothing | XIMStatusNothing,
</a><a href="#h54-0-1055" id="h54-0-1055" class="i">+				XNClientWindow, xw.win, XNFocusWindow, xw.win, NULL);
</a><a href="#h54-0-1056" id="h54-0-1056" class="i">+	if (xw.xic == NULL)
</a><a href="#h54-0-1057" id="h54-0-1057" class="i">+		die(&quot;XCreateIC failed. Could not obtain input method.\n&quot;);
</a><a href="#h54-0-1058" id="h54-0-1058" class="i">+}
</a><a href="#h54-0-1059" id="h54-0-1059" class="i">+
</a><a href="#h54-0-1060" id="h54-0-1060" class="i">+void
</a><a href="#h54-0-1061" id="h54-0-1061" class="i">+ximinstantiate(Display *dpy, XPointer client, XPointer call)
</a><a href="#h54-0-1062" id="h54-0-1062" class="i">+{
</a><a href="#h54-0-1063" id="h54-0-1063" class="i">+	ximopen(dpy);
</a><a href="#h54-0-1064" id="h54-0-1064" class="i">+	XUnregisterIMInstantiateCallback(xw.dpy, NULL, NULL, NULL,
</a><a href="#h54-0-1065" id="h54-0-1065" class="i">+					ximinstantiate, NULL);
</a><a href="#h54-0-1066" id="h54-0-1066" class="i">+}
</a><a href="#h54-0-1067" id="h54-0-1067" class="i">+
</a><a href="#h54-0-1068" id="h54-0-1068" class="i">+void
</a><a href="#h54-0-1069" id="h54-0-1069" class="i">+ximdestroy(XIM xim, XPointer client, XPointer call)
</a><a href="#h54-0-1070" id="h54-0-1070" class="i">+{
</a><a href="#h54-0-1071" id="h54-0-1071" class="i">+	xw.xim = NULL;
</a><a href="#h54-0-1072" id="h54-0-1072" class="i">+	XRegisterIMInstantiateCallback(xw.dpy, NULL, NULL, NULL,
</a><a href="#h54-0-1073" id="h54-0-1073" class="i">+					ximinstantiate, NULL);
</a><a href="#h54-0-1074" id="h54-0-1074" class="i">+}
</a><a href="#h54-0-1075" id="h54-0-1075" class="i">+
</a><a href="#h54-0-1076" id="h54-0-1076" class="i">+void
</a><a href="#h54-0-1077" id="h54-0-1077" class="i">+xinit(int cols, int rows)
</a><a href="#h54-0-1078" id="h54-0-1078" class="i">+{
</a><a href="#h54-0-1079" id="h54-0-1079" class="i">+	XGCValues gcvalues;
</a><a href="#h54-0-1080" id="h54-0-1080" class="i">+	Window parent;
</a><a href="#h54-0-1081" id="h54-0-1081" class="i">+	pid_t thispid = getpid();
</a><a href="#h54-0-1082" id="h54-0-1082" class="i">+	XColor xmousefg, xmousebg;
</a><a href="#h54-0-1083" id="h54-0-1083" class="i">+	Pixmap blankpm;
</a><a href="#h54-0-1084" id="h54-0-1084" class="i">+
</a><a href="#h54-0-1085" id="h54-0-1085" class="i">+	if (!(xw.dpy = XOpenDisplay(NULL)))
</a><a href="#h54-0-1086" id="h54-0-1086" class="i">+		die(&quot;can&#39;t open display\n&quot;);
</a><a href="#h54-0-1087" id="h54-0-1087" class="i">+	xw.scr = XDefaultScreen(xw.dpy);
</a><a href="#h54-0-1088" id="h54-0-1088" class="i">+	xw.depth = (USE_ARGB) ? 32: XDefaultDepth(xw.dpy, xw.scr);
</a><a href="#h54-0-1089" id="h54-0-1089" class="i">+	if (!USE_ARGB)
</a><a href="#h54-0-1090" id="h54-0-1090" class="i">+		xw.vis = XDefaultVisual(xw.dpy, xw.scr);
</a><a href="#h54-0-1091" id="h54-0-1091" class="i">+	else {
</a><a href="#h54-0-1092" id="h54-0-1092" class="i">+		XVisualInfo *vis;
</a><a href="#h54-0-1093" id="h54-0-1093" class="i">+		XRenderPictFormat *fmt;
</a><a href="#h54-0-1094" id="h54-0-1094" class="i">+		int nvi;
</a><a href="#h54-0-1095" id="h54-0-1095" class="i">+		int i;
</a><a href="#h54-0-1096" id="h54-0-1096" class="i">+
</a><a href="#h54-0-1097" id="h54-0-1097" class="i">+		XVisualInfo tpl = {
</a><a href="#h54-0-1098" id="h54-0-1098" class="i">+			.screen = xw.scr,
</a><a href="#h54-0-1099" id="h54-0-1099" class="i">+			.depth = 32,
</a><a href="#h54-0-1100" id="h54-0-1100" class="i">+			.class = TrueColor
</a><a href="#h54-0-1101" id="h54-0-1101" class="i">+		};
</a><a href="#h54-0-1102" id="h54-0-1102" class="i">+
</a><a href="#h54-0-1103" id="h54-0-1103" class="i">+		vis = XGetVisualInfo(xw.dpy,
</a><a href="#h54-0-1104" id="h54-0-1104" class="i">+				VisualScreenMask | VisualDepthMask | VisualClassMask,
</a><a href="#h54-0-1105" id="h54-0-1105" class="i">+				&amp;tpl, &amp;nvi);
</a><a href="#h54-0-1106" id="h54-0-1106" class="i">+		xw.vis = NULL;
</a><a href="#h54-0-1107" id="h54-0-1107" class="i">+		for (i = 0; i &lt; nvi; i++) {
</a><a href="#h54-0-1108" id="h54-0-1108" class="i">+			fmt = XRenderFindVisualFormat(xw.dpy, vis[i].visual);
</a><a href="#h54-0-1109" id="h54-0-1109" class="i">+			if (fmt-&gt;type == PictTypeDirect &amp;&amp; fmt-&gt;direct.alphaMask) {
</a><a href="#h54-0-1110" id="h54-0-1110" class="i">+				xw.vis = vis[i].visual;
</a><a href="#h54-0-1111" id="h54-0-1111" class="i">+				break;
</a><a href="#h54-0-1112" id="h54-0-1112" class="i">+			}
</a><a href="#h54-0-1113" id="h54-0-1113" class="i">+		}
</a><a href="#h54-0-1114" id="h54-0-1114" class="i">+
</a><a href="#h54-0-1115" id="h54-0-1115" class="i">+		XFree(vis);
</a><a href="#h54-0-1116" id="h54-0-1116" class="i">+
</a><a href="#h54-0-1117" id="h54-0-1117" class="i">+		if (!xw.vis) {
</a><a href="#h54-0-1118" id="h54-0-1118" class="i">+			fprintf(stderr, &quot;Couldn&#39;t find ARGB visual.\n&quot;);
</a><a href="#h54-0-1119" id="h54-0-1119" class="i">+			exit(1);
</a><a href="#h54-0-1120" id="h54-0-1120" class="i">+		}
</a><a href="#h54-0-1121" id="h54-0-1121" class="i">+	}
</a><a href="#h54-0-1122" id="h54-0-1122" class="i">+
</a><a href="#h54-0-1123" id="h54-0-1123" class="i">+	/* font */
</a><a href="#h54-0-1124" id="h54-0-1124" class="i">+	if (!FcInit())
</a><a href="#h54-0-1125" id="h54-0-1125" class="i">+		die(&quot;could not init fontconfig.\n&quot;);
</a><a href="#h54-0-1126" id="h54-0-1126" class="i">+
</a><a href="#h54-0-1127" id="h54-0-1127" class="i">+	usedfont = (opt_font == NULL)? font : opt_font;
</a><a href="#h54-0-1128" id="h54-0-1128" class="i">+	xloadfonts(usedfont, 0);
</a><a href="#h54-0-1129" id="h54-0-1129" class="i">+
</a><a href="#h54-0-1130" id="h54-0-1130" class="i">+	/* colors */
</a><a href="#h54-0-1131" id="h54-0-1131" class="i">+	if (!USE_ARGB)
</a><a href="#h54-0-1132" id="h54-0-1132" class="i">+		xw.cmap = XDefaultColormap(xw.dpy, xw.scr);
</a><a href="#h54-0-1133" id="h54-0-1133" class="i">+	else
</a><a href="#h54-0-1134" id="h54-0-1134" class="i">+		xw.cmap = XCreateColormap(xw.dpy, XRootWindow(xw.dpy, xw.scr),
</a><a href="#h54-0-1135" id="h54-0-1135" class="i">+				xw.vis, None);
</a><a href="#h54-0-1136" id="h54-0-1136" class="i">+	xloadcols();
</a><a href="#h54-0-1137" id="h54-0-1137" class="i">+
</a><a href="#h54-0-1138" id="h54-0-1138" class="i">+	/* adjust fixed window geometry */
</a><a href="#h54-0-1139" id="h54-0-1139" class="i">+	win.w = 2 * borderpx + cols * win.cw;
</a><a href="#h54-0-1140" id="h54-0-1140" class="i">+	win.h = 2 * borderpx + rows * win.ch;
</a><a href="#h54-0-1141" id="h54-0-1141" class="i">+	if (xw.gm &amp; XNegative)
</a><a href="#h54-0-1142" id="h54-0-1142" class="i">+		xw.l += DisplayWidth(xw.dpy, xw.scr) - win.w - 2;
</a><a href="#h54-0-1143" id="h54-0-1143" class="i">+	if (xw.gm &amp; YNegative)
</a><a href="#h54-0-1144" id="h54-0-1144" class="i">+		xw.t += DisplayHeight(xw.dpy, xw.scr) - win.h - 2;
</a><a href="#h54-0-1145" id="h54-0-1145" class="i">+
</a><a href="#h54-0-1146" id="h54-0-1146" class="i">+	/* Events */
</a><a href="#h54-0-1147" id="h54-0-1147" class="i">+	xw.attrs.background_pixel = dc.col[defaultbg].pixel;
</a><a href="#h54-0-1148" id="h54-0-1148" class="i">+	xw.attrs.border_pixel = dc.col[defaultbg].pixel;
</a><a href="#h54-0-1149" id="h54-0-1149" class="i">+	xw.attrs.bit_gravity = NorthWestGravity;
</a><a href="#h54-0-1150" id="h54-0-1150" class="i">+	xw.attrs.event_mask = FocusChangeMask | KeyPressMask | KeyReleaseMask
</a><a href="#h54-0-1151" id="h54-0-1151" class="i">+		| ExposureMask | VisibilityChangeMask | StructureNotifyMask
</a><a href="#h54-0-1152" id="h54-0-1152" class="i">+		| ButtonMotionMask | ButtonPressMask | ButtonReleaseMask;
</a><a href="#h54-0-1153" id="h54-0-1153" class="i">+	xw.attrs.colormap = xw.cmap;
</a><a href="#h54-0-1154" id="h54-0-1154" class="i">+
</a><a href="#h54-0-1155" id="h54-0-1155" class="i">+	if (!(opt_embed &amp;&amp; (parent = strtol(opt_embed, NULL, 0))))
</a><a href="#h54-0-1156" id="h54-0-1156" class="i">+		parent = XRootWindow(xw.dpy, xw.scr);
</a><a href="#h54-0-1157" id="h54-0-1157" class="i">+	xw.win = XCreateWindow(xw.dpy, parent, xw.l, xw.t,
</a><a href="#h54-0-1158" id="h54-0-1158" class="i">+			win.w, win.h, 0, xw.depth, InputOutput,
</a><a href="#h54-0-1159" id="h54-0-1159" class="i">+			xw.vis, CWBackPixel | CWBorderPixel | CWBitGravity
</a><a href="#h54-0-1160" id="h54-0-1160" class="i">+			| CWEventMask | CWColormap, &amp;xw.attrs);
</a><a href="#h54-0-1161" id="h54-0-1161" class="i">+
</a><a href="#h54-0-1162" id="h54-0-1162" class="i">+	memset(&amp;gcvalues, 0, sizeof(gcvalues));
</a><a href="#h54-0-1163" id="h54-0-1163" class="i">+	gcvalues.graphics_exposures = False;
</a><a href="#h54-0-1164" id="h54-0-1164" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, win.w, win.h, xw.depth);
</a><a href="#h54-0-1165" id="h54-0-1165" class="i">+	dc.gc = XCreateGC(xw.dpy, (USE_ARGB) ? xw.buf: parent,
</a><a href="#h54-0-1166" id="h54-0-1166" class="i">+			GCGraphicsExposures, &amp;gcvalues);
</a><a href="#h54-0-1167" id="h54-0-1167" class="i">+	XSetForeground(xw.dpy, dc.gc, dc.col[defaultbg].pixel);
</a><a href="#h54-0-1168" id="h54-0-1168" class="i">+	XFillRectangle(xw.dpy, xw.buf, dc.gc, 0, 0, win.w, win.h);
</a><a href="#h54-0-1169" id="h54-0-1169" class="i">+
</a><a href="#h54-0-1170" id="h54-0-1170" class="i">+	/* font spec buffer */
</a><a href="#h54-0-1171" id="h54-0-1171" class="i">+	xw.specbuf = xmalloc(cols * sizeof(GlyphFontSpec));
</a><a href="#h54-0-1172" id="h54-0-1172" class="i">+
</a><a href="#h54-0-1173" id="h54-0-1173" class="i">+	/* Xft rendering context */
</a><a href="#h54-0-1174" id="h54-0-1174" class="i">+	xw.draw = XftDrawCreate(xw.dpy, xw.buf, xw.vis, xw.cmap);
</a><a href="#h54-0-1175" id="h54-0-1175" class="i">+
</a><a href="#h54-0-1176" id="h54-0-1176" class="i">+	/* input methods */
</a><a href="#h54-0-1177" id="h54-0-1177" class="i">+	ximopen(xw.dpy);
</a><a href="#h54-0-1178" id="h54-0-1178" class="i">+
</a><a href="#h54-0-1179" id="h54-0-1179" class="i">+	/* white cursor, black outline */
</a><a href="#h54-0-1180" id="h54-0-1180" class="i">+	xw.pointerisvisible = 1;
</a><a href="#h54-0-1181" id="h54-0-1181" class="i">+	xw.vpointer = XCreateFontCursor(xw.dpy, mouseshape);
</a><a href="#h54-0-1182" id="h54-0-1182" class="i">+	XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h54-0-1183" id="h54-0-1183" class="i">+
</a><a href="#h54-0-1184" id="h54-0-1184" class="i">+	if (XParseColor(xw.dpy, xw.cmap, colorname[mousefg], &amp;xmousefg) == 0) {
</a><a href="#h54-0-1185" id="h54-0-1185" class="i">+		xmousefg.red   = 0xffff;
</a><a href="#h54-0-1186" id="h54-0-1186" class="i">+		xmousefg.green = 0xffff;
</a><a href="#h54-0-1187" id="h54-0-1187" class="i">+		xmousefg.blue  = 0xffff;
</a><a href="#h54-0-1188" id="h54-0-1188" class="i">+	}
</a><a href="#h54-0-1189" id="h54-0-1189" class="i">+
</a><a href="#h54-0-1190" id="h54-0-1190" class="i">+	if (XParseColor(xw.dpy, xw.cmap, colorname[mousebg], &amp;xmousebg) == 0) {
</a><a href="#h54-0-1191" id="h54-0-1191" class="i">+		xmousebg.red   = 0x0000;
</a><a href="#h54-0-1192" id="h54-0-1192" class="i">+		xmousebg.green = 0x0000;
</a><a href="#h54-0-1193" id="h54-0-1193" class="i">+		xmousebg.blue  = 0x0000;
</a><a href="#h54-0-1194" id="h54-0-1194" class="i">+	}
</a><a href="#h54-0-1195" id="h54-0-1195" class="i">+
</a><a href="#h54-0-1196" id="h54-0-1196" class="i">+	XRecolorCursor(xw.dpy, xw.vpointer, &amp;xmousefg, &amp;xmousebg);
</a><a href="#h54-0-1197" id="h54-0-1197" class="i">+	blankpm = XCreateBitmapFromData(xw.dpy, xw.win, &amp;(char){0}, 1, 1);
</a><a href="#h54-0-1198" id="h54-0-1198" class="i">+	xw.bpointer = XCreatePixmapCursor(xw.dpy, blankpm, blankpm,
</a><a href="#h54-0-1199" id="h54-0-1199" class="i">+					  &amp;xmousefg, &amp;xmousebg, 0, 0);
</a><a href="#h54-0-1200" id="h54-0-1200" class="i">+
</a><a href="#h54-0-1201" id="h54-0-1201" class="i">+	xw.xembed = XInternAtom(xw.dpy, &quot;_XEMBED&quot;, False);
</a><a href="#h54-0-1202" id="h54-0-1202" class="i">+	xw.wmdeletewin = XInternAtom(xw.dpy, &quot;WM_DELETE_WINDOW&quot;, False);
</a><a href="#h54-0-1203" id="h54-0-1203" class="i">+	xw.netwmname = XInternAtom(xw.dpy, &quot;_NET_WM_NAME&quot;, False);
</a><a href="#h54-0-1204" id="h54-0-1204" class="i">+	XSetWMProtocols(xw.dpy, xw.win, &amp;xw.wmdeletewin, 1);
</a><a href="#h54-0-1205" id="h54-0-1205" class="i">+
</a><a href="#h54-0-1206" id="h54-0-1206" class="i">+	xw.netwmpid = XInternAtom(xw.dpy, &quot;_NET_WM_PID&quot;, False);
</a><a href="#h54-0-1207" id="h54-0-1207" class="i">+	XChangeProperty(xw.dpy, xw.win, xw.netwmpid, XA_CARDINAL, 32,
</a><a href="#h54-0-1208" id="h54-0-1208" class="i">+			PropModeReplace, (uchar *)&amp;thispid, 1);
</a><a href="#h54-0-1209" id="h54-0-1209" class="i">+
</a><a href="#h54-0-1210" id="h54-0-1210" class="i">+	win.mode = MODE_NUMLOCK;
</a><a href="#h54-0-1211" id="h54-0-1211" class="i">+	resettitle();
</a><a href="#h54-0-1212" id="h54-0-1212" class="i">+	XMapWindow(xw.dpy, xw.win);
</a><a href="#h54-0-1213" id="h54-0-1213" class="i">+	xhints();
</a><a href="#h54-0-1214" id="h54-0-1214" class="i">+	XSync(xw.dpy, False);
</a><a href="#h54-0-1215" id="h54-0-1215" class="i">+
</a><a href="#h54-0-1216" id="h54-0-1216" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;xsel.tclick1);
</a><a href="#h54-0-1217" id="h54-0-1217" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;xsel.tclick2);
</a><a href="#h54-0-1218" id="h54-0-1218" class="i">+	xsel.primary = NULL;
</a><a href="#h54-0-1219" id="h54-0-1219" class="i">+	xsel.clipboard = NULL;
</a><a href="#h54-0-1220" id="h54-0-1220" class="i">+	xsel.xtarget = XInternAtom(xw.dpy, &quot;UTF8_STRING&quot;, 0);
</a><a href="#h54-0-1221" id="h54-0-1221" class="i">+	if (xsel.xtarget == None)
</a><a href="#h54-0-1222" id="h54-0-1222" class="i">+		xsel.xtarget = XA_STRING;
</a><a href="#h54-0-1223" id="h54-0-1223" class="i">+}
</a><a href="#h54-0-1224" id="h54-0-1224" class="i">+
</a><a href="#h54-0-1225" id="h54-0-1225" class="i">+int
</a><a href="#h54-0-1226" id="h54-0-1226" class="i">+xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x, int y)
</a><a href="#h54-0-1227" id="h54-0-1227" class="i">+{
</a><a href="#h54-0-1228" id="h54-0-1228" class="i">+	float winx = borderpx + x * win.cw, winy = borderpx + y * win.ch, xp, yp;
</a><a href="#h54-0-1229" id="h54-0-1229" class="i">+	ushort mode, prevmode = USHRT_MAX;
</a><a href="#h54-0-1230" id="h54-0-1230" class="i">+	Font *font = &amp;dc.font;
</a><a href="#h54-0-1231" id="h54-0-1231" class="i">+	int frcflags = FRC_NORMAL;
</a><a href="#h54-0-1232" id="h54-0-1232" class="i">+	float runewidth = win.cw;
</a><a href="#h54-0-1233" id="h54-0-1233" class="i">+	Rune rune;
</a><a href="#h54-0-1234" id="h54-0-1234" class="i">+	FT_UInt glyphidx;
</a><a href="#h54-0-1235" id="h54-0-1235" class="i">+	FcResult fcres;
</a><a href="#h54-0-1236" id="h54-0-1236" class="i">+	FcPattern *fcpattern, *fontpattern;
</a><a href="#h54-0-1237" id="h54-0-1237" class="i">+	FcFontSet *fcsets[] = { NULL };
</a><a href="#h54-0-1238" id="h54-0-1238" class="i">+	FcCharSet *fccharset;
</a><a href="#h54-0-1239" id="h54-0-1239" class="i">+	int i, f, numspecs = 0;
</a><a href="#h54-0-1240" id="h54-0-1240" class="i">+
</a><a href="#h54-0-1241" id="h54-0-1241" class="i">+	for (i = 0, xp = winx, yp = winy + font-&gt;ascent; i &lt; len; ++i) {
</a><a href="#h54-0-1242" id="h54-0-1242" class="i">+		/* Fetch rune and mode for current glyph. */
</a><a href="#h54-0-1243" id="h54-0-1243" class="i">+		rune = glyphs[i].u;
</a><a href="#h54-0-1244" id="h54-0-1244" class="i">+		mode = glyphs[i].mode;
</a><a href="#h54-0-1245" id="h54-0-1245" class="i">+
</a><a href="#h54-0-1246" id="h54-0-1246" class="i">+		/* Skip dummy wide-character spacing. */
</a><a href="#h54-0-1247" id="h54-0-1247" class="i">+		if (mode == ATTR_WDUMMY)
</a><a href="#h54-0-1248" id="h54-0-1248" class="i">+			continue;
</a><a href="#h54-0-1249" id="h54-0-1249" class="i">+
</a><a href="#h54-0-1250" id="h54-0-1250" class="i">+		/* Determine font for glyph if different from previous glyph. */
</a><a href="#h54-0-1251" id="h54-0-1251" class="i">+		if (prevmode != mode) {
</a><a href="#h54-0-1252" id="h54-0-1252" class="i">+			prevmode = mode;
</a><a href="#h54-0-1253" id="h54-0-1253" class="i">+			font = &amp;dc.font;
</a><a href="#h54-0-1254" id="h54-0-1254" class="i">+			frcflags = FRC_NORMAL;
</a><a href="#h54-0-1255" id="h54-0-1255" class="i">+			runewidth = win.cw * ((mode &amp; ATTR_WIDE) ? 2.0f : 1.0f);
</a><a href="#h54-0-1256" id="h54-0-1256" class="i">+			if ((mode &amp; ATTR_ITALIC) &amp;&amp; (mode &amp; ATTR_BOLD)) {
</a><a href="#h54-0-1257" id="h54-0-1257" class="i">+				font = &amp;dc.ibfont;
</a><a href="#h54-0-1258" id="h54-0-1258" class="i">+				frcflags = FRC_ITALICBOLD;
</a><a href="#h54-0-1259" id="h54-0-1259" class="i">+			} else if (mode &amp; ATTR_ITALIC) {
</a><a href="#h54-0-1260" id="h54-0-1260" class="i">+				font = &amp;dc.ifont;
</a><a href="#h54-0-1261" id="h54-0-1261" class="i">+				frcflags = FRC_ITALIC;
</a><a href="#h54-0-1262" id="h54-0-1262" class="i">+			} else if (mode &amp; ATTR_BOLD) {
</a><a href="#h54-0-1263" id="h54-0-1263" class="i">+				font = &amp;dc.bfont;
</a><a href="#h54-0-1264" id="h54-0-1264" class="i">+				frcflags = FRC_BOLD;
</a><a href="#h54-0-1265" id="h54-0-1265" class="i">+			}
</a><a href="#h54-0-1266" id="h54-0-1266" class="i">+			yp = winy + font-&gt;ascent;
</a><a href="#h54-0-1267" id="h54-0-1267" class="i">+		}
</a><a href="#h54-0-1268" id="h54-0-1268" class="i">+
</a><a href="#h54-0-1269" id="h54-0-1269" class="i">+		/* Lookup character index with default font. */
</a><a href="#h54-0-1270" id="h54-0-1270" class="i">+		glyphidx = XftCharIndex(xw.dpy, font-&gt;match, rune);
</a><a href="#h54-0-1271" id="h54-0-1271" class="i">+		if (glyphidx) {
</a><a href="#h54-0-1272" id="h54-0-1272" class="i">+			specs[numspecs].font = font-&gt;match;
</a><a href="#h54-0-1273" id="h54-0-1273" class="i">+			specs[numspecs].glyph = glyphidx;
</a><a href="#h54-0-1274" id="h54-0-1274" class="i">+			specs[numspecs].x = (short)xp;
</a><a href="#h54-0-1275" id="h54-0-1275" class="i">+			specs[numspecs].y = (short)yp;
</a><a href="#h54-0-1276" id="h54-0-1276" class="i">+			xp += runewidth;
</a><a href="#h54-0-1277" id="h54-0-1277" class="i">+			numspecs++;
</a><a href="#h54-0-1278" id="h54-0-1278" class="i">+			continue;
</a><a href="#h54-0-1279" id="h54-0-1279" class="i">+		}
</a><a href="#h54-0-1280" id="h54-0-1280" class="i">+
</a><a href="#h54-0-1281" id="h54-0-1281" class="i">+		/* Fallback on font cache, search the font cache for match. */
</a><a href="#h54-0-1282" id="h54-0-1282" class="i">+		for (f = 0; f &lt; frclen; f++) {
</a><a href="#h54-0-1283" id="h54-0-1283" class="i">+			glyphidx = XftCharIndex(xw.dpy, frc[f].font, rune);
</a><a href="#h54-0-1284" id="h54-0-1284" class="i">+			/* Everything correct. */
</a><a href="#h54-0-1285" id="h54-0-1285" class="i">+			if (glyphidx &amp;&amp; frc[f].flags == frcflags)
</a><a href="#h54-0-1286" id="h54-0-1286" class="i">+				break;
</a><a href="#h54-0-1287" id="h54-0-1287" class="i">+			/* We got a default font for a not found glyph. */
</a><a href="#h54-0-1288" id="h54-0-1288" class="i">+			if (!glyphidx &amp;&amp; frc[f].flags == frcflags
</a><a href="#h54-0-1289" id="h54-0-1289" class="i">+					&amp;&amp; frc[f].unicodep == rune) {
</a><a href="#h54-0-1290" id="h54-0-1290" class="i">+				break;
</a><a href="#h54-0-1291" id="h54-0-1291" class="i">+			}
</a><a href="#h54-0-1292" id="h54-0-1292" class="i">+		}
</a><a href="#h54-0-1293" id="h54-0-1293" class="i">+
</a><a href="#h54-0-1294" id="h54-0-1294" class="i">+		/* Nothing was found. Use fontconfig to find matching font. */
</a><a href="#h54-0-1295" id="h54-0-1295" class="i">+		if (f &gt;= frclen) {
</a><a href="#h54-0-1296" id="h54-0-1296" class="i">+			if (!font-&gt;set)
</a><a href="#h54-0-1297" id="h54-0-1297" class="i">+				font-&gt;set = FcFontSort(0, font-&gt;pattern,
</a><a href="#h54-0-1298" id="h54-0-1298" class="i">+				                       1, 0, &amp;fcres);
</a><a href="#h54-0-1299" id="h54-0-1299" class="i">+			fcsets[0] = font-&gt;set;
</a><a href="#h54-0-1300" id="h54-0-1300" class="i">+
</a><a href="#h54-0-1301" id="h54-0-1301" class="i">+			/*
</a><a href="#h54-0-1302" id="h54-0-1302" class="i">+			 * Nothing was found in the cache. Now use
</a><a href="#h54-0-1303" id="h54-0-1303" class="i">+			 * some dozen of Fontconfig calls to get the
</a><a href="#h54-0-1304" id="h54-0-1304" class="i">+			 * font for one single character.
</a><a href="#h54-0-1305" id="h54-0-1305" class="i">+			 *
</a><a href="#h54-0-1306" id="h54-0-1306" class="i">+			 * Xft and fontconfig are design failures.
</a><a href="#h54-0-1307" id="h54-0-1307" class="i">+			 */
</a><a href="#h54-0-1308" id="h54-0-1308" class="i">+			fcpattern = FcPatternDuplicate(font-&gt;pattern);
</a><a href="#h54-0-1309" id="h54-0-1309" class="i">+			fccharset = FcCharSetCreate();
</a><a href="#h54-0-1310" id="h54-0-1310" class="i">+
</a><a href="#h54-0-1311" id="h54-0-1311" class="i">+			FcCharSetAddChar(fccharset, rune);
</a><a href="#h54-0-1312" id="h54-0-1312" class="i">+			FcPatternAddCharSet(fcpattern, FC_CHARSET,
</a><a href="#h54-0-1313" id="h54-0-1313" class="i">+					fccharset);
</a><a href="#h54-0-1314" id="h54-0-1314" class="i">+			FcPatternAddBool(fcpattern, FC_SCALABLE, 1);
</a><a href="#h54-0-1315" id="h54-0-1315" class="i">+
</a><a href="#h54-0-1316" id="h54-0-1316" class="i">+			FcConfigSubstitute(0, fcpattern,
</a><a href="#h54-0-1317" id="h54-0-1317" class="i">+					FcMatchPattern);
</a><a href="#h54-0-1318" id="h54-0-1318" class="i">+			FcDefaultSubstitute(fcpattern);
</a><a href="#h54-0-1319" id="h54-0-1319" class="i">+
</a><a href="#h54-0-1320" id="h54-0-1320" class="i">+			fontpattern = FcFontSetMatch(0, fcsets, 1,
</a><a href="#h54-0-1321" id="h54-0-1321" class="i">+					fcpattern, &amp;fcres);
</a><a href="#h54-0-1322" id="h54-0-1322" class="i">+
</a><a href="#h54-0-1323" id="h54-0-1323" class="i">+			/*
</a><a href="#h54-0-1324" id="h54-0-1324" class="i">+			 * Overwrite or create the new cache entry.
</a><a href="#h54-0-1325" id="h54-0-1325" class="i">+			 */
</a><a href="#h54-0-1326" id="h54-0-1326" class="i">+			if (frclen &gt;= LEN(frc)) {
</a><a href="#h54-0-1327" id="h54-0-1327" class="i">+				frclen = LEN(frc) - 1;
</a><a href="#h54-0-1328" id="h54-0-1328" class="i">+				XftFontClose(xw.dpy, frc[frclen].font);
</a><a href="#h54-0-1329" id="h54-0-1329" class="i">+				frc[frclen].unicodep = 0;
</a><a href="#h54-0-1330" id="h54-0-1330" class="i">+			}
</a><a href="#h54-0-1331" id="h54-0-1331" class="i">+
</a><a href="#h54-0-1332" id="h54-0-1332" class="i">+			frc[frclen].font = XftFontOpenPattern(xw.dpy,
</a><a href="#h54-0-1333" id="h54-0-1333" class="i">+					fontpattern);
</a><a href="#h54-0-1334" id="h54-0-1334" class="i">+			if (!frc[frclen].font)
</a><a href="#h54-0-1335" id="h54-0-1335" class="i">+				die(&quot;XftFontOpenPattern failed seeking fallback font: %s\n&quot;,
</a><a href="#h54-0-1336" id="h54-0-1336" class="i">+					strerror(errno));
</a><a href="#h54-0-1337" id="h54-0-1337" class="i">+			frc[frclen].flags = frcflags;
</a><a href="#h54-0-1338" id="h54-0-1338" class="i">+			frc[frclen].unicodep = rune;
</a><a href="#h54-0-1339" id="h54-0-1339" class="i">+
</a><a href="#h54-0-1340" id="h54-0-1340" class="i">+			glyphidx = XftCharIndex(xw.dpy, frc[frclen].font, rune);
</a><a href="#h54-0-1341" id="h54-0-1341" class="i">+
</a><a href="#h54-0-1342" id="h54-0-1342" class="i">+			f = frclen;
</a><a href="#h54-0-1343" id="h54-0-1343" class="i">+			frclen++;
</a><a href="#h54-0-1344" id="h54-0-1344" class="i">+
</a><a href="#h54-0-1345" id="h54-0-1345" class="i">+			FcPatternDestroy(fcpattern);
</a><a href="#h54-0-1346" id="h54-0-1346" class="i">+			FcCharSetDestroy(fccharset);
</a><a href="#h54-0-1347" id="h54-0-1347" class="i">+		}
</a><a href="#h54-0-1348" id="h54-0-1348" class="i">+
</a><a href="#h54-0-1349" id="h54-0-1349" class="i">+		specs[numspecs].font = frc[f].font;
</a><a href="#h54-0-1350" id="h54-0-1350" class="i">+		specs[numspecs].glyph = glyphidx;
</a><a href="#h54-0-1351" id="h54-0-1351" class="i">+		specs[numspecs].x = (short)xp;
</a><a href="#h54-0-1352" id="h54-0-1352" class="i">+		specs[numspecs].y = (short)yp;
</a><a href="#h54-0-1353" id="h54-0-1353" class="i">+		xp += runewidth;
</a><a href="#h54-0-1354" id="h54-0-1354" class="i">+		numspecs++;
</a><a href="#h54-0-1355" id="h54-0-1355" class="i">+	}
</a><a href="#h54-0-1356" id="h54-0-1356" class="i">+
</a><a href="#h54-0-1357" id="h54-0-1357" class="i">+	return numspecs;
</a><a href="#h54-0-1358" id="h54-0-1358" class="i">+}
</a><a href="#h54-0-1359" id="h54-0-1359" class="i">+
</a><a href="#h54-0-1360" id="h54-0-1360" class="i">+void
</a><a href="#h54-0-1361" id="h54-0-1361" class="i">+xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, int y)
</a><a href="#h54-0-1362" id="h54-0-1362" class="i">+{
</a><a href="#h54-0-1363" id="h54-0-1363" class="i">+	int charlen = len * ((base.mode &amp; ATTR_WIDE) ? 2 : 1);
</a><a href="#h54-0-1364" id="h54-0-1364" class="i">+	int winx = borderpx + x * win.cw, winy = borderpx + y * win.ch,
</a><a href="#h54-0-1365" id="h54-0-1365" class="i">+	    width = charlen * win.cw;
</a><a href="#h54-0-1366" id="h54-0-1366" class="i">+	Color *fg, *bg, *temp, revfg, revbg, truefg, truebg;
</a><a href="#h54-0-1367" id="h54-0-1367" class="i">+	XRenderColor colfg, colbg;
</a><a href="#h54-0-1368" id="h54-0-1368" class="i">+	XRectangle r;
</a><a href="#h54-0-1369" id="h54-0-1369" class="i">+
</a><a href="#h54-0-1370" id="h54-0-1370" class="i">+	/* Fallback on color display for attributes not supported by the font */
</a><a href="#h54-0-1371" id="h54-0-1371" class="i">+	if (base.mode &amp; ATTR_ITALIC &amp;&amp; base.mode &amp; ATTR_BOLD) {
</a><a href="#h54-0-1372" id="h54-0-1372" class="i">+		if (dc.ibfont.badslant || dc.ibfont.badweight)
</a><a href="#h54-0-1373" id="h54-0-1373" class="i">+			base.fg = defaultattr;
</a><a href="#h54-0-1374" id="h54-0-1374" class="i">+	} else if ((base.mode &amp; ATTR_ITALIC &amp;&amp; dc.ifont.badslant) ||
</a><a href="#h54-0-1375" id="h54-0-1375" class="i">+	    (base.mode &amp; ATTR_BOLD &amp;&amp; dc.bfont.badweight)) {
</a><a href="#h54-0-1376" id="h54-0-1376" class="i">+		base.fg = defaultattr;
</a><a href="#h54-0-1377" id="h54-0-1377" class="i">+	}
</a><a href="#h54-0-1378" id="h54-0-1378" class="i">+
</a><a href="#h54-0-1379" id="h54-0-1379" class="i">+	if (IS_TRUECOL(base.fg)) {
</a><a href="#h54-0-1380" id="h54-0-1380" class="i">+		colfg.alpha = 0xffff;
</a><a href="#h54-0-1381" id="h54-0-1381" class="i">+		colfg.red = TRUERED(base.fg);
</a><a href="#h54-0-1382" id="h54-0-1382" class="i">+		colfg.green = TRUEGREEN(base.fg);
</a><a href="#h54-0-1383" id="h54-0-1383" class="i">+		colfg.blue = TRUEBLUE(base.fg);
</a><a href="#h54-0-1384" id="h54-0-1384" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg, &amp;truefg);
</a><a href="#h54-0-1385" id="h54-0-1385" class="i">+		fg = &amp;truefg;
</a><a href="#h54-0-1386" id="h54-0-1386" class="i">+	} else {
</a><a href="#h54-0-1387" id="h54-0-1387" class="i">+		fg = &amp;dc.col[base.fg];
</a><a href="#h54-0-1388" id="h54-0-1388" class="i">+	}
</a><a href="#h54-0-1389" id="h54-0-1389" class="i">+
</a><a href="#h54-0-1390" id="h54-0-1390" class="i">+	if (IS_TRUECOL(base.bg)) {
</a><a href="#h54-0-1391" id="h54-0-1391" class="i">+		colbg.alpha = 0xffff;
</a><a href="#h54-0-1392" id="h54-0-1392" class="i">+		colbg.green = TRUEGREEN(base.bg);
</a><a href="#h54-0-1393" id="h54-0-1393" class="i">+		colbg.red = TRUERED(base.bg);
</a><a href="#h54-0-1394" id="h54-0-1394" class="i">+		colbg.blue = TRUEBLUE(base.bg);
</a><a href="#h54-0-1395" id="h54-0-1395" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colbg, &amp;truebg);
</a><a href="#h54-0-1396" id="h54-0-1396" class="i">+		bg = &amp;truebg;
</a><a href="#h54-0-1397" id="h54-0-1397" class="i">+	} else {
</a><a href="#h54-0-1398" id="h54-0-1398" class="i">+		bg = &amp;dc.col[base.bg];
</a><a href="#h54-0-1399" id="h54-0-1399" class="i">+	}
</a><a href="#h54-0-1400" id="h54-0-1400" class="i">+
</a><a href="#h54-0-1401" id="h54-0-1401" class="i">+	/* Change basic system colors [0-7] to bright system colors [8-15] */
</a><a href="#h54-0-1402" id="h54-0-1402" class="i">+	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_BOLD &amp;&amp; BETWEEN(base.fg, 0, 7))
</a><a href="#h54-0-1403" id="h54-0-1403" class="i">+		fg = &amp;dc.col[base.fg + 8];
</a><a href="#h54-0-1404" id="h54-0-1404" class="i">+
</a><a href="#h54-0-1405" id="h54-0-1405" class="i">+	if (IS_SET(MODE_REVERSE)) {
</a><a href="#h54-0-1406" id="h54-0-1406" class="i">+		if (fg == &amp;dc.col[defaultfg]) {
</a><a href="#h54-0-1407" id="h54-0-1407" class="i">+			fg = &amp;dc.col[defaultbg];
</a><a href="#h54-0-1408" id="h54-0-1408" class="i">+		} else {
</a><a href="#h54-0-1409" id="h54-0-1409" class="i">+			colfg.red = ~fg-&gt;color.red;
</a><a href="#h54-0-1410" id="h54-0-1410" class="i">+			colfg.green = ~fg-&gt;color.green;
</a><a href="#h54-0-1411" id="h54-0-1411" class="i">+			colfg.blue = ~fg-&gt;color.blue;
</a><a href="#h54-0-1412" id="h54-0-1412" class="i">+			colfg.alpha = fg-&gt;color.alpha;
</a><a href="#h54-0-1413" id="h54-0-1413" class="i">+			XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg,
</a><a href="#h54-0-1414" id="h54-0-1414" class="i">+					&amp;revfg);
</a><a href="#h54-0-1415" id="h54-0-1415" class="i">+			fg = &amp;revfg;
</a><a href="#h54-0-1416" id="h54-0-1416" class="i">+		}
</a><a href="#h54-0-1417" id="h54-0-1417" class="i">+
</a><a href="#h54-0-1418" id="h54-0-1418" class="i">+		if (bg == &amp;dc.col[defaultbg]) {
</a><a href="#h54-0-1419" id="h54-0-1419" class="i">+			bg = &amp;dc.col[defaultfg];
</a><a href="#h54-0-1420" id="h54-0-1420" class="i">+		} else {
</a><a href="#h54-0-1421" id="h54-0-1421" class="i">+			colbg.red = ~bg-&gt;color.red;
</a><a href="#h54-0-1422" id="h54-0-1422" class="i">+			colbg.green = ~bg-&gt;color.green;
</a><a href="#h54-0-1423" id="h54-0-1423" class="i">+			colbg.blue = ~bg-&gt;color.blue;
</a><a href="#h54-0-1424" id="h54-0-1424" class="i">+			colbg.alpha = bg-&gt;color.alpha;
</a><a href="#h54-0-1425" id="h54-0-1425" class="i">+			XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colbg,
</a><a href="#h54-0-1426" id="h54-0-1426" class="i">+					&amp;revbg);
</a><a href="#h54-0-1427" id="h54-0-1427" class="i">+			bg = &amp;revbg;
</a><a href="#h54-0-1428" id="h54-0-1428" class="i">+		}
</a><a href="#h54-0-1429" id="h54-0-1429" class="i">+	}
</a><a href="#h54-0-1430" id="h54-0-1430" class="i">+
</a><a href="#h54-0-1431" id="h54-0-1431" class="i">+	if ((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_FAINT) {
</a><a href="#h54-0-1432" id="h54-0-1432" class="i">+		colfg.red = fg-&gt;color.red / 2;
</a><a href="#h54-0-1433" id="h54-0-1433" class="i">+		colfg.green = fg-&gt;color.green / 2;
</a><a href="#h54-0-1434" id="h54-0-1434" class="i">+		colfg.blue = fg-&gt;color.blue / 2;
</a><a href="#h54-0-1435" id="h54-0-1435" class="i">+		colfg.alpha = fg-&gt;color.alpha;
</a><a href="#h54-0-1436" id="h54-0-1436" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg, &amp;revfg);
</a><a href="#h54-0-1437" id="h54-0-1437" class="i">+		fg = &amp;revfg;
</a><a href="#h54-0-1438" id="h54-0-1438" class="i">+	}
</a><a href="#h54-0-1439" id="h54-0-1439" class="i">+
</a><a href="#h54-0-1440" id="h54-0-1440" class="i">+	if (base.mode &amp; ATTR_REVERSE) {
</a><a href="#h54-0-1441" id="h54-0-1441" class="i">+		temp = fg;
</a><a href="#h54-0-1442" id="h54-0-1442" class="i">+		fg = bg;
</a><a href="#h54-0-1443" id="h54-0-1443" class="i">+		bg = temp;
</a><a href="#h54-0-1444" id="h54-0-1444" class="i">+	}
</a><a href="#h54-0-1445" id="h54-0-1445" class="i">+
</a><a href="#h54-0-1446" id="h54-0-1446" class="i">+	if (base.mode &amp; ATTR_BLINK &amp;&amp; win.mode &amp; MODE_BLINK)
</a><a href="#h54-0-1447" id="h54-0-1447" class="i">+		fg = bg;
</a><a href="#h54-0-1448" id="h54-0-1448" class="i">+
</a><a href="#h54-0-1449" id="h54-0-1449" class="i">+	if (base.mode &amp; ATTR_INVISIBLE)
</a><a href="#h54-0-1450" id="h54-0-1450" class="i">+		fg = bg;
</a><a href="#h54-0-1451" id="h54-0-1451" class="i">+
</a><a href="#h54-0-1452" id="h54-0-1452" class="i">+	/* Intelligent cleaning up of the borders. */
</a><a href="#h54-0-1453" id="h54-0-1453" class="i">+	if (x == 0) {
</a><a href="#h54-0-1454" id="h54-0-1454" class="i">+		xclear(0, (y == 0)? 0 : winy, borderpx,
</a><a href="#h54-0-1455" id="h54-0-1455" class="i">+			winy + win.ch +
</a><a href="#h54-0-1456" id="h54-0-1456" class="i">+			((winy + win.ch &gt;= borderpx + win.th)? win.h : 0));
</a><a href="#h54-0-1457" id="h54-0-1457" class="i">+	}
</a><a href="#h54-0-1458" id="h54-0-1458" class="i">+	if (winx + width &gt;= borderpx + win.tw) {
</a><a href="#h54-0-1459" id="h54-0-1459" class="i">+		xclear(winx + width, (y == 0)? 0 : winy, win.w,
</a><a href="#h54-0-1460" id="h54-0-1460" class="i">+			((winy + win.ch &gt;= borderpx + win.th)? win.h : (winy + win.ch)));
</a><a href="#h54-0-1461" id="h54-0-1461" class="i">+	}
</a><a href="#h54-0-1462" id="h54-0-1462" class="i">+	if (y == 0)
</a><a href="#h54-0-1463" id="h54-0-1463" class="i">+		xclear(winx, 0, winx + width, borderpx);
</a><a href="#h54-0-1464" id="h54-0-1464" class="i">+	if (winy + win.ch &gt;= borderpx + win.th)
</a><a href="#h54-0-1465" id="h54-0-1465" class="i">+		xclear(winx, winy + win.ch, winx + width, win.h);
</a><a href="#h54-0-1466" id="h54-0-1466" class="i">+
</a><a href="#h54-0-1467" id="h54-0-1467" class="i">+	/* Clean up the region we want to draw to. */
</a><a href="#h54-0-1468" id="h54-0-1468" class="i">+	XftDrawRect(xw.draw, bg, winx, winy, width, win.ch);
</a><a href="#h54-0-1469" id="h54-0-1469" class="i">+
</a><a href="#h54-0-1470" id="h54-0-1470" class="i">+	/* Set the clip region because Xft is sometimes dirty. */
</a><a href="#h54-0-1471" id="h54-0-1471" class="i">+	r.x = 0;
</a><a href="#h54-0-1472" id="h54-0-1472" class="i">+	r.y = 0;
</a><a href="#h54-0-1473" id="h54-0-1473" class="i">+	r.height = win.ch;
</a><a href="#h54-0-1474" id="h54-0-1474" class="i">+	r.width = width;
</a><a href="#h54-0-1475" id="h54-0-1475" class="i">+	XftDrawSetClipRectangles(xw.draw, winx, winy, &amp;r, 1);
</a><a href="#h54-0-1476" id="h54-0-1476" class="i">+
</a><a href="#h54-0-1477" id="h54-0-1477" class="i">+	/* Render the glyphs. */
</a><a href="#h54-0-1478" id="h54-0-1478" class="i">+	XftDrawGlyphFontSpec(xw.draw, fg, specs, len);
</a><a href="#h54-0-1479" id="h54-0-1479" class="i">+
</a><a href="#h54-0-1480" id="h54-0-1480" class="i">+	/* Render underline and strikethrough. */
</a><a href="#h54-0-1481" id="h54-0-1481" class="i">+	if (base.mode &amp; ATTR_UNDERLINE) {
</a><a href="#h54-0-1482" id="h54-0-1482" class="i">+		XftDrawRect(xw.draw, fg, winx, winy + dc.font.ascent + 1,
</a><a href="#h54-0-1483" id="h54-0-1483" class="i">+				width, 1);
</a><a href="#h54-0-1484" id="h54-0-1484" class="i">+	}
</a><a href="#h54-0-1485" id="h54-0-1485" class="i">+
</a><a href="#h54-0-1486" id="h54-0-1486" class="i">+	if (base.mode &amp; ATTR_STRUCK) {
</a><a href="#h54-0-1487" id="h54-0-1487" class="i">+		XftDrawRect(xw.draw, fg, winx, winy + 2 * dc.font.ascent / 3,
</a><a href="#h54-0-1488" id="h54-0-1488" class="i">+				width, 1);
</a><a href="#h54-0-1489" id="h54-0-1489" class="i">+	}
</a><a href="#h54-0-1490" id="h54-0-1490" class="i">+
</a><a href="#h54-0-1491" id="h54-0-1491" class="i">+	/* Reset clip to none. */
</a><a href="#h54-0-1492" id="h54-0-1492" class="i">+	XftDrawSetClip(xw.draw, 0);
</a><a href="#h54-0-1493" id="h54-0-1493" class="i">+}
</a><a href="#h54-0-1494" id="h54-0-1494" class="i">+
</a><a href="#h54-0-1495" id="h54-0-1495" class="i">+void
</a><a href="#h54-0-1496" id="h54-0-1496" class="i">+xdrawglyph(Glyph g, int x, int y)
</a><a href="#h54-0-1497" id="h54-0-1497" class="i">+{
</a><a href="#h54-0-1498" id="h54-0-1498" class="i">+	int numspecs;
</a><a href="#h54-0-1499" id="h54-0-1499" class="i">+	XftGlyphFontSpec spec;
</a><a href="#h54-0-1500" id="h54-0-1500" class="i">+
</a><a href="#h54-0-1501" id="h54-0-1501" class="i">+	numspecs = xmakeglyphfontspecs(&amp;spec, &amp;g, 1, x, y);
</a><a href="#h54-0-1502" id="h54-0-1502" class="i">+	xdrawglyphfontspecs(&amp;spec, g, numspecs, x, y);
</a><a href="#h54-0-1503" id="h54-0-1503" class="i">+}
</a><a href="#h54-0-1504" id="h54-0-1504" class="i">+
</a><a href="#h54-0-1505" id="h54-0-1505" class="i">+void
</a><a href="#h54-0-1506" id="h54-0-1506" class="i">+xdrawcursor(int cx, int cy, Glyph g, int ox, int oy, Glyph og)
</a><a href="#h54-0-1507" id="h54-0-1507" class="i">+{
</a><a href="#h54-0-1508" id="h54-0-1508" class="i">+	Color drawcol;
</a><a href="#h54-0-1509" id="h54-0-1509" class="i">+
</a><a href="#h54-0-1510" id="h54-0-1510" class="i">+	/* remove the old cursor */
</a><a href="#h54-0-1511" id="h54-0-1511" class="i">+	if (selected(ox, oy))
</a><a href="#h54-0-1512" id="h54-0-1512" class="i">+		og.mode ^= ATTR_REVERSE;
</a><a href="#h54-0-1513" id="h54-0-1513" class="i">+	xdrawglyph(og, ox, oy);
</a><a href="#h54-0-1514" id="h54-0-1514" class="i">+
</a><a href="#h54-0-1515" id="h54-0-1515" class="i">+	if (IS_SET(MODE_HIDE))
</a><a href="#h54-0-1516" id="h54-0-1516" class="i">+		return;
</a><a href="#h54-0-1517" id="h54-0-1517" class="i">+
</a><a href="#h54-0-1518" id="h54-0-1518" class="i">+	/*
</a><a href="#h54-0-1519" id="h54-0-1519" class="i">+	 * Select the right color for the right mode.
</a><a href="#h54-0-1520" id="h54-0-1520" class="i">+	 */
</a><a href="#h54-0-1521" id="h54-0-1521" class="i">+	g.mode &amp;= ATTR_BOLD|ATTR_ITALIC|ATTR_UNDERLINE|ATTR_STRUCK|ATTR_WIDE;
</a><a href="#h54-0-1522" id="h54-0-1522" class="i">+
</a><a href="#h54-0-1523" id="h54-0-1523" class="i">+	if (IS_SET(MODE_REVERSE)) {
</a><a href="#h54-0-1524" id="h54-0-1524" class="i">+		g.mode |= ATTR_REVERSE;
</a><a href="#h54-0-1525" id="h54-0-1525" class="i">+		g.bg = defaultfg;
</a><a href="#h54-0-1526" id="h54-0-1526" class="i">+		if (selected(cx, cy)) {
</a><a href="#h54-0-1527" id="h54-0-1527" class="i">+			drawcol = dc.col[defaultcs];
</a><a href="#h54-0-1528" id="h54-0-1528" class="i">+			g.fg = defaultrcs;
</a><a href="#h54-0-1529" id="h54-0-1529" class="i">+		} else {
</a><a href="#h54-0-1530" id="h54-0-1530" class="i">+			drawcol = dc.col[defaultrcs];
</a><a href="#h54-0-1531" id="h54-0-1531" class="i">+			g.fg = defaultcs;
</a><a href="#h54-0-1532" id="h54-0-1532" class="i">+		}
</a><a href="#h54-0-1533" id="h54-0-1533" class="i">+	} else {
</a><a href="#h54-0-1534" id="h54-0-1534" class="i">+		if (selected(cx, cy)) {
</a><a href="#h54-0-1535" id="h54-0-1535" class="i">+			g.fg = defaultfg;
</a><a href="#h54-0-1536" id="h54-0-1536" class="i">+			g.bg = defaultrcs;
</a><a href="#h54-0-1537" id="h54-0-1537" class="i">+		} else {
</a><a href="#h54-0-1538" id="h54-0-1538" class="i">+			g.fg = defaultbg;
</a><a href="#h54-0-1539" id="h54-0-1539" class="i">+			g.bg = defaultcs;
</a><a href="#h54-0-1540" id="h54-0-1540" class="i">+		}
</a><a href="#h54-0-1541" id="h54-0-1541" class="i">+		drawcol = dc.col[g.bg];
</a><a href="#h54-0-1542" id="h54-0-1542" class="i">+	}
</a><a href="#h54-0-1543" id="h54-0-1543" class="i">+
</a><a href="#h54-0-1544" id="h54-0-1544" class="i">+	/* draw the new one */
</a><a href="#h54-0-1545" id="h54-0-1545" class="i">+	if (IS_SET(MODE_FOCUSED)) {
</a><a href="#h54-0-1546" id="h54-0-1546" class="i">+		switch (win.cursor) {
</a><a href="#h54-0-1547" id="h54-0-1547" class="i">+		case 7: /* st extension: snowman (U+2603) */
</a><a href="#h54-0-1548" id="h54-0-1548" class="i">+			g.u = 0x2603;
</a><a href="#h54-0-1549" id="h54-0-1549" class="i">+		case 0: /* Blinking Block */
</a><a href="#h54-0-1550" id="h54-0-1550" class="i">+		case 1: /* Blinking Block (Default) */
</a><a href="#h54-0-1551" id="h54-0-1551" class="i">+		case 2: /* Steady Block */
</a><a href="#h54-0-1552" id="h54-0-1552" class="i">+			xdrawglyph(g, cx, cy);
</a><a href="#h54-0-1553" id="h54-0-1553" class="i">+			break;
</a><a href="#h54-0-1554" id="h54-0-1554" class="i">+		case 3: /* Blinking Underline */
</a><a href="#h54-0-1555" id="h54-0-1555" class="i">+		case 4: /* Steady Underline */
</a><a href="#h54-0-1556" id="h54-0-1556" class="i">+			XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h54-0-1557" id="h54-0-1557" class="i">+					borderpx + cx * win.cw,
</a><a href="#h54-0-1558" id="h54-0-1558" class="i">+					borderpx + (cy + 1) * win.ch - \
</a><a href="#h54-0-1559" id="h54-0-1559" class="i">+						cursorthickness,
</a><a href="#h54-0-1560" id="h54-0-1560" class="i">+					win.cw, cursorthickness);
</a><a href="#h54-0-1561" id="h54-0-1561" class="i">+			break;
</a><a href="#h54-0-1562" id="h54-0-1562" class="i">+		case 5: /* Blinking bar */
</a><a href="#h54-0-1563" id="h54-0-1563" class="i">+		case 6: /* Steady bar */
</a><a href="#h54-0-1564" id="h54-0-1564" class="i">+			XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h54-0-1565" id="h54-0-1565" class="i">+					borderpx + cx * win.cw,
</a><a href="#h54-0-1566" id="h54-0-1566" class="i">+					borderpx + cy * win.ch,
</a><a href="#h54-0-1567" id="h54-0-1567" class="i">+					cursorthickness, win.ch);
</a><a href="#h54-0-1568" id="h54-0-1568" class="i">+			break;
</a><a href="#h54-0-1569" id="h54-0-1569" class="i">+		}
</a><a href="#h54-0-1570" id="h54-0-1570" class="i">+	} else {
</a><a href="#h54-0-1571" id="h54-0-1571" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h54-0-1572" id="h54-0-1572" class="i">+				borderpx + cx * win.cw,
</a><a href="#h54-0-1573" id="h54-0-1573" class="i">+				borderpx + cy * win.ch,
</a><a href="#h54-0-1574" id="h54-0-1574" class="i">+				win.cw - 1, 1);
</a><a href="#h54-0-1575" id="h54-0-1575" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h54-0-1576" id="h54-0-1576" class="i">+				borderpx + cx * win.cw,
</a><a href="#h54-0-1577" id="h54-0-1577" class="i">+				borderpx + cy * win.ch,
</a><a href="#h54-0-1578" id="h54-0-1578" class="i">+				1, win.ch - 1);
</a><a href="#h54-0-1579" id="h54-0-1579" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h54-0-1580" id="h54-0-1580" class="i">+				borderpx + (cx + 1) * win.cw - 1,
</a><a href="#h54-0-1581" id="h54-0-1581" class="i">+				borderpx + cy * win.ch,
</a><a href="#h54-0-1582" id="h54-0-1582" class="i">+				1, win.ch - 1);
</a><a href="#h54-0-1583" id="h54-0-1583" class="i">+		XftDrawRect(xw.draw, &amp;drawcol,
</a><a href="#h54-0-1584" id="h54-0-1584" class="i">+				borderpx + cx * win.cw,
</a><a href="#h54-0-1585" id="h54-0-1585" class="i">+				borderpx + (cy + 1) * win.ch - 1,
</a><a href="#h54-0-1586" id="h54-0-1586" class="i">+				win.cw, 1);
</a><a href="#h54-0-1587" id="h54-0-1587" class="i">+	}
</a><a href="#h54-0-1588" id="h54-0-1588" class="i">+}
</a><a href="#h54-0-1589" id="h54-0-1589" class="i">+
</a><a href="#h54-0-1590" id="h54-0-1590" class="i">+void
</a><a href="#h54-0-1591" id="h54-0-1591" class="i">+xsetenv(void)
</a><a href="#h54-0-1592" id="h54-0-1592" class="i">+{
</a><a href="#h54-0-1593" id="h54-0-1593" class="i">+	char buf[sizeof(long) * 8 + 1];
</a><a href="#h54-0-1594" id="h54-0-1594" class="i">+
</a><a href="#h54-0-1595" id="h54-0-1595" class="i">+	snprintf(buf, sizeof(buf), &quot;%lu&quot;, xw.win);
</a><a href="#h54-0-1596" id="h54-0-1596" class="i">+	setenv(&quot;WINDOWID&quot;, buf, 1);
</a><a href="#h54-0-1597" id="h54-0-1597" class="i">+}
</a><a href="#h54-0-1598" id="h54-0-1598" class="i">+
</a><a href="#h54-0-1599" id="h54-0-1599" class="i">+void
</a><a href="#h54-0-1600" id="h54-0-1600" class="i">+xsettitle(char *p)
</a><a href="#h54-0-1601" id="h54-0-1601" class="i">+{
</a><a href="#h54-0-1602" id="h54-0-1602" class="i">+	XTextProperty prop;
</a><a href="#h54-0-1603" id="h54-0-1603" class="i">+	DEFAULT(p, opt_title);
</a><a href="#h54-0-1604" id="h54-0-1604" class="i">+
</a><a href="#h54-0-1605" id="h54-0-1605" class="i">+	Xutf8TextListToTextProperty(xw.dpy, &amp;p, 1, XUTF8StringStyle,
</a><a href="#h54-0-1606" id="h54-0-1606" class="i">+			&amp;prop);
</a><a href="#h54-0-1607" id="h54-0-1607" class="i">+	XSetWMName(xw.dpy, xw.win, &amp;prop);
</a><a href="#h54-0-1608" id="h54-0-1608" class="i">+	XSetTextProperty(xw.dpy, xw.win, &amp;prop, xw.netwmname);
</a><a href="#h54-0-1609" id="h54-0-1609" class="i">+	XFree(prop.value);
</a><a href="#h54-0-1610" id="h54-0-1610" class="i">+}
</a><a href="#h54-0-1611" id="h54-0-1611" class="i">+
</a><a href="#h54-0-1612" id="h54-0-1612" class="i">+int
</a><a href="#h54-0-1613" id="h54-0-1613" class="i">+xstartdraw(void)
</a><a href="#h54-0-1614" id="h54-0-1614" class="i">+{
</a><a href="#h54-0-1615" id="h54-0-1615" class="i">+	return IS_SET(MODE_VISIBLE);
</a><a href="#h54-0-1616" id="h54-0-1616" class="i">+}
</a><a href="#h54-0-1617" id="h54-0-1617" class="i">+
</a><a href="#h54-0-1618" id="h54-0-1618" class="i">+void
</a><a href="#h54-0-1619" id="h54-0-1619" class="i">+xdrawline(Line line, int x1, int y1, int x2)
</a><a href="#h54-0-1620" id="h54-0-1620" class="i">+{
</a><a href="#h54-0-1621" id="h54-0-1621" class="i">+	int i, x, ox, numspecs;
</a><a href="#h54-0-1622" id="h54-0-1622" class="i">+	Glyph base, new;
</a><a href="#h54-0-1623" id="h54-0-1623" class="i">+	XftGlyphFontSpec *specs = xw.specbuf;
</a><a href="#h54-0-1624" id="h54-0-1624" class="i">+
</a><a href="#h54-0-1625" id="h54-0-1625" class="i">+	numspecs = xmakeglyphfontspecs(specs, &amp;line[x1], x2 - x1, x1, y1);
</a><a href="#h54-0-1626" id="h54-0-1626" class="i">+	i = ox = 0;
</a><a href="#h54-0-1627" id="h54-0-1627" class="i">+	for (x = x1; x &lt; x2 &amp;&amp; i &lt; numspecs; x++) {
</a><a href="#h54-0-1628" id="h54-0-1628" class="i">+		new = line[x];
</a><a href="#h54-0-1629" id="h54-0-1629" class="i">+		if (new.mode == ATTR_WDUMMY)
</a><a href="#h54-0-1630" id="h54-0-1630" class="i">+			continue;
</a><a href="#h54-0-1631" id="h54-0-1631" class="i">+		if (selected(x, y1))
</a><a href="#h54-0-1632" id="h54-0-1632" class="i">+			new.mode ^= ATTR_REVERSE;
</a><a href="#h54-0-1633" id="h54-0-1633" class="i">+		if (i &gt; 0 &amp;&amp; ATTRCMP(base, new)) {
</a><a href="#h54-0-1634" id="h54-0-1634" class="i">+			xdrawglyphfontspecs(specs, base, i, ox, y1);
</a><a href="#h54-0-1635" id="h54-0-1635" class="i">+			specs += i;
</a><a href="#h54-0-1636" id="h54-0-1636" class="i">+			numspecs -= i;
</a><a href="#h54-0-1637" id="h54-0-1637" class="i">+			i = 0;
</a><a href="#h54-0-1638" id="h54-0-1638" class="i">+		}
</a><a href="#h54-0-1639" id="h54-0-1639" class="i">+		if (i == 0) {
</a><a href="#h54-0-1640" id="h54-0-1640" class="i">+			ox = x;
</a><a href="#h54-0-1641" id="h54-0-1641" class="i">+			base = new;
</a><a href="#h54-0-1642" id="h54-0-1642" class="i">+		}
</a><a href="#h54-0-1643" id="h54-0-1643" class="i">+		i++;
</a><a href="#h54-0-1644" id="h54-0-1644" class="i">+	}
</a><a href="#h54-0-1645" id="h54-0-1645" class="i">+	if (i &gt; 0)
</a><a href="#h54-0-1646" id="h54-0-1646" class="i">+		xdrawglyphfontspecs(specs, base, i, ox, y1);
</a><a href="#h54-0-1647" id="h54-0-1647" class="i">+}
</a><a href="#h54-0-1648" id="h54-0-1648" class="i">+
</a><a href="#h54-0-1649" id="h54-0-1649" class="i">+void
</a><a href="#h54-0-1650" id="h54-0-1650" class="i">+xfinishdraw(void)
</a><a href="#h54-0-1651" id="h54-0-1651" class="i">+{
</a><a href="#h54-0-1652" id="h54-0-1652" class="i">+	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, 0, 0, win.w,
</a><a href="#h54-0-1653" id="h54-0-1653" class="i">+			win.h, 0, 0);
</a><a href="#h54-0-1654" id="h54-0-1654" class="i">+	XSetForeground(xw.dpy, dc.gc,
</a><a href="#h54-0-1655" id="h54-0-1655" class="i">+			dc.col[IS_SET(MODE_REVERSE)?
</a><a href="#h54-0-1656" id="h54-0-1656" class="i">+				defaultfg : defaultbg].pixel);
</a><a href="#h54-0-1657" id="h54-0-1657" class="i">+}
</a><a href="#h54-0-1658" id="h54-0-1658" class="i">+
</a><a href="#h54-0-1659" id="h54-0-1659" class="i">+void
</a><a href="#h54-0-1660" id="h54-0-1660" class="i">+xximspot(int x, int y)
</a><a href="#h54-0-1661" id="h54-0-1661" class="i">+{
</a><a href="#h54-0-1662" id="h54-0-1662" class="i">+	XPoint spot = { borderpx + x * win.cw, borderpx + (y + 1) * win.ch };
</a><a href="#h54-0-1663" id="h54-0-1663" class="i">+	XVaNestedList attr = XVaCreateNestedList(0, XNSpotLocation, &amp;spot, NULL);
</a><a href="#h54-0-1664" id="h54-0-1664" class="i">+
</a><a href="#h54-0-1665" id="h54-0-1665" class="i">+	XSetICValues(xw.xic, XNPreeditAttributes, attr, NULL);
</a><a href="#h54-0-1666" id="h54-0-1666" class="i">+	XFree(attr);
</a><a href="#h54-0-1667" id="h54-0-1667" class="i">+}
</a><a href="#h54-0-1668" id="h54-0-1668" class="i">+
</a><a href="#h54-0-1669" id="h54-0-1669" class="i">+void
</a><a href="#h54-0-1670" id="h54-0-1670" class="i">+expose(XEvent *ev)
</a><a href="#h54-0-1671" id="h54-0-1671" class="i">+{
</a><a href="#h54-0-1672" id="h54-0-1672" class="i">+	redraw();
</a><a href="#h54-0-1673" id="h54-0-1673" class="i">+}
</a><a href="#h54-0-1674" id="h54-0-1674" class="i">+
</a><a href="#h54-0-1675" id="h54-0-1675" class="i">+void
</a><a href="#h54-0-1676" id="h54-0-1676" class="i">+visibility(XEvent *ev)
</a><a href="#h54-0-1677" id="h54-0-1677" class="i">+{
</a><a href="#h54-0-1678" id="h54-0-1678" class="i">+	XVisibilityEvent *e = &amp;ev-&gt;xvisibility;
</a><a href="#h54-0-1679" id="h54-0-1679" class="i">+
</a><a href="#h54-0-1680" id="h54-0-1680" class="i">+	MODBIT(win.mode, e-&gt;state != VisibilityFullyObscured, MODE_VISIBLE);
</a><a href="#h54-0-1681" id="h54-0-1681" class="i">+}
</a><a href="#h54-0-1682" id="h54-0-1682" class="i">+
</a><a href="#h54-0-1683" id="h54-0-1683" class="i">+void
</a><a href="#h54-0-1684" id="h54-0-1684" class="i">+unmap(XEvent *ev)
</a><a href="#h54-0-1685" id="h54-0-1685" class="i">+{
</a><a href="#h54-0-1686" id="h54-0-1686" class="i">+	win.mode &amp;= ~MODE_VISIBLE;
</a><a href="#h54-0-1687" id="h54-0-1687" class="i">+}
</a><a href="#h54-0-1688" id="h54-0-1688" class="i">+
</a><a href="#h54-0-1689" id="h54-0-1689" class="i">+void
</a><a href="#h54-0-1690" id="h54-0-1690" class="i">+xsetpointermotion(int set)
</a><a href="#h54-0-1691" id="h54-0-1691" class="i">+{
</a><a href="#h54-0-1692" id="h54-0-1692" class="i">+	if (!set &amp;&amp; !xw.pointerisvisible)
</a><a href="#h54-0-1693" id="h54-0-1693" class="i">+		return;
</a><a href="#h54-0-1694" id="h54-0-1694" class="i">+	MODBIT(xw.attrs.event_mask, set, PointerMotionMask);
</a><a href="#h54-0-1695" id="h54-0-1695" class="i">+	XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask, &amp;xw.attrs);
</a><a href="#h54-0-1696" id="h54-0-1696" class="i">+}
</a><a href="#h54-0-1697" id="h54-0-1697" class="i">+
</a><a href="#h54-0-1698" id="h54-0-1698" class="i">+void
</a><a href="#h54-0-1699" id="h54-0-1699" class="i">+xsetmode(int set, unsigned int flags)
</a><a href="#h54-0-1700" id="h54-0-1700" class="i">+{
</a><a href="#h54-0-1701" id="h54-0-1701" class="i">+	int mode = win.mode;
</a><a href="#h54-0-1702" id="h54-0-1702" class="i">+	MODBIT(win.mode, set, flags);
</a><a href="#h54-0-1703" id="h54-0-1703" class="i">+	if ((win.mode &amp; MODE_REVERSE) != (mode &amp; MODE_REVERSE))
</a><a href="#h54-0-1704" id="h54-0-1704" class="i">+		redraw();
</a><a href="#h54-0-1705" id="h54-0-1705" class="i">+}
</a><a href="#h54-0-1706" id="h54-0-1706" class="i">+
</a><a href="#h54-0-1707" id="h54-0-1707" class="i">+int
</a><a href="#h54-0-1708" id="h54-0-1708" class="i">+xsetcursor(int cursor)
</a><a href="#h54-0-1709" id="h54-0-1709" class="i">+{
</a><a href="#h54-0-1710" id="h54-0-1710" class="i">+	DEFAULT(cursor, 1);
</a><a href="#h54-0-1711" id="h54-0-1711" class="i">+	if (!BETWEEN(cursor, 0, 6))
</a><a href="#h54-0-1712" id="h54-0-1712" class="i">+		return 1;
</a><a href="#h54-0-1713" id="h54-0-1713" class="i">+	win.cursor = cursor;
</a><a href="#h54-0-1714" id="h54-0-1714" class="i">+	return 0;
</a><a href="#h54-0-1715" id="h54-0-1715" class="i">+}
</a><a href="#h54-0-1716" id="h54-0-1716" class="i">+
</a><a href="#h54-0-1717" id="h54-0-1717" class="i">+void
</a><a href="#h54-0-1718" id="h54-0-1718" class="i">+xseturgency(int add)
</a><a href="#h54-0-1719" id="h54-0-1719" class="i">+{
</a><a href="#h54-0-1720" id="h54-0-1720" class="i">+	XWMHints *h = XGetWMHints(xw.dpy, xw.win);
</a><a href="#h54-0-1721" id="h54-0-1721" class="i">+
</a><a href="#h54-0-1722" id="h54-0-1722" class="i">+	MODBIT(h-&gt;flags, add, XUrgencyHint);
</a><a href="#h54-0-1723" id="h54-0-1723" class="i">+	XSetWMHints(xw.dpy, xw.win, h);
</a><a href="#h54-0-1724" id="h54-0-1724" class="i">+	XFree(h);
</a><a href="#h54-0-1725" id="h54-0-1725" class="i">+}
</a><a href="#h54-0-1726" id="h54-0-1726" class="i">+
</a><a href="#h54-0-1727" id="h54-0-1727" class="i">+void
</a><a href="#h54-0-1728" id="h54-0-1728" class="i">+xbell(void)
</a><a href="#h54-0-1729" id="h54-0-1729" class="i">+{
</a><a href="#h54-0-1730" id="h54-0-1730" class="i">+	if (!(IS_SET(MODE_FOCUSED)))
</a><a href="#h54-0-1731" id="h54-0-1731" class="i">+		xseturgency(1);
</a><a href="#h54-0-1732" id="h54-0-1732" class="i">+	if (bellvolume)
</a><a href="#h54-0-1733" id="h54-0-1733" class="i">+		XkbBell(xw.dpy, xw.win, bellvolume, (Atom)NULL);
</a><a href="#h54-0-1734" id="h54-0-1734" class="i">+}
</a><a href="#h54-0-1735" id="h54-0-1735" class="i">+
</a><a href="#h54-0-1736" id="h54-0-1736" class="i">+void
</a><a href="#h54-0-1737" id="h54-0-1737" class="i">+focus(XEvent *ev)
</a><a href="#h54-0-1738" id="h54-0-1738" class="i">+{
</a><a href="#h54-0-1739" id="h54-0-1739" class="i">+	XFocusChangeEvent *e = &amp;ev-&gt;xfocus;
</a><a href="#h54-0-1740" id="h54-0-1740" class="i">+
</a><a href="#h54-0-1741" id="h54-0-1741" class="i">+	if (e-&gt;mode == NotifyGrab)
</a><a href="#h54-0-1742" id="h54-0-1742" class="i">+		return;
</a><a href="#h54-0-1743" id="h54-0-1743" class="i">+
</a><a href="#h54-0-1744" id="h54-0-1744" class="i">+	if (ev-&gt;type == FocusIn) {
</a><a href="#h54-0-1745" id="h54-0-1745" class="i">+		XSetICFocus(xw.xic);
</a><a href="#h54-0-1746" id="h54-0-1746" class="i">+		win.mode |= MODE_FOCUSED;
</a><a href="#h54-0-1747" id="h54-0-1747" class="i">+		xseturgency(0);
</a><a href="#h54-0-1748" id="h54-0-1748" class="i">+		if (IS_SET(MODE_FOCUS))
</a><a href="#h54-0-1749" id="h54-0-1749" class="i">+			ttywrite(&quot;\033[I&quot;, 3, 0);
</a><a href="#h54-0-1750" id="h54-0-1750" class="i">+	} else {
</a><a href="#h54-0-1751" id="h54-0-1751" class="i">+		XUnsetICFocus(xw.xic);
</a><a href="#h54-0-1752" id="h54-0-1752" class="i">+		win.mode &amp;= ~MODE_FOCUSED;
</a><a href="#h54-0-1753" id="h54-0-1753" class="i">+		if (IS_SET(MODE_FOCUS))
</a><a href="#h54-0-1754" id="h54-0-1754" class="i">+			ttywrite(&quot;\033[O&quot;, 3, 0);
</a><a href="#h54-0-1755" id="h54-0-1755" class="i">+	}
</a><a href="#h54-0-1756" id="h54-0-1756" class="i">+}
</a><a href="#h54-0-1757" id="h54-0-1757" class="i">+
</a><a href="#h54-0-1758" id="h54-0-1758" class="i">+int
</a><a href="#h54-0-1759" id="h54-0-1759" class="i">+match(uint mask, uint state)
</a><a href="#h54-0-1760" id="h54-0-1760" class="i">+{
</a><a href="#h54-0-1761" id="h54-0-1761" class="i">+	return mask == XK_ANY_MOD || mask == (state &amp; ~ignoremod);
</a><a href="#h54-0-1762" id="h54-0-1762" class="i">+}
</a><a href="#h54-0-1763" id="h54-0-1763" class="i">+
</a><a href="#h54-0-1764" id="h54-0-1764" class="i">+char*
</a><a href="#h54-0-1765" id="h54-0-1765" class="i">+kmap(KeySym k, uint state)
</a><a href="#h54-0-1766" id="h54-0-1766" class="i">+{
</a><a href="#h54-0-1767" id="h54-0-1767" class="i">+	Key *kp;
</a><a href="#h54-0-1768" id="h54-0-1768" class="i">+	int i;
</a><a href="#h54-0-1769" id="h54-0-1769" class="i">+
</a><a href="#h54-0-1770" id="h54-0-1770" class="i">+	/* Check for mapped keys out of X11 function keys. */
</a><a href="#h54-0-1771" id="h54-0-1771" class="i">+	for (i = 0; i &lt; LEN(mappedkeys); i++) {
</a><a href="#h54-0-1772" id="h54-0-1772" class="i">+		if (mappedkeys[i] == k)
</a><a href="#h54-0-1773" id="h54-0-1773" class="i">+			break;
</a><a href="#h54-0-1774" id="h54-0-1774" class="i">+	}
</a><a href="#h54-0-1775" id="h54-0-1775" class="i">+	if (i == LEN(mappedkeys)) {
</a><a href="#h54-0-1776" id="h54-0-1776" class="i">+		if ((k &amp; 0xFFFF) &lt; 0xFD00)
</a><a href="#h54-0-1777" id="h54-0-1777" class="i">+			return NULL;
</a><a href="#h54-0-1778" id="h54-0-1778" class="i">+	}
</a><a href="#h54-0-1779" id="h54-0-1779" class="i">+
</a><a href="#h54-0-1780" id="h54-0-1780" class="i">+	for (kp = key; kp &lt; key + LEN(key); kp++) {
</a><a href="#h54-0-1781" id="h54-0-1781" class="i">+		if (kp-&gt;k != k)
</a><a href="#h54-0-1782" id="h54-0-1782" class="i">+			continue;
</a><a href="#h54-0-1783" id="h54-0-1783" class="i">+
</a><a href="#h54-0-1784" id="h54-0-1784" class="i">+		if (!match(kp-&gt;mask, state))
</a><a href="#h54-0-1785" id="h54-0-1785" class="i">+			continue;
</a><a href="#h54-0-1786" id="h54-0-1786" class="i">+
</a><a href="#h54-0-1787" id="h54-0-1787" class="i">+		if (IS_SET(MODE_APPKEYPAD) ? kp-&gt;appkey &lt; 0 : kp-&gt;appkey &gt; 0)
</a><a href="#h54-0-1788" id="h54-0-1788" class="i">+			continue;
</a><a href="#h54-0-1789" id="h54-0-1789" class="i">+		if (IS_SET(MODE_NUMLOCK) &amp;&amp; kp-&gt;appkey == 2)
</a><a href="#h54-0-1790" id="h54-0-1790" class="i">+			continue;
</a><a href="#h54-0-1791" id="h54-0-1791" class="i">+
</a><a href="#h54-0-1792" id="h54-0-1792" class="i">+		if (IS_SET(MODE_APPCURSOR) ? kp-&gt;appcursor &lt; 0 : kp-&gt;appcursor &gt; 0)
</a><a href="#h54-0-1793" id="h54-0-1793" class="i">+			continue;
</a><a href="#h54-0-1794" id="h54-0-1794" class="i">+
</a><a href="#h54-0-1795" id="h54-0-1795" class="i">+		return kp-&gt;s;
</a><a href="#h54-0-1796" id="h54-0-1796" class="i">+	}
</a><a href="#h54-0-1797" id="h54-0-1797" class="i">+
</a><a href="#h54-0-1798" id="h54-0-1798" class="i">+	return NULL;
</a><a href="#h54-0-1799" id="h54-0-1799" class="i">+}
</a><a href="#h54-0-1800" id="h54-0-1800" class="i">+
</a><a href="#h54-0-1801" id="h54-0-1801" class="i">+void
</a><a href="#h54-0-1802" id="h54-0-1802" class="i">+kpress(XEvent *ev)
</a><a href="#h54-0-1803" id="h54-0-1803" class="i">+{
</a><a href="#h54-0-1804" id="h54-0-1804" class="i">+	XKeyEvent *e = &amp;ev-&gt;xkey;
</a><a href="#h54-0-1805" id="h54-0-1805" class="i">+	KeySym ksym;
</a><a href="#h54-0-1806" id="h54-0-1806" class="i">+	char buf[32], *customkey;
</a><a href="#h54-0-1807" id="h54-0-1807" class="i">+	int len;
</a><a href="#h54-0-1808" id="h54-0-1808" class="i">+	Rune c;
</a><a href="#h54-0-1809" id="h54-0-1809" class="i">+	Status status;
</a><a href="#h54-0-1810" id="h54-0-1810" class="i">+	Shortcut *bp;
</a><a href="#h54-0-1811" id="h54-0-1811" class="i">+
</a><a href="#h54-0-1812" id="h54-0-1812" class="i">+	if (xw.pointerisvisible) {
</a><a href="#h54-0-1813" id="h54-0-1813" class="i">+		XDefineCursor(xw.dpy, xw.win, xw.bpointer);
</a><a href="#h54-0-1814" id="h54-0-1814" class="i">+		xsetpointermotion(1);
</a><a href="#h54-0-1815" id="h54-0-1815" class="i">+		xw.pointerisvisible = 0;
</a><a href="#h54-0-1816" id="h54-0-1816" class="i">+	}
</a><a href="#h54-0-1817" id="h54-0-1817" class="i">+
</a><a href="#h54-0-1818" id="h54-0-1818" class="i">+	if (IS_SET(MODE_KBDLOCK))
</a><a href="#h54-0-1819" id="h54-0-1819" class="i">+		return;
</a><a href="#h54-0-1820" id="h54-0-1820" class="i">+
</a><a href="#h54-0-1821" id="h54-0-1821" class="i">+	len = XmbLookupString(xw.xic, e, buf, sizeof buf, &amp;ksym, &amp;status);
</a><a href="#h54-0-1822" id="h54-0-1822" class="i">+	/* 1. shortcuts */
</a><a href="#h54-0-1823" id="h54-0-1823" class="i">+	for (bp = shortcuts; bp &lt; shortcuts + LEN(shortcuts); bp++) {
</a><a href="#h54-0-1824" id="h54-0-1824" class="i">+		if (ksym == bp-&gt;keysym &amp;&amp; match(bp-&gt;mod, e-&gt;state)) {
</a><a href="#h54-0-1825" id="h54-0-1825" class="i">+			bp-&gt;func(&amp;(bp-&gt;arg));
</a><a href="#h54-0-1826" id="h54-0-1826" class="i">+			return;
</a><a href="#h54-0-1827" id="h54-0-1827" class="i">+		}
</a><a href="#h54-0-1828" id="h54-0-1828" class="i">+	}
</a><a href="#h54-0-1829" id="h54-0-1829" class="i">+
</a><a href="#h54-0-1830" id="h54-0-1830" class="i">+	/* 2. custom keys from config.h */
</a><a href="#h54-0-1831" id="h54-0-1831" class="i">+	if ((customkey = kmap(ksym, e-&gt;state))) {
</a><a href="#h54-0-1832" id="h54-0-1832" class="i">+		ttywrite(customkey, strlen(customkey), 1);
</a><a href="#h54-0-1833" id="h54-0-1833" class="i">+		return;
</a><a href="#h54-0-1834" id="h54-0-1834" class="i">+	}
</a><a href="#h54-0-1835" id="h54-0-1835" class="i">+
</a><a href="#h54-0-1836" id="h54-0-1836" class="i">+	/* 3. composed string from input method */
</a><a href="#h54-0-1837" id="h54-0-1837" class="i">+	if (len == 0)
</a><a href="#h54-0-1838" id="h54-0-1838" class="i">+		return;
</a><a href="#h54-0-1839" id="h54-0-1839" class="i">+	if (len == 1 &amp;&amp; e-&gt;state &amp; Mod1Mask) {
</a><a href="#h54-0-1840" id="h54-0-1840" class="i">+		if (IS_SET(MODE_8BIT)) {
</a><a href="#h54-0-1841" id="h54-0-1841" class="i">+			if (*buf &lt; 0177) {
</a><a href="#h54-0-1842" id="h54-0-1842" class="i">+				c = *buf | 0x80;
</a><a href="#h54-0-1843" id="h54-0-1843" class="i">+				len = utf8encode(c, buf);
</a><a href="#h54-0-1844" id="h54-0-1844" class="i">+			}
</a><a href="#h54-0-1845" id="h54-0-1845" class="i">+		} else {
</a><a href="#h54-0-1846" id="h54-0-1846" class="i">+			buf[1] = buf[0];
</a><a href="#h54-0-1847" id="h54-0-1847" class="i">+			buf[0] = &#39;\033&#39;;
</a><a href="#h54-0-1848" id="h54-0-1848" class="i">+			len = 2;
</a><a href="#h54-0-1849" id="h54-0-1849" class="i">+		}
</a><a href="#h54-0-1850" id="h54-0-1850" class="i">+	}
</a><a href="#h54-0-1851" id="h54-0-1851" class="i">+	ttywrite(buf, len, 1);
</a><a href="#h54-0-1852" id="h54-0-1852" class="i">+}
</a><a href="#h54-0-1853" id="h54-0-1853" class="i">+
</a><a href="#h54-0-1854" id="h54-0-1854" class="i">+
</a><a href="#h54-0-1855" id="h54-0-1855" class="i">+void
</a><a href="#h54-0-1856" id="h54-0-1856" class="i">+cmessage(XEvent *e)
</a><a href="#h54-0-1857" id="h54-0-1857" class="i">+{
</a><a href="#h54-0-1858" id="h54-0-1858" class="i">+	/*
</a><a href="#h54-0-1859" id="h54-0-1859" class="i">+	 * See xembed specs
</a><a href="#h54-0-1860" id="h54-0-1860" class="i">+	 *  http://standards.freedesktop.org/xembed-spec/xembed-spec-latest.html
</a><a href="#h54-0-1861" id="h54-0-1861" class="i">+	 */
</a><a href="#h54-0-1862" id="h54-0-1862" class="i">+	if (e-&gt;xclient.message_type == xw.xembed &amp;&amp; e-&gt;xclient.format == 32) {
</a><a href="#h54-0-1863" id="h54-0-1863" class="i">+		if (e-&gt;xclient.data.l[1] == XEMBED_FOCUS_IN) {
</a><a href="#h54-0-1864" id="h54-0-1864" class="i">+			win.mode |= MODE_FOCUSED;
</a><a href="#h54-0-1865" id="h54-0-1865" class="i">+			xseturgency(0);
</a><a href="#h54-0-1866" id="h54-0-1866" class="i">+		} else if (e-&gt;xclient.data.l[1] == XEMBED_FOCUS_OUT) {
</a><a href="#h54-0-1867" id="h54-0-1867" class="i">+			win.mode &amp;= ~MODE_FOCUSED;
</a><a href="#h54-0-1868" id="h54-0-1868" class="i">+		}
</a><a href="#h54-0-1869" id="h54-0-1869" class="i">+	} else if (e-&gt;xclient.data.l[0] == xw.wmdeletewin) {
</a><a href="#h54-0-1870" id="h54-0-1870" class="i">+		ttyhangup();
</a><a href="#h54-0-1871" id="h54-0-1871" class="i">+		exit(0);
</a><a href="#h54-0-1872" id="h54-0-1872" class="i">+	}
</a><a href="#h54-0-1873" id="h54-0-1873" class="i">+}
</a><a href="#h54-0-1874" id="h54-0-1874" class="i">+
</a><a href="#h54-0-1875" id="h54-0-1875" class="i">+void
</a><a href="#h54-0-1876" id="h54-0-1876" class="i">+resize(XEvent *e)
</a><a href="#h54-0-1877" id="h54-0-1877" class="i">+{
</a><a href="#h54-0-1878" id="h54-0-1878" class="i">+	if (e-&gt;xconfigure.width == win.w &amp;&amp; e-&gt;xconfigure.height == win.h)
</a><a href="#h54-0-1879" id="h54-0-1879" class="i">+		return;
</a><a href="#h54-0-1880" id="h54-0-1880" class="i">+
</a><a href="#h54-0-1881" id="h54-0-1881" class="i">+	cresize(e-&gt;xconfigure.width, e-&gt;xconfigure.height);
</a><a href="#h54-0-1882" id="h54-0-1882" class="i">+}
</a><a href="#h54-0-1883" id="h54-0-1883" class="i">+
</a><a href="#h54-0-1884" id="h54-0-1884" class="i">+void
</a><a href="#h54-0-1885" id="h54-0-1885" class="i">+run(void)
</a><a href="#h54-0-1886" id="h54-0-1886" class="i">+{
</a><a href="#h54-0-1887" id="h54-0-1887" class="i">+	XEvent ev;
</a><a href="#h54-0-1888" id="h54-0-1888" class="i">+	int w = win.w, h = win.h;
</a><a href="#h54-0-1889" id="h54-0-1889" class="i">+	fd_set rfd;
</a><a href="#h54-0-1890" id="h54-0-1890" class="i">+	int xfd = XConnectionNumber(xw.dpy), xev, blinkset = 0, dodraw = 0;
</a><a href="#h54-0-1891" id="h54-0-1891" class="i">+	int ttyfd;
</a><a href="#h54-0-1892" id="h54-0-1892" class="i">+	struct timespec drawtimeout, *tv = NULL, now, last, lastblink;
</a><a href="#h54-0-1893" id="h54-0-1893" class="i">+	long deltatime;
</a><a href="#h54-0-1894" id="h54-0-1894" class="i">+
</a><a href="#h54-0-1895" id="h54-0-1895" class="i">+	/* Waiting for window mapping */
</a><a href="#h54-0-1896" id="h54-0-1896" class="i">+	do {
</a><a href="#h54-0-1897" id="h54-0-1897" class="i">+		XNextEvent(xw.dpy, &amp;ev);
</a><a href="#h54-0-1898" id="h54-0-1898" class="i">+		/*
</a><a href="#h54-0-1899" id="h54-0-1899" class="i">+		 * This XFilterEvent call is required because of XOpenIM. It
</a><a href="#h54-0-1900" id="h54-0-1900" class="i">+		 * does filter out the key event and some client message for
</a><a href="#h54-0-1901" id="h54-0-1901" class="i">+		 * the input method too.
</a><a href="#h54-0-1902" id="h54-0-1902" class="i">+		 */
</a><a href="#h54-0-1903" id="h54-0-1903" class="i">+		if (XFilterEvent(&amp;ev, None))
</a><a href="#h54-0-1904" id="h54-0-1904" class="i">+			continue;
</a><a href="#h54-0-1905" id="h54-0-1905" class="i">+		if (ev.type == ConfigureNotify) {
</a><a href="#h54-0-1906" id="h54-0-1906" class="i">+			w = ev.xconfigure.width;
</a><a href="#h54-0-1907" id="h54-0-1907" class="i">+			h = ev.xconfigure.height;
</a><a href="#h54-0-1908" id="h54-0-1908" class="i">+		}
</a><a href="#h54-0-1909" id="h54-0-1909" class="i">+	} while (ev.type != MapNotify);
</a><a href="#h54-0-1910" id="h54-0-1910" class="i">+
</a><a href="#h54-0-1911" id="h54-0-1911" class="i">+	ttyfd = ttynew(opt_line, shell, opt_io, opt_cmd);
</a><a href="#h54-0-1912" id="h54-0-1912" class="i">+	cresize(w, h);
</a><a href="#h54-0-1913" id="h54-0-1913" class="i">+
</a><a href="#h54-0-1914" id="h54-0-1914" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;last);
</a><a href="#h54-0-1915" id="h54-0-1915" class="i">+	lastblink = last;
</a><a href="#h54-0-1916" id="h54-0-1916" class="i">+
</a><a href="#h54-0-1917" id="h54-0-1917" class="i">+	for (xev = actionfps;;) {
</a><a href="#h54-0-1918" id="h54-0-1918" class="i">+		FD_ZERO(&amp;rfd);
</a><a href="#h54-0-1919" id="h54-0-1919" class="i">+		FD_SET(ttyfd, &amp;rfd);
</a><a href="#h54-0-1920" id="h54-0-1920" class="i">+		FD_SET(xfd, &amp;rfd);
</a><a href="#h54-0-1921" id="h54-0-1921" class="i">+
</a><a href="#h54-0-1922" id="h54-0-1922" class="i">+		if (pselect(MAX(xfd, ttyfd)+1, &amp;rfd, NULL, NULL, tv, NULL) &lt; 0) {
</a><a href="#h54-0-1923" id="h54-0-1923" class="i">+			if (errno == EINTR)
</a><a href="#h54-0-1924" id="h54-0-1924" class="i">+				continue;
</a><a href="#h54-0-1925" id="h54-0-1925" class="i">+			die(&quot;select failed: %s\n&quot;, strerror(errno));
</a><a href="#h54-0-1926" id="h54-0-1926" class="i">+		}
</a><a href="#h54-0-1927" id="h54-0-1927" class="i">+		if (FD_ISSET(ttyfd, &amp;rfd)) {
</a><a href="#h54-0-1928" id="h54-0-1928" class="i">+			ttyread();
</a><a href="#h54-0-1929" id="h54-0-1929" class="i">+			if (blinktimeout) {
</a><a href="#h54-0-1930" id="h54-0-1930" class="i">+				blinkset = tattrset(ATTR_BLINK);
</a><a href="#h54-0-1931" id="h54-0-1931" class="i">+				if (!blinkset)
</a><a href="#h54-0-1932" id="h54-0-1932" class="i">+					MODBIT(win.mode, 0, MODE_BLINK);
</a><a href="#h54-0-1933" id="h54-0-1933" class="i">+			}
</a><a href="#h54-0-1934" id="h54-0-1934" class="i">+		}
</a><a href="#h54-0-1935" id="h54-0-1935" class="i">+
</a><a href="#h54-0-1936" id="h54-0-1936" class="i">+		if (FD_ISSET(xfd, &amp;rfd))
</a><a href="#h54-0-1937" id="h54-0-1937" class="i">+			xev = actionfps;
</a><a href="#h54-0-1938" id="h54-0-1938" class="i">+
</a><a href="#h54-0-1939" id="h54-0-1939" class="i">+		clock_gettime(CLOCK_MONOTONIC, &amp;now);
</a><a href="#h54-0-1940" id="h54-0-1940" class="i">+		drawtimeout.tv_sec = 0;
</a><a href="#h54-0-1941" id="h54-0-1941" class="i">+		drawtimeout.tv_nsec =  (1000 * 1E6)/ xfps;
</a><a href="#h54-0-1942" id="h54-0-1942" class="i">+		tv = &amp;drawtimeout;
</a><a href="#h54-0-1943" id="h54-0-1943" class="i">+
</a><a href="#h54-0-1944" id="h54-0-1944" class="i">+		dodraw = 0;
</a><a href="#h54-0-1945" id="h54-0-1945" class="i">+		if (blinktimeout &amp;&amp; TIMEDIFF(now, lastblink) &gt; blinktimeout) {
</a><a href="#h54-0-1946" id="h54-0-1946" class="i">+			tsetdirtattr(ATTR_BLINK);
</a><a href="#h54-0-1947" id="h54-0-1947" class="i">+			win.mode ^= MODE_BLINK;
</a><a href="#h54-0-1948" id="h54-0-1948" class="i">+			lastblink = now;
</a><a href="#h54-0-1949" id="h54-0-1949" class="i">+			dodraw = 1;
</a><a href="#h54-0-1950" id="h54-0-1950" class="i">+		}
</a><a href="#h54-0-1951" id="h54-0-1951" class="i">+		deltatime = TIMEDIFF(now, last);
</a><a href="#h54-0-1952" id="h54-0-1952" class="i">+		if (deltatime &gt; 1000 / (xev ? xfps : actionfps)) {
</a><a href="#h54-0-1953" id="h54-0-1953" class="i">+			dodraw = 1;
</a><a href="#h54-0-1954" id="h54-0-1954" class="i">+			last = now;
</a><a href="#h54-0-1955" id="h54-0-1955" class="i">+		}
</a><a href="#h54-0-1956" id="h54-0-1956" class="i">+
</a><a href="#h54-0-1957" id="h54-0-1957" class="i">+		if (dodraw) {
</a><a href="#h54-0-1958" id="h54-0-1958" class="i">+			while (XPending(xw.dpy)) {
</a><a href="#h54-0-1959" id="h54-0-1959" class="i">+				XNextEvent(xw.dpy, &amp;ev);
</a><a href="#h54-0-1960" id="h54-0-1960" class="i">+				if (XFilterEvent(&amp;ev, None))
</a><a href="#h54-0-1961" id="h54-0-1961" class="i">+					continue;
</a><a href="#h54-0-1962" id="h54-0-1962" class="i">+				if (handler[ev.type])
</a><a href="#h54-0-1963" id="h54-0-1963" class="i">+					(handler[ev.type])(&amp;ev);
</a><a href="#h54-0-1964" id="h54-0-1964" class="i">+			}
</a><a href="#h54-0-1965" id="h54-0-1965" class="i">+
</a><a href="#h54-0-1966" id="h54-0-1966" class="i">+			draw();
</a><a href="#h54-0-1967" id="h54-0-1967" class="i">+			XFlush(xw.dpy);
</a><a href="#h54-0-1968" id="h54-0-1968" class="i">+
</a><a href="#h54-0-1969" id="h54-0-1969" class="i">+			if (xev &amp;&amp; !FD_ISSET(xfd, &amp;rfd))
</a><a href="#h54-0-1970" id="h54-0-1970" class="i">+				xev--;
</a><a href="#h54-0-1971" id="h54-0-1971" class="i">+			if (!FD_ISSET(ttyfd, &amp;rfd) &amp;&amp; !FD_ISSET(xfd, &amp;rfd)) {
</a><a href="#h54-0-1972" id="h54-0-1972" class="i">+				if (blinkset) {
</a><a href="#h54-0-1973" id="h54-0-1973" class="i">+					if (TIMEDIFF(now, lastblink) \
</a><a href="#h54-0-1974" id="h54-0-1974" class="i">+							&gt; blinktimeout) {
</a><a href="#h54-0-1975" id="h54-0-1975" class="i">+						drawtimeout.tv_nsec = 1000;
</a><a href="#h54-0-1976" id="h54-0-1976" class="i">+					} else {
</a><a href="#h54-0-1977" id="h54-0-1977" class="i">+						drawtimeout.tv_nsec = (1E6 * \
</a><a href="#h54-0-1978" id="h54-0-1978" class="i">+							(blinktimeout - \
</a><a href="#h54-0-1979" id="h54-0-1979" class="i">+							TIMEDIFF(now,
</a><a href="#h54-0-1980" id="h54-0-1980" class="i">+								lastblink)));
</a><a href="#h54-0-1981" id="h54-0-1981" class="i">+					}
</a><a href="#h54-0-1982" id="h54-0-1982" class="i">+					drawtimeout.tv_sec = \
</a><a href="#h54-0-1983" id="h54-0-1983" class="i">+					    drawtimeout.tv_nsec / 1E9;
</a><a href="#h54-0-1984" id="h54-0-1984" class="i">+					drawtimeout.tv_nsec %= (long)1E9;
</a><a href="#h54-0-1985" id="h54-0-1985" class="i">+				} else {
</a><a href="#h54-0-1986" id="h54-0-1986" class="i">+					tv = NULL;
</a><a href="#h54-0-1987" id="h54-0-1987" class="i">+				}
</a><a href="#h54-0-1988" id="h54-0-1988" class="i">+			}
</a><a href="#h54-0-1989" id="h54-0-1989" class="i">+		}
</a><a href="#h54-0-1990" id="h54-0-1990" class="i">+	}
</a><a href="#h54-0-1991" id="h54-0-1991" class="i">+}
</a><a href="#h54-0-1992" id="h54-0-1992" class="i">+
</a><a href="#h54-0-1993" id="h54-0-1993" class="i">+void
</a><a href="#h54-0-1994" id="h54-0-1994" class="i">+usage(void)
</a><a href="#h54-0-1995" id="h54-0-1995" class="i">+{
</a><a href="#h54-0-1996" id="h54-0-1996" class="i">+	die(&quot;usage: %s [-aiv] [-c class] [-f font] [-g geometry]&quot;
</a><a href="#h54-0-1997" id="h54-0-1997" class="i">+	    &quot; [-n name] [-o file]\n&quot;
</a><a href="#h54-0-1998" id="h54-0-1998" class="i">+	    &quot;          [-T title] [-t title] [-w windowid]&quot;
</a><a href="#h54-0-1999" id="h54-0-1999" class="i">+	    &quot; [[-e] command [args ...]]\n&quot;
</a><a href="#h54-0-2000" id="h54-0-2000" class="i">+	    &quot;       %s [-aiv] [-c class] [-f font] [-g geometry]&quot;
</a><a href="#h54-0-2001" id="h54-0-2001" class="i">+	    &quot; [-n name] [-o file]\n&quot;
</a><a href="#h54-0-2002" id="h54-0-2002" class="i">+	    &quot;          [-T title] [-t title] [-w windowid] -l line&quot;
</a><a href="#h54-0-2003" id="h54-0-2003" class="i">+	    &quot; [stty_args ...]\n&quot;, argv0, argv0);
</a><a href="#h54-0-2004" id="h54-0-2004" class="i">+}
</a><a href="#h54-0-2005" id="h54-0-2005" class="i">+
</a><a href="#h54-0-2006" id="h54-0-2006" class="i">+int
</a><a href="#h54-0-2007" id="h54-0-2007" class="i">+main(int argc, char *argv[])
</a><a href="#h54-0-2008" id="h54-0-2008" class="i">+{
</a><a href="#h54-0-2009" id="h54-0-2009" class="i">+	xw.l = xw.t = 0;
</a><a href="#h54-0-2010" id="h54-0-2010" class="i">+	xw.isfixed = False;
</a><a href="#h54-0-2011" id="h54-0-2011" class="i">+	win.cursor = cursorshape;
</a><a href="#h54-0-2012" id="h54-0-2012" class="i">+
</a><a href="#h54-0-2013" id="h54-0-2013" class="i">+	ARGBEGIN {
</a><a href="#h54-0-2014" id="h54-0-2014" class="i">+	case &#39;a&#39;:
</a><a href="#h54-0-2015" id="h54-0-2015" class="i">+		allowaltscreen = 0;
</a><a href="#h54-0-2016" id="h54-0-2016" class="i">+		break;
</a><a href="#h54-0-2017" id="h54-0-2017" class="i">+	case &#39;c&#39;:
</a><a href="#h54-0-2018" id="h54-0-2018" class="i">+		opt_class = EARGF(usage());
</a><a href="#h54-0-2019" id="h54-0-2019" class="i">+		break;
</a><a href="#h54-0-2020" id="h54-0-2020" class="i">+	case &#39;e&#39;:
</a><a href="#h54-0-2021" id="h54-0-2021" class="i">+		if (argc &gt; 0)
</a><a href="#h54-0-2022" id="h54-0-2022" class="i">+			--argc, ++argv;
</a><a href="#h54-0-2023" id="h54-0-2023" class="i">+		goto run;
</a><a href="#h54-0-2024" id="h54-0-2024" class="i">+	case &#39;f&#39;:
</a><a href="#h54-0-2025" id="h54-0-2025" class="i">+		opt_font = EARGF(usage());
</a><a href="#h54-0-2026" id="h54-0-2026" class="i">+		break;
</a><a href="#h54-0-2027" id="h54-0-2027" class="i">+	case &#39;g&#39;:
</a><a href="#h54-0-2028" id="h54-0-2028" class="i">+		xw.gm = XParseGeometry(EARGF(usage()),
</a><a href="#h54-0-2029" id="h54-0-2029" class="i">+				&amp;xw.l, &amp;xw.t, &amp;cols, &amp;rows);
</a><a href="#h54-0-2030" id="h54-0-2030" class="i">+		break;
</a><a href="#h54-0-2031" id="h54-0-2031" class="i">+	case &#39;i&#39;:
</a><a href="#h54-0-2032" id="h54-0-2032" class="i">+		xw.isfixed = 1;
</a><a href="#h54-0-2033" id="h54-0-2033" class="i">+		break;
</a><a href="#h54-0-2034" id="h54-0-2034" class="i">+	case &#39;o&#39;:
</a><a href="#h54-0-2035" id="h54-0-2035" class="i">+		opt_io = EARGF(usage());
</a><a href="#h54-0-2036" id="h54-0-2036" class="i">+		break;
</a><a href="#h54-0-2037" id="h54-0-2037" class="i">+	case &#39;l&#39;:
</a><a href="#h54-0-2038" id="h54-0-2038" class="i">+		opt_line = EARGF(usage());
</a><a href="#h54-0-2039" id="h54-0-2039" class="i">+		break;
</a><a href="#h54-0-2040" id="h54-0-2040" class="i">+	case &#39;n&#39;:
</a><a href="#h54-0-2041" id="h54-0-2041" class="i">+		opt_name = EARGF(usage());
</a><a href="#h54-0-2042" id="h54-0-2042" class="i">+		break;
</a><a href="#h54-0-2043" id="h54-0-2043" class="i">+	case &#39;t&#39;:
</a><a href="#h54-0-2044" id="h54-0-2044" class="i">+	case &#39;T&#39;:
</a><a href="#h54-0-2045" id="h54-0-2045" class="i">+		opt_title = EARGF(usage());
</a><a href="#h54-0-2046" id="h54-0-2046" class="i">+		break;
</a><a href="#h54-0-2047" id="h54-0-2047" class="i">+	case &#39;w&#39;:
</a><a href="#h54-0-2048" id="h54-0-2048" class="i">+		opt_embed = EARGF(usage());
</a><a href="#h54-0-2049" id="h54-0-2049" class="i">+		break;
</a><a href="#h54-0-2050" id="h54-0-2050" class="i">+	case &#39;v&#39;:
</a><a href="#h54-0-2051" id="h54-0-2051" class="i">+		die(&quot;%s &quot; VERSION &quot;\n&quot;, argv0);
</a><a href="#h54-0-2052" id="h54-0-2052" class="i">+		break;
</a><a href="#h54-0-2053" id="h54-0-2053" class="i">+	default:
</a><a href="#h54-0-2054" id="h54-0-2054" class="i">+		usage();
</a><a href="#h54-0-2055" id="h54-0-2055" class="i">+	} ARGEND;
</a><a href="#h54-0-2056" id="h54-0-2056" class="i">+
</a><a href="#h54-0-2057" id="h54-0-2057" class="i">+run:
</a><a href="#h54-0-2058" id="h54-0-2058" class="i">+	if (argc &gt; 0) /* eat all remaining arguments */
</a><a href="#h54-0-2059" id="h54-0-2059" class="i">+		opt_cmd = argv;
</a><a href="#h54-0-2060" id="h54-0-2060" class="i">+
</a><a href="#h54-0-2061" id="h54-0-2061" class="i">+	if (!opt_title)
</a><a href="#h54-0-2062" id="h54-0-2062" class="i">+		opt_title = (opt_line || !opt_cmd) ? &quot;st&quot; : opt_cmd[0];
</a><a href="#h54-0-2063" id="h54-0-2063" class="i">+
</a><a href="#h54-0-2064" id="h54-0-2064" class="i">+	setlocale(LC_CTYPE, &quot;&quot;);
</a><a href="#h54-0-2065" id="h54-0-2065" class="i">+	XSetLocaleModifiers(&quot;&quot;);
</a><a href="#h54-0-2066" id="h54-0-2066" class="i">+	cols = MAX(cols, 1);
</a><a href="#h54-0-2067" id="h54-0-2067" class="i">+	rows = MAX(rows, 1);
</a><a href="#h54-0-2068" id="h54-0-2068" class="i">+	tnew(cols, rows);
</a><a href="#h54-0-2069" id="h54-0-2069" class="i">+	xinit(cols, rows);
</a><a href="#h54-0-2070" id="h54-0-2070" class="i">+	xsetenv();
</a><a href="#h54-0-2071" id="h54-0-2071" class="i">+	selinit();
</a><a href="#h54-0-2072" id="h54-0-2072" class="i">+	run();
</a><a href="#h54-0-2073" id="h54-0-2073" class="i">+
</a><a href="#h54-0-2074" id="h54-0-2074" class="i">+	return 0;
</a><a href="#h54-0-2075" id="h54-0-2075" class="i">+}
</a><b>diff --git a/<a id="h55" href="../file/st/x.o.html">st/x.o</a> b/<a href="../file/st/x.o.html">st/x.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h56" href="../file/surf/FAQ.md.html">surf/FAQ.md</a> b/<a href="../file/surf/FAQ.md.html">surf/FAQ.md</a></b>
<a href="#h56-0" id="h56-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h56-0-0" id="h56-0-0" class="i">+# Frequently Asked Questions
</a><a href="#h56-0-1" id="h56-0-1" class="i">+
</a><a href="#h56-0-2" id="h56-0-2" class="i">+## Surf is starting up slowly. What might be causing this?
</a><a href="#h56-0-3" id="h56-0-3" class="i">+
</a><a href="#h56-0-4" id="h56-0-4" class="i">+The first suspect for such behaviour is the plugin handling. Run surf on
</a><a href="#h56-0-5" id="h56-0-5" class="i">+the commandline and see if there are errors because of “nspluginwrapper”
</a><a href="#h56-0-6" id="h56-0-6" class="i">+or failed RPCs to them. If that is true, go to ~/.mozilla/plugins and
</a><a href="#h56-0-7" id="h56-0-7" class="i">+try removing stale links to plugins not on your system anymore. This
</a><a href="#h56-0-8" id="h56-0-8" class="i">+will stop surf from trying to load them.
</a><a href="#h56-0-9" id="h56-0-9" class="i">+
</a><b>diff --git a/<a id="h57" href="../file/surf/LICENSE.html">surf/LICENSE</a> b/<a href="../file/surf/LICENSE.html">surf/LICENSE</a></b>
<a href="#h57-0" id="h57-0" class="h">@@ -0,0 +1,48 @@
</a><a href="#h57-0-0" id="h57-0-0" class="i">+MIT/X Consortium License
</a><a href="#h57-0-1" id="h57-0-1" class="i">+
</a><a href="#h57-0-2" id="h57-0-2" class="i">+© 2009-2010 Enno Boland &lt;tox@s01.de&gt;
</a><a href="#h57-0-3" id="h57-0-3" class="i">+© 2009 Thomas Menari &lt;spaceinvader@chaotika.org&gt;
</a><a href="#h57-0-4" id="h57-0-4" class="i">+© 2009 Simon Rozet &lt;simon@rozet.name&gt;
</a><a href="#h57-0-5" id="h57-0-5" class="i">+© 2009 Andrew Antle &lt;andrew.antle@gmail.com&gt;
</a><a href="#h57-0-6" id="h57-0-6" class="i">+© 2010-2011 pancake &lt;nopcode.org&gt;
</a><a href="#h57-0-7" id="h57-0-7" class="i">+© 2011-2013 Anselm R Garbe &lt;anselm@garbe.us&gt;
</a><a href="#h57-0-8" id="h57-0-8" class="i">+© 2011-2012 Troels Henriksen &lt;athas@sigkill.dk&gt;
</a><a href="#h57-0-9" id="h57-0-9" class="i">+© 2011 Connor Lane Smith &lt;cls@lubutu.com&gt;
</a><a href="#h57-0-10" id="h57-0-10" class="i">+© 2012-2017 Christoph Lohmann &lt;20h@r-36.net&gt;
</a><a href="#h57-0-11" id="h57-0-11" class="i">+© 2013 Shayan Pooya &lt;shayan@liveve.org&gt;
</a><a href="#h57-0-12" id="h57-0-12" class="i">+© 2013 Jens Nyberg &lt;jens.nyberg@gmail.com&gt;
</a><a href="#h57-0-13" id="h57-0-13" class="i">+© 2013 Carlos J. Torres &lt;vlaadbrain@gmail.com&gt;
</a><a href="#h57-0-14" id="h57-0-14" class="i">+© 2013 Alexander Sedov &lt;alex0player@gmail.com&gt;
</a><a href="#h57-0-15" id="h57-0-15" class="i">+© 2013 Nick White &lt;git@njw.me.uk&gt;
</a><a href="#h57-0-16" id="h57-0-16" class="i">+© 2013 David Dufberg &lt;david@dufberg.se&gt;
</a><a href="#h57-0-17" id="h57-0-17" class="i">+© 2014-2017 Quentin Rameau &lt;quinq@fifth.space&gt;
</a><a href="#h57-0-18" id="h57-0-18" class="i">+© 2014-2016 Markus Teich &lt;markus.teich@stusta.mhn.de&gt;
</a><a href="#h57-0-19" id="h57-0-19" class="i">+© 2015 Jakukyo Friel &lt;weakish@gmail.com&gt;
</a><a href="#h57-0-20" id="h57-0-20" class="i">+© 2015 Ben Woolley &lt;tautolog@gmail.com&gt;
</a><a href="#h57-0-21" id="h57-0-21" class="i">+© 2015 Greg Reagle &lt;greg.reagle@umbc.edu&gt;
</a><a href="#h57-0-22" id="h57-0-22" class="i">+© 2015 GhostAV &lt;ghostav@riseup.net&gt;
</a><a href="#h57-0-23" id="h57-0-23" class="i">+© 2015 Ivan Tham &lt;pickfire@riseup.net&gt;
</a><a href="#h57-0-24" id="h57-0-24" class="i">+© 2015 Alexander Huemer &lt;alexander.huemer@xx.vu&gt;
</a><a href="#h57-0-25" id="h57-0-25" class="i">+© 2015 Michael Stevens &lt;mstevens@etla.org&gt;
</a><a href="#h57-0-26" id="h57-0-26" class="i">+© 2015 Felix Janda &lt;felix.janda@posteo.de&gt;
</a><a href="#h57-0-27" id="h57-0-27" class="i">+© 2016 Charles Lehner &lt;cel@celehner.com&gt;
</a><a href="#h57-0-28" id="h57-0-28" class="i">+© 2016 Dmitry Bogatov &lt;KAction@gnu.org&gt;
</a><a href="#h57-0-29" id="h57-0-29" class="i">+
</a><a href="#h57-0-30" id="h57-0-30" class="i">+Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h57-0-31" id="h57-0-31" class="i">+copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h57-0-32" id="h57-0-32" class="i">+to deal in the Software without restriction, including without limitation
</a><a href="#h57-0-33" id="h57-0-33" class="i">+the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h57-0-34" id="h57-0-34" class="i">+and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h57-0-35" id="h57-0-35" class="i">+Software is furnished to do so, subject to the following conditions:
</a><a href="#h57-0-36" id="h57-0-36" class="i">+
</a><a href="#h57-0-37" id="h57-0-37" class="i">+The above copyright notice and this permission notice shall be included in
</a><a href="#h57-0-38" id="h57-0-38" class="i">+all copies or substantial portions of the Software.
</a><a href="#h57-0-39" id="h57-0-39" class="i">+
</a><a href="#h57-0-40" id="h57-0-40" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h57-0-41" id="h57-0-41" class="i">+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h57-0-42" id="h57-0-42" class="i">+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h57-0-43" id="h57-0-43" class="i">+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h57-0-44" id="h57-0-44" class="i">+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h57-0-45" id="h57-0-45" class="i">+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h57-0-46" id="h57-0-46" class="i">+DEALINGS IN THE SOFTWARE.
</a><a href="#h57-0-47" id="h57-0-47" class="i">+
</a><b>diff --git a/<a id="h58" href="../file/surf/Makefile.html">surf/Makefile</a> b/<a href="../file/surf/Makefile.html">surf/Makefile</a></b>
<a href="#h58-0" id="h58-0" class="h">@@ -0,0 +1,77 @@
</a><a href="#h58-0-0" id="h58-0-0" class="i">+# surf - simple browser
</a><a href="#h58-0-1" id="h58-0-1" class="i">+# See LICENSE file for copyright and license details.
</a><a href="#h58-0-2" id="h58-0-2" class="i">+.POSIX:
</a><a href="#h58-0-3" id="h58-0-3" class="i">+
</a><a href="#h58-0-4" id="h58-0-4" class="i">+include config.mk
</a><a href="#h58-0-5" id="h58-0-5" class="i">+
</a><a href="#h58-0-6" id="h58-0-6" class="i">+SRC = surf.c
</a><a href="#h58-0-7" id="h58-0-7" class="i">+CSRC = common.c
</a><a href="#h58-0-8" id="h58-0-8" class="i">+WEBEXTSRC = libsurf-webext.c
</a><a href="#h58-0-9" id="h58-0-9" class="i">+OBJ = $(SRC:.c=.o)
</a><a href="#h58-0-10" id="h58-0-10" class="i">+COBJ = $(CSRC:.c=.o)
</a><a href="#h58-0-11" id="h58-0-11" class="i">+WEBEXTOBJ = $(WEBEXTSRC:.c=.o)
</a><a href="#h58-0-12" id="h58-0-12" class="i">+
</a><a href="#h58-0-13" id="h58-0-13" class="i">+all: options libsurf-webext.so surf
</a><a href="#h58-0-14" id="h58-0-14" class="i">+
</a><a href="#h58-0-15" id="h58-0-15" class="i">+options:
</a><a href="#h58-0-16" id="h58-0-16" class="i">+	@echo surf build options:
</a><a href="#h58-0-17" id="h58-0-17" class="i">+	@echo &quot;CC            = $(CC)&quot;
</a><a href="#h58-0-18" id="h58-0-18" class="i">+	@echo &quot;CFLAGS        = $(SURFCFLAGS) $(CFLAGS)&quot;
</a><a href="#h58-0-19" id="h58-0-19" class="i">+	@echo &quot;WEBEXTCFLAGS  = $(WEBEXTCFLAGS) $(CFLAGS)&quot;
</a><a href="#h58-0-20" id="h58-0-20" class="i">+	@echo &quot;LDFLAGS       = $(LDFLAGS)&quot;
</a><a href="#h58-0-21" id="h58-0-21" class="i">+
</a><a href="#h58-0-22" id="h58-0-22" class="i">+.c.o:
</a><a href="#h58-0-23" id="h58-0-23" class="i">+	$(CC) $(SURFCFLAGS) $(CFLAGS) -c $&lt;
</a><a href="#h58-0-24" id="h58-0-24" class="i">+
</a><a href="#h58-0-25" id="h58-0-25" class="i">+config.h:
</a><a href="#h58-0-26" id="h58-0-26" class="i">+	cp config.def.h $@
</a><a href="#h58-0-27" id="h58-0-27" class="i">+
</a><a href="#h58-0-28" id="h58-0-28" class="i">+$(OBJ): config.h common.h config.mk
</a><a href="#h58-0-29" id="h58-0-29" class="i">+$(COBJ): config.h common.h config.mk
</a><a href="#h58-0-30" id="h58-0-30" class="i">+$(WEBEXTOBJ): config.h common.h config.mk
</a><a href="#h58-0-31" id="h58-0-31" class="i">+
</a><a href="#h58-0-32" id="h58-0-32" class="i">+$(WEBEXTOBJ): $(WEBEXTSRC)
</a><a href="#h58-0-33" id="h58-0-33" class="i">+	$(CC) $(WEBEXTCFLAGS) $(CFLAGS) -c $(WEBEXTSRC)
</a><a href="#h58-0-34" id="h58-0-34" class="i">+
</a><a href="#h58-0-35" id="h58-0-35" class="i">+libsurf-webext.so: $(WEBEXTOBJ) $(COBJ)
</a><a href="#h58-0-36" id="h58-0-36" class="i">+	$(CC) -shared -Wl,-soname,$@ $(LDFLAGS) -o $@ \
</a><a href="#h58-0-37" id="h58-0-37" class="i">+	    $(WEBEXTOBJ) $(COBJ) $(WEBEXTLIBS)
</a><a href="#h58-0-38" id="h58-0-38" class="i">+
</a><a href="#h58-0-39" id="h58-0-39" class="i">+surf: $(OBJ) $(COBJ)
</a><a href="#h58-0-40" id="h58-0-40" class="i">+	$(CC) $(SURFLDFLAGS) $(LDFLAGS) -o $@ $(OBJ) $(COBJ) $(LIBS)
</a><a href="#h58-0-41" id="h58-0-41" class="i">+
</a><a href="#h58-0-42" id="h58-0-42" class="i">+clean:
</a><a href="#h58-0-43" id="h58-0-43" class="i">+	rm -f surf $(OBJ) $(COBJ)
</a><a href="#h58-0-44" id="h58-0-44" class="i">+	rm -f libsurf-webext.so $(WEBEXTOBJ)
</a><a href="#h58-0-45" id="h58-0-45" class="i">+
</a><a href="#h58-0-46" id="h58-0-46" class="i">+distclean: clean
</a><a href="#h58-0-47" id="h58-0-47" class="i">+	rm -f config.h surf-$(VERSION).tar.gz
</a><a href="#h58-0-48" id="h58-0-48" class="i">+
</a><a href="#h58-0-49" id="h58-0-49" class="i">+dist: distclean
</a><a href="#h58-0-50" id="h58-0-50" class="i">+	mkdir -p surf-$(VERSION)
</a><a href="#h58-0-51" id="h58-0-51" class="i">+	cp -R LICENSE Makefile config.mk config.def.h README \
</a><a href="#h58-0-52" id="h58-0-52" class="i">+	    surf-open.sh arg.h TODO.md surf.png \
</a><a href="#h58-0-53" id="h58-0-53" class="i">+	    surf.1 $(SRC) $(WEBEXTSRC) surf-$(VERSION)
</a><a href="#h58-0-54" id="h58-0-54" class="i">+	tar -cf surf-$(VERSION).tar surf-$(VERSION)
</a><a href="#h58-0-55" id="h58-0-55" class="i">+	gzip surf-$(VERSION).tar
</a><a href="#h58-0-56" id="h58-0-56" class="i">+	rm -rf surf-$(VERSION)
</a><a href="#h58-0-57" id="h58-0-57" class="i">+
</a><a href="#h58-0-58" id="h58-0-58" class="i">+install: all
</a><a href="#h58-0-59" id="h58-0-59" class="i">+	mkdir -p $(DESTDIR)$(PREFIX)/bin
</a><a href="#h58-0-60" id="h58-0-60" class="i">+	cp -f surf $(DESTDIR)$(PREFIX)/bin
</a><a href="#h58-0-61" id="h58-0-61" class="i">+	chmod 755 $(DESTDIR)$(PREFIX)/bin/surf
</a><a href="#h58-0-62" id="h58-0-62" class="i">+	mkdir -p $(DESTDIR)$(LIBDIR)
</a><a href="#h58-0-63" id="h58-0-63" class="i">+	cp -f libsurf-webext.so $(DESTDIR)$(LIBDIR)
</a><a href="#h58-0-64" id="h58-0-64" class="i">+	chmod 644 $(DESTDIR)$(LIBDIR)/libsurf-webext.so
</a><a href="#h58-0-65" id="h58-0-65" class="i">+	mkdir -p $(DESTDIR)$(MANPREFIX)/man1
</a><a href="#h58-0-66" id="h58-0-66" class="i">+	sed &quot;s/VERSION/$(VERSION)/g&quot; &lt; surf.1 &gt; $(DESTDIR)$(MANPREFIX)/man1/surf.1
</a><a href="#h58-0-67" id="h58-0-67" class="i">+	chmod 644 $(DESTDIR)$(MANPREFIX)/man1/surf.1
</a><a href="#h58-0-68" id="h58-0-68" class="i">+
</a><a href="#h58-0-69" id="h58-0-69" class="i">+uninstall:
</a><a href="#h58-0-70" id="h58-0-70" class="i">+	rm -f $(DESTDIR)$(PREFIX)/bin/surf
</a><a href="#h58-0-71" id="h58-0-71" class="i">+	rm -f $(DESTDIR)$(MANPREFIX)/man1/surf.1
</a><a href="#h58-0-72" id="h58-0-72" class="i">+	rm -f $(DESTDIR)$(LIBDIR)/libsurf-webext.so
</a><a href="#h58-0-73" id="h58-0-73" class="i">+	- rmdir $(DESTDIR)$(LIBDIR)
</a><a href="#h58-0-74" id="h58-0-74" class="i">+
</a><a href="#h58-0-75" id="h58-0-75" class="i">+.SUFFIXES: .so .o .c
</a><a href="#h58-0-76" id="h58-0-76" class="i">+.PHONY: all options clean-dist clean dist install uninstall
</a><b>diff --git a/<a id="h59" href="../file/surf/README.html">surf/README</a> b/<a href="../file/surf/README.html">surf/README</a></b>
<a href="#h59-0" id="h59-0" class="h">@@ -0,0 +1,40 @@
</a><a href="#h59-0-0" id="h59-0-0" class="i">+surf - simple webkit-based browser
</a><a href="#h59-0-1" id="h59-0-1" class="i">+==================================
</a><a href="#h59-0-2" id="h59-0-2" class="i">+surf is a simple Web browser based on WebKit/GTK+.
</a><a href="#h59-0-3" id="h59-0-3" class="i">+
</a><a href="#h59-0-4" id="h59-0-4" class="i">+Requirements
</a><a href="#h59-0-5" id="h59-0-5" class="i">+------------
</a><a href="#h59-0-6" id="h59-0-6" class="i">+In order to build surf you need GTK+ and Webkit/GTK+ header files.
</a><a href="#h59-0-7" id="h59-0-7" class="i">+
</a><a href="#h59-0-8" id="h59-0-8" class="i">+In order to use the functionality of the url-bar, also install dmenu[0].
</a><a href="#h59-0-9" id="h59-0-9" class="i">+
</a><a href="#h59-0-10" id="h59-0-10" class="i">+Installation
</a><a href="#h59-0-11" id="h59-0-11" class="i">+------------
</a><a href="#h59-0-12" id="h59-0-12" class="i">+Edit config.mk to match your local setup (surf is installed into
</a><a href="#h59-0-13" id="h59-0-13" class="i">+the /usr/local namespace by default).
</a><a href="#h59-0-14" id="h59-0-14" class="i">+
</a><a href="#h59-0-15" id="h59-0-15" class="i">+Afterwards enter the following command to build and install surf (if
</a><a href="#h59-0-16" id="h59-0-16" class="i">+necessary as root):
</a><a href="#h59-0-17" id="h59-0-17" class="i">+
</a><a href="#h59-0-18" id="h59-0-18" class="i">+    make clean install
</a><a href="#h59-0-19" id="h59-0-19" class="i">+
</a><a href="#h59-0-20" id="h59-0-20" class="i">+Running surf
</a><a href="#h59-0-21" id="h59-0-21" class="i">+------------
</a><a href="#h59-0-22" id="h59-0-22" class="i">+run
</a><a href="#h59-0-23" id="h59-0-23" class="i">+	surf [URI]
</a><a href="#h59-0-24" id="h59-0-24" class="i">+
</a><a href="#h59-0-25" id="h59-0-25" class="i">+See the manpage for further options.
</a><a href="#h59-0-26" id="h59-0-26" class="i">+
</a><a href="#h59-0-27" id="h59-0-27" class="i">+Running surf in tabbed
</a><a href="#h59-0-28" id="h59-0-28" class="i">+----------------------
</a><a href="#h59-0-29" id="h59-0-29" class="i">+For running surf in tabbed[1] there is a script included in the distribution,
</a><a href="#h59-0-30" id="h59-0-30" class="i">+which is run like this:
</a><a href="#h59-0-31" id="h59-0-31" class="i">+
</a><a href="#h59-0-32" id="h59-0-32" class="i">+	surf-open.sh [URI]
</a><a href="#h59-0-33" id="h59-0-33" class="i">+
</a><a href="#h59-0-34" id="h59-0-34" class="i">+Further invocations of the script will run surf with the specified URI in this
</a><a href="#h59-0-35" id="h59-0-35" class="i">+instance of tabbed.
</a><a href="#h59-0-36" id="h59-0-36" class="i">+
</a><a href="#h59-0-37" id="h59-0-37" class="i">+[0] http://tools.suckless.org/dmenu
</a><a href="#h59-0-38" id="h59-0-38" class="i">+[1] http://tools.suckless.org/tabbed
</a><a href="#h59-0-39" id="h59-0-39" class="i">+
</a><b>diff --git a/<a id="h60" href="../file/surf/TODO.md.html">surf/TODO.md</a> b/<a href="../file/surf/TODO.md.html">surf/TODO.md</a></b>
<a href="#h60-0" id="h60-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h60-0-0" id="h60-0-0" class="i">+# TODO
</a><a href="#h60-0-1" id="h60-0-1" class="i">+
</a><a href="#h60-0-2" id="h60-0-2" class="i">+* suckless adblocking
</a><a href="#h60-0-3" id="h60-0-3" class="i">+* replace twitch() with proper gtk calls to make scrollbars reappear
</a><a href="#h60-0-4" id="h60-0-4" class="i">+* replace webkit with something sane
</a><a href="#h60-0-5" id="h60-0-5" class="i">+* add video player options
</a><a href="#h60-0-6" id="h60-0-6" class="i">+	* play in plugin
</a><a href="#h60-0-7" id="h60-0-7" class="i">+	* play in video player
</a><a href="#h60-0-8" id="h60-0-8" class="i">+	* call command with URI (quvi + cclive)
</a><a href="#h60-0-9" id="h60-0-9" class="i">+
</a><b>diff --git a/<a id="h61" href="../file/surf/arg.h.html">surf/arg.h</a> b/<a href="../file/surf/arg.h.html">surf/arg.h</a></b>
<a href="#h61-0" id="h61-0" class="h">@@ -0,0 +1,48 @@
</a><a href="#h61-0-0" id="h61-0-0" class="i">+/*
</a><a href="#h61-0-1" id="h61-0-1" class="i">+ * Copy me if you can.
</a><a href="#h61-0-2" id="h61-0-2" class="i">+ * by 20h
</a><a href="#h61-0-3" id="h61-0-3" class="i">+ */
</a><a href="#h61-0-4" id="h61-0-4" class="i">+
</a><a href="#h61-0-5" id="h61-0-5" class="i">+#ifndef ARG_H__
</a><a href="#h61-0-6" id="h61-0-6" class="i">+#define ARG_H__
</a><a href="#h61-0-7" id="h61-0-7" class="i">+
</a><a href="#h61-0-8" id="h61-0-8" class="i">+extern char *argv0;
</a><a href="#h61-0-9" id="h61-0-9" class="i">+
</a><a href="#h61-0-10" id="h61-0-10" class="i">+/* use main(int argc, char *argv[]) */
</a><a href="#h61-0-11" id="h61-0-11" class="i">+#define ARGBEGIN	for (argv0 = *argv, argv++, argc--;\
</a><a href="#h61-0-12" id="h61-0-12" class="i">+					argv[0] &amp;&amp; argv[0][0] == &#39;-&#39;\
</a><a href="#h61-0-13" id="h61-0-13" class="i">+					&amp;&amp; argv[0][1];\
</a><a href="#h61-0-14" id="h61-0-14" class="i">+					argc--, argv++) {\
</a><a href="#h61-0-15" id="h61-0-15" class="i">+				char argc_;\
</a><a href="#h61-0-16" id="h61-0-16" class="i">+				char **argv_;\
</a><a href="#h61-0-17" id="h61-0-17" class="i">+				int brk_;\
</a><a href="#h61-0-18" id="h61-0-18" class="i">+				if (argv[0][1] == &#39;-&#39; &amp;&amp; argv[0][2] == &#39;\0&#39;) {\
</a><a href="#h61-0-19" id="h61-0-19" class="i">+					argv++;\
</a><a href="#h61-0-20" id="h61-0-20" class="i">+					argc--;\
</a><a href="#h61-0-21" id="h61-0-21" class="i">+					break;\
</a><a href="#h61-0-22" id="h61-0-22" class="i">+				}\
</a><a href="#h61-0-23" id="h61-0-23" class="i">+				for (brk_ = 0, argv[0]++, argv_ = argv;\
</a><a href="#h61-0-24" id="h61-0-24" class="i">+						argv[0][0] &amp;&amp; !brk_;\
</a><a href="#h61-0-25" id="h61-0-25" class="i">+						argv[0]++) {\
</a><a href="#h61-0-26" id="h61-0-26" class="i">+					if (argv_ != argv)\
</a><a href="#h61-0-27" id="h61-0-27" class="i">+						break;\
</a><a href="#h61-0-28" id="h61-0-28" class="i">+					argc_ = argv[0][0];\
</a><a href="#h61-0-29" id="h61-0-29" class="i">+					switch (argc_)
</a><a href="#h61-0-30" id="h61-0-30" class="i">+#define ARGEND			}\
</a><a href="#h61-0-31" id="h61-0-31" class="i">+			}
</a><a href="#h61-0-32" id="h61-0-32" class="i">+
</a><a href="#h61-0-33" id="h61-0-33" class="i">+#define ARGC()		argc_
</a><a href="#h61-0-34" id="h61-0-34" class="i">+
</a><a href="#h61-0-35" id="h61-0-35" class="i">+#define EARGF(x)	((argv[0][1] == &#39;\0&#39; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h61-0-36" id="h61-0-36" class="i">+				((x), abort(), (char *)0) :\
</a><a href="#h61-0-37" id="h61-0-37" class="i">+				(brk_ = 1, (argv[0][1] != &#39;\0&#39;)?\
</a><a href="#h61-0-38" id="h61-0-38" class="i">+					(&amp;argv[0][1]) :\
</a><a href="#h61-0-39" id="h61-0-39" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h61-0-40" id="h61-0-40" class="i">+
</a><a href="#h61-0-41" id="h61-0-41" class="i">+#define ARGF()		((argv[0][1] == &#39;\0&#39; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h61-0-42" id="h61-0-42" class="i">+				(char *)0 :\
</a><a href="#h61-0-43" id="h61-0-43" class="i">+				(brk_ = 1, (argv[0][1] != &#39;\0&#39;)?\
</a><a href="#h61-0-44" id="h61-0-44" class="i">+					(&amp;argv[0][1]) :\
</a><a href="#h61-0-45" id="h61-0-45" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h61-0-46" id="h61-0-46" class="i">+
</a><a href="#h61-0-47" id="h61-0-47" class="i">+#endif
</a><b>diff --git a/<a id="h62" href="../file/surf/common.c.html">surf/common.c</a> b/<a href="../file/surf/common.c.html">surf/common.c</a></b>
<a href="#h62-0" id="h62-0" class="h">@@ -0,0 +1,15 @@
</a><a href="#h62-0-0" id="h62-0-0" class="i">+#include &lt;stdarg.h&gt;
</a><a href="#h62-0-1" id="h62-0-1" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h62-0-2" id="h62-0-2" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h62-0-3" id="h62-0-3" class="i">+
</a><a href="#h62-0-4" id="h62-0-4" class="i">+void
</a><a href="#h62-0-5" id="h62-0-5" class="i">+die(const char *errstr, ...)
</a><a href="#h62-0-6" id="h62-0-6" class="i">+{
</a><a href="#h62-0-7" id="h62-0-7" class="i">+	va_list ap;
</a><a href="#h62-0-8" id="h62-0-8" class="i">+
</a><a href="#h62-0-9" id="h62-0-9" class="i">+	va_start(ap, errstr);
</a><a href="#h62-0-10" id="h62-0-10" class="i">+	vfprintf(stderr, errstr, ap);
</a><a href="#h62-0-11" id="h62-0-11" class="i">+	va_end(ap);
</a><a href="#h62-0-12" id="h62-0-12" class="i">+	exit(1);
</a><a href="#h62-0-13" id="h62-0-13" class="i">+}
</a><a href="#h62-0-14" id="h62-0-14" class="i">+
</a><b>diff --git a/<a id="h63" href="../file/surf/common.h.html">surf/common.h</a> b/<a href="../file/surf/common.h.html">surf/common.h</a></b>
<a href="#h63-0" id="h63-0" class="h">@@ -0,0 +1,3 @@
</a><a href="#h63-0-0" id="h63-0-0" class="i">+#define MSGBUFSZ 8
</a><a href="#h63-0-1" id="h63-0-1" class="i">+
</a><a href="#h63-0-2" id="h63-0-2" class="i">+void die(char *, ...);
</a><b>diff --git a/<a id="h64" href="../file/surf/common.o.html">surf/common.o</a> b/<a href="../file/surf/common.o.html">surf/common.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h65" href="../file/surf/config.def.h.html">surf/config.def.h</a> b/<a href="../file/surf/config.def.h.html">surf/config.def.h</a></b>
<a href="#h65-0" id="h65-0" class="h">@@ -0,0 +1,197 @@
</a><a href="#h65-0-0" id="h65-0-0" class="i">+/* modifier 0 means no modifier */
</a><a href="#h65-0-1" id="h65-0-1" class="i">+static int surfuseragent    = 1;  /* Append Surf version to default WebKit user agent */
</a><a href="#h65-0-2" id="h65-0-2" class="i">+static char *fulluseragent  = &quot;&quot;; /* Or override the whole user agent string */
</a><a href="#h65-0-3" id="h65-0-3" class="i">+static char *scriptfile     = &quot;~/.surf/script.js&quot;;
</a><a href="#h65-0-4" id="h65-0-4" class="i">+static char *styledir       = &quot;~/.surf/styles/&quot;;
</a><a href="#h65-0-5" id="h65-0-5" class="i">+static char *certdir        = &quot;~/.surf/certificates/&quot;;
</a><a href="#h65-0-6" id="h65-0-6" class="i">+static char *cachedir       = &quot;~/.surf/cache/&quot;;
</a><a href="#h65-0-7" id="h65-0-7" class="i">+static char *cookiefile     = &quot;~/.surf/cookies.txt&quot;;
</a><a href="#h65-0-8" id="h65-0-8" class="i">+
</a><a href="#h65-0-9" id="h65-0-9" class="i">+/* Webkit default features */
</a><a href="#h65-0-10" id="h65-0-10" class="i">+/* Highest priority value will be used.
</a><a href="#h65-0-11" id="h65-0-11" class="i">+ * Default parameters are priority 0
</a><a href="#h65-0-12" id="h65-0-12" class="i">+ * Per-uri parameters are priority 1
</a><a href="#h65-0-13" id="h65-0-13" class="i">+ * Command parameters are priority 2
</a><a href="#h65-0-14" id="h65-0-14" class="i">+ */
</a><a href="#h65-0-15" id="h65-0-15" class="i">+static Parameter defconfig[ParameterLast] = {
</a><a href="#h65-0-16" id="h65-0-16" class="i">+	/* parameter                    Arg value       priority */
</a><a href="#h65-0-17" id="h65-0-17" class="i">+	[AcceleratedCanvas]   =       { { .i = 1 },     },
</a><a href="#h65-0-18" id="h65-0-18" class="i">+	[AccessMicrophone]    =       { { .i = 0 },     },
</a><a href="#h65-0-19" id="h65-0-19" class="i">+	[AccessWebcam]        =       { { .i = 0 },     },
</a><a href="#h65-0-20" id="h65-0-20" class="i">+	[Certificate]         =       { { .i = 0 },     },
</a><a href="#h65-0-21" id="h65-0-21" class="i">+	[CaretBrowsing]       =       { { .i = 0 },     },
</a><a href="#h65-0-22" id="h65-0-22" class="i">+	[CookiePolicies]      =       { { .v = &quot;@Aa&quot; }, },
</a><a href="#h65-0-23" id="h65-0-23" class="i">+	[DefaultCharset]      =       { { .v = &quot;UTF-8&quot; }, },
</a><a href="#h65-0-24" id="h65-0-24" class="i">+	[DiskCache]           =       { { .i = 1 },     },
</a><a href="#h65-0-25" id="h65-0-25" class="i">+	[DNSPrefetch]         =       { { .i = 0 },     },
</a><a href="#h65-0-26" id="h65-0-26" class="i">+	[FileURLsCrossAccess] =       { { .i = 0 },     },
</a><a href="#h65-0-27" id="h65-0-27" class="i">+	[FontSize]            =       { { .i = 12 },    },
</a><a href="#h65-0-28" id="h65-0-28" class="i">+	[FrameFlattening]     =       { { .i = 0 },     },
</a><a href="#h65-0-29" id="h65-0-29" class="i">+	[Geolocation]         =       { { .i = 0 },     },
</a><a href="#h65-0-30" id="h65-0-30" class="i">+	[HideBackground]      =       { { .i = 0 },     },
</a><a href="#h65-0-31" id="h65-0-31" class="i">+	[Inspector]           =       { { .i = 0 },     },
</a><a href="#h65-0-32" id="h65-0-32" class="i">+	[Java]                =       { { .i = 1 },     },
</a><a href="#h65-0-33" id="h65-0-33" class="i">+	[JavaScript]          =       { { .i = 1 },     },
</a><a href="#h65-0-34" id="h65-0-34" class="i">+	[KioskMode]           =       { { .i = 0 },     },
</a><a href="#h65-0-35" id="h65-0-35" class="i">+	[LoadImages]          =       { { .i = 1 },     },
</a><a href="#h65-0-36" id="h65-0-36" class="i">+	[MediaManualPlay]     =       { { .i = 1 },     },
</a><a href="#h65-0-37" id="h65-0-37" class="i">+	[Plugins]             =       { { .i = 1 },     },
</a><a href="#h65-0-38" id="h65-0-38" class="i">+	[PreferredLanguages]  =       { { .v = (char *[]){ NULL } }, },
</a><a href="#h65-0-39" id="h65-0-39" class="i">+	[RunInFullscreen]     =       { { .i = 0 },     },
</a><a href="#h65-0-40" id="h65-0-40" class="i">+	[ScrollBars]          =       { { .i = 1 },     },
</a><a href="#h65-0-41" id="h65-0-41" class="i">+	[ShowIndicators]      =       { { .i = 1 },     },
</a><a href="#h65-0-42" id="h65-0-42" class="i">+	[SiteQuirks]          =       { { .i = 1 },     },
</a><a href="#h65-0-43" id="h65-0-43" class="i">+	[SmoothScrolling]     =       { { .i = 0 },     },
</a><a href="#h65-0-44" id="h65-0-44" class="i">+	[SpellChecking]       =       { { .i = 0 },     },
</a><a href="#h65-0-45" id="h65-0-45" class="i">+	[SpellLanguages]      =       { { .v = ((char *[]){ &quot;en_US&quot;, NULL }) }, },
</a><a href="#h65-0-46" id="h65-0-46" class="i">+	[StrictTLS]           =       { { .i = 1 },     },
</a><a href="#h65-0-47" id="h65-0-47" class="i">+	[Style]               =       { { .i = 1 },     },
</a><a href="#h65-0-48" id="h65-0-48" class="i">+	[WebGL]               =       { { .i = 0 },     },
</a><a href="#h65-0-49" id="h65-0-49" class="i">+	[ZoomLevel]           =       { { .f = 1.0 },   },
</a><a href="#h65-0-50" id="h65-0-50" class="i">+};
</a><a href="#h65-0-51" id="h65-0-51" class="i">+
</a><a href="#h65-0-52" id="h65-0-52" class="i">+static UriParameters uriparams[] = {
</a><a href="#h65-0-53" id="h65-0-53" class="i">+	{ &quot;(://|\\.)suckless\\.org(/|$)&quot;, {
</a><a href="#h65-0-54" id="h65-0-54" class="i">+	  [JavaScript] = { { .i = 0 }, 1 },
</a><a href="#h65-0-55" id="h65-0-55" class="i">+	  [Plugins]    = { { .i = 0 }, 1 },
</a><a href="#h65-0-56" id="h65-0-56" class="i">+	}, },
</a><a href="#h65-0-57" id="h65-0-57" class="i">+};
</a><a href="#h65-0-58" id="h65-0-58" class="i">+
</a><a href="#h65-0-59" id="h65-0-59" class="i">+/* default window size: width, height */
</a><a href="#h65-0-60" id="h65-0-60" class="i">+static int winsize[] = { 800, 600 };
</a><a href="#h65-0-61" id="h65-0-61" class="i">+
</a><a href="#h65-0-62" id="h65-0-62" class="i">+static WebKitFindOptions findopts = WEBKIT_FIND_OPTIONS_CASE_INSENSITIVE |
</a><a href="#h65-0-63" id="h65-0-63" class="i">+                                    WEBKIT_FIND_OPTIONS_WRAP_AROUND;
</a><a href="#h65-0-64" id="h65-0-64" class="i">+
</a><a href="#h65-0-65" id="h65-0-65" class="i">+#define PROMPT_GO   &quot;Go:&quot;
</a><a href="#h65-0-66" id="h65-0-66" class="i">+#define PROMPT_FIND &quot;Find:&quot;
</a><a href="#h65-0-67" id="h65-0-67" class="i">+
</a><a href="#h65-0-68" id="h65-0-68" class="i">+/* SETPROP(readprop, setprop, prompt)*/
</a><a href="#h65-0-69" id="h65-0-69" class="i">+#define SETPROP(r, s, p) { \
</a><a href="#h65-0-70" id="h65-0-70" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h65-0-71" id="h65-0-71" class="i">+             &quot;prop=\&quot;$(printf &#39;%b&#39; \&quot;$(xprop -id $1 $2 &quot; \
</a><a href="#h65-0-72" id="h65-0-72" class="i">+             &quot;| sed \&quot;s/^$2(STRING) = //;s/^\\\&quot;\\(.*\\)\\\&quot;$/\\1/\&quot;)\&quot; &quot; \
</a><a href="#h65-0-73" id="h65-0-73" class="i">+             &quot;| dmenu -p \&quot;$4\&quot; -w $1)\&quot; &amp;&amp; xprop -id $1 -f $3 8s -set $3 \&quot;$prop\&quot;&quot;, \
</a><a href="#h65-0-74" id="h65-0-74" class="i">+             &quot;surf-setprop&quot;, winid, r, s, p, NULL \
</a><a href="#h65-0-75" id="h65-0-75" class="i">+        } \
</a><a href="#h65-0-76" id="h65-0-76" class="i">+}
</a><a href="#h65-0-77" id="h65-0-77" class="i">+
</a><a href="#h65-0-78" id="h65-0-78" class="i">+/* DOWNLOAD(URI, referer) */
</a><a href="#h65-0-79" id="h65-0-79" class="i">+#define DOWNLOAD(u, r) { \
</a><a href="#h65-0-80" id="h65-0-80" class="i">+        .v = (const char *[]){ &quot;st&quot;, &quot;-e&quot;, &quot;/bin/sh&quot;, &quot;-c&quot;,\
</a><a href="#h65-0-81" id="h65-0-81" class="i">+             &quot;curl -g -L -J -O -A \&quot;$1\&quot; -b \&quot;$2\&quot; -c \&quot;$2\&quot;&quot; \
</a><a href="#h65-0-82" id="h65-0-82" class="i">+             &quot; -e \&quot;$3\&quot; \&quot;$4\&quot;; read&quot;, \
</a><a href="#h65-0-83" id="h65-0-83" class="i">+             &quot;surf-download&quot;, useragent, cookiefile, r, u, NULL \
</a><a href="#h65-0-84" id="h65-0-84" class="i">+        } \
</a><a href="#h65-0-85" id="h65-0-85" class="i">+}
</a><a href="#h65-0-86" id="h65-0-86" class="i">+
</a><a href="#h65-0-87" id="h65-0-87" class="i">+/* PLUMB(URI) */
</a><a href="#h65-0-88" id="h65-0-88" class="i">+/* This called when some URI which does not begin with &quot;about:&quot;,
</a><a href="#h65-0-89" id="h65-0-89" class="i">+ * &quot;http://&quot; or &quot;https://&quot; should be opened.
</a><a href="#h65-0-90" id="h65-0-90" class="i">+ */
</a><a href="#h65-0-91" id="h65-0-91" class="i">+#define PLUMB(u) {\
</a><a href="#h65-0-92" id="h65-0-92" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h65-0-93" id="h65-0-93" class="i">+             &quot;xdg-open \&quot;$0\&quot;&quot;, u, NULL \
</a><a href="#h65-0-94" id="h65-0-94" class="i">+        } \
</a><a href="#h65-0-95" id="h65-0-95" class="i">+}
</a><a href="#h65-0-96" id="h65-0-96" class="i">+
</a><a href="#h65-0-97" id="h65-0-97" class="i">+/* VIDEOPLAY(URI) */
</a><a href="#h65-0-98" id="h65-0-98" class="i">+#define VIDEOPLAY(u) {\
</a><a href="#h65-0-99" id="h65-0-99" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h65-0-100" id="h65-0-100" class="i">+             &quot;mpv --really-quiet \&quot;$0\&quot;&quot;, u, NULL \
</a><a href="#h65-0-101" id="h65-0-101" class="i">+        } \
</a><a href="#h65-0-102" id="h65-0-102" class="i">+}
</a><a href="#h65-0-103" id="h65-0-103" class="i">+
</a><a href="#h65-0-104" id="h65-0-104" class="i">+/* styles */
</a><a href="#h65-0-105" id="h65-0-105" class="i">+/*
</a><a href="#h65-0-106" id="h65-0-106" class="i">+ * The iteration will stop at the first match, beginning at the beginning of
</a><a href="#h65-0-107" id="h65-0-107" class="i">+ * the list.
</a><a href="#h65-0-108" id="h65-0-108" class="i">+ */
</a><a href="#h65-0-109" id="h65-0-109" class="i">+static SiteSpecific styles[] = {
</a><a href="#h65-0-110" id="h65-0-110" class="i">+	/* regexp               file in $styledir */
</a><a href="#h65-0-111" id="h65-0-111" class="i">+	{ &quot;.*&quot;,                 &quot;default.css&quot; },
</a><a href="#h65-0-112" id="h65-0-112" class="i">+};
</a><a href="#h65-0-113" id="h65-0-113" class="i">+
</a><a href="#h65-0-114" id="h65-0-114" class="i">+/* certificates */
</a><a href="#h65-0-115" id="h65-0-115" class="i">+/*
</a><a href="#h65-0-116" id="h65-0-116" class="i">+ * Provide custom certificate for urls
</a><a href="#h65-0-117" id="h65-0-117" class="i">+ */
</a><a href="#h65-0-118" id="h65-0-118" class="i">+static SiteSpecific certs[] = {
</a><a href="#h65-0-119" id="h65-0-119" class="i">+	/* regexp               file in $certdir */
</a><a href="#h65-0-120" id="h65-0-120" class="i">+	{ &quot;://suckless\\.org/&quot;, &quot;suckless.org.crt&quot; },
</a><a href="#h65-0-121" id="h65-0-121" class="i">+};
</a><a href="#h65-0-122" id="h65-0-122" class="i">+
</a><a href="#h65-0-123" id="h65-0-123" class="i">+#define MODKEY GDK_CONTROL_MASK
</a><a href="#h65-0-124" id="h65-0-124" class="i">+
</a><a href="#h65-0-125" id="h65-0-125" class="i">+/* hotkeys */
</a><a href="#h65-0-126" id="h65-0-126" class="i">+/*
</a><a href="#h65-0-127" id="h65-0-127" class="i">+ * If you use anything else but MODKEY and GDK_SHIFT_MASK, don&#39;t forget to
</a><a href="#h65-0-128" id="h65-0-128" class="i">+ * edit the CLEANMASK() macro.
</a><a href="#h65-0-129" id="h65-0-129" class="i">+ */
</a><a href="#h65-0-130" id="h65-0-130" class="i">+static Key keys[] = {
</a><a href="#h65-0-131" id="h65-0-131" class="i">+	/* modifier              keyval          function    arg */
</a><a href="#h65-0-132" id="h65-0-132" class="i">+	{ MODKEY,                GDK_KEY_g,      spawn,      SETPROP(&quot;_SURF_URI&quot;, &quot;_SURF_GO&quot;, PROMPT_GO) },
</a><a href="#h65-0-133" id="h65-0-133" class="i">+	{ MODKEY,                GDK_KEY_f,      spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;, PROMPT_FIND) },
</a><a href="#h65-0-134" id="h65-0-134" class="i">+	{ MODKEY,                GDK_KEY_slash,  spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;, PROMPT_FIND) },
</a><a href="#h65-0-135" id="h65-0-135" class="i">+
</a><a href="#h65-0-136" id="h65-0-136" class="i">+	{ 0,                     GDK_KEY_Escape, stop,       { 0 } },
</a><a href="#h65-0-137" id="h65-0-137" class="i">+	{ MODKEY,                GDK_KEY_c,      stop,       { 0 } },
</a><a href="#h65-0-138" id="h65-0-138" class="i">+
</a><a href="#h65-0-139" id="h65-0-139" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_r,      reload,     { .i = 1 } },
</a><a href="#h65-0-140" id="h65-0-140" class="i">+	{ MODKEY,                GDK_KEY_r,      reload,     { .i = 0 } },
</a><a href="#h65-0-141" id="h65-0-141" class="i">+
</a><a href="#h65-0-142" id="h65-0-142" class="i">+	{ MODKEY,                GDK_KEY_l,      navigate,   { .i = +1 } },
</a><a href="#h65-0-143" id="h65-0-143" class="i">+	{ MODKEY,                GDK_KEY_h,      navigate,   { .i = -1 } },
</a><a href="#h65-0-144" id="h65-0-144" class="i">+
</a><a href="#h65-0-145" id="h65-0-145" class="i">+	/* vertical and horizontal scrolling, in viewport percentage */
</a><a href="#h65-0-146" id="h65-0-146" class="i">+	{ MODKEY,                GDK_KEY_j,      scrollv,    { .i = +10 } },
</a><a href="#h65-0-147" id="h65-0-147" class="i">+	{ MODKEY,                GDK_KEY_k,      scrollv,    { .i = -10 } },
</a><a href="#h65-0-148" id="h65-0-148" class="i">+	{ MODKEY,                GDK_KEY_space,  scrollv,    { .i = +50 } },
</a><a href="#h65-0-149" id="h65-0-149" class="i">+	{ MODKEY,                GDK_KEY_b,      scrollv,    { .i = -50 } },
</a><a href="#h65-0-150" id="h65-0-150" class="i">+	{ MODKEY,                GDK_KEY_i,      scrollh,    { .i = +10 } },
</a><a href="#h65-0-151" id="h65-0-151" class="i">+	{ MODKEY,                GDK_KEY_u,      scrollh,    { .i = -10 } },
</a><a href="#h65-0-152" id="h65-0-152" class="i">+
</a><a href="#h65-0-153" id="h65-0-153" class="i">+
</a><a href="#h65-0-154" id="h65-0-154" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_j,      zoom,       { .i = -1 } },
</a><a href="#h65-0-155" id="h65-0-155" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_k,      zoom,       { .i = +1 } },
</a><a href="#h65-0-156" id="h65-0-156" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_q,      zoom,       { .i = 0  } },
</a><a href="#h65-0-157" id="h65-0-157" class="i">+	{ MODKEY,                GDK_KEY_minus,  zoom,       { .i = -1 } },
</a><a href="#h65-0-158" id="h65-0-158" class="i">+	{ MODKEY,                GDK_KEY_plus,   zoom,       { .i = +1 } },
</a><a href="#h65-0-159" id="h65-0-159" class="i">+
</a><a href="#h65-0-160" id="h65-0-160" class="i">+	{ MODKEY,                GDK_KEY_p,      clipboard,  { .i = 1 } },
</a><a href="#h65-0-161" id="h65-0-161" class="i">+	{ MODKEY,                GDK_KEY_y,      clipboard,  { .i = 0 } },
</a><a href="#h65-0-162" id="h65-0-162" class="i">+
</a><a href="#h65-0-163" id="h65-0-163" class="i">+	{ MODKEY,                GDK_KEY_n,      find,       { .i = +1 } },
</a><a href="#h65-0-164" id="h65-0-164" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_n,      find,       { .i = -1 } },
</a><a href="#h65-0-165" id="h65-0-165" class="i">+
</a><a href="#h65-0-166" id="h65-0-166" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_p,      print,      { 0 } },
</a><a href="#h65-0-167" id="h65-0-167" class="i">+	{ MODKEY,                GDK_KEY_t,      showcert,   { 0 } },
</a><a href="#h65-0-168" id="h65-0-168" class="i">+
</a><a href="#h65-0-169" id="h65-0-169" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_a,      togglecookiepolicy, { 0 } },
</a><a href="#h65-0-170" id="h65-0-170" class="i">+	{ 0,                     GDK_KEY_F11,    togglefullscreen, { 0 } },
</a><a href="#h65-0-171" id="h65-0-171" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_o,      toggleinspector, { 0 } },
</a><a href="#h65-0-172" id="h65-0-172" class="i">+
</a><a href="#h65-0-173" id="h65-0-173" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_c,      toggle,     { .i = CaretBrowsing } },
</a><a href="#h65-0-174" id="h65-0-174" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_f,      toggle,     { .i = FrameFlattening } },
</a><a href="#h65-0-175" id="h65-0-175" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_g,      toggle,     { .i = Geolocation } },
</a><a href="#h65-0-176" id="h65-0-176" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_s,      toggle,     { .i = JavaScript } },
</a><a href="#h65-0-177" id="h65-0-177" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_i,      toggle,     { .i = LoadImages } },
</a><a href="#h65-0-178" id="h65-0-178" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_v,      toggle,     { .i = Plugins } },
</a><a href="#h65-0-179" id="h65-0-179" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_b,      toggle,     { .i = ScrollBars } },
</a><a href="#h65-0-180" id="h65-0-180" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_t,      toggle,     { .i = StrictTLS } },
</a><a href="#h65-0-181" id="h65-0-181" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_m,      toggle,     { .i = Style } },
</a><a href="#h65-0-182" id="h65-0-182" class="i">+};
</a><a href="#h65-0-183" id="h65-0-183" class="i">+
</a><a href="#h65-0-184" id="h65-0-184" class="i">+/* button definitions */
</a><a href="#h65-0-185" id="h65-0-185" class="i">+/* target can be OnDoc, OnLink, OnImg, OnMedia, OnEdit, OnBar, OnSel, OnAny */
</a><a href="#h65-0-186" id="h65-0-186" class="i">+static Button buttons[] = {
</a><a href="#h65-0-187" id="h65-0-187" class="i">+	/* target       event mask      button  function        argument        stop event */
</a><a href="#h65-0-188" id="h65-0-188" class="i">+	{ OnLink,       0,              2,      clicknewwindow, { .i = 0 },     1 },
</a><a href="#h65-0-189" id="h65-0-189" class="i">+	{ OnLink,       MODKEY,         2,      clicknewwindow, { .i = 1 },     1 },
</a><a href="#h65-0-190" id="h65-0-190" class="i">+	{ OnLink,       MODKEY,         1,      clicknewwindow, { .i = 1 },     1 },
</a><a href="#h65-0-191" id="h65-0-191" class="i">+	{ OnAny,        0,              8,      clicknavigate,  { .i = -1 },    1 },
</a><a href="#h65-0-192" id="h65-0-192" class="i">+	{ OnAny,        0,              9,      clicknavigate,  { .i = +1 },    1 },
</a><a href="#h65-0-193" id="h65-0-193" class="i">+	{ OnMedia,      MODKEY,         1,      clickexternplayer, { 0 },       1 },
</a><a href="#h65-0-194" id="h65-0-194" class="i">+};
</a><a href="#h65-0-195" id="h65-0-195" class="i">+
</a><a href="#h65-0-196" id="h65-0-196" class="i">+#define HOMEPAGE &quot;https://duckduckgo.com/&quot;
</a><b>diff --git a/<a id="h66" href="../file/surf/config.def.h.orig.html">surf/config.def.h.orig</a> b/<a href="../file/surf/config.def.h.orig.html">surf/config.def.h.orig</a></b>
<a href="#h66-0" id="h66-0" class="h">@@ -0,0 +1,195 @@
</a><a href="#h66-0-0" id="h66-0-0" class="i">+/* modifier 0 means no modifier */
</a><a href="#h66-0-1" id="h66-0-1" class="i">+static int surfuseragent    = 1;  /* Append Surf version to default WebKit user agent */
</a><a href="#h66-0-2" id="h66-0-2" class="i">+static char *fulluseragent  = &quot;&quot;; /* Or override the whole user agent string */
</a><a href="#h66-0-3" id="h66-0-3" class="i">+static char *scriptfile     = &quot;~/.surf/script.js&quot;;
</a><a href="#h66-0-4" id="h66-0-4" class="i">+static char *styledir       = &quot;~/.surf/styles/&quot;;
</a><a href="#h66-0-5" id="h66-0-5" class="i">+static char *certdir        = &quot;~/.surf/certificates/&quot;;
</a><a href="#h66-0-6" id="h66-0-6" class="i">+static char *cachedir       = &quot;~/.surf/cache/&quot;;
</a><a href="#h66-0-7" id="h66-0-7" class="i">+static char *cookiefile     = &quot;~/.surf/cookies.txt&quot;;
</a><a href="#h66-0-8" id="h66-0-8" class="i">+
</a><a href="#h66-0-9" id="h66-0-9" class="i">+/* Webkit default features */
</a><a href="#h66-0-10" id="h66-0-10" class="i">+/* Highest priority value will be used.
</a><a href="#h66-0-11" id="h66-0-11" class="i">+ * Default parameters are priority 0
</a><a href="#h66-0-12" id="h66-0-12" class="i">+ * Per-uri parameters are priority 1
</a><a href="#h66-0-13" id="h66-0-13" class="i">+ * Command parameters are priority 2
</a><a href="#h66-0-14" id="h66-0-14" class="i">+ */
</a><a href="#h66-0-15" id="h66-0-15" class="i">+static Parameter defconfig[ParameterLast] = {
</a><a href="#h66-0-16" id="h66-0-16" class="i">+	/* parameter                    Arg value       priority */
</a><a href="#h66-0-17" id="h66-0-17" class="i">+	[AcceleratedCanvas]   =       { { .i = 1 },     },
</a><a href="#h66-0-18" id="h66-0-18" class="i">+	[AccessMicrophone]    =       { { .i = 0 },     },
</a><a href="#h66-0-19" id="h66-0-19" class="i">+	[AccessWebcam]        =       { { .i = 0 },     },
</a><a href="#h66-0-20" id="h66-0-20" class="i">+	[Certificate]         =       { { .i = 0 },     },
</a><a href="#h66-0-21" id="h66-0-21" class="i">+	[CaretBrowsing]       =       { { .i = 0 },     },
</a><a href="#h66-0-22" id="h66-0-22" class="i">+	[CookiePolicies]      =       { { .v = &quot;@Aa&quot; }, },
</a><a href="#h66-0-23" id="h66-0-23" class="i">+	[DefaultCharset]      =       { { .v = &quot;UTF-8&quot; }, },
</a><a href="#h66-0-24" id="h66-0-24" class="i">+	[DiskCache]           =       { { .i = 1 },     },
</a><a href="#h66-0-25" id="h66-0-25" class="i">+	[DNSPrefetch]         =       { { .i = 0 },     },
</a><a href="#h66-0-26" id="h66-0-26" class="i">+	[FileURLsCrossAccess] =       { { .i = 0 },     },
</a><a href="#h66-0-27" id="h66-0-27" class="i">+	[FontSize]            =       { { .i = 12 },    },
</a><a href="#h66-0-28" id="h66-0-28" class="i">+	[FrameFlattening]     =       { { .i = 0 },     },
</a><a href="#h66-0-29" id="h66-0-29" class="i">+	[Geolocation]         =       { { .i = 0 },     },
</a><a href="#h66-0-30" id="h66-0-30" class="i">+	[HideBackground]      =       { { .i = 0 },     },
</a><a href="#h66-0-31" id="h66-0-31" class="i">+	[Inspector]           =       { { .i = 0 },     },
</a><a href="#h66-0-32" id="h66-0-32" class="i">+	[Java]                =       { { .i = 1 },     },
</a><a href="#h66-0-33" id="h66-0-33" class="i">+	[JavaScript]          =       { { .i = 1 },     },
</a><a href="#h66-0-34" id="h66-0-34" class="i">+	[KioskMode]           =       { { .i = 0 },     },
</a><a href="#h66-0-35" id="h66-0-35" class="i">+	[LoadImages]          =       { { .i = 1 },     },
</a><a href="#h66-0-36" id="h66-0-36" class="i">+	[MediaManualPlay]     =       { { .i = 1 },     },
</a><a href="#h66-0-37" id="h66-0-37" class="i">+	[Plugins]             =       { { .i = 1 },     },
</a><a href="#h66-0-38" id="h66-0-38" class="i">+	[PreferredLanguages]  =       { { .v = (char *[]){ NULL } }, },
</a><a href="#h66-0-39" id="h66-0-39" class="i">+	[RunInFullscreen]     =       { { .i = 0 },     },
</a><a href="#h66-0-40" id="h66-0-40" class="i">+	[ScrollBars]          =       { { .i = 1 },     },
</a><a href="#h66-0-41" id="h66-0-41" class="i">+	[ShowIndicators]      =       { { .i = 1 },     },
</a><a href="#h66-0-42" id="h66-0-42" class="i">+	[SiteQuirks]          =       { { .i = 1 },     },
</a><a href="#h66-0-43" id="h66-0-43" class="i">+	[SmoothScrolling]     =       { { .i = 0 },     },
</a><a href="#h66-0-44" id="h66-0-44" class="i">+	[SpellChecking]       =       { { .i = 0 },     },
</a><a href="#h66-0-45" id="h66-0-45" class="i">+	[SpellLanguages]      =       { { .v = ((char *[]){ &quot;en_US&quot;, NULL }) }, },
</a><a href="#h66-0-46" id="h66-0-46" class="i">+	[StrictTLS]           =       { { .i = 1 },     },
</a><a href="#h66-0-47" id="h66-0-47" class="i">+	[Style]               =       { { .i = 1 },     },
</a><a href="#h66-0-48" id="h66-0-48" class="i">+	[WebGL]               =       { { .i = 0 },     },
</a><a href="#h66-0-49" id="h66-0-49" class="i">+	[ZoomLevel]           =       { { .f = 1.0 },   },
</a><a href="#h66-0-50" id="h66-0-50" class="i">+};
</a><a href="#h66-0-51" id="h66-0-51" class="i">+
</a><a href="#h66-0-52" id="h66-0-52" class="i">+static UriParameters uriparams[] = {
</a><a href="#h66-0-53" id="h66-0-53" class="i">+	{ &quot;(://|\\.)suckless\\.org(/|$)&quot;, {
</a><a href="#h66-0-54" id="h66-0-54" class="i">+	  [JavaScript] = { { .i = 0 }, 1 },
</a><a href="#h66-0-55" id="h66-0-55" class="i">+	  [Plugins]    = { { .i = 0 }, 1 },
</a><a href="#h66-0-56" id="h66-0-56" class="i">+	}, },
</a><a href="#h66-0-57" id="h66-0-57" class="i">+};
</a><a href="#h66-0-58" id="h66-0-58" class="i">+
</a><a href="#h66-0-59" id="h66-0-59" class="i">+/* default window size: width, height */
</a><a href="#h66-0-60" id="h66-0-60" class="i">+static int winsize[] = { 800, 600 };
</a><a href="#h66-0-61" id="h66-0-61" class="i">+
</a><a href="#h66-0-62" id="h66-0-62" class="i">+static WebKitFindOptions findopts = WEBKIT_FIND_OPTIONS_CASE_INSENSITIVE |
</a><a href="#h66-0-63" id="h66-0-63" class="i">+                                    WEBKIT_FIND_OPTIONS_WRAP_AROUND;
</a><a href="#h66-0-64" id="h66-0-64" class="i">+
</a><a href="#h66-0-65" id="h66-0-65" class="i">+#define PROMPT_GO   &quot;Go:&quot;
</a><a href="#h66-0-66" id="h66-0-66" class="i">+#define PROMPT_FIND &quot;Find:&quot;
</a><a href="#h66-0-67" id="h66-0-67" class="i">+
</a><a href="#h66-0-68" id="h66-0-68" class="i">+/* SETPROP(readprop, setprop, prompt)*/
</a><a href="#h66-0-69" id="h66-0-69" class="i">+#define SETPROP(r, s, p) { \
</a><a href="#h66-0-70" id="h66-0-70" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h66-0-71" id="h66-0-71" class="i">+             &quot;prop=\&quot;$(printf &#39;%b&#39; \&quot;$(xprop -id $1 $2 &quot; \
</a><a href="#h66-0-72" id="h66-0-72" class="i">+             &quot;| sed \&quot;s/^$2(STRING) = //;s/^\\\&quot;\\(.*\\)\\\&quot;$/\\1/\&quot;)\&quot; &quot; \
</a><a href="#h66-0-73" id="h66-0-73" class="i">+             &quot;| dmenu -p \&quot;$4\&quot; -w $1)\&quot; &amp;&amp; xprop -id $1 -f $3 8s -set $3 \&quot;$prop\&quot;&quot;, \
</a><a href="#h66-0-74" id="h66-0-74" class="i">+             &quot;surf-setprop&quot;, winid, r, s, p, NULL \
</a><a href="#h66-0-75" id="h66-0-75" class="i">+        } \
</a><a href="#h66-0-76" id="h66-0-76" class="i">+}
</a><a href="#h66-0-77" id="h66-0-77" class="i">+
</a><a href="#h66-0-78" id="h66-0-78" class="i">+/* DOWNLOAD(URI, referer) */
</a><a href="#h66-0-79" id="h66-0-79" class="i">+#define DOWNLOAD(u, r) { \
</a><a href="#h66-0-80" id="h66-0-80" class="i">+        .v = (const char *[]){ &quot;st&quot;, &quot;-e&quot;, &quot;/bin/sh&quot;, &quot;-c&quot;,\
</a><a href="#h66-0-81" id="h66-0-81" class="i">+             &quot;curl -g -L -J -O -A \&quot;$1\&quot; -b \&quot;$2\&quot; -c \&quot;$2\&quot;&quot; \
</a><a href="#h66-0-82" id="h66-0-82" class="i">+             &quot; -e \&quot;$3\&quot; \&quot;$4\&quot;; read&quot;, \
</a><a href="#h66-0-83" id="h66-0-83" class="i">+             &quot;surf-download&quot;, useragent, cookiefile, r, u, NULL \
</a><a href="#h66-0-84" id="h66-0-84" class="i">+        } \
</a><a href="#h66-0-85" id="h66-0-85" class="i">+}
</a><a href="#h66-0-86" id="h66-0-86" class="i">+
</a><a href="#h66-0-87" id="h66-0-87" class="i">+/* PLUMB(URI) */
</a><a href="#h66-0-88" id="h66-0-88" class="i">+/* This called when some URI which does not begin with &quot;about:&quot;,
</a><a href="#h66-0-89" id="h66-0-89" class="i">+ * &quot;http://&quot; or &quot;https://&quot; should be opened.
</a><a href="#h66-0-90" id="h66-0-90" class="i">+ */
</a><a href="#h66-0-91" id="h66-0-91" class="i">+#define PLUMB(u) {\
</a><a href="#h66-0-92" id="h66-0-92" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h66-0-93" id="h66-0-93" class="i">+             &quot;xdg-open \&quot;$0\&quot;&quot;, u, NULL \
</a><a href="#h66-0-94" id="h66-0-94" class="i">+        } \
</a><a href="#h66-0-95" id="h66-0-95" class="i">+}
</a><a href="#h66-0-96" id="h66-0-96" class="i">+
</a><a href="#h66-0-97" id="h66-0-97" class="i">+/* VIDEOPLAY(URI) */
</a><a href="#h66-0-98" id="h66-0-98" class="i">+#define VIDEOPLAY(u) {\
</a><a href="#h66-0-99" id="h66-0-99" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h66-0-100" id="h66-0-100" class="i">+             &quot;mpv --really-quiet \&quot;$0\&quot;&quot;, u, NULL \
</a><a href="#h66-0-101" id="h66-0-101" class="i">+        } \
</a><a href="#h66-0-102" id="h66-0-102" class="i">+}
</a><a href="#h66-0-103" id="h66-0-103" class="i">+
</a><a href="#h66-0-104" id="h66-0-104" class="i">+/* styles */
</a><a href="#h66-0-105" id="h66-0-105" class="i">+/*
</a><a href="#h66-0-106" id="h66-0-106" class="i">+ * The iteration will stop at the first match, beginning at the beginning of
</a><a href="#h66-0-107" id="h66-0-107" class="i">+ * the list.
</a><a href="#h66-0-108" id="h66-0-108" class="i">+ */
</a><a href="#h66-0-109" id="h66-0-109" class="i">+static SiteSpecific styles[] = {
</a><a href="#h66-0-110" id="h66-0-110" class="i">+	/* regexp               file in $styledir */
</a><a href="#h66-0-111" id="h66-0-111" class="i">+	{ &quot;.*&quot;,                 &quot;default.css&quot; },
</a><a href="#h66-0-112" id="h66-0-112" class="i">+};
</a><a href="#h66-0-113" id="h66-0-113" class="i">+
</a><a href="#h66-0-114" id="h66-0-114" class="i">+/* certificates */
</a><a href="#h66-0-115" id="h66-0-115" class="i">+/*
</a><a href="#h66-0-116" id="h66-0-116" class="i">+ * Provide custom certificate for urls
</a><a href="#h66-0-117" id="h66-0-117" class="i">+ */
</a><a href="#h66-0-118" id="h66-0-118" class="i">+static SiteSpecific certs[] = {
</a><a href="#h66-0-119" id="h66-0-119" class="i">+	/* regexp               file in $certdir */
</a><a href="#h66-0-120" id="h66-0-120" class="i">+	{ &quot;://suckless\\.org/&quot;, &quot;suckless.org.crt&quot; },
</a><a href="#h66-0-121" id="h66-0-121" class="i">+};
</a><a href="#h66-0-122" id="h66-0-122" class="i">+
</a><a href="#h66-0-123" id="h66-0-123" class="i">+#define MODKEY GDK_CONTROL_MASK
</a><a href="#h66-0-124" id="h66-0-124" class="i">+
</a><a href="#h66-0-125" id="h66-0-125" class="i">+/* hotkeys */
</a><a href="#h66-0-126" id="h66-0-126" class="i">+/*
</a><a href="#h66-0-127" id="h66-0-127" class="i">+ * If you use anything else but MODKEY and GDK_SHIFT_MASK, don&#39;t forget to
</a><a href="#h66-0-128" id="h66-0-128" class="i">+ * edit the CLEANMASK() macro.
</a><a href="#h66-0-129" id="h66-0-129" class="i">+ */
</a><a href="#h66-0-130" id="h66-0-130" class="i">+static Key keys[] = {
</a><a href="#h66-0-131" id="h66-0-131" class="i">+	/* modifier              keyval          function    arg */
</a><a href="#h66-0-132" id="h66-0-132" class="i">+	{ MODKEY,                GDK_KEY_g,      spawn,      SETPROP(&quot;_SURF_URI&quot;, &quot;_SURF_GO&quot;, PROMPT_GO) },
</a><a href="#h66-0-133" id="h66-0-133" class="i">+	{ MODKEY,                GDK_KEY_f,      spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;, PROMPT_FIND) },
</a><a href="#h66-0-134" id="h66-0-134" class="i">+	{ MODKEY,                GDK_KEY_slash,  spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;, PROMPT_FIND) },
</a><a href="#h66-0-135" id="h66-0-135" class="i">+
</a><a href="#h66-0-136" id="h66-0-136" class="i">+	{ 0,                     GDK_KEY_Escape, stop,       { 0 } },
</a><a href="#h66-0-137" id="h66-0-137" class="i">+	{ MODKEY,                GDK_KEY_c,      stop,       { 0 } },
</a><a href="#h66-0-138" id="h66-0-138" class="i">+
</a><a href="#h66-0-139" id="h66-0-139" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_r,      reload,     { .i = 1 } },
</a><a href="#h66-0-140" id="h66-0-140" class="i">+	{ MODKEY,                GDK_KEY_r,      reload,     { .i = 0 } },
</a><a href="#h66-0-141" id="h66-0-141" class="i">+
</a><a href="#h66-0-142" id="h66-0-142" class="i">+	{ MODKEY,                GDK_KEY_l,      navigate,   { .i = +1 } },
</a><a href="#h66-0-143" id="h66-0-143" class="i">+	{ MODKEY,                GDK_KEY_h,      navigate,   { .i = -1 } },
</a><a href="#h66-0-144" id="h66-0-144" class="i">+
</a><a href="#h66-0-145" id="h66-0-145" class="i">+	/* vertical and horizontal scrolling, in viewport percentage */
</a><a href="#h66-0-146" id="h66-0-146" class="i">+	{ MODKEY,                GDK_KEY_j,      scrollv,    { .i = +10 } },
</a><a href="#h66-0-147" id="h66-0-147" class="i">+	{ MODKEY,                GDK_KEY_k,      scrollv,    { .i = -10 } },
</a><a href="#h66-0-148" id="h66-0-148" class="i">+	{ MODKEY,                GDK_KEY_space,  scrollv,    { .i = +50 } },
</a><a href="#h66-0-149" id="h66-0-149" class="i">+	{ MODKEY,                GDK_KEY_b,      scrollv,    { .i = -50 } },
</a><a href="#h66-0-150" id="h66-0-150" class="i">+	{ MODKEY,                GDK_KEY_i,      scrollh,    { .i = +10 } },
</a><a href="#h66-0-151" id="h66-0-151" class="i">+	{ MODKEY,                GDK_KEY_u,      scrollh,    { .i = -10 } },
</a><a href="#h66-0-152" id="h66-0-152" class="i">+
</a><a href="#h66-0-153" id="h66-0-153" class="i">+
</a><a href="#h66-0-154" id="h66-0-154" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_j,      zoom,       { .i = -1 } },
</a><a href="#h66-0-155" id="h66-0-155" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_k,      zoom,       { .i = +1 } },
</a><a href="#h66-0-156" id="h66-0-156" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_q,      zoom,       { .i = 0  } },
</a><a href="#h66-0-157" id="h66-0-157" class="i">+	{ MODKEY,                GDK_KEY_minus,  zoom,       { .i = -1 } },
</a><a href="#h66-0-158" id="h66-0-158" class="i">+	{ MODKEY,                GDK_KEY_plus,   zoom,       { .i = +1 } },
</a><a href="#h66-0-159" id="h66-0-159" class="i">+
</a><a href="#h66-0-160" id="h66-0-160" class="i">+	{ MODKEY,                GDK_KEY_p,      clipboard,  { .i = 1 } },
</a><a href="#h66-0-161" id="h66-0-161" class="i">+	{ MODKEY,                GDK_KEY_y,      clipboard,  { .i = 0 } },
</a><a href="#h66-0-162" id="h66-0-162" class="i">+
</a><a href="#h66-0-163" id="h66-0-163" class="i">+	{ MODKEY,                GDK_KEY_n,      find,       { .i = +1 } },
</a><a href="#h66-0-164" id="h66-0-164" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_n,      find,       { .i = -1 } },
</a><a href="#h66-0-165" id="h66-0-165" class="i">+
</a><a href="#h66-0-166" id="h66-0-166" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_p,      print,      { 0 } },
</a><a href="#h66-0-167" id="h66-0-167" class="i">+	{ MODKEY,                GDK_KEY_t,      showcert,   { 0 } },
</a><a href="#h66-0-168" id="h66-0-168" class="i">+
</a><a href="#h66-0-169" id="h66-0-169" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_a,      togglecookiepolicy, { 0 } },
</a><a href="#h66-0-170" id="h66-0-170" class="i">+	{ 0,                     GDK_KEY_F11,    togglefullscreen, { 0 } },
</a><a href="#h66-0-171" id="h66-0-171" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_o,      toggleinspector, { 0 } },
</a><a href="#h66-0-172" id="h66-0-172" class="i">+
</a><a href="#h66-0-173" id="h66-0-173" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_c,      toggle,     { .i = CaretBrowsing } },
</a><a href="#h66-0-174" id="h66-0-174" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_f,      toggle,     { .i = FrameFlattening } },
</a><a href="#h66-0-175" id="h66-0-175" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_g,      toggle,     { .i = Geolocation } },
</a><a href="#h66-0-176" id="h66-0-176" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_s,      toggle,     { .i = JavaScript } },
</a><a href="#h66-0-177" id="h66-0-177" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_i,      toggle,     { .i = LoadImages } },
</a><a href="#h66-0-178" id="h66-0-178" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_v,      toggle,     { .i = Plugins } },
</a><a href="#h66-0-179" id="h66-0-179" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_b,      toggle,     { .i = ScrollBars } },
</a><a href="#h66-0-180" id="h66-0-180" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_t,      toggle,     { .i = StrictTLS } },
</a><a href="#h66-0-181" id="h66-0-181" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_m,      toggle,     { .i = Style } },
</a><a href="#h66-0-182" id="h66-0-182" class="i">+};
</a><a href="#h66-0-183" id="h66-0-183" class="i">+
</a><a href="#h66-0-184" id="h66-0-184" class="i">+/* button definitions */
</a><a href="#h66-0-185" id="h66-0-185" class="i">+/* target can be OnDoc, OnLink, OnImg, OnMedia, OnEdit, OnBar, OnSel, OnAny */
</a><a href="#h66-0-186" id="h66-0-186" class="i">+static Button buttons[] = {
</a><a href="#h66-0-187" id="h66-0-187" class="i">+	/* target       event mask      button  function        argument        stop event */
</a><a href="#h66-0-188" id="h66-0-188" class="i">+	{ OnLink,       0,              2,      clicknewwindow, { .i = 0 },     1 },
</a><a href="#h66-0-189" id="h66-0-189" class="i">+	{ OnLink,       MODKEY,         2,      clicknewwindow, { .i = 1 },     1 },
</a><a href="#h66-0-190" id="h66-0-190" class="i">+	{ OnLink,       MODKEY,         1,      clicknewwindow, { .i = 1 },     1 },
</a><a href="#h66-0-191" id="h66-0-191" class="i">+	{ OnAny,        0,              8,      clicknavigate,  { .i = -1 },    1 },
</a><a href="#h66-0-192" id="h66-0-192" class="i">+	{ OnAny,        0,              9,      clicknavigate,  { .i = +1 },    1 },
</a><a href="#h66-0-193" id="h66-0-193" class="i">+	{ OnMedia,      MODKEY,         1,      clickexternplayer, { 0 },       1 },
</a><a href="#h66-0-194" id="h66-0-194" class="i">+};
</a><b>diff --git a/<a id="h67" href="../file/surf/config.def.h.rej.html">surf/config.def.h.rej</a> b/<a href="../file/surf/config.def.h.rej.html">surf/config.def.h.rej</a></b>
<a href="#h67-0" id="h67-0" class="h">@@ -0,0 +1,8 @@
</a><a href="#h67-0-0" id="h67-0-0" class="i">+--- config.def.h
</a><a href="#h67-0-1" id="h67-0-1" class="i">++++ config.def.h
</a><a href="#h67-0-2" id="h67-0-2" class="i">+@@ -164,3 +164,5 @@ static Button buttons[] = {
</a><a href="#h67-0-3" id="h67-0-3" class="i">+ 	{ OnAny,        0,              9,      clicknavigate,  { .i = +1 },    1 },
</a><a href="#h67-0-4" id="h67-0-4" class="i">+ 	{ OnMedia,      MODKEY,         1,      clickexternplayer, { 0 },       1 },
</a><a href="#h67-0-5" id="h67-0-5" class="i">+ };
</a><a href="#h67-0-6" id="h67-0-6" class="i">++
</a><a href="#h67-0-7" id="h67-0-7" class="i">++#define HOMEPAGE &quot;https://duckduckgo.com/&quot;
</a><b>diff --git a/<a id="h68" href="../file/surf/config.h.html">surf/config.h</a> b/<a href="../file/surf/config.h.html">surf/config.h</a></b>
<a href="#h68-0" id="h68-0" class="h">@@ -0,0 +1,202 @@
</a><a href="#h68-0-0" id="h68-0-0" class="i">+#define HOMEPAGE &quot;file:///home/connor/.scripts/resources/homepage.html&quot;
</a><a href="#h68-0-1" id="h68-0-1" class="i">+/* modifier 0 means no modifier */
</a><a href="#h68-0-2" id="h68-0-2" class="i">+static int surfuseragent    = 1;  /* Append Surf version to default WebKit user agent */
</a><a href="#h68-0-3" id="h68-0-3" class="i">+static char *fulluseragent  = &quot;&quot;; /* Or override the whole user agent string */
</a><a href="#h68-0-4" id="h68-0-4" class="i">+static char *scriptfile     = &quot;~/.surf/script.js&quot;;
</a><a href="#h68-0-5" id="h68-0-5" class="i">+static char *styledir       = &quot;~/.surf/styles/&quot;;
</a><a href="#h68-0-6" id="h68-0-6" class="i">+static char *certdir        = &quot;~/.surf/certificates/&quot;;
</a><a href="#h68-0-7" id="h68-0-7" class="i">+static char *cachedir       = &quot;~/.surf/cache/&quot;;
</a><a href="#h68-0-8" id="h68-0-8" class="i">+static char *cookiefile     = &quot;~/.surf/cookies.txt&quot;;
</a><a href="#h68-0-9" id="h68-0-9" class="i">+
</a><a href="#h68-0-10" id="h68-0-10" class="i">+/* Webkit default features */
</a><a href="#h68-0-11" id="h68-0-11" class="i">+/* Highest priority value will be used.
</a><a href="#h68-0-12" id="h68-0-12" class="i">+ * Default parameters are priority 0
</a><a href="#h68-0-13" id="h68-0-13" class="i">+ * Per-uri parameters are priority 1
</a><a href="#h68-0-14" id="h68-0-14" class="i">+ * Command parameters are priority 2
</a><a href="#h68-0-15" id="h68-0-15" class="i">+ */
</a><a href="#h68-0-16" id="h68-0-16" class="i">+
</a><a href="#h68-0-17" id="h68-0-17" class="i">+const static char *searchengine = &quot;https://duckduckgo.com/html/?q=&quot;;
</a><a href="#h68-0-18" id="h68-0-18" class="i">+const static SearchEngine searchengines[] = {
</a><a href="#h68-0-19" id="h68-0-19" class="i">+	{ &quot;d&quot;,	&quot;https://duckduckgo.com/html/?q=%s&quot;	},
</a><a href="#h68-0-20" id="h68-0-20" class="i">+	{ &quot;w&quot;,  &quot;https://en.wikipedia.org/wiki/%s&quot; 	},
</a><a href="#h68-0-21" id="h68-0-21" class="i">+};
</a><a href="#h68-0-22" id="h68-0-22" class="i">+static Parameter defconfig[ParameterLast] = {
</a><a href="#h68-0-23" id="h68-0-23" class="i">+	/* parameter                    Arg value       priority */
</a><a href="#h68-0-24" id="h68-0-24" class="i">+	[AcceleratedCanvas]   =       { { .i = 1 },     },
</a><a href="#h68-0-25" id="h68-0-25" class="i">+	[AccessMicrophone]    =       { { .i = 0 },     },
</a><a href="#h68-0-26" id="h68-0-26" class="i">+	[AccessWebcam]        =       { { .i = 0 },     },
</a><a href="#h68-0-27" id="h68-0-27" class="i">+	[Certificate]         =       { { .i = 0 },     },
</a><a href="#h68-0-28" id="h68-0-28" class="i">+	[CaretBrowsing]       =       { { .i = 0 },     },
</a><a href="#h68-0-29" id="h68-0-29" class="i">+	[CookiePolicies]      =       { { .v = &quot;@Aa&quot; }, },
</a><a href="#h68-0-30" id="h68-0-30" class="i">+	[DefaultCharset]      =       { { .v = &quot;UTF-8&quot; }, },
</a><a href="#h68-0-31" id="h68-0-31" class="i">+	[DiskCache]           =       { { .i = 1 },     },
</a><a href="#h68-0-32" id="h68-0-32" class="i">+	[DNSPrefetch]         =       { { .i = 0 },     },
</a><a href="#h68-0-33" id="h68-0-33" class="i">+	[FileURLsCrossAccess] =       { { .i = 0 },     },
</a><a href="#h68-0-34" id="h68-0-34" class="i">+	[FontSize]            =       { { .i = 12 },    },
</a><a href="#h68-0-35" id="h68-0-35" class="i">+	[FrameFlattening]     =       { { .i = 0 },     },
</a><a href="#h68-0-36" id="h68-0-36" class="i">+	[Geolocation]         =       { { .i = 0 },     },
</a><a href="#h68-0-37" id="h68-0-37" class="i">+	[HideBackground]      =       { { .i = 0 },     },
</a><a href="#h68-0-38" id="h68-0-38" class="i">+	[Inspector]           =       { { .i = 0 },     },
</a><a href="#h68-0-39" id="h68-0-39" class="i">+	[Java]                =       { { .i = 1 },     },
</a><a href="#h68-0-40" id="h68-0-40" class="i">+	[JavaScript]          =       { { .i = 1 },     },
</a><a href="#h68-0-41" id="h68-0-41" class="i">+	[KioskMode]           =       { { .i = 0 },     },
</a><a href="#h68-0-42" id="h68-0-42" class="i">+	[LoadImages]          =       { { .i = 1 },     },
</a><a href="#h68-0-43" id="h68-0-43" class="i">+	[MediaManualPlay]     =       { { .i = 1 },     },
</a><a href="#h68-0-44" id="h68-0-44" class="i">+	[Plugins]             =       { { .i = 1 },     },
</a><a href="#h68-0-45" id="h68-0-45" class="i">+	[PreferredLanguages]  =       { { .v = (char *[]){ NULL } }, },
</a><a href="#h68-0-46" id="h68-0-46" class="i">+	[RunInFullscreen]     =       { { .i = 0 },     },
</a><a href="#h68-0-47" id="h68-0-47" class="i">+	[ScrollBars]          =       { { .i = 1 },     },
</a><a href="#h68-0-48" id="h68-0-48" class="i">+	[ShowIndicators]      =       { { .i = 1 },     },
</a><a href="#h68-0-49" id="h68-0-49" class="i">+	[SiteQuirks]          =       { { .i = 1 },     },
</a><a href="#h68-0-50" id="h68-0-50" class="i">+	[SmoothScrolling]     =       { { .i = 0 },     },
</a><a href="#h68-0-51" id="h68-0-51" class="i">+	[SpellChecking]       =       { { .i = 0 },     },
</a><a href="#h68-0-52" id="h68-0-52" class="i">+	[SpellLanguages]      =       { { .v = ((char *[]){ &quot;en_US&quot;, NULL }) }, },
</a><a href="#h68-0-53" id="h68-0-53" class="i">+	[StrictTLS]           =       { { .i = 1 },     },
</a><a href="#h68-0-54" id="h68-0-54" class="i">+	[Style]               =       { { .i = 1 },     },
</a><a href="#h68-0-55" id="h68-0-55" class="i">+	[WebGL]               =       { { .i = 0 },     },
</a><a href="#h68-0-56" id="h68-0-56" class="i">+	[ZoomLevel]           =       { { .f = 1.0 },   },
</a><a href="#h68-0-57" id="h68-0-57" class="i">+};
</a><a href="#h68-0-58" id="h68-0-58" class="i">+
</a><a href="#h68-0-59" id="h68-0-59" class="i">+static UriParameters uriparams[] = {
</a><a href="#h68-0-60" id="h68-0-60" class="i">+	{ &quot;(://|\\.)suckless\\.org(/|$)&quot;, {
</a><a href="#h68-0-61" id="h68-0-61" class="i">+	  [JavaScript] = { { .i = 0 }, 1 },
</a><a href="#h68-0-62" id="h68-0-62" class="i">+	  [Plugins]    = { { .i = 0 }, 1 },
</a><a href="#h68-0-63" id="h68-0-63" class="i">+	}, },
</a><a href="#h68-0-64" id="h68-0-64" class="i">+};
</a><a href="#h68-0-65" id="h68-0-65" class="i">+
</a><a href="#h68-0-66" id="h68-0-66" class="i">+/* default window size: width, height */
</a><a href="#h68-0-67" id="h68-0-67" class="i">+static int winsize[] = { 800, 600 };
</a><a href="#h68-0-68" id="h68-0-68" class="i">+
</a><a href="#h68-0-69" id="h68-0-69" class="i">+static WebKitFindOptions findopts = WEBKIT_FIND_OPTIONS_CASE_INSENSITIVE |
</a><a href="#h68-0-70" id="h68-0-70" class="i">+                                    WEBKIT_FIND_OPTIONS_WRAP_AROUND;
</a><a href="#h68-0-71" id="h68-0-71" class="i">+
</a><a href="#h68-0-72" id="h68-0-72" class="i">+#define PROMPT_GO   &quot;Go:&quot;
</a><a href="#h68-0-73" id="h68-0-73" class="i">+#define PROMPT_FIND &quot;Find:&quot;
</a><a href="#h68-0-74" id="h68-0-74" class="i">+
</a><a href="#h68-0-75" id="h68-0-75" class="i">+/* SETPROP(readprop, setprop, prompt)*/
</a><a href="#h68-0-76" id="h68-0-76" class="i">+#define SETPROP(r, s, p) { \
</a><a href="#h68-0-77" id="h68-0-77" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h68-0-78" id="h68-0-78" class="i">+             &quot;prop=\&quot;$(printf &#39;%b&#39; \&quot;$(xprop -id $1 $2 &quot; \
</a><a href="#h68-0-79" id="h68-0-79" class="i">+             &quot;| sed \&quot;s/^$2(STRING) = //;s/^\\\&quot;\\(.*\\)\\\&quot;$/\\1/\&quot;)\&quot; &quot; \
</a><a href="#h68-0-80" id="h68-0-80" class="i">+             &quot;| dmenu -p \&quot;$4\&quot; -w $1)\&quot; &amp;&amp; xprop -id $1 -f $3 8s -set $3 \&quot;$prop\&quot;&quot;, \
</a><a href="#h68-0-81" id="h68-0-81" class="i">+             &quot;surf-setprop&quot;, winid, r, s, p, NULL \
</a><a href="#h68-0-82" id="h68-0-82" class="i">+        } \
</a><a href="#h68-0-83" id="h68-0-83" class="i">+}
</a><a href="#h68-0-84" id="h68-0-84" class="i">+
</a><a href="#h68-0-85" id="h68-0-85" class="i">+/* DOWNLOAD(URI, referer) */
</a><a href="#h68-0-86" id="h68-0-86" class="i">+#define DOWNLOAD(u, r) { \
</a><a href="#h68-0-87" id="h68-0-87" class="i">+        .v = (const char *[]){ &quot;st&quot;, &quot;-e&quot;, &quot;/bin/sh&quot;, &quot;-c&quot;,\
</a><a href="#h68-0-88" id="h68-0-88" class="i">+             &quot;curl -g -L -J -O -A \&quot;$1\&quot; -b \&quot;$2\&quot; -c \&quot;$2\&quot;&quot; \
</a><a href="#h68-0-89" id="h68-0-89" class="i">+             &quot; -e \&quot;$3\&quot; \&quot;$4\&quot;; read&quot;, \
</a><a href="#h68-0-90" id="h68-0-90" class="i">+             &quot;surf-download&quot;, useragent, cookiefile, r, u, NULL \
</a><a href="#h68-0-91" id="h68-0-91" class="i">+        } \
</a><a href="#h68-0-92" id="h68-0-92" class="i">+}
</a><a href="#h68-0-93" id="h68-0-93" class="i">+
</a><a href="#h68-0-94" id="h68-0-94" class="i">+/* PLUMB(URI) */
</a><a href="#h68-0-95" id="h68-0-95" class="i">+/* This called when some URI which does not begin with &quot;about:&quot;,
</a><a href="#h68-0-96" id="h68-0-96" class="i">+ * &quot;http://&quot; or &quot;https://&quot; should be opened.
</a><a href="#h68-0-97" id="h68-0-97" class="i">+ */
</a><a href="#h68-0-98" id="h68-0-98" class="i">+#define PLUMB(u) {\
</a><a href="#h68-0-99" id="h68-0-99" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h68-0-100" id="h68-0-100" class="i">+             &quot;xdg-open \&quot;$0\&quot;&quot;, u, NULL \
</a><a href="#h68-0-101" id="h68-0-101" class="i">+        } \
</a><a href="#h68-0-102" id="h68-0-102" class="i">+}
</a><a href="#h68-0-103" id="h68-0-103" class="i">+
</a><a href="#h68-0-104" id="h68-0-104" class="i">+/* VIDEOPLAY(URI) */
</a><a href="#h68-0-105" id="h68-0-105" class="i">+#define VIDEOPLAY(u) {\
</a><a href="#h68-0-106" id="h68-0-106" class="i">+        .v = (const char *[]){ &quot;/bin/sh&quot;, &quot;-c&quot;, \
</a><a href="#h68-0-107" id="h68-0-107" class="i">+             &quot;mpv --really-quiet \&quot;$0\&quot;&quot;, u, NULL \
</a><a href="#h68-0-108" id="h68-0-108" class="i">+        } \
</a><a href="#h68-0-109" id="h68-0-109" class="i">+}
</a><a href="#h68-0-110" id="h68-0-110" class="i">+
</a><a href="#h68-0-111" id="h68-0-111" class="i">+/* styles */
</a><a href="#h68-0-112" id="h68-0-112" class="i">+/*
</a><a href="#h68-0-113" id="h68-0-113" class="i">+ * The iteration will stop at the first match, beginning at the beginning of
</a><a href="#h68-0-114" id="h68-0-114" class="i">+ * the list.
</a><a href="#h68-0-115" id="h68-0-115" class="i">+ */
</a><a href="#h68-0-116" id="h68-0-116" class="i">+static SiteSpecific styles[] = {
</a><a href="#h68-0-117" id="h68-0-117" class="i">+	/* regexp               file in $styledir */
</a><a href="#h68-0-118" id="h68-0-118" class="i">+	{ &quot;.*&quot;,                 &quot;default.css&quot; },
</a><a href="#h68-0-119" id="h68-0-119" class="i">+};
</a><a href="#h68-0-120" id="h68-0-120" class="i">+
</a><a href="#h68-0-121" id="h68-0-121" class="i">+/* certificates */
</a><a href="#h68-0-122" id="h68-0-122" class="i">+/*
</a><a href="#h68-0-123" id="h68-0-123" class="i">+ * Provide custom certificate for urls
</a><a href="#h68-0-124" id="h68-0-124" class="i">+ */
</a><a href="#h68-0-125" id="h68-0-125" class="i">+static SiteSpecific certs[] = {
</a><a href="#h68-0-126" id="h68-0-126" class="i">+	/* regexp               file in $certdir */
</a><a href="#h68-0-127" id="h68-0-127" class="i">+	{ &quot;://suckless\\.org/&quot;, &quot;suckless.org.crt&quot; },
</a><a href="#h68-0-128" id="h68-0-128" class="i">+};
</a><a href="#h68-0-129" id="h68-0-129" class="i">+
</a><a href="#h68-0-130" id="h68-0-130" class="i">+#define MODKEY GDK_CONTROL_MASK
</a><a href="#h68-0-131" id="h68-0-131" class="i">+
</a><a href="#h68-0-132" id="h68-0-132" class="i">+/* hotkeys */
</a><a href="#h68-0-133" id="h68-0-133" class="i">+/*
</a><a href="#h68-0-134" id="h68-0-134" class="i">+ * If you use anything else but MODKEY and GDK_SHIFT_MASK, don&#39;t forget to
</a><a href="#h68-0-135" id="h68-0-135" class="i">+ * edit the CLEANMASK() macro.
</a><a href="#h68-0-136" id="h68-0-136" class="i">+ */
</a><a href="#h68-0-137" id="h68-0-137" class="i">+static Key keys[] = {
</a><a href="#h68-0-138" id="h68-0-138" class="i">+	/* modifier              keyval          function    arg */
</a><a href="#h68-0-139" id="h68-0-139" class="i">+	{ MODKEY,                GDK_KEY_g,      spawn,      SETPROP(&quot;_SURF_URI&quot;, &quot;_SURF_GO&quot;, PROMPT_GO) },
</a><a href="#h68-0-140" id="h68-0-140" class="i">+	{ MODKEY,                GDK_KEY_f,      spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;, PROMPT_FIND) },
</a><a href="#h68-0-141" id="h68-0-141" class="i">+	{ MODKEY,                GDK_KEY_slash,  spawn,      SETPROP(&quot;_SURF_FIND&quot;, &quot;_SURF_FIND&quot;, PROMPT_FIND) },
</a><a href="#h68-0-142" id="h68-0-142" class="i">+
</a><a href="#h68-0-143" id="h68-0-143" class="i">+	{ 0,                     GDK_KEY_Escape, stop,       { 0 } },
</a><a href="#h68-0-144" id="h68-0-144" class="i">+	{ MODKEY,                GDK_KEY_c,      stop,       { 0 } },
</a><a href="#h68-0-145" id="h68-0-145" class="i">+
</a><a href="#h68-0-146" id="h68-0-146" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_r,      reload,     { .i = 1 } },
</a><a href="#h68-0-147" id="h68-0-147" class="i">+	{ MODKEY,                GDK_KEY_r,      reload,     { .i = 0 } },
</a><a href="#h68-0-148" id="h68-0-148" class="i">+
</a><a href="#h68-0-149" id="h68-0-149" class="i">+	{ MODKEY,                GDK_KEY_l,      navigate,   { .i = +1 } },
</a><a href="#h68-0-150" id="h68-0-150" class="i">+	{ MODKEY,                GDK_KEY_h,      navigate,   { .i = -1 } },
</a><a href="#h68-0-151" id="h68-0-151" class="i">+
</a><a href="#h68-0-152" id="h68-0-152" class="i">+	/* vertical and horizontal scrolling, in viewport percentage */
</a><a href="#h68-0-153" id="h68-0-153" class="i">+	{ MODKEY,                GDK_KEY_j,      scrollv,    { .i = +10 } },
</a><a href="#h68-0-154" id="h68-0-154" class="i">+	{ MODKEY,                GDK_KEY_k,      scrollv,    { .i = -10 } },
</a><a href="#h68-0-155" id="h68-0-155" class="i">+	{ MODKEY,                GDK_KEY_space,  scrollv,    { .i = +50 } },
</a><a href="#h68-0-156" id="h68-0-156" class="i">+	{ MODKEY,                GDK_KEY_b,      scrollv,    { .i = -50 } },
</a><a href="#h68-0-157" id="h68-0-157" class="i">+	{ MODKEY,                GDK_KEY_i,      scrollh,    { .i = +10 } },
</a><a href="#h68-0-158" id="h68-0-158" class="i">+	{ MODKEY,                GDK_KEY_u,      scrollh,    { .i = -10 } },
</a><a href="#h68-0-159" id="h68-0-159" class="i">+
</a><a href="#h68-0-160" id="h68-0-160" class="i">+
</a><a href="#h68-0-161" id="h68-0-161" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_j,      zoom,       { .i = -1 } },
</a><a href="#h68-0-162" id="h68-0-162" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_k,      zoom,       { .i = +1 } },
</a><a href="#h68-0-163" id="h68-0-163" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_q,      zoom,       { .i = 0  } },
</a><a href="#h68-0-164" id="h68-0-164" class="i">+	{ MODKEY,                GDK_KEY_minus,  zoom,       { .i = -1 } },
</a><a href="#h68-0-165" id="h68-0-165" class="i">+	{ MODKEY,                GDK_KEY_plus,   zoom,       { .i = +1 } },
</a><a href="#h68-0-166" id="h68-0-166" class="i">+
</a><a href="#h68-0-167" id="h68-0-167" class="i">+	{ MODKEY,                GDK_KEY_p,      clipboard,  { .i = 1 } },
</a><a href="#h68-0-168" id="h68-0-168" class="i">+	{ MODKEY,                GDK_KEY_y,      clipboard,  { .i = 0 } },
</a><a href="#h68-0-169" id="h68-0-169" class="i">+
</a><a href="#h68-0-170" id="h68-0-170" class="i">+	{ MODKEY,                GDK_KEY_n,      find,       { .i = +1 } },
</a><a href="#h68-0-171" id="h68-0-171" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_n,      find,       { .i = -1 } },
</a><a href="#h68-0-172" id="h68-0-172" class="i">+
</a><a href="#h68-0-173" id="h68-0-173" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_p,      print,      { 0 } },
</a><a href="#h68-0-174" id="h68-0-174" class="i">+	{ MODKEY,                GDK_KEY_t,      showcert,   { 0 } },
</a><a href="#h68-0-175" id="h68-0-175" class="i">+
</a><a href="#h68-0-176" id="h68-0-176" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_a,      togglecookiepolicy, { 0 } },
</a><a href="#h68-0-177" id="h68-0-177" class="i">+	{ 0,                     GDK_KEY_F11,    togglefullscreen, { 0 } },
</a><a href="#h68-0-178" id="h68-0-178" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_o,      toggleinspector, { 0 } },
</a><a href="#h68-0-179" id="h68-0-179" class="i">+
</a><a href="#h68-0-180" id="h68-0-180" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_c,      toggle,     { .i = CaretBrowsing } },
</a><a href="#h68-0-181" id="h68-0-181" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_f,      toggle,     { .i = FrameFlattening } },
</a><a href="#h68-0-182" id="h68-0-182" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_g,      toggle,     { .i = Geolocation } },
</a><a href="#h68-0-183" id="h68-0-183" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_s,      toggle,     { .i = JavaScript } },
</a><a href="#h68-0-184" id="h68-0-184" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_i,      toggle,     { .i = LoadImages } },
</a><a href="#h68-0-185" id="h68-0-185" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_v,      toggle,     { .i = Plugins } },
</a><a href="#h68-0-186" id="h68-0-186" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_b,      toggle,     { .i = ScrollBars } },
</a><a href="#h68-0-187" id="h68-0-187" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_t,      toggle,     { .i = StrictTLS } },
</a><a href="#h68-0-188" id="h68-0-188" class="i">+	{ MODKEY|GDK_SHIFT_MASK, GDK_KEY_m,      toggle,     { .i = Style } },
</a><a href="#h68-0-189" id="h68-0-189" class="i">+};
</a><a href="#h68-0-190" id="h68-0-190" class="i">+
</a><a href="#h68-0-191" id="h68-0-191" class="i">+/* button definitions */
</a><a href="#h68-0-192" id="h68-0-192" class="i">+/* target can be OnDoc, OnLink, OnImg, OnMedia, OnEdit, OnBar, OnSel, OnAny */
</a><a href="#h68-0-193" id="h68-0-193" class="i">+static Button buttons[] = {
</a><a href="#h68-0-194" id="h68-0-194" class="i">+	/* target       event mask      button  function        argument        stop event */
</a><a href="#h68-0-195" id="h68-0-195" class="i">+	{ OnLink,       0,              2,      clicknewwindow, { .i = 0 },     1 },
</a><a href="#h68-0-196" id="h68-0-196" class="i">+	{ OnLink,       MODKEY,         2,      clicknewwindow, { .i = 1 },     1 },
</a><a href="#h68-0-197" id="h68-0-197" class="i">+	{ OnLink,       MODKEY,         1,      clicknewwindow, { .i = 1 },     1 },
</a><a href="#h68-0-198" id="h68-0-198" class="i">+	{ OnAny,        0,              8,      clicknavigate,  { .i = -1 },    1 },
</a><a href="#h68-0-199" id="h68-0-199" class="i">+	{ OnAny,        0,              9,      clicknavigate,  { .i = +1 },    1 },
</a><a href="#h68-0-200" id="h68-0-200" class="i">+	{ OnMedia,      MODKEY,         1,      clickexternplayer, { 0 },       1 },
</a><a href="#h68-0-201" id="h68-0-201" class="i">+};
</a><b>diff --git a/<a id="h69" href="../file/surf/config.mk.html">surf/config.mk</a> b/<a href="../file/surf/config.mk.html">surf/config.mk</a></b>
<a href="#h69-0" id="h69-0" class="h">@@ -0,0 +1,31 @@
</a><a href="#h69-0-0" id="h69-0-0" class="i">+# surf version
</a><a href="#h69-0-1" id="h69-0-1" class="i">+VERSION = 2.0
</a><a href="#h69-0-2" id="h69-0-2" class="i">+
</a><a href="#h69-0-3" id="h69-0-3" class="i">+# Customize below to fit your system
</a><a href="#h69-0-4" id="h69-0-4" class="i">+
</a><a href="#h69-0-5" id="h69-0-5" class="i">+# paths
</a><a href="#h69-0-6" id="h69-0-6" class="i">+PREFIX = /usr/local
</a><a href="#h69-0-7" id="h69-0-7" class="i">+MANPREFIX = $(PREFIX)/share/man
</a><a href="#h69-0-8" id="h69-0-8" class="i">+LIBPREFIX = $(PREFIX)/lib
</a><a href="#h69-0-9" id="h69-0-9" class="i">+LIBDIR = $(LIBPREFIX)/surf
</a><a href="#h69-0-10" id="h69-0-10" class="i">+
</a><a href="#h69-0-11" id="h69-0-11" class="i">+X11INC = `pkg-config --cflags x11`
</a><a href="#h69-0-12" id="h69-0-12" class="i">+X11LIB = `pkg-config --libs x11`
</a><a href="#h69-0-13" id="h69-0-13" class="i">+
</a><a href="#h69-0-14" id="h69-0-14" class="i">+GTKINC = `pkg-config --cflags gtk+-3.0 gcr-3 webkit2gtk-4.0`
</a><a href="#h69-0-15" id="h69-0-15" class="i">+GTKLIB = `pkg-config --libs gtk+-3.0 gcr-3 webkit2gtk-4.0`
</a><a href="#h69-0-16" id="h69-0-16" class="i">+WEBEXTINC = `pkg-config --cflags webkit2gtk-4.0 webkit2gtk-web-extension-4.0`
</a><a href="#h69-0-17" id="h69-0-17" class="i">+WEBEXTLIBS = `pkg-config --libs webkit2gtk-4.0 webkit2gtk-web-extension-4.0`
</a><a href="#h69-0-18" id="h69-0-18" class="i">+
</a><a href="#h69-0-19" id="h69-0-19" class="i">+# includes and libs
</a><a href="#h69-0-20" id="h69-0-20" class="i">+INCS = $(X11INC) $(GTKINC)
</a><a href="#h69-0-21" id="h69-0-21" class="i">+LIBS = $(X11LIB) $(GTKLIB) -lgthread-2.0
</a><a href="#h69-0-22" id="h69-0-22" class="i">+
</a><a href="#h69-0-23" id="h69-0-23" class="i">+# flags
</a><a href="#h69-0-24" id="h69-0-24" class="i">+CPPFLAGS = -DVERSION=\&quot;$(VERSION)\&quot; -DWEBEXTDIR=\&quot;$(LIBDIR)\&quot; \
</a><a href="#h69-0-25" id="h69-0-25" class="i">+           -D_DEFAULT_SOURCE -DGCR_API_SUBJECT_TO_CHANGE
</a><a href="#h69-0-26" id="h69-0-26" class="i">+SURFCFLAGS = $(INCS) $(CPPFLAGS) -fPIC
</a><a href="#h69-0-27" id="h69-0-27" class="i">+WEBEXTCFLAGS = -fPIC $(WEBEXTINC)
</a><a href="#h69-0-28" id="h69-0-28" class="i">+
</a><a href="#h69-0-29" id="h69-0-29" class="i">+# compiler
</a><a href="#h69-0-30" id="h69-0-30" class="i">+#CC = c99
</a><b>diff --git a/<a id="h70" href="../file/surf/libsurf-webext.c.html">surf/libsurf-webext.c</a> b/<a href="../file/surf/libsurf-webext.c.html">surf/libsurf-webext.c</a></b>
<a href="#h70-0" id="h70-0" class="h">@@ -0,0 +1,128 @@
</a><a href="#h70-0-0" id="h70-0-0" class="i">+#include &lt;sys/stat.h&gt;
</a><a href="#h70-0-1" id="h70-0-1" class="i">+#include &lt;fcntl.h&gt;
</a><a href="#h70-0-2" id="h70-0-2" class="i">+#include &lt;limits.h&gt;
</a><a href="#h70-0-3" id="h70-0-3" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h70-0-4" id="h70-0-4" class="i">+
</a><a href="#h70-0-5" id="h70-0-5" class="i">+#include &lt;gio/gio.h&gt;
</a><a href="#h70-0-6" id="h70-0-6" class="i">+#include &lt;webkit2/webkit-web-extension.h&gt;
</a><a href="#h70-0-7" id="h70-0-7" class="i">+#include &lt;webkitdom/webkitdom.h&gt;
</a><a href="#h70-0-8" id="h70-0-8" class="i">+#include &lt;webkitdom/WebKitDOMDOMWindowUnstable.h&gt;
</a><a href="#h70-0-9" id="h70-0-9" class="i">+
</a><a href="#h70-0-10" id="h70-0-10" class="i">+#include &quot;common.h&quot;
</a><a href="#h70-0-11" id="h70-0-11" class="i">+
</a><a href="#h70-0-12" id="h70-0-12" class="i">+#define LENGTH(x)   (sizeof(x) / sizeof(x[0]))
</a><a href="#h70-0-13" id="h70-0-13" class="i">+
</a><a href="#h70-0-14" id="h70-0-14" class="i">+typedef struct Page {
</a><a href="#h70-0-15" id="h70-0-15" class="i">+	guint64 id;
</a><a href="#h70-0-16" id="h70-0-16" class="i">+	WebKitWebPage *webpage;
</a><a href="#h70-0-17" id="h70-0-17" class="i">+	struct Page *next;
</a><a href="#h70-0-18" id="h70-0-18" class="i">+} Page;
</a><a href="#h70-0-19" id="h70-0-19" class="i">+
</a><a href="#h70-0-20" id="h70-0-20" class="i">+static int pipein, pipeout;
</a><a href="#h70-0-21" id="h70-0-21" class="i">+static Page *pages;
</a><a href="#h70-0-22" id="h70-0-22" class="i">+
</a><a href="#h70-0-23" id="h70-0-23" class="i">+Page *
</a><a href="#h70-0-24" id="h70-0-24" class="i">+newpage(WebKitWebPage *page)
</a><a href="#h70-0-25" id="h70-0-25" class="i">+{
</a><a href="#h70-0-26" id="h70-0-26" class="i">+	Page *p;
</a><a href="#h70-0-27" id="h70-0-27" class="i">+
</a><a href="#h70-0-28" id="h70-0-28" class="i">+	if (!(p = calloc(1, sizeof(Page))))
</a><a href="#h70-0-29" id="h70-0-29" class="i">+		die(&quot;Cannot malloc!\n&quot;);
</a><a href="#h70-0-30" id="h70-0-30" class="i">+
</a><a href="#h70-0-31" id="h70-0-31" class="i">+	p-&gt;next = pages;
</a><a href="#h70-0-32" id="h70-0-32" class="i">+	pages = p;
</a><a href="#h70-0-33" id="h70-0-33" class="i">+
</a><a href="#h70-0-34" id="h70-0-34" class="i">+	p-&gt;id = webkit_web_page_get_id(page);
</a><a href="#h70-0-35" id="h70-0-35" class="i">+	p-&gt;webpage = page;
</a><a href="#h70-0-36" id="h70-0-36" class="i">+
</a><a href="#h70-0-37" id="h70-0-37" class="i">+	return p;
</a><a href="#h70-0-38" id="h70-0-38" class="i">+}
</a><a href="#h70-0-39" id="h70-0-39" class="i">+
</a><a href="#h70-0-40" id="h70-0-40" class="i">+static void
</a><a href="#h70-0-41" id="h70-0-41" class="i">+msgsurf(Page *p, const char *s)
</a><a href="#h70-0-42" id="h70-0-42" class="i">+{
</a><a href="#h70-0-43" id="h70-0-43" class="i">+	static char msg[MSGBUFSZ];
</a><a href="#h70-0-44" id="h70-0-44" class="i">+	size_t sln = strlen(s);
</a><a href="#h70-0-45" id="h70-0-45" class="i">+	int ret;
</a><a href="#h70-0-46" id="h70-0-46" class="i">+
</a><a href="#h70-0-47" id="h70-0-47" class="i">+	if ((ret = snprintf(msg, sizeof(msg), &quot;%c%c%s&quot;,
</a><a href="#h70-0-48" id="h70-0-48" class="i">+	                    2 + sln, p ? p-&gt;id : 0, s))
</a><a href="#h70-0-49" id="h70-0-49" class="i">+	    &gt;= sizeof(msg)) {
</a><a href="#h70-0-50" id="h70-0-50" class="i">+		fprintf(stderr, &quot;webext: message too long: %d\n&quot;, ret);
</a><a href="#h70-0-51" id="h70-0-51" class="i">+		return;
</a><a href="#h70-0-52" id="h70-0-52" class="i">+	}
</a><a href="#h70-0-53" id="h70-0-53" class="i">+
</a><a href="#h70-0-54" id="h70-0-54" class="i">+	if (pipeout &amp;&amp; write(pipeout, msg, sizeof(msg)) &lt; 0)
</a><a href="#h70-0-55" id="h70-0-55" class="i">+		fprintf(stderr, &quot;webext: error sending: %.*s\n&quot;, ret-2, msg+2);
</a><a href="#h70-0-56" id="h70-0-56" class="i">+}
</a><a href="#h70-0-57" id="h70-0-57" class="i">+
</a><a href="#h70-0-58" id="h70-0-58" class="i">+static gboolean
</a><a href="#h70-0-59" id="h70-0-59" class="i">+readpipe(GIOChannel *s, GIOCondition c, gpointer unused)
</a><a href="#h70-0-60" id="h70-0-60" class="i">+{
</a><a href="#h70-0-61" id="h70-0-61" class="i">+	static char msg[MSGBUFSZ], msgsz;
</a><a href="#h70-0-62" id="h70-0-62" class="i">+	WebKitDOMDOMWindow *view;
</a><a href="#h70-0-63" id="h70-0-63" class="i">+	GError *gerr = NULL;
</a><a href="#h70-0-64" id="h70-0-64" class="i">+	glong wh, ww;
</a><a href="#h70-0-65" id="h70-0-65" class="i">+	Page *p;
</a><a href="#h70-0-66" id="h70-0-66" class="i">+
</a><a href="#h70-0-67" id="h70-0-67" class="i">+	if (g_io_channel_read_chars(s, msg, LENGTH(msg), NULL, &amp;gerr) !=
</a><a href="#h70-0-68" id="h70-0-68" class="i">+	    G_IO_STATUS_NORMAL) {
</a><a href="#h70-0-69" id="h70-0-69" class="i">+		fprintf(stderr, &quot;webext: error reading pipe: %s\n&quot;,
</a><a href="#h70-0-70" id="h70-0-70" class="i">+		        gerr-&gt;message);
</a><a href="#h70-0-71" id="h70-0-71" class="i">+		g_error_free(gerr);
</a><a href="#h70-0-72" id="h70-0-72" class="i">+		return TRUE;
</a><a href="#h70-0-73" id="h70-0-73" class="i">+	}
</a><a href="#h70-0-74" id="h70-0-74" class="i">+	if ((msgsz = msg[0]) &lt; 3) {
</a><a href="#h70-0-75" id="h70-0-75" class="i">+		fprintf(stderr, &quot;webext: message too short: %d\n&quot;, msgsz);
</a><a href="#h70-0-76" id="h70-0-76" class="i">+		return TRUE;
</a><a href="#h70-0-77" id="h70-0-77" class="i">+	}
</a><a href="#h70-0-78" id="h70-0-78" class="i">+
</a><a href="#h70-0-79" id="h70-0-79" class="i">+	for (p = pages; p; p = p-&gt;next) {
</a><a href="#h70-0-80" id="h70-0-80" class="i">+		if (p-&gt;id == msg[1])
</a><a href="#h70-0-81" id="h70-0-81" class="i">+			break;
</a><a href="#h70-0-82" id="h70-0-82" class="i">+	}
</a><a href="#h70-0-83" id="h70-0-83" class="i">+	if (!p || !(view = webkit_dom_document_get_default_view(
</a><a href="#h70-0-84" id="h70-0-84" class="i">+	            webkit_web_page_get_dom_document(p-&gt;webpage))))
</a><a href="#h70-0-85" id="h70-0-85" class="i">+		return TRUE;
</a><a href="#h70-0-86" id="h70-0-86" class="i">+
</a><a href="#h70-0-87" id="h70-0-87" class="i">+	switch (msg[2]) {
</a><a href="#h70-0-88" id="h70-0-88" class="i">+	case &#39;h&#39;:
</a><a href="#h70-0-89" id="h70-0-89" class="i">+		if (msgsz != 4)
</a><a href="#h70-0-90" id="h70-0-90" class="i">+			return TRUE;
</a><a href="#h70-0-91" id="h70-0-91" class="i">+		ww = webkit_dom_dom_window_get_inner_width(view);
</a><a href="#h70-0-92" id="h70-0-92" class="i">+		webkit_dom_dom_window_scroll_by(view,
</a><a href="#h70-0-93" id="h70-0-93" class="i">+		                                (ww / 100) * msg[3], 0);
</a><a href="#h70-0-94" id="h70-0-94" class="i">+		break;
</a><a href="#h70-0-95" id="h70-0-95" class="i">+	case &#39;v&#39;:
</a><a href="#h70-0-96" id="h70-0-96" class="i">+		if (msgsz != 4)
</a><a href="#h70-0-97" id="h70-0-97" class="i">+			return TRUE;
</a><a href="#h70-0-98" id="h70-0-98" class="i">+		wh = webkit_dom_dom_window_get_inner_height(view);
</a><a href="#h70-0-99" id="h70-0-99" class="i">+		webkit_dom_dom_window_scroll_by(view,
</a><a href="#h70-0-100" id="h70-0-100" class="i">+		                                0, (wh / 100) * msg[3]);
</a><a href="#h70-0-101" id="h70-0-101" class="i">+		break;
</a><a href="#h70-0-102" id="h70-0-102" class="i">+	}
</a><a href="#h70-0-103" id="h70-0-103" class="i">+
</a><a href="#h70-0-104" id="h70-0-104" class="i">+	return TRUE;
</a><a href="#h70-0-105" id="h70-0-105" class="i">+}
</a><a href="#h70-0-106" id="h70-0-106" class="i">+
</a><a href="#h70-0-107" id="h70-0-107" class="i">+static void
</a><a href="#h70-0-108" id="h70-0-108" class="i">+webpagecreated(WebKitWebExtension *e, WebKitWebPage *wp, gpointer unused)
</a><a href="#h70-0-109" id="h70-0-109" class="i">+{
</a><a href="#h70-0-110" id="h70-0-110" class="i">+	Page *p = newpage(wp);
</a><a href="#h70-0-111" id="h70-0-111" class="i">+}
</a><a href="#h70-0-112" id="h70-0-112" class="i">+
</a><a href="#h70-0-113" id="h70-0-113" class="i">+G_MODULE_EXPORT void
</a><a href="#h70-0-114" id="h70-0-114" class="i">+webkit_web_extension_initialize_with_user_data(WebKitWebExtension *e, GVariant *gv)
</a><a href="#h70-0-115" id="h70-0-115" class="i">+{
</a><a href="#h70-0-116" id="h70-0-116" class="i">+	GIOChannel *gchanpipe;
</a><a href="#h70-0-117" id="h70-0-117" class="i">+
</a><a href="#h70-0-118" id="h70-0-118" class="i">+	g_signal_connect(e, &quot;page-created&quot;, G_CALLBACK(webpagecreated), NULL);
</a><a href="#h70-0-119" id="h70-0-119" class="i">+
</a><a href="#h70-0-120" id="h70-0-120" class="i">+	g_variant_get(gv, &quot;(ii)&quot;, &amp;pipein, &amp;pipeout);
</a><a href="#h70-0-121" id="h70-0-121" class="i">+	msgsurf(NULL, &quot;i&quot;);
</a><a href="#h70-0-122" id="h70-0-122" class="i">+
</a><a href="#h70-0-123" id="h70-0-123" class="i">+	gchanpipe = g_io_channel_unix_new(pipein);
</a><a href="#h70-0-124" id="h70-0-124" class="i">+	g_io_channel_set_encoding(gchanpipe, NULL, NULL);
</a><a href="#h70-0-125" id="h70-0-125" class="i">+	g_io_channel_set_close_on_unref(gchanpipe, TRUE);
</a><a href="#h70-0-126" id="h70-0-126" class="i">+	g_io_add_watch(gchanpipe, G_IO_IN, readpipe, NULL);
</a><a href="#h70-0-127" id="h70-0-127" class="i">+}
</a><b>diff --git a/<a id="h71" href="../file/surf/libsurf-webext.o.html">surf/libsurf-webext.o</a> b/<a href="../file/surf/libsurf-webext.o.html">surf/libsurf-webext.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h72" href="../file/surf/libsurf-webext.so.html">surf/libsurf-webext.so</a> b/<a href="../file/surf/libsurf-webext.so.html">surf/libsurf-webext.so</a></b>
Binary files differ.
<b>diff --git a/<a id="h73" href="../file/surf/surf.html">surf/surf</a> b/<a href="../file/surf/surf.html">surf/surf</a></b>
Binary files differ.
<b>diff --git a/<a id="h74" href="../file/surf/surf-open.sh.html">surf/surf-open.sh</a> b/<a href="../file/surf/surf-open.sh.html">surf/surf-open.sh</a></b>
<a href="#h74-0" id="h74-0" class="h">@@ -0,0 +1,32 @@
</a><a href="#h74-0-0" id="h74-0-0" class="i">+#!/bin/sh
</a><a href="#h74-0-1" id="h74-0-1" class="i">+#
</a><a href="#h74-0-2" id="h74-0-2" class="i">+# See the LICENSE file for copyright and license details. 
</a><a href="#h74-0-3" id="h74-0-3" class="i">+#
</a><a href="#h74-0-4" id="h74-0-4" class="i">+
</a><a href="#h74-0-5" id="h74-0-5" class="i">+xidfile=&quot;$HOME/tmp/tabbed-surf.xid&quot;
</a><a href="#h74-0-6" id="h74-0-6" class="i">+uri=&quot;&quot;
</a><a href="#h74-0-7" id="h74-0-7" class="i">+
</a><a href="#h74-0-8" id="h74-0-8" class="i">+if [ &quot;$#&quot; -gt 0 ];
</a><a href="#h74-0-9" id="h74-0-9" class="i">+then
</a><a href="#h74-0-10" id="h74-0-10" class="i">+	uri=&quot;$1&quot;
</a><a href="#h74-0-11" id="h74-0-11" class="i">+fi
</a><a href="#h74-0-12" id="h74-0-12" class="i">+
</a><a href="#h74-0-13" id="h74-0-13" class="i">+runtabbed() {
</a><a href="#h74-0-14" id="h74-0-14" class="i">+	tabbed -dn tabbed-surf -r 2 surf -e &#39;&#39; &quot;$uri&quot; &gt;&quot;$xidfile&quot; \
</a><a href="#h74-0-15" id="h74-0-15" class="i">+		2&gt;/dev/null &amp;
</a><a href="#h74-0-16" id="h74-0-16" class="i">+}
</a><a href="#h74-0-17" id="h74-0-17" class="i">+
</a><a href="#h74-0-18" id="h74-0-18" class="i">+if [ ! -r &quot;$xidfile&quot; ];
</a><a href="#h74-0-19" id="h74-0-19" class="i">+then
</a><a href="#h74-0-20" id="h74-0-20" class="i">+	runtabbed
</a><a href="#h74-0-21" id="h74-0-21" class="i">+else
</a><a href="#h74-0-22" id="h74-0-22" class="i">+	xid=$(cat &quot;$xidfile&quot;)
</a><a href="#h74-0-23" id="h74-0-23" class="i">+	xprop -id &quot;$xid&quot; &gt;/dev/null 2&gt;&amp;1
</a><a href="#h74-0-24" id="h74-0-24" class="i">+	if [ $? -gt 0 ];
</a><a href="#h74-0-25" id="h74-0-25" class="i">+	then
</a><a href="#h74-0-26" id="h74-0-26" class="i">+		runtabbed
</a><a href="#h74-0-27" id="h74-0-27" class="i">+	else
</a><a href="#h74-0-28" id="h74-0-28" class="i">+		surf -e &quot;$xid&quot; &quot;$uri&quot; &gt;/dev/null 2&gt;&amp;1 &amp;
</a><a href="#h74-0-29" id="h74-0-29" class="i">+	fi
</a><a href="#h74-0-30" id="h74-0-30" class="i">+fi
</a><a href="#h74-0-31" id="h74-0-31" class="i">+
</a><b>diff --git a/<a id="h75" href="../file/surf/surf-patches/searchengines.diff.html">surf/surf-patches/searchengines.diff</a> b/<a href="../file/surf/surf-patches/searchengines.diff.html">surf/surf-patches/searchengines.diff</a></b>
<a href="#h75-0" id="h75-0" class="h">@@ -0,0 +1,56 @@
</a><a href="#h75-0-0" id="h75-0-0" class="i">+diff --git a/surf.c b/surf.c
</a><a href="#h75-0-1" id="h75-0-1" class="i">+index 93a1629..eb2af97 100644
</a><a href="#h75-0-2" id="h75-0-2" class="i">+--- a/surf.c
</a><a href="#h75-0-3" id="h75-0-3" class="i">++++ b/surf.c
</a><a href="#h75-0-4" id="h75-0-4" class="i">+@@ -129,6 +129,11 @@ typedef struct {
</a><a href="#h75-0-5" id="h75-0-5" class="i">+ } Button;
</a><a href="#h75-0-6" id="h75-0-6" class="i">+ 
</a><a href="#h75-0-7" id="h75-0-7" class="i">+ typedef struct {
</a><a href="#h75-0-8" id="h75-0-8" class="i">++	char *token;
</a><a href="#h75-0-9" id="h75-0-9" class="i">++	char *uri;
</a><a href="#h75-0-10" id="h75-0-10" class="i">++} SearchEngine;
</a><a href="#h75-0-11" id="h75-0-11" class="i">++
</a><a href="#h75-0-12" id="h75-0-12" class="i">++typedef struct {
</a><a href="#h75-0-13" id="h75-0-13" class="i">+ 	const char *uri;
</a><a href="#h75-0-14" id="h75-0-14" class="i">+ 	Parameter config[ParameterLast];
</a><a href="#h75-0-15" id="h75-0-15" class="i">+ 	regex_t re;
</a><a href="#h75-0-16" id="h75-0-16" class="i">+@@ -202,6 +207,7 @@ static void responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c);
</a><a href="#h75-0-17" id="h75-0-17" class="i">+ static void download(Client *c, WebKitURIResponse *r);
</a><a href="#h75-0-18" id="h75-0-18" class="i">+ static void closeview(WebKitWebView *v, Client *c);
</a><a href="#h75-0-19" id="h75-0-19" class="i">+ static void destroywin(GtkWidget* w, Client *c);
</a><a href="#h75-0-20" id="h75-0-20" class="i">++static gchar *parseuri(const gchar *uri);
</a><a href="#h75-0-21" id="h75-0-21" class="i">+ 
</a><a href="#h75-0-22" id="h75-0-22" class="i">+ /* Hotkeys */
</a><a href="#h75-0-23" id="h75-0-23" class="i">+ static void pasteuri(GtkClipboard *clipboard, const char *text, gpointer d);
</a><a href="#h75-0-24" id="h75-0-24" class="i">+@@ -477,7 +483,7 @@ loaduri(Client *c, const Arg *a)
</a><a href="#h75-0-25" id="h75-0-25" class="i">+ 		url = g_strdup_printf(&quot;file://%s&quot;, path);
</a><a href="#h75-0-26" id="h75-0-26" class="i">+ 		free(path);
</a><a href="#h75-0-27" id="h75-0-27" class="i">+ 	} else {
</a><a href="#h75-0-28" id="h75-0-28" class="i">+-		url = g_strdup_printf(&quot;http://%s&quot;, uri);
</a><a href="#h75-0-29" id="h75-0-29" class="i">++		url = parseuri(uri);
</a><a href="#h75-0-30" id="h75-0-30" class="i">+ 	}
</a><a href="#h75-0-31" id="h75-0-31" class="i">+ 
</a><a href="#h75-0-32" id="h75-0-32" class="i">+ 	setatom(c, AtomUri, url);
</a><a href="#h75-0-33" id="h75-0-33" class="i">+@@ -1461,6 +1467,22 @@ destroywin(GtkWidget* w, Client *c)
</a><a href="#h75-0-34" id="h75-0-34" class="i">+ 		gtk_main_quit();
</a><a href="#h75-0-35" id="h75-0-35" class="i">+ }
</a><a href="#h75-0-36" id="h75-0-36" class="i">+ 
</a><a href="#h75-0-37" id="h75-0-37" class="i">++gchar *
</a><a href="#h75-0-38" id="h75-0-38" class="i">++parseuri(const gchar *uri) {
</a><a href="#h75-0-39" id="h75-0-39" class="i">++	guint i;
</a><a href="#h75-0-40" id="h75-0-40" class="i">++
</a><a href="#h75-0-41" id="h75-0-41" class="i">++	for (i = 0; i &lt; LENGTH(searchengines); i++) {
</a><a href="#h75-0-42" id="h75-0-42" class="i">++		if (searchengines[i].token == NULL || searchengines[i].uri == NULL ||
</a><a href="#h75-0-43" id="h75-0-43" class="i">++		    *(uri + strlen(searchengines[i].token)) != &#39; &#39;)
</a><a href="#h75-0-44" id="h75-0-44" class="i">++			continue;
</a><a href="#h75-0-45" id="h75-0-45" class="i">++		if (g_str_has_prefix(uri, searchengines[i].token))
</a><a href="#h75-0-46" id="h75-0-46" class="i">++			return g_strdup_printf(searchengines[i].uri,
</a><a href="#h75-0-47" id="h75-0-47" class="i">++					       uri + strlen(searchengines[i].token) + 1);
</a><a href="#h75-0-48" id="h75-0-48" class="i">++	}
</a><a href="#h75-0-49" id="h75-0-49" class="i">++
</a><a href="#h75-0-50" id="h75-0-50" class="i">++	return g_strdup_printf(&quot;http://%s&quot;, uri);
</a><a href="#h75-0-51" id="h75-0-51" class="i">++}
</a><a href="#h75-0-52" id="h75-0-52" class="i">++
</a><a href="#h75-0-53" id="h75-0-53" class="i">+ void
</a><a href="#h75-0-54" id="h75-0-54" class="i">+ pasteuri(GtkClipboard *clipboard, const char *text, gpointer d)
</a><a href="#h75-0-55" id="h75-0-55" class="i">+ {
</a><b>diff --git a/<a id="h76" href="../file/surf/surf-patches/surf-homepage.diff.html">surf/surf-patches/surf-homepage.diff</a> b/<a href="../file/surf/surf-patches/surf-homepage.diff.html">surf/surf-patches/surf-homepage.diff</a></b>
<a href="#h76-0" id="h76-0" class="h">@@ -0,0 +1,24 @@
</a><a href="#h76-0-0" id="h76-0-0" class="i">+diff --git a/config.def.h b/config.def.h
</a><a href="#h76-0-1" id="h76-0-1" class="i">+--- a/config.def.h
</a><a href="#h76-0-2" id="h76-0-2" class="i">++++ b/config.def.h
</a><a href="#h76-0-3" id="h76-0-3" class="i">+@@ -164,3 +164,5 @@ static Button buttons[] = {
</a><a href="#h76-0-4" id="h76-0-4" class="i">+ 	{ OnAny,        0,              9,      clicknavigate,  { .i = +1 },    1 },
</a><a href="#h76-0-5" id="h76-0-5" class="i">+ 	{ OnMedia,      MODKEY,         1,      clickexternplayer, { 0 },       1 },
</a><a href="#h76-0-6" id="h76-0-6" class="i">+ };
</a><a href="#h76-0-7" id="h76-0-7" class="i">++
</a><a href="#h76-0-8" id="h76-0-8" class="i">++#define HOMEPAGE &quot;https://duckduckgo.com/&quot;
</a><a href="#h76-0-9" id="h76-0-9" class="i">+diff --git a/surf.c b/surf.c
</a><a href="#h76-0-10" id="h76-0-10" class="i">+--- a/surf.c
</a><a href="#h76-0-11" id="h76-0-11" class="i">++++ b/surf.c
</a><a href="#h76-0-12" id="h76-0-12" class="i">+@@ -1751,7 +1751,11 @@ main(int argc, char *argv[])
</a><a href="#h76-0-13" id="h76-0-13" class="i">+ 	if (argc &gt; 0)
</a><a href="#h76-0-14" id="h76-0-14" class="i">+ 		arg.v = argv[0];
</a><a href="#h76-0-15" id="h76-0-15" class="i">+ 	else
</a><a href="#h76-0-16" id="h76-0-16" class="i">++#ifdef HOMEPAGE
</a><a href="#h76-0-17" id="h76-0-17" class="i">++		arg.v = HOMEPAGE;
</a><a href="#h76-0-18" id="h76-0-18" class="i">++#else
</a><a href="#h76-0-19" id="h76-0-19" class="i">+ 		arg.v = &quot;about:blank&quot;;
</a><a href="#h76-0-20" id="h76-0-20" class="i">++#endif
</a><a href="#h76-0-21" id="h76-0-21" class="i">+ 
</a><a href="#h76-0-22" id="h76-0-22" class="i">+ 	setup();
</a><a href="#h76-0-23" id="h76-0-23" class="i">+ 	c = newclient(NULL);
</a><b>diff --git a/<a id="h77" href="../file/surf/surf.1.html">surf/surf.1</a> b/<a href="../file/surf/surf.1.html">surf/surf.1</a></b>
<a href="#h77-0" id="h77-0" class="h">@@ -0,0 +1,330 @@
</a><a href="#h77-0-0" id="h77-0-0" class="i">+.TH SURF 1 surf\-VERSION
</a><a href="#h77-0-1" id="h77-0-1" class="i">+.SH NAME
</a><a href="#h77-0-2" id="h77-0-2" class="i">+surf \- simple webkit-based browser
</a><a href="#h77-0-3" id="h77-0-3" class="i">+.SH SYNOPSIS
</a><a href="#h77-0-4" id="h77-0-4" class="i">+.B surf
</a><a href="#h77-0-5" id="h77-0-5" class="i">+.RB [-bBdDfFgGiIkKmMnNpPsStTvwxX]
</a><a href="#h77-0-6" id="h77-0-6" class="i">+.RB [-a\ cookiepolicies]
</a><a href="#h77-0-7" id="h77-0-7" class="i">+.RB [-c\ cookiefile]
</a><a href="#h77-0-8" id="h77-0-8" class="i">+.RB [-C\ stylefile]
</a><a href="#h77-0-9" id="h77-0-9" class="i">+.RB [-e\ xid]
</a><a href="#h77-0-10" id="h77-0-10" class="i">+.RB [-r\ scriptfile]
</a><a href="#h77-0-11" id="h77-0-11" class="i">+.RB [-u\ useragent]
</a><a href="#h77-0-12" id="h77-0-12" class="i">+.RB [-z\ zoomlevel]
</a><a href="#h77-0-13" id="h77-0-13" class="i">+.RB [URI]
</a><a href="#h77-0-14" id="h77-0-14" class="i">+.SH DESCRIPTION
</a><a href="#h77-0-15" id="h77-0-15" class="i">+surf is a simple Web browser based on WebKit/GTK+. It is able
</a><a href="#h77-0-16" id="h77-0-16" class="i">+to display websites and follow links. It supports the XEmbed protocol
</a><a href="#h77-0-17" id="h77-0-17" class="i">+which makes it possible to embed it in another application. Furthermore,
</a><a href="#h77-0-18" id="h77-0-18" class="i">+one can point surf to another URI by setting its XProperties.
</a><a href="#h77-0-19" id="h77-0-19" class="i">+.SH OPTIONS
</a><a href="#h77-0-20" id="h77-0-20" class="i">+.TP
</a><a href="#h77-0-21" id="h77-0-21" class="i">+.B \-a cookiepolicies
</a><a href="#h77-0-22" id="h77-0-22" class="i">+Define the order of
</a><a href="#h77-0-23" id="h77-0-23" class="i">+.I cookie policies\fR.
</a><a href="#h77-0-24" id="h77-0-24" class="i">+The default is &quot;@Aa&quot; but could be
</a><a href="#h77-0-25" id="h77-0-25" class="i">+redefined in the
</a><a href="#h77-0-26" id="h77-0-26" class="i">+.IR config.h ,
</a><a href="#h77-0-27" id="h77-0-27" class="i">+with &quot;A&quot; meaning to
</a><a href="#h77-0-28" id="h77-0-28" class="i">+accept all cookies, &quot;a&quot; to deny all cookies and &quot;@&quot;, which tells surf to
</a><a href="#h77-0-29" id="h77-0-29" class="i">+accept no third party cookies.
</a><a href="#h77-0-30" id="h77-0-30" class="i">+.TP
</a><a href="#h77-0-31" id="h77-0-31" class="i">+.B \-b
</a><a href="#h77-0-32" id="h77-0-32" class="i">+Disable Scrollbars.
</a><a href="#h77-0-33" id="h77-0-33" class="i">+.TP
</a><a href="#h77-0-34" id="h77-0-34" class="i">+.B \-B
</a><a href="#h77-0-35" id="h77-0-35" class="i">+Enable Scrollbars.
</a><a href="#h77-0-36" id="h77-0-36" class="i">+.TP
</a><a href="#h77-0-37" id="h77-0-37" class="i">+.B \-c cookiefile
</a><a href="#h77-0-38" id="h77-0-38" class="i">+Specify the
</a><a href="#h77-0-39" id="h77-0-39" class="i">+.I cookiefile
</a><a href="#h77-0-40" id="h77-0-40" class="i">+to use.
</a><a href="#h77-0-41" id="h77-0-41" class="i">+.TP
</a><a href="#h77-0-42" id="h77-0-42" class="i">+.B \-C stylefile
</a><a href="#h77-0-43" id="h77-0-43" class="i">+Specify the user
</a><a href="#h77-0-44" id="h77-0-44" class="i">+.IR stylefile .
</a><a href="#h77-0-45" id="h77-0-45" class="i">+This does disable the site-specific styles.
</a><a href="#h77-0-46" id="h77-0-46" class="i">+.TP
</a><a href="#h77-0-47" id="h77-0-47" class="i">+.B \-d
</a><a href="#h77-0-48" id="h77-0-48" class="i">+Disable the disk cache.
</a><a href="#h77-0-49" id="h77-0-49" class="i">+.TP
</a><a href="#h77-0-50" id="h77-0-50" class="i">+.B \-D
</a><a href="#h77-0-51" id="h77-0-51" class="i">+Enable the disk cache.
</a><a href="#h77-0-52" id="h77-0-52" class="i">+.TP
</a><a href="#h77-0-53" id="h77-0-53" class="i">+.B \-e xid
</a><a href="#h77-0-54" id="h77-0-54" class="i">+Reparents to window specified by
</a><a href="#h77-0-55" id="h77-0-55" class="i">+.IR xid .
</a><a href="#h77-0-56" id="h77-0-56" class="i">+.TP
</a><a href="#h77-0-57" id="h77-0-57" class="i">+.B \-f
</a><a href="#h77-0-58" id="h77-0-58" class="i">+Start surf in windowed mode (not fullscreen).
</a><a href="#h77-0-59" id="h77-0-59" class="i">+.TP
</a><a href="#h77-0-60" id="h77-0-60" class="i">+.B \-F
</a><a href="#h77-0-61" id="h77-0-61" class="i">+Start surf in fullscreen mode.
</a><a href="#h77-0-62" id="h77-0-62" class="i">+.TP
</a><a href="#h77-0-63" id="h77-0-63" class="i">+.B \-g
</a><a href="#h77-0-64" id="h77-0-64" class="i">+Disable giving the geolocation to websites.
</a><a href="#h77-0-65" id="h77-0-65" class="i">+.TP
</a><a href="#h77-0-66" id="h77-0-66" class="i">+.B \-G
</a><a href="#h77-0-67" id="h77-0-67" class="i">+Enable giving the geolocation to websites.
</a><a href="#h77-0-68" id="h77-0-68" class="i">+.TP
</a><a href="#h77-0-69" id="h77-0-69" class="i">+.B \-i
</a><a href="#h77-0-70" id="h77-0-70" class="i">+Disable Images.
</a><a href="#h77-0-71" id="h77-0-71" class="i">+.TP
</a><a href="#h77-0-72" id="h77-0-72" class="i">+.B \-I
</a><a href="#h77-0-73" id="h77-0-73" class="i">+Enable Images.
</a><a href="#h77-0-74" id="h77-0-74" class="i">+.TP
</a><a href="#h77-0-75" id="h77-0-75" class="i">+.B \-k
</a><a href="#h77-0-76" id="h77-0-76" class="i">+Disable kiosk mode (disable key strokes and right click).
</a><a href="#h77-0-77" id="h77-0-77" class="i">+.TP
</a><a href="#h77-0-78" id="h77-0-78" class="i">+.B \-K
</a><a href="#h77-0-79" id="h77-0-79" class="i">+Enable kiosk mode (disable key strokes and right click).
</a><a href="#h77-0-80" id="h77-0-80" class="i">+.TP
</a><a href="#h77-0-81" id="h77-0-81" class="i">+.B \-m
</a><a href="#h77-0-82" id="h77-0-82" class="i">+Disable application of user style sheets.
</a><a href="#h77-0-83" id="h77-0-83" class="i">+.TP
</a><a href="#h77-0-84" id="h77-0-84" class="i">+.B \-M
</a><a href="#h77-0-85" id="h77-0-85" class="i">+Enable application of user style sheets.
</a><a href="#h77-0-86" id="h77-0-86" class="i">+.TP
</a><a href="#h77-0-87" id="h77-0-87" class="i">+.B \-n
</a><a href="#h77-0-88" id="h77-0-88" class="i">+Disable the Web Inspector (Developer Tools).
</a><a href="#h77-0-89" id="h77-0-89" class="i">+.TP
</a><a href="#h77-0-90" id="h77-0-90" class="i">+.B \-N
</a><a href="#h77-0-91" id="h77-0-91" class="i">+Enable the Web Inspector (Developer Tools).
</a><a href="#h77-0-92" id="h77-0-92" class="i">+.TP
</a><a href="#h77-0-93" id="h77-0-93" class="i">+.B \-p
</a><a href="#h77-0-94" id="h77-0-94" class="i">+Disable Plugins.
</a><a href="#h77-0-95" id="h77-0-95" class="i">+.TP
</a><a href="#h77-0-96" id="h77-0-96" class="i">+.B \-P
</a><a href="#h77-0-97" id="h77-0-97" class="i">+Enable Plugins.
</a><a href="#h77-0-98" id="h77-0-98" class="i">+.TP
</a><a href="#h77-0-99" id="h77-0-99" class="i">+.B \-r scriptfile
</a><a href="#h77-0-100" id="h77-0-100" class="i">+Specify the user
</a><a href="#h77-0-101" id="h77-0-101" class="i">+.IR scriptfile .
</a><a href="#h77-0-102" id="h77-0-102" class="i">+.TP
</a><a href="#h77-0-103" id="h77-0-103" class="i">+.B \-s
</a><a href="#h77-0-104" id="h77-0-104" class="i">+Disable Javascript.
</a><a href="#h77-0-105" id="h77-0-105" class="i">+.TP
</a><a href="#h77-0-106" id="h77-0-106" class="i">+.B \-S
</a><a href="#h77-0-107" id="h77-0-107" class="i">+Enable Javascript.
</a><a href="#h77-0-108" id="h77-0-108" class="i">+.TP
</a><a href="#h77-0-109" id="h77-0-109" class="i">+.B \-t
</a><a href="#h77-0-110" id="h77-0-110" class="i">+Disable strict TLS check.
</a><a href="#h77-0-111" id="h77-0-111" class="i">+.TP
</a><a href="#h77-0-112" id="h77-0-112" class="i">+.B \-T
</a><a href="#h77-0-113" id="h77-0-113" class="i">+Enable strict TLS check.
</a><a href="#h77-0-114" id="h77-0-114" class="i">+.TP
</a><a href="#h77-0-115" id="h77-0-115" class="i">+.B \-u useragent
</a><a href="#h77-0-116" id="h77-0-116" class="i">+Specify the
</a><a href="#h77-0-117" id="h77-0-117" class="i">+.I useragent
</a><a href="#h77-0-118" id="h77-0-118" class="i">+which surf should use.
</a><a href="#h77-0-119" id="h77-0-119" class="i">+.TP
</a><a href="#h77-0-120" id="h77-0-120" class="i">+.B \-v
</a><a href="#h77-0-121" id="h77-0-121" class="i">+Prints version information to standard output, then exits.
</a><a href="#h77-0-122" id="h77-0-122" class="i">+.TP
</a><a href="#h77-0-123" id="h77-0-123" class="i">+.B \-w
</a><a href="#h77-0-124" id="h77-0-124" class="i">+Prints xid to standard output. This can be used to script the browser in for
</a><a href="#h77-0-125" id="h77-0-125" class="i">+example
</a><a href="#h77-0-126" id="h77-0-126" class="i">+.BR xdotool(1) .
</a><a href="#h77-0-127" id="h77-0-127" class="i">+.TP
</a><a href="#h77-0-128" id="h77-0-128" class="i">+.B -x
</a><a href="#h77-0-129" id="h77-0-129" class="i">+Disable custom certificates.
</a><a href="#h77-0-130" id="h77-0-130" class="i">+.TP
</a><a href="#h77-0-131" id="h77-0-131" class="i">+.B -X
</a><a href="#h77-0-132" id="h77-0-132" class="i">+Enable custom certificates.
</a><a href="#h77-0-133" id="h77-0-133" class="i">+.TP
</a><a href="#h77-0-134" id="h77-0-134" class="i">+.B \-z zoomlevel
</a><a href="#h77-0-135" id="h77-0-135" class="i">+Specify the
</a><a href="#h77-0-136" id="h77-0-136" class="i">+.I zoomlevel
</a><a href="#h77-0-137" id="h77-0-137" class="i">+which surf should use.
</a><a href="#h77-0-138" id="h77-0-138" class="i">+.SH USAGE
</a><a href="#h77-0-139" id="h77-0-139" class="i">+.B Escape
</a><a href="#h77-0-140" id="h77-0-140" class="i">+Stops loading current page or stops download.
</a><a href="#h77-0-141" id="h77-0-141" class="i">+.TP
</a><a href="#h77-0-142" id="h77-0-142" class="i">+.B Ctrl\-h
</a><a href="#h77-0-143" id="h77-0-143" class="i">+Walks back the history.
</a><a href="#h77-0-144" id="h77-0-144" class="i">+.TP
</a><a href="#h77-0-145" id="h77-0-145" class="i">+.B Ctrl\-l
</a><a href="#h77-0-146" id="h77-0-146" class="i">+Walks forward the history.
</a><a href="#h77-0-147" id="h77-0-147" class="i">+.TP
</a><a href="#h77-0-148" id="h77-0-148" class="i">+.B Ctrl\-k
</a><a href="#h77-0-149" id="h77-0-149" class="i">+Scrolls page upwards.
</a><a href="#h77-0-150" id="h77-0-150" class="i">+.TP
</a><a href="#h77-0-151" id="h77-0-151" class="i">+.B Ctrl\-j
</a><a href="#h77-0-152" id="h77-0-152" class="i">+Scrolls page downwards.
</a><a href="#h77-0-153" id="h77-0-153" class="i">+.TP
</a><a href="#h77-0-154" id="h77-0-154" class="i">+.B Ctrl\-b
</a><a href="#h77-0-155" id="h77-0-155" class="i">+Scroll up one whole page view.
</a><a href="#h77-0-156" id="h77-0-156" class="i">+.TP
</a><a href="#h77-0-157" id="h77-0-157" class="i">+.B Ctrl\-Space
</a><a href="#h77-0-158" id="h77-0-158" class="i">+Scroll down one whole page view.
</a><a href="#h77-0-159" id="h77-0-159" class="i">+.TP
</a><a href="#h77-0-160" id="h77-0-160" class="i">+.B Ctrl\-i
</a><a href="#h77-0-161" id="h77-0-161" class="i">+Scroll horizontally to the right.
</a><a href="#h77-0-162" id="h77-0-162" class="i">+.TP
</a><a href="#h77-0-163" id="h77-0-163" class="i">+.B Ctrl\-u
</a><a href="#h77-0-164" id="h77-0-164" class="i">+Scroll horizontally to the left.
</a><a href="#h77-0-165" id="h77-0-165" class="i">+.TP
</a><a href="#h77-0-166" id="h77-0-166" class="i">+.B Ctrl\-Shift\-k or Ctrl\-+
</a><a href="#h77-0-167" id="h77-0-167" class="i">+Zooms page in.
</a><a href="#h77-0-168" id="h77-0-168" class="i">+.TP
</a><a href="#h77-0-169" id="h77-0-169" class="i">+.B Ctrl\-Shift\-j or Ctrl\--
</a><a href="#h77-0-170" id="h77-0-170" class="i">+Zooms page out.
</a><a href="#h77-0-171" id="h77-0-171" class="i">+.TP
</a><a href="#h77-0-172" id="h77-0-172" class="i">+.B Ctrl\-Shift\-q
</a><a href="#h77-0-173" id="h77-0-173" class="i">+Resets Zoom.
</a><a href="#h77-0-174" id="h77-0-174" class="i">+.TP
</a><a href="#h77-0-175" id="h77-0-175" class="i">+.B Ctrl\-f and Ctrl\-/
</a><a href="#h77-0-176" id="h77-0-176" class="i">+Opens the search-bar.
</a><a href="#h77-0-177" id="h77-0-177" class="i">+.TP
</a><a href="#h77-0-178" id="h77-0-178" class="i">+.B Ctrl\-n
</a><a href="#h77-0-179" id="h77-0-179" class="i">+Go to next search result.
</a><a href="#h77-0-180" id="h77-0-180" class="i">+.TP
</a><a href="#h77-0-181" id="h77-0-181" class="i">+.B Ctrl\-Shift\-n
</a><a href="#h77-0-182" id="h77-0-182" class="i">+Go to previous search result.
</a><a href="#h77-0-183" id="h77-0-183" class="i">+.TP
</a><a href="#h77-0-184" id="h77-0-184" class="i">+.B Ctrl\-g
</a><a href="#h77-0-185" id="h77-0-185" class="i">+Opens the URL-bar (requires dmenu installed).
</a><a href="#h77-0-186" id="h77-0-186" class="i">+.TP
</a><a href="#h77-0-187" id="h77-0-187" class="i">+.B Ctrl\-p
</a><a href="#h77-0-188" id="h77-0-188" class="i">+Loads URI from primary selection.
</a><a href="#h77-0-189" id="h77-0-189" class="i">+.TP
</a><a href="#h77-0-190" id="h77-0-190" class="i">+.B Ctrl\-Shift\-p
</a><a href="#h77-0-191" id="h77-0-191" class="i">+Calls Printpage Dialog.
</a><a href="#h77-0-192" id="h77-0-192" class="i">+.TP
</a><a href="#h77-0-193" id="h77-0-193" class="i">+.B Ctrl\-r
</a><a href="#h77-0-194" id="h77-0-194" class="i">+Reloads the website.
</a><a href="#h77-0-195" id="h77-0-195" class="i">+.TP
</a><a href="#h77-0-196" id="h77-0-196" class="i">+.B Ctrl\-Shift\-r
</a><a href="#h77-0-197" id="h77-0-197" class="i">+Reloads the website without using the cache.
</a><a href="#h77-0-198" id="h77-0-198" class="i">+.TP
</a><a href="#h77-0-199" id="h77-0-199" class="i">+.B Ctrl\-y
</a><a href="#h77-0-200" id="h77-0-200" class="i">+Copies current URI to primary selection.
</a><a href="#h77-0-201" id="h77-0-201" class="i">+.TP
</a><a href="#h77-0-202" id="h77-0-202" class="i">+.B Ctrl\-t
</a><a href="#h77-0-203" id="h77-0-203" class="i">+Display the current TLS certificate in a popup window.
</a><a href="#h77-0-204" id="h77-0-204" class="i">+.TP
</a><a href="#h77-0-205" id="h77-0-205" class="i">+.B Ctrl\-Shift\-a
</a><a href="#h77-0-206" id="h77-0-206" class="i">+Toggle through the the
</a><a href="#h77-0-207" id="h77-0-207" class="i">+.I cookie policies\fR.
</a><a href="#h77-0-208" id="h77-0-208" class="i">+This will not reload the page.
</a><a href="#h77-0-209" id="h77-0-209" class="i">+.TP
</a><a href="#h77-0-210" id="h77-0-210" class="i">+.B Ctrl\-Shift\-b
</a><a href="#h77-0-211" id="h77-0-211" class="i">+Toggle scrollbars. This will reload the page.
</a><a href="#h77-0-212" id="h77-0-212" class="i">+.TP
</a><a href="#h77-0-213" id="h77-0-213" class="i">+.B Ctrl\-Shift\-c
</a><a href="#h77-0-214" id="h77-0-214" class="i">+Toggle caret browsing. This will reload the page.
</a><a href="#h77-0-215" id="h77-0-215" class="i">+.TP
</a><a href="#h77-0-216" id="h77-0-216" class="i">+.B Ctrl\-Shift\-i
</a><a href="#h77-0-217" id="h77-0-217" class="i">+Toggle auto-loading of images. This will reload the page.
</a><a href="#h77-0-218" id="h77-0-218" class="i">+.TP
</a><a href="#h77-0-219" id="h77-0-219" class="i">+.B Ctrl\-Shift\-m
</a><a href="#h77-0-220" id="h77-0-220" class="i">+Toggle if the
</a><a href="#h77-0-221" id="h77-0-221" class="i">+.I stylefile
</a><a href="#h77-0-222" id="h77-0-222" class="i">+file should be loaded. This will reload the page.
</a><a href="#h77-0-223" id="h77-0-223" class="i">+.TP
</a><a href="#h77-0-224" id="h77-0-224" class="i">+.B Ctrl\-Shift\-o
</a><a href="#h77-0-225" id="h77-0-225" class="i">+Open the Web Inspector (Developer Tools) window for the current page.
</a><a href="#h77-0-226" id="h77-0-226" class="i">+.TP
</a><a href="#h77-0-227" id="h77-0-227" class="i">+.B Ctrl\-Shift\-s
</a><a href="#h77-0-228" id="h77-0-228" class="i">+Toggle script execution. This will reload the page.
</a><a href="#h77-0-229" id="h77-0-229" class="i">+.TP
</a><a href="#h77-0-230" id="h77-0-230" class="i">+.B Ctrl\-Shift\-t
</a><a href="#h77-0-231" id="h77-0-231" class="i">+Toggle strict TLS check. This will reload the page.
</a><a href="#h77-0-232" id="h77-0-232" class="i">+.TP
</a><a href="#h77-0-233" id="h77-0-233" class="i">+.B Ctrl\-Shift\-v
</a><a href="#h77-0-234" id="h77-0-234" class="i">+Toggle the enabling of plugins on that surf instance. This will reload the
</a><a href="#h77-0-235" id="h77-0-235" class="i">+page.
</a><a href="#h77-0-236" id="h77-0-236" class="i">+.TP
</a><a href="#h77-0-237" id="h77-0-237" class="i">+.B F11
</a><a href="#h77-0-238" id="h77-0-238" class="i">+Toggle fullscreen mode.
</a><a href="#h77-0-239" id="h77-0-239" class="i">+.SH INDICATORS OF OPERATION
</a><a href="#h77-0-240" id="h77-0-240" class="i">+Surf is showing indicators of operation in front of the site title.
</a><a href="#h77-0-241" id="h77-0-241" class="i">+For all indicators, unless otherwise specified, a lower case letter means disabled and an upper case letter means enabled.
</a><a href="#h77-0-242" id="h77-0-242" class="i">+.TP
</a><a href="#h77-0-243" id="h77-0-243" class="i">+.B A
</a><a href="#h77-0-244" id="h77-0-244" class="i">+all cookies accepted
</a><a href="#h77-0-245" id="h77-0-245" class="i">+.TP
</a><a href="#h77-0-246" id="h77-0-246" class="i">+.B a
</a><a href="#h77-0-247" id="h77-0-247" class="i">+no cookies accepted
</a><a href="#h77-0-248" id="h77-0-248" class="i">+.TP
</a><a href="#h77-0-249" id="h77-0-249" class="i">+.B @
</a><a href="#h77-0-250" id="h77-0-250" class="i">+all except third-party cookies accepted
</a><a href="#h77-0-251" id="h77-0-251" class="i">+.TP
</a><a href="#h77-0-252" id="h77-0-252" class="i">+.B c C
</a><a href="#h77-0-253" id="h77-0-253" class="i">+caret browsing
</a><a href="#h77-0-254" id="h77-0-254" class="i">+.TP
</a><a href="#h77-0-255" id="h77-0-255" class="i">+.B g G
</a><a href="#h77-0-256" id="h77-0-256" class="i">+geolocation
</a><a href="#h77-0-257" id="h77-0-257" class="i">+.TP
</a><a href="#h77-0-258" id="h77-0-258" class="i">+.B d D
</a><a href="#h77-0-259" id="h77-0-259" class="i">+disk cache
</a><a href="#h77-0-260" id="h77-0-260" class="i">+.TP
</a><a href="#h77-0-261" id="h77-0-261" class="i">+.B i I
</a><a href="#h77-0-262" id="h77-0-262" class="i">+images
</a><a href="#h77-0-263" id="h77-0-263" class="i">+.TP
</a><a href="#h77-0-264" id="h77-0-264" class="i">+.B s S
</a><a href="#h77-0-265" id="h77-0-265" class="i">+scripts
</a><a href="#h77-0-266" id="h77-0-266" class="i">+.TP
</a><a href="#h77-0-267" id="h77-0-267" class="i">+.B v V
</a><a href="#h77-0-268" id="h77-0-268" class="i">+plugins
</a><a href="#h77-0-269" id="h77-0-269" class="i">+.TP
</a><a href="#h77-0-270" id="h77-0-270" class="i">+.B m M
</a><a href="#h77-0-271" id="h77-0-271" class="i">+styles
</a><a href="#h77-0-272" id="h77-0-272" class="i">+.TP
</a><a href="#h77-0-273" id="h77-0-273" class="i">+.B f F
</a><a href="#h77-0-274" id="h77-0-274" class="i">+frame flattening
</a><a href="#h77-0-275" id="h77-0-275" class="i">+.TP
</a><a href="#h77-0-276" id="h77-0-276" class="i">+.B x X
</a><a href="#h77-0-277" id="h77-0-277" class="i">+custom certificates
</a><a href="#h77-0-278" id="h77-0-278" class="i">+.TP
</a><a href="#h77-0-279" id="h77-0-279" class="i">+.B t T
</a><a href="#h77-0-280" id="h77-0-280" class="i">+strict TLS
</a><a href="#h77-0-281" id="h77-0-281" class="i">+.SH INDICATORS OF WEB PAGE
</a><a href="#h77-0-282" id="h77-0-282" class="i">+The second part of the indicators specifies modes of the web page itself.
</a><a href="#h77-0-283" id="h77-0-283" class="i">+.SS First character: encryption
</a><a href="#h77-0-284" id="h77-0-284" class="i">+.TP
</a><a href="#h77-0-285" id="h77-0-285" class="i">+.B -
</a><a href="#h77-0-286" id="h77-0-286" class="i">+unencrypted
</a><a href="#h77-0-287" id="h77-0-287" class="i">+.TP
</a><a href="#h77-0-288" id="h77-0-288" class="i">+.B T
</a><a href="#h77-0-289" id="h77-0-289" class="i">+encrypted (TLS)
</a><a href="#h77-0-290" id="h77-0-290" class="i">+.TP
</a><a href="#h77-0-291" id="h77-0-291" class="i">+.B U
</a><a href="#h77-0-292" id="h77-0-292" class="i">+attempted encryption but failed
</a><a href="#h77-0-293" id="h77-0-293" class="i">+.SS Second character: proxying
</a><a href="#h77-0-294" id="h77-0-294" class="i">+.TP
</a><a href="#h77-0-295" id="h77-0-295" class="i">+.B -
</a><a href="#h77-0-296" id="h77-0-296" class="i">+no proxy
</a><a href="#h77-0-297" id="h77-0-297" class="i">+.TP
</a><a href="#h77-0-298" id="h77-0-298" class="i">+.B P
</a><a href="#h77-0-299" id="h77-0-299" class="i">+using proxy
</a><a href="#h77-0-300" id="h77-0-300" class="i">+.SH ENVIRONMENT
</a><a href="#h77-0-301" id="h77-0-301" class="i">+.B SURF_USERAGENT
</a><a href="#h77-0-302" id="h77-0-302" class="i">+If this variable is set upon startup, surf will use it as the
</a><a href="#h77-0-303" id="h77-0-303" class="i">+.I useragent
</a><a href="#h77-0-304" id="h77-0-304" class="i">+string.
</a><a href="#h77-0-305" id="h77-0-305" class="i">+.TP
</a><a href="#h77-0-306" id="h77-0-306" class="i">+.B http_proxy
</a><a href="#h77-0-307" id="h77-0-307" class="i">+If this variable is set and not empty upon startup, surf will use it as the http proxy.
</a><a href="#h77-0-308" id="h77-0-308" class="i">+.SH SIGNALS
</a><a href="#h77-0-309" id="h77-0-309" class="i">+Surf will reload the current page on
</a><a href="#h77-0-310" id="h77-0-310" class="i">+.BR SIGHUP .
</a><a href="#h77-0-311" id="h77-0-311" class="i">+.SH PLUGINS
</a><a href="#h77-0-312" id="h77-0-312" class="i">+For using plugins in surf, first determine your running architecture. Then get
</a><a href="#h77-0-313" id="h77-0-313" class="i">+the appropriate plugin for that architecture and copy it to
</a><a href="#h77-0-314" id="h77-0-314" class="i">+.BR /usr/lib/browser-plugins
</a><a href="#h77-0-315" id="h77-0-315" class="i">+or
</a><a href="#h77-0-316" id="h77-0-316" class="i">+.BR /usr/lib64/browser-plugins.
</a><a href="#h77-0-317" id="h77-0-317" class="i">+Surf should load them automatically.
</a><a href="#h77-0-318" id="h77-0-318" class="i">+.BR
</a><a href="#h77-0-319" id="h77-0-319" class="i">+If you want to use a 32bit plugin on a 64bit system,
</a><a href="#h77-0-320" id="h77-0-320" class="i">+.BR nspluginwrapper(1)
</a><a href="#h77-0-321" id="h77-0-321" class="i">+will help you.
</a><a href="#h77-0-322" id="h77-0-322" class="i">+.SH SEE ALSO
</a><a href="#h77-0-323" id="h77-0-323" class="i">+.BR dmenu(1),
</a><a href="#h77-0-324" id="h77-0-324" class="i">+.BR xprop(1),
</a><a href="#h77-0-325" id="h77-0-325" class="i">+.BR tabbed(1),
</a><a href="#h77-0-326" id="h77-0-326" class="i">+.BR nspluginwrapper(1),
</a><a href="#h77-0-327" id="h77-0-327" class="i">+.BR xdotool(1)
</a><a href="#h77-0-328" id="h77-0-328" class="i">+.SH BUGS
</a><a href="#h77-0-329" id="h77-0-329" class="i">+Please report them!
</a><b>diff --git a/<a id="h78" href="../file/surf/surf.c.html">surf/surf.c</a> b/<a href="../file/surf/surf.c.html">surf/surf.c</a></b>
<a href="#h78-0" id="h78-0" class="h">@@ -0,0 +1,2153 @@
</a><a href="#h78-0-0" id="h78-0-0" class="i">+/* See LICENSE file for copyright and license details.
</a><a href="#h78-0-1" id="h78-0-1" class="i">+ *
</a><a href="#h78-0-2" id="h78-0-2" class="i">+ * To understand surf, start reading main().
</a><a href="#h78-0-3" id="h78-0-3" class="i">+ */
</a><a href="#h78-0-4" id="h78-0-4" class="i">+#include &lt;sys/file.h&gt;
</a><a href="#h78-0-5" id="h78-0-5" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h78-0-6" id="h78-0-6" class="i">+#include &lt;sys/wait.h&gt;
</a><a href="#h78-0-7" id="h78-0-7" class="i">+#include &lt;glib.h&gt;
</a><a href="#h78-0-8" id="h78-0-8" class="i">+#include &lt;libgen.h&gt;
</a><a href="#h78-0-9" id="h78-0-9" class="i">+#include &lt;limits.h&gt;
</a><a href="#h78-0-10" id="h78-0-10" class="i">+#include &lt;pwd.h&gt;
</a><a href="#h78-0-11" id="h78-0-11" class="i">+#include &lt;regex.h&gt;
</a><a href="#h78-0-12" id="h78-0-12" class="i">+#include &lt;signal.h&gt;
</a><a href="#h78-0-13" id="h78-0-13" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h78-0-14" id="h78-0-14" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h78-0-15" id="h78-0-15" class="i">+#include &lt;string.h&gt;
</a><a href="#h78-0-16" id="h78-0-16" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h78-0-17" id="h78-0-17" class="i">+
</a><a href="#h78-0-18" id="h78-0-18" class="i">+#include &lt;gdk/gdk.h&gt;
</a><a href="#h78-0-19" id="h78-0-19" class="i">+#include &lt;gdk/gdkkeysyms.h&gt;
</a><a href="#h78-0-20" id="h78-0-20" class="i">+#include &lt;gdk/gdkx.h&gt;
</a><a href="#h78-0-21" id="h78-0-21" class="i">+#include &lt;glib/gstdio.h&gt;
</a><a href="#h78-0-22" id="h78-0-22" class="i">+#include &lt;gtk/gtk.h&gt;
</a><a href="#h78-0-23" id="h78-0-23" class="i">+#include &lt;gtk/gtkx.h&gt;
</a><a href="#h78-0-24" id="h78-0-24" class="i">+#include &lt;gcr/gcr.h&gt;
</a><a href="#h78-0-25" id="h78-0-25" class="i">+#include &lt;JavaScriptCore/JavaScript.h&gt;
</a><a href="#h78-0-26" id="h78-0-26" class="i">+#include &lt;webkit2/webkit2.h&gt;
</a><a href="#h78-0-27" id="h78-0-27" class="i">+#include &lt;X11/X.h&gt;
</a><a href="#h78-0-28" id="h78-0-28" class="i">+#include &lt;X11/Xatom.h&gt;
</a><a href="#h78-0-29" id="h78-0-29" class="i">+#include &lt;glib.h&gt;
</a><a href="#h78-0-30" id="h78-0-30" class="i">+
</a><a href="#h78-0-31" id="h78-0-31" class="i">+#include &quot;arg.h&quot;
</a><a href="#h78-0-32" id="h78-0-32" class="i">+#include &quot;common.h&quot;
</a><a href="#h78-0-33" id="h78-0-33" class="i">+
</a><a href="#h78-0-34" id="h78-0-34" class="i">+#define LENGTH(x)               (sizeof(x) / sizeof(x[0]))
</a><a href="#h78-0-35" id="h78-0-35" class="i">+#define CLEANMASK(mask)         (mask &amp; (MODKEY|GDK_SHIFT_MASK))
</a><a href="#h78-0-36" id="h78-0-36" class="i">+
</a><a href="#h78-0-37" id="h78-0-37" class="i">+enum { AtomFind, AtomGo, AtomUri, AtomLast };
</a><a href="#h78-0-38" id="h78-0-38" class="i">+
</a><a href="#h78-0-39" id="h78-0-39" class="i">+enum {
</a><a href="#h78-0-40" id="h78-0-40" class="i">+	OnDoc   = WEBKIT_HIT_TEST_RESULT_CONTEXT_DOCUMENT,
</a><a href="#h78-0-41" id="h78-0-41" class="i">+	OnLink  = WEBKIT_HIT_TEST_RESULT_CONTEXT_LINK,
</a><a href="#h78-0-42" id="h78-0-42" class="i">+	OnImg   = WEBKIT_HIT_TEST_RESULT_CONTEXT_IMAGE,
</a><a href="#h78-0-43" id="h78-0-43" class="i">+	OnMedia = WEBKIT_HIT_TEST_RESULT_CONTEXT_MEDIA,
</a><a href="#h78-0-44" id="h78-0-44" class="i">+	OnEdit  = WEBKIT_HIT_TEST_RESULT_CONTEXT_EDITABLE,
</a><a href="#h78-0-45" id="h78-0-45" class="i">+	OnBar   = WEBKIT_HIT_TEST_RESULT_CONTEXT_SCROLLBAR,
</a><a href="#h78-0-46" id="h78-0-46" class="i">+	OnSel   = WEBKIT_HIT_TEST_RESULT_CONTEXT_SELECTION,
</a><a href="#h78-0-47" id="h78-0-47" class="i">+	OnAny   = OnDoc | OnLink | OnImg | OnMedia | OnEdit | OnBar | OnSel,
</a><a href="#h78-0-48" id="h78-0-48" class="i">+};
</a><a href="#h78-0-49" id="h78-0-49" class="i">+
</a><a href="#h78-0-50" id="h78-0-50" class="i">+typedef enum {
</a><a href="#h78-0-51" id="h78-0-51" class="i">+	AcceleratedCanvas,
</a><a href="#h78-0-52" id="h78-0-52" class="i">+	AccessMicrophone,
</a><a href="#h78-0-53" id="h78-0-53" class="i">+	AccessWebcam,
</a><a href="#h78-0-54" id="h78-0-54" class="i">+	CaretBrowsing,
</a><a href="#h78-0-55" id="h78-0-55" class="i">+	Certificate,
</a><a href="#h78-0-56" id="h78-0-56" class="i">+	CookiePolicies,
</a><a href="#h78-0-57" id="h78-0-57" class="i">+	DiskCache,
</a><a href="#h78-0-58" id="h78-0-58" class="i">+	DefaultCharset,
</a><a href="#h78-0-59" id="h78-0-59" class="i">+	DNSPrefetch,
</a><a href="#h78-0-60" id="h78-0-60" class="i">+	FileURLsCrossAccess,
</a><a href="#h78-0-61" id="h78-0-61" class="i">+	FontSize,
</a><a href="#h78-0-62" id="h78-0-62" class="i">+	FrameFlattening,
</a><a href="#h78-0-63" id="h78-0-63" class="i">+	Geolocation,
</a><a href="#h78-0-64" id="h78-0-64" class="i">+	HideBackground,
</a><a href="#h78-0-65" id="h78-0-65" class="i">+	Inspector,
</a><a href="#h78-0-66" id="h78-0-66" class="i">+	Java,
</a><a href="#h78-0-67" id="h78-0-67" class="i">+	JavaScript,
</a><a href="#h78-0-68" id="h78-0-68" class="i">+	KioskMode,
</a><a href="#h78-0-69" id="h78-0-69" class="i">+	LoadImages,
</a><a href="#h78-0-70" id="h78-0-70" class="i">+	MediaManualPlay,
</a><a href="#h78-0-71" id="h78-0-71" class="i">+	Plugins,
</a><a href="#h78-0-72" id="h78-0-72" class="i">+	PreferredLanguages,
</a><a href="#h78-0-73" id="h78-0-73" class="i">+	RunInFullscreen,
</a><a href="#h78-0-74" id="h78-0-74" class="i">+	ScrollBars,
</a><a href="#h78-0-75" id="h78-0-75" class="i">+	ShowIndicators,
</a><a href="#h78-0-76" id="h78-0-76" class="i">+	SiteQuirks,
</a><a href="#h78-0-77" id="h78-0-77" class="i">+	SmoothScrolling,
</a><a href="#h78-0-78" id="h78-0-78" class="i">+	SpellChecking,
</a><a href="#h78-0-79" id="h78-0-79" class="i">+	SpellLanguages,
</a><a href="#h78-0-80" id="h78-0-80" class="i">+	StrictTLS,
</a><a href="#h78-0-81" id="h78-0-81" class="i">+	Style,
</a><a href="#h78-0-82" id="h78-0-82" class="i">+	WebGL,
</a><a href="#h78-0-83" id="h78-0-83" class="i">+	ZoomLevel,
</a><a href="#h78-0-84" id="h78-0-84" class="i">+	ParameterLast
</a><a href="#h78-0-85" id="h78-0-85" class="i">+} ParamName;
</a><a href="#h78-0-86" id="h78-0-86" class="i">+
</a><a href="#h78-0-87" id="h78-0-87" class="i">+typedef union {
</a><a href="#h78-0-88" id="h78-0-88" class="i">+	int i;
</a><a href="#h78-0-89" id="h78-0-89" class="i">+	float f;
</a><a href="#h78-0-90" id="h78-0-90" class="i">+	const void *v;
</a><a href="#h78-0-91" id="h78-0-91" class="i">+} Arg;
</a><a href="#h78-0-92" id="h78-0-92" class="i">+
</a><a href="#h78-0-93" id="h78-0-93" class="i">+typedef struct {
</a><a href="#h78-0-94" id="h78-0-94" class="i">+	Arg val;
</a><a href="#h78-0-95" id="h78-0-95" class="i">+	int prio;
</a><a href="#h78-0-96" id="h78-0-96" class="i">+} Parameter;
</a><a href="#h78-0-97" id="h78-0-97" class="i">+
</a><a href="#h78-0-98" id="h78-0-98" class="i">+typedef struct Client {
</a><a href="#h78-0-99" id="h78-0-99" class="i">+	GtkWidget *win;
</a><a href="#h78-0-100" id="h78-0-100" class="i">+	WebKitWebView *view;
</a><a href="#h78-0-101" id="h78-0-101" class="i">+	WebKitWebInspector *inspector;
</a><a href="#h78-0-102" id="h78-0-102" class="i">+	WebKitFindController *finder;
</a><a href="#h78-0-103" id="h78-0-103" class="i">+	WebKitHitTestResult *mousepos;
</a><a href="#h78-0-104" id="h78-0-104" class="i">+	GTlsCertificate *cert, *failedcert;
</a><a href="#h78-0-105" id="h78-0-105" class="i">+	GTlsCertificateFlags tlserr;
</a><a href="#h78-0-106" id="h78-0-106" class="i">+	Window xid;
</a><a href="#h78-0-107" id="h78-0-107" class="i">+	unsigned long pageid;
</a><a href="#h78-0-108" id="h78-0-108" class="i">+	int progress, fullscreen, https, insecure, errorpage;
</a><a href="#h78-0-109" id="h78-0-109" class="i">+	const char *title, *overtitle, *targeturi;
</a><a href="#h78-0-110" id="h78-0-110" class="i">+	const char *needle;
</a><a href="#h78-0-111" id="h78-0-111" class="i">+	struct Client *next;
</a><a href="#h78-0-112" id="h78-0-112" class="i">+} Client;
</a><a href="#h78-0-113" id="h78-0-113" class="i">+
</a><a href="#h78-0-114" id="h78-0-114" class="i">+typedef struct {
</a><a href="#h78-0-115" id="h78-0-115" class="i">+	guint mod;
</a><a href="#h78-0-116" id="h78-0-116" class="i">+	guint keyval;
</a><a href="#h78-0-117" id="h78-0-117" class="i">+	void (*func)(Client *c, const Arg *a);
</a><a href="#h78-0-118" id="h78-0-118" class="i">+	const Arg arg;
</a><a href="#h78-0-119" id="h78-0-119" class="i">+} Key;
</a><a href="#h78-0-120" id="h78-0-120" class="i">+
</a><a href="#h78-0-121" id="h78-0-121" class="i">+typedef struct {
</a><a href="#h78-0-122" id="h78-0-122" class="i">+	unsigned int target;
</a><a href="#h78-0-123" id="h78-0-123" class="i">+	unsigned int mask;
</a><a href="#h78-0-124" id="h78-0-124" class="i">+	guint button;
</a><a href="#h78-0-125" id="h78-0-125" class="i">+	void (*func)(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h78-0-126" id="h78-0-126" class="i">+	const Arg arg;
</a><a href="#h78-0-127" id="h78-0-127" class="i">+	unsigned int stopevent;
</a><a href="#h78-0-128" id="h78-0-128" class="i">+} Button;
</a><a href="#h78-0-129" id="h78-0-129" class="i">+
</a><a href="#h78-0-130" id="h78-0-130" class="i">+typedef struct {
</a><a href="#h78-0-131" id="h78-0-131" class="i">+	char *token;
</a><a href="#h78-0-132" id="h78-0-132" class="i">+	char *uri;
</a><a href="#h78-0-133" id="h78-0-133" class="i">+} SearchEngine;
</a><a href="#h78-0-134" id="h78-0-134" class="i">+
</a><a href="#h78-0-135" id="h78-0-135" class="i">+typedef struct {
</a><a href="#h78-0-136" id="h78-0-136" class="i">+	const char *uri;
</a><a href="#h78-0-137" id="h78-0-137" class="i">+	Parameter config[ParameterLast];
</a><a href="#h78-0-138" id="h78-0-138" class="i">+	regex_t re;
</a><a href="#h78-0-139" id="h78-0-139" class="i">+} UriParameters;
</a><a href="#h78-0-140" id="h78-0-140" class="i">+
</a><a href="#h78-0-141" id="h78-0-141" class="i">+typedef struct {
</a><a href="#h78-0-142" id="h78-0-142" class="i">+	char *regex;
</a><a href="#h78-0-143" id="h78-0-143" class="i">+	char *file;
</a><a href="#h78-0-144" id="h78-0-144" class="i">+	regex_t re;
</a><a href="#h78-0-145" id="h78-0-145" class="i">+} SiteSpecific;
</a><a href="#h78-0-146" id="h78-0-146" class="i">+
</a><a href="#h78-0-147" id="h78-0-147" class="i">+/* Surf */
</a><a href="#h78-0-148" id="h78-0-148" class="i">+static void usage(void);
</a><a href="#h78-0-149" id="h78-0-149" class="i">+static void setup(void);
</a><a href="#h78-0-150" id="h78-0-150" class="i">+static void sigchld(int unused);
</a><a href="#h78-0-151" id="h78-0-151" class="i">+static void sighup(int unused);
</a><a href="#h78-0-152" id="h78-0-152" class="i">+static char *buildfile(const char *path);
</a><a href="#h78-0-153" id="h78-0-153" class="i">+static char *buildpath(const char *path);
</a><a href="#h78-0-154" id="h78-0-154" class="i">+static char *untildepath(const char *path);
</a><a href="#h78-0-155" id="h78-0-155" class="i">+static const char *getuserhomedir(const char *user);
</a><a href="#h78-0-156" id="h78-0-156" class="i">+static const char *getcurrentuserhomedir(void);
</a><a href="#h78-0-157" id="h78-0-157" class="i">+static Client *newclient(Client *c);
</a><a href="#h78-0-158" id="h78-0-158" class="i">+static void loaduri(Client *c, const Arg *a);
</a><a href="#h78-0-159" id="h78-0-159" class="i">+static const char *geturi(Client *c);
</a><a href="#h78-0-160" id="h78-0-160" class="i">+static void setatom(Client *c, int a, const char *v);
</a><a href="#h78-0-161" id="h78-0-161" class="i">+static const char *getatom(Client *c, int a);
</a><a href="#h78-0-162" id="h78-0-162" class="i">+static void updatetitle(Client *c);
</a><a href="#h78-0-163" id="h78-0-163" class="i">+static void gettogglestats(Client *c);
</a><a href="#h78-0-164" id="h78-0-164" class="i">+static void getpagestats(Client *c);
</a><a href="#h78-0-165" id="h78-0-165" class="i">+static WebKitCookieAcceptPolicy cookiepolicy_get(void);
</a><a href="#h78-0-166" id="h78-0-166" class="i">+static char cookiepolicy_set(const WebKitCookieAcceptPolicy p);
</a><a href="#h78-0-167" id="h78-0-167" class="i">+static void seturiparameters(Client *c, const char *uri, ParamName *params);
</a><a href="#h78-0-168" id="h78-0-168" class="i">+static void setparameter(Client *c, int refresh, ParamName p, const Arg *a);
</a><a href="#h78-0-169" id="h78-0-169" class="i">+static const char *getcert(const char *uri);
</a><a href="#h78-0-170" id="h78-0-170" class="i">+static void setcert(Client *c, const char *file);
</a><a href="#h78-0-171" id="h78-0-171" class="i">+static const char *getstyle(const char *uri);
</a><a href="#h78-0-172" id="h78-0-172" class="i">+static void setstyle(Client *c, const char *file);
</a><a href="#h78-0-173" id="h78-0-173" class="i">+static void runscript(Client *c);
</a><a href="#h78-0-174" id="h78-0-174" class="i">+static void evalscript(Client *c, const char *jsstr, ...);
</a><a href="#h78-0-175" id="h78-0-175" class="i">+static void updatewinid(Client *c);
</a><a href="#h78-0-176" id="h78-0-176" class="i">+static void handleplumb(Client *c, const char *uri);
</a><a href="#h78-0-177" id="h78-0-177" class="i">+static void newwindow(Client *c, const Arg *a, int noembed);
</a><a href="#h78-0-178" id="h78-0-178" class="i">+static void spawn(Client *c, const Arg *a);
</a><a href="#h78-0-179" id="h78-0-179" class="i">+static void msgext(Client *c, char type, const Arg *a);
</a><a href="#h78-0-180" id="h78-0-180" class="i">+static void destroyclient(Client *c);
</a><a href="#h78-0-181" id="h78-0-181" class="i">+static void cleanup(void);
</a><a href="#h78-0-182" id="h78-0-182" class="i">+
</a><a href="#h78-0-183" id="h78-0-183" class="i">+/* GTK/WebKit */
</a><a href="#h78-0-184" id="h78-0-184" class="i">+static WebKitWebView *newview(Client *c, WebKitWebView *rv);
</a><a href="#h78-0-185" id="h78-0-185" class="i">+static void initwebextensions(WebKitWebContext *wc, Client *c);
</a><a href="#h78-0-186" id="h78-0-186" class="i">+static GtkWidget *createview(WebKitWebView *v, WebKitNavigationAction *a,
</a><a href="#h78-0-187" id="h78-0-187" class="i">+                             Client *c);
</a><a href="#h78-0-188" id="h78-0-188" class="i">+static gboolean buttonreleased(GtkWidget *w, GdkEvent *e, Client *c);
</a><a href="#h78-0-189" id="h78-0-189" class="i">+static GdkFilterReturn processx(GdkXEvent *xevent, GdkEvent *event,
</a><a href="#h78-0-190" id="h78-0-190" class="i">+                                gpointer d);
</a><a href="#h78-0-191" id="h78-0-191" class="i">+static gboolean winevent(GtkWidget *w, GdkEvent *e, Client *c);
</a><a href="#h78-0-192" id="h78-0-192" class="i">+static gboolean readpipe(GIOChannel *s, GIOCondition ioc, gpointer unused);
</a><a href="#h78-0-193" id="h78-0-193" class="i">+static void showview(WebKitWebView *v, Client *c);
</a><a href="#h78-0-194" id="h78-0-194" class="i">+static GtkWidget *createwindow(Client *c);
</a><a href="#h78-0-195" id="h78-0-195" class="i">+static gboolean loadfailedtls(WebKitWebView *v, gchar *uri,
</a><a href="#h78-0-196" id="h78-0-196" class="i">+                              GTlsCertificate *cert,
</a><a href="#h78-0-197" id="h78-0-197" class="i">+                              GTlsCertificateFlags err, Client *c);
</a><a href="#h78-0-198" id="h78-0-198" class="i">+static void loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c);
</a><a href="#h78-0-199" id="h78-0-199" class="i">+static void progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c);
</a><a href="#h78-0-200" id="h78-0-200" class="i">+static void titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c);
</a><a href="#h78-0-201" id="h78-0-201" class="i">+static void mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h,
</a><a href="#h78-0-202" id="h78-0-202" class="i">+                               guint modifiers, Client *c);
</a><a href="#h78-0-203" id="h78-0-203" class="i">+static gboolean permissionrequested(WebKitWebView *v,
</a><a href="#h78-0-204" id="h78-0-204" class="i">+                                    WebKitPermissionRequest *r, Client *c);
</a><a href="#h78-0-205" id="h78-0-205" class="i">+static gboolean decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
</a><a href="#h78-0-206" id="h78-0-206" class="i">+                             WebKitPolicyDecisionType dt, Client *c);
</a><a href="#h78-0-207" id="h78-0-207" class="i">+static void decidenavigation(WebKitPolicyDecision *d, Client *c);
</a><a href="#h78-0-208" id="h78-0-208" class="i">+static void decidenewwindow(WebKitPolicyDecision *d, Client *c);
</a><a href="#h78-0-209" id="h78-0-209" class="i">+static void decideresource(WebKitPolicyDecision *d, Client *c);
</a><a href="#h78-0-210" id="h78-0-210" class="i">+static void insecurecontent(WebKitWebView *v, WebKitInsecureContentEvent e,
</a><a href="#h78-0-211" id="h78-0-211" class="i">+                            Client *c);
</a><a href="#h78-0-212" id="h78-0-212" class="i">+static void downloadstarted(WebKitWebContext *wc, WebKitDownload *d,
</a><a href="#h78-0-213" id="h78-0-213" class="i">+                            Client *c);
</a><a href="#h78-0-214" id="h78-0-214" class="i">+static void responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c);
</a><a href="#h78-0-215" id="h78-0-215" class="i">+static void download(Client *c, WebKitURIResponse *r);
</a><a href="#h78-0-216" id="h78-0-216" class="i">+static void webprocessterminated(WebKitWebView *v,
</a><a href="#h78-0-217" id="h78-0-217" class="i">+                                 WebKitWebProcessTerminationReason r,
</a><a href="#h78-0-218" id="h78-0-218" class="i">+                                 Client *c);
</a><a href="#h78-0-219" id="h78-0-219" class="i">+static void closeview(WebKitWebView *v, Client *c);
</a><a href="#h78-0-220" id="h78-0-220" class="i">+static void destroywin(GtkWidget* w, Client *c);
</a><a href="#h78-0-221" id="h78-0-221" class="i">+static gchar *parseuri(const gchar *uri);
</a><a href="#h78-0-222" id="h78-0-222" class="i">+
</a><a href="#h78-0-223" id="h78-0-223" class="i">+/* Hotkeys */
</a><a href="#h78-0-224" id="h78-0-224" class="i">+static void pasteuri(GtkClipboard *clipboard, const char *text, gpointer d);
</a><a href="#h78-0-225" id="h78-0-225" class="i">+static void reload(Client *c, const Arg *a);
</a><a href="#h78-0-226" id="h78-0-226" class="i">+static void print(Client *c, const Arg *a);
</a><a href="#h78-0-227" id="h78-0-227" class="i">+static void showcert(Client *c, const Arg *a);
</a><a href="#h78-0-228" id="h78-0-228" class="i">+static void clipboard(Client *c, const Arg *a);
</a><a href="#h78-0-229" id="h78-0-229" class="i">+static void zoom(Client *c, const Arg *a);
</a><a href="#h78-0-230" id="h78-0-230" class="i">+static void scrollv(Client *c, const Arg *a);
</a><a href="#h78-0-231" id="h78-0-231" class="i">+static void scrollh(Client *c, const Arg *a);
</a><a href="#h78-0-232" id="h78-0-232" class="i">+static void navigate(Client *c, const Arg *a);
</a><a href="#h78-0-233" id="h78-0-233" class="i">+static void stop(Client *c, const Arg *a);
</a><a href="#h78-0-234" id="h78-0-234" class="i">+static void toggle(Client *c, const Arg *a);
</a><a href="#h78-0-235" id="h78-0-235" class="i">+static void togglefullscreen(Client *c, const Arg *a);
</a><a href="#h78-0-236" id="h78-0-236" class="i">+static void togglecookiepolicy(Client *c, const Arg *a);
</a><a href="#h78-0-237" id="h78-0-237" class="i">+static void toggleinspector(Client *c, const Arg *a);
</a><a href="#h78-0-238" id="h78-0-238" class="i">+static void find(Client *c, const Arg *a);
</a><a href="#h78-0-239" id="h78-0-239" class="i">+
</a><a href="#h78-0-240" id="h78-0-240" class="i">+/* Buttons */
</a><a href="#h78-0-241" id="h78-0-241" class="i">+static void clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h78-0-242" id="h78-0-242" class="i">+static void clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h78-0-243" id="h78-0-243" class="i">+static void clickexternplayer(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h78-0-244" id="h78-0-244" class="i">+
</a><a href="#h78-0-245" id="h78-0-245" class="i">+static char winid[64];
</a><a href="#h78-0-246" id="h78-0-246" class="i">+static char togglestats[12];
</a><a href="#h78-0-247" id="h78-0-247" class="i">+static char pagestats[2];
</a><a href="#h78-0-248" id="h78-0-248" class="i">+static Atom atoms[AtomLast];
</a><a href="#h78-0-249" id="h78-0-249" class="i">+static Window embed;
</a><a href="#h78-0-250" id="h78-0-250" class="i">+static int showxid;
</a><a href="#h78-0-251" id="h78-0-251" class="i">+static int cookiepolicy;
</a><a href="#h78-0-252" id="h78-0-252" class="i">+static Display *dpy;
</a><a href="#h78-0-253" id="h78-0-253" class="i">+static Client *clients;
</a><a href="#h78-0-254" id="h78-0-254" class="i">+static GdkDevice *gdkkb;
</a><a href="#h78-0-255" id="h78-0-255" class="i">+static char *stylefile;
</a><a href="#h78-0-256" id="h78-0-256" class="i">+static const char *useragent;
</a><a href="#h78-0-257" id="h78-0-257" class="i">+static Parameter *curconfig;
</a><a href="#h78-0-258" id="h78-0-258" class="i">+static int modparams[ParameterLast];
</a><a href="#h78-0-259" id="h78-0-259" class="i">+static int pipein[2], pipeout[2];
</a><a href="#h78-0-260" id="h78-0-260" class="i">+char *argv0;
</a><a href="#h78-0-261" id="h78-0-261" class="i">+
</a><a href="#h78-0-262" id="h78-0-262" class="i">+static ParamName loadtransient[] = {
</a><a href="#h78-0-263" id="h78-0-263" class="i">+	Certificate,
</a><a href="#h78-0-264" id="h78-0-264" class="i">+	CookiePolicies,
</a><a href="#h78-0-265" id="h78-0-265" class="i">+	DiskCache,
</a><a href="#h78-0-266" id="h78-0-266" class="i">+	DNSPrefetch,
</a><a href="#h78-0-267" id="h78-0-267" class="i">+	FileURLsCrossAccess,
</a><a href="#h78-0-268" id="h78-0-268" class="i">+	JavaScript,
</a><a href="#h78-0-269" id="h78-0-269" class="i">+	LoadImages,
</a><a href="#h78-0-270" id="h78-0-270" class="i">+	PreferredLanguages,
</a><a href="#h78-0-271" id="h78-0-271" class="i">+	ShowIndicators,
</a><a href="#h78-0-272" id="h78-0-272" class="i">+	StrictTLS,
</a><a href="#h78-0-273" id="h78-0-273" class="i">+	ParameterLast
</a><a href="#h78-0-274" id="h78-0-274" class="i">+};
</a><a href="#h78-0-275" id="h78-0-275" class="i">+
</a><a href="#h78-0-276" id="h78-0-276" class="i">+static ParamName loadcommitted[] = {
</a><a href="#h78-0-277" id="h78-0-277" class="i">+	AcceleratedCanvas,
</a><a href="#h78-0-278" id="h78-0-278" class="i">+//	AccessMicrophone,
</a><a href="#h78-0-279" id="h78-0-279" class="i">+//	AccessWebcam,
</a><a href="#h78-0-280" id="h78-0-280" class="i">+	CaretBrowsing,
</a><a href="#h78-0-281" id="h78-0-281" class="i">+	DefaultCharset,
</a><a href="#h78-0-282" id="h78-0-282" class="i">+	FontSize,
</a><a href="#h78-0-283" id="h78-0-283" class="i">+	FrameFlattening,
</a><a href="#h78-0-284" id="h78-0-284" class="i">+	Geolocation,
</a><a href="#h78-0-285" id="h78-0-285" class="i">+	HideBackground,
</a><a href="#h78-0-286" id="h78-0-286" class="i">+	Inspector,
</a><a href="#h78-0-287" id="h78-0-287" class="i">+	Java,
</a><a href="#h78-0-288" id="h78-0-288" class="i">+//	KioskMode,
</a><a href="#h78-0-289" id="h78-0-289" class="i">+	MediaManualPlay,
</a><a href="#h78-0-290" id="h78-0-290" class="i">+	Plugins,
</a><a href="#h78-0-291" id="h78-0-291" class="i">+	RunInFullscreen,
</a><a href="#h78-0-292" id="h78-0-292" class="i">+	ScrollBars,
</a><a href="#h78-0-293" id="h78-0-293" class="i">+	SiteQuirks,
</a><a href="#h78-0-294" id="h78-0-294" class="i">+	SmoothScrolling,
</a><a href="#h78-0-295" id="h78-0-295" class="i">+	SpellChecking,
</a><a href="#h78-0-296" id="h78-0-296" class="i">+	SpellLanguages,
</a><a href="#h78-0-297" id="h78-0-297" class="i">+	Style,
</a><a href="#h78-0-298" id="h78-0-298" class="i">+	ZoomLevel,
</a><a href="#h78-0-299" id="h78-0-299" class="i">+	ParameterLast
</a><a href="#h78-0-300" id="h78-0-300" class="i">+};
</a><a href="#h78-0-301" id="h78-0-301" class="i">+
</a><a href="#h78-0-302" id="h78-0-302" class="i">+static ParamName loadfinished[] = {
</a><a href="#h78-0-303" id="h78-0-303" class="i">+	ParameterLast
</a><a href="#h78-0-304" id="h78-0-304" class="i">+};
</a><a href="#h78-0-305" id="h78-0-305" class="i">+
</a><a href="#h78-0-306" id="h78-0-306" class="i">+/* configuration, allows nested code to access above variables */
</a><a href="#h78-0-307" id="h78-0-307" class="i">+#include &quot;config.h&quot;
</a><a href="#h78-0-308" id="h78-0-308" class="i">+
</a><a href="#h78-0-309" id="h78-0-309" class="i">+void
</a><a href="#h78-0-310" id="h78-0-310" class="i">+usage(void)
</a><a href="#h78-0-311" id="h78-0-311" class="i">+{
</a><a href="#h78-0-312" id="h78-0-312" class="i">+	die(&quot;usage: surf [-bBdDfFgGiIkKmMnNpPsStTvwxX]\n&quot;
</a><a href="#h78-0-313" id="h78-0-313" class="i">+	    &quot;[-a cookiepolicies ] [-c cookiefile] [-C stylefile] [-e xid]\n&quot;
</a><a href="#h78-0-314" id="h78-0-314" class="i">+	    &quot;[-r scriptfile] [-u useragent] [-z zoomlevel] [uri]\n&quot;);
</a><a href="#h78-0-315" id="h78-0-315" class="i">+}
</a><a href="#h78-0-316" id="h78-0-316" class="i">+
</a><a href="#h78-0-317" id="h78-0-317" class="i">+void
</a><a href="#h78-0-318" id="h78-0-318" class="i">+setup(void)
</a><a href="#h78-0-319" id="h78-0-319" class="i">+{
</a><a href="#h78-0-320" id="h78-0-320" class="i">+	GIOChannel *gchanin;
</a><a href="#h78-0-321" id="h78-0-321" class="i">+	GdkDisplay *gdpy;
</a><a href="#h78-0-322" id="h78-0-322" class="i">+	int i, j;
</a><a href="#h78-0-323" id="h78-0-323" class="i">+
</a><a href="#h78-0-324" id="h78-0-324" class="i">+	/* clean up any zombies immediately */
</a><a href="#h78-0-325" id="h78-0-325" class="i">+	sigchld(0);
</a><a href="#h78-0-326" id="h78-0-326" class="i">+	if (signal(SIGHUP, sighup) == SIG_ERR)
</a><a href="#h78-0-327" id="h78-0-327" class="i">+		die(&quot;Can&#39;t install SIGHUP handler&quot;);
</a><a href="#h78-0-328" id="h78-0-328" class="i">+
</a><a href="#h78-0-329" id="h78-0-329" class="i">+	if (!(dpy = XOpenDisplay(NULL)))
</a><a href="#h78-0-330" id="h78-0-330" class="i">+		die(&quot;Can&#39;t open default display&quot;);
</a><a href="#h78-0-331" id="h78-0-331" class="i">+
</a><a href="#h78-0-332" id="h78-0-332" class="i">+	/* atoms */
</a><a href="#h78-0-333" id="h78-0-333" class="i">+	atoms[AtomFind] = XInternAtom(dpy, &quot;_SURF_FIND&quot;, False);
</a><a href="#h78-0-334" id="h78-0-334" class="i">+	atoms[AtomGo] = XInternAtom(dpy, &quot;_SURF_GO&quot;, False);
</a><a href="#h78-0-335" id="h78-0-335" class="i">+	atoms[AtomUri] = XInternAtom(dpy, &quot;_SURF_URI&quot;, False);
</a><a href="#h78-0-336" id="h78-0-336" class="i">+
</a><a href="#h78-0-337" id="h78-0-337" class="i">+	gtk_init(NULL, NULL);
</a><a href="#h78-0-338" id="h78-0-338" class="i">+
</a><a href="#h78-0-339" id="h78-0-339" class="i">+	gdpy = gdk_display_get_default();
</a><a href="#h78-0-340" id="h78-0-340" class="i">+
</a><a href="#h78-0-341" id="h78-0-341" class="i">+	curconfig = defconfig;
</a><a href="#h78-0-342" id="h78-0-342" class="i">+
</a><a href="#h78-0-343" id="h78-0-343" class="i">+	/* dirs and files */
</a><a href="#h78-0-344" id="h78-0-344" class="i">+	cookiefile = buildfile(cookiefile);
</a><a href="#h78-0-345" id="h78-0-345" class="i">+	scriptfile = buildfile(scriptfile);
</a><a href="#h78-0-346" id="h78-0-346" class="i">+	cachedir   = buildpath(cachedir);
</a><a href="#h78-0-347" id="h78-0-347" class="i">+	certdir    = buildpath(certdir);
</a><a href="#h78-0-348" id="h78-0-348" class="i">+
</a><a href="#h78-0-349" id="h78-0-349" class="i">+	gdkkb = gdk_seat_get_keyboard(gdk_display_get_default_seat(gdpy));
</a><a href="#h78-0-350" id="h78-0-350" class="i">+
</a><a href="#h78-0-351" id="h78-0-351" class="i">+	if (pipe(pipeout) &lt; 0 || pipe(pipein) &lt; 0) {
</a><a href="#h78-0-352" id="h78-0-352" class="i">+		fputs(&quot;Unable to create pipes\n&quot;, stderr);
</a><a href="#h78-0-353" id="h78-0-353" class="i">+	} else {
</a><a href="#h78-0-354" id="h78-0-354" class="i">+		gchanin = g_io_channel_unix_new(pipein[0]);
</a><a href="#h78-0-355" id="h78-0-355" class="i">+		g_io_channel_set_encoding(gchanin, NULL, NULL);
</a><a href="#h78-0-356" id="h78-0-356" class="i">+		g_io_channel_set_close_on_unref(gchanin, TRUE);
</a><a href="#h78-0-357" id="h78-0-357" class="i">+		g_io_add_watch(gchanin, G_IO_IN, readpipe, NULL);
</a><a href="#h78-0-358" id="h78-0-358" class="i">+	}
</a><a href="#h78-0-359" id="h78-0-359" class="i">+
</a><a href="#h78-0-360" id="h78-0-360" class="i">+
</a><a href="#h78-0-361" id="h78-0-361" class="i">+	for (i = 0; i &lt; LENGTH(certs); ++i) {
</a><a href="#h78-0-362" id="h78-0-362" class="i">+		if (!regcomp(&amp;(certs[i].re), certs[i].regex, REG_EXTENDED)) {
</a><a href="#h78-0-363" id="h78-0-363" class="i">+			certs[i].file = g_strconcat(certdir, &quot;/&quot;, certs[i].file,
</a><a href="#h78-0-364" id="h78-0-364" class="i">+			                            NULL);
</a><a href="#h78-0-365" id="h78-0-365" class="i">+		} else {
</a><a href="#h78-0-366" id="h78-0-366" class="i">+			fprintf(stderr, &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h78-0-367" id="h78-0-367" class="i">+			        certs[i].regex);
</a><a href="#h78-0-368" id="h78-0-368" class="i">+			certs[i].regex = NULL;
</a><a href="#h78-0-369" id="h78-0-369" class="i">+		}
</a><a href="#h78-0-370" id="h78-0-370" class="i">+	}
</a><a href="#h78-0-371" id="h78-0-371" class="i">+
</a><a href="#h78-0-372" id="h78-0-372" class="i">+	if (!stylefile) {
</a><a href="#h78-0-373" id="h78-0-373" class="i">+		styledir = buildpath(styledir);
</a><a href="#h78-0-374" id="h78-0-374" class="i">+		for (i = 0; i &lt; LENGTH(styles); ++i) {
</a><a href="#h78-0-375" id="h78-0-375" class="i">+			if (!regcomp(&amp;(styles[i].re), styles[i].regex,
</a><a href="#h78-0-376" id="h78-0-376" class="i">+			    REG_EXTENDED)) {
</a><a href="#h78-0-377" id="h78-0-377" class="i">+				styles[i].file = g_strconcat(styledir, &quot;/&quot;,
</a><a href="#h78-0-378" id="h78-0-378" class="i">+				                    styles[i].file, NULL);
</a><a href="#h78-0-379" id="h78-0-379" class="i">+			} else {
</a><a href="#h78-0-380" id="h78-0-380" class="i">+				fprintf(stderr, &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h78-0-381" id="h78-0-381" class="i">+				        styles[i].regex);
</a><a href="#h78-0-382" id="h78-0-382" class="i">+				styles[i].regex = NULL;
</a><a href="#h78-0-383" id="h78-0-383" class="i">+			}
</a><a href="#h78-0-384" id="h78-0-384" class="i">+		}
</a><a href="#h78-0-385" id="h78-0-385" class="i">+		g_free(styledir);
</a><a href="#h78-0-386" id="h78-0-386" class="i">+	} else {
</a><a href="#h78-0-387" id="h78-0-387" class="i">+		stylefile = buildfile(stylefile);
</a><a href="#h78-0-388" id="h78-0-388" class="i">+	}
</a><a href="#h78-0-389" id="h78-0-389" class="i">+
</a><a href="#h78-0-390" id="h78-0-390" class="i">+	for (i = 0; i &lt; LENGTH(uriparams); ++i) {
</a><a href="#h78-0-391" id="h78-0-391" class="i">+		if (regcomp(&amp;(uriparams[i].re), uriparams[i].uri,
</a><a href="#h78-0-392" id="h78-0-392" class="i">+		    REG_EXTENDED)) {
</a><a href="#h78-0-393" id="h78-0-393" class="i">+			fprintf(stderr, &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h78-0-394" id="h78-0-394" class="i">+			        uriparams[i].uri);
</a><a href="#h78-0-395" id="h78-0-395" class="i">+			uriparams[i].uri = NULL;
</a><a href="#h78-0-396" id="h78-0-396" class="i">+			continue;
</a><a href="#h78-0-397" id="h78-0-397" class="i">+		}
</a><a href="#h78-0-398" id="h78-0-398" class="i">+
</a><a href="#h78-0-399" id="h78-0-399" class="i">+		/* copy default parameters with higher priority */
</a><a href="#h78-0-400" id="h78-0-400" class="i">+		for (j = 0; j &lt; ParameterLast; ++j) {
</a><a href="#h78-0-401" id="h78-0-401" class="i">+			if (defconfig[j].prio &gt;= uriparams[i].config[j].prio)
</a><a href="#h78-0-402" id="h78-0-402" class="i">+				uriparams[i].config[j] = defconfig[j];
</a><a href="#h78-0-403" id="h78-0-403" class="i">+		}
</a><a href="#h78-0-404" id="h78-0-404" class="i">+	}
</a><a href="#h78-0-405" id="h78-0-405" class="i">+}
</a><a href="#h78-0-406" id="h78-0-406" class="i">+
</a><a href="#h78-0-407" id="h78-0-407" class="i">+void
</a><a href="#h78-0-408" id="h78-0-408" class="i">+sigchld(int unused)
</a><a href="#h78-0-409" id="h78-0-409" class="i">+{
</a><a href="#h78-0-410" id="h78-0-410" class="i">+	if (signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h78-0-411" id="h78-0-411" class="i">+		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
</a><a href="#h78-0-412" id="h78-0-412" class="i">+	while (waitpid(-1, NULL, WNOHANG) &gt; 0)
</a><a href="#h78-0-413" id="h78-0-413" class="i">+		;
</a><a href="#h78-0-414" id="h78-0-414" class="i">+}
</a><a href="#h78-0-415" id="h78-0-415" class="i">+
</a><a href="#h78-0-416" id="h78-0-416" class="i">+void
</a><a href="#h78-0-417" id="h78-0-417" class="i">+sighup(int unused)
</a><a href="#h78-0-418" id="h78-0-418" class="i">+{
</a><a href="#h78-0-419" id="h78-0-419" class="i">+	Arg a = { .i = 0 };
</a><a href="#h78-0-420" id="h78-0-420" class="i">+	Client *c;
</a><a href="#h78-0-421" id="h78-0-421" class="i">+
</a><a href="#h78-0-422" id="h78-0-422" class="i">+	for (c = clients; c; c = c-&gt;next)
</a><a href="#h78-0-423" id="h78-0-423" class="i">+		reload(c, &amp;a);
</a><a href="#h78-0-424" id="h78-0-424" class="i">+}
</a><a href="#h78-0-425" id="h78-0-425" class="i">+
</a><a href="#h78-0-426" id="h78-0-426" class="i">+char *
</a><a href="#h78-0-427" id="h78-0-427" class="i">+buildfile(const char *path)
</a><a href="#h78-0-428" id="h78-0-428" class="i">+{
</a><a href="#h78-0-429" id="h78-0-429" class="i">+	char *dname, *bname, *bpath, *fpath;
</a><a href="#h78-0-430" id="h78-0-430" class="i">+	FILE *f;
</a><a href="#h78-0-431" id="h78-0-431" class="i">+
</a><a href="#h78-0-432" id="h78-0-432" class="i">+	dname = g_path_get_dirname(path);
</a><a href="#h78-0-433" id="h78-0-433" class="i">+	bname = g_path_get_basename(path);
</a><a href="#h78-0-434" id="h78-0-434" class="i">+
</a><a href="#h78-0-435" id="h78-0-435" class="i">+	bpath = buildpath(dname);
</a><a href="#h78-0-436" id="h78-0-436" class="i">+	g_free(dname);
</a><a href="#h78-0-437" id="h78-0-437" class="i">+
</a><a href="#h78-0-438" id="h78-0-438" class="i">+	fpath = g_build_filename(bpath, bname, NULL);
</a><a href="#h78-0-439" id="h78-0-439" class="i">+	g_free(bpath);
</a><a href="#h78-0-440" id="h78-0-440" class="i">+	g_free(bname);
</a><a href="#h78-0-441" id="h78-0-441" class="i">+
</a><a href="#h78-0-442" id="h78-0-442" class="i">+	if (!(f = fopen(fpath, &quot;a&quot;)))
</a><a href="#h78-0-443" id="h78-0-443" class="i">+		die(&quot;Could not open file: %s\n&quot;, fpath);
</a><a href="#h78-0-444" id="h78-0-444" class="i">+
</a><a href="#h78-0-445" id="h78-0-445" class="i">+	g_chmod(fpath, 0600); /* always */
</a><a href="#h78-0-446" id="h78-0-446" class="i">+	fclose(f);
</a><a href="#h78-0-447" id="h78-0-447" class="i">+
</a><a href="#h78-0-448" id="h78-0-448" class="i">+	return fpath;
</a><a href="#h78-0-449" id="h78-0-449" class="i">+}
</a><a href="#h78-0-450" id="h78-0-450" class="i">+
</a><a href="#h78-0-451" id="h78-0-451" class="i">+static const char*
</a><a href="#h78-0-452" id="h78-0-452" class="i">+getuserhomedir(const char *user)
</a><a href="#h78-0-453" id="h78-0-453" class="i">+{
</a><a href="#h78-0-454" id="h78-0-454" class="i">+	struct passwd *pw = getpwnam(user);
</a><a href="#h78-0-455" id="h78-0-455" class="i">+
</a><a href="#h78-0-456" id="h78-0-456" class="i">+	if (!pw)
</a><a href="#h78-0-457" id="h78-0-457" class="i">+		die(&quot;Can&#39;t get user %s login information.\n&quot;, user);
</a><a href="#h78-0-458" id="h78-0-458" class="i">+
</a><a href="#h78-0-459" id="h78-0-459" class="i">+	return pw-&gt;pw_dir;
</a><a href="#h78-0-460" id="h78-0-460" class="i">+}
</a><a href="#h78-0-461" id="h78-0-461" class="i">+
</a><a href="#h78-0-462" id="h78-0-462" class="i">+static const char*
</a><a href="#h78-0-463" id="h78-0-463" class="i">+getcurrentuserhomedir(void)
</a><a href="#h78-0-464" id="h78-0-464" class="i">+{
</a><a href="#h78-0-465" id="h78-0-465" class="i">+	const char *homedir;
</a><a href="#h78-0-466" id="h78-0-466" class="i">+	const char *user;
</a><a href="#h78-0-467" id="h78-0-467" class="i">+	struct passwd *pw;
</a><a href="#h78-0-468" id="h78-0-468" class="i">+
</a><a href="#h78-0-469" id="h78-0-469" class="i">+	homedir = getenv(&quot;HOME&quot;);
</a><a href="#h78-0-470" id="h78-0-470" class="i">+	if (homedir)
</a><a href="#h78-0-471" id="h78-0-471" class="i">+		return homedir;
</a><a href="#h78-0-472" id="h78-0-472" class="i">+
</a><a href="#h78-0-473" id="h78-0-473" class="i">+	user = getenv(&quot;USER&quot;);
</a><a href="#h78-0-474" id="h78-0-474" class="i">+	if (user)
</a><a href="#h78-0-475" id="h78-0-475" class="i">+		return getuserhomedir(user);
</a><a href="#h78-0-476" id="h78-0-476" class="i">+
</a><a href="#h78-0-477" id="h78-0-477" class="i">+	pw = getpwuid(getuid());
</a><a href="#h78-0-478" id="h78-0-478" class="i">+	if (!pw)
</a><a href="#h78-0-479" id="h78-0-479" class="i">+		die(&quot;Can&#39;t get current user home directory\n&quot;);
</a><a href="#h78-0-480" id="h78-0-480" class="i">+
</a><a href="#h78-0-481" id="h78-0-481" class="i">+	return pw-&gt;pw_dir;
</a><a href="#h78-0-482" id="h78-0-482" class="i">+}
</a><a href="#h78-0-483" id="h78-0-483" class="i">+
</a><a href="#h78-0-484" id="h78-0-484" class="i">+char *
</a><a href="#h78-0-485" id="h78-0-485" class="i">+buildpath(const char *path)
</a><a href="#h78-0-486" id="h78-0-486" class="i">+{
</a><a href="#h78-0-487" id="h78-0-487" class="i">+	char *apath, *fpath;
</a><a href="#h78-0-488" id="h78-0-488" class="i">+
</a><a href="#h78-0-489" id="h78-0-489" class="i">+	if (path[0] == &#39;~&#39;)
</a><a href="#h78-0-490" id="h78-0-490" class="i">+		apath = untildepath(path);
</a><a href="#h78-0-491" id="h78-0-491" class="i">+	else
</a><a href="#h78-0-492" id="h78-0-492" class="i">+		apath = g_strdup(path);
</a><a href="#h78-0-493" id="h78-0-493" class="i">+
</a><a href="#h78-0-494" id="h78-0-494" class="i">+	/* creating directory */
</a><a href="#h78-0-495" id="h78-0-495" class="i">+	if (g_mkdir_with_parents(apath, 0700) &lt; 0)
</a><a href="#h78-0-496" id="h78-0-496" class="i">+		die(&quot;Could not access directory: %s\n&quot;, apath);
</a><a href="#h78-0-497" id="h78-0-497" class="i">+
</a><a href="#h78-0-498" id="h78-0-498" class="i">+	fpath = realpath(apath, NULL);
</a><a href="#h78-0-499" id="h78-0-499" class="i">+	g_free(apath);
</a><a href="#h78-0-500" id="h78-0-500" class="i">+
</a><a href="#h78-0-501" id="h78-0-501" class="i">+	return fpath;
</a><a href="#h78-0-502" id="h78-0-502" class="i">+}
</a><a href="#h78-0-503" id="h78-0-503" class="i">+
</a><a href="#h78-0-504" id="h78-0-504" class="i">+char *
</a><a href="#h78-0-505" id="h78-0-505" class="i">+untildepath(const char *path)
</a><a href="#h78-0-506" id="h78-0-506" class="i">+{
</a><a href="#h78-0-507" id="h78-0-507" class="i">+       char *apath, *name, *p;
</a><a href="#h78-0-508" id="h78-0-508" class="i">+       const char *homedir;
</a><a href="#h78-0-509" id="h78-0-509" class="i">+
</a><a href="#h78-0-510" id="h78-0-510" class="i">+       if (path[1] == &#39;/&#39; || path[1] == &#39;\0&#39;) {
</a><a href="#h78-0-511" id="h78-0-511" class="i">+               p = (char *)&amp;path[1];
</a><a href="#h78-0-512" id="h78-0-512" class="i">+               homedir = getcurrentuserhomedir();
</a><a href="#h78-0-513" id="h78-0-513" class="i">+       } else {
</a><a href="#h78-0-514" id="h78-0-514" class="i">+               if ((p = strchr(path, &#39;/&#39;)))
</a><a href="#h78-0-515" id="h78-0-515" class="i">+                       name = g_strndup(&amp;path[1], p - (path + 1));
</a><a href="#h78-0-516" id="h78-0-516" class="i">+               else
</a><a href="#h78-0-517" id="h78-0-517" class="i">+                       name = g_strdup(&amp;path[1]);
</a><a href="#h78-0-518" id="h78-0-518" class="i">+
</a><a href="#h78-0-519" id="h78-0-519" class="i">+               homedir = getuserhomedir(name);
</a><a href="#h78-0-520" id="h78-0-520" class="i">+               g_free(name);
</a><a href="#h78-0-521" id="h78-0-521" class="i">+       }
</a><a href="#h78-0-522" id="h78-0-522" class="i">+       apath = g_build_filename(homedir, p, NULL);
</a><a href="#h78-0-523" id="h78-0-523" class="i">+       return apath;
</a><a href="#h78-0-524" id="h78-0-524" class="i">+}
</a><a href="#h78-0-525" id="h78-0-525" class="i">+
</a><a href="#h78-0-526" id="h78-0-526" class="i">+Client *
</a><a href="#h78-0-527" id="h78-0-527" class="i">+newclient(Client *rc)
</a><a href="#h78-0-528" id="h78-0-528" class="i">+{
</a><a href="#h78-0-529" id="h78-0-529" class="i">+	Client *c;
</a><a href="#h78-0-530" id="h78-0-530" class="i">+
</a><a href="#h78-0-531" id="h78-0-531" class="i">+	if (!(c = calloc(1, sizeof(Client))))
</a><a href="#h78-0-532" id="h78-0-532" class="i">+		die(&quot;Cannot malloc!\n&quot;);
</a><a href="#h78-0-533" id="h78-0-533" class="i">+
</a><a href="#h78-0-534" id="h78-0-534" class="i">+	c-&gt;next = clients;
</a><a href="#h78-0-535" id="h78-0-535" class="i">+	clients = c;
</a><a href="#h78-0-536" id="h78-0-536" class="i">+
</a><a href="#h78-0-537" id="h78-0-537" class="i">+	c-&gt;progress = 100;
</a><a href="#h78-0-538" id="h78-0-538" class="i">+	c-&gt;view = newview(c, rc ? rc-&gt;view : NULL);
</a><a href="#h78-0-539" id="h78-0-539" class="i">+
</a><a href="#h78-0-540" id="h78-0-540" class="i">+	return c;
</a><a href="#h78-0-541" id="h78-0-541" class="i">+}
</a><a href="#h78-0-542" id="h78-0-542" class="i">+
</a><a href="#h78-0-543" id="h78-0-543" class="i">+void
</a><a href="#h78-0-544" id="h78-0-544" class="i">+loaduri(Client *c, const Arg *a)
</a><a href="#h78-0-545" id="h78-0-545" class="i">+{
</a><a href="#h78-0-546" id="h78-0-546" class="i">+	struct stat st;
</a><a href="#h78-0-547" id="h78-0-547" class="i">+	char *url, *path, *apath;
</a><a href="#h78-0-548" id="h78-0-548" class="i">+	const char *uri = a-&gt;v;
</a><a href="#h78-0-549" id="h78-0-549" class="i">+
</a><a href="#h78-0-550" id="h78-0-550" class="i">+	if (g_strcmp0(uri, &quot;&quot;) == 0)
</a><a href="#h78-0-551" id="h78-0-551" class="i">+		return;
</a><a href="#h78-0-552" id="h78-0-552" class="i">+
</a><a href="#h78-0-553" id="h78-0-553" class="i">+	if (g_str_has_prefix(uri, &quot;http://&quot;)  ||
</a><a href="#h78-0-554" id="h78-0-554" class="i">+	    g_str_has_prefix(uri, &quot;https://&quot;) ||
</a><a href="#h78-0-555" id="h78-0-555" class="i">+	    g_str_has_prefix(uri, &quot;file://&quot;)  ||
</a><a href="#h78-0-556" id="h78-0-556" class="i">+	    g_str_has_prefix(uri, &quot;about:&quot;)) {
</a><a href="#h78-0-557" id="h78-0-557" class="i">+		url = g_strdup(uri);
</a><a href="#h78-0-558" id="h78-0-558" class="i">+	} else {
</a><a href="#h78-0-559" id="h78-0-559" class="i">+		if (uri[0] == &#39;~&#39;)
</a><a href="#h78-0-560" id="h78-0-560" class="i">+			apath = untildepath(uri);
</a><a href="#h78-0-561" id="h78-0-561" class="i">+		else
</a><a href="#h78-0-562" id="h78-0-562" class="i">+			apath = (char *)uri;
</a><a href="#h78-0-563" id="h78-0-563" class="i">+		if (!stat(apath, &amp;st) &amp;&amp; (path = realpath(apath, NULL))) {
</a><a href="#h78-0-564" id="h78-0-564" class="i">+			url = g_strdup_printf(&quot;file://%s&quot;, path);
</a><a href="#h78-0-565" id="h78-0-565" class="i">+			free(path);
</a><a href="#h78-0-566" id="h78-0-566" class="i">+		} else {
</a><a href="#h78-0-567" id="h78-0-567" class="i">+			url = parseuri(uri);
</a><a href="#h78-0-568" id="h78-0-568" class="i">+		}
</a><a href="#h78-0-569" id="h78-0-569" class="i">+		if (apath != uri)
</a><a href="#h78-0-570" id="h78-0-570" class="i">+			free(apath);
</a><a href="#h78-0-571" id="h78-0-571" class="i">+	}
</a><a href="#h78-0-572" id="h78-0-572" class="i">+
</a><a href="#h78-0-573" id="h78-0-573" class="i">+	setatom(c, AtomUri, url);
</a><a href="#h78-0-574" id="h78-0-574" class="i">+
</a><a href="#h78-0-575" id="h78-0-575" class="i">+	if (strcmp(url, geturi(c)) == 0) {
</a><a href="#h78-0-576" id="h78-0-576" class="i">+		reload(c, a);
</a><a href="#h78-0-577" id="h78-0-577" class="i">+	} else {
</a><a href="#h78-0-578" id="h78-0-578" class="i">+		webkit_web_view_load_uri(c-&gt;view, url);
</a><a href="#h78-0-579" id="h78-0-579" class="i">+		updatetitle(c);
</a><a href="#h78-0-580" id="h78-0-580" class="i">+	}
</a><a href="#h78-0-581" id="h78-0-581" class="i">+
</a><a href="#h78-0-582" id="h78-0-582" class="i">+	g_free(url);
</a><a href="#h78-0-583" id="h78-0-583" class="i">+}
</a><a href="#h78-0-584" id="h78-0-584" class="i">+
</a><a href="#h78-0-585" id="h78-0-585" class="i">+const char *
</a><a href="#h78-0-586" id="h78-0-586" class="i">+geturi(Client *c)
</a><a href="#h78-0-587" id="h78-0-587" class="i">+{
</a><a href="#h78-0-588" id="h78-0-588" class="i">+	const char *uri;
</a><a href="#h78-0-589" id="h78-0-589" class="i">+
</a><a href="#h78-0-590" id="h78-0-590" class="i">+	if (!(uri = webkit_web_view_get_uri(c-&gt;view)))
</a><a href="#h78-0-591" id="h78-0-591" class="i">+		uri = &quot;about:blank&quot;;
</a><a href="#h78-0-592" id="h78-0-592" class="i">+	return uri;
</a><a href="#h78-0-593" id="h78-0-593" class="i">+}
</a><a href="#h78-0-594" id="h78-0-594" class="i">+
</a><a href="#h78-0-595" id="h78-0-595" class="i">+void
</a><a href="#h78-0-596" id="h78-0-596" class="i">+setatom(Client *c, int a, const char *v)
</a><a href="#h78-0-597" id="h78-0-597" class="i">+{
</a><a href="#h78-0-598" id="h78-0-598" class="i">+	XChangeProperty(dpy, c-&gt;xid,
</a><a href="#h78-0-599" id="h78-0-599" class="i">+	                atoms[a], XA_STRING, 8, PropModeReplace,
</a><a href="#h78-0-600" id="h78-0-600" class="i">+	                (unsigned char *)v, strlen(v) + 1);
</a><a href="#h78-0-601" id="h78-0-601" class="i">+	XSync(dpy, False);
</a><a href="#h78-0-602" id="h78-0-602" class="i">+}
</a><a href="#h78-0-603" id="h78-0-603" class="i">+
</a><a href="#h78-0-604" id="h78-0-604" class="i">+const char *
</a><a href="#h78-0-605" id="h78-0-605" class="i">+getatom(Client *c, int a)
</a><a href="#h78-0-606" id="h78-0-606" class="i">+{
</a><a href="#h78-0-607" id="h78-0-607" class="i">+	static char buf[BUFSIZ];
</a><a href="#h78-0-608" id="h78-0-608" class="i">+	Atom adummy;
</a><a href="#h78-0-609" id="h78-0-609" class="i">+	int idummy;
</a><a href="#h78-0-610" id="h78-0-610" class="i">+	unsigned long ldummy;
</a><a href="#h78-0-611" id="h78-0-611" class="i">+	unsigned char *p = NULL;
</a><a href="#h78-0-612" id="h78-0-612" class="i">+
</a><a href="#h78-0-613" id="h78-0-613" class="i">+	XSync(dpy, False);
</a><a href="#h78-0-614" id="h78-0-614" class="i">+	XGetWindowProperty(dpy, c-&gt;xid, atoms[a], 0L, BUFSIZ, False, XA_STRING,
</a><a href="#h78-0-615" id="h78-0-615" class="i">+	                   &amp;adummy, &amp;idummy, &amp;ldummy, &amp;ldummy, &amp;p);
</a><a href="#h78-0-616" id="h78-0-616" class="i">+	if (p)
</a><a href="#h78-0-617" id="h78-0-617" class="i">+		strncpy(buf, (char *)p, LENGTH(buf) - 1);
</a><a href="#h78-0-618" id="h78-0-618" class="i">+	else
</a><a href="#h78-0-619" id="h78-0-619" class="i">+		buf[0] = &#39;\0&#39;;
</a><a href="#h78-0-620" id="h78-0-620" class="i">+	XFree(p);
</a><a href="#h78-0-621" id="h78-0-621" class="i">+
</a><a href="#h78-0-622" id="h78-0-622" class="i">+	return buf;
</a><a href="#h78-0-623" id="h78-0-623" class="i">+}
</a><a href="#h78-0-624" id="h78-0-624" class="i">+
</a><a href="#h78-0-625" id="h78-0-625" class="i">+void
</a><a href="#h78-0-626" id="h78-0-626" class="i">+updatetitle(Client *c)
</a><a href="#h78-0-627" id="h78-0-627" class="i">+{
</a><a href="#h78-0-628" id="h78-0-628" class="i">+	char *title;
</a><a href="#h78-0-629" id="h78-0-629" class="i">+	const char *name = c-&gt;overtitle ? c-&gt;overtitle :
</a><a href="#h78-0-630" id="h78-0-630" class="i">+	                   c-&gt;title ? c-&gt;title : &quot;&quot;;
</a><a href="#h78-0-631" id="h78-0-631" class="i">+
</a><a href="#h78-0-632" id="h78-0-632" class="i">+	if (curconfig[ShowIndicators].val.i) {
</a><a href="#h78-0-633" id="h78-0-633" class="i">+		gettogglestats(c);
</a><a href="#h78-0-634" id="h78-0-634" class="i">+		getpagestats(c);
</a><a href="#h78-0-635" id="h78-0-635" class="i">+
</a><a href="#h78-0-636" id="h78-0-636" class="i">+		if (c-&gt;progress != 100)
</a><a href="#h78-0-637" id="h78-0-637" class="i">+			title = g_strdup_printf(&quot;[%i%%] %s:%s | %s&quot;,
</a><a href="#h78-0-638" id="h78-0-638" class="i">+			        c-&gt;progress, togglestats, pagestats, name);
</a><a href="#h78-0-639" id="h78-0-639" class="i">+		else
</a><a href="#h78-0-640" id="h78-0-640" class="i">+			title = g_strdup_printf(&quot;%s:%s | %s&quot;,
</a><a href="#h78-0-641" id="h78-0-641" class="i">+			        togglestats, pagestats, name);
</a><a href="#h78-0-642" id="h78-0-642" class="i">+
</a><a href="#h78-0-643" id="h78-0-643" class="i">+		gtk_window_set_title(GTK_WINDOW(c-&gt;win), title);
</a><a href="#h78-0-644" id="h78-0-644" class="i">+		g_free(title);
</a><a href="#h78-0-645" id="h78-0-645" class="i">+	} else {
</a><a href="#h78-0-646" id="h78-0-646" class="i">+		gtk_window_set_title(GTK_WINDOW(c-&gt;win), name);
</a><a href="#h78-0-647" id="h78-0-647" class="i">+	}
</a><a href="#h78-0-648" id="h78-0-648" class="i">+}
</a><a href="#h78-0-649" id="h78-0-649" class="i">+
</a><a href="#h78-0-650" id="h78-0-650" class="i">+void
</a><a href="#h78-0-651" id="h78-0-651" class="i">+gettogglestats(Client *c)
</a><a href="#h78-0-652" id="h78-0-652" class="i">+{
</a><a href="#h78-0-653" id="h78-0-653" class="i">+	togglestats[0] = cookiepolicy_set(cookiepolicy_get());
</a><a href="#h78-0-654" id="h78-0-654" class="i">+	togglestats[1] = curconfig[CaretBrowsing].val.i ?   &#39;C&#39; : &#39;c&#39;;
</a><a href="#h78-0-655" id="h78-0-655" class="i">+	togglestats[2] = curconfig[Geolocation].val.i ?     &#39;G&#39; : &#39;g&#39;;
</a><a href="#h78-0-656" id="h78-0-656" class="i">+	togglestats[3] = curconfig[DiskCache].val.i ?       &#39;D&#39; : &#39;d&#39;;
</a><a href="#h78-0-657" id="h78-0-657" class="i">+	togglestats[4] = curconfig[LoadImages].val.i ?      &#39;I&#39; : &#39;i&#39;;
</a><a href="#h78-0-658" id="h78-0-658" class="i">+	togglestats[5] = curconfig[JavaScript].val.i ?      &#39;S&#39; : &#39;s&#39;;
</a><a href="#h78-0-659" id="h78-0-659" class="i">+	togglestats[6] = curconfig[Plugins].val.i ?         &#39;V&#39; : &#39;v&#39;;
</a><a href="#h78-0-660" id="h78-0-660" class="i">+	togglestats[7] = curconfig[Style].val.i ?           &#39;M&#39; : &#39;m&#39;;
</a><a href="#h78-0-661" id="h78-0-661" class="i">+	togglestats[8] = curconfig[FrameFlattening].val.i ? &#39;F&#39; : &#39;f&#39;;
</a><a href="#h78-0-662" id="h78-0-662" class="i">+	togglestats[9] = curconfig[Certificate].val.i ?     &#39;X&#39; : &#39;x&#39;;
</a><a href="#h78-0-663" id="h78-0-663" class="i">+	togglestats[10] = curconfig[StrictTLS].val.i ?      &#39;T&#39; : &#39;t&#39;;
</a><a href="#h78-0-664" id="h78-0-664" class="i">+	togglestats[11] = &#39;\0&#39;;
</a><a href="#h78-0-665" id="h78-0-665" class="i">+}
</a><a href="#h78-0-666" id="h78-0-666" class="i">+
</a><a href="#h78-0-667" id="h78-0-667" class="i">+void
</a><a href="#h78-0-668" id="h78-0-668" class="i">+getpagestats(Client *c)
</a><a href="#h78-0-669" id="h78-0-669" class="i">+{
</a><a href="#h78-0-670" id="h78-0-670" class="i">+	if (c-&gt;https)
</a><a href="#h78-0-671" id="h78-0-671" class="i">+		pagestats[0] = (c-&gt;tlserr || c-&gt;insecure) ?  &#39;U&#39; : &#39;T&#39;;
</a><a href="#h78-0-672" id="h78-0-672" class="i">+	else
</a><a href="#h78-0-673" id="h78-0-673" class="i">+		pagestats[0] = &#39;-&#39;;
</a><a href="#h78-0-674" id="h78-0-674" class="i">+	pagestats[1] = &#39;\0&#39;;
</a><a href="#h78-0-675" id="h78-0-675" class="i">+}
</a><a href="#h78-0-676" id="h78-0-676" class="i">+
</a><a href="#h78-0-677" id="h78-0-677" class="i">+WebKitCookieAcceptPolicy
</a><a href="#h78-0-678" id="h78-0-678" class="i">+cookiepolicy_get(void)
</a><a href="#h78-0-679" id="h78-0-679" class="i">+{
</a><a href="#h78-0-680" id="h78-0-680" class="i">+	switch (((char *)curconfig[CookiePolicies].val.v)[cookiepolicy]) {
</a><a href="#h78-0-681" id="h78-0-681" class="i">+	case &#39;a&#39;:
</a><a href="#h78-0-682" id="h78-0-682" class="i">+		return WEBKIT_COOKIE_POLICY_ACCEPT_NEVER;
</a><a href="#h78-0-683" id="h78-0-683" class="i">+	case &#39;@&#39;:
</a><a href="#h78-0-684" id="h78-0-684" class="i">+		return WEBKIT_COOKIE_POLICY_ACCEPT_NO_THIRD_PARTY;
</a><a href="#h78-0-685" id="h78-0-685" class="i">+	default: /* fallthrough */
</a><a href="#h78-0-686" id="h78-0-686" class="i">+	case &#39;A&#39;:
</a><a href="#h78-0-687" id="h78-0-687" class="i">+		return WEBKIT_COOKIE_POLICY_ACCEPT_ALWAYS;
</a><a href="#h78-0-688" id="h78-0-688" class="i">+	}
</a><a href="#h78-0-689" id="h78-0-689" class="i">+}
</a><a href="#h78-0-690" id="h78-0-690" class="i">+
</a><a href="#h78-0-691" id="h78-0-691" class="i">+char
</a><a href="#h78-0-692" id="h78-0-692" class="i">+cookiepolicy_set(const WebKitCookieAcceptPolicy p)
</a><a href="#h78-0-693" id="h78-0-693" class="i">+{
</a><a href="#h78-0-694" id="h78-0-694" class="i">+	switch (p) {
</a><a href="#h78-0-695" id="h78-0-695" class="i">+	case WEBKIT_COOKIE_POLICY_ACCEPT_NEVER:
</a><a href="#h78-0-696" id="h78-0-696" class="i">+		return &#39;a&#39;;
</a><a href="#h78-0-697" id="h78-0-697" class="i">+	case WEBKIT_COOKIE_POLICY_ACCEPT_NO_THIRD_PARTY:
</a><a href="#h78-0-698" id="h78-0-698" class="i">+		return &#39;@&#39;;
</a><a href="#h78-0-699" id="h78-0-699" class="i">+	default: /* fallthrough */
</a><a href="#h78-0-700" id="h78-0-700" class="i">+	case WEBKIT_COOKIE_POLICY_ACCEPT_ALWAYS:
</a><a href="#h78-0-701" id="h78-0-701" class="i">+		return &#39;A&#39;;
</a><a href="#h78-0-702" id="h78-0-702" class="i">+	}
</a><a href="#h78-0-703" id="h78-0-703" class="i">+}
</a><a href="#h78-0-704" id="h78-0-704" class="i">+
</a><a href="#h78-0-705" id="h78-0-705" class="i">+void
</a><a href="#h78-0-706" id="h78-0-706" class="i">+seturiparameters(Client *c, const char *uri, ParamName *params)
</a><a href="#h78-0-707" id="h78-0-707" class="i">+{
</a><a href="#h78-0-708" id="h78-0-708" class="i">+	Parameter *config, *uriconfig = NULL;
</a><a href="#h78-0-709" id="h78-0-709" class="i">+	int i, p;
</a><a href="#h78-0-710" id="h78-0-710" class="i">+
</a><a href="#h78-0-711" id="h78-0-711" class="i">+	for (i = 0; i &lt; LENGTH(uriparams); ++i) {
</a><a href="#h78-0-712" id="h78-0-712" class="i">+		if (uriparams[i].uri &amp;&amp;
</a><a href="#h78-0-713" id="h78-0-713" class="i">+		    !regexec(&amp;(uriparams[i].re), uri, 0, NULL, 0)) {
</a><a href="#h78-0-714" id="h78-0-714" class="i">+			uriconfig = uriparams[i].config;
</a><a href="#h78-0-715" id="h78-0-715" class="i">+			break;
</a><a href="#h78-0-716" id="h78-0-716" class="i">+		}
</a><a href="#h78-0-717" id="h78-0-717" class="i">+	}
</a><a href="#h78-0-718" id="h78-0-718" class="i">+
</a><a href="#h78-0-719" id="h78-0-719" class="i">+	curconfig = uriconfig ? uriconfig : defconfig;
</a><a href="#h78-0-720" id="h78-0-720" class="i">+
</a><a href="#h78-0-721" id="h78-0-721" class="i">+	for (i = 0; (p = params[i]) != ParameterLast; ++i) {
</a><a href="#h78-0-722" id="h78-0-722" class="i">+		switch(p) {
</a><a href="#h78-0-723" id="h78-0-723" class="i">+		default: /* FALLTHROUGH */
</a><a href="#h78-0-724" id="h78-0-724" class="i">+			if (!(defconfig[p].prio &lt; curconfig[p].prio ||
</a><a href="#h78-0-725" id="h78-0-725" class="i">+			    defconfig[p].prio &lt; modparams[p]))
</a><a href="#h78-0-726" id="h78-0-726" class="i">+				continue;
</a><a href="#h78-0-727" id="h78-0-727" class="i">+		case Certificate:
</a><a href="#h78-0-728" id="h78-0-728" class="i">+		case CookiePolicies:
</a><a href="#h78-0-729" id="h78-0-729" class="i">+		case Style:
</a><a href="#h78-0-730" id="h78-0-730" class="i">+			setparameter(c, 0, p, &amp;curconfig[p].val);
</a><a href="#h78-0-731" id="h78-0-731" class="i">+		}
</a><a href="#h78-0-732" id="h78-0-732" class="i">+	}
</a><a href="#h78-0-733" id="h78-0-733" class="i">+}
</a><a href="#h78-0-734" id="h78-0-734" class="i">+
</a><a href="#h78-0-735" id="h78-0-735" class="i">+void
</a><a href="#h78-0-736" id="h78-0-736" class="i">+setparameter(Client *c, int refresh, ParamName p, const Arg *a)
</a><a href="#h78-0-737" id="h78-0-737" class="i">+{
</a><a href="#h78-0-738" id="h78-0-738" class="i">+	GdkRGBA bgcolor = { 0 };
</a><a href="#h78-0-739" id="h78-0-739" class="i">+	WebKitSettings *s = webkit_web_view_get_settings(c-&gt;view);
</a><a href="#h78-0-740" id="h78-0-740" class="i">+
</a><a href="#h78-0-741" id="h78-0-741" class="i">+	modparams[p] = curconfig[p].prio;
</a><a href="#h78-0-742" id="h78-0-742" class="i">+
</a><a href="#h78-0-743" id="h78-0-743" class="i">+	switch (p) {
</a><a href="#h78-0-744" id="h78-0-744" class="i">+	case AcceleratedCanvas:
</a><a href="#h78-0-745" id="h78-0-745" class="i">+		webkit_settings_set_enable_accelerated_2d_canvas(s, a-&gt;i);
</a><a href="#h78-0-746" id="h78-0-746" class="i">+		break;
</a><a href="#h78-0-747" id="h78-0-747" class="i">+	case AccessMicrophone:
</a><a href="#h78-0-748" id="h78-0-748" class="i">+		return; /* do nothing */
</a><a href="#h78-0-749" id="h78-0-749" class="i">+	case AccessWebcam:
</a><a href="#h78-0-750" id="h78-0-750" class="i">+		return; /* do nothing */
</a><a href="#h78-0-751" id="h78-0-751" class="i">+	case CaretBrowsing:
</a><a href="#h78-0-752" id="h78-0-752" class="i">+		webkit_settings_set_enable_caret_browsing(s, a-&gt;i);
</a><a href="#h78-0-753" id="h78-0-753" class="i">+		refresh = 0;
</a><a href="#h78-0-754" id="h78-0-754" class="i">+		break;
</a><a href="#h78-0-755" id="h78-0-755" class="i">+	case Certificate:
</a><a href="#h78-0-756" id="h78-0-756" class="i">+		if (a-&gt;i)
</a><a href="#h78-0-757" id="h78-0-757" class="i">+			setcert(c, geturi(c));
</a><a href="#h78-0-758" id="h78-0-758" class="i">+		return; /* do not update */
</a><a href="#h78-0-759" id="h78-0-759" class="i">+	case CookiePolicies:
</a><a href="#h78-0-760" id="h78-0-760" class="i">+		webkit_cookie_manager_set_accept_policy(
</a><a href="#h78-0-761" id="h78-0-761" class="i">+		    webkit_web_context_get_cookie_manager(
</a><a href="#h78-0-762" id="h78-0-762" class="i">+		    webkit_web_view_get_context(c-&gt;view)),
</a><a href="#h78-0-763" id="h78-0-763" class="i">+		    cookiepolicy_get());
</a><a href="#h78-0-764" id="h78-0-764" class="i">+		refresh = 0;
</a><a href="#h78-0-765" id="h78-0-765" class="i">+		break;
</a><a href="#h78-0-766" id="h78-0-766" class="i">+	case DiskCache:
</a><a href="#h78-0-767" id="h78-0-767" class="i">+		webkit_web_context_set_cache_model(
</a><a href="#h78-0-768" id="h78-0-768" class="i">+		    webkit_web_view_get_context(c-&gt;view), a-&gt;i ?
</a><a href="#h78-0-769" id="h78-0-769" class="i">+		    WEBKIT_CACHE_MODEL_WEB_BROWSER :
</a><a href="#h78-0-770" id="h78-0-770" class="i">+		    WEBKIT_CACHE_MODEL_DOCUMENT_VIEWER);
</a><a href="#h78-0-771" id="h78-0-771" class="i">+		return; /* do not update */
</a><a href="#h78-0-772" id="h78-0-772" class="i">+	case DefaultCharset:
</a><a href="#h78-0-773" id="h78-0-773" class="i">+		webkit_settings_set_default_charset(s, a-&gt;v);
</a><a href="#h78-0-774" id="h78-0-774" class="i">+		return; /* do not update */
</a><a href="#h78-0-775" id="h78-0-775" class="i">+	case DNSPrefetch:
</a><a href="#h78-0-776" id="h78-0-776" class="i">+		webkit_settings_set_enable_dns_prefetching(s, a-&gt;i);
</a><a href="#h78-0-777" id="h78-0-777" class="i">+		return; /* do not update */
</a><a href="#h78-0-778" id="h78-0-778" class="i">+	case FileURLsCrossAccess:
</a><a href="#h78-0-779" id="h78-0-779" class="i">+		webkit_settings_set_allow_file_access_from_file_urls(s, a-&gt;i);
</a><a href="#h78-0-780" id="h78-0-780" class="i">+		webkit_settings_set_allow_universal_access_from_file_urls(s, a-&gt;i);
</a><a href="#h78-0-781" id="h78-0-781" class="i">+		return; /* do not update */
</a><a href="#h78-0-782" id="h78-0-782" class="i">+	case FontSize:
</a><a href="#h78-0-783" id="h78-0-783" class="i">+		webkit_settings_set_default_font_size(s, a-&gt;i);
</a><a href="#h78-0-784" id="h78-0-784" class="i">+		return; /* do not update */
</a><a href="#h78-0-785" id="h78-0-785" class="i">+	case FrameFlattening:
</a><a href="#h78-0-786" id="h78-0-786" class="i">+		webkit_settings_set_enable_frame_flattening(s, a-&gt;i);
</a><a href="#h78-0-787" id="h78-0-787" class="i">+		break;
</a><a href="#h78-0-788" id="h78-0-788" class="i">+	case Geolocation:
</a><a href="#h78-0-789" id="h78-0-789" class="i">+		refresh = 0;
</a><a href="#h78-0-790" id="h78-0-790" class="i">+		break;
</a><a href="#h78-0-791" id="h78-0-791" class="i">+	case HideBackground:
</a><a href="#h78-0-792" id="h78-0-792" class="i">+		if (a-&gt;i)
</a><a href="#h78-0-793" id="h78-0-793" class="i">+			webkit_web_view_set_background_color(c-&gt;view, &amp;bgcolor);
</a><a href="#h78-0-794" id="h78-0-794" class="i">+		return; /* do not update */
</a><a href="#h78-0-795" id="h78-0-795" class="i">+	case Inspector:
</a><a href="#h78-0-796" id="h78-0-796" class="i">+		webkit_settings_set_enable_developer_extras(s, a-&gt;i);
</a><a href="#h78-0-797" id="h78-0-797" class="i">+		return; /* do not update */
</a><a href="#h78-0-798" id="h78-0-798" class="i">+	case Java:
</a><a href="#h78-0-799" id="h78-0-799" class="i">+		webkit_settings_set_enable_java(s, a-&gt;i);
</a><a href="#h78-0-800" id="h78-0-800" class="i">+		return; /* do not update */
</a><a href="#h78-0-801" id="h78-0-801" class="i">+	case JavaScript:
</a><a href="#h78-0-802" id="h78-0-802" class="i">+		webkit_settings_set_enable_javascript(s, a-&gt;i);
</a><a href="#h78-0-803" id="h78-0-803" class="i">+		break;
</a><a href="#h78-0-804" id="h78-0-804" class="i">+	case KioskMode:
</a><a href="#h78-0-805" id="h78-0-805" class="i">+		return; /* do nothing */
</a><a href="#h78-0-806" id="h78-0-806" class="i">+	case LoadImages:
</a><a href="#h78-0-807" id="h78-0-807" class="i">+		webkit_settings_set_auto_load_images(s, a-&gt;i);
</a><a href="#h78-0-808" id="h78-0-808" class="i">+		break;
</a><a href="#h78-0-809" id="h78-0-809" class="i">+	case MediaManualPlay:
</a><a href="#h78-0-810" id="h78-0-810" class="i">+		webkit_settings_set_media_playback_requires_user_gesture(s, a-&gt;i);
</a><a href="#h78-0-811" id="h78-0-811" class="i">+		break;
</a><a href="#h78-0-812" id="h78-0-812" class="i">+	case Plugins:
</a><a href="#h78-0-813" id="h78-0-813" class="i">+		webkit_settings_set_enable_plugins(s, a-&gt;i);
</a><a href="#h78-0-814" id="h78-0-814" class="i">+		break;
</a><a href="#h78-0-815" id="h78-0-815" class="i">+	case PreferredLanguages:
</a><a href="#h78-0-816" id="h78-0-816" class="i">+		return; /* do nothing */
</a><a href="#h78-0-817" id="h78-0-817" class="i">+	case RunInFullscreen:
</a><a href="#h78-0-818" id="h78-0-818" class="i">+		return; /* do nothing */
</a><a href="#h78-0-819" id="h78-0-819" class="i">+	case ScrollBars:
</a><a href="#h78-0-820" id="h78-0-820" class="i">+		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h78-0-821" id="h78-0-821" class="i">+		 * manipulating the DOM directly.
</a><a href="#h78-0-822" id="h78-0-822" class="i">+		enablescrollbars = !enablescrollbars;
</a><a href="#h78-0-823" id="h78-0-823" class="i">+		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h78-0-824" id="h78-0-824" class="i">+		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h78-0-825" id="h78-0-825" class="i">+		*/
</a><a href="#h78-0-826" id="h78-0-826" class="i">+		return; /* do not update */
</a><a href="#h78-0-827" id="h78-0-827" class="i">+	case ShowIndicators:
</a><a href="#h78-0-828" id="h78-0-828" class="i">+		break;
</a><a href="#h78-0-829" id="h78-0-829" class="i">+	case SmoothScrolling:
</a><a href="#h78-0-830" id="h78-0-830" class="i">+		webkit_settings_set_enable_smooth_scrolling(s, a-&gt;i);
</a><a href="#h78-0-831" id="h78-0-831" class="i">+		return; /* do not update */
</a><a href="#h78-0-832" id="h78-0-832" class="i">+	case SiteQuirks:
</a><a href="#h78-0-833" id="h78-0-833" class="i">+		webkit_settings_set_enable_site_specific_quirks(s, a-&gt;i);
</a><a href="#h78-0-834" id="h78-0-834" class="i">+		break;
</a><a href="#h78-0-835" id="h78-0-835" class="i">+	case SpellChecking:
</a><a href="#h78-0-836" id="h78-0-836" class="i">+		webkit_web_context_set_spell_checking_enabled(
</a><a href="#h78-0-837" id="h78-0-837" class="i">+		    webkit_web_view_get_context(c-&gt;view), a-&gt;i);
</a><a href="#h78-0-838" id="h78-0-838" class="i">+		return; /* do not update */
</a><a href="#h78-0-839" id="h78-0-839" class="i">+	case SpellLanguages:
</a><a href="#h78-0-840" id="h78-0-840" class="i">+		return; /* do nothing */
</a><a href="#h78-0-841" id="h78-0-841" class="i">+	case StrictTLS:
</a><a href="#h78-0-842" id="h78-0-842" class="i">+		webkit_web_context_set_tls_errors_policy(
</a><a href="#h78-0-843" id="h78-0-843" class="i">+		    webkit_web_view_get_context(c-&gt;view), a-&gt;i ?
</a><a href="#h78-0-844" id="h78-0-844" class="i">+		    WEBKIT_TLS_ERRORS_POLICY_FAIL :
</a><a href="#h78-0-845" id="h78-0-845" class="i">+		    WEBKIT_TLS_ERRORS_POLICY_IGNORE);
</a><a href="#h78-0-846" id="h78-0-846" class="i">+		break;
</a><a href="#h78-0-847" id="h78-0-847" class="i">+	case Style:
</a><a href="#h78-0-848" id="h78-0-848" class="i">+		webkit_user_content_manager_remove_all_style_sheets(
</a><a href="#h78-0-849" id="h78-0-849" class="i">+		    webkit_web_view_get_user_content_manager(c-&gt;view));
</a><a href="#h78-0-850" id="h78-0-850" class="i">+		if (a-&gt;i)
</a><a href="#h78-0-851" id="h78-0-851" class="i">+			setstyle(c, getstyle(geturi(c)));
</a><a href="#h78-0-852" id="h78-0-852" class="i">+		refresh = 0;
</a><a href="#h78-0-853" id="h78-0-853" class="i">+		break;
</a><a href="#h78-0-854" id="h78-0-854" class="i">+	case WebGL:
</a><a href="#h78-0-855" id="h78-0-855" class="i">+		webkit_settings_set_enable_webgl(s, a-&gt;i);
</a><a href="#h78-0-856" id="h78-0-856" class="i">+		break;
</a><a href="#h78-0-857" id="h78-0-857" class="i">+	case ZoomLevel:
</a><a href="#h78-0-858" id="h78-0-858" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, a-&gt;f);
</a><a href="#h78-0-859" id="h78-0-859" class="i">+		return; /* do not update */
</a><a href="#h78-0-860" id="h78-0-860" class="i">+	default:
</a><a href="#h78-0-861" id="h78-0-861" class="i">+		return; /* do nothing */
</a><a href="#h78-0-862" id="h78-0-862" class="i">+	}
</a><a href="#h78-0-863" id="h78-0-863" class="i">+
</a><a href="#h78-0-864" id="h78-0-864" class="i">+	updatetitle(c);
</a><a href="#h78-0-865" id="h78-0-865" class="i">+	if (refresh)
</a><a href="#h78-0-866" id="h78-0-866" class="i">+		reload(c, a);
</a><a href="#h78-0-867" id="h78-0-867" class="i">+}
</a><a href="#h78-0-868" id="h78-0-868" class="i">+
</a><a href="#h78-0-869" id="h78-0-869" class="i">+const char *
</a><a href="#h78-0-870" id="h78-0-870" class="i">+getcert(const char *uri)
</a><a href="#h78-0-871" id="h78-0-871" class="i">+{
</a><a href="#h78-0-872" id="h78-0-872" class="i">+	int i;
</a><a href="#h78-0-873" id="h78-0-873" class="i">+
</a><a href="#h78-0-874" id="h78-0-874" class="i">+	for (i = 0; i &lt; LENGTH(certs); ++i) {
</a><a href="#h78-0-875" id="h78-0-875" class="i">+		if (certs[i].regex &amp;&amp;
</a><a href="#h78-0-876" id="h78-0-876" class="i">+		    !regexec(&amp;(certs[i].re), uri, 0, NULL, 0))
</a><a href="#h78-0-877" id="h78-0-877" class="i">+			return certs[i].file;
</a><a href="#h78-0-878" id="h78-0-878" class="i">+	}
</a><a href="#h78-0-879" id="h78-0-879" class="i">+
</a><a href="#h78-0-880" id="h78-0-880" class="i">+	return NULL;
</a><a href="#h78-0-881" id="h78-0-881" class="i">+}
</a><a href="#h78-0-882" id="h78-0-882" class="i">+
</a><a href="#h78-0-883" id="h78-0-883" class="i">+void
</a><a href="#h78-0-884" id="h78-0-884" class="i">+setcert(Client *c, const char *uri)
</a><a href="#h78-0-885" id="h78-0-885" class="i">+{
</a><a href="#h78-0-886" id="h78-0-886" class="i">+	const char *file = getcert(uri);
</a><a href="#h78-0-887" id="h78-0-887" class="i">+	char *host;
</a><a href="#h78-0-888" id="h78-0-888" class="i">+	GTlsCertificate *cert;
</a><a href="#h78-0-889" id="h78-0-889" class="i">+
</a><a href="#h78-0-890" id="h78-0-890" class="i">+	if (!file)
</a><a href="#h78-0-891" id="h78-0-891" class="i">+		return;
</a><a href="#h78-0-892" id="h78-0-892" class="i">+
</a><a href="#h78-0-893" id="h78-0-893" class="i">+	if (!(cert = g_tls_certificate_new_from_file(file, NULL))) {
</a><a href="#h78-0-894" id="h78-0-894" class="i">+		fprintf(stderr, &quot;Could not read certificate file: %s\n&quot;, file);
</a><a href="#h78-0-895" id="h78-0-895" class="i">+		return;
</a><a href="#h78-0-896" id="h78-0-896" class="i">+	}
</a><a href="#h78-0-897" id="h78-0-897" class="i">+
</a><a href="#h78-0-898" id="h78-0-898" class="i">+	if ((uri = strstr(uri, &quot;https://&quot;))) {
</a><a href="#h78-0-899" id="h78-0-899" class="i">+		uri += sizeof(&quot;https://&quot;) - 1;
</a><a href="#h78-0-900" id="h78-0-900" class="i">+		host = g_strndup(uri, strchr(uri, &#39;/&#39;) - uri);
</a><a href="#h78-0-901" id="h78-0-901" class="i">+		webkit_web_context_allow_tls_certificate_for_host(
</a><a href="#h78-0-902" id="h78-0-902" class="i">+		    webkit_web_view_get_context(c-&gt;view), cert, host);
</a><a href="#h78-0-903" id="h78-0-903" class="i">+		g_free(host);
</a><a href="#h78-0-904" id="h78-0-904" class="i">+	}
</a><a href="#h78-0-905" id="h78-0-905" class="i">+
</a><a href="#h78-0-906" id="h78-0-906" class="i">+	g_object_unref(cert);
</a><a href="#h78-0-907" id="h78-0-907" class="i">+
</a><a href="#h78-0-908" id="h78-0-908" class="i">+}
</a><a href="#h78-0-909" id="h78-0-909" class="i">+
</a><a href="#h78-0-910" id="h78-0-910" class="i">+const char *
</a><a href="#h78-0-911" id="h78-0-911" class="i">+getstyle(const char *uri)
</a><a href="#h78-0-912" id="h78-0-912" class="i">+{
</a><a href="#h78-0-913" id="h78-0-913" class="i">+	int i;
</a><a href="#h78-0-914" id="h78-0-914" class="i">+
</a><a href="#h78-0-915" id="h78-0-915" class="i">+	if (stylefile)
</a><a href="#h78-0-916" id="h78-0-916" class="i">+		return stylefile;
</a><a href="#h78-0-917" id="h78-0-917" class="i">+
</a><a href="#h78-0-918" id="h78-0-918" class="i">+	for (i = 0; i &lt; LENGTH(styles); ++i) {
</a><a href="#h78-0-919" id="h78-0-919" class="i">+		if (styles[i].regex &amp;&amp;
</a><a href="#h78-0-920" id="h78-0-920" class="i">+		    !regexec(&amp;(styles[i].re), uri, 0, NULL, 0))
</a><a href="#h78-0-921" id="h78-0-921" class="i">+			return styles[i].file;
</a><a href="#h78-0-922" id="h78-0-922" class="i">+	}
</a><a href="#h78-0-923" id="h78-0-923" class="i">+
</a><a href="#h78-0-924" id="h78-0-924" class="i">+	return &quot;&quot;;
</a><a href="#h78-0-925" id="h78-0-925" class="i">+}
</a><a href="#h78-0-926" id="h78-0-926" class="i">+
</a><a href="#h78-0-927" id="h78-0-927" class="i">+void
</a><a href="#h78-0-928" id="h78-0-928" class="i">+setstyle(Client *c, const char *file)
</a><a href="#h78-0-929" id="h78-0-929" class="i">+{
</a><a href="#h78-0-930" id="h78-0-930" class="i">+	gchar *style;
</a><a href="#h78-0-931" id="h78-0-931" class="i">+
</a><a href="#h78-0-932" id="h78-0-932" class="i">+	if (!g_file_get_contents(file, &amp;style, NULL, NULL)) {
</a><a href="#h78-0-933" id="h78-0-933" class="i">+		fprintf(stderr, &quot;Could not read style file: %s\n&quot;, file);
</a><a href="#h78-0-934" id="h78-0-934" class="i">+		return;
</a><a href="#h78-0-935" id="h78-0-935" class="i">+	}
</a><a href="#h78-0-936" id="h78-0-936" class="i">+
</a><a href="#h78-0-937" id="h78-0-937" class="i">+	webkit_user_content_manager_add_style_sheet(
</a><a href="#h78-0-938" id="h78-0-938" class="i">+	    webkit_web_view_get_user_content_manager(c-&gt;view),
</a><a href="#h78-0-939" id="h78-0-939" class="i">+	    webkit_user_style_sheet_new(style,
</a><a href="#h78-0-940" id="h78-0-940" class="i">+	    WEBKIT_USER_CONTENT_INJECT_ALL_FRAMES,
</a><a href="#h78-0-941" id="h78-0-941" class="i">+	    WEBKIT_USER_STYLE_LEVEL_USER,
</a><a href="#h78-0-942" id="h78-0-942" class="i">+	    NULL, NULL));
</a><a href="#h78-0-943" id="h78-0-943" class="i">+
</a><a href="#h78-0-944" id="h78-0-944" class="i">+	g_free(style);
</a><a href="#h78-0-945" id="h78-0-945" class="i">+}
</a><a href="#h78-0-946" id="h78-0-946" class="i">+
</a><a href="#h78-0-947" id="h78-0-947" class="i">+void
</a><a href="#h78-0-948" id="h78-0-948" class="i">+runscript(Client *c)
</a><a href="#h78-0-949" id="h78-0-949" class="i">+{
</a><a href="#h78-0-950" id="h78-0-950" class="i">+	gchar *script;
</a><a href="#h78-0-951" id="h78-0-951" class="i">+	gsize l;
</a><a href="#h78-0-952" id="h78-0-952" class="i">+
</a><a href="#h78-0-953" id="h78-0-953" class="i">+	if (g_file_get_contents(scriptfile, &amp;script, &amp;l, NULL) &amp;&amp; l)
</a><a href="#h78-0-954" id="h78-0-954" class="i">+		evalscript(c, &quot;%s&quot;, script);
</a><a href="#h78-0-955" id="h78-0-955" class="i">+	g_free(script);
</a><a href="#h78-0-956" id="h78-0-956" class="i">+}
</a><a href="#h78-0-957" id="h78-0-957" class="i">+
</a><a href="#h78-0-958" id="h78-0-958" class="i">+void
</a><a href="#h78-0-959" id="h78-0-959" class="i">+evalscript(Client *c, const char *jsstr, ...)
</a><a href="#h78-0-960" id="h78-0-960" class="i">+{
</a><a href="#h78-0-961" id="h78-0-961" class="i">+	va_list ap;
</a><a href="#h78-0-962" id="h78-0-962" class="i">+	gchar *script;
</a><a href="#h78-0-963" id="h78-0-963" class="i">+
</a><a href="#h78-0-964" id="h78-0-964" class="i">+	va_start(ap, jsstr);
</a><a href="#h78-0-965" id="h78-0-965" class="i">+	script = g_strdup_vprintf(jsstr, ap);
</a><a href="#h78-0-966" id="h78-0-966" class="i">+	va_end(ap);
</a><a href="#h78-0-967" id="h78-0-967" class="i">+
</a><a href="#h78-0-968" id="h78-0-968" class="i">+	webkit_web_view_run_javascript(c-&gt;view, script, NULL, NULL, NULL);
</a><a href="#h78-0-969" id="h78-0-969" class="i">+	g_free(script);
</a><a href="#h78-0-970" id="h78-0-970" class="i">+}
</a><a href="#h78-0-971" id="h78-0-971" class="i">+
</a><a href="#h78-0-972" id="h78-0-972" class="i">+void
</a><a href="#h78-0-973" id="h78-0-973" class="i">+updatewinid(Client *c)
</a><a href="#h78-0-974" id="h78-0-974" class="i">+{
</a><a href="#h78-0-975" id="h78-0-975" class="i">+	snprintf(winid, LENGTH(winid), &quot;%lu&quot;, c-&gt;xid);
</a><a href="#h78-0-976" id="h78-0-976" class="i">+}
</a><a href="#h78-0-977" id="h78-0-977" class="i">+
</a><a href="#h78-0-978" id="h78-0-978" class="i">+void
</a><a href="#h78-0-979" id="h78-0-979" class="i">+handleplumb(Client *c, const char *uri)
</a><a href="#h78-0-980" id="h78-0-980" class="i">+{
</a><a href="#h78-0-981" id="h78-0-981" class="i">+	Arg a = (Arg)PLUMB(uri);
</a><a href="#h78-0-982" id="h78-0-982" class="i">+	spawn(c, &amp;a);
</a><a href="#h78-0-983" id="h78-0-983" class="i">+}
</a><a href="#h78-0-984" id="h78-0-984" class="i">+
</a><a href="#h78-0-985" id="h78-0-985" class="i">+void
</a><a href="#h78-0-986" id="h78-0-986" class="i">+newwindow(Client *c, const Arg *a, int noembed)
</a><a href="#h78-0-987" id="h78-0-987" class="i">+{
</a><a href="#h78-0-988" id="h78-0-988" class="i">+	int i = 0;
</a><a href="#h78-0-989" id="h78-0-989" class="i">+	char tmp[64];
</a><a href="#h78-0-990" id="h78-0-990" class="i">+	const char *cmd[29], *uri;
</a><a href="#h78-0-991" id="h78-0-991" class="i">+	const Arg arg = { .v = cmd };
</a><a href="#h78-0-992" id="h78-0-992" class="i">+
</a><a href="#h78-0-993" id="h78-0-993" class="i">+	cmd[i++] = argv0;
</a><a href="#h78-0-994" id="h78-0-994" class="i">+	cmd[i++] = &quot;-a&quot;;
</a><a href="#h78-0-995" id="h78-0-995" class="i">+	cmd[i++] = curconfig[CookiePolicies].val.v;
</a><a href="#h78-0-996" id="h78-0-996" class="i">+	cmd[i++] = curconfig[ScrollBars].val.i ? &quot;-B&quot; : &quot;-b&quot;;
</a><a href="#h78-0-997" id="h78-0-997" class="i">+	if (cookiefile &amp;&amp; g_strcmp0(cookiefile, &quot;&quot;)) {
</a><a href="#h78-0-998" id="h78-0-998" class="i">+		cmd[i++] = &quot;-c&quot;;
</a><a href="#h78-0-999" id="h78-0-999" class="i">+		cmd[i++] = cookiefile;
</a><a href="#h78-0-1000" id="h78-0-1000" class="i">+	}
</a><a href="#h78-0-1001" id="h78-0-1001" class="i">+	if (stylefile &amp;&amp; g_strcmp0(stylefile, &quot;&quot;)) {
</a><a href="#h78-0-1002" id="h78-0-1002" class="i">+		cmd[i++] = &quot;-C&quot;;
</a><a href="#h78-0-1003" id="h78-0-1003" class="i">+		cmd[i++] = stylefile;
</a><a href="#h78-0-1004" id="h78-0-1004" class="i">+	}
</a><a href="#h78-0-1005" id="h78-0-1005" class="i">+	cmd[i++] = curconfig[DiskCache].val.i ? &quot;-D&quot; : &quot;-d&quot;;
</a><a href="#h78-0-1006" id="h78-0-1006" class="i">+	if (embed &amp;&amp; !noembed) {
</a><a href="#h78-0-1007" id="h78-0-1007" class="i">+		cmd[i++] = &quot;-e&quot;;
</a><a href="#h78-0-1008" id="h78-0-1008" class="i">+		snprintf(tmp, LENGTH(tmp), &quot;%lu&quot;, embed);
</a><a href="#h78-0-1009" id="h78-0-1009" class="i">+		cmd[i++] = tmp;
</a><a href="#h78-0-1010" id="h78-0-1010" class="i">+	}
</a><a href="#h78-0-1011" id="h78-0-1011" class="i">+	cmd[i++] = curconfig[RunInFullscreen].val.i ? &quot;-F&quot; : &quot;-f&quot; ;
</a><a href="#h78-0-1012" id="h78-0-1012" class="i">+	cmd[i++] = curconfig[Geolocation].val.i ?     &quot;-G&quot; : &quot;-g&quot; ;
</a><a href="#h78-0-1013" id="h78-0-1013" class="i">+	cmd[i++] = curconfig[LoadImages].val.i ?      &quot;-I&quot; : &quot;-i&quot; ;
</a><a href="#h78-0-1014" id="h78-0-1014" class="i">+	cmd[i++] = curconfig[KioskMode].val.i ?       &quot;-K&quot; : &quot;-k&quot; ;
</a><a href="#h78-0-1015" id="h78-0-1015" class="i">+	cmd[i++] = curconfig[Style].val.i ?           &quot;-M&quot; : &quot;-m&quot; ;
</a><a href="#h78-0-1016" id="h78-0-1016" class="i">+	cmd[i++] = curconfig[Inspector].val.i ?       &quot;-N&quot; : &quot;-n&quot; ;
</a><a href="#h78-0-1017" id="h78-0-1017" class="i">+	cmd[i++] = curconfig[Plugins].val.i ?         &quot;-P&quot; : &quot;-p&quot; ;
</a><a href="#h78-0-1018" id="h78-0-1018" class="i">+	if (scriptfile &amp;&amp; g_strcmp0(scriptfile, &quot;&quot;)) {
</a><a href="#h78-0-1019" id="h78-0-1019" class="i">+		cmd[i++] = &quot;-r&quot;;
</a><a href="#h78-0-1020" id="h78-0-1020" class="i">+		cmd[i++] = scriptfile;
</a><a href="#h78-0-1021" id="h78-0-1021" class="i">+	}
</a><a href="#h78-0-1022" id="h78-0-1022" class="i">+	cmd[i++] = curconfig[JavaScript].val.i ? &quot;-S&quot; : &quot;-s&quot;;
</a><a href="#h78-0-1023" id="h78-0-1023" class="i">+	cmd[i++] = curconfig[StrictTLS].val.i ? &quot;-T&quot; : &quot;-t&quot;;
</a><a href="#h78-0-1024" id="h78-0-1024" class="i">+	if (fulluseragent &amp;&amp; g_strcmp0(fulluseragent, &quot;&quot;)) {
</a><a href="#h78-0-1025" id="h78-0-1025" class="i">+		cmd[i++] = &quot;-u&quot;;
</a><a href="#h78-0-1026" id="h78-0-1026" class="i">+		cmd[i++] = fulluseragent;
</a><a href="#h78-0-1027" id="h78-0-1027" class="i">+	}
</a><a href="#h78-0-1028" id="h78-0-1028" class="i">+	if (showxid)
</a><a href="#h78-0-1029" id="h78-0-1029" class="i">+		cmd[i++] = &quot;-w&quot;;
</a><a href="#h78-0-1030" id="h78-0-1030" class="i">+	cmd[i++] = curconfig[Certificate].val.i ? &quot;-X&quot; : &quot;-x&quot; ;
</a><a href="#h78-0-1031" id="h78-0-1031" class="i">+	/* do not keep zoom level */
</a><a href="#h78-0-1032" id="h78-0-1032" class="i">+	cmd[i++] = &quot;--&quot;;
</a><a href="#h78-0-1033" id="h78-0-1033" class="i">+	if ((uri = a-&gt;v))
</a><a href="#h78-0-1034" id="h78-0-1034" class="i">+		cmd[i++] = uri;
</a><a href="#h78-0-1035" id="h78-0-1035" class="i">+	cmd[i] = NULL;
</a><a href="#h78-0-1036" id="h78-0-1036" class="i">+
</a><a href="#h78-0-1037" id="h78-0-1037" class="i">+	spawn(c, &amp;arg);
</a><a href="#h78-0-1038" id="h78-0-1038" class="i">+}
</a><a href="#h78-0-1039" id="h78-0-1039" class="i">+
</a><a href="#h78-0-1040" id="h78-0-1040" class="i">+void
</a><a href="#h78-0-1041" id="h78-0-1041" class="i">+spawn(Client *c, const Arg *a)
</a><a href="#h78-0-1042" id="h78-0-1042" class="i">+{
</a><a href="#h78-0-1043" id="h78-0-1043" class="i">+	if (fork() == 0) {
</a><a href="#h78-0-1044" id="h78-0-1044" class="i">+		if (dpy)
</a><a href="#h78-0-1045" id="h78-0-1045" class="i">+			close(ConnectionNumber(dpy));
</a><a href="#h78-0-1046" id="h78-0-1046" class="i">+		close(pipein[0]);
</a><a href="#h78-0-1047" id="h78-0-1047" class="i">+		close(pipeout[1]);
</a><a href="#h78-0-1048" id="h78-0-1048" class="i">+		setsid();
</a><a href="#h78-0-1049" id="h78-0-1049" class="i">+		execvp(((char **)a-&gt;v)[0], (char **)a-&gt;v);
</a><a href="#h78-0-1050" id="h78-0-1050" class="i">+		fprintf(stderr, &quot;%s: execvp %s&quot;, argv0, ((char **)a-&gt;v)[0]);
</a><a href="#h78-0-1051" id="h78-0-1051" class="i">+		perror(&quot; failed&quot;);
</a><a href="#h78-0-1052" id="h78-0-1052" class="i">+		exit(1);
</a><a href="#h78-0-1053" id="h78-0-1053" class="i">+	}
</a><a href="#h78-0-1054" id="h78-0-1054" class="i">+}
</a><a href="#h78-0-1055" id="h78-0-1055" class="i">+
</a><a href="#h78-0-1056" id="h78-0-1056" class="i">+void
</a><a href="#h78-0-1057" id="h78-0-1057" class="i">+destroyclient(Client *c)
</a><a href="#h78-0-1058" id="h78-0-1058" class="i">+{
</a><a href="#h78-0-1059" id="h78-0-1059" class="i">+	Client *p;
</a><a href="#h78-0-1060" id="h78-0-1060" class="i">+
</a><a href="#h78-0-1061" id="h78-0-1061" class="i">+	webkit_web_view_stop_loading(c-&gt;view);
</a><a href="#h78-0-1062" id="h78-0-1062" class="i">+	/* Not needed, has already been called
</a><a href="#h78-0-1063" id="h78-0-1063" class="i">+	gtk_widget_destroy(c-&gt;win);
</a><a href="#h78-0-1064" id="h78-0-1064" class="i">+	 */
</a><a href="#h78-0-1065" id="h78-0-1065" class="i">+
</a><a href="#h78-0-1066" id="h78-0-1066" class="i">+	for (p = clients; p &amp;&amp; p-&gt;next != c; p = p-&gt;next)
</a><a href="#h78-0-1067" id="h78-0-1067" class="i">+		;
</a><a href="#h78-0-1068" id="h78-0-1068" class="i">+	if (p)
</a><a href="#h78-0-1069" id="h78-0-1069" class="i">+		p-&gt;next = c-&gt;next;
</a><a href="#h78-0-1070" id="h78-0-1070" class="i">+	else
</a><a href="#h78-0-1071" id="h78-0-1071" class="i">+		clients = c-&gt;next;
</a><a href="#h78-0-1072" id="h78-0-1072" class="i">+	free(c);
</a><a href="#h78-0-1073" id="h78-0-1073" class="i">+}
</a><a href="#h78-0-1074" id="h78-0-1074" class="i">+
</a><a href="#h78-0-1075" id="h78-0-1075" class="i">+void
</a><a href="#h78-0-1076" id="h78-0-1076" class="i">+cleanup(void)
</a><a href="#h78-0-1077" id="h78-0-1077" class="i">+{
</a><a href="#h78-0-1078" id="h78-0-1078" class="i">+	while (clients)
</a><a href="#h78-0-1079" id="h78-0-1079" class="i">+		destroyclient(clients);
</a><a href="#h78-0-1080" id="h78-0-1080" class="i">+
</a><a href="#h78-0-1081" id="h78-0-1081" class="i">+	close(pipein[0]);
</a><a href="#h78-0-1082" id="h78-0-1082" class="i">+	close(pipeout[1]);
</a><a href="#h78-0-1083" id="h78-0-1083" class="i">+	g_free(cookiefile);
</a><a href="#h78-0-1084" id="h78-0-1084" class="i">+	g_free(scriptfile);
</a><a href="#h78-0-1085" id="h78-0-1085" class="i">+	g_free(stylefile);
</a><a href="#h78-0-1086" id="h78-0-1086" class="i">+	g_free(cachedir);
</a><a href="#h78-0-1087" id="h78-0-1087" class="i">+	XCloseDisplay(dpy);
</a><a href="#h78-0-1088" id="h78-0-1088" class="i">+}
</a><a href="#h78-0-1089" id="h78-0-1089" class="i">+
</a><a href="#h78-0-1090" id="h78-0-1090" class="i">+WebKitWebView *
</a><a href="#h78-0-1091" id="h78-0-1091" class="i">+newview(Client *c, WebKitWebView *rv)
</a><a href="#h78-0-1092" id="h78-0-1092" class="i">+{
</a><a href="#h78-0-1093" id="h78-0-1093" class="i">+	WebKitWebView *v;
</a><a href="#h78-0-1094" id="h78-0-1094" class="i">+	WebKitSettings *settings;
</a><a href="#h78-0-1095" id="h78-0-1095" class="i">+	WebKitWebContext *context;
</a><a href="#h78-0-1096" id="h78-0-1096" class="i">+	WebKitCookieManager *cookiemanager;
</a><a href="#h78-0-1097" id="h78-0-1097" class="i">+	WebKitUserContentManager *contentmanager;
</a><a href="#h78-0-1098" id="h78-0-1098" class="i">+
</a><a href="#h78-0-1099" id="h78-0-1099" class="i">+	/* Webview */
</a><a href="#h78-0-1100" id="h78-0-1100" class="i">+	if (rv) {
</a><a href="#h78-0-1101" id="h78-0-1101" class="i">+		v = WEBKIT_WEB_VIEW(webkit_web_view_new_with_related_view(rv));
</a><a href="#h78-0-1102" id="h78-0-1102" class="i">+	} else {
</a><a href="#h78-0-1103" id="h78-0-1103" class="i">+		settings = webkit_settings_new_with_settings(
</a><a href="#h78-0-1104" id="h78-0-1104" class="i">+		   &quot;allow-file-access-from-file-urls&quot;, curconfig[FileURLsCrossAccess].val.i,
</a><a href="#h78-0-1105" id="h78-0-1105" class="i">+		   &quot;allow-universal-access-from-file-urls&quot;, curconfig[FileURLsCrossAccess].val.i,
</a><a href="#h78-0-1106" id="h78-0-1106" class="i">+		   &quot;auto-load-images&quot;, curconfig[LoadImages].val.i,
</a><a href="#h78-0-1107" id="h78-0-1107" class="i">+		   &quot;default-charset&quot;, curconfig[DefaultCharset].val.v,
</a><a href="#h78-0-1108" id="h78-0-1108" class="i">+		   &quot;default-font-size&quot;, curconfig[FontSize].val.i,
</a><a href="#h78-0-1109" id="h78-0-1109" class="i">+		   &quot;enable-caret-browsing&quot;, curconfig[CaretBrowsing].val.i,
</a><a href="#h78-0-1110" id="h78-0-1110" class="i">+		   &quot;enable-developer-extras&quot;, curconfig[Inspector].val.i,
</a><a href="#h78-0-1111" id="h78-0-1111" class="i">+		   &quot;enable-dns-prefetching&quot;, curconfig[DNSPrefetch].val.i,
</a><a href="#h78-0-1112" id="h78-0-1112" class="i">+		   &quot;enable-frame-flattening&quot;, curconfig[FrameFlattening].val.i,
</a><a href="#h78-0-1113" id="h78-0-1113" class="i">+		   &quot;enable-html5-database&quot;, curconfig[DiskCache].val.i,
</a><a href="#h78-0-1114" id="h78-0-1114" class="i">+		   &quot;enable-html5-local-storage&quot;, curconfig[DiskCache].val.i,
</a><a href="#h78-0-1115" id="h78-0-1115" class="i">+		   &quot;enable-java&quot;, curconfig[Java].val.i,
</a><a href="#h78-0-1116" id="h78-0-1116" class="i">+		   &quot;enable-javascript&quot;, curconfig[JavaScript].val.i,
</a><a href="#h78-0-1117" id="h78-0-1117" class="i">+		   &quot;enable-plugins&quot;, curconfig[Plugins].val.i,
</a><a href="#h78-0-1118" id="h78-0-1118" class="i">+		   &quot;enable-accelerated-2d-canvas&quot;, curconfig[AcceleratedCanvas].val.i,
</a><a href="#h78-0-1119" id="h78-0-1119" class="i">+		   &quot;enable-site-specific-quirks&quot;, curconfig[SiteQuirks].val.i,
</a><a href="#h78-0-1120" id="h78-0-1120" class="i">+		   &quot;enable-smooth-scrolling&quot;, curconfig[SmoothScrolling].val.i,
</a><a href="#h78-0-1121" id="h78-0-1121" class="i">+		   &quot;enable-webgl&quot;, curconfig[WebGL].val.i,
</a><a href="#h78-0-1122" id="h78-0-1122" class="i">+		   &quot;media-playback-requires-user-gesture&quot;, curconfig[MediaManualPlay].val.i,
</a><a href="#h78-0-1123" id="h78-0-1123" class="i">+		   NULL);
</a><a href="#h78-0-1124" id="h78-0-1124" class="i">+/* For more interesting settings, have a look at
</a><a href="#h78-0-1125" id="h78-0-1125" class="i">+ * http://webkitgtk.org/reference/webkit2gtk/stable/WebKitSettings.html */
</a><a href="#h78-0-1126" id="h78-0-1126" class="i">+
</a><a href="#h78-0-1127" id="h78-0-1127" class="i">+		if (strcmp(fulluseragent, &quot;&quot;)) {
</a><a href="#h78-0-1128" id="h78-0-1128" class="i">+			webkit_settings_set_user_agent(settings, fulluseragent);
</a><a href="#h78-0-1129" id="h78-0-1129" class="i">+		} else if (surfuseragent) {
</a><a href="#h78-0-1130" id="h78-0-1130" class="i">+			webkit_settings_set_user_agent_with_application_details(
</a><a href="#h78-0-1131" id="h78-0-1131" class="i">+			    settings, &quot;Surf&quot;, VERSION);
</a><a href="#h78-0-1132" id="h78-0-1132" class="i">+		}
</a><a href="#h78-0-1133" id="h78-0-1133" class="i">+		useragent = webkit_settings_get_user_agent(settings);
</a><a href="#h78-0-1134" id="h78-0-1134" class="i">+
</a><a href="#h78-0-1135" id="h78-0-1135" class="i">+		contentmanager = webkit_user_content_manager_new();
</a><a href="#h78-0-1136" id="h78-0-1136" class="i">+
</a><a href="#h78-0-1137" id="h78-0-1137" class="i">+		context = webkit_web_context_new_with_website_data_manager(
</a><a href="#h78-0-1138" id="h78-0-1138" class="i">+		          webkit_website_data_manager_new(
</a><a href="#h78-0-1139" id="h78-0-1139" class="i">+		          &quot;base-cache-directory&quot;, cachedir,
</a><a href="#h78-0-1140" id="h78-0-1140" class="i">+		          &quot;base-data-directory&quot;, cachedir,
</a><a href="#h78-0-1141" id="h78-0-1141" class="i">+		          NULL));
</a><a href="#h78-0-1142" id="h78-0-1142" class="i">+
</a><a href="#h78-0-1143" id="h78-0-1143" class="i">+		cookiemanager = webkit_web_context_get_cookie_manager(context);
</a><a href="#h78-0-1144" id="h78-0-1144" class="i">+
</a><a href="#h78-0-1145" id="h78-0-1145" class="i">+		/* rendering process model, can be a shared unique one
</a><a href="#h78-0-1146" id="h78-0-1146" class="i">+		 * or one for each view */
</a><a href="#h78-0-1147" id="h78-0-1147" class="i">+		webkit_web_context_set_process_model(context,
</a><a href="#h78-0-1148" id="h78-0-1148" class="i">+		    WEBKIT_PROCESS_MODEL_MULTIPLE_SECONDARY_PROCESSES);
</a><a href="#h78-0-1149" id="h78-0-1149" class="i">+		/* TLS */
</a><a href="#h78-0-1150" id="h78-0-1150" class="i">+		webkit_web_context_set_tls_errors_policy(context,
</a><a href="#h78-0-1151" id="h78-0-1151" class="i">+		    curconfig[StrictTLS].val.i ? WEBKIT_TLS_ERRORS_POLICY_FAIL :
</a><a href="#h78-0-1152" id="h78-0-1152" class="i">+		    WEBKIT_TLS_ERRORS_POLICY_IGNORE);
</a><a href="#h78-0-1153" id="h78-0-1153" class="i">+		/* disk cache */
</a><a href="#h78-0-1154" id="h78-0-1154" class="i">+		webkit_web_context_set_cache_model(context,
</a><a href="#h78-0-1155" id="h78-0-1155" class="i">+		    curconfig[DiskCache].val.i ? WEBKIT_CACHE_MODEL_WEB_BROWSER :
</a><a href="#h78-0-1156" id="h78-0-1156" class="i">+		    WEBKIT_CACHE_MODEL_DOCUMENT_VIEWER);
</a><a href="#h78-0-1157" id="h78-0-1157" class="i">+
</a><a href="#h78-0-1158" id="h78-0-1158" class="i">+		/* Currently only works with text file to be compatible with curl */
</a><a href="#h78-0-1159" id="h78-0-1159" class="i">+		webkit_cookie_manager_set_persistent_storage(cookiemanager,
</a><a href="#h78-0-1160" id="h78-0-1160" class="i">+		    cookiefile, WEBKIT_COOKIE_PERSISTENT_STORAGE_TEXT);
</a><a href="#h78-0-1161" id="h78-0-1161" class="i">+		/* cookie policy */
</a><a href="#h78-0-1162" id="h78-0-1162" class="i">+		webkit_cookie_manager_set_accept_policy(cookiemanager,
</a><a href="#h78-0-1163" id="h78-0-1163" class="i">+		    cookiepolicy_get());
</a><a href="#h78-0-1164" id="h78-0-1164" class="i">+		/* languages */
</a><a href="#h78-0-1165" id="h78-0-1165" class="i">+		webkit_web_context_set_preferred_languages(context,
</a><a href="#h78-0-1166" id="h78-0-1166" class="i">+		    curconfig[PreferredLanguages].val.v);
</a><a href="#h78-0-1167" id="h78-0-1167" class="i">+		webkit_web_context_set_spell_checking_languages(context,
</a><a href="#h78-0-1168" id="h78-0-1168" class="i">+		    curconfig[SpellLanguages].val.v);
</a><a href="#h78-0-1169" id="h78-0-1169" class="i">+		webkit_web_context_set_spell_checking_enabled(context,
</a><a href="#h78-0-1170" id="h78-0-1170" class="i">+		    curconfig[SpellChecking].val.i);
</a><a href="#h78-0-1171" id="h78-0-1171" class="i">+
</a><a href="#h78-0-1172" id="h78-0-1172" class="i">+		g_signal_connect(G_OBJECT(context), &quot;download-started&quot;,
</a><a href="#h78-0-1173" id="h78-0-1173" class="i">+		                 G_CALLBACK(downloadstarted), c);
</a><a href="#h78-0-1174" id="h78-0-1174" class="i">+		g_signal_connect(G_OBJECT(context), &quot;initialize-web-extensions&quot;,
</a><a href="#h78-0-1175" id="h78-0-1175" class="i">+		                 G_CALLBACK(initwebextensions), c);
</a><a href="#h78-0-1176" id="h78-0-1176" class="i">+
</a><a href="#h78-0-1177" id="h78-0-1177" class="i">+		v = g_object_new(WEBKIT_TYPE_WEB_VIEW,
</a><a href="#h78-0-1178" id="h78-0-1178" class="i">+		    &quot;settings&quot;, settings,
</a><a href="#h78-0-1179" id="h78-0-1179" class="i">+		    &quot;user-content-manager&quot;, contentmanager,
</a><a href="#h78-0-1180" id="h78-0-1180" class="i">+		    &quot;web-context&quot;, context,
</a><a href="#h78-0-1181" id="h78-0-1181" class="i">+		    NULL);
</a><a href="#h78-0-1182" id="h78-0-1182" class="i">+	}
</a><a href="#h78-0-1183" id="h78-0-1183" class="i">+
</a><a href="#h78-0-1184" id="h78-0-1184" class="i">+	g_signal_connect(G_OBJECT(v), &quot;notify::estimated-load-progress&quot;,
</a><a href="#h78-0-1185" id="h78-0-1185" class="i">+			 G_CALLBACK(progresschanged), c);
</a><a href="#h78-0-1186" id="h78-0-1186" class="i">+	g_signal_connect(G_OBJECT(v), &quot;notify::title&quot;,
</a><a href="#h78-0-1187" id="h78-0-1187" class="i">+			 G_CALLBACK(titlechanged), c);
</a><a href="#h78-0-1188" id="h78-0-1188" class="i">+	g_signal_connect(G_OBJECT(v), &quot;button-release-event&quot;,
</a><a href="#h78-0-1189" id="h78-0-1189" class="i">+			 G_CALLBACK(buttonreleased), c);
</a><a href="#h78-0-1190" id="h78-0-1190" class="i">+	g_signal_connect(G_OBJECT(v), &quot;close&quot;,
</a><a href="#h78-0-1191" id="h78-0-1191" class="i">+			G_CALLBACK(closeview), c);
</a><a href="#h78-0-1192" id="h78-0-1192" class="i">+	g_signal_connect(G_OBJECT(v), &quot;create&quot;,
</a><a href="#h78-0-1193" id="h78-0-1193" class="i">+			 G_CALLBACK(createview), c);
</a><a href="#h78-0-1194" id="h78-0-1194" class="i">+	g_signal_connect(G_OBJECT(v), &quot;decide-policy&quot;,
</a><a href="#h78-0-1195" id="h78-0-1195" class="i">+			 G_CALLBACK(decidepolicy), c);
</a><a href="#h78-0-1196" id="h78-0-1196" class="i">+	g_signal_connect(G_OBJECT(v), &quot;insecure-content-detected&quot;,
</a><a href="#h78-0-1197" id="h78-0-1197" class="i">+			 G_CALLBACK(insecurecontent), c);
</a><a href="#h78-0-1198" id="h78-0-1198" class="i">+	g_signal_connect(G_OBJECT(v), &quot;load-failed-with-tls-errors&quot;,
</a><a href="#h78-0-1199" id="h78-0-1199" class="i">+			 G_CALLBACK(loadfailedtls), c);
</a><a href="#h78-0-1200" id="h78-0-1200" class="i">+	g_signal_connect(G_OBJECT(v), &quot;load-changed&quot;,
</a><a href="#h78-0-1201" id="h78-0-1201" class="i">+			 G_CALLBACK(loadchanged), c);
</a><a href="#h78-0-1202" id="h78-0-1202" class="i">+	g_signal_connect(G_OBJECT(v), &quot;mouse-target-changed&quot;,
</a><a href="#h78-0-1203" id="h78-0-1203" class="i">+			 G_CALLBACK(mousetargetchanged), c);
</a><a href="#h78-0-1204" id="h78-0-1204" class="i">+	g_signal_connect(G_OBJECT(v), &quot;permission-request&quot;,
</a><a href="#h78-0-1205" id="h78-0-1205" class="i">+			 G_CALLBACK(permissionrequested), c);
</a><a href="#h78-0-1206" id="h78-0-1206" class="i">+	g_signal_connect(G_OBJECT(v), &quot;ready-to-show&quot;,
</a><a href="#h78-0-1207" id="h78-0-1207" class="i">+			 G_CALLBACK(showview), c);
</a><a href="#h78-0-1208" id="h78-0-1208" class="i">+	g_signal_connect(G_OBJECT(v), &quot;web-process-terminated&quot;,
</a><a href="#h78-0-1209" id="h78-0-1209" class="i">+			 G_CALLBACK(webprocessterminated), c);
</a><a href="#h78-0-1210" id="h78-0-1210" class="i">+
</a><a href="#h78-0-1211" id="h78-0-1211" class="i">+	return v;
</a><a href="#h78-0-1212" id="h78-0-1212" class="i">+}
</a><a href="#h78-0-1213" id="h78-0-1213" class="i">+
</a><a href="#h78-0-1214" id="h78-0-1214" class="i">+static gboolean
</a><a href="#h78-0-1215" id="h78-0-1215" class="i">+readpipe(GIOChannel *s, GIOCondition ioc, gpointer unused)
</a><a href="#h78-0-1216" id="h78-0-1216" class="i">+{
</a><a href="#h78-0-1217" id="h78-0-1217" class="i">+	static char msg[MSGBUFSZ], msgsz;
</a><a href="#h78-0-1218" id="h78-0-1218" class="i">+	GError *gerr = NULL;
</a><a href="#h78-0-1219" id="h78-0-1219" class="i">+
</a><a href="#h78-0-1220" id="h78-0-1220" class="i">+	if (g_io_channel_read_chars(s, msg, sizeof(msg), NULL, &amp;gerr) !=
</a><a href="#h78-0-1221" id="h78-0-1221" class="i">+	    G_IO_STATUS_NORMAL) {
</a><a href="#h78-0-1222" id="h78-0-1222" class="i">+		fprintf(stderr, &quot;surf: error reading pipe: %s\n&quot;,
</a><a href="#h78-0-1223" id="h78-0-1223" class="i">+		        gerr-&gt;message);
</a><a href="#h78-0-1224" id="h78-0-1224" class="i">+		g_error_free(gerr);
</a><a href="#h78-0-1225" id="h78-0-1225" class="i">+		return TRUE;
</a><a href="#h78-0-1226" id="h78-0-1226" class="i">+	}
</a><a href="#h78-0-1227" id="h78-0-1227" class="i">+	if ((msgsz = msg[0]) &lt; 3) {
</a><a href="#h78-0-1228" id="h78-0-1228" class="i">+		fprintf(stderr, &quot;surf: message too short: %d\n&quot;, msgsz);
</a><a href="#h78-0-1229" id="h78-0-1229" class="i">+		return TRUE;
</a><a href="#h78-0-1230" id="h78-0-1230" class="i">+	}
</a><a href="#h78-0-1231" id="h78-0-1231" class="i">+
</a><a href="#h78-0-1232" id="h78-0-1232" class="i">+	switch (msg[2]) {
</a><a href="#h78-0-1233" id="h78-0-1233" class="i">+	case &#39;i&#39;:
</a><a href="#h78-0-1234" id="h78-0-1234" class="i">+		close(pipein[1]);
</a><a href="#h78-0-1235" id="h78-0-1235" class="i">+		close(pipeout[0]);
</a><a href="#h78-0-1236" id="h78-0-1236" class="i">+		break;
</a><a href="#h78-0-1237" id="h78-0-1237" class="i">+	}
</a><a href="#h78-0-1238" id="h78-0-1238" class="i">+
</a><a href="#h78-0-1239" id="h78-0-1239" class="i">+	return TRUE;
</a><a href="#h78-0-1240" id="h78-0-1240" class="i">+}
</a><a href="#h78-0-1241" id="h78-0-1241" class="i">+
</a><a href="#h78-0-1242" id="h78-0-1242" class="i">+void
</a><a href="#h78-0-1243" id="h78-0-1243" class="i">+initwebextensions(WebKitWebContext *wc, Client *c)
</a><a href="#h78-0-1244" id="h78-0-1244" class="i">+{
</a><a href="#h78-0-1245" id="h78-0-1245" class="i">+	GVariant *gv;
</a><a href="#h78-0-1246" id="h78-0-1246" class="i">+
</a><a href="#h78-0-1247" id="h78-0-1247" class="i">+	if (!pipeout[0] || !pipein[1])
</a><a href="#h78-0-1248" id="h78-0-1248" class="i">+		return;
</a><a href="#h78-0-1249" id="h78-0-1249" class="i">+
</a><a href="#h78-0-1250" id="h78-0-1250" class="i">+	gv = g_variant_new(&quot;(ii)&quot;, pipeout[0], pipein[1]);
</a><a href="#h78-0-1251" id="h78-0-1251" class="i">+
</a><a href="#h78-0-1252" id="h78-0-1252" class="i">+	webkit_web_context_set_web_extensions_initialization_user_data(wc, gv);
</a><a href="#h78-0-1253" id="h78-0-1253" class="i">+	webkit_web_context_set_web_extensions_directory(wc, WEBEXTDIR);
</a><a href="#h78-0-1254" id="h78-0-1254" class="i">+}
</a><a href="#h78-0-1255" id="h78-0-1255" class="i">+
</a><a href="#h78-0-1256" id="h78-0-1256" class="i">+GtkWidget *
</a><a href="#h78-0-1257" id="h78-0-1257" class="i">+createview(WebKitWebView *v, WebKitNavigationAction *a, Client *c)
</a><a href="#h78-0-1258" id="h78-0-1258" class="i">+{
</a><a href="#h78-0-1259" id="h78-0-1259" class="i">+	Client *n;
</a><a href="#h78-0-1260" id="h78-0-1260" class="i">+
</a><a href="#h78-0-1261" id="h78-0-1261" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h78-0-1262" id="h78-0-1262" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h78-0-1263" id="h78-0-1263" class="i">+		/*
</a><a href="#h78-0-1264" id="h78-0-1264" class="i">+		 * popup windows of type “other” are almost always triggered
</a><a href="#h78-0-1265" id="h78-0-1265" class="i">+		 * by user gesture, so inverse the logic here
</a><a href="#h78-0-1266" id="h78-0-1266" class="i">+		 */
</a><a href="#h78-0-1267" id="h78-0-1267" class="i">+/* instead of this, compare destination uri to mouse-over uri for validating window */
</a><a href="#h78-0-1268" id="h78-0-1268" class="i">+		if (webkit_navigation_action_is_user_gesture(a))
</a><a href="#h78-0-1269" id="h78-0-1269" class="i">+			return NULL;
</a><a href="#h78-0-1270" id="h78-0-1270" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h78-0-1271" id="h78-0-1271" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h78-0-1272" id="h78-0-1272" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h78-0-1273" id="h78-0-1273" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h78-0-1274" id="h78-0-1274" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h78-0-1275" id="h78-0-1275" class="i">+		n = newclient(c);
</a><a href="#h78-0-1276" id="h78-0-1276" class="i">+		break;
</a><a href="#h78-0-1277" id="h78-0-1277" class="i">+	default:
</a><a href="#h78-0-1278" id="h78-0-1278" class="i">+		return NULL;
</a><a href="#h78-0-1279" id="h78-0-1279" class="i">+	}
</a><a href="#h78-0-1280" id="h78-0-1280" class="i">+
</a><a href="#h78-0-1281" id="h78-0-1281" class="i">+	return GTK_WIDGET(n-&gt;view);
</a><a href="#h78-0-1282" id="h78-0-1282" class="i">+}
</a><a href="#h78-0-1283" id="h78-0-1283" class="i">+
</a><a href="#h78-0-1284" id="h78-0-1284" class="i">+gboolean
</a><a href="#h78-0-1285" id="h78-0-1285" class="i">+buttonreleased(GtkWidget *w, GdkEvent *e, Client *c)
</a><a href="#h78-0-1286" id="h78-0-1286" class="i">+{
</a><a href="#h78-0-1287" id="h78-0-1287" class="i">+	WebKitHitTestResultContext element;
</a><a href="#h78-0-1288" id="h78-0-1288" class="i">+	int i;
</a><a href="#h78-0-1289" id="h78-0-1289" class="i">+
</a><a href="#h78-0-1290" id="h78-0-1290" class="i">+	element = webkit_hit_test_result_get_context(c-&gt;mousepos);
</a><a href="#h78-0-1291" id="h78-0-1291" class="i">+
</a><a href="#h78-0-1292" id="h78-0-1292" class="i">+	for (i = 0; i &lt; LENGTH(buttons); ++i) {
</a><a href="#h78-0-1293" id="h78-0-1293" class="i">+		if (element &amp; buttons[i].target &amp;&amp;
</a><a href="#h78-0-1294" id="h78-0-1294" class="i">+		    e-&gt;button.button == buttons[i].button &amp;&amp;
</a><a href="#h78-0-1295" id="h78-0-1295" class="i">+		    CLEANMASK(e-&gt;button.state) == CLEANMASK(buttons[i].mask) &amp;&amp;
</a><a href="#h78-0-1296" id="h78-0-1296" class="i">+		    buttons[i].func) {
</a><a href="#h78-0-1297" id="h78-0-1297" class="i">+			buttons[i].func(c, &amp;buttons[i].arg, c-&gt;mousepos);
</a><a href="#h78-0-1298" id="h78-0-1298" class="i">+			return buttons[i].stopevent;
</a><a href="#h78-0-1299" id="h78-0-1299" class="i">+		}
</a><a href="#h78-0-1300" id="h78-0-1300" class="i">+	}
</a><a href="#h78-0-1301" id="h78-0-1301" class="i">+
</a><a href="#h78-0-1302" id="h78-0-1302" class="i">+	return FALSE;
</a><a href="#h78-0-1303" id="h78-0-1303" class="i">+}
</a><a href="#h78-0-1304" id="h78-0-1304" class="i">+
</a><a href="#h78-0-1305" id="h78-0-1305" class="i">+GdkFilterReturn
</a><a href="#h78-0-1306" id="h78-0-1306" class="i">+processx(GdkXEvent *e, GdkEvent *event, gpointer d)
</a><a href="#h78-0-1307" id="h78-0-1307" class="i">+{
</a><a href="#h78-0-1308" id="h78-0-1308" class="i">+	Client *c = (Client *)d;
</a><a href="#h78-0-1309" id="h78-0-1309" class="i">+	XPropertyEvent *ev;
</a><a href="#h78-0-1310" id="h78-0-1310" class="i">+	Arg a;
</a><a href="#h78-0-1311" id="h78-0-1311" class="i">+
</a><a href="#h78-0-1312" id="h78-0-1312" class="i">+	if (((XEvent *)e)-&gt;type == PropertyNotify) {
</a><a href="#h78-0-1313" id="h78-0-1313" class="i">+		ev = &amp;((XEvent *)e)-&gt;xproperty;
</a><a href="#h78-0-1314" id="h78-0-1314" class="i">+		if (ev-&gt;state == PropertyNewValue) {
</a><a href="#h78-0-1315" id="h78-0-1315" class="i">+			if (ev-&gt;atom == atoms[AtomFind]) {
</a><a href="#h78-0-1316" id="h78-0-1316" class="i">+				find(c, NULL);
</a><a href="#h78-0-1317" id="h78-0-1317" class="i">+
</a><a href="#h78-0-1318" id="h78-0-1318" class="i">+				return GDK_FILTER_REMOVE;
</a><a href="#h78-0-1319" id="h78-0-1319" class="i">+			} else if (ev-&gt;atom == atoms[AtomGo]) {
</a><a href="#h78-0-1320" id="h78-0-1320" class="i">+				a.v = getatom(c, AtomGo);
</a><a href="#h78-0-1321" id="h78-0-1321" class="i">+				loaduri(c, &amp;a);
</a><a href="#h78-0-1322" id="h78-0-1322" class="i">+
</a><a href="#h78-0-1323" id="h78-0-1323" class="i">+				return GDK_FILTER_REMOVE;
</a><a href="#h78-0-1324" id="h78-0-1324" class="i">+			}
</a><a href="#h78-0-1325" id="h78-0-1325" class="i">+		}
</a><a href="#h78-0-1326" id="h78-0-1326" class="i">+	}
</a><a href="#h78-0-1327" id="h78-0-1327" class="i">+	return GDK_FILTER_CONTINUE;
</a><a href="#h78-0-1328" id="h78-0-1328" class="i">+}
</a><a href="#h78-0-1329" id="h78-0-1329" class="i">+
</a><a href="#h78-0-1330" id="h78-0-1330" class="i">+gboolean
</a><a href="#h78-0-1331" id="h78-0-1331" class="i">+winevent(GtkWidget *w, GdkEvent *e, Client *c)
</a><a href="#h78-0-1332" id="h78-0-1332" class="i">+{
</a><a href="#h78-0-1333" id="h78-0-1333" class="i">+	int i;
</a><a href="#h78-0-1334" id="h78-0-1334" class="i">+
</a><a href="#h78-0-1335" id="h78-0-1335" class="i">+	switch (e-&gt;type) {
</a><a href="#h78-0-1336" id="h78-0-1336" class="i">+	case GDK_ENTER_NOTIFY:
</a><a href="#h78-0-1337" id="h78-0-1337" class="i">+		c-&gt;overtitle = c-&gt;targeturi;
</a><a href="#h78-0-1338" id="h78-0-1338" class="i">+		updatetitle(c);
</a><a href="#h78-0-1339" id="h78-0-1339" class="i">+		break;
</a><a href="#h78-0-1340" id="h78-0-1340" class="i">+	case GDK_KEY_PRESS:
</a><a href="#h78-0-1341" id="h78-0-1341" class="i">+		if (!curconfig[KioskMode].val.i) {
</a><a href="#h78-0-1342" id="h78-0-1342" class="i">+			for (i = 0; i &lt; LENGTH(keys); ++i) {
</a><a href="#h78-0-1343" id="h78-0-1343" class="i">+				if (gdk_keyval_to_lower(e-&gt;key.keyval) ==
</a><a href="#h78-0-1344" id="h78-0-1344" class="i">+				    keys[i].keyval &amp;&amp;
</a><a href="#h78-0-1345" id="h78-0-1345" class="i">+				    CLEANMASK(e-&gt;key.state) == keys[i].mod &amp;&amp;
</a><a href="#h78-0-1346" id="h78-0-1346" class="i">+				    keys[i].func) {
</a><a href="#h78-0-1347" id="h78-0-1347" class="i">+					updatewinid(c);
</a><a href="#h78-0-1348" id="h78-0-1348" class="i">+					keys[i].func(c, &amp;(keys[i].arg));
</a><a href="#h78-0-1349" id="h78-0-1349" class="i">+					return TRUE;
</a><a href="#h78-0-1350" id="h78-0-1350" class="i">+				}
</a><a href="#h78-0-1351" id="h78-0-1351" class="i">+			}
</a><a href="#h78-0-1352" id="h78-0-1352" class="i">+		}
</a><a href="#h78-0-1353" id="h78-0-1353" class="i">+	case GDK_LEAVE_NOTIFY:
</a><a href="#h78-0-1354" id="h78-0-1354" class="i">+		c-&gt;overtitle = NULL;
</a><a href="#h78-0-1355" id="h78-0-1355" class="i">+		updatetitle(c);
</a><a href="#h78-0-1356" id="h78-0-1356" class="i">+		break;
</a><a href="#h78-0-1357" id="h78-0-1357" class="i">+	case GDK_WINDOW_STATE:
</a><a href="#h78-0-1358" id="h78-0-1358" class="i">+		if (e-&gt;window_state.changed_mask ==
</a><a href="#h78-0-1359" id="h78-0-1359" class="i">+		    GDK_WINDOW_STATE_FULLSCREEN)
</a><a href="#h78-0-1360" id="h78-0-1360" class="i">+			c-&gt;fullscreen = e-&gt;window_state.new_window_state &amp;
</a><a href="#h78-0-1361" id="h78-0-1361" class="i">+			                GDK_WINDOW_STATE_FULLSCREEN;
</a><a href="#h78-0-1362" id="h78-0-1362" class="i">+		break;
</a><a href="#h78-0-1363" id="h78-0-1363" class="i">+	default:
</a><a href="#h78-0-1364" id="h78-0-1364" class="i">+		break;
</a><a href="#h78-0-1365" id="h78-0-1365" class="i">+	}
</a><a href="#h78-0-1366" id="h78-0-1366" class="i">+
</a><a href="#h78-0-1367" id="h78-0-1367" class="i">+	return FALSE;
</a><a href="#h78-0-1368" id="h78-0-1368" class="i">+}
</a><a href="#h78-0-1369" id="h78-0-1369" class="i">+
</a><a href="#h78-0-1370" id="h78-0-1370" class="i">+void
</a><a href="#h78-0-1371" id="h78-0-1371" class="i">+showview(WebKitWebView *v, Client *c)
</a><a href="#h78-0-1372" id="h78-0-1372" class="i">+{
</a><a href="#h78-0-1373" id="h78-0-1373" class="i">+	GdkRGBA bgcolor = { 0 };
</a><a href="#h78-0-1374" id="h78-0-1374" class="i">+	GdkWindow *gwin;
</a><a href="#h78-0-1375" id="h78-0-1375" class="i">+
</a><a href="#h78-0-1376" id="h78-0-1376" class="i">+	c-&gt;finder = webkit_web_view_get_find_controller(c-&gt;view);
</a><a href="#h78-0-1377" id="h78-0-1377" class="i">+	c-&gt;inspector = webkit_web_view_get_inspector(c-&gt;view);
</a><a href="#h78-0-1378" id="h78-0-1378" class="i">+
</a><a href="#h78-0-1379" id="h78-0-1379" class="i">+	c-&gt;pageid = webkit_web_view_get_page_id(c-&gt;view);
</a><a href="#h78-0-1380" id="h78-0-1380" class="i">+	c-&gt;win = createwindow(c);
</a><a href="#h78-0-1381" id="h78-0-1381" class="i">+
</a><a href="#h78-0-1382" id="h78-0-1382" class="i">+	gtk_container_add(GTK_CONTAINER(c-&gt;win), GTK_WIDGET(c-&gt;view));
</a><a href="#h78-0-1383" id="h78-0-1383" class="i">+	gtk_widget_show_all(c-&gt;win);
</a><a href="#h78-0-1384" id="h78-0-1384" class="i">+	gtk_widget_grab_focus(GTK_WIDGET(c-&gt;view));
</a><a href="#h78-0-1385" id="h78-0-1385" class="i">+
</a><a href="#h78-0-1386" id="h78-0-1386" class="i">+	gwin = gtk_widget_get_window(GTK_WIDGET(c-&gt;win));
</a><a href="#h78-0-1387" id="h78-0-1387" class="i">+	c-&gt;xid = gdk_x11_window_get_xid(gwin);
</a><a href="#h78-0-1388" id="h78-0-1388" class="i">+	updatewinid(c);
</a><a href="#h78-0-1389" id="h78-0-1389" class="i">+	if (showxid) {
</a><a href="#h78-0-1390" id="h78-0-1390" class="i">+		gdk_display_sync(gtk_widget_get_display(c-&gt;win));
</a><a href="#h78-0-1391" id="h78-0-1391" class="i">+		puts(winid);
</a><a href="#h78-0-1392" id="h78-0-1392" class="i">+		fflush(stdout);
</a><a href="#h78-0-1393" id="h78-0-1393" class="i">+	}
</a><a href="#h78-0-1394" id="h78-0-1394" class="i">+
</a><a href="#h78-0-1395" id="h78-0-1395" class="i">+	if (curconfig[HideBackground].val.i)
</a><a href="#h78-0-1396" id="h78-0-1396" class="i">+		webkit_web_view_set_background_color(c-&gt;view, &amp;bgcolor);
</a><a href="#h78-0-1397" id="h78-0-1397" class="i">+
</a><a href="#h78-0-1398" id="h78-0-1398" class="i">+	if (!curconfig[KioskMode].val.i) {
</a><a href="#h78-0-1399" id="h78-0-1399" class="i">+		gdk_window_set_events(gwin, GDK_ALL_EVENTS_MASK);
</a><a href="#h78-0-1400" id="h78-0-1400" class="i">+		gdk_window_add_filter(gwin, processx, c);
</a><a href="#h78-0-1401" id="h78-0-1401" class="i">+	}
</a><a href="#h78-0-1402" id="h78-0-1402" class="i">+
</a><a href="#h78-0-1403" id="h78-0-1403" class="i">+	if (curconfig[RunInFullscreen].val.i)
</a><a href="#h78-0-1404" id="h78-0-1404" class="i">+		togglefullscreen(c, NULL);
</a><a href="#h78-0-1405" id="h78-0-1405" class="i">+
</a><a href="#h78-0-1406" id="h78-0-1406" class="i">+	if (curconfig[ZoomLevel].val.f != 1.0)
</a><a href="#h78-0-1407" id="h78-0-1407" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view,
</a><a href="#h78-0-1408" id="h78-0-1408" class="i">+		                               curconfig[ZoomLevel].val.f);
</a><a href="#h78-0-1409" id="h78-0-1409" class="i">+
</a><a href="#h78-0-1410" id="h78-0-1410" class="i">+	setatom(c, AtomFind, &quot;&quot;);
</a><a href="#h78-0-1411" id="h78-0-1411" class="i">+	setatom(c, AtomUri, &quot;about:blank&quot;);
</a><a href="#h78-0-1412" id="h78-0-1412" class="i">+}
</a><a href="#h78-0-1413" id="h78-0-1413" class="i">+
</a><a href="#h78-0-1414" id="h78-0-1414" class="i">+GtkWidget *
</a><a href="#h78-0-1415" id="h78-0-1415" class="i">+createwindow(Client *c)
</a><a href="#h78-0-1416" id="h78-0-1416" class="i">+{
</a><a href="#h78-0-1417" id="h78-0-1417" class="i">+	char *wmstr;
</a><a href="#h78-0-1418" id="h78-0-1418" class="i">+	GtkWidget *w;
</a><a href="#h78-0-1419" id="h78-0-1419" class="i">+
</a><a href="#h78-0-1420" id="h78-0-1420" class="i">+	if (embed) {
</a><a href="#h78-0-1421" id="h78-0-1421" class="i">+		w = gtk_plug_new(embed);
</a><a href="#h78-0-1422" id="h78-0-1422" class="i">+	} else {
</a><a href="#h78-0-1423" id="h78-0-1423" class="i">+		w = gtk_window_new(GTK_WINDOW_TOPLEVEL);
</a><a href="#h78-0-1424" id="h78-0-1424" class="i">+
</a><a href="#h78-0-1425" id="h78-0-1425" class="i">+		wmstr = g_path_get_basename(argv0);
</a><a href="#h78-0-1426" id="h78-0-1426" class="i">+		gtk_window_set_wmclass(GTK_WINDOW(w), wmstr, &quot;Surf&quot;);
</a><a href="#h78-0-1427" id="h78-0-1427" class="i">+		g_free(wmstr);
</a><a href="#h78-0-1428" id="h78-0-1428" class="i">+
</a><a href="#h78-0-1429" id="h78-0-1429" class="i">+		wmstr = g_strdup_printf(&quot;%s[%lu]&quot;, &quot;Surf&quot;, c-&gt;pageid);
</a><a href="#h78-0-1430" id="h78-0-1430" class="i">+		gtk_window_set_role(GTK_WINDOW(w), wmstr);
</a><a href="#h78-0-1431" id="h78-0-1431" class="i">+		g_free(wmstr);
</a><a href="#h78-0-1432" id="h78-0-1432" class="i">+
</a><a href="#h78-0-1433" id="h78-0-1433" class="i">+		gtk_window_set_default_size(GTK_WINDOW(w), winsize[0], winsize[1]);
</a><a href="#h78-0-1434" id="h78-0-1434" class="i">+	}
</a><a href="#h78-0-1435" id="h78-0-1435" class="i">+
</a><a href="#h78-0-1436" id="h78-0-1436" class="i">+	g_signal_connect(G_OBJECT(w), &quot;destroy&quot;,
</a><a href="#h78-0-1437" id="h78-0-1437" class="i">+	                 G_CALLBACK(destroywin), c);
</a><a href="#h78-0-1438" id="h78-0-1438" class="i">+	g_signal_connect(G_OBJECT(w), &quot;enter-notify-event&quot;,
</a><a href="#h78-0-1439" id="h78-0-1439" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h78-0-1440" id="h78-0-1440" class="i">+	g_signal_connect(G_OBJECT(w), &quot;key-press-event&quot;,
</a><a href="#h78-0-1441" id="h78-0-1441" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h78-0-1442" id="h78-0-1442" class="i">+	g_signal_connect(G_OBJECT(w), &quot;leave-notify-event&quot;,
</a><a href="#h78-0-1443" id="h78-0-1443" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h78-0-1444" id="h78-0-1444" class="i">+	g_signal_connect(G_OBJECT(w), &quot;window-state-event&quot;,
</a><a href="#h78-0-1445" id="h78-0-1445" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h78-0-1446" id="h78-0-1446" class="i">+
</a><a href="#h78-0-1447" id="h78-0-1447" class="i">+	return w;
</a><a href="#h78-0-1448" id="h78-0-1448" class="i">+}
</a><a href="#h78-0-1449" id="h78-0-1449" class="i">+
</a><a href="#h78-0-1450" id="h78-0-1450" class="i">+gboolean
</a><a href="#h78-0-1451" id="h78-0-1451" class="i">+loadfailedtls(WebKitWebView *v, gchar *uri, GTlsCertificate *cert,
</a><a href="#h78-0-1452" id="h78-0-1452" class="i">+              GTlsCertificateFlags err, Client *c)
</a><a href="#h78-0-1453" id="h78-0-1453" class="i">+{
</a><a href="#h78-0-1454" id="h78-0-1454" class="i">+	GString *errmsg = g_string_new(NULL);
</a><a href="#h78-0-1455" id="h78-0-1455" class="i">+	gchar *html, *pem;
</a><a href="#h78-0-1456" id="h78-0-1456" class="i">+
</a><a href="#h78-0-1457" id="h78-0-1457" class="i">+	c-&gt;failedcert = g_object_ref(cert);
</a><a href="#h78-0-1458" id="h78-0-1458" class="i">+	c-&gt;tlserr = err;
</a><a href="#h78-0-1459" id="h78-0-1459" class="i">+	c-&gt;errorpage = 1;
</a><a href="#h78-0-1460" id="h78-0-1460" class="i">+
</a><a href="#h78-0-1461" id="h78-0-1461" class="i">+	if (err &amp; G_TLS_CERTIFICATE_UNKNOWN_CA)
</a><a href="#h78-0-1462" id="h78-0-1462" class="i">+		g_string_append(errmsg,
</a><a href="#h78-0-1463" id="h78-0-1463" class="i">+		    &quot;The signing certificate authority is not known.&lt;br&gt;&quot;);
</a><a href="#h78-0-1464" id="h78-0-1464" class="i">+	if (err &amp; G_TLS_CERTIFICATE_BAD_IDENTITY)
</a><a href="#h78-0-1465" id="h78-0-1465" class="i">+		g_string_append(errmsg,
</a><a href="#h78-0-1466" id="h78-0-1466" class="i">+		    &quot;The certificate does not match the expected identity &quot;
</a><a href="#h78-0-1467" id="h78-0-1467" class="i">+		    &quot;of the site that it was retrieved from.&lt;br&gt;&quot;);
</a><a href="#h78-0-1468" id="h78-0-1468" class="i">+	if (err &amp; G_TLS_CERTIFICATE_NOT_ACTIVATED)
</a><a href="#h78-0-1469" id="h78-0-1469" class="i">+		g_string_append(errmsg,
</a><a href="#h78-0-1470" id="h78-0-1470" class="i">+		    &quot;The certificate&#39;s activation time &quot;
</a><a href="#h78-0-1471" id="h78-0-1471" class="i">+		    &quot;is still in the future.&lt;br&gt;&quot;);
</a><a href="#h78-0-1472" id="h78-0-1472" class="i">+	if (err &amp; G_TLS_CERTIFICATE_EXPIRED)
</a><a href="#h78-0-1473" id="h78-0-1473" class="i">+		g_string_append(errmsg, &quot;The certificate has expired.&lt;br&gt;&quot;);
</a><a href="#h78-0-1474" id="h78-0-1474" class="i">+	if (err &amp; G_TLS_CERTIFICATE_REVOKED)
</a><a href="#h78-0-1475" id="h78-0-1475" class="i">+		g_string_append(errmsg,
</a><a href="#h78-0-1476" id="h78-0-1476" class="i">+		    &quot;The certificate has been revoked according to &quot;
</a><a href="#h78-0-1477" id="h78-0-1477" class="i">+		    &quot;the GTlsConnection&#39;s certificate revocation list.&lt;br&gt;&quot;);
</a><a href="#h78-0-1478" id="h78-0-1478" class="i">+	if (err &amp; G_TLS_CERTIFICATE_INSECURE)
</a><a href="#h78-0-1479" id="h78-0-1479" class="i">+		g_string_append(errmsg,
</a><a href="#h78-0-1480" id="h78-0-1480" class="i">+		    &quot;The certificate&#39;s algorithm is considered insecure.&lt;br&gt;&quot;);
</a><a href="#h78-0-1481" id="h78-0-1481" class="i">+	if (err &amp; G_TLS_CERTIFICATE_GENERIC_ERROR)
</a><a href="#h78-0-1482" id="h78-0-1482" class="i">+		g_string_append(errmsg,
</a><a href="#h78-0-1483" id="h78-0-1483" class="i">+		    &quot;Some error occurred validating the certificate.&lt;br&gt;&quot;);
</a><a href="#h78-0-1484" id="h78-0-1484" class="i">+
</a><a href="#h78-0-1485" id="h78-0-1485" class="i">+	g_object_get(cert, &quot;certificate-pem&quot;, &amp;pem, NULL);
</a><a href="#h78-0-1486" id="h78-0-1486" class="i">+	html = g_strdup_printf(&quot;&lt;p&gt;Could not validate TLS for “%s”&lt;br&gt;%s&lt;/p&gt;&quot;
</a><a href="#h78-0-1487" id="h78-0-1487" class="i">+	                       &quot;&lt;p&gt;You can inspect the following certificate &quot;
</a><a href="#h78-0-1488" id="h78-0-1488" class="i">+	                       &quot;with Ctrl-t (default keybinding).&lt;/p&gt;&quot;
</a><a href="#h78-0-1489" id="h78-0-1489" class="i">+	                       &quot;&lt;p&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/p&gt;&quot;, uri, errmsg-&gt;str, pem);
</a><a href="#h78-0-1490" id="h78-0-1490" class="i">+	g_free(pem);
</a><a href="#h78-0-1491" id="h78-0-1491" class="i">+	g_string_free(errmsg, TRUE);
</a><a href="#h78-0-1492" id="h78-0-1492" class="i">+
</a><a href="#h78-0-1493" id="h78-0-1493" class="i">+	webkit_web_view_load_alternate_html(c-&gt;view, html, uri, NULL);
</a><a href="#h78-0-1494" id="h78-0-1494" class="i">+	g_free(html);
</a><a href="#h78-0-1495" id="h78-0-1495" class="i">+
</a><a href="#h78-0-1496" id="h78-0-1496" class="i">+	return TRUE;
</a><a href="#h78-0-1497" id="h78-0-1497" class="i">+}
</a><a href="#h78-0-1498" id="h78-0-1498" class="i">+
</a><a href="#h78-0-1499" id="h78-0-1499" class="i">+void
</a><a href="#h78-0-1500" id="h78-0-1500" class="i">+loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c)
</a><a href="#h78-0-1501" id="h78-0-1501" class="i">+{
</a><a href="#h78-0-1502" id="h78-0-1502" class="i">+	const char *uri = geturi(c);
</a><a href="#h78-0-1503" id="h78-0-1503" class="i">+
</a><a href="#h78-0-1504" id="h78-0-1504" class="i">+	switch (e) {
</a><a href="#h78-0-1505" id="h78-0-1505" class="i">+	case WEBKIT_LOAD_STARTED:
</a><a href="#h78-0-1506" id="h78-0-1506" class="i">+		setatom(c, AtomUri, uri);
</a><a href="#h78-0-1507" id="h78-0-1507" class="i">+		c-&gt;title = uri;
</a><a href="#h78-0-1508" id="h78-0-1508" class="i">+		c-&gt;https = c-&gt;insecure = 0;
</a><a href="#h78-0-1509" id="h78-0-1509" class="i">+		seturiparameters(c, uri, loadtransient);
</a><a href="#h78-0-1510" id="h78-0-1510" class="i">+		if (c-&gt;errorpage)
</a><a href="#h78-0-1511" id="h78-0-1511" class="i">+			c-&gt;errorpage = 0;
</a><a href="#h78-0-1512" id="h78-0-1512" class="i">+		else
</a><a href="#h78-0-1513" id="h78-0-1513" class="i">+			g_clear_object(&amp;c-&gt;failedcert);
</a><a href="#h78-0-1514" id="h78-0-1514" class="i">+		break;
</a><a href="#h78-0-1515" id="h78-0-1515" class="i">+	case WEBKIT_LOAD_REDIRECTED:
</a><a href="#h78-0-1516" id="h78-0-1516" class="i">+		setatom(c, AtomUri, uri);
</a><a href="#h78-0-1517" id="h78-0-1517" class="i">+		c-&gt;title = uri;
</a><a href="#h78-0-1518" id="h78-0-1518" class="i">+		seturiparameters(c, uri, loadtransient);
</a><a href="#h78-0-1519" id="h78-0-1519" class="i">+		break;
</a><a href="#h78-0-1520" id="h78-0-1520" class="i">+	case WEBKIT_LOAD_COMMITTED:
</a><a href="#h78-0-1521" id="h78-0-1521" class="i">+		seturiparameters(c, uri, loadcommitted);
</a><a href="#h78-0-1522" id="h78-0-1522" class="i">+		c-&gt;https = webkit_web_view_get_tls_info(c-&gt;view, &amp;c-&gt;cert,
</a><a href="#h78-0-1523" id="h78-0-1523" class="i">+		                                        &amp;c-&gt;tlserr);
</a><a href="#h78-0-1524" id="h78-0-1524" class="i">+		break;
</a><a href="#h78-0-1525" id="h78-0-1525" class="i">+	case WEBKIT_LOAD_FINISHED:
</a><a href="#h78-0-1526" id="h78-0-1526" class="i">+		seturiparameters(c, uri, loadfinished);
</a><a href="#h78-0-1527" id="h78-0-1527" class="i">+		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h78-0-1528" id="h78-0-1528" class="i">+		 * manipulating the DOM directly.
</a><a href="#h78-0-1529" id="h78-0-1529" class="i">+		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h78-0-1530" id="h78-0-1530" class="i">+		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h78-0-1531" id="h78-0-1531" class="i">+		*/
</a><a href="#h78-0-1532" id="h78-0-1532" class="i">+		runscript(c);
</a><a href="#h78-0-1533" id="h78-0-1533" class="i">+		break;
</a><a href="#h78-0-1534" id="h78-0-1534" class="i">+	}
</a><a href="#h78-0-1535" id="h78-0-1535" class="i">+	updatetitle(c);
</a><a href="#h78-0-1536" id="h78-0-1536" class="i">+}
</a><a href="#h78-0-1537" id="h78-0-1537" class="i">+
</a><a href="#h78-0-1538" id="h78-0-1538" class="i">+void
</a><a href="#h78-0-1539" id="h78-0-1539" class="i">+progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c)
</a><a href="#h78-0-1540" id="h78-0-1540" class="i">+{
</a><a href="#h78-0-1541" id="h78-0-1541" class="i">+	c-&gt;progress = webkit_web_view_get_estimated_load_progress(c-&gt;view) *
</a><a href="#h78-0-1542" id="h78-0-1542" class="i">+	              100;
</a><a href="#h78-0-1543" id="h78-0-1543" class="i">+	updatetitle(c);
</a><a href="#h78-0-1544" id="h78-0-1544" class="i">+}
</a><a href="#h78-0-1545" id="h78-0-1545" class="i">+
</a><a href="#h78-0-1546" id="h78-0-1546" class="i">+void
</a><a href="#h78-0-1547" id="h78-0-1547" class="i">+titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c)
</a><a href="#h78-0-1548" id="h78-0-1548" class="i">+{
</a><a href="#h78-0-1549" id="h78-0-1549" class="i">+	c-&gt;title = webkit_web_view_get_title(c-&gt;view);
</a><a href="#h78-0-1550" id="h78-0-1550" class="i">+	updatetitle(c);
</a><a href="#h78-0-1551" id="h78-0-1551" class="i">+}
</a><a href="#h78-0-1552" id="h78-0-1552" class="i">+
</a><a href="#h78-0-1553" id="h78-0-1553" class="i">+void
</a><a href="#h78-0-1554" id="h78-0-1554" class="i">+mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h, guint modifiers,
</a><a href="#h78-0-1555" id="h78-0-1555" class="i">+    Client *c)
</a><a href="#h78-0-1556" id="h78-0-1556" class="i">+{
</a><a href="#h78-0-1557" id="h78-0-1557" class="i">+	WebKitHitTestResultContext hc = webkit_hit_test_result_get_context(h);
</a><a href="#h78-0-1558" id="h78-0-1558" class="i">+
</a><a href="#h78-0-1559" id="h78-0-1559" class="i">+	/* Keep the hit test to know where is the pointer on the next click */
</a><a href="#h78-0-1560" id="h78-0-1560" class="i">+	c-&gt;mousepos = h;
</a><a href="#h78-0-1561" id="h78-0-1561" class="i">+
</a><a href="#h78-0-1562" id="h78-0-1562" class="i">+	if (hc &amp; OnLink)
</a><a href="#h78-0-1563" id="h78-0-1563" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h78-0-1564" id="h78-0-1564" class="i">+	else if (hc &amp; OnImg)
</a><a href="#h78-0-1565" id="h78-0-1565" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_image_uri(h);
</a><a href="#h78-0-1566" id="h78-0-1566" class="i">+	else if (hc &amp; OnMedia)
</a><a href="#h78-0-1567" id="h78-0-1567" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_media_uri(h);
</a><a href="#h78-0-1568" id="h78-0-1568" class="i">+	else
</a><a href="#h78-0-1569" id="h78-0-1569" class="i">+		c-&gt;targeturi = NULL;
</a><a href="#h78-0-1570" id="h78-0-1570" class="i">+
</a><a href="#h78-0-1571" id="h78-0-1571" class="i">+	c-&gt;overtitle = c-&gt;targeturi;
</a><a href="#h78-0-1572" id="h78-0-1572" class="i">+	updatetitle(c);
</a><a href="#h78-0-1573" id="h78-0-1573" class="i">+}
</a><a href="#h78-0-1574" id="h78-0-1574" class="i">+
</a><a href="#h78-0-1575" id="h78-0-1575" class="i">+gboolean
</a><a href="#h78-0-1576" id="h78-0-1576" class="i">+permissionrequested(WebKitWebView *v, WebKitPermissionRequest *r, Client *c)
</a><a href="#h78-0-1577" id="h78-0-1577" class="i">+{
</a><a href="#h78-0-1578" id="h78-0-1578" class="i">+	ParamName param = ParameterLast;
</a><a href="#h78-0-1579" id="h78-0-1579" class="i">+
</a><a href="#h78-0-1580" id="h78-0-1580" class="i">+	if (WEBKIT_IS_GEOLOCATION_PERMISSION_REQUEST(r)) {
</a><a href="#h78-0-1581" id="h78-0-1581" class="i">+		param = Geolocation;
</a><a href="#h78-0-1582" id="h78-0-1582" class="i">+	} else if (WEBKIT_IS_USER_MEDIA_PERMISSION_REQUEST(r)) {
</a><a href="#h78-0-1583" id="h78-0-1583" class="i">+		if (webkit_user_media_permission_is_for_audio_device(
</a><a href="#h78-0-1584" id="h78-0-1584" class="i">+		    WEBKIT_USER_MEDIA_PERMISSION_REQUEST(r)))
</a><a href="#h78-0-1585" id="h78-0-1585" class="i">+			param = AccessMicrophone;
</a><a href="#h78-0-1586" id="h78-0-1586" class="i">+		else if (webkit_user_media_permission_is_for_video_device(
</a><a href="#h78-0-1587" id="h78-0-1587" class="i">+		         WEBKIT_USER_MEDIA_PERMISSION_REQUEST(r)))
</a><a href="#h78-0-1588" id="h78-0-1588" class="i">+			param = AccessWebcam;
</a><a href="#h78-0-1589" id="h78-0-1589" class="i">+	} else {
</a><a href="#h78-0-1590" id="h78-0-1590" class="i">+		return FALSE;
</a><a href="#h78-0-1591" id="h78-0-1591" class="i">+	}
</a><a href="#h78-0-1592" id="h78-0-1592" class="i">+
</a><a href="#h78-0-1593" id="h78-0-1593" class="i">+	if (curconfig[param].val.i)
</a><a href="#h78-0-1594" id="h78-0-1594" class="i">+		webkit_permission_request_allow(r);
</a><a href="#h78-0-1595" id="h78-0-1595" class="i">+	else
</a><a href="#h78-0-1596" id="h78-0-1596" class="i">+		webkit_permission_request_deny(r);
</a><a href="#h78-0-1597" id="h78-0-1597" class="i">+
</a><a href="#h78-0-1598" id="h78-0-1598" class="i">+	return TRUE;
</a><a href="#h78-0-1599" id="h78-0-1599" class="i">+}
</a><a href="#h78-0-1600" id="h78-0-1600" class="i">+
</a><a href="#h78-0-1601" id="h78-0-1601" class="i">+gboolean
</a><a href="#h78-0-1602" id="h78-0-1602" class="i">+decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
</a><a href="#h78-0-1603" id="h78-0-1603" class="i">+    WebKitPolicyDecisionType dt, Client *c)
</a><a href="#h78-0-1604" id="h78-0-1604" class="i">+{
</a><a href="#h78-0-1605" id="h78-0-1605" class="i">+	switch (dt) {
</a><a href="#h78-0-1606" id="h78-0-1606" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_NAVIGATION_ACTION:
</a><a href="#h78-0-1607" id="h78-0-1607" class="i">+		decidenavigation(d, c);
</a><a href="#h78-0-1608" id="h78-0-1608" class="i">+		break;
</a><a href="#h78-0-1609" id="h78-0-1609" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_NEW_WINDOW_ACTION:
</a><a href="#h78-0-1610" id="h78-0-1610" class="i">+		decidenewwindow(d, c);
</a><a href="#h78-0-1611" id="h78-0-1611" class="i">+		break;
</a><a href="#h78-0-1612" id="h78-0-1612" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_RESPONSE:
</a><a href="#h78-0-1613" id="h78-0-1613" class="i">+		decideresource(d, c);
</a><a href="#h78-0-1614" id="h78-0-1614" class="i">+		break;
</a><a href="#h78-0-1615" id="h78-0-1615" class="i">+	default:
</a><a href="#h78-0-1616" id="h78-0-1616" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h78-0-1617" id="h78-0-1617" class="i">+		break;
</a><a href="#h78-0-1618" id="h78-0-1618" class="i">+	}
</a><a href="#h78-0-1619" id="h78-0-1619" class="i">+	return TRUE;
</a><a href="#h78-0-1620" id="h78-0-1620" class="i">+}
</a><a href="#h78-0-1621" id="h78-0-1621" class="i">+
</a><a href="#h78-0-1622" id="h78-0-1622" class="i">+void
</a><a href="#h78-0-1623" id="h78-0-1623" class="i">+decidenavigation(WebKitPolicyDecision *d, Client *c)
</a><a href="#h78-0-1624" id="h78-0-1624" class="i">+{
</a><a href="#h78-0-1625" id="h78-0-1625" class="i">+	WebKitNavigationAction *a =
</a><a href="#h78-0-1626" id="h78-0-1626" class="i">+	    webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h78-0-1627" id="h78-0-1627" class="i">+	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h78-0-1628" id="h78-0-1628" class="i">+
</a><a href="#h78-0-1629" id="h78-0-1629" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h78-0-1630" id="h78-0-1630" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h78-0-1631" id="h78-0-1631" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h78-0-1632" id="h78-0-1632" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h78-0-1633" id="h78-0-1633" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h78-0-1634" id="h78-0-1634" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED: /* fallthrough */
</a><a href="#h78-0-1635" id="h78-0-1635" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h78-0-1636" id="h78-0-1636" class="i">+	default:
</a><a href="#h78-0-1637" id="h78-0-1637" class="i">+		/* Do not navigate to links with a &quot;_blank&quot; target (popup) */
</a><a href="#h78-0-1638" id="h78-0-1638" class="i">+		if (webkit_navigation_policy_decision_get_frame_name(
</a><a href="#h78-0-1639" id="h78-0-1639" class="i">+		    WEBKIT_NAVIGATION_POLICY_DECISION(d))) {
</a><a href="#h78-0-1640" id="h78-0-1640" class="i">+			webkit_policy_decision_ignore(d);
</a><a href="#h78-0-1641" id="h78-0-1641" class="i">+		} else {
</a><a href="#h78-0-1642" id="h78-0-1642" class="i">+			/* Filter out navigation to different domain ? */
</a><a href="#h78-0-1643" id="h78-0-1643" class="i">+			/* get action→urirequest, copy and load in new window+view
</a><a href="#h78-0-1644" id="h78-0-1644" class="i">+			 * on Ctrl+Click ? */
</a><a href="#h78-0-1645" id="h78-0-1645" class="i">+			webkit_policy_decision_use(d);
</a><a href="#h78-0-1646" id="h78-0-1646" class="i">+		}
</a><a href="#h78-0-1647" id="h78-0-1647" class="i">+		break;
</a><a href="#h78-0-1648" id="h78-0-1648" class="i">+	}
</a><a href="#h78-0-1649" id="h78-0-1649" class="i">+}
</a><a href="#h78-0-1650" id="h78-0-1650" class="i">+
</a><a href="#h78-0-1651" id="h78-0-1651" class="i">+void
</a><a href="#h78-0-1652" id="h78-0-1652" class="i">+decidenewwindow(WebKitPolicyDecision *d, Client *c)
</a><a href="#h78-0-1653" id="h78-0-1653" class="i">+{
</a><a href="#h78-0-1654" id="h78-0-1654" class="i">+	Arg arg;
</a><a href="#h78-0-1655" id="h78-0-1655" class="i">+	WebKitNavigationAction *a =
</a><a href="#h78-0-1656" id="h78-0-1656" class="i">+	    webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h78-0-1657" id="h78-0-1657" class="i">+	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h78-0-1658" id="h78-0-1658" class="i">+
</a><a href="#h78-0-1659" id="h78-0-1659" class="i">+
</a><a href="#h78-0-1660" id="h78-0-1660" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h78-0-1661" id="h78-0-1661" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h78-0-1662" id="h78-0-1662" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h78-0-1663" id="h78-0-1663" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h78-0-1664" id="h78-0-1664" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h78-0-1665" id="h78-0-1665" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h78-0-1666" id="h78-0-1666" class="i">+		/* Filter domains here */
</a><a href="#h78-0-1667" id="h78-0-1667" class="i">+/* If the value of “mouse-button” is not 0, then the navigation was triggered by a mouse event.
</a><a href="#h78-0-1668" id="h78-0-1668" class="i">+ * test for link clicked but no button ? */
</a><a href="#h78-0-1669" id="h78-0-1669" class="i">+		arg.v = webkit_uri_request_get_uri(
</a><a href="#h78-0-1670" id="h78-0-1670" class="i">+		        webkit_navigation_action_get_request(a));
</a><a href="#h78-0-1671" id="h78-0-1671" class="i">+		newwindow(c, &amp;arg, 0);
</a><a href="#h78-0-1672" id="h78-0-1672" class="i">+		break;
</a><a href="#h78-0-1673" id="h78-0-1673" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h78-0-1674" id="h78-0-1674" class="i">+	default:
</a><a href="#h78-0-1675" id="h78-0-1675" class="i">+		break;
</a><a href="#h78-0-1676" id="h78-0-1676" class="i">+	}
</a><a href="#h78-0-1677" id="h78-0-1677" class="i">+
</a><a href="#h78-0-1678" id="h78-0-1678" class="i">+	webkit_policy_decision_ignore(d);
</a><a href="#h78-0-1679" id="h78-0-1679" class="i">+}
</a><a href="#h78-0-1680" id="h78-0-1680" class="i">+
</a><a href="#h78-0-1681" id="h78-0-1681" class="i">+void
</a><a href="#h78-0-1682" id="h78-0-1682" class="i">+decideresource(WebKitPolicyDecision *d, Client *c)
</a><a href="#h78-0-1683" id="h78-0-1683" class="i">+{
</a><a href="#h78-0-1684" id="h78-0-1684" class="i">+	int i, isascii = 1;
</a><a href="#h78-0-1685" id="h78-0-1685" class="i">+	WebKitResponsePolicyDecision *r = WEBKIT_RESPONSE_POLICY_DECISION(d);
</a><a href="#h78-0-1686" id="h78-0-1686" class="i">+	WebKitURIResponse *res =
</a><a href="#h78-0-1687" id="h78-0-1687" class="i">+	    webkit_response_policy_decision_get_response(r);
</a><a href="#h78-0-1688" id="h78-0-1688" class="i">+	const gchar *uri = webkit_uri_response_get_uri(res);
</a><a href="#h78-0-1689" id="h78-0-1689" class="i">+
</a><a href="#h78-0-1690" id="h78-0-1690" class="i">+	if (g_str_has_suffix(uri, &quot;/favicon.ico&quot;)) {
</a><a href="#h78-0-1691" id="h78-0-1691" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h78-0-1692" id="h78-0-1692" class="i">+		return;
</a><a href="#h78-0-1693" id="h78-0-1693" class="i">+	}
</a><a href="#h78-0-1694" id="h78-0-1694" class="i">+
</a><a href="#h78-0-1695" id="h78-0-1695" class="i">+	if (!g_str_has_prefix(uri, &quot;http://&quot;)
</a><a href="#h78-0-1696" id="h78-0-1696" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;https://&quot;)
</a><a href="#h78-0-1697" id="h78-0-1697" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;about:&quot;)
</a><a href="#h78-0-1698" id="h78-0-1698" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;file://&quot;)
</a><a href="#h78-0-1699" id="h78-0-1699" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;data:&quot;)
</a><a href="#h78-0-1700" id="h78-0-1700" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;blob:&quot;)
</a><a href="#h78-0-1701" id="h78-0-1701" class="i">+	    &amp;&amp; strlen(uri) &gt; 0) {
</a><a href="#h78-0-1702" id="h78-0-1702" class="i">+		for (i = 0; i &lt; strlen(uri); i++) {
</a><a href="#h78-0-1703" id="h78-0-1703" class="i">+			if (!g_ascii_isprint(uri[i])) {
</a><a href="#h78-0-1704" id="h78-0-1704" class="i">+				isascii = 0;
</a><a href="#h78-0-1705" id="h78-0-1705" class="i">+				break;
</a><a href="#h78-0-1706" id="h78-0-1706" class="i">+			}
</a><a href="#h78-0-1707" id="h78-0-1707" class="i">+		}
</a><a href="#h78-0-1708" id="h78-0-1708" class="i">+		if (isascii) {
</a><a href="#h78-0-1709" id="h78-0-1709" class="i">+			handleplumb(c, uri);
</a><a href="#h78-0-1710" id="h78-0-1710" class="i">+			webkit_policy_decision_ignore(d);
</a><a href="#h78-0-1711" id="h78-0-1711" class="i">+			return;
</a><a href="#h78-0-1712" id="h78-0-1712" class="i">+		}
</a><a href="#h78-0-1713" id="h78-0-1713" class="i">+	}
</a><a href="#h78-0-1714" id="h78-0-1714" class="i">+
</a><a href="#h78-0-1715" id="h78-0-1715" class="i">+	if (webkit_response_policy_decision_is_mime_type_supported(r)) {
</a><a href="#h78-0-1716" id="h78-0-1716" class="i">+		webkit_policy_decision_use(d);
</a><a href="#h78-0-1717" id="h78-0-1717" class="i">+	} else {
</a><a href="#h78-0-1718" id="h78-0-1718" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h78-0-1719" id="h78-0-1719" class="i">+		download(c, res);
</a><a href="#h78-0-1720" id="h78-0-1720" class="i">+	}
</a><a href="#h78-0-1721" id="h78-0-1721" class="i">+}
</a><a href="#h78-0-1722" id="h78-0-1722" class="i">+
</a><a href="#h78-0-1723" id="h78-0-1723" class="i">+void
</a><a href="#h78-0-1724" id="h78-0-1724" class="i">+insecurecontent(WebKitWebView *v, WebKitInsecureContentEvent e, Client *c)
</a><a href="#h78-0-1725" id="h78-0-1725" class="i">+{
</a><a href="#h78-0-1726" id="h78-0-1726" class="i">+	c-&gt;insecure = 1;
</a><a href="#h78-0-1727" id="h78-0-1727" class="i">+}
</a><a href="#h78-0-1728" id="h78-0-1728" class="i">+
</a><a href="#h78-0-1729" id="h78-0-1729" class="i">+void
</a><a href="#h78-0-1730" id="h78-0-1730" class="i">+downloadstarted(WebKitWebContext *wc, WebKitDownload *d, Client *c)
</a><a href="#h78-0-1731" id="h78-0-1731" class="i">+{
</a><a href="#h78-0-1732" id="h78-0-1732" class="i">+	g_signal_connect(G_OBJECT(d), &quot;notify::response&quot;,
</a><a href="#h78-0-1733" id="h78-0-1733" class="i">+	                 G_CALLBACK(responsereceived), c);
</a><a href="#h78-0-1734" id="h78-0-1734" class="i">+}
</a><a href="#h78-0-1735" id="h78-0-1735" class="i">+
</a><a href="#h78-0-1736" id="h78-0-1736" class="i">+void
</a><a href="#h78-0-1737" id="h78-0-1737" class="i">+responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c)
</a><a href="#h78-0-1738" id="h78-0-1738" class="i">+{
</a><a href="#h78-0-1739" id="h78-0-1739" class="i">+	download(c, webkit_download_get_response(d));
</a><a href="#h78-0-1740" id="h78-0-1740" class="i">+	webkit_download_cancel(d);
</a><a href="#h78-0-1741" id="h78-0-1741" class="i">+}
</a><a href="#h78-0-1742" id="h78-0-1742" class="i">+
</a><a href="#h78-0-1743" id="h78-0-1743" class="i">+void
</a><a href="#h78-0-1744" id="h78-0-1744" class="i">+download(Client *c, WebKitURIResponse *r)
</a><a href="#h78-0-1745" id="h78-0-1745" class="i">+{
</a><a href="#h78-0-1746" id="h78-0-1746" class="i">+	Arg a = (Arg)DOWNLOAD(webkit_uri_response_get_uri(r), geturi(c));
</a><a href="#h78-0-1747" id="h78-0-1747" class="i">+	spawn(c, &amp;a);
</a><a href="#h78-0-1748" id="h78-0-1748" class="i">+}
</a><a href="#h78-0-1749" id="h78-0-1749" class="i">+
</a><a href="#h78-0-1750" id="h78-0-1750" class="i">+void
</a><a href="#h78-0-1751" id="h78-0-1751" class="i">+webprocessterminated(WebKitWebView *v, WebKitWebProcessTerminationReason r,
</a><a href="#h78-0-1752" id="h78-0-1752" class="i">+                     Client *c)
</a><a href="#h78-0-1753" id="h78-0-1753" class="i">+{
</a><a href="#h78-0-1754" id="h78-0-1754" class="i">+	fprintf(stderr, &quot;web process terminated: %s\n&quot;,
</a><a href="#h78-0-1755" id="h78-0-1755" class="i">+	        r == WEBKIT_WEB_PROCESS_CRASHED ? &quot;crashed&quot; : &quot;no memory&quot;);
</a><a href="#h78-0-1756" id="h78-0-1756" class="i">+	closeview(v, c);
</a><a href="#h78-0-1757" id="h78-0-1757" class="i">+}
</a><a href="#h78-0-1758" id="h78-0-1758" class="i">+
</a><a href="#h78-0-1759" id="h78-0-1759" class="i">+void
</a><a href="#h78-0-1760" id="h78-0-1760" class="i">+closeview(WebKitWebView *v, Client *c)
</a><a href="#h78-0-1761" id="h78-0-1761" class="i">+{
</a><a href="#h78-0-1762" id="h78-0-1762" class="i">+	gtk_widget_destroy(c-&gt;win);
</a><a href="#h78-0-1763" id="h78-0-1763" class="i">+}
</a><a href="#h78-0-1764" id="h78-0-1764" class="i">+
</a><a href="#h78-0-1765" id="h78-0-1765" class="i">+void
</a><a href="#h78-0-1766" id="h78-0-1766" class="i">+destroywin(GtkWidget* w, Client *c)
</a><a href="#h78-0-1767" id="h78-0-1767" class="i">+{
</a><a href="#h78-0-1768" id="h78-0-1768" class="i">+	destroyclient(c);
</a><a href="#h78-0-1769" id="h78-0-1769" class="i">+	if (!clients)
</a><a href="#h78-0-1770" id="h78-0-1770" class="i">+		gtk_main_quit();
</a><a href="#h78-0-1771" id="h78-0-1771" class="i">+}
</a><a href="#h78-0-1772" id="h78-0-1772" class="i">+
</a><a href="#h78-0-1773" id="h78-0-1773" class="i">+gchar *
</a><a href="#h78-0-1774" id="h78-0-1774" class="i">+parseuri(const gchar *uri) {
</a><a href="#h78-0-1775" id="h78-0-1775" class="i">+	guint i;
</a><a href="#h78-0-1776" id="h78-0-1776" class="i">+
</a><a href="#h78-0-1777" id="h78-0-1777" class="i">+	for (i = 0; i &lt; LENGTH(searchengines); i++) {
</a><a href="#h78-0-1778" id="h78-0-1778" class="i">+		if (searchengines[i].token == NULL || searchengines[i].uri == NULL ||
</a><a href="#h78-0-1779" id="h78-0-1779" class="i">+		    *(uri + strlen(searchengines[i].token)) != &#39; &#39;)
</a><a href="#h78-0-1780" id="h78-0-1780" class="i">+			continue;
</a><a href="#h78-0-1781" id="h78-0-1781" class="i">+		if (g_str_has_prefix(uri, searchengines[i].token))
</a><a href="#h78-0-1782" id="h78-0-1782" class="i">+			return g_strdup_printf(searchengines[i].uri,
</a><a href="#h78-0-1783" id="h78-0-1783" class="i">+					       uri + strlen(searchengines[i].token) + 1);
</a><a href="#h78-0-1784" id="h78-0-1784" class="i">+	}
</a><a href="#h78-0-1785" id="h78-0-1785" class="i">+
</a><a href="#h78-0-1786" id="h78-0-1786" class="i">+	return g_strdup_printf(&quot;http://%s&quot;, uri);
</a><a href="#h78-0-1787" id="h78-0-1787" class="i">+}
</a><a href="#h78-0-1788" id="h78-0-1788" class="i">+
</a><a href="#h78-0-1789" id="h78-0-1789" class="i">+void
</a><a href="#h78-0-1790" id="h78-0-1790" class="i">+pasteuri(GtkClipboard *clipboard, const char *text, gpointer d)
</a><a href="#h78-0-1791" id="h78-0-1791" class="i">+{
</a><a href="#h78-0-1792" id="h78-0-1792" class="i">+	Arg a = {.v = text };
</a><a href="#h78-0-1793" id="h78-0-1793" class="i">+	if (text)
</a><a href="#h78-0-1794" id="h78-0-1794" class="i">+		loaduri((Client *) d, &amp;a);
</a><a href="#h78-0-1795" id="h78-0-1795" class="i">+}
</a><a href="#h78-0-1796" id="h78-0-1796" class="i">+
</a><a href="#h78-0-1797" id="h78-0-1797" class="i">+void
</a><a href="#h78-0-1798" id="h78-0-1798" class="i">+reload(Client *c, const Arg *a)
</a><a href="#h78-0-1799" id="h78-0-1799" class="i">+{
</a><a href="#h78-0-1800" id="h78-0-1800" class="i">+	if (a-&gt;i)
</a><a href="#h78-0-1801" id="h78-0-1801" class="i">+		webkit_web_view_reload_bypass_cache(c-&gt;view);
</a><a href="#h78-0-1802" id="h78-0-1802" class="i">+	else
</a><a href="#h78-0-1803" id="h78-0-1803" class="i">+		webkit_web_view_reload(c-&gt;view);
</a><a href="#h78-0-1804" id="h78-0-1804" class="i">+}
</a><a href="#h78-0-1805" id="h78-0-1805" class="i">+
</a><a href="#h78-0-1806" id="h78-0-1806" class="i">+void
</a><a href="#h78-0-1807" id="h78-0-1807" class="i">+print(Client *c, const Arg *a)
</a><a href="#h78-0-1808" id="h78-0-1808" class="i">+{
</a><a href="#h78-0-1809" id="h78-0-1809" class="i">+	webkit_print_operation_run_dialog(webkit_print_operation_new(c-&gt;view),
</a><a href="#h78-0-1810" id="h78-0-1810" class="i">+	                                  GTK_WINDOW(c-&gt;win));
</a><a href="#h78-0-1811" id="h78-0-1811" class="i">+}
</a><a href="#h78-0-1812" id="h78-0-1812" class="i">+
</a><a href="#h78-0-1813" id="h78-0-1813" class="i">+void
</a><a href="#h78-0-1814" id="h78-0-1814" class="i">+showcert(Client *c, const Arg *a)
</a><a href="#h78-0-1815" id="h78-0-1815" class="i">+{
</a><a href="#h78-0-1816" id="h78-0-1816" class="i">+	GTlsCertificate *cert = c-&gt;failedcert ? c-&gt;failedcert : c-&gt;cert;
</a><a href="#h78-0-1817" id="h78-0-1817" class="i">+	GcrCertificate *gcrt;
</a><a href="#h78-0-1818" id="h78-0-1818" class="i">+	GByteArray *crt;
</a><a href="#h78-0-1819" id="h78-0-1819" class="i">+	GtkWidget *win;
</a><a href="#h78-0-1820" id="h78-0-1820" class="i">+	GcrCertificateWidget *wcert;
</a><a href="#h78-0-1821" id="h78-0-1821" class="i">+
</a><a href="#h78-0-1822" id="h78-0-1822" class="i">+	if (!cert)
</a><a href="#h78-0-1823" id="h78-0-1823" class="i">+		return;
</a><a href="#h78-0-1824" id="h78-0-1824" class="i">+
</a><a href="#h78-0-1825" id="h78-0-1825" class="i">+	g_object_get(cert, &quot;certificate&quot;, &amp;crt, NULL);
</a><a href="#h78-0-1826" id="h78-0-1826" class="i">+	gcrt = gcr_simple_certificate_new(crt-&gt;data, crt-&gt;len);
</a><a href="#h78-0-1827" id="h78-0-1827" class="i">+	g_byte_array_unref(crt);
</a><a href="#h78-0-1828" id="h78-0-1828" class="i">+
</a><a href="#h78-0-1829" id="h78-0-1829" class="i">+	win = gtk_window_new(GTK_WINDOW_TOPLEVEL);
</a><a href="#h78-0-1830" id="h78-0-1830" class="i">+	wcert = gcr_certificate_widget_new(gcrt);
</a><a href="#h78-0-1831" id="h78-0-1831" class="i">+	g_object_unref(gcrt);
</a><a href="#h78-0-1832" id="h78-0-1832" class="i">+
</a><a href="#h78-0-1833" id="h78-0-1833" class="i">+	gtk_container_add(GTK_CONTAINER(win), GTK_WIDGET(wcert));
</a><a href="#h78-0-1834" id="h78-0-1834" class="i">+	gtk_widget_show_all(win);
</a><a href="#h78-0-1835" id="h78-0-1835" class="i">+}
</a><a href="#h78-0-1836" id="h78-0-1836" class="i">+
</a><a href="#h78-0-1837" id="h78-0-1837" class="i">+void
</a><a href="#h78-0-1838" id="h78-0-1838" class="i">+clipboard(Client *c, const Arg *a)
</a><a href="#h78-0-1839" id="h78-0-1839" class="i">+{
</a><a href="#h78-0-1840" id="h78-0-1840" class="i">+	if (a-&gt;i) { /* load clipboard uri */
</a><a href="#h78-0-1841" id="h78-0-1841" class="i">+		gtk_clipboard_request_text(gtk_clipboard_get(
</a><a href="#h78-0-1842" id="h78-0-1842" class="i">+		                           GDK_SELECTION_PRIMARY),
</a><a href="#h78-0-1843" id="h78-0-1843" class="i">+		                           pasteuri, c);
</a><a href="#h78-0-1844" id="h78-0-1844" class="i">+	} else { /* copy uri */
</a><a href="#h78-0-1845" id="h78-0-1845" class="i">+		gtk_clipboard_set_text(gtk_clipboard_get(
</a><a href="#h78-0-1846" id="h78-0-1846" class="i">+		                       GDK_SELECTION_PRIMARY), c-&gt;targeturi
</a><a href="#h78-0-1847" id="h78-0-1847" class="i">+		                       ? c-&gt;targeturi : geturi(c), -1);
</a><a href="#h78-0-1848" id="h78-0-1848" class="i">+	}
</a><a href="#h78-0-1849" id="h78-0-1849" class="i">+}
</a><a href="#h78-0-1850" id="h78-0-1850" class="i">+
</a><a href="#h78-0-1851" id="h78-0-1851" class="i">+void
</a><a href="#h78-0-1852" id="h78-0-1852" class="i">+zoom(Client *c, const Arg *a)
</a><a href="#h78-0-1853" id="h78-0-1853" class="i">+{
</a><a href="#h78-0-1854" id="h78-0-1854" class="i">+	if (a-&gt;i &gt; 0)
</a><a href="#h78-0-1855" id="h78-0-1855" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view,
</a><a href="#h78-0-1856" id="h78-0-1856" class="i">+		                               curconfig[ZoomLevel].val.f + 0.1);
</a><a href="#h78-0-1857" id="h78-0-1857" class="i">+	else if (a-&gt;i &lt; 0)
</a><a href="#h78-0-1858" id="h78-0-1858" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view,
</a><a href="#h78-0-1859" id="h78-0-1859" class="i">+		                               curconfig[ZoomLevel].val.f - 0.1);
</a><a href="#h78-0-1860" id="h78-0-1860" class="i">+	else
</a><a href="#h78-0-1861" id="h78-0-1861" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, 1.0);
</a><a href="#h78-0-1862" id="h78-0-1862" class="i">+
</a><a href="#h78-0-1863" id="h78-0-1863" class="i">+	curconfig[ZoomLevel].val.f = webkit_web_view_get_zoom_level(c-&gt;view);
</a><a href="#h78-0-1864" id="h78-0-1864" class="i">+}
</a><a href="#h78-0-1865" id="h78-0-1865" class="i">+
</a><a href="#h78-0-1866" id="h78-0-1866" class="i">+static void
</a><a href="#h78-0-1867" id="h78-0-1867" class="i">+msgext(Client *c, char type, const Arg *a)
</a><a href="#h78-0-1868" id="h78-0-1868" class="i">+{
</a><a href="#h78-0-1869" id="h78-0-1869" class="i">+	static char msg[MSGBUFSZ];
</a><a href="#h78-0-1870" id="h78-0-1870" class="i">+	int ret;
</a><a href="#h78-0-1871" id="h78-0-1871" class="i">+
</a><a href="#h78-0-1872" id="h78-0-1872" class="i">+	if ((ret = snprintf(msg, sizeof(msg), &quot;%c%c%c%c&quot;,
</a><a href="#h78-0-1873" id="h78-0-1873" class="i">+	                    4, c-&gt;pageid, type, a-&gt;i))
</a><a href="#h78-0-1874" id="h78-0-1874" class="i">+	    &gt;= sizeof(msg)) {
</a><a href="#h78-0-1875" id="h78-0-1875" class="i">+		fprintf(stderr, &quot;surf: message too long: %d\n&quot;, ret);
</a><a href="#h78-0-1876" id="h78-0-1876" class="i">+		return;
</a><a href="#h78-0-1877" id="h78-0-1877" class="i">+	}
</a><a href="#h78-0-1878" id="h78-0-1878" class="i">+
</a><a href="#h78-0-1879" id="h78-0-1879" class="i">+	if (pipeout[1] &amp;&amp; write(pipeout[1], msg, sizeof(msg)) &lt; 0)
</a><a href="#h78-0-1880" id="h78-0-1880" class="i">+		fprintf(stderr, &quot;surf: error sending: %.*s\n&quot;, ret-2, msg+2);
</a><a href="#h78-0-1881" id="h78-0-1881" class="i">+}
</a><a href="#h78-0-1882" id="h78-0-1882" class="i">+
</a><a href="#h78-0-1883" id="h78-0-1883" class="i">+void
</a><a href="#h78-0-1884" id="h78-0-1884" class="i">+scrollv(Client *c, const Arg *a)
</a><a href="#h78-0-1885" id="h78-0-1885" class="i">+{
</a><a href="#h78-0-1886" id="h78-0-1886" class="i">+	msgext(c, &#39;v&#39;, a);
</a><a href="#h78-0-1887" id="h78-0-1887" class="i">+}
</a><a href="#h78-0-1888" id="h78-0-1888" class="i">+
</a><a href="#h78-0-1889" id="h78-0-1889" class="i">+void
</a><a href="#h78-0-1890" id="h78-0-1890" class="i">+scrollh(Client *c, const Arg *a)
</a><a href="#h78-0-1891" id="h78-0-1891" class="i">+{
</a><a href="#h78-0-1892" id="h78-0-1892" class="i">+	msgext(c, &#39;h&#39;, a);
</a><a href="#h78-0-1893" id="h78-0-1893" class="i">+}
</a><a href="#h78-0-1894" id="h78-0-1894" class="i">+
</a><a href="#h78-0-1895" id="h78-0-1895" class="i">+void
</a><a href="#h78-0-1896" id="h78-0-1896" class="i">+navigate(Client *c, const Arg *a)
</a><a href="#h78-0-1897" id="h78-0-1897" class="i">+{
</a><a href="#h78-0-1898" id="h78-0-1898" class="i">+	if (a-&gt;i &lt; 0)
</a><a href="#h78-0-1899" id="h78-0-1899" class="i">+		webkit_web_view_go_back(c-&gt;view);
</a><a href="#h78-0-1900" id="h78-0-1900" class="i">+	else if (a-&gt;i &gt; 0)
</a><a href="#h78-0-1901" id="h78-0-1901" class="i">+		webkit_web_view_go_forward(c-&gt;view);
</a><a href="#h78-0-1902" id="h78-0-1902" class="i">+}
</a><a href="#h78-0-1903" id="h78-0-1903" class="i">+
</a><a href="#h78-0-1904" id="h78-0-1904" class="i">+void
</a><a href="#h78-0-1905" id="h78-0-1905" class="i">+stop(Client *c, const Arg *a)
</a><a href="#h78-0-1906" id="h78-0-1906" class="i">+{
</a><a href="#h78-0-1907" id="h78-0-1907" class="i">+	webkit_web_view_stop_loading(c-&gt;view);
</a><a href="#h78-0-1908" id="h78-0-1908" class="i">+}
</a><a href="#h78-0-1909" id="h78-0-1909" class="i">+
</a><a href="#h78-0-1910" id="h78-0-1910" class="i">+void
</a><a href="#h78-0-1911" id="h78-0-1911" class="i">+toggle(Client *c, const Arg *a)
</a><a href="#h78-0-1912" id="h78-0-1912" class="i">+{
</a><a href="#h78-0-1913" id="h78-0-1913" class="i">+	curconfig[a-&gt;i].val.i ^= 1;
</a><a href="#h78-0-1914" id="h78-0-1914" class="i">+	setparameter(c, 1, (ParamName)a-&gt;i, &amp;curconfig[a-&gt;i].val);
</a><a href="#h78-0-1915" id="h78-0-1915" class="i">+}
</a><a href="#h78-0-1916" id="h78-0-1916" class="i">+
</a><a href="#h78-0-1917" id="h78-0-1917" class="i">+void
</a><a href="#h78-0-1918" id="h78-0-1918" class="i">+togglefullscreen(Client *c, const Arg *a)
</a><a href="#h78-0-1919" id="h78-0-1919" class="i">+{
</a><a href="#h78-0-1920" id="h78-0-1920" class="i">+	/* toggling value is handled in winevent() */
</a><a href="#h78-0-1921" id="h78-0-1921" class="i">+	if (c-&gt;fullscreen)
</a><a href="#h78-0-1922" id="h78-0-1922" class="i">+		gtk_window_unfullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h78-0-1923" id="h78-0-1923" class="i">+	else
</a><a href="#h78-0-1924" id="h78-0-1924" class="i">+		gtk_window_fullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h78-0-1925" id="h78-0-1925" class="i">+}
</a><a href="#h78-0-1926" id="h78-0-1926" class="i">+
</a><a href="#h78-0-1927" id="h78-0-1927" class="i">+void
</a><a href="#h78-0-1928" id="h78-0-1928" class="i">+togglecookiepolicy(Client *c, const Arg *a)
</a><a href="#h78-0-1929" id="h78-0-1929" class="i">+{
</a><a href="#h78-0-1930" id="h78-0-1930" class="i">+	++cookiepolicy;
</a><a href="#h78-0-1931" id="h78-0-1931" class="i">+	cookiepolicy %= strlen(curconfig[CookiePolicies].val.v);
</a><a href="#h78-0-1932" id="h78-0-1932" class="i">+
</a><a href="#h78-0-1933" id="h78-0-1933" class="i">+	setparameter(c, 0, CookiePolicies, NULL);
</a><a href="#h78-0-1934" id="h78-0-1934" class="i">+}
</a><a href="#h78-0-1935" id="h78-0-1935" class="i">+
</a><a href="#h78-0-1936" id="h78-0-1936" class="i">+void
</a><a href="#h78-0-1937" id="h78-0-1937" class="i">+toggleinspector(Client *c, const Arg *a)
</a><a href="#h78-0-1938" id="h78-0-1938" class="i">+{
</a><a href="#h78-0-1939" id="h78-0-1939" class="i">+	if (webkit_web_inspector_is_attached(c-&gt;inspector))
</a><a href="#h78-0-1940" id="h78-0-1940" class="i">+		webkit_web_inspector_close(c-&gt;inspector);
</a><a href="#h78-0-1941" id="h78-0-1941" class="i">+	else if (curconfig[Inspector].val.i)
</a><a href="#h78-0-1942" id="h78-0-1942" class="i">+		webkit_web_inspector_show(c-&gt;inspector);
</a><a href="#h78-0-1943" id="h78-0-1943" class="i">+}
</a><a href="#h78-0-1944" id="h78-0-1944" class="i">+
</a><a href="#h78-0-1945" id="h78-0-1945" class="i">+void
</a><a href="#h78-0-1946" id="h78-0-1946" class="i">+find(Client *c, const Arg *a)
</a><a href="#h78-0-1947" id="h78-0-1947" class="i">+{
</a><a href="#h78-0-1948" id="h78-0-1948" class="i">+	const char *s, *f;
</a><a href="#h78-0-1949" id="h78-0-1949" class="i">+
</a><a href="#h78-0-1950" id="h78-0-1950" class="i">+	if (a &amp;&amp; a-&gt;i) {
</a><a href="#h78-0-1951" id="h78-0-1951" class="i">+		if (a-&gt;i &gt; 0)
</a><a href="#h78-0-1952" id="h78-0-1952" class="i">+			webkit_find_controller_search_next(c-&gt;finder);
</a><a href="#h78-0-1953" id="h78-0-1953" class="i">+		else
</a><a href="#h78-0-1954" id="h78-0-1954" class="i">+			webkit_find_controller_search_previous(c-&gt;finder);
</a><a href="#h78-0-1955" id="h78-0-1955" class="i">+	} else {
</a><a href="#h78-0-1956" id="h78-0-1956" class="i">+		s = getatom(c, AtomFind);
</a><a href="#h78-0-1957" id="h78-0-1957" class="i">+		f = webkit_find_controller_get_search_text(c-&gt;finder);
</a><a href="#h78-0-1958" id="h78-0-1958" class="i">+
</a><a href="#h78-0-1959" id="h78-0-1959" class="i">+		if (g_strcmp0(f, s) == 0) /* reset search */
</a><a href="#h78-0-1960" id="h78-0-1960" class="i">+			webkit_find_controller_search(c-&gt;finder, &quot;&quot;, findopts,
</a><a href="#h78-0-1961" id="h78-0-1961" class="i">+			                              G_MAXUINT);
</a><a href="#h78-0-1962" id="h78-0-1962" class="i">+
</a><a href="#h78-0-1963" id="h78-0-1963" class="i">+		webkit_find_controller_search(c-&gt;finder, s, findopts,
</a><a href="#h78-0-1964" id="h78-0-1964" class="i">+		                              G_MAXUINT);
</a><a href="#h78-0-1965" id="h78-0-1965" class="i">+
</a><a href="#h78-0-1966" id="h78-0-1966" class="i">+		if (strcmp(s, &quot;&quot;) == 0)
</a><a href="#h78-0-1967" id="h78-0-1967" class="i">+			webkit_find_controller_search_finish(c-&gt;finder);
</a><a href="#h78-0-1968" id="h78-0-1968" class="i">+	}
</a><a href="#h78-0-1969" id="h78-0-1969" class="i">+}
</a><a href="#h78-0-1970" id="h78-0-1970" class="i">+
</a><a href="#h78-0-1971" id="h78-0-1971" class="i">+void
</a><a href="#h78-0-1972" id="h78-0-1972" class="i">+clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h78-0-1973" id="h78-0-1973" class="i">+{
</a><a href="#h78-0-1974" id="h78-0-1974" class="i">+	navigate(c, a);
</a><a href="#h78-0-1975" id="h78-0-1975" class="i">+}
</a><a href="#h78-0-1976" id="h78-0-1976" class="i">+
</a><a href="#h78-0-1977" id="h78-0-1977" class="i">+void
</a><a href="#h78-0-1978" id="h78-0-1978" class="i">+clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h78-0-1979" id="h78-0-1979" class="i">+{
</a><a href="#h78-0-1980" id="h78-0-1980" class="i">+	Arg arg;
</a><a href="#h78-0-1981" id="h78-0-1981" class="i">+
</a><a href="#h78-0-1982" id="h78-0-1982" class="i">+	arg.v = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h78-0-1983" id="h78-0-1983" class="i">+	newwindow(c, &amp;arg, a-&gt;i);
</a><a href="#h78-0-1984" id="h78-0-1984" class="i">+}
</a><a href="#h78-0-1985" id="h78-0-1985" class="i">+
</a><a href="#h78-0-1986" id="h78-0-1986" class="i">+void
</a><a href="#h78-0-1987" id="h78-0-1987" class="i">+clickexternplayer(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h78-0-1988" id="h78-0-1988" class="i">+{
</a><a href="#h78-0-1989" id="h78-0-1989" class="i">+	Arg arg;
</a><a href="#h78-0-1990" id="h78-0-1990" class="i">+
</a><a href="#h78-0-1991" id="h78-0-1991" class="i">+	arg = (Arg)VIDEOPLAY(webkit_hit_test_result_get_media_uri(h));
</a><a href="#h78-0-1992" id="h78-0-1992" class="i">+	spawn(c, &amp;arg);
</a><a href="#h78-0-1993" id="h78-0-1993" class="i">+}
</a><a href="#h78-0-1994" id="h78-0-1994" class="i">+
</a><a href="#h78-0-1995" id="h78-0-1995" class="i">+int
</a><a href="#h78-0-1996" id="h78-0-1996" class="i">+main(int argc, char *argv[])
</a><a href="#h78-0-1997" id="h78-0-1997" class="i">+{
</a><a href="#h78-0-1998" id="h78-0-1998" class="i">+	Arg arg;
</a><a href="#h78-0-1999" id="h78-0-1999" class="i">+	Client *c;
</a><a href="#h78-0-2000" id="h78-0-2000" class="i">+
</a><a href="#h78-0-2001" id="h78-0-2001" class="i">+	memset(&amp;arg, 0, sizeof(arg));
</a><a href="#h78-0-2002" id="h78-0-2002" class="i">+
</a><a href="#h78-0-2003" id="h78-0-2003" class="i">+	/* command line args */
</a><a href="#h78-0-2004" id="h78-0-2004" class="i">+	ARGBEGIN {
</a><a href="#h78-0-2005" id="h78-0-2005" class="i">+	case &#39;a&#39;:
</a><a href="#h78-0-2006" id="h78-0-2006" class="i">+		defconfig[CookiePolicies].val.v = EARGF(usage());
</a><a href="#h78-0-2007" id="h78-0-2007" class="i">+		defconfig[CookiePolicies].prio = 2;
</a><a href="#h78-0-2008" id="h78-0-2008" class="i">+		break;
</a><a href="#h78-0-2009" id="h78-0-2009" class="i">+	case &#39;b&#39;:
</a><a href="#h78-0-2010" id="h78-0-2010" class="i">+		defconfig[ScrollBars].val.i = 0;
</a><a href="#h78-0-2011" id="h78-0-2011" class="i">+		defconfig[ScrollBars].prio = 2;
</a><a href="#h78-0-2012" id="h78-0-2012" class="i">+		break;
</a><a href="#h78-0-2013" id="h78-0-2013" class="i">+	case &#39;B&#39;:
</a><a href="#h78-0-2014" id="h78-0-2014" class="i">+		defconfig[ScrollBars].val.i = 1;
</a><a href="#h78-0-2015" id="h78-0-2015" class="i">+		defconfig[ScrollBars].prio = 2;
</a><a href="#h78-0-2016" id="h78-0-2016" class="i">+		break;
</a><a href="#h78-0-2017" id="h78-0-2017" class="i">+	case &#39;c&#39;:
</a><a href="#h78-0-2018" id="h78-0-2018" class="i">+		cookiefile = EARGF(usage());
</a><a href="#h78-0-2019" id="h78-0-2019" class="i">+		break;
</a><a href="#h78-0-2020" id="h78-0-2020" class="i">+	case &#39;C&#39;:
</a><a href="#h78-0-2021" id="h78-0-2021" class="i">+		stylefile = EARGF(usage());
</a><a href="#h78-0-2022" id="h78-0-2022" class="i">+		break;
</a><a href="#h78-0-2023" id="h78-0-2023" class="i">+	case &#39;d&#39;:
</a><a href="#h78-0-2024" id="h78-0-2024" class="i">+		defconfig[DiskCache].val.i = 0;
</a><a href="#h78-0-2025" id="h78-0-2025" class="i">+		defconfig[DiskCache].prio = 2;
</a><a href="#h78-0-2026" id="h78-0-2026" class="i">+		break;
</a><a href="#h78-0-2027" id="h78-0-2027" class="i">+	case &#39;D&#39;:
</a><a href="#h78-0-2028" id="h78-0-2028" class="i">+		defconfig[DiskCache].val.i = 1;
</a><a href="#h78-0-2029" id="h78-0-2029" class="i">+		defconfig[DiskCache].prio = 2;
</a><a href="#h78-0-2030" id="h78-0-2030" class="i">+		break;
</a><a href="#h78-0-2031" id="h78-0-2031" class="i">+	case &#39;e&#39;:
</a><a href="#h78-0-2032" id="h78-0-2032" class="i">+		embed = strtol(EARGF(usage()), NULL, 0);
</a><a href="#h78-0-2033" id="h78-0-2033" class="i">+		break;
</a><a href="#h78-0-2034" id="h78-0-2034" class="i">+	case &#39;f&#39;:
</a><a href="#h78-0-2035" id="h78-0-2035" class="i">+		defconfig[RunInFullscreen].val.i = 0;
</a><a href="#h78-0-2036" id="h78-0-2036" class="i">+		defconfig[RunInFullscreen].prio = 2;
</a><a href="#h78-0-2037" id="h78-0-2037" class="i">+		break;
</a><a href="#h78-0-2038" id="h78-0-2038" class="i">+	case &#39;F&#39;:
</a><a href="#h78-0-2039" id="h78-0-2039" class="i">+		defconfig[RunInFullscreen].val.i = 1;
</a><a href="#h78-0-2040" id="h78-0-2040" class="i">+		defconfig[RunInFullscreen].prio = 2;
</a><a href="#h78-0-2041" id="h78-0-2041" class="i">+		break;
</a><a href="#h78-0-2042" id="h78-0-2042" class="i">+	case &#39;g&#39;:
</a><a href="#h78-0-2043" id="h78-0-2043" class="i">+		defconfig[Geolocation].val.i = 0;
</a><a href="#h78-0-2044" id="h78-0-2044" class="i">+		defconfig[Geolocation].prio = 2;
</a><a href="#h78-0-2045" id="h78-0-2045" class="i">+		break;
</a><a href="#h78-0-2046" id="h78-0-2046" class="i">+	case &#39;G&#39;:
</a><a href="#h78-0-2047" id="h78-0-2047" class="i">+		defconfig[Geolocation].val.i = 1;
</a><a href="#h78-0-2048" id="h78-0-2048" class="i">+		defconfig[Geolocation].prio = 2;
</a><a href="#h78-0-2049" id="h78-0-2049" class="i">+		break;
</a><a href="#h78-0-2050" id="h78-0-2050" class="i">+	case &#39;i&#39;:
</a><a href="#h78-0-2051" id="h78-0-2051" class="i">+		defconfig[LoadImages].val.i = 0;
</a><a href="#h78-0-2052" id="h78-0-2052" class="i">+		defconfig[LoadImages].prio = 2;
</a><a href="#h78-0-2053" id="h78-0-2053" class="i">+		break;
</a><a href="#h78-0-2054" id="h78-0-2054" class="i">+	case &#39;I&#39;:
</a><a href="#h78-0-2055" id="h78-0-2055" class="i">+		defconfig[LoadImages].val.i = 1;
</a><a href="#h78-0-2056" id="h78-0-2056" class="i">+		defconfig[LoadImages].prio = 2;
</a><a href="#h78-0-2057" id="h78-0-2057" class="i">+		break;
</a><a href="#h78-0-2058" id="h78-0-2058" class="i">+	case &#39;k&#39;:
</a><a href="#h78-0-2059" id="h78-0-2059" class="i">+		defconfig[KioskMode].val.i = 0;
</a><a href="#h78-0-2060" id="h78-0-2060" class="i">+		defconfig[KioskMode].prio = 2;
</a><a href="#h78-0-2061" id="h78-0-2061" class="i">+		break;
</a><a href="#h78-0-2062" id="h78-0-2062" class="i">+	case &#39;K&#39;:
</a><a href="#h78-0-2063" id="h78-0-2063" class="i">+		defconfig[KioskMode].val.i = 1;
</a><a href="#h78-0-2064" id="h78-0-2064" class="i">+		defconfig[KioskMode].prio = 2;
</a><a href="#h78-0-2065" id="h78-0-2065" class="i">+		break;
</a><a href="#h78-0-2066" id="h78-0-2066" class="i">+	case &#39;m&#39;:
</a><a href="#h78-0-2067" id="h78-0-2067" class="i">+		defconfig[Style].val.i = 0;
</a><a href="#h78-0-2068" id="h78-0-2068" class="i">+		defconfig[Style].prio = 2;
</a><a href="#h78-0-2069" id="h78-0-2069" class="i">+		break;
</a><a href="#h78-0-2070" id="h78-0-2070" class="i">+	case &#39;M&#39;:
</a><a href="#h78-0-2071" id="h78-0-2071" class="i">+		defconfig[Style].val.i = 1;
</a><a href="#h78-0-2072" id="h78-0-2072" class="i">+		defconfig[Style].prio = 2;
</a><a href="#h78-0-2073" id="h78-0-2073" class="i">+		break;
</a><a href="#h78-0-2074" id="h78-0-2074" class="i">+	case &#39;n&#39;:
</a><a href="#h78-0-2075" id="h78-0-2075" class="i">+		defconfig[Inspector].val.i = 0;
</a><a href="#h78-0-2076" id="h78-0-2076" class="i">+		defconfig[Inspector].prio = 2;
</a><a href="#h78-0-2077" id="h78-0-2077" class="i">+		break;
</a><a href="#h78-0-2078" id="h78-0-2078" class="i">+	case &#39;N&#39;:
</a><a href="#h78-0-2079" id="h78-0-2079" class="i">+		defconfig[Inspector].val.i = 1;
</a><a href="#h78-0-2080" id="h78-0-2080" class="i">+		defconfig[Inspector].prio = 2;
</a><a href="#h78-0-2081" id="h78-0-2081" class="i">+		break;
</a><a href="#h78-0-2082" id="h78-0-2082" class="i">+	case &#39;p&#39;:
</a><a href="#h78-0-2083" id="h78-0-2083" class="i">+		defconfig[Plugins].val.i = 0;
</a><a href="#h78-0-2084" id="h78-0-2084" class="i">+		defconfig[Plugins].prio = 2;
</a><a href="#h78-0-2085" id="h78-0-2085" class="i">+		break;
</a><a href="#h78-0-2086" id="h78-0-2086" class="i">+	case &#39;P&#39;:
</a><a href="#h78-0-2087" id="h78-0-2087" class="i">+		defconfig[Plugins].val.i = 1;
</a><a href="#h78-0-2088" id="h78-0-2088" class="i">+		defconfig[Plugins].prio = 2;
</a><a href="#h78-0-2089" id="h78-0-2089" class="i">+		break;
</a><a href="#h78-0-2090" id="h78-0-2090" class="i">+	case &#39;r&#39;:
</a><a href="#h78-0-2091" id="h78-0-2091" class="i">+		scriptfile = EARGF(usage());
</a><a href="#h78-0-2092" id="h78-0-2092" class="i">+		break;
</a><a href="#h78-0-2093" id="h78-0-2093" class="i">+	case &#39;s&#39;:
</a><a href="#h78-0-2094" id="h78-0-2094" class="i">+		defconfig[JavaScript].val.i = 0;
</a><a href="#h78-0-2095" id="h78-0-2095" class="i">+		defconfig[JavaScript].prio = 2;
</a><a href="#h78-0-2096" id="h78-0-2096" class="i">+		break;
</a><a href="#h78-0-2097" id="h78-0-2097" class="i">+	case &#39;S&#39;:
</a><a href="#h78-0-2098" id="h78-0-2098" class="i">+		defconfig[JavaScript].val.i = 1;
</a><a href="#h78-0-2099" id="h78-0-2099" class="i">+		defconfig[JavaScript].prio = 2;
</a><a href="#h78-0-2100" id="h78-0-2100" class="i">+		break;
</a><a href="#h78-0-2101" id="h78-0-2101" class="i">+	case &#39;t&#39;:
</a><a href="#h78-0-2102" id="h78-0-2102" class="i">+		defconfig[StrictTLS].val.i = 0;
</a><a href="#h78-0-2103" id="h78-0-2103" class="i">+		defconfig[StrictTLS].prio = 2;
</a><a href="#h78-0-2104" id="h78-0-2104" class="i">+		break;
</a><a href="#h78-0-2105" id="h78-0-2105" class="i">+	case &#39;T&#39;:
</a><a href="#h78-0-2106" id="h78-0-2106" class="i">+		defconfig[StrictTLS].val.i = 1;
</a><a href="#h78-0-2107" id="h78-0-2107" class="i">+		defconfig[StrictTLS].prio = 2;
</a><a href="#h78-0-2108" id="h78-0-2108" class="i">+		break;
</a><a href="#h78-0-2109" id="h78-0-2109" class="i">+	case &#39;u&#39;:
</a><a href="#h78-0-2110" id="h78-0-2110" class="i">+		fulluseragent = EARGF(usage());
</a><a href="#h78-0-2111" id="h78-0-2111" class="i">+		break;
</a><a href="#h78-0-2112" id="h78-0-2112" class="i">+	case &#39;v&#39;:
</a><a href="#h78-0-2113" id="h78-0-2113" class="i">+		die(&quot;surf-&quot;VERSION&quot;, see LICENSE for © details\n&quot;);
</a><a href="#h78-0-2114" id="h78-0-2114" class="i">+	case &#39;w&#39;:
</a><a href="#h78-0-2115" id="h78-0-2115" class="i">+		showxid = 1;
</a><a href="#h78-0-2116" id="h78-0-2116" class="i">+		break;
</a><a href="#h78-0-2117" id="h78-0-2117" class="i">+	case &#39;x&#39;:
</a><a href="#h78-0-2118" id="h78-0-2118" class="i">+		defconfig[Certificate].val.i = 0;
</a><a href="#h78-0-2119" id="h78-0-2119" class="i">+		defconfig[Certificate].prio = 2;
</a><a href="#h78-0-2120" id="h78-0-2120" class="i">+		break;
</a><a href="#h78-0-2121" id="h78-0-2121" class="i">+	case &#39;X&#39;:
</a><a href="#h78-0-2122" id="h78-0-2122" class="i">+		defconfig[Certificate].val.i = 1;
</a><a href="#h78-0-2123" id="h78-0-2123" class="i">+		defconfig[Certificate].prio = 2;
</a><a href="#h78-0-2124" id="h78-0-2124" class="i">+		break;
</a><a href="#h78-0-2125" id="h78-0-2125" class="i">+	case &#39;z&#39;:
</a><a href="#h78-0-2126" id="h78-0-2126" class="i">+		defconfig[ZoomLevel].val.f = strtof(EARGF(usage()), NULL);
</a><a href="#h78-0-2127" id="h78-0-2127" class="i">+		defconfig[ZoomLevel].prio = 2;
</a><a href="#h78-0-2128" id="h78-0-2128" class="i">+		break;
</a><a href="#h78-0-2129" id="h78-0-2129" class="i">+	default:
</a><a href="#h78-0-2130" id="h78-0-2130" class="i">+		usage();
</a><a href="#h78-0-2131" id="h78-0-2131" class="i">+	} ARGEND;
</a><a href="#h78-0-2132" id="h78-0-2132" class="i">+	if (argc &gt; 0)
</a><a href="#h78-0-2133" id="h78-0-2133" class="i">+		arg.v = argv[0];
</a><a href="#h78-0-2134" id="h78-0-2134" class="i">+	else
</a><a href="#h78-0-2135" id="h78-0-2135" class="i">+#ifdef HOMEPAGE
</a><a href="#h78-0-2136" id="h78-0-2136" class="i">+		arg.v = HOMEPAGE;
</a><a href="#h78-0-2137" id="h78-0-2137" class="i">+#else
</a><a href="#h78-0-2138" id="h78-0-2138" class="i">+		arg.v = &quot;about:blank&quot;;
</a><a href="#h78-0-2139" id="h78-0-2139" class="i">+#endif
</a><a href="#h78-0-2140" id="h78-0-2140" class="i">+
</a><a href="#h78-0-2141" id="h78-0-2141" class="i">+	setup();
</a><a href="#h78-0-2142" id="h78-0-2142" class="i">+	c = newclient(NULL);
</a><a href="#h78-0-2143" id="h78-0-2143" class="i">+	showview(NULL, c);
</a><a href="#h78-0-2144" id="h78-0-2144" class="i">+
</a><a href="#h78-0-2145" id="h78-0-2145" class="i">+	loaduri(c, &amp;arg);
</a><a href="#h78-0-2146" id="h78-0-2146" class="i">+	updatetitle(c);
</a><a href="#h78-0-2147" id="h78-0-2147" class="i">+
</a><a href="#h78-0-2148" id="h78-0-2148" class="i">+	gtk_main();
</a><a href="#h78-0-2149" id="h78-0-2149" class="i">+	cleanup();
</a><a href="#h78-0-2150" id="h78-0-2150" class="i">+
</a><a href="#h78-0-2151" id="h78-0-2151" class="i">+	return 0;
</a><a href="#h78-0-2152" id="h78-0-2152" class="i">+}
</a><b>diff --git a/<a id="h79" href="../file/surf/surf.c.orig.html">surf/surf.c.orig</a> b/<a href="../file/surf/surf.c.orig.html">surf/surf.c.orig</a></b>
<a href="#h79-0" id="h79-0" class="h">@@ -0,0 +1,2131 @@
</a><a href="#h79-0-0" id="h79-0-0" class="i">+/* See LICENSE file for copyright and license details.
</a><a href="#h79-0-1" id="h79-0-1" class="i">+ *
</a><a href="#h79-0-2" id="h79-0-2" class="i">+ * To understand surf, start reading main().
</a><a href="#h79-0-3" id="h79-0-3" class="i">+ */
</a><a href="#h79-0-4" id="h79-0-4" class="i">+#include &lt;sys/file.h&gt;
</a><a href="#h79-0-5" id="h79-0-5" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h79-0-6" id="h79-0-6" class="i">+#include &lt;sys/wait.h&gt;
</a><a href="#h79-0-7" id="h79-0-7" class="i">+#include &lt;glib.h&gt;
</a><a href="#h79-0-8" id="h79-0-8" class="i">+#include &lt;libgen.h&gt;
</a><a href="#h79-0-9" id="h79-0-9" class="i">+#include &lt;limits.h&gt;
</a><a href="#h79-0-10" id="h79-0-10" class="i">+#include &lt;pwd.h&gt;
</a><a href="#h79-0-11" id="h79-0-11" class="i">+#include &lt;regex.h&gt;
</a><a href="#h79-0-12" id="h79-0-12" class="i">+#include &lt;signal.h&gt;
</a><a href="#h79-0-13" id="h79-0-13" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h79-0-14" id="h79-0-14" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h79-0-15" id="h79-0-15" class="i">+#include &lt;string.h&gt;
</a><a href="#h79-0-16" id="h79-0-16" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h79-0-17" id="h79-0-17" class="i">+
</a><a href="#h79-0-18" id="h79-0-18" class="i">+#include &lt;gdk/gdk.h&gt;
</a><a href="#h79-0-19" id="h79-0-19" class="i">+#include &lt;gdk/gdkkeysyms.h&gt;
</a><a href="#h79-0-20" id="h79-0-20" class="i">+#include &lt;gdk/gdkx.h&gt;
</a><a href="#h79-0-21" id="h79-0-21" class="i">+#include &lt;glib/gstdio.h&gt;
</a><a href="#h79-0-22" id="h79-0-22" class="i">+#include &lt;gtk/gtk.h&gt;
</a><a href="#h79-0-23" id="h79-0-23" class="i">+#include &lt;gtk/gtkx.h&gt;
</a><a href="#h79-0-24" id="h79-0-24" class="i">+#include &lt;gcr/gcr.h&gt;
</a><a href="#h79-0-25" id="h79-0-25" class="i">+#include &lt;JavaScriptCore/JavaScript.h&gt;
</a><a href="#h79-0-26" id="h79-0-26" class="i">+#include &lt;webkit2/webkit2.h&gt;
</a><a href="#h79-0-27" id="h79-0-27" class="i">+#include &lt;X11/X.h&gt;
</a><a href="#h79-0-28" id="h79-0-28" class="i">+#include &lt;X11/Xatom.h&gt;
</a><a href="#h79-0-29" id="h79-0-29" class="i">+#include &lt;glib.h&gt;
</a><a href="#h79-0-30" id="h79-0-30" class="i">+
</a><a href="#h79-0-31" id="h79-0-31" class="i">+#include &quot;arg.h&quot;
</a><a href="#h79-0-32" id="h79-0-32" class="i">+#include &quot;common.h&quot;
</a><a href="#h79-0-33" id="h79-0-33" class="i">+
</a><a href="#h79-0-34" id="h79-0-34" class="i">+#define LENGTH(x)               (sizeof(x) / sizeof(x[0]))
</a><a href="#h79-0-35" id="h79-0-35" class="i">+#define CLEANMASK(mask)         (mask &amp; (MODKEY|GDK_SHIFT_MASK))
</a><a href="#h79-0-36" id="h79-0-36" class="i">+
</a><a href="#h79-0-37" id="h79-0-37" class="i">+enum { AtomFind, AtomGo, AtomUri, AtomLast };
</a><a href="#h79-0-38" id="h79-0-38" class="i">+
</a><a href="#h79-0-39" id="h79-0-39" class="i">+enum {
</a><a href="#h79-0-40" id="h79-0-40" class="i">+	OnDoc   = WEBKIT_HIT_TEST_RESULT_CONTEXT_DOCUMENT,
</a><a href="#h79-0-41" id="h79-0-41" class="i">+	OnLink  = WEBKIT_HIT_TEST_RESULT_CONTEXT_LINK,
</a><a href="#h79-0-42" id="h79-0-42" class="i">+	OnImg   = WEBKIT_HIT_TEST_RESULT_CONTEXT_IMAGE,
</a><a href="#h79-0-43" id="h79-0-43" class="i">+	OnMedia = WEBKIT_HIT_TEST_RESULT_CONTEXT_MEDIA,
</a><a href="#h79-0-44" id="h79-0-44" class="i">+	OnEdit  = WEBKIT_HIT_TEST_RESULT_CONTEXT_EDITABLE,
</a><a href="#h79-0-45" id="h79-0-45" class="i">+	OnBar   = WEBKIT_HIT_TEST_RESULT_CONTEXT_SCROLLBAR,
</a><a href="#h79-0-46" id="h79-0-46" class="i">+	OnSel   = WEBKIT_HIT_TEST_RESULT_CONTEXT_SELECTION,
</a><a href="#h79-0-47" id="h79-0-47" class="i">+	OnAny   = OnDoc | OnLink | OnImg | OnMedia | OnEdit | OnBar | OnSel,
</a><a href="#h79-0-48" id="h79-0-48" class="i">+};
</a><a href="#h79-0-49" id="h79-0-49" class="i">+
</a><a href="#h79-0-50" id="h79-0-50" class="i">+typedef enum {
</a><a href="#h79-0-51" id="h79-0-51" class="i">+	AcceleratedCanvas,
</a><a href="#h79-0-52" id="h79-0-52" class="i">+	AccessMicrophone,
</a><a href="#h79-0-53" id="h79-0-53" class="i">+	AccessWebcam,
</a><a href="#h79-0-54" id="h79-0-54" class="i">+	CaretBrowsing,
</a><a href="#h79-0-55" id="h79-0-55" class="i">+	Certificate,
</a><a href="#h79-0-56" id="h79-0-56" class="i">+	CookiePolicies,
</a><a href="#h79-0-57" id="h79-0-57" class="i">+	DiskCache,
</a><a href="#h79-0-58" id="h79-0-58" class="i">+	DefaultCharset,
</a><a href="#h79-0-59" id="h79-0-59" class="i">+	DNSPrefetch,
</a><a href="#h79-0-60" id="h79-0-60" class="i">+	FileURLsCrossAccess,
</a><a href="#h79-0-61" id="h79-0-61" class="i">+	FontSize,
</a><a href="#h79-0-62" id="h79-0-62" class="i">+	FrameFlattening,
</a><a href="#h79-0-63" id="h79-0-63" class="i">+	Geolocation,
</a><a href="#h79-0-64" id="h79-0-64" class="i">+	HideBackground,
</a><a href="#h79-0-65" id="h79-0-65" class="i">+	Inspector,
</a><a href="#h79-0-66" id="h79-0-66" class="i">+	Java,
</a><a href="#h79-0-67" id="h79-0-67" class="i">+	JavaScript,
</a><a href="#h79-0-68" id="h79-0-68" class="i">+	KioskMode,
</a><a href="#h79-0-69" id="h79-0-69" class="i">+	LoadImages,
</a><a href="#h79-0-70" id="h79-0-70" class="i">+	MediaManualPlay,
</a><a href="#h79-0-71" id="h79-0-71" class="i">+	Plugins,
</a><a href="#h79-0-72" id="h79-0-72" class="i">+	PreferredLanguages,
</a><a href="#h79-0-73" id="h79-0-73" class="i">+	RunInFullscreen,
</a><a href="#h79-0-74" id="h79-0-74" class="i">+	ScrollBars,
</a><a href="#h79-0-75" id="h79-0-75" class="i">+	ShowIndicators,
</a><a href="#h79-0-76" id="h79-0-76" class="i">+	SiteQuirks,
</a><a href="#h79-0-77" id="h79-0-77" class="i">+	SmoothScrolling,
</a><a href="#h79-0-78" id="h79-0-78" class="i">+	SpellChecking,
</a><a href="#h79-0-79" id="h79-0-79" class="i">+	SpellLanguages,
</a><a href="#h79-0-80" id="h79-0-80" class="i">+	StrictTLS,
</a><a href="#h79-0-81" id="h79-0-81" class="i">+	Style,
</a><a href="#h79-0-82" id="h79-0-82" class="i">+	WebGL,
</a><a href="#h79-0-83" id="h79-0-83" class="i">+	ZoomLevel,
</a><a href="#h79-0-84" id="h79-0-84" class="i">+	ParameterLast
</a><a href="#h79-0-85" id="h79-0-85" class="i">+} ParamName;
</a><a href="#h79-0-86" id="h79-0-86" class="i">+
</a><a href="#h79-0-87" id="h79-0-87" class="i">+typedef union {
</a><a href="#h79-0-88" id="h79-0-88" class="i">+	int i;
</a><a href="#h79-0-89" id="h79-0-89" class="i">+	float f;
</a><a href="#h79-0-90" id="h79-0-90" class="i">+	const void *v;
</a><a href="#h79-0-91" id="h79-0-91" class="i">+} Arg;
</a><a href="#h79-0-92" id="h79-0-92" class="i">+
</a><a href="#h79-0-93" id="h79-0-93" class="i">+typedef struct {
</a><a href="#h79-0-94" id="h79-0-94" class="i">+	Arg val;
</a><a href="#h79-0-95" id="h79-0-95" class="i">+	int prio;
</a><a href="#h79-0-96" id="h79-0-96" class="i">+} Parameter;
</a><a href="#h79-0-97" id="h79-0-97" class="i">+
</a><a href="#h79-0-98" id="h79-0-98" class="i">+typedef struct Client {
</a><a href="#h79-0-99" id="h79-0-99" class="i">+	GtkWidget *win;
</a><a href="#h79-0-100" id="h79-0-100" class="i">+	WebKitWebView *view;
</a><a href="#h79-0-101" id="h79-0-101" class="i">+	WebKitWebInspector *inspector;
</a><a href="#h79-0-102" id="h79-0-102" class="i">+	WebKitFindController *finder;
</a><a href="#h79-0-103" id="h79-0-103" class="i">+	WebKitHitTestResult *mousepos;
</a><a href="#h79-0-104" id="h79-0-104" class="i">+	GTlsCertificate *cert, *failedcert;
</a><a href="#h79-0-105" id="h79-0-105" class="i">+	GTlsCertificateFlags tlserr;
</a><a href="#h79-0-106" id="h79-0-106" class="i">+	Window xid;
</a><a href="#h79-0-107" id="h79-0-107" class="i">+	unsigned long pageid;
</a><a href="#h79-0-108" id="h79-0-108" class="i">+	int progress, fullscreen, https, insecure, errorpage;
</a><a href="#h79-0-109" id="h79-0-109" class="i">+	const char *title, *overtitle, *targeturi;
</a><a href="#h79-0-110" id="h79-0-110" class="i">+	const char *needle;
</a><a href="#h79-0-111" id="h79-0-111" class="i">+	struct Client *next;
</a><a href="#h79-0-112" id="h79-0-112" class="i">+} Client;
</a><a href="#h79-0-113" id="h79-0-113" class="i">+
</a><a href="#h79-0-114" id="h79-0-114" class="i">+typedef struct {
</a><a href="#h79-0-115" id="h79-0-115" class="i">+	guint mod;
</a><a href="#h79-0-116" id="h79-0-116" class="i">+	guint keyval;
</a><a href="#h79-0-117" id="h79-0-117" class="i">+	void (*func)(Client *c, const Arg *a);
</a><a href="#h79-0-118" id="h79-0-118" class="i">+	const Arg arg;
</a><a href="#h79-0-119" id="h79-0-119" class="i">+} Key;
</a><a href="#h79-0-120" id="h79-0-120" class="i">+
</a><a href="#h79-0-121" id="h79-0-121" class="i">+typedef struct {
</a><a href="#h79-0-122" id="h79-0-122" class="i">+	unsigned int target;
</a><a href="#h79-0-123" id="h79-0-123" class="i">+	unsigned int mask;
</a><a href="#h79-0-124" id="h79-0-124" class="i">+	guint button;
</a><a href="#h79-0-125" id="h79-0-125" class="i">+	void (*func)(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h79-0-126" id="h79-0-126" class="i">+	const Arg arg;
</a><a href="#h79-0-127" id="h79-0-127" class="i">+	unsigned int stopevent;
</a><a href="#h79-0-128" id="h79-0-128" class="i">+} Button;
</a><a href="#h79-0-129" id="h79-0-129" class="i">+
</a><a href="#h79-0-130" id="h79-0-130" class="i">+typedef struct {
</a><a href="#h79-0-131" id="h79-0-131" class="i">+	const char *uri;
</a><a href="#h79-0-132" id="h79-0-132" class="i">+	Parameter config[ParameterLast];
</a><a href="#h79-0-133" id="h79-0-133" class="i">+	regex_t re;
</a><a href="#h79-0-134" id="h79-0-134" class="i">+} UriParameters;
</a><a href="#h79-0-135" id="h79-0-135" class="i">+
</a><a href="#h79-0-136" id="h79-0-136" class="i">+typedef struct {
</a><a href="#h79-0-137" id="h79-0-137" class="i">+	char *regex;
</a><a href="#h79-0-138" id="h79-0-138" class="i">+	char *file;
</a><a href="#h79-0-139" id="h79-0-139" class="i">+	regex_t re;
</a><a href="#h79-0-140" id="h79-0-140" class="i">+} SiteSpecific;
</a><a href="#h79-0-141" id="h79-0-141" class="i">+
</a><a href="#h79-0-142" id="h79-0-142" class="i">+/* Surf */
</a><a href="#h79-0-143" id="h79-0-143" class="i">+static void usage(void);
</a><a href="#h79-0-144" id="h79-0-144" class="i">+static void setup(void);
</a><a href="#h79-0-145" id="h79-0-145" class="i">+static void sigchld(int unused);
</a><a href="#h79-0-146" id="h79-0-146" class="i">+static void sighup(int unused);
</a><a href="#h79-0-147" id="h79-0-147" class="i">+static char *buildfile(const char *path);
</a><a href="#h79-0-148" id="h79-0-148" class="i">+static char *buildpath(const char *path);
</a><a href="#h79-0-149" id="h79-0-149" class="i">+static char *untildepath(const char *path);
</a><a href="#h79-0-150" id="h79-0-150" class="i">+static const char *getuserhomedir(const char *user);
</a><a href="#h79-0-151" id="h79-0-151" class="i">+static const char *getcurrentuserhomedir(void);
</a><a href="#h79-0-152" id="h79-0-152" class="i">+static Client *newclient(Client *c);
</a><a href="#h79-0-153" id="h79-0-153" class="i">+static void loaduri(Client *c, const Arg *a);
</a><a href="#h79-0-154" id="h79-0-154" class="i">+static const char *geturi(Client *c);
</a><a href="#h79-0-155" id="h79-0-155" class="i">+static void setatom(Client *c, int a, const char *v);
</a><a href="#h79-0-156" id="h79-0-156" class="i">+static const char *getatom(Client *c, int a);
</a><a href="#h79-0-157" id="h79-0-157" class="i">+static void updatetitle(Client *c);
</a><a href="#h79-0-158" id="h79-0-158" class="i">+static void gettogglestats(Client *c);
</a><a href="#h79-0-159" id="h79-0-159" class="i">+static void getpagestats(Client *c);
</a><a href="#h79-0-160" id="h79-0-160" class="i">+static WebKitCookieAcceptPolicy cookiepolicy_get(void);
</a><a href="#h79-0-161" id="h79-0-161" class="i">+static char cookiepolicy_set(const WebKitCookieAcceptPolicy p);
</a><a href="#h79-0-162" id="h79-0-162" class="i">+static void seturiparameters(Client *c, const char *uri, ParamName *params);
</a><a href="#h79-0-163" id="h79-0-163" class="i">+static void setparameter(Client *c, int refresh, ParamName p, const Arg *a);
</a><a href="#h79-0-164" id="h79-0-164" class="i">+static const char *getcert(const char *uri);
</a><a href="#h79-0-165" id="h79-0-165" class="i">+static void setcert(Client *c, const char *file);
</a><a href="#h79-0-166" id="h79-0-166" class="i">+static const char *getstyle(const char *uri);
</a><a href="#h79-0-167" id="h79-0-167" class="i">+static void setstyle(Client *c, const char *file);
</a><a href="#h79-0-168" id="h79-0-168" class="i">+static void runscript(Client *c);
</a><a href="#h79-0-169" id="h79-0-169" class="i">+static void evalscript(Client *c, const char *jsstr, ...);
</a><a href="#h79-0-170" id="h79-0-170" class="i">+static void updatewinid(Client *c);
</a><a href="#h79-0-171" id="h79-0-171" class="i">+static void handleplumb(Client *c, const char *uri);
</a><a href="#h79-0-172" id="h79-0-172" class="i">+static void newwindow(Client *c, const Arg *a, int noembed);
</a><a href="#h79-0-173" id="h79-0-173" class="i">+static void spawn(Client *c, const Arg *a);
</a><a href="#h79-0-174" id="h79-0-174" class="i">+static void msgext(Client *c, char type, const Arg *a);
</a><a href="#h79-0-175" id="h79-0-175" class="i">+static void destroyclient(Client *c);
</a><a href="#h79-0-176" id="h79-0-176" class="i">+static void cleanup(void);
</a><a href="#h79-0-177" id="h79-0-177" class="i">+
</a><a href="#h79-0-178" id="h79-0-178" class="i">+/* GTK/WebKit */
</a><a href="#h79-0-179" id="h79-0-179" class="i">+static WebKitWebView *newview(Client *c, WebKitWebView *rv);
</a><a href="#h79-0-180" id="h79-0-180" class="i">+static void initwebextensions(WebKitWebContext *wc, Client *c);
</a><a href="#h79-0-181" id="h79-0-181" class="i">+static GtkWidget *createview(WebKitWebView *v, WebKitNavigationAction *a,
</a><a href="#h79-0-182" id="h79-0-182" class="i">+                             Client *c);
</a><a href="#h79-0-183" id="h79-0-183" class="i">+static gboolean buttonreleased(GtkWidget *w, GdkEvent *e, Client *c);
</a><a href="#h79-0-184" id="h79-0-184" class="i">+static GdkFilterReturn processx(GdkXEvent *xevent, GdkEvent *event,
</a><a href="#h79-0-185" id="h79-0-185" class="i">+                                gpointer d);
</a><a href="#h79-0-186" id="h79-0-186" class="i">+static gboolean winevent(GtkWidget *w, GdkEvent *e, Client *c);
</a><a href="#h79-0-187" id="h79-0-187" class="i">+static gboolean readpipe(GIOChannel *s, GIOCondition ioc, gpointer unused);
</a><a href="#h79-0-188" id="h79-0-188" class="i">+static void showview(WebKitWebView *v, Client *c);
</a><a href="#h79-0-189" id="h79-0-189" class="i">+static GtkWidget *createwindow(Client *c);
</a><a href="#h79-0-190" id="h79-0-190" class="i">+static gboolean loadfailedtls(WebKitWebView *v, gchar *uri,
</a><a href="#h79-0-191" id="h79-0-191" class="i">+                              GTlsCertificate *cert,
</a><a href="#h79-0-192" id="h79-0-192" class="i">+                              GTlsCertificateFlags err, Client *c);
</a><a href="#h79-0-193" id="h79-0-193" class="i">+static void loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c);
</a><a href="#h79-0-194" id="h79-0-194" class="i">+static void progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c);
</a><a href="#h79-0-195" id="h79-0-195" class="i">+static void titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c);
</a><a href="#h79-0-196" id="h79-0-196" class="i">+static void mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h,
</a><a href="#h79-0-197" id="h79-0-197" class="i">+                               guint modifiers, Client *c);
</a><a href="#h79-0-198" id="h79-0-198" class="i">+static gboolean permissionrequested(WebKitWebView *v,
</a><a href="#h79-0-199" id="h79-0-199" class="i">+                                    WebKitPermissionRequest *r, Client *c);
</a><a href="#h79-0-200" id="h79-0-200" class="i">+static gboolean decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
</a><a href="#h79-0-201" id="h79-0-201" class="i">+                             WebKitPolicyDecisionType dt, Client *c);
</a><a href="#h79-0-202" id="h79-0-202" class="i">+static void decidenavigation(WebKitPolicyDecision *d, Client *c);
</a><a href="#h79-0-203" id="h79-0-203" class="i">+static void decidenewwindow(WebKitPolicyDecision *d, Client *c);
</a><a href="#h79-0-204" id="h79-0-204" class="i">+static void decideresource(WebKitPolicyDecision *d, Client *c);
</a><a href="#h79-0-205" id="h79-0-205" class="i">+static void insecurecontent(WebKitWebView *v, WebKitInsecureContentEvent e,
</a><a href="#h79-0-206" id="h79-0-206" class="i">+                            Client *c);
</a><a href="#h79-0-207" id="h79-0-207" class="i">+static void downloadstarted(WebKitWebContext *wc, WebKitDownload *d,
</a><a href="#h79-0-208" id="h79-0-208" class="i">+                            Client *c);
</a><a href="#h79-0-209" id="h79-0-209" class="i">+static void responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c);
</a><a href="#h79-0-210" id="h79-0-210" class="i">+static void download(Client *c, WebKitURIResponse *r);
</a><a href="#h79-0-211" id="h79-0-211" class="i">+static void webprocessterminated(WebKitWebView *v,
</a><a href="#h79-0-212" id="h79-0-212" class="i">+                                 WebKitWebProcessTerminationReason r,
</a><a href="#h79-0-213" id="h79-0-213" class="i">+                                 Client *c);
</a><a href="#h79-0-214" id="h79-0-214" class="i">+static void closeview(WebKitWebView *v, Client *c);
</a><a href="#h79-0-215" id="h79-0-215" class="i">+static void destroywin(GtkWidget* w, Client *c);
</a><a href="#h79-0-216" id="h79-0-216" class="i">+
</a><a href="#h79-0-217" id="h79-0-217" class="i">+/* Hotkeys */
</a><a href="#h79-0-218" id="h79-0-218" class="i">+static void pasteuri(GtkClipboard *clipboard, const char *text, gpointer d);
</a><a href="#h79-0-219" id="h79-0-219" class="i">+static void reload(Client *c, const Arg *a);
</a><a href="#h79-0-220" id="h79-0-220" class="i">+static void print(Client *c, const Arg *a);
</a><a href="#h79-0-221" id="h79-0-221" class="i">+static void showcert(Client *c, const Arg *a);
</a><a href="#h79-0-222" id="h79-0-222" class="i">+static void clipboard(Client *c, const Arg *a);
</a><a href="#h79-0-223" id="h79-0-223" class="i">+static void zoom(Client *c, const Arg *a);
</a><a href="#h79-0-224" id="h79-0-224" class="i">+static void scrollv(Client *c, const Arg *a);
</a><a href="#h79-0-225" id="h79-0-225" class="i">+static void scrollh(Client *c, const Arg *a);
</a><a href="#h79-0-226" id="h79-0-226" class="i">+static void navigate(Client *c, const Arg *a);
</a><a href="#h79-0-227" id="h79-0-227" class="i">+static void stop(Client *c, const Arg *a);
</a><a href="#h79-0-228" id="h79-0-228" class="i">+static void toggle(Client *c, const Arg *a);
</a><a href="#h79-0-229" id="h79-0-229" class="i">+static void togglefullscreen(Client *c, const Arg *a);
</a><a href="#h79-0-230" id="h79-0-230" class="i">+static void togglecookiepolicy(Client *c, const Arg *a);
</a><a href="#h79-0-231" id="h79-0-231" class="i">+static void toggleinspector(Client *c, const Arg *a);
</a><a href="#h79-0-232" id="h79-0-232" class="i">+static void find(Client *c, const Arg *a);
</a><a href="#h79-0-233" id="h79-0-233" class="i">+
</a><a href="#h79-0-234" id="h79-0-234" class="i">+/* Buttons */
</a><a href="#h79-0-235" id="h79-0-235" class="i">+static void clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h79-0-236" id="h79-0-236" class="i">+static void clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h79-0-237" id="h79-0-237" class="i">+static void clickexternplayer(Client *c, const Arg *a, WebKitHitTestResult *h);
</a><a href="#h79-0-238" id="h79-0-238" class="i">+
</a><a href="#h79-0-239" id="h79-0-239" class="i">+static char winid[64];
</a><a href="#h79-0-240" id="h79-0-240" class="i">+static char togglestats[12];
</a><a href="#h79-0-241" id="h79-0-241" class="i">+static char pagestats[2];
</a><a href="#h79-0-242" id="h79-0-242" class="i">+static Atom atoms[AtomLast];
</a><a href="#h79-0-243" id="h79-0-243" class="i">+static Window embed;
</a><a href="#h79-0-244" id="h79-0-244" class="i">+static int showxid;
</a><a href="#h79-0-245" id="h79-0-245" class="i">+static int cookiepolicy;
</a><a href="#h79-0-246" id="h79-0-246" class="i">+static Display *dpy;
</a><a href="#h79-0-247" id="h79-0-247" class="i">+static Client *clients;
</a><a href="#h79-0-248" id="h79-0-248" class="i">+static GdkDevice *gdkkb;
</a><a href="#h79-0-249" id="h79-0-249" class="i">+static char *stylefile;
</a><a href="#h79-0-250" id="h79-0-250" class="i">+static const char *useragent;
</a><a href="#h79-0-251" id="h79-0-251" class="i">+static Parameter *curconfig;
</a><a href="#h79-0-252" id="h79-0-252" class="i">+static int modparams[ParameterLast];
</a><a href="#h79-0-253" id="h79-0-253" class="i">+static int pipein[2], pipeout[2];
</a><a href="#h79-0-254" id="h79-0-254" class="i">+char *argv0;
</a><a href="#h79-0-255" id="h79-0-255" class="i">+
</a><a href="#h79-0-256" id="h79-0-256" class="i">+static ParamName loadtransient[] = {
</a><a href="#h79-0-257" id="h79-0-257" class="i">+	Certificate,
</a><a href="#h79-0-258" id="h79-0-258" class="i">+	CookiePolicies,
</a><a href="#h79-0-259" id="h79-0-259" class="i">+	DiskCache,
</a><a href="#h79-0-260" id="h79-0-260" class="i">+	DNSPrefetch,
</a><a href="#h79-0-261" id="h79-0-261" class="i">+	FileURLsCrossAccess,
</a><a href="#h79-0-262" id="h79-0-262" class="i">+	JavaScript,
</a><a href="#h79-0-263" id="h79-0-263" class="i">+	LoadImages,
</a><a href="#h79-0-264" id="h79-0-264" class="i">+	PreferredLanguages,
</a><a href="#h79-0-265" id="h79-0-265" class="i">+	ShowIndicators,
</a><a href="#h79-0-266" id="h79-0-266" class="i">+	StrictTLS,
</a><a href="#h79-0-267" id="h79-0-267" class="i">+	ParameterLast
</a><a href="#h79-0-268" id="h79-0-268" class="i">+};
</a><a href="#h79-0-269" id="h79-0-269" class="i">+
</a><a href="#h79-0-270" id="h79-0-270" class="i">+static ParamName loadcommitted[] = {
</a><a href="#h79-0-271" id="h79-0-271" class="i">+	AcceleratedCanvas,
</a><a href="#h79-0-272" id="h79-0-272" class="i">+//	AccessMicrophone,
</a><a href="#h79-0-273" id="h79-0-273" class="i">+//	AccessWebcam,
</a><a href="#h79-0-274" id="h79-0-274" class="i">+	CaretBrowsing,
</a><a href="#h79-0-275" id="h79-0-275" class="i">+	DefaultCharset,
</a><a href="#h79-0-276" id="h79-0-276" class="i">+	FontSize,
</a><a href="#h79-0-277" id="h79-0-277" class="i">+	FrameFlattening,
</a><a href="#h79-0-278" id="h79-0-278" class="i">+	Geolocation,
</a><a href="#h79-0-279" id="h79-0-279" class="i">+	HideBackground,
</a><a href="#h79-0-280" id="h79-0-280" class="i">+	Inspector,
</a><a href="#h79-0-281" id="h79-0-281" class="i">+	Java,
</a><a href="#h79-0-282" id="h79-0-282" class="i">+//	KioskMode,
</a><a href="#h79-0-283" id="h79-0-283" class="i">+	MediaManualPlay,
</a><a href="#h79-0-284" id="h79-0-284" class="i">+	Plugins,
</a><a href="#h79-0-285" id="h79-0-285" class="i">+	RunInFullscreen,
</a><a href="#h79-0-286" id="h79-0-286" class="i">+	ScrollBars,
</a><a href="#h79-0-287" id="h79-0-287" class="i">+	SiteQuirks,
</a><a href="#h79-0-288" id="h79-0-288" class="i">+	SmoothScrolling,
</a><a href="#h79-0-289" id="h79-0-289" class="i">+	SpellChecking,
</a><a href="#h79-0-290" id="h79-0-290" class="i">+	SpellLanguages,
</a><a href="#h79-0-291" id="h79-0-291" class="i">+	Style,
</a><a href="#h79-0-292" id="h79-0-292" class="i">+	ZoomLevel,
</a><a href="#h79-0-293" id="h79-0-293" class="i">+	ParameterLast
</a><a href="#h79-0-294" id="h79-0-294" class="i">+};
</a><a href="#h79-0-295" id="h79-0-295" class="i">+
</a><a href="#h79-0-296" id="h79-0-296" class="i">+static ParamName loadfinished[] = {
</a><a href="#h79-0-297" id="h79-0-297" class="i">+	ParameterLast
</a><a href="#h79-0-298" id="h79-0-298" class="i">+};
</a><a href="#h79-0-299" id="h79-0-299" class="i">+
</a><a href="#h79-0-300" id="h79-0-300" class="i">+/* configuration, allows nested code to access above variables */
</a><a href="#h79-0-301" id="h79-0-301" class="i">+#include &quot;config.h&quot;
</a><a href="#h79-0-302" id="h79-0-302" class="i">+
</a><a href="#h79-0-303" id="h79-0-303" class="i">+void
</a><a href="#h79-0-304" id="h79-0-304" class="i">+usage(void)
</a><a href="#h79-0-305" id="h79-0-305" class="i">+{
</a><a href="#h79-0-306" id="h79-0-306" class="i">+	die(&quot;usage: surf [-bBdDfFgGiIkKmMnNpPsStTvwxX]\n&quot;
</a><a href="#h79-0-307" id="h79-0-307" class="i">+	    &quot;[-a cookiepolicies ] [-c cookiefile] [-C stylefile] [-e xid]\n&quot;
</a><a href="#h79-0-308" id="h79-0-308" class="i">+	    &quot;[-r scriptfile] [-u useragent] [-z zoomlevel] [uri]\n&quot;);
</a><a href="#h79-0-309" id="h79-0-309" class="i">+}
</a><a href="#h79-0-310" id="h79-0-310" class="i">+
</a><a href="#h79-0-311" id="h79-0-311" class="i">+void
</a><a href="#h79-0-312" id="h79-0-312" class="i">+setup(void)
</a><a href="#h79-0-313" id="h79-0-313" class="i">+{
</a><a href="#h79-0-314" id="h79-0-314" class="i">+	GIOChannel *gchanin;
</a><a href="#h79-0-315" id="h79-0-315" class="i">+	GdkDisplay *gdpy;
</a><a href="#h79-0-316" id="h79-0-316" class="i">+	int i, j;
</a><a href="#h79-0-317" id="h79-0-317" class="i">+
</a><a href="#h79-0-318" id="h79-0-318" class="i">+	/* clean up any zombies immediately */
</a><a href="#h79-0-319" id="h79-0-319" class="i">+	sigchld(0);
</a><a href="#h79-0-320" id="h79-0-320" class="i">+	if (signal(SIGHUP, sighup) == SIG_ERR)
</a><a href="#h79-0-321" id="h79-0-321" class="i">+		die(&quot;Can&#39;t install SIGHUP handler&quot;);
</a><a href="#h79-0-322" id="h79-0-322" class="i">+
</a><a href="#h79-0-323" id="h79-0-323" class="i">+	if (!(dpy = XOpenDisplay(NULL)))
</a><a href="#h79-0-324" id="h79-0-324" class="i">+		die(&quot;Can&#39;t open default display&quot;);
</a><a href="#h79-0-325" id="h79-0-325" class="i">+
</a><a href="#h79-0-326" id="h79-0-326" class="i">+	/* atoms */
</a><a href="#h79-0-327" id="h79-0-327" class="i">+	atoms[AtomFind] = XInternAtom(dpy, &quot;_SURF_FIND&quot;, False);
</a><a href="#h79-0-328" id="h79-0-328" class="i">+	atoms[AtomGo] = XInternAtom(dpy, &quot;_SURF_GO&quot;, False);
</a><a href="#h79-0-329" id="h79-0-329" class="i">+	atoms[AtomUri] = XInternAtom(dpy, &quot;_SURF_URI&quot;, False);
</a><a href="#h79-0-330" id="h79-0-330" class="i">+
</a><a href="#h79-0-331" id="h79-0-331" class="i">+	gtk_init(NULL, NULL);
</a><a href="#h79-0-332" id="h79-0-332" class="i">+
</a><a href="#h79-0-333" id="h79-0-333" class="i">+	gdpy = gdk_display_get_default();
</a><a href="#h79-0-334" id="h79-0-334" class="i">+
</a><a href="#h79-0-335" id="h79-0-335" class="i">+	curconfig = defconfig;
</a><a href="#h79-0-336" id="h79-0-336" class="i">+
</a><a href="#h79-0-337" id="h79-0-337" class="i">+	/* dirs and files */
</a><a href="#h79-0-338" id="h79-0-338" class="i">+	cookiefile = buildfile(cookiefile);
</a><a href="#h79-0-339" id="h79-0-339" class="i">+	scriptfile = buildfile(scriptfile);
</a><a href="#h79-0-340" id="h79-0-340" class="i">+	cachedir   = buildpath(cachedir);
</a><a href="#h79-0-341" id="h79-0-341" class="i">+	certdir    = buildpath(certdir);
</a><a href="#h79-0-342" id="h79-0-342" class="i">+
</a><a href="#h79-0-343" id="h79-0-343" class="i">+	gdkkb = gdk_seat_get_keyboard(gdk_display_get_default_seat(gdpy));
</a><a href="#h79-0-344" id="h79-0-344" class="i">+
</a><a href="#h79-0-345" id="h79-0-345" class="i">+	if (pipe(pipeout) &lt; 0 || pipe(pipein) &lt; 0) {
</a><a href="#h79-0-346" id="h79-0-346" class="i">+		fputs(&quot;Unable to create pipes\n&quot;, stderr);
</a><a href="#h79-0-347" id="h79-0-347" class="i">+	} else {
</a><a href="#h79-0-348" id="h79-0-348" class="i">+		gchanin = g_io_channel_unix_new(pipein[0]);
</a><a href="#h79-0-349" id="h79-0-349" class="i">+		g_io_channel_set_encoding(gchanin, NULL, NULL);
</a><a href="#h79-0-350" id="h79-0-350" class="i">+		g_io_channel_set_close_on_unref(gchanin, TRUE);
</a><a href="#h79-0-351" id="h79-0-351" class="i">+		g_io_add_watch(gchanin, G_IO_IN, readpipe, NULL);
</a><a href="#h79-0-352" id="h79-0-352" class="i">+	}
</a><a href="#h79-0-353" id="h79-0-353" class="i">+
</a><a href="#h79-0-354" id="h79-0-354" class="i">+
</a><a href="#h79-0-355" id="h79-0-355" class="i">+	for (i = 0; i &lt; LENGTH(certs); ++i) {
</a><a href="#h79-0-356" id="h79-0-356" class="i">+		if (!regcomp(&amp;(certs[i].re), certs[i].regex, REG_EXTENDED)) {
</a><a href="#h79-0-357" id="h79-0-357" class="i">+			certs[i].file = g_strconcat(certdir, &quot;/&quot;, certs[i].file,
</a><a href="#h79-0-358" id="h79-0-358" class="i">+			                            NULL);
</a><a href="#h79-0-359" id="h79-0-359" class="i">+		} else {
</a><a href="#h79-0-360" id="h79-0-360" class="i">+			fprintf(stderr, &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h79-0-361" id="h79-0-361" class="i">+			        certs[i].regex);
</a><a href="#h79-0-362" id="h79-0-362" class="i">+			certs[i].regex = NULL;
</a><a href="#h79-0-363" id="h79-0-363" class="i">+		}
</a><a href="#h79-0-364" id="h79-0-364" class="i">+	}
</a><a href="#h79-0-365" id="h79-0-365" class="i">+
</a><a href="#h79-0-366" id="h79-0-366" class="i">+	if (!stylefile) {
</a><a href="#h79-0-367" id="h79-0-367" class="i">+		styledir = buildpath(styledir);
</a><a href="#h79-0-368" id="h79-0-368" class="i">+		for (i = 0; i &lt; LENGTH(styles); ++i) {
</a><a href="#h79-0-369" id="h79-0-369" class="i">+			if (!regcomp(&amp;(styles[i].re), styles[i].regex,
</a><a href="#h79-0-370" id="h79-0-370" class="i">+			    REG_EXTENDED)) {
</a><a href="#h79-0-371" id="h79-0-371" class="i">+				styles[i].file = g_strconcat(styledir, &quot;/&quot;,
</a><a href="#h79-0-372" id="h79-0-372" class="i">+				                    styles[i].file, NULL);
</a><a href="#h79-0-373" id="h79-0-373" class="i">+			} else {
</a><a href="#h79-0-374" id="h79-0-374" class="i">+				fprintf(stderr, &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h79-0-375" id="h79-0-375" class="i">+				        styles[i].regex);
</a><a href="#h79-0-376" id="h79-0-376" class="i">+				styles[i].regex = NULL;
</a><a href="#h79-0-377" id="h79-0-377" class="i">+			}
</a><a href="#h79-0-378" id="h79-0-378" class="i">+		}
</a><a href="#h79-0-379" id="h79-0-379" class="i">+		g_free(styledir);
</a><a href="#h79-0-380" id="h79-0-380" class="i">+	} else {
</a><a href="#h79-0-381" id="h79-0-381" class="i">+		stylefile = buildfile(stylefile);
</a><a href="#h79-0-382" id="h79-0-382" class="i">+	}
</a><a href="#h79-0-383" id="h79-0-383" class="i">+
</a><a href="#h79-0-384" id="h79-0-384" class="i">+	for (i = 0; i &lt; LENGTH(uriparams); ++i) {
</a><a href="#h79-0-385" id="h79-0-385" class="i">+		if (regcomp(&amp;(uriparams[i].re), uriparams[i].uri,
</a><a href="#h79-0-386" id="h79-0-386" class="i">+		    REG_EXTENDED)) {
</a><a href="#h79-0-387" id="h79-0-387" class="i">+			fprintf(stderr, &quot;Could not compile regex: %s\n&quot;,
</a><a href="#h79-0-388" id="h79-0-388" class="i">+			        uriparams[i].uri);
</a><a href="#h79-0-389" id="h79-0-389" class="i">+			uriparams[i].uri = NULL;
</a><a href="#h79-0-390" id="h79-0-390" class="i">+			continue;
</a><a href="#h79-0-391" id="h79-0-391" class="i">+		}
</a><a href="#h79-0-392" id="h79-0-392" class="i">+
</a><a href="#h79-0-393" id="h79-0-393" class="i">+		/* copy default parameters with higher priority */
</a><a href="#h79-0-394" id="h79-0-394" class="i">+		for (j = 0; j &lt; ParameterLast; ++j) {
</a><a href="#h79-0-395" id="h79-0-395" class="i">+			if (defconfig[j].prio &gt;= uriparams[i].config[j].prio)
</a><a href="#h79-0-396" id="h79-0-396" class="i">+				uriparams[i].config[j] = defconfig[j];
</a><a href="#h79-0-397" id="h79-0-397" class="i">+		}
</a><a href="#h79-0-398" id="h79-0-398" class="i">+	}
</a><a href="#h79-0-399" id="h79-0-399" class="i">+}
</a><a href="#h79-0-400" id="h79-0-400" class="i">+
</a><a href="#h79-0-401" id="h79-0-401" class="i">+void
</a><a href="#h79-0-402" id="h79-0-402" class="i">+sigchld(int unused)
</a><a href="#h79-0-403" id="h79-0-403" class="i">+{
</a><a href="#h79-0-404" id="h79-0-404" class="i">+	if (signal(SIGCHLD, sigchld) == SIG_ERR)
</a><a href="#h79-0-405" id="h79-0-405" class="i">+		die(&quot;Can&#39;t install SIGCHLD handler&quot;);
</a><a href="#h79-0-406" id="h79-0-406" class="i">+	while (waitpid(-1, NULL, WNOHANG) &gt; 0)
</a><a href="#h79-0-407" id="h79-0-407" class="i">+		;
</a><a href="#h79-0-408" id="h79-0-408" class="i">+}
</a><a href="#h79-0-409" id="h79-0-409" class="i">+
</a><a href="#h79-0-410" id="h79-0-410" class="i">+void
</a><a href="#h79-0-411" id="h79-0-411" class="i">+sighup(int unused)
</a><a href="#h79-0-412" id="h79-0-412" class="i">+{
</a><a href="#h79-0-413" id="h79-0-413" class="i">+	Arg a = { .i = 0 };
</a><a href="#h79-0-414" id="h79-0-414" class="i">+	Client *c;
</a><a href="#h79-0-415" id="h79-0-415" class="i">+
</a><a href="#h79-0-416" id="h79-0-416" class="i">+	for (c = clients; c; c = c-&gt;next)
</a><a href="#h79-0-417" id="h79-0-417" class="i">+		reload(c, &amp;a);
</a><a href="#h79-0-418" id="h79-0-418" class="i">+}
</a><a href="#h79-0-419" id="h79-0-419" class="i">+
</a><a href="#h79-0-420" id="h79-0-420" class="i">+char *
</a><a href="#h79-0-421" id="h79-0-421" class="i">+buildfile(const char *path)
</a><a href="#h79-0-422" id="h79-0-422" class="i">+{
</a><a href="#h79-0-423" id="h79-0-423" class="i">+	char *dname, *bname, *bpath, *fpath;
</a><a href="#h79-0-424" id="h79-0-424" class="i">+	FILE *f;
</a><a href="#h79-0-425" id="h79-0-425" class="i">+
</a><a href="#h79-0-426" id="h79-0-426" class="i">+	dname = g_path_get_dirname(path);
</a><a href="#h79-0-427" id="h79-0-427" class="i">+	bname = g_path_get_basename(path);
</a><a href="#h79-0-428" id="h79-0-428" class="i">+
</a><a href="#h79-0-429" id="h79-0-429" class="i">+	bpath = buildpath(dname);
</a><a href="#h79-0-430" id="h79-0-430" class="i">+	g_free(dname);
</a><a href="#h79-0-431" id="h79-0-431" class="i">+
</a><a href="#h79-0-432" id="h79-0-432" class="i">+	fpath = g_build_filename(bpath, bname, NULL);
</a><a href="#h79-0-433" id="h79-0-433" class="i">+	g_free(bpath);
</a><a href="#h79-0-434" id="h79-0-434" class="i">+	g_free(bname);
</a><a href="#h79-0-435" id="h79-0-435" class="i">+
</a><a href="#h79-0-436" id="h79-0-436" class="i">+	if (!(f = fopen(fpath, &quot;a&quot;)))
</a><a href="#h79-0-437" id="h79-0-437" class="i">+		die(&quot;Could not open file: %s\n&quot;, fpath);
</a><a href="#h79-0-438" id="h79-0-438" class="i">+
</a><a href="#h79-0-439" id="h79-0-439" class="i">+	g_chmod(fpath, 0600); /* always */
</a><a href="#h79-0-440" id="h79-0-440" class="i">+	fclose(f);
</a><a href="#h79-0-441" id="h79-0-441" class="i">+
</a><a href="#h79-0-442" id="h79-0-442" class="i">+	return fpath;
</a><a href="#h79-0-443" id="h79-0-443" class="i">+}
</a><a href="#h79-0-444" id="h79-0-444" class="i">+
</a><a href="#h79-0-445" id="h79-0-445" class="i">+static const char*
</a><a href="#h79-0-446" id="h79-0-446" class="i">+getuserhomedir(const char *user)
</a><a href="#h79-0-447" id="h79-0-447" class="i">+{
</a><a href="#h79-0-448" id="h79-0-448" class="i">+	struct passwd *pw = getpwnam(user);
</a><a href="#h79-0-449" id="h79-0-449" class="i">+
</a><a href="#h79-0-450" id="h79-0-450" class="i">+	if (!pw)
</a><a href="#h79-0-451" id="h79-0-451" class="i">+		die(&quot;Can&#39;t get user %s login information.\n&quot;, user);
</a><a href="#h79-0-452" id="h79-0-452" class="i">+
</a><a href="#h79-0-453" id="h79-0-453" class="i">+	return pw-&gt;pw_dir;
</a><a href="#h79-0-454" id="h79-0-454" class="i">+}
</a><a href="#h79-0-455" id="h79-0-455" class="i">+
</a><a href="#h79-0-456" id="h79-0-456" class="i">+static const char*
</a><a href="#h79-0-457" id="h79-0-457" class="i">+getcurrentuserhomedir(void)
</a><a href="#h79-0-458" id="h79-0-458" class="i">+{
</a><a href="#h79-0-459" id="h79-0-459" class="i">+	const char *homedir;
</a><a href="#h79-0-460" id="h79-0-460" class="i">+	const char *user;
</a><a href="#h79-0-461" id="h79-0-461" class="i">+	struct passwd *pw;
</a><a href="#h79-0-462" id="h79-0-462" class="i">+
</a><a href="#h79-0-463" id="h79-0-463" class="i">+	homedir = getenv(&quot;HOME&quot;);
</a><a href="#h79-0-464" id="h79-0-464" class="i">+	if (homedir)
</a><a href="#h79-0-465" id="h79-0-465" class="i">+		return homedir;
</a><a href="#h79-0-466" id="h79-0-466" class="i">+
</a><a href="#h79-0-467" id="h79-0-467" class="i">+	user = getenv(&quot;USER&quot;);
</a><a href="#h79-0-468" id="h79-0-468" class="i">+	if (user)
</a><a href="#h79-0-469" id="h79-0-469" class="i">+		return getuserhomedir(user);
</a><a href="#h79-0-470" id="h79-0-470" class="i">+
</a><a href="#h79-0-471" id="h79-0-471" class="i">+	pw = getpwuid(getuid());
</a><a href="#h79-0-472" id="h79-0-472" class="i">+	if (!pw)
</a><a href="#h79-0-473" id="h79-0-473" class="i">+		die(&quot;Can&#39;t get current user home directory\n&quot;);
</a><a href="#h79-0-474" id="h79-0-474" class="i">+
</a><a href="#h79-0-475" id="h79-0-475" class="i">+	return pw-&gt;pw_dir;
</a><a href="#h79-0-476" id="h79-0-476" class="i">+}
</a><a href="#h79-0-477" id="h79-0-477" class="i">+
</a><a href="#h79-0-478" id="h79-0-478" class="i">+char *
</a><a href="#h79-0-479" id="h79-0-479" class="i">+buildpath(const char *path)
</a><a href="#h79-0-480" id="h79-0-480" class="i">+{
</a><a href="#h79-0-481" id="h79-0-481" class="i">+	char *apath, *fpath;
</a><a href="#h79-0-482" id="h79-0-482" class="i">+
</a><a href="#h79-0-483" id="h79-0-483" class="i">+	if (path[0] == &#39;~&#39;)
</a><a href="#h79-0-484" id="h79-0-484" class="i">+		apath = untildepath(path);
</a><a href="#h79-0-485" id="h79-0-485" class="i">+	else
</a><a href="#h79-0-486" id="h79-0-486" class="i">+		apath = g_strdup(path);
</a><a href="#h79-0-487" id="h79-0-487" class="i">+
</a><a href="#h79-0-488" id="h79-0-488" class="i">+	/* creating directory */
</a><a href="#h79-0-489" id="h79-0-489" class="i">+	if (g_mkdir_with_parents(apath, 0700) &lt; 0)
</a><a href="#h79-0-490" id="h79-0-490" class="i">+		die(&quot;Could not access directory: %s\n&quot;, apath);
</a><a href="#h79-0-491" id="h79-0-491" class="i">+
</a><a href="#h79-0-492" id="h79-0-492" class="i">+	fpath = realpath(apath, NULL);
</a><a href="#h79-0-493" id="h79-0-493" class="i">+	g_free(apath);
</a><a href="#h79-0-494" id="h79-0-494" class="i">+
</a><a href="#h79-0-495" id="h79-0-495" class="i">+	return fpath;
</a><a href="#h79-0-496" id="h79-0-496" class="i">+}
</a><a href="#h79-0-497" id="h79-0-497" class="i">+
</a><a href="#h79-0-498" id="h79-0-498" class="i">+char *
</a><a href="#h79-0-499" id="h79-0-499" class="i">+untildepath(const char *path)
</a><a href="#h79-0-500" id="h79-0-500" class="i">+{
</a><a href="#h79-0-501" id="h79-0-501" class="i">+       char *apath, *name, *p;
</a><a href="#h79-0-502" id="h79-0-502" class="i">+       const char *homedir;
</a><a href="#h79-0-503" id="h79-0-503" class="i">+
</a><a href="#h79-0-504" id="h79-0-504" class="i">+       if (path[1] == &#39;/&#39; || path[1] == &#39;\0&#39;) {
</a><a href="#h79-0-505" id="h79-0-505" class="i">+               p = (char *)&amp;path[1];
</a><a href="#h79-0-506" id="h79-0-506" class="i">+               homedir = getcurrentuserhomedir();
</a><a href="#h79-0-507" id="h79-0-507" class="i">+       } else {
</a><a href="#h79-0-508" id="h79-0-508" class="i">+               if ((p = strchr(path, &#39;/&#39;)))
</a><a href="#h79-0-509" id="h79-0-509" class="i">+                       name = g_strndup(&amp;path[1], p - (path + 1));
</a><a href="#h79-0-510" id="h79-0-510" class="i">+               else
</a><a href="#h79-0-511" id="h79-0-511" class="i">+                       name = g_strdup(&amp;path[1]);
</a><a href="#h79-0-512" id="h79-0-512" class="i">+
</a><a href="#h79-0-513" id="h79-0-513" class="i">+               homedir = getuserhomedir(name);
</a><a href="#h79-0-514" id="h79-0-514" class="i">+               g_free(name);
</a><a href="#h79-0-515" id="h79-0-515" class="i">+       }
</a><a href="#h79-0-516" id="h79-0-516" class="i">+       apath = g_build_filename(homedir, p, NULL);
</a><a href="#h79-0-517" id="h79-0-517" class="i">+       return apath;
</a><a href="#h79-0-518" id="h79-0-518" class="i">+}
</a><a href="#h79-0-519" id="h79-0-519" class="i">+
</a><a href="#h79-0-520" id="h79-0-520" class="i">+Client *
</a><a href="#h79-0-521" id="h79-0-521" class="i">+newclient(Client *rc)
</a><a href="#h79-0-522" id="h79-0-522" class="i">+{
</a><a href="#h79-0-523" id="h79-0-523" class="i">+	Client *c;
</a><a href="#h79-0-524" id="h79-0-524" class="i">+
</a><a href="#h79-0-525" id="h79-0-525" class="i">+	if (!(c = calloc(1, sizeof(Client))))
</a><a href="#h79-0-526" id="h79-0-526" class="i">+		die(&quot;Cannot malloc!\n&quot;);
</a><a href="#h79-0-527" id="h79-0-527" class="i">+
</a><a href="#h79-0-528" id="h79-0-528" class="i">+	c-&gt;next = clients;
</a><a href="#h79-0-529" id="h79-0-529" class="i">+	clients = c;
</a><a href="#h79-0-530" id="h79-0-530" class="i">+
</a><a href="#h79-0-531" id="h79-0-531" class="i">+	c-&gt;progress = 100;
</a><a href="#h79-0-532" id="h79-0-532" class="i">+	c-&gt;view = newview(c, rc ? rc-&gt;view : NULL);
</a><a href="#h79-0-533" id="h79-0-533" class="i">+
</a><a href="#h79-0-534" id="h79-0-534" class="i">+	return c;
</a><a href="#h79-0-535" id="h79-0-535" class="i">+}
</a><a href="#h79-0-536" id="h79-0-536" class="i">+
</a><a href="#h79-0-537" id="h79-0-537" class="i">+void
</a><a href="#h79-0-538" id="h79-0-538" class="i">+loaduri(Client *c, const Arg *a)
</a><a href="#h79-0-539" id="h79-0-539" class="i">+{
</a><a href="#h79-0-540" id="h79-0-540" class="i">+	struct stat st;
</a><a href="#h79-0-541" id="h79-0-541" class="i">+	char *url, *path, *apath;
</a><a href="#h79-0-542" id="h79-0-542" class="i">+	const char *uri = a-&gt;v;
</a><a href="#h79-0-543" id="h79-0-543" class="i">+
</a><a href="#h79-0-544" id="h79-0-544" class="i">+	if (g_strcmp0(uri, &quot;&quot;) == 0)
</a><a href="#h79-0-545" id="h79-0-545" class="i">+		return;
</a><a href="#h79-0-546" id="h79-0-546" class="i">+
</a><a href="#h79-0-547" id="h79-0-547" class="i">+	if (g_str_has_prefix(uri, &quot;http://&quot;)  ||
</a><a href="#h79-0-548" id="h79-0-548" class="i">+	    g_str_has_prefix(uri, &quot;https://&quot;) ||
</a><a href="#h79-0-549" id="h79-0-549" class="i">+	    g_str_has_prefix(uri, &quot;file://&quot;)  ||
</a><a href="#h79-0-550" id="h79-0-550" class="i">+	    g_str_has_prefix(uri, &quot;about:&quot;)) {
</a><a href="#h79-0-551" id="h79-0-551" class="i">+		url = g_strdup(uri);
</a><a href="#h79-0-552" id="h79-0-552" class="i">+	} else {
</a><a href="#h79-0-553" id="h79-0-553" class="i">+		if (uri[0] == &#39;~&#39;)
</a><a href="#h79-0-554" id="h79-0-554" class="i">+			apath = untildepath(uri);
</a><a href="#h79-0-555" id="h79-0-555" class="i">+		else
</a><a href="#h79-0-556" id="h79-0-556" class="i">+			apath = (char *)uri;
</a><a href="#h79-0-557" id="h79-0-557" class="i">+		if (!stat(apath, &amp;st) &amp;&amp; (path = realpath(apath, NULL))) {
</a><a href="#h79-0-558" id="h79-0-558" class="i">+			url = g_strdup_printf(&quot;file://%s&quot;, path);
</a><a href="#h79-0-559" id="h79-0-559" class="i">+			free(path);
</a><a href="#h79-0-560" id="h79-0-560" class="i">+		} else {
</a><a href="#h79-0-561" id="h79-0-561" class="i">+			url = g_strdup_printf(&quot;http://%s&quot;, uri);
</a><a href="#h79-0-562" id="h79-0-562" class="i">+		}
</a><a href="#h79-0-563" id="h79-0-563" class="i">+		if (apath != uri)
</a><a href="#h79-0-564" id="h79-0-564" class="i">+			free(apath);
</a><a href="#h79-0-565" id="h79-0-565" class="i">+	}
</a><a href="#h79-0-566" id="h79-0-566" class="i">+
</a><a href="#h79-0-567" id="h79-0-567" class="i">+	setatom(c, AtomUri, url);
</a><a href="#h79-0-568" id="h79-0-568" class="i">+
</a><a href="#h79-0-569" id="h79-0-569" class="i">+	if (strcmp(url, geturi(c)) == 0) {
</a><a href="#h79-0-570" id="h79-0-570" class="i">+		reload(c, a);
</a><a href="#h79-0-571" id="h79-0-571" class="i">+	} else {
</a><a href="#h79-0-572" id="h79-0-572" class="i">+		webkit_web_view_load_uri(c-&gt;view, url);
</a><a href="#h79-0-573" id="h79-0-573" class="i">+		updatetitle(c);
</a><a href="#h79-0-574" id="h79-0-574" class="i">+	}
</a><a href="#h79-0-575" id="h79-0-575" class="i">+
</a><a href="#h79-0-576" id="h79-0-576" class="i">+	g_free(url);
</a><a href="#h79-0-577" id="h79-0-577" class="i">+}
</a><a href="#h79-0-578" id="h79-0-578" class="i">+
</a><a href="#h79-0-579" id="h79-0-579" class="i">+const char *
</a><a href="#h79-0-580" id="h79-0-580" class="i">+geturi(Client *c)
</a><a href="#h79-0-581" id="h79-0-581" class="i">+{
</a><a href="#h79-0-582" id="h79-0-582" class="i">+	const char *uri;
</a><a href="#h79-0-583" id="h79-0-583" class="i">+
</a><a href="#h79-0-584" id="h79-0-584" class="i">+	if (!(uri = webkit_web_view_get_uri(c-&gt;view)))
</a><a href="#h79-0-585" id="h79-0-585" class="i">+		uri = &quot;about:blank&quot;;
</a><a href="#h79-0-586" id="h79-0-586" class="i">+	return uri;
</a><a href="#h79-0-587" id="h79-0-587" class="i">+}
</a><a href="#h79-0-588" id="h79-0-588" class="i">+
</a><a href="#h79-0-589" id="h79-0-589" class="i">+void
</a><a href="#h79-0-590" id="h79-0-590" class="i">+setatom(Client *c, int a, const char *v)
</a><a href="#h79-0-591" id="h79-0-591" class="i">+{
</a><a href="#h79-0-592" id="h79-0-592" class="i">+	XChangeProperty(dpy, c-&gt;xid,
</a><a href="#h79-0-593" id="h79-0-593" class="i">+	                atoms[a], XA_STRING, 8, PropModeReplace,
</a><a href="#h79-0-594" id="h79-0-594" class="i">+	                (unsigned char *)v, strlen(v) + 1);
</a><a href="#h79-0-595" id="h79-0-595" class="i">+	XSync(dpy, False);
</a><a href="#h79-0-596" id="h79-0-596" class="i">+}
</a><a href="#h79-0-597" id="h79-0-597" class="i">+
</a><a href="#h79-0-598" id="h79-0-598" class="i">+const char *
</a><a href="#h79-0-599" id="h79-0-599" class="i">+getatom(Client *c, int a)
</a><a href="#h79-0-600" id="h79-0-600" class="i">+{
</a><a href="#h79-0-601" id="h79-0-601" class="i">+	static char buf[BUFSIZ];
</a><a href="#h79-0-602" id="h79-0-602" class="i">+	Atom adummy;
</a><a href="#h79-0-603" id="h79-0-603" class="i">+	int idummy;
</a><a href="#h79-0-604" id="h79-0-604" class="i">+	unsigned long ldummy;
</a><a href="#h79-0-605" id="h79-0-605" class="i">+	unsigned char *p = NULL;
</a><a href="#h79-0-606" id="h79-0-606" class="i">+
</a><a href="#h79-0-607" id="h79-0-607" class="i">+	XSync(dpy, False);
</a><a href="#h79-0-608" id="h79-0-608" class="i">+	XGetWindowProperty(dpy, c-&gt;xid, atoms[a], 0L, BUFSIZ, False, XA_STRING,
</a><a href="#h79-0-609" id="h79-0-609" class="i">+	                   &amp;adummy, &amp;idummy, &amp;ldummy, &amp;ldummy, &amp;p);
</a><a href="#h79-0-610" id="h79-0-610" class="i">+	if (p)
</a><a href="#h79-0-611" id="h79-0-611" class="i">+		strncpy(buf, (char *)p, LENGTH(buf) - 1);
</a><a href="#h79-0-612" id="h79-0-612" class="i">+	else
</a><a href="#h79-0-613" id="h79-0-613" class="i">+		buf[0] = &#39;\0&#39;;
</a><a href="#h79-0-614" id="h79-0-614" class="i">+	XFree(p);
</a><a href="#h79-0-615" id="h79-0-615" class="i">+
</a><a href="#h79-0-616" id="h79-0-616" class="i">+	return buf;
</a><a href="#h79-0-617" id="h79-0-617" class="i">+}
</a><a href="#h79-0-618" id="h79-0-618" class="i">+
</a><a href="#h79-0-619" id="h79-0-619" class="i">+void
</a><a href="#h79-0-620" id="h79-0-620" class="i">+updatetitle(Client *c)
</a><a href="#h79-0-621" id="h79-0-621" class="i">+{
</a><a href="#h79-0-622" id="h79-0-622" class="i">+	char *title;
</a><a href="#h79-0-623" id="h79-0-623" class="i">+	const char *name = c-&gt;overtitle ? c-&gt;overtitle :
</a><a href="#h79-0-624" id="h79-0-624" class="i">+	                   c-&gt;title ? c-&gt;title : &quot;&quot;;
</a><a href="#h79-0-625" id="h79-0-625" class="i">+
</a><a href="#h79-0-626" id="h79-0-626" class="i">+	if (curconfig[ShowIndicators].val.i) {
</a><a href="#h79-0-627" id="h79-0-627" class="i">+		gettogglestats(c);
</a><a href="#h79-0-628" id="h79-0-628" class="i">+		getpagestats(c);
</a><a href="#h79-0-629" id="h79-0-629" class="i">+
</a><a href="#h79-0-630" id="h79-0-630" class="i">+		if (c-&gt;progress != 100)
</a><a href="#h79-0-631" id="h79-0-631" class="i">+			title = g_strdup_printf(&quot;[%i%%] %s:%s | %s&quot;,
</a><a href="#h79-0-632" id="h79-0-632" class="i">+			        c-&gt;progress, togglestats, pagestats, name);
</a><a href="#h79-0-633" id="h79-0-633" class="i">+		else
</a><a href="#h79-0-634" id="h79-0-634" class="i">+			title = g_strdup_printf(&quot;%s:%s | %s&quot;,
</a><a href="#h79-0-635" id="h79-0-635" class="i">+			        togglestats, pagestats, name);
</a><a href="#h79-0-636" id="h79-0-636" class="i">+
</a><a href="#h79-0-637" id="h79-0-637" class="i">+		gtk_window_set_title(GTK_WINDOW(c-&gt;win), title);
</a><a href="#h79-0-638" id="h79-0-638" class="i">+		g_free(title);
</a><a href="#h79-0-639" id="h79-0-639" class="i">+	} else {
</a><a href="#h79-0-640" id="h79-0-640" class="i">+		gtk_window_set_title(GTK_WINDOW(c-&gt;win), name);
</a><a href="#h79-0-641" id="h79-0-641" class="i">+	}
</a><a href="#h79-0-642" id="h79-0-642" class="i">+}
</a><a href="#h79-0-643" id="h79-0-643" class="i">+
</a><a href="#h79-0-644" id="h79-0-644" class="i">+void
</a><a href="#h79-0-645" id="h79-0-645" class="i">+gettogglestats(Client *c)
</a><a href="#h79-0-646" id="h79-0-646" class="i">+{
</a><a href="#h79-0-647" id="h79-0-647" class="i">+	togglestats[0] = cookiepolicy_set(cookiepolicy_get());
</a><a href="#h79-0-648" id="h79-0-648" class="i">+	togglestats[1] = curconfig[CaretBrowsing].val.i ?   &#39;C&#39; : &#39;c&#39;;
</a><a href="#h79-0-649" id="h79-0-649" class="i">+	togglestats[2] = curconfig[Geolocation].val.i ?     &#39;G&#39; : &#39;g&#39;;
</a><a href="#h79-0-650" id="h79-0-650" class="i">+	togglestats[3] = curconfig[DiskCache].val.i ?       &#39;D&#39; : &#39;d&#39;;
</a><a href="#h79-0-651" id="h79-0-651" class="i">+	togglestats[4] = curconfig[LoadImages].val.i ?      &#39;I&#39; : &#39;i&#39;;
</a><a href="#h79-0-652" id="h79-0-652" class="i">+	togglestats[5] = curconfig[JavaScript].val.i ?      &#39;S&#39; : &#39;s&#39;;
</a><a href="#h79-0-653" id="h79-0-653" class="i">+	togglestats[6] = curconfig[Plugins].val.i ?         &#39;V&#39; : &#39;v&#39;;
</a><a href="#h79-0-654" id="h79-0-654" class="i">+	togglestats[7] = curconfig[Style].val.i ?           &#39;M&#39; : &#39;m&#39;;
</a><a href="#h79-0-655" id="h79-0-655" class="i">+	togglestats[8] = curconfig[FrameFlattening].val.i ? &#39;F&#39; : &#39;f&#39;;
</a><a href="#h79-0-656" id="h79-0-656" class="i">+	togglestats[9] = curconfig[Certificate].val.i ?     &#39;X&#39; : &#39;x&#39;;
</a><a href="#h79-0-657" id="h79-0-657" class="i">+	togglestats[10] = curconfig[StrictTLS].val.i ?      &#39;T&#39; : &#39;t&#39;;
</a><a href="#h79-0-658" id="h79-0-658" class="i">+	togglestats[11] = &#39;\0&#39;;
</a><a href="#h79-0-659" id="h79-0-659" class="i">+}
</a><a href="#h79-0-660" id="h79-0-660" class="i">+
</a><a href="#h79-0-661" id="h79-0-661" class="i">+void
</a><a href="#h79-0-662" id="h79-0-662" class="i">+getpagestats(Client *c)
</a><a href="#h79-0-663" id="h79-0-663" class="i">+{
</a><a href="#h79-0-664" id="h79-0-664" class="i">+	if (c-&gt;https)
</a><a href="#h79-0-665" id="h79-0-665" class="i">+		pagestats[0] = (c-&gt;tlserr || c-&gt;insecure) ?  &#39;U&#39; : &#39;T&#39;;
</a><a href="#h79-0-666" id="h79-0-666" class="i">+	else
</a><a href="#h79-0-667" id="h79-0-667" class="i">+		pagestats[0] = &#39;-&#39;;
</a><a href="#h79-0-668" id="h79-0-668" class="i">+	pagestats[1] = &#39;\0&#39;;
</a><a href="#h79-0-669" id="h79-0-669" class="i">+}
</a><a href="#h79-0-670" id="h79-0-670" class="i">+
</a><a href="#h79-0-671" id="h79-0-671" class="i">+WebKitCookieAcceptPolicy
</a><a href="#h79-0-672" id="h79-0-672" class="i">+cookiepolicy_get(void)
</a><a href="#h79-0-673" id="h79-0-673" class="i">+{
</a><a href="#h79-0-674" id="h79-0-674" class="i">+	switch (((char *)curconfig[CookiePolicies].val.v)[cookiepolicy]) {
</a><a href="#h79-0-675" id="h79-0-675" class="i">+	case &#39;a&#39;:
</a><a href="#h79-0-676" id="h79-0-676" class="i">+		return WEBKIT_COOKIE_POLICY_ACCEPT_NEVER;
</a><a href="#h79-0-677" id="h79-0-677" class="i">+	case &#39;@&#39;:
</a><a href="#h79-0-678" id="h79-0-678" class="i">+		return WEBKIT_COOKIE_POLICY_ACCEPT_NO_THIRD_PARTY;
</a><a href="#h79-0-679" id="h79-0-679" class="i">+	default: /* fallthrough */
</a><a href="#h79-0-680" id="h79-0-680" class="i">+	case &#39;A&#39;:
</a><a href="#h79-0-681" id="h79-0-681" class="i">+		return WEBKIT_COOKIE_POLICY_ACCEPT_ALWAYS;
</a><a href="#h79-0-682" id="h79-0-682" class="i">+	}
</a><a href="#h79-0-683" id="h79-0-683" class="i">+}
</a><a href="#h79-0-684" id="h79-0-684" class="i">+
</a><a href="#h79-0-685" id="h79-0-685" class="i">+char
</a><a href="#h79-0-686" id="h79-0-686" class="i">+cookiepolicy_set(const WebKitCookieAcceptPolicy p)
</a><a href="#h79-0-687" id="h79-0-687" class="i">+{
</a><a href="#h79-0-688" id="h79-0-688" class="i">+	switch (p) {
</a><a href="#h79-0-689" id="h79-0-689" class="i">+	case WEBKIT_COOKIE_POLICY_ACCEPT_NEVER:
</a><a href="#h79-0-690" id="h79-0-690" class="i">+		return &#39;a&#39;;
</a><a href="#h79-0-691" id="h79-0-691" class="i">+	case WEBKIT_COOKIE_POLICY_ACCEPT_NO_THIRD_PARTY:
</a><a href="#h79-0-692" id="h79-0-692" class="i">+		return &#39;@&#39;;
</a><a href="#h79-0-693" id="h79-0-693" class="i">+	default: /* fallthrough */
</a><a href="#h79-0-694" id="h79-0-694" class="i">+	case WEBKIT_COOKIE_POLICY_ACCEPT_ALWAYS:
</a><a href="#h79-0-695" id="h79-0-695" class="i">+		return &#39;A&#39;;
</a><a href="#h79-0-696" id="h79-0-696" class="i">+	}
</a><a href="#h79-0-697" id="h79-0-697" class="i">+}
</a><a href="#h79-0-698" id="h79-0-698" class="i">+
</a><a href="#h79-0-699" id="h79-0-699" class="i">+void
</a><a href="#h79-0-700" id="h79-0-700" class="i">+seturiparameters(Client *c, const char *uri, ParamName *params)
</a><a href="#h79-0-701" id="h79-0-701" class="i">+{
</a><a href="#h79-0-702" id="h79-0-702" class="i">+	Parameter *config, *uriconfig = NULL;
</a><a href="#h79-0-703" id="h79-0-703" class="i">+	int i, p;
</a><a href="#h79-0-704" id="h79-0-704" class="i">+
</a><a href="#h79-0-705" id="h79-0-705" class="i">+	for (i = 0; i &lt; LENGTH(uriparams); ++i) {
</a><a href="#h79-0-706" id="h79-0-706" class="i">+		if (uriparams[i].uri &amp;&amp;
</a><a href="#h79-0-707" id="h79-0-707" class="i">+		    !regexec(&amp;(uriparams[i].re), uri, 0, NULL, 0)) {
</a><a href="#h79-0-708" id="h79-0-708" class="i">+			uriconfig = uriparams[i].config;
</a><a href="#h79-0-709" id="h79-0-709" class="i">+			break;
</a><a href="#h79-0-710" id="h79-0-710" class="i">+		}
</a><a href="#h79-0-711" id="h79-0-711" class="i">+	}
</a><a href="#h79-0-712" id="h79-0-712" class="i">+
</a><a href="#h79-0-713" id="h79-0-713" class="i">+	curconfig = uriconfig ? uriconfig : defconfig;
</a><a href="#h79-0-714" id="h79-0-714" class="i">+
</a><a href="#h79-0-715" id="h79-0-715" class="i">+	for (i = 0; (p = params[i]) != ParameterLast; ++i) {
</a><a href="#h79-0-716" id="h79-0-716" class="i">+		switch(p) {
</a><a href="#h79-0-717" id="h79-0-717" class="i">+		default: /* FALLTHROUGH */
</a><a href="#h79-0-718" id="h79-0-718" class="i">+			if (!(defconfig[p].prio &lt; curconfig[p].prio ||
</a><a href="#h79-0-719" id="h79-0-719" class="i">+			    defconfig[p].prio &lt; modparams[p]))
</a><a href="#h79-0-720" id="h79-0-720" class="i">+				continue;
</a><a href="#h79-0-721" id="h79-0-721" class="i">+		case Certificate:
</a><a href="#h79-0-722" id="h79-0-722" class="i">+		case CookiePolicies:
</a><a href="#h79-0-723" id="h79-0-723" class="i">+		case Style:
</a><a href="#h79-0-724" id="h79-0-724" class="i">+			setparameter(c, 0, p, &amp;curconfig[p].val);
</a><a href="#h79-0-725" id="h79-0-725" class="i">+		}
</a><a href="#h79-0-726" id="h79-0-726" class="i">+	}
</a><a href="#h79-0-727" id="h79-0-727" class="i">+}
</a><a href="#h79-0-728" id="h79-0-728" class="i">+
</a><a href="#h79-0-729" id="h79-0-729" class="i">+void
</a><a href="#h79-0-730" id="h79-0-730" class="i">+setparameter(Client *c, int refresh, ParamName p, const Arg *a)
</a><a href="#h79-0-731" id="h79-0-731" class="i">+{
</a><a href="#h79-0-732" id="h79-0-732" class="i">+	GdkRGBA bgcolor = { 0 };
</a><a href="#h79-0-733" id="h79-0-733" class="i">+	WebKitSettings *s = webkit_web_view_get_settings(c-&gt;view);
</a><a href="#h79-0-734" id="h79-0-734" class="i">+
</a><a href="#h79-0-735" id="h79-0-735" class="i">+	modparams[p] = curconfig[p].prio;
</a><a href="#h79-0-736" id="h79-0-736" class="i">+
</a><a href="#h79-0-737" id="h79-0-737" class="i">+	switch (p) {
</a><a href="#h79-0-738" id="h79-0-738" class="i">+	case AcceleratedCanvas:
</a><a href="#h79-0-739" id="h79-0-739" class="i">+		webkit_settings_set_enable_accelerated_2d_canvas(s, a-&gt;i);
</a><a href="#h79-0-740" id="h79-0-740" class="i">+		break;
</a><a href="#h79-0-741" id="h79-0-741" class="i">+	case AccessMicrophone:
</a><a href="#h79-0-742" id="h79-0-742" class="i">+		return; /* do nothing */
</a><a href="#h79-0-743" id="h79-0-743" class="i">+	case AccessWebcam:
</a><a href="#h79-0-744" id="h79-0-744" class="i">+		return; /* do nothing */
</a><a href="#h79-0-745" id="h79-0-745" class="i">+	case CaretBrowsing:
</a><a href="#h79-0-746" id="h79-0-746" class="i">+		webkit_settings_set_enable_caret_browsing(s, a-&gt;i);
</a><a href="#h79-0-747" id="h79-0-747" class="i">+		refresh = 0;
</a><a href="#h79-0-748" id="h79-0-748" class="i">+		break;
</a><a href="#h79-0-749" id="h79-0-749" class="i">+	case Certificate:
</a><a href="#h79-0-750" id="h79-0-750" class="i">+		if (a-&gt;i)
</a><a href="#h79-0-751" id="h79-0-751" class="i">+			setcert(c, geturi(c));
</a><a href="#h79-0-752" id="h79-0-752" class="i">+		return; /* do not update */
</a><a href="#h79-0-753" id="h79-0-753" class="i">+	case CookiePolicies:
</a><a href="#h79-0-754" id="h79-0-754" class="i">+		webkit_cookie_manager_set_accept_policy(
</a><a href="#h79-0-755" id="h79-0-755" class="i">+		    webkit_web_context_get_cookie_manager(
</a><a href="#h79-0-756" id="h79-0-756" class="i">+		    webkit_web_view_get_context(c-&gt;view)),
</a><a href="#h79-0-757" id="h79-0-757" class="i">+		    cookiepolicy_get());
</a><a href="#h79-0-758" id="h79-0-758" class="i">+		refresh = 0;
</a><a href="#h79-0-759" id="h79-0-759" class="i">+		break;
</a><a href="#h79-0-760" id="h79-0-760" class="i">+	case DiskCache:
</a><a href="#h79-0-761" id="h79-0-761" class="i">+		webkit_web_context_set_cache_model(
</a><a href="#h79-0-762" id="h79-0-762" class="i">+		    webkit_web_view_get_context(c-&gt;view), a-&gt;i ?
</a><a href="#h79-0-763" id="h79-0-763" class="i">+		    WEBKIT_CACHE_MODEL_WEB_BROWSER :
</a><a href="#h79-0-764" id="h79-0-764" class="i">+		    WEBKIT_CACHE_MODEL_DOCUMENT_VIEWER);
</a><a href="#h79-0-765" id="h79-0-765" class="i">+		return; /* do not update */
</a><a href="#h79-0-766" id="h79-0-766" class="i">+	case DefaultCharset:
</a><a href="#h79-0-767" id="h79-0-767" class="i">+		webkit_settings_set_default_charset(s, a-&gt;v);
</a><a href="#h79-0-768" id="h79-0-768" class="i">+		return; /* do not update */
</a><a href="#h79-0-769" id="h79-0-769" class="i">+	case DNSPrefetch:
</a><a href="#h79-0-770" id="h79-0-770" class="i">+		webkit_settings_set_enable_dns_prefetching(s, a-&gt;i);
</a><a href="#h79-0-771" id="h79-0-771" class="i">+		return; /* do not update */
</a><a href="#h79-0-772" id="h79-0-772" class="i">+	case FileURLsCrossAccess:
</a><a href="#h79-0-773" id="h79-0-773" class="i">+		webkit_settings_set_allow_file_access_from_file_urls(s, a-&gt;i);
</a><a href="#h79-0-774" id="h79-0-774" class="i">+		webkit_settings_set_allow_universal_access_from_file_urls(s, a-&gt;i);
</a><a href="#h79-0-775" id="h79-0-775" class="i">+		return; /* do not update */
</a><a href="#h79-0-776" id="h79-0-776" class="i">+	case FontSize:
</a><a href="#h79-0-777" id="h79-0-777" class="i">+		webkit_settings_set_default_font_size(s, a-&gt;i);
</a><a href="#h79-0-778" id="h79-0-778" class="i">+		return; /* do not update */
</a><a href="#h79-0-779" id="h79-0-779" class="i">+	case FrameFlattening:
</a><a href="#h79-0-780" id="h79-0-780" class="i">+		webkit_settings_set_enable_frame_flattening(s, a-&gt;i);
</a><a href="#h79-0-781" id="h79-0-781" class="i">+		break;
</a><a href="#h79-0-782" id="h79-0-782" class="i">+	case Geolocation:
</a><a href="#h79-0-783" id="h79-0-783" class="i">+		refresh = 0;
</a><a href="#h79-0-784" id="h79-0-784" class="i">+		break;
</a><a href="#h79-0-785" id="h79-0-785" class="i">+	case HideBackground:
</a><a href="#h79-0-786" id="h79-0-786" class="i">+		if (a-&gt;i)
</a><a href="#h79-0-787" id="h79-0-787" class="i">+			webkit_web_view_set_background_color(c-&gt;view, &amp;bgcolor);
</a><a href="#h79-0-788" id="h79-0-788" class="i">+		return; /* do not update */
</a><a href="#h79-0-789" id="h79-0-789" class="i">+	case Inspector:
</a><a href="#h79-0-790" id="h79-0-790" class="i">+		webkit_settings_set_enable_developer_extras(s, a-&gt;i);
</a><a href="#h79-0-791" id="h79-0-791" class="i">+		return; /* do not update */
</a><a href="#h79-0-792" id="h79-0-792" class="i">+	case Java:
</a><a href="#h79-0-793" id="h79-0-793" class="i">+		webkit_settings_set_enable_java(s, a-&gt;i);
</a><a href="#h79-0-794" id="h79-0-794" class="i">+		return; /* do not update */
</a><a href="#h79-0-795" id="h79-0-795" class="i">+	case JavaScript:
</a><a href="#h79-0-796" id="h79-0-796" class="i">+		webkit_settings_set_enable_javascript(s, a-&gt;i);
</a><a href="#h79-0-797" id="h79-0-797" class="i">+		break;
</a><a href="#h79-0-798" id="h79-0-798" class="i">+	case KioskMode:
</a><a href="#h79-0-799" id="h79-0-799" class="i">+		return; /* do nothing */
</a><a href="#h79-0-800" id="h79-0-800" class="i">+	case LoadImages:
</a><a href="#h79-0-801" id="h79-0-801" class="i">+		webkit_settings_set_auto_load_images(s, a-&gt;i);
</a><a href="#h79-0-802" id="h79-0-802" class="i">+		break;
</a><a href="#h79-0-803" id="h79-0-803" class="i">+	case MediaManualPlay:
</a><a href="#h79-0-804" id="h79-0-804" class="i">+		webkit_settings_set_media_playback_requires_user_gesture(s, a-&gt;i);
</a><a href="#h79-0-805" id="h79-0-805" class="i">+		break;
</a><a href="#h79-0-806" id="h79-0-806" class="i">+	case Plugins:
</a><a href="#h79-0-807" id="h79-0-807" class="i">+		webkit_settings_set_enable_plugins(s, a-&gt;i);
</a><a href="#h79-0-808" id="h79-0-808" class="i">+		break;
</a><a href="#h79-0-809" id="h79-0-809" class="i">+	case PreferredLanguages:
</a><a href="#h79-0-810" id="h79-0-810" class="i">+		return; /* do nothing */
</a><a href="#h79-0-811" id="h79-0-811" class="i">+	case RunInFullscreen:
</a><a href="#h79-0-812" id="h79-0-812" class="i">+		return; /* do nothing */
</a><a href="#h79-0-813" id="h79-0-813" class="i">+	case ScrollBars:
</a><a href="#h79-0-814" id="h79-0-814" class="i">+		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h79-0-815" id="h79-0-815" class="i">+		 * manipulating the DOM directly.
</a><a href="#h79-0-816" id="h79-0-816" class="i">+		enablescrollbars = !enablescrollbars;
</a><a href="#h79-0-817" id="h79-0-817" class="i">+		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h79-0-818" id="h79-0-818" class="i">+		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h79-0-819" id="h79-0-819" class="i">+		*/
</a><a href="#h79-0-820" id="h79-0-820" class="i">+		return; /* do not update */
</a><a href="#h79-0-821" id="h79-0-821" class="i">+	case ShowIndicators:
</a><a href="#h79-0-822" id="h79-0-822" class="i">+		break;
</a><a href="#h79-0-823" id="h79-0-823" class="i">+	case SmoothScrolling:
</a><a href="#h79-0-824" id="h79-0-824" class="i">+		webkit_settings_set_enable_smooth_scrolling(s, a-&gt;i);
</a><a href="#h79-0-825" id="h79-0-825" class="i">+		return; /* do not update */
</a><a href="#h79-0-826" id="h79-0-826" class="i">+	case SiteQuirks:
</a><a href="#h79-0-827" id="h79-0-827" class="i">+		webkit_settings_set_enable_site_specific_quirks(s, a-&gt;i);
</a><a href="#h79-0-828" id="h79-0-828" class="i">+		break;
</a><a href="#h79-0-829" id="h79-0-829" class="i">+	case SpellChecking:
</a><a href="#h79-0-830" id="h79-0-830" class="i">+		webkit_web_context_set_spell_checking_enabled(
</a><a href="#h79-0-831" id="h79-0-831" class="i">+		    webkit_web_view_get_context(c-&gt;view), a-&gt;i);
</a><a href="#h79-0-832" id="h79-0-832" class="i">+		return; /* do not update */
</a><a href="#h79-0-833" id="h79-0-833" class="i">+	case SpellLanguages:
</a><a href="#h79-0-834" id="h79-0-834" class="i">+		return; /* do nothing */
</a><a href="#h79-0-835" id="h79-0-835" class="i">+	case StrictTLS:
</a><a href="#h79-0-836" id="h79-0-836" class="i">+		webkit_web_context_set_tls_errors_policy(
</a><a href="#h79-0-837" id="h79-0-837" class="i">+		    webkit_web_view_get_context(c-&gt;view), a-&gt;i ?
</a><a href="#h79-0-838" id="h79-0-838" class="i">+		    WEBKIT_TLS_ERRORS_POLICY_FAIL :
</a><a href="#h79-0-839" id="h79-0-839" class="i">+		    WEBKIT_TLS_ERRORS_POLICY_IGNORE);
</a><a href="#h79-0-840" id="h79-0-840" class="i">+		break;
</a><a href="#h79-0-841" id="h79-0-841" class="i">+	case Style:
</a><a href="#h79-0-842" id="h79-0-842" class="i">+		webkit_user_content_manager_remove_all_style_sheets(
</a><a href="#h79-0-843" id="h79-0-843" class="i">+		    webkit_web_view_get_user_content_manager(c-&gt;view));
</a><a href="#h79-0-844" id="h79-0-844" class="i">+		if (a-&gt;i)
</a><a href="#h79-0-845" id="h79-0-845" class="i">+			setstyle(c, getstyle(geturi(c)));
</a><a href="#h79-0-846" id="h79-0-846" class="i">+		refresh = 0;
</a><a href="#h79-0-847" id="h79-0-847" class="i">+		break;
</a><a href="#h79-0-848" id="h79-0-848" class="i">+	case WebGL:
</a><a href="#h79-0-849" id="h79-0-849" class="i">+		webkit_settings_set_enable_webgl(s, a-&gt;i);
</a><a href="#h79-0-850" id="h79-0-850" class="i">+		break;
</a><a href="#h79-0-851" id="h79-0-851" class="i">+	case ZoomLevel:
</a><a href="#h79-0-852" id="h79-0-852" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, a-&gt;f);
</a><a href="#h79-0-853" id="h79-0-853" class="i">+		return; /* do not update */
</a><a href="#h79-0-854" id="h79-0-854" class="i">+	default:
</a><a href="#h79-0-855" id="h79-0-855" class="i">+		return; /* do nothing */
</a><a href="#h79-0-856" id="h79-0-856" class="i">+	}
</a><a href="#h79-0-857" id="h79-0-857" class="i">+
</a><a href="#h79-0-858" id="h79-0-858" class="i">+	updatetitle(c);
</a><a href="#h79-0-859" id="h79-0-859" class="i">+	if (refresh)
</a><a href="#h79-0-860" id="h79-0-860" class="i">+		reload(c, a);
</a><a href="#h79-0-861" id="h79-0-861" class="i">+}
</a><a href="#h79-0-862" id="h79-0-862" class="i">+
</a><a href="#h79-0-863" id="h79-0-863" class="i">+const char *
</a><a href="#h79-0-864" id="h79-0-864" class="i">+getcert(const char *uri)
</a><a href="#h79-0-865" id="h79-0-865" class="i">+{
</a><a href="#h79-0-866" id="h79-0-866" class="i">+	int i;
</a><a href="#h79-0-867" id="h79-0-867" class="i">+
</a><a href="#h79-0-868" id="h79-0-868" class="i">+	for (i = 0; i &lt; LENGTH(certs); ++i) {
</a><a href="#h79-0-869" id="h79-0-869" class="i">+		if (certs[i].regex &amp;&amp;
</a><a href="#h79-0-870" id="h79-0-870" class="i">+		    !regexec(&amp;(certs[i].re), uri, 0, NULL, 0))
</a><a href="#h79-0-871" id="h79-0-871" class="i">+			return certs[i].file;
</a><a href="#h79-0-872" id="h79-0-872" class="i">+	}
</a><a href="#h79-0-873" id="h79-0-873" class="i">+
</a><a href="#h79-0-874" id="h79-0-874" class="i">+	return NULL;
</a><a href="#h79-0-875" id="h79-0-875" class="i">+}
</a><a href="#h79-0-876" id="h79-0-876" class="i">+
</a><a href="#h79-0-877" id="h79-0-877" class="i">+void
</a><a href="#h79-0-878" id="h79-0-878" class="i">+setcert(Client *c, const char *uri)
</a><a href="#h79-0-879" id="h79-0-879" class="i">+{
</a><a href="#h79-0-880" id="h79-0-880" class="i">+	const char *file = getcert(uri);
</a><a href="#h79-0-881" id="h79-0-881" class="i">+	char *host;
</a><a href="#h79-0-882" id="h79-0-882" class="i">+	GTlsCertificate *cert;
</a><a href="#h79-0-883" id="h79-0-883" class="i">+
</a><a href="#h79-0-884" id="h79-0-884" class="i">+	if (!file)
</a><a href="#h79-0-885" id="h79-0-885" class="i">+		return;
</a><a href="#h79-0-886" id="h79-0-886" class="i">+
</a><a href="#h79-0-887" id="h79-0-887" class="i">+	if (!(cert = g_tls_certificate_new_from_file(file, NULL))) {
</a><a href="#h79-0-888" id="h79-0-888" class="i">+		fprintf(stderr, &quot;Could not read certificate file: %s\n&quot;, file);
</a><a href="#h79-0-889" id="h79-0-889" class="i">+		return;
</a><a href="#h79-0-890" id="h79-0-890" class="i">+	}
</a><a href="#h79-0-891" id="h79-0-891" class="i">+
</a><a href="#h79-0-892" id="h79-0-892" class="i">+	if ((uri = strstr(uri, &quot;https://&quot;))) {
</a><a href="#h79-0-893" id="h79-0-893" class="i">+		uri += sizeof(&quot;https://&quot;) - 1;
</a><a href="#h79-0-894" id="h79-0-894" class="i">+		host = g_strndup(uri, strchr(uri, &#39;/&#39;) - uri);
</a><a href="#h79-0-895" id="h79-0-895" class="i">+		webkit_web_context_allow_tls_certificate_for_host(
</a><a href="#h79-0-896" id="h79-0-896" class="i">+		    webkit_web_view_get_context(c-&gt;view), cert, host);
</a><a href="#h79-0-897" id="h79-0-897" class="i">+		g_free(host);
</a><a href="#h79-0-898" id="h79-0-898" class="i">+	}
</a><a href="#h79-0-899" id="h79-0-899" class="i">+
</a><a href="#h79-0-900" id="h79-0-900" class="i">+	g_object_unref(cert);
</a><a href="#h79-0-901" id="h79-0-901" class="i">+
</a><a href="#h79-0-902" id="h79-0-902" class="i">+}
</a><a href="#h79-0-903" id="h79-0-903" class="i">+
</a><a href="#h79-0-904" id="h79-0-904" class="i">+const char *
</a><a href="#h79-0-905" id="h79-0-905" class="i">+getstyle(const char *uri)
</a><a href="#h79-0-906" id="h79-0-906" class="i">+{
</a><a href="#h79-0-907" id="h79-0-907" class="i">+	int i;
</a><a href="#h79-0-908" id="h79-0-908" class="i">+
</a><a href="#h79-0-909" id="h79-0-909" class="i">+	if (stylefile)
</a><a href="#h79-0-910" id="h79-0-910" class="i">+		return stylefile;
</a><a href="#h79-0-911" id="h79-0-911" class="i">+
</a><a href="#h79-0-912" id="h79-0-912" class="i">+	for (i = 0; i &lt; LENGTH(styles); ++i) {
</a><a href="#h79-0-913" id="h79-0-913" class="i">+		if (styles[i].regex &amp;&amp;
</a><a href="#h79-0-914" id="h79-0-914" class="i">+		    !regexec(&amp;(styles[i].re), uri, 0, NULL, 0))
</a><a href="#h79-0-915" id="h79-0-915" class="i">+			return styles[i].file;
</a><a href="#h79-0-916" id="h79-0-916" class="i">+	}
</a><a href="#h79-0-917" id="h79-0-917" class="i">+
</a><a href="#h79-0-918" id="h79-0-918" class="i">+	return &quot;&quot;;
</a><a href="#h79-0-919" id="h79-0-919" class="i">+}
</a><a href="#h79-0-920" id="h79-0-920" class="i">+
</a><a href="#h79-0-921" id="h79-0-921" class="i">+void
</a><a href="#h79-0-922" id="h79-0-922" class="i">+setstyle(Client *c, const char *file)
</a><a href="#h79-0-923" id="h79-0-923" class="i">+{
</a><a href="#h79-0-924" id="h79-0-924" class="i">+	gchar *style;
</a><a href="#h79-0-925" id="h79-0-925" class="i">+
</a><a href="#h79-0-926" id="h79-0-926" class="i">+	if (!g_file_get_contents(file, &amp;style, NULL, NULL)) {
</a><a href="#h79-0-927" id="h79-0-927" class="i">+		fprintf(stderr, &quot;Could not read style file: %s\n&quot;, file);
</a><a href="#h79-0-928" id="h79-0-928" class="i">+		return;
</a><a href="#h79-0-929" id="h79-0-929" class="i">+	}
</a><a href="#h79-0-930" id="h79-0-930" class="i">+
</a><a href="#h79-0-931" id="h79-0-931" class="i">+	webkit_user_content_manager_add_style_sheet(
</a><a href="#h79-0-932" id="h79-0-932" class="i">+	    webkit_web_view_get_user_content_manager(c-&gt;view),
</a><a href="#h79-0-933" id="h79-0-933" class="i">+	    webkit_user_style_sheet_new(style,
</a><a href="#h79-0-934" id="h79-0-934" class="i">+	    WEBKIT_USER_CONTENT_INJECT_ALL_FRAMES,
</a><a href="#h79-0-935" id="h79-0-935" class="i">+	    WEBKIT_USER_STYLE_LEVEL_USER,
</a><a href="#h79-0-936" id="h79-0-936" class="i">+	    NULL, NULL));
</a><a href="#h79-0-937" id="h79-0-937" class="i">+
</a><a href="#h79-0-938" id="h79-0-938" class="i">+	g_free(style);
</a><a href="#h79-0-939" id="h79-0-939" class="i">+}
</a><a href="#h79-0-940" id="h79-0-940" class="i">+
</a><a href="#h79-0-941" id="h79-0-941" class="i">+void
</a><a href="#h79-0-942" id="h79-0-942" class="i">+runscript(Client *c)
</a><a href="#h79-0-943" id="h79-0-943" class="i">+{
</a><a href="#h79-0-944" id="h79-0-944" class="i">+	gchar *script;
</a><a href="#h79-0-945" id="h79-0-945" class="i">+	gsize l;
</a><a href="#h79-0-946" id="h79-0-946" class="i">+
</a><a href="#h79-0-947" id="h79-0-947" class="i">+	if (g_file_get_contents(scriptfile, &amp;script, &amp;l, NULL) &amp;&amp; l)
</a><a href="#h79-0-948" id="h79-0-948" class="i">+		evalscript(c, &quot;%s&quot;, script);
</a><a href="#h79-0-949" id="h79-0-949" class="i">+	g_free(script);
</a><a href="#h79-0-950" id="h79-0-950" class="i">+}
</a><a href="#h79-0-951" id="h79-0-951" class="i">+
</a><a href="#h79-0-952" id="h79-0-952" class="i">+void
</a><a href="#h79-0-953" id="h79-0-953" class="i">+evalscript(Client *c, const char *jsstr, ...)
</a><a href="#h79-0-954" id="h79-0-954" class="i">+{
</a><a href="#h79-0-955" id="h79-0-955" class="i">+	va_list ap;
</a><a href="#h79-0-956" id="h79-0-956" class="i">+	gchar *script;
</a><a href="#h79-0-957" id="h79-0-957" class="i">+
</a><a href="#h79-0-958" id="h79-0-958" class="i">+	va_start(ap, jsstr);
</a><a href="#h79-0-959" id="h79-0-959" class="i">+	script = g_strdup_vprintf(jsstr, ap);
</a><a href="#h79-0-960" id="h79-0-960" class="i">+	va_end(ap);
</a><a href="#h79-0-961" id="h79-0-961" class="i">+
</a><a href="#h79-0-962" id="h79-0-962" class="i">+	webkit_web_view_run_javascript(c-&gt;view, script, NULL, NULL, NULL);
</a><a href="#h79-0-963" id="h79-0-963" class="i">+	g_free(script);
</a><a href="#h79-0-964" id="h79-0-964" class="i">+}
</a><a href="#h79-0-965" id="h79-0-965" class="i">+
</a><a href="#h79-0-966" id="h79-0-966" class="i">+void
</a><a href="#h79-0-967" id="h79-0-967" class="i">+updatewinid(Client *c)
</a><a href="#h79-0-968" id="h79-0-968" class="i">+{
</a><a href="#h79-0-969" id="h79-0-969" class="i">+	snprintf(winid, LENGTH(winid), &quot;%lu&quot;, c-&gt;xid);
</a><a href="#h79-0-970" id="h79-0-970" class="i">+}
</a><a href="#h79-0-971" id="h79-0-971" class="i">+
</a><a href="#h79-0-972" id="h79-0-972" class="i">+void
</a><a href="#h79-0-973" id="h79-0-973" class="i">+handleplumb(Client *c, const char *uri)
</a><a href="#h79-0-974" id="h79-0-974" class="i">+{
</a><a href="#h79-0-975" id="h79-0-975" class="i">+	Arg a = (Arg)PLUMB(uri);
</a><a href="#h79-0-976" id="h79-0-976" class="i">+	spawn(c, &amp;a);
</a><a href="#h79-0-977" id="h79-0-977" class="i">+}
</a><a href="#h79-0-978" id="h79-0-978" class="i">+
</a><a href="#h79-0-979" id="h79-0-979" class="i">+void
</a><a href="#h79-0-980" id="h79-0-980" class="i">+newwindow(Client *c, const Arg *a, int noembed)
</a><a href="#h79-0-981" id="h79-0-981" class="i">+{
</a><a href="#h79-0-982" id="h79-0-982" class="i">+	int i = 0;
</a><a href="#h79-0-983" id="h79-0-983" class="i">+	char tmp[64];
</a><a href="#h79-0-984" id="h79-0-984" class="i">+	const char *cmd[29], *uri;
</a><a href="#h79-0-985" id="h79-0-985" class="i">+	const Arg arg = { .v = cmd };
</a><a href="#h79-0-986" id="h79-0-986" class="i">+
</a><a href="#h79-0-987" id="h79-0-987" class="i">+	cmd[i++] = argv0;
</a><a href="#h79-0-988" id="h79-0-988" class="i">+	cmd[i++] = &quot;-a&quot;;
</a><a href="#h79-0-989" id="h79-0-989" class="i">+	cmd[i++] = curconfig[CookiePolicies].val.v;
</a><a href="#h79-0-990" id="h79-0-990" class="i">+	cmd[i++] = curconfig[ScrollBars].val.i ? &quot;-B&quot; : &quot;-b&quot;;
</a><a href="#h79-0-991" id="h79-0-991" class="i">+	if (cookiefile &amp;&amp; g_strcmp0(cookiefile, &quot;&quot;)) {
</a><a href="#h79-0-992" id="h79-0-992" class="i">+		cmd[i++] = &quot;-c&quot;;
</a><a href="#h79-0-993" id="h79-0-993" class="i">+		cmd[i++] = cookiefile;
</a><a href="#h79-0-994" id="h79-0-994" class="i">+	}
</a><a href="#h79-0-995" id="h79-0-995" class="i">+	if (stylefile &amp;&amp; g_strcmp0(stylefile, &quot;&quot;)) {
</a><a href="#h79-0-996" id="h79-0-996" class="i">+		cmd[i++] = &quot;-C&quot;;
</a><a href="#h79-0-997" id="h79-0-997" class="i">+		cmd[i++] = stylefile;
</a><a href="#h79-0-998" id="h79-0-998" class="i">+	}
</a><a href="#h79-0-999" id="h79-0-999" class="i">+	cmd[i++] = curconfig[DiskCache].val.i ? &quot;-D&quot; : &quot;-d&quot;;
</a><a href="#h79-0-1000" id="h79-0-1000" class="i">+	if (embed &amp;&amp; !noembed) {
</a><a href="#h79-0-1001" id="h79-0-1001" class="i">+		cmd[i++] = &quot;-e&quot;;
</a><a href="#h79-0-1002" id="h79-0-1002" class="i">+		snprintf(tmp, LENGTH(tmp), &quot;%lu&quot;, embed);
</a><a href="#h79-0-1003" id="h79-0-1003" class="i">+		cmd[i++] = tmp;
</a><a href="#h79-0-1004" id="h79-0-1004" class="i">+	}
</a><a href="#h79-0-1005" id="h79-0-1005" class="i">+	cmd[i++] = curconfig[RunInFullscreen].val.i ? &quot;-F&quot; : &quot;-f&quot; ;
</a><a href="#h79-0-1006" id="h79-0-1006" class="i">+	cmd[i++] = curconfig[Geolocation].val.i ?     &quot;-G&quot; : &quot;-g&quot; ;
</a><a href="#h79-0-1007" id="h79-0-1007" class="i">+	cmd[i++] = curconfig[LoadImages].val.i ?      &quot;-I&quot; : &quot;-i&quot; ;
</a><a href="#h79-0-1008" id="h79-0-1008" class="i">+	cmd[i++] = curconfig[KioskMode].val.i ?       &quot;-K&quot; : &quot;-k&quot; ;
</a><a href="#h79-0-1009" id="h79-0-1009" class="i">+	cmd[i++] = curconfig[Style].val.i ?           &quot;-M&quot; : &quot;-m&quot; ;
</a><a href="#h79-0-1010" id="h79-0-1010" class="i">+	cmd[i++] = curconfig[Inspector].val.i ?       &quot;-N&quot; : &quot;-n&quot; ;
</a><a href="#h79-0-1011" id="h79-0-1011" class="i">+	cmd[i++] = curconfig[Plugins].val.i ?         &quot;-P&quot; : &quot;-p&quot; ;
</a><a href="#h79-0-1012" id="h79-0-1012" class="i">+	if (scriptfile &amp;&amp; g_strcmp0(scriptfile, &quot;&quot;)) {
</a><a href="#h79-0-1013" id="h79-0-1013" class="i">+		cmd[i++] = &quot;-r&quot;;
</a><a href="#h79-0-1014" id="h79-0-1014" class="i">+		cmd[i++] = scriptfile;
</a><a href="#h79-0-1015" id="h79-0-1015" class="i">+	}
</a><a href="#h79-0-1016" id="h79-0-1016" class="i">+	cmd[i++] = curconfig[JavaScript].val.i ? &quot;-S&quot; : &quot;-s&quot;;
</a><a href="#h79-0-1017" id="h79-0-1017" class="i">+	cmd[i++] = curconfig[StrictTLS].val.i ? &quot;-T&quot; : &quot;-t&quot;;
</a><a href="#h79-0-1018" id="h79-0-1018" class="i">+	if (fulluseragent &amp;&amp; g_strcmp0(fulluseragent, &quot;&quot;)) {
</a><a href="#h79-0-1019" id="h79-0-1019" class="i">+		cmd[i++] = &quot;-u&quot;;
</a><a href="#h79-0-1020" id="h79-0-1020" class="i">+		cmd[i++] = fulluseragent;
</a><a href="#h79-0-1021" id="h79-0-1021" class="i">+	}
</a><a href="#h79-0-1022" id="h79-0-1022" class="i">+	if (showxid)
</a><a href="#h79-0-1023" id="h79-0-1023" class="i">+		cmd[i++] = &quot;-w&quot;;
</a><a href="#h79-0-1024" id="h79-0-1024" class="i">+	cmd[i++] = curconfig[Certificate].val.i ? &quot;-X&quot; : &quot;-x&quot; ;
</a><a href="#h79-0-1025" id="h79-0-1025" class="i">+	/* do not keep zoom level */
</a><a href="#h79-0-1026" id="h79-0-1026" class="i">+	cmd[i++] = &quot;--&quot;;
</a><a href="#h79-0-1027" id="h79-0-1027" class="i">+	if ((uri = a-&gt;v))
</a><a href="#h79-0-1028" id="h79-0-1028" class="i">+		cmd[i++] = uri;
</a><a href="#h79-0-1029" id="h79-0-1029" class="i">+	cmd[i] = NULL;
</a><a href="#h79-0-1030" id="h79-0-1030" class="i">+
</a><a href="#h79-0-1031" id="h79-0-1031" class="i">+	spawn(c, &amp;arg);
</a><a href="#h79-0-1032" id="h79-0-1032" class="i">+}
</a><a href="#h79-0-1033" id="h79-0-1033" class="i">+
</a><a href="#h79-0-1034" id="h79-0-1034" class="i">+void
</a><a href="#h79-0-1035" id="h79-0-1035" class="i">+spawn(Client *c, const Arg *a)
</a><a href="#h79-0-1036" id="h79-0-1036" class="i">+{
</a><a href="#h79-0-1037" id="h79-0-1037" class="i">+	if (fork() == 0) {
</a><a href="#h79-0-1038" id="h79-0-1038" class="i">+		if (dpy)
</a><a href="#h79-0-1039" id="h79-0-1039" class="i">+			close(ConnectionNumber(dpy));
</a><a href="#h79-0-1040" id="h79-0-1040" class="i">+		close(pipein[0]);
</a><a href="#h79-0-1041" id="h79-0-1041" class="i">+		close(pipeout[1]);
</a><a href="#h79-0-1042" id="h79-0-1042" class="i">+		setsid();
</a><a href="#h79-0-1043" id="h79-0-1043" class="i">+		execvp(((char **)a-&gt;v)[0], (char **)a-&gt;v);
</a><a href="#h79-0-1044" id="h79-0-1044" class="i">+		fprintf(stderr, &quot;%s: execvp %s&quot;, argv0, ((char **)a-&gt;v)[0]);
</a><a href="#h79-0-1045" id="h79-0-1045" class="i">+		perror(&quot; failed&quot;);
</a><a href="#h79-0-1046" id="h79-0-1046" class="i">+		exit(1);
</a><a href="#h79-0-1047" id="h79-0-1047" class="i">+	}
</a><a href="#h79-0-1048" id="h79-0-1048" class="i">+}
</a><a href="#h79-0-1049" id="h79-0-1049" class="i">+
</a><a href="#h79-0-1050" id="h79-0-1050" class="i">+void
</a><a href="#h79-0-1051" id="h79-0-1051" class="i">+destroyclient(Client *c)
</a><a href="#h79-0-1052" id="h79-0-1052" class="i">+{
</a><a href="#h79-0-1053" id="h79-0-1053" class="i">+	Client *p;
</a><a href="#h79-0-1054" id="h79-0-1054" class="i">+
</a><a href="#h79-0-1055" id="h79-0-1055" class="i">+	webkit_web_view_stop_loading(c-&gt;view);
</a><a href="#h79-0-1056" id="h79-0-1056" class="i">+	/* Not needed, has already been called
</a><a href="#h79-0-1057" id="h79-0-1057" class="i">+	gtk_widget_destroy(c-&gt;win);
</a><a href="#h79-0-1058" id="h79-0-1058" class="i">+	 */
</a><a href="#h79-0-1059" id="h79-0-1059" class="i">+
</a><a href="#h79-0-1060" id="h79-0-1060" class="i">+	for (p = clients; p &amp;&amp; p-&gt;next != c; p = p-&gt;next)
</a><a href="#h79-0-1061" id="h79-0-1061" class="i">+		;
</a><a href="#h79-0-1062" id="h79-0-1062" class="i">+	if (p)
</a><a href="#h79-0-1063" id="h79-0-1063" class="i">+		p-&gt;next = c-&gt;next;
</a><a href="#h79-0-1064" id="h79-0-1064" class="i">+	else
</a><a href="#h79-0-1065" id="h79-0-1065" class="i">+		clients = c-&gt;next;
</a><a href="#h79-0-1066" id="h79-0-1066" class="i">+	free(c);
</a><a href="#h79-0-1067" id="h79-0-1067" class="i">+}
</a><a href="#h79-0-1068" id="h79-0-1068" class="i">+
</a><a href="#h79-0-1069" id="h79-0-1069" class="i">+void
</a><a href="#h79-0-1070" id="h79-0-1070" class="i">+cleanup(void)
</a><a href="#h79-0-1071" id="h79-0-1071" class="i">+{
</a><a href="#h79-0-1072" id="h79-0-1072" class="i">+	while (clients)
</a><a href="#h79-0-1073" id="h79-0-1073" class="i">+		destroyclient(clients);
</a><a href="#h79-0-1074" id="h79-0-1074" class="i">+
</a><a href="#h79-0-1075" id="h79-0-1075" class="i">+	close(pipein[0]);
</a><a href="#h79-0-1076" id="h79-0-1076" class="i">+	close(pipeout[1]);
</a><a href="#h79-0-1077" id="h79-0-1077" class="i">+	g_free(cookiefile);
</a><a href="#h79-0-1078" id="h79-0-1078" class="i">+	g_free(scriptfile);
</a><a href="#h79-0-1079" id="h79-0-1079" class="i">+	g_free(stylefile);
</a><a href="#h79-0-1080" id="h79-0-1080" class="i">+	g_free(cachedir);
</a><a href="#h79-0-1081" id="h79-0-1081" class="i">+	XCloseDisplay(dpy);
</a><a href="#h79-0-1082" id="h79-0-1082" class="i">+}
</a><a href="#h79-0-1083" id="h79-0-1083" class="i">+
</a><a href="#h79-0-1084" id="h79-0-1084" class="i">+WebKitWebView *
</a><a href="#h79-0-1085" id="h79-0-1085" class="i">+newview(Client *c, WebKitWebView *rv)
</a><a href="#h79-0-1086" id="h79-0-1086" class="i">+{
</a><a href="#h79-0-1087" id="h79-0-1087" class="i">+	WebKitWebView *v;
</a><a href="#h79-0-1088" id="h79-0-1088" class="i">+	WebKitSettings *settings;
</a><a href="#h79-0-1089" id="h79-0-1089" class="i">+	WebKitWebContext *context;
</a><a href="#h79-0-1090" id="h79-0-1090" class="i">+	WebKitCookieManager *cookiemanager;
</a><a href="#h79-0-1091" id="h79-0-1091" class="i">+	WebKitUserContentManager *contentmanager;
</a><a href="#h79-0-1092" id="h79-0-1092" class="i">+
</a><a href="#h79-0-1093" id="h79-0-1093" class="i">+	/* Webview */
</a><a href="#h79-0-1094" id="h79-0-1094" class="i">+	if (rv) {
</a><a href="#h79-0-1095" id="h79-0-1095" class="i">+		v = WEBKIT_WEB_VIEW(webkit_web_view_new_with_related_view(rv));
</a><a href="#h79-0-1096" id="h79-0-1096" class="i">+	} else {
</a><a href="#h79-0-1097" id="h79-0-1097" class="i">+		settings = webkit_settings_new_with_settings(
</a><a href="#h79-0-1098" id="h79-0-1098" class="i">+		   &quot;allow-file-access-from-file-urls&quot;, curconfig[FileURLsCrossAccess].val.i,
</a><a href="#h79-0-1099" id="h79-0-1099" class="i">+		   &quot;allow-universal-access-from-file-urls&quot;, curconfig[FileURLsCrossAccess].val.i,
</a><a href="#h79-0-1100" id="h79-0-1100" class="i">+		   &quot;auto-load-images&quot;, curconfig[LoadImages].val.i,
</a><a href="#h79-0-1101" id="h79-0-1101" class="i">+		   &quot;default-charset&quot;, curconfig[DefaultCharset].val.v,
</a><a href="#h79-0-1102" id="h79-0-1102" class="i">+		   &quot;default-font-size&quot;, curconfig[FontSize].val.i,
</a><a href="#h79-0-1103" id="h79-0-1103" class="i">+		   &quot;enable-caret-browsing&quot;, curconfig[CaretBrowsing].val.i,
</a><a href="#h79-0-1104" id="h79-0-1104" class="i">+		   &quot;enable-developer-extras&quot;, curconfig[Inspector].val.i,
</a><a href="#h79-0-1105" id="h79-0-1105" class="i">+		   &quot;enable-dns-prefetching&quot;, curconfig[DNSPrefetch].val.i,
</a><a href="#h79-0-1106" id="h79-0-1106" class="i">+		   &quot;enable-frame-flattening&quot;, curconfig[FrameFlattening].val.i,
</a><a href="#h79-0-1107" id="h79-0-1107" class="i">+		   &quot;enable-html5-database&quot;, curconfig[DiskCache].val.i,
</a><a href="#h79-0-1108" id="h79-0-1108" class="i">+		   &quot;enable-html5-local-storage&quot;, curconfig[DiskCache].val.i,
</a><a href="#h79-0-1109" id="h79-0-1109" class="i">+		   &quot;enable-java&quot;, curconfig[Java].val.i,
</a><a href="#h79-0-1110" id="h79-0-1110" class="i">+		   &quot;enable-javascript&quot;, curconfig[JavaScript].val.i,
</a><a href="#h79-0-1111" id="h79-0-1111" class="i">+		   &quot;enable-plugins&quot;, curconfig[Plugins].val.i,
</a><a href="#h79-0-1112" id="h79-0-1112" class="i">+		   &quot;enable-accelerated-2d-canvas&quot;, curconfig[AcceleratedCanvas].val.i,
</a><a href="#h79-0-1113" id="h79-0-1113" class="i">+		   &quot;enable-site-specific-quirks&quot;, curconfig[SiteQuirks].val.i,
</a><a href="#h79-0-1114" id="h79-0-1114" class="i">+		   &quot;enable-smooth-scrolling&quot;, curconfig[SmoothScrolling].val.i,
</a><a href="#h79-0-1115" id="h79-0-1115" class="i">+		   &quot;enable-webgl&quot;, curconfig[WebGL].val.i,
</a><a href="#h79-0-1116" id="h79-0-1116" class="i">+		   &quot;media-playback-requires-user-gesture&quot;, curconfig[MediaManualPlay].val.i,
</a><a href="#h79-0-1117" id="h79-0-1117" class="i">+		   NULL);
</a><a href="#h79-0-1118" id="h79-0-1118" class="i">+/* For more interesting settings, have a look at
</a><a href="#h79-0-1119" id="h79-0-1119" class="i">+ * http://webkitgtk.org/reference/webkit2gtk/stable/WebKitSettings.html */
</a><a href="#h79-0-1120" id="h79-0-1120" class="i">+
</a><a href="#h79-0-1121" id="h79-0-1121" class="i">+		if (strcmp(fulluseragent, &quot;&quot;)) {
</a><a href="#h79-0-1122" id="h79-0-1122" class="i">+			webkit_settings_set_user_agent(settings, fulluseragent);
</a><a href="#h79-0-1123" id="h79-0-1123" class="i">+		} else if (surfuseragent) {
</a><a href="#h79-0-1124" id="h79-0-1124" class="i">+			webkit_settings_set_user_agent_with_application_details(
</a><a href="#h79-0-1125" id="h79-0-1125" class="i">+			    settings, &quot;Surf&quot;, VERSION);
</a><a href="#h79-0-1126" id="h79-0-1126" class="i">+		}
</a><a href="#h79-0-1127" id="h79-0-1127" class="i">+		useragent = webkit_settings_get_user_agent(settings);
</a><a href="#h79-0-1128" id="h79-0-1128" class="i">+
</a><a href="#h79-0-1129" id="h79-0-1129" class="i">+		contentmanager = webkit_user_content_manager_new();
</a><a href="#h79-0-1130" id="h79-0-1130" class="i">+
</a><a href="#h79-0-1131" id="h79-0-1131" class="i">+		context = webkit_web_context_new_with_website_data_manager(
</a><a href="#h79-0-1132" id="h79-0-1132" class="i">+		          webkit_website_data_manager_new(
</a><a href="#h79-0-1133" id="h79-0-1133" class="i">+		          &quot;base-cache-directory&quot;, cachedir,
</a><a href="#h79-0-1134" id="h79-0-1134" class="i">+		          &quot;base-data-directory&quot;, cachedir,
</a><a href="#h79-0-1135" id="h79-0-1135" class="i">+		          NULL));
</a><a href="#h79-0-1136" id="h79-0-1136" class="i">+
</a><a href="#h79-0-1137" id="h79-0-1137" class="i">+		cookiemanager = webkit_web_context_get_cookie_manager(context);
</a><a href="#h79-0-1138" id="h79-0-1138" class="i">+
</a><a href="#h79-0-1139" id="h79-0-1139" class="i">+		/* rendering process model, can be a shared unique one
</a><a href="#h79-0-1140" id="h79-0-1140" class="i">+		 * or one for each view */
</a><a href="#h79-0-1141" id="h79-0-1141" class="i">+		webkit_web_context_set_process_model(context,
</a><a href="#h79-0-1142" id="h79-0-1142" class="i">+		    WEBKIT_PROCESS_MODEL_MULTIPLE_SECONDARY_PROCESSES);
</a><a href="#h79-0-1143" id="h79-0-1143" class="i">+		/* TLS */
</a><a href="#h79-0-1144" id="h79-0-1144" class="i">+		webkit_web_context_set_tls_errors_policy(context,
</a><a href="#h79-0-1145" id="h79-0-1145" class="i">+		    curconfig[StrictTLS].val.i ? WEBKIT_TLS_ERRORS_POLICY_FAIL :
</a><a href="#h79-0-1146" id="h79-0-1146" class="i">+		    WEBKIT_TLS_ERRORS_POLICY_IGNORE);
</a><a href="#h79-0-1147" id="h79-0-1147" class="i">+		/* disk cache */
</a><a href="#h79-0-1148" id="h79-0-1148" class="i">+		webkit_web_context_set_cache_model(context,
</a><a href="#h79-0-1149" id="h79-0-1149" class="i">+		    curconfig[DiskCache].val.i ? WEBKIT_CACHE_MODEL_WEB_BROWSER :
</a><a href="#h79-0-1150" id="h79-0-1150" class="i">+		    WEBKIT_CACHE_MODEL_DOCUMENT_VIEWER);
</a><a href="#h79-0-1151" id="h79-0-1151" class="i">+
</a><a href="#h79-0-1152" id="h79-0-1152" class="i">+		/* Currently only works with text file to be compatible with curl */
</a><a href="#h79-0-1153" id="h79-0-1153" class="i">+		webkit_cookie_manager_set_persistent_storage(cookiemanager,
</a><a href="#h79-0-1154" id="h79-0-1154" class="i">+		    cookiefile, WEBKIT_COOKIE_PERSISTENT_STORAGE_TEXT);
</a><a href="#h79-0-1155" id="h79-0-1155" class="i">+		/* cookie policy */
</a><a href="#h79-0-1156" id="h79-0-1156" class="i">+		webkit_cookie_manager_set_accept_policy(cookiemanager,
</a><a href="#h79-0-1157" id="h79-0-1157" class="i">+		    cookiepolicy_get());
</a><a href="#h79-0-1158" id="h79-0-1158" class="i">+		/* languages */
</a><a href="#h79-0-1159" id="h79-0-1159" class="i">+		webkit_web_context_set_preferred_languages(context,
</a><a href="#h79-0-1160" id="h79-0-1160" class="i">+		    curconfig[PreferredLanguages].val.v);
</a><a href="#h79-0-1161" id="h79-0-1161" class="i">+		webkit_web_context_set_spell_checking_languages(context,
</a><a href="#h79-0-1162" id="h79-0-1162" class="i">+		    curconfig[SpellLanguages].val.v);
</a><a href="#h79-0-1163" id="h79-0-1163" class="i">+		webkit_web_context_set_spell_checking_enabled(context,
</a><a href="#h79-0-1164" id="h79-0-1164" class="i">+		    curconfig[SpellChecking].val.i);
</a><a href="#h79-0-1165" id="h79-0-1165" class="i">+
</a><a href="#h79-0-1166" id="h79-0-1166" class="i">+		g_signal_connect(G_OBJECT(context), &quot;download-started&quot;,
</a><a href="#h79-0-1167" id="h79-0-1167" class="i">+		                 G_CALLBACK(downloadstarted), c);
</a><a href="#h79-0-1168" id="h79-0-1168" class="i">+		g_signal_connect(G_OBJECT(context), &quot;initialize-web-extensions&quot;,
</a><a href="#h79-0-1169" id="h79-0-1169" class="i">+		                 G_CALLBACK(initwebextensions), c);
</a><a href="#h79-0-1170" id="h79-0-1170" class="i">+
</a><a href="#h79-0-1171" id="h79-0-1171" class="i">+		v = g_object_new(WEBKIT_TYPE_WEB_VIEW,
</a><a href="#h79-0-1172" id="h79-0-1172" class="i">+		    &quot;settings&quot;, settings,
</a><a href="#h79-0-1173" id="h79-0-1173" class="i">+		    &quot;user-content-manager&quot;, contentmanager,
</a><a href="#h79-0-1174" id="h79-0-1174" class="i">+		    &quot;web-context&quot;, context,
</a><a href="#h79-0-1175" id="h79-0-1175" class="i">+		    NULL);
</a><a href="#h79-0-1176" id="h79-0-1176" class="i">+	}
</a><a href="#h79-0-1177" id="h79-0-1177" class="i">+
</a><a href="#h79-0-1178" id="h79-0-1178" class="i">+	g_signal_connect(G_OBJECT(v), &quot;notify::estimated-load-progress&quot;,
</a><a href="#h79-0-1179" id="h79-0-1179" class="i">+			 G_CALLBACK(progresschanged), c);
</a><a href="#h79-0-1180" id="h79-0-1180" class="i">+	g_signal_connect(G_OBJECT(v), &quot;notify::title&quot;,
</a><a href="#h79-0-1181" id="h79-0-1181" class="i">+			 G_CALLBACK(titlechanged), c);
</a><a href="#h79-0-1182" id="h79-0-1182" class="i">+	g_signal_connect(G_OBJECT(v), &quot;button-release-event&quot;,
</a><a href="#h79-0-1183" id="h79-0-1183" class="i">+			 G_CALLBACK(buttonreleased), c);
</a><a href="#h79-0-1184" id="h79-0-1184" class="i">+	g_signal_connect(G_OBJECT(v), &quot;close&quot;,
</a><a href="#h79-0-1185" id="h79-0-1185" class="i">+			G_CALLBACK(closeview), c);
</a><a href="#h79-0-1186" id="h79-0-1186" class="i">+	g_signal_connect(G_OBJECT(v), &quot;create&quot;,
</a><a href="#h79-0-1187" id="h79-0-1187" class="i">+			 G_CALLBACK(createview), c);
</a><a href="#h79-0-1188" id="h79-0-1188" class="i">+	g_signal_connect(G_OBJECT(v), &quot;decide-policy&quot;,
</a><a href="#h79-0-1189" id="h79-0-1189" class="i">+			 G_CALLBACK(decidepolicy), c);
</a><a href="#h79-0-1190" id="h79-0-1190" class="i">+	g_signal_connect(G_OBJECT(v), &quot;insecure-content-detected&quot;,
</a><a href="#h79-0-1191" id="h79-0-1191" class="i">+			 G_CALLBACK(insecurecontent), c);
</a><a href="#h79-0-1192" id="h79-0-1192" class="i">+	g_signal_connect(G_OBJECT(v), &quot;load-failed-with-tls-errors&quot;,
</a><a href="#h79-0-1193" id="h79-0-1193" class="i">+			 G_CALLBACK(loadfailedtls), c);
</a><a href="#h79-0-1194" id="h79-0-1194" class="i">+	g_signal_connect(G_OBJECT(v), &quot;load-changed&quot;,
</a><a href="#h79-0-1195" id="h79-0-1195" class="i">+			 G_CALLBACK(loadchanged), c);
</a><a href="#h79-0-1196" id="h79-0-1196" class="i">+	g_signal_connect(G_OBJECT(v), &quot;mouse-target-changed&quot;,
</a><a href="#h79-0-1197" id="h79-0-1197" class="i">+			 G_CALLBACK(mousetargetchanged), c);
</a><a href="#h79-0-1198" id="h79-0-1198" class="i">+	g_signal_connect(G_OBJECT(v), &quot;permission-request&quot;,
</a><a href="#h79-0-1199" id="h79-0-1199" class="i">+			 G_CALLBACK(permissionrequested), c);
</a><a href="#h79-0-1200" id="h79-0-1200" class="i">+	g_signal_connect(G_OBJECT(v), &quot;ready-to-show&quot;,
</a><a href="#h79-0-1201" id="h79-0-1201" class="i">+			 G_CALLBACK(showview), c);
</a><a href="#h79-0-1202" id="h79-0-1202" class="i">+	g_signal_connect(G_OBJECT(v), &quot;web-process-terminated&quot;,
</a><a href="#h79-0-1203" id="h79-0-1203" class="i">+			 G_CALLBACK(webprocessterminated), c);
</a><a href="#h79-0-1204" id="h79-0-1204" class="i">+
</a><a href="#h79-0-1205" id="h79-0-1205" class="i">+	return v;
</a><a href="#h79-0-1206" id="h79-0-1206" class="i">+}
</a><a href="#h79-0-1207" id="h79-0-1207" class="i">+
</a><a href="#h79-0-1208" id="h79-0-1208" class="i">+static gboolean
</a><a href="#h79-0-1209" id="h79-0-1209" class="i">+readpipe(GIOChannel *s, GIOCondition ioc, gpointer unused)
</a><a href="#h79-0-1210" id="h79-0-1210" class="i">+{
</a><a href="#h79-0-1211" id="h79-0-1211" class="i">+	static char msg[MSGBUFSZ], msgsz;
</a><a href="#h79-0-1212" id="h79-0-1212" class="i">+	GError *gerr = NULL;
</a><a href="#h79-0-1213" id="h79-0-1213" class="i">+
</a><a href="#h79-0-1214" id="h79-0-1214" class="i">+	if (g_io_channel_read_chars(s, msg, sizeof(msg), NULL, &amp;gerr) !=
</a><a href="#h79-0-1215" id="h79-0-1215" class="i">+	    G_IO_STATUS_NORMAL) {
</a><a href="#h79-0-1216" id="h79-0-1216" class="i">+		fprintf(stderr, &quot;surf: error reading pipe: %s\n&quot;,
</a><a href="#h79-0-1217" id="h79-0-1217" class="i">+		        gerr-&gt;message);
</a><a href="#h79-0-1218" id="h79-0-1218" class="i">+		g_error_free(gerr);
</a><a href="#h79-0-1219" id="h79-0-1219" class="i">+		return TRUE;
</a><a href="#h79-0-1220" id="h79-0-1220" class="i">+	}
</a><a href="#h79-0-1221" id="h79-0-1221" class="i">+	if ((msgsz = msg[0]) &lt; 3) {
</a><a href="#h79-0-1222" id="h79-0-1222" class="i">+		fprintf(stderr, &quot;surf: message too short: %d\n&quot;, msgsz);
</a><a href="#h79-0-1223" id="h79-0-1223" class="i">+		return TRUE;
</a><a href="#h79-0-1224" id="h79-0-1224" class="i">+	}
</a><a href="#h79-0-1225" id="h79-0-1225" class="i">+
</a><a href="#h79-0-1226" id="h79-0-1226" class="i">+	switch (msg[2]) {
</a><a href="#h79-0-1227" id="h79-0-1227" class="i">+	case &#39;i&#39;:
</a><a href="#h79-0-1228" id="h79-0-1228" class="i">+		close(pipein[1]);
</a><a href="#h79-0-1229" id="h79-0-1229" class="i">+		close(pipeout[0]);
</a><a href="#h79-0-1230" id="h79-0-1230" class="i">+		break;
</a><a href="#h79-0-1231" id="h79-0-1231" class="i">+	}
</a><a href="#h79-0-1232" id="h79-0-1232" class="i">+
</a><a href="#h79-0-1233" id="h79-0-1233" class="i">+	return TRUE;
</a><a href="#h79-0-1234" id="h79-0-1234" class="i">+}
</a><a href="#h79-0-1235" id="h79-0-1235" class="i">+
</a><a href="#h79-0-1236" id="h79-0-1236" class="i">+void
</a><a href="#h79-0-1237" id="h79-0-1237" class="i">+initwebextensions(WebKitWebContext *wc, Client *c)
</a><a href="#h79-0-1238" id="h79-0-1238" class="i">+{
</a><a href="#h79-0-1239" id="h79-0-1239" class="i">+	GVariant *gv;
</a><a href="#h79-0-1240" id="h79-0-1240" class="i">+
</a><a href="#h79-0-1241" id="h79-0-1241" class="i">+	if (!pipeout[0] || !pipein[1])
</a><a href="#h79-0-1242" id="h79-0-1242" class="i">+		return;
</a><a href="#h79-0-1243" id="h79-0-1243" class="i">+
</a><a href="#h79-0-1244" id="h79-0-1244" class="i">+	gv = g_variant_new(&quot;(ii)&quot;, pipeout[0], pipein[1]);
</a><a href="#h79-0-1245" id="h79-0-1245" class="i">+
</a><a href="#h79-0-1246" id="h79-0-1246" class="i">+	webkit_web_context_set_web_extensions_initialization_user_data(wc, gv);
</a><a href="#h79-0-1247" id="h79-0-1247" class="i">+	webkit_web_context_set_web_extensions_directory(wc, WEBEXTDIR);
</a><a href="#h79-0-1248" id="h79-0-1248" class="i">+}
</a><a href="#h79-0-1249" id="h79-0-1249" class="i">+
</a><a href="#h79-0-1250" id="h79-0-1250" class="i">+GtkWidget *
</a><a href="#h79-0-1251" id="h79-0-1251" class="i">+createview(WebKitWebView *v, WebKitNavigationAction *a, Client *c)
</a><a href="#h79-0-1252" id="h79-0-1252" class="i">+{
</a><a href="#h79-0-1253" id="h79-0-1253" class="i">+	Client *n;
</a><a href="#h79-0-1254" id="h79-0-1254" class="i">+
</a><a href="#h79-0-1255" id="h79-0-1255" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h79-0-1256" id="h79-0-1256" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h79-0-1257" id="h79-0-1257" class="i">+		/*
</a><a href="#h79-0-1258" id="h79-0-1258" class="i">+		 * popup windows of type “other” are almost always triggered
</a><a href="#h79-0-1259" id="h79-0-1259" class="i">+		 * by user gesture, so inverse the logic here
</a><a href="#h79-0-1260" id="h79-0-1260" class="i">+		 */
</a><a href="#h79-0-1261" id="h79-0-1261" class="i">+/* instead of this, compare destination uri to mouse-over uri for validating window */
</a><a href="#h79-0-1262" id="h79-0-1262" class="i">+		if (webkit_navigation_action_is_user_gesture(a))
</a><a href="#h79-0-1263" id="h79-0-1263" class="i">+			return NULL;
</a><a href="#h79-0-1264" id="h79-0-1264" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h79-0-1265" id="h79-0-1265" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h79-0-1266" id="h79-0-1266" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h79-0-1267" id="h79-0-1267" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h79-0-1268" id="h79-0-1268" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h79-0-1269" id="h79-0-1269" class="i">+		n = newclient(c);
</a><a href="#h79-0-1270" id="h79-0-1270" class="i">+		break;
</a><a href="#h79-0-1271" id="h79-0-1271" class="i">+	default:
</a><a href="#h79-0-1272" id="h79-0-1272" class="i">+		return NULL;
</a><a href="#h79-0-1273" id="h79-0-1273" class="i">+	}
</a><a href="#h79-0-1274" id="h79-0-1274" class="i">+
</a><a href="#h79-0-1275" id="h79-0-1275" class="i">+	return GTK_WIDGET(n-&gt;view);
</a><a href="#h79-0-1276" id="h79-0-1276" class="i">+}
</a><a href="#h79-0-1277" id="h79-0-1277" class="i">+
</a><a href="#h79-0-1278" id="h79-0-1278" class="i">+gboolean
</a><a href="#h79-0-1279" id="h79-0-1279" class="i">+buttonreleased(GtkWidget *w, GdkEvent *e, Client *c)
</a><a href="#h79-0-1280" id="h79-0-1280" class="i">+{
</a><a href="#h79-0-1281" id="h79-0-1281" class="i">+	WebKitHitTestResultContext element;
</a><a href="#h79-0-1282" id="h79-0-1282" class="i">+	int i;
</a><a href="#h79-0-1283" id="h79-0-1283" class="i">+
</a><a href="#h79-0-1284" id="h79-0-1284" class="i">+	element = webkit_hit_test_result_get_context(c-&gt;mousepos);
</a><a href="#h79-0-1285" id="h79-0-1285" class="i">+
</a><a href="#h79-0-1286" id="h79-0-1286" class="i">+	for (i = 0; i &lt; LENGTH(buttons); ++i) {
</a><a href="#h79-0-1287" id="h79-0-1287" class="i">+		if (element &amp; buttons[i].target &amp;&amp;
</a><a href="#h79-0-1288" id="h79-0-1288" class="i">+		    e-&gt;button.button == buttons[i].button &amp;&amp;
</a><a href="#h79-0-1289" id="h79-0-1289" class="i">+		    CLEANMASK(e-&gt;button.state) == CLEANMASK(buttons[i].mask) &amp;&amp;
</a><a href="#h79-0-1290" id="h79-0-1290" class="i">+		    buttons[i].func) {
</a><a href="#h79-0-1291" id="h79-0-1291" class="i">+			buttons[i].func(c, &amp;buttons[i].arg, c-&gt;mousepos);
</a><a href="#h79-0-1292" id="h79-0-1292" class="i">+			return buttons[i].stopevent;
</a><a href="#h79-0-1293" id="h79-0-1293" class="i">+		}
</a><a href="#h79-0-1294" id="h79-0-1294" class="i">+	}
</a><a href="#h79-0-1295" id="h79-0-1295" class="i">+
</a><a href="#h79-0-1296" id="h79-0-1296" class="i">+	return FALSE;
</a><a href="#h79-0-1297" id="h79-0-1297" class="i">+}
</a><a href="#h79-0-1298" id="h79-0-1298" class="i">+
</a><a href="#h79-0-1299" id="h79-0-1299" class="i">+GdkFilterReturn
</a><a href="#h79-0-1300" id="h79-0-1300" class="i">+processx(GdkXEvent *e, GdkEvent *event, gpointer d)
</a><a href="#h79-0-1301" id="h79-0-1301" class="i">+{
</a><a href="#h79-0-1302" id="h79-0-1302" class="i">+	Client *c = (Client *)d;
</a><a href="#h79-0-1303" id="h79-0-1303" class="i">+	XPropertyEvent *ev;
</a><a href="#h79-0-1304" id="h79-0-1304" class="i">+	Arg a;
</a><a href="#h79-0-1305" id="h79-0-1305" class="i">+
</a><a href="#h79-0-1306" id="h79-0-1306" class="i">+	if (((XEvent *)e)-&gt;type == PropertyNotify) {
</a><a href="#h79-0-1307" id="h79-0-1307" class="i">+		ev = &amp;((XEvent *)e)-&gt;xproperty;
</a><a href="#h79-0-1308" id="h79-0-1308" class="i">+		if (ev-&gt;state == PropertyNewValue) {
</a><a href="#h79-0-1309" id="h79-0-1309" class="i">+			if (ev-&gt;atom == atoms[AtomFind]) {
</a><a href="#h79-0-1310" id="h79-0-1310" class="i">+				find(c, NULL);
</a><a href="#h79-0-1311" id="h79-0-1311" class="i">+
</a><a href="#h79-0-1312" id="h79-0-1312" class="i">+				return GDK_FILTER_REMOVE;
</a><a href="#h79-0-1313" id="h79-0-1313" class="i">+			} else if (ev-&gt;atom == atoms[AtomGo]) {
</a><a href="#h79-0-1314" id="h79-0-1314" class="i">+				a.v = getatom(c, AtomGo);
</a><a href="#h79-0-1315" id="h79-0-1315" class="i">+				loaduri(c, &amp;a);
</a><a href="#h79-0-1316" id="h79-0-1316" class="i">+
</a><a href="#h79-0-1317" id="h79-0-1317" class="i">+				return GDK_FILTER_REMOVE;
</a><a href="#h79-0-1318" id="h79-0-1318" class="i">+			}
</a><a href="#h79-0-1319" id="h79-0-1319" class="i">+		}
</a><a href="#h79-0-1320" id="h79-0-1320" class="i">+	}
</a><a href="#h79-0-1321" id="h79-0-1321" class="i">+	return GDK_FILTER_CONTINUE;
</a><a href="#h79-0-1322" id="h79-0-1322" class="i">+}
</a><a href="#h79-0-1323" id="h79-0-1323" class="i">+
</a><a href="#h79-0-1324" id="h79-0-1324" class="i">+gboolean
</a><a href="#h79-0-1325" id="h79-0-1325" class="i">+winevent(GtkWidget *w, GdkEvent *e, Client *c)
</a><a href="#h79-0-1326" id="h79-0-1326" class="i">+{
</a><a href="#h79-0-1327" id="h79-0-1327" class="i">+	int i;
</a><a href="#h79-0-1328" id="h79-0-1328" class="i">+
</a><a href="#h79-0-1329" id="h79-0-1329" class="i">+	switch (e-&gt;type) {
</a><a href="#h79-0-1330" id="h79-0-1330" class="i">+	case GDK_ENTER_NOTIFY:
</a><a href="#h79-0-1331" id="h79-0-1331" class="i">+		c-&gt;overtitle = c-&gt;targeturi;
</a><a href="#h79-0-1332" id="h79-0-1332" class="i">+		updatetitle(c);
</a><a href="#h79-0-1333" id="h79-0-1333" class="i">+		break;
</a><a href="#h79-0-1334" id="h79-0-1334" class="i">+	case GDK_KEY_PRESS:
</a><a href="#h79-0-1335" id="h79-0-1335" class="i">+		if (!curconfig[KioskMode].val.i) {
</a><a href="#h79-0-1336" id="h79-0-1336" class="i">+			for (i = 0; i &lt; LENGTH(keys); ++i) {
</a><a href="#h79-0-1337" id="h79-0-1337" class="i">+				if (gdk_keyval_to_lower(e-&gt;key.keyval) ==
</a><a href="#h79-0-1338" id="h79-0-1338" class="i">+				    keys[i].keyval &amp;&amp;
</a><a href="#h79-0-1339" id="h79-0-1339" class="i">+				    CLEANMASK(e-&gt;key.state) == keys[i].mod &amp;&amp;
</a><a href="#h79-0-1340" id="h79-0-1340" class="i">+				    keys[i].func) {
</a><a href="#h79-0-1341" id="h79-0-1341" class="i">+					updatewinid(c);
</a><a href="#h79-0-1342" id="h79-0-1342" class="i">+					keys[i].func(c, &amp;(keys[i].arg));
</a><a href="#h79-0-1343" id="h79-0-1343" class="i">+					return TRUE;
</a><a href="#h79-0-1344" id="h79-0-1344" class="i">+				}
</a><a href="#h79-0-1345" id="h79-0-1345" class="i">+			}
</a><a href="#h79-0-1346" id="h79-0-1346" class="i">+		}
</a><a href="#h79-0-1347" id="h79-0-1347" class="i">+	case GDK_LEAVE_NOTIFY:
</a><a href="#h79-0-1348" id="h79-0-1348" class="i">+		c-&gt;overtitle = NULL;
</a><a href="#h79-0-1349" id="h79-0-1349" class="i">+		updatetitle(c);
</a><a href="#h79-0-1350" id="h79-0-1350" class="i">+		break;
</a><a href="#h79-0-1351" id="h79-0-1351" class="i">+	case GDK_WINDOW_STATE:
</a><a href="#h79-0-1352" id="h79-0-1352" class="i">+		if (e-&gt;window_state.changed_mask ==
</a><a href="#h79-0-1353" id="h79-0-1353" class="i">+		    GDK_WINDOW_STATE_FULLSCREEN)
</a><a href="#h79-0-1354" id="h79-0-1354" class="i">+			c-&gt;fullscreen = e-&gt;window_state.new_window_state &amp;
</a><a href="#h79-0-1355" id="h79-0-1355" class="i">+			                GDK_WINDOW_STATE_FULLSCREEN;
</a><a href="#h79-0-1356" id="h79-0-1356" class="i">+		break;
</a><a href="#h79-0-1357" id="h79-0-1357" class="i">+	default:
</a><a href="#h79-0-1358" id="h79-0-1358" class="i">+		break;
</a><a href="#h79-0-1359" id="h79-0-1359" class="i">+	}
</a><a href="#h79-0-1360" id="h79-0-1360" class="i">+
</a><a href="#h79-0-1361" id="h79-0-1361" class="i">+	return FALSE;
</a><a href="#h79-0-1362" id="h79-0-1362" class="i">+}
</a><a href="#h79-0-1363" id="h79-0-1363" class="i">+
</a><a href="#h79-0-1364" id="h79-0-1364" class="i">+void
</a><a href="#h79-0-1365" id="h79-0-1365" class="i">+showview(WebKitWebView *v, Client *c)
</a><a href="#h79-0-1366" id="h79-0-1366" class="i">+{
</a><a href="#h79-0-1367" id="h79-0-1367" class="i">+	GdkRGBA bgcolor = { 0 };
</a><a href="#h79-0-1368" id="h79-0-1368" class="i">+	GdkWindow *gwin;
</a><a href="#h79-0-1369" id="h79-0-1369" class="i">+
</a><a href="#h79-0-1370" id="h79-0-1370" class="i">+	c-&gt;finder = webkit_web_view_get_find_controller(c-&gt;view);
</a><a href="#h79-0-1371" id="h79-0-1371" class="i">+	c-&gt;inspector = webkit_web_view_get_inspector(c-&gt;view);
</a><a href="#h79-0-1372" id="h79-0-1372" class="i">+
</a><a href="#h79-0-1373" id="h79-0-1373" class="i">+	c-&gt;pageid = webkit_web_view_get_page_id(c-&gt;view);
</a><a href="#h79-0-1374" id="h79-0-1374" class="i">+	c-&gt;win = createwindow(c);
</a><a href="#h79-0-1375" id="h79-0-1375" class="i">+
</a><a href="#h79-0-1376" id="h79-0-1376" class="i">+	gtk_container_add(GTK_CONTAINER(c-&gt;win), GTK_WIDGET(c-&gt;view));
</a><a href="#h79-0-1377" id="h79-0-1377" class="i">+	gtk_widget_show_all(c-&gt;win);
</a><a href="#h79-0-1378" id="h79-0-1378" class="i">+	gtk_widget_grab_focus(GTK_WIDGET(c-&gt;view));
</a><a href="#h79-0-1379" id="h79-0-1379" class="i">+
</a><a href="#h79-0-1380" id="h79-0-1380" class="i">+	gwin = gtk_widget_get_window(GTK_WIDGET(c-&gt;win));
</a><a href="#h79-0-1381" id="h79-0-1381" class="i">+	c-&gt;xid = gdk_x11_window_get_xid(gwin);
</a><a href="#h79-0-1382" id="h79-0-1382" class="i">+	updatewinid(c);
</a><a href="#h79-0-1383" id="h79-0-1383" class="i">+	if (showxid) {
</a><a href="#h79-0-1384" id="h79-0-1384" class="i">+		gdk_display_sync(gtk_widget_get_display(c-&gt;win));
</a><a href="#h79-0-1385" id="h79-0-1385" class="i">+		puts(winid);
</a><a href="#h79-0-1386" id="h79-0-1386" class="i">+		fflush(stdout);
</a><a href="#h79-0-1387" id="h79-0-1387" class="i">+	}
</a><a href="#h79-0-1388" id="h79-0-1388" class="i">+
</a><a href="#h79-0-1389" id="h79-0-1389" class="i">+	if (curconfig[HideBackground].val.i)
</a><a href="#h79-0-1390" id="h79-0-1390" class="i">+		webkit_web_view_set_background_color(c-&gt;view, &amp;bgcolor);
</a><a href="#h79-0-1391" id="h79-0-1391" class="i">+
</a><a href="#h79-0-1392" id="h79-0-1392" class="i">+	if (!curconfig[KioskMode].val.i) {
</a><a href="#h79-0-1393" id="h79-0-1393" class="i">+		gdk_window_set_events(gwin, GDK_ALL_EVENTS_MASK);
</a><a href="#h79-0-1394" id="h79-0-1394" class="i">+		gdk_window_add_filter(gwin, processx, c);
</a><a href="#h79-0-1395" id="h79-0-1395" class="i">+	}
</a><a href="#h79-0-1396" id="h79-0-1396" class="i">+
</a><a href="#h79-0-1397" id="h79-0-1397" class="i">+	if (curconfig[RunInFullscreen].val.i)
</a><a href="#h79-0-1398" id="h79-0-1398" class="i">+		togglefullscreen(c, NULL);
</a><a href="#h79-0-1399" id="h79-0-1399" class="i">+
</a><a href="#h79-0-1400" id="h79-0-1400" class="i">+	if (curconfig[ZoomLevel].val.f != 1.0)
</a><a href="#h79-0-1401" id="h79-0-1401" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view,
</a><a href="#h79-0-1402" id="h79-0-1402" class="i">+		                               curconfig[ZoomLevel].val.f);
</a><a href="#h79-0-1403" id="h79-0-1403" class="i">+
</a><a href="#h79-0-1404" id="h79-0-1404" class="i">+	setatom(c, AtomFind, &quot;&quot;);
</a><a href="#h79-0-1405" id="h79-0-1405" class="i">+	setatom(c, AtomUri, &quot;about:blank&quot;);
</a><a href="#h79-0-1406" id="h79-0-1406" class="i">+}
</a><a href="#h79-0-1407" id="h79-0-1407" class="i">+
</a><a href="#h79-0-1408" id="h79-0-1408" class="i">+GtkWidget *
</a><a href="#h79-0-1409" id="h79-0-1409" class="i">+createwindow(Client *c)
</a><a href="#h79-0-1410" id="h79-0-1410" class="i">+{
</a><a href="#h79-0-1411" id="h79-0-1411" class="i">+	char *wmstr;
</a><a href="#h79-0-1412" id="h79-0-1412" class="i">+	GtkWidget *w;
</a><a href="#h79-0-1413" id="h79-0-1413" class="i">+
</a><a href="#h79-0-1414" id="h79-0-1414" class="i">+	if (embed) {
</a><a href="#h79-0-1415" id="h79-0-1415" class="i">+		w = gtk_plug_new(embed);
</a><a href="#h79-0-1416" id="h79-0-1416" class="i">+	} else {
</a><a href="#h79-0-1417" id="h79-0-1417" class="i">+		w = gtk_window_new(GTK_WINDOW_TOPLEVEL);
</a><a href="#h79-0-1418" id="h79-0-1418" class="i">+
</a><a href="#h79-0-1419" id="h79-0-1419" class="i">+		wmstr = g_path_get_basename(argv0);
</a><a href="#h79-0-1420" id="h79-0-1420" class="i">+		gtk_window_set_wmclass(GTK_WINDOW(w), wmstr, &quot;Surf&quot;);
</a><a href="#h79-0-1421" id="h79-0-1421" class="i">+		g_free(wmstr);
</a><a href="#h79-0-1422" id="h79-0-1422" class="i">+
</a><a href="#h79-0-1423" id="h79-0-1423" class="i">+		wmstr = g_strdup_printf(&quot;%s[%lu]&quot;, &quot;Surf&quot;, c-&gt;pageid);
</a><a href="#h79-0-1424" id="h79-0-1424" class="i">+		gtk_window_set_role(GTK_WINDOW(w), wmstr);
</a><a href="#h79-0-1425" id="h79-0-1425" class="i">+		g_free(wmstr);
</a><a href="#h79-0-1426" id="h79-0-1426" class="i">+
</a><a href="#h79-0-1427" id="h79-0-1427" class="i">+		gtk_window_set_default_size(GTK_WINDOW(w), winsize[0], winsize[1]);
</a><a href="#h79-0-1428" id="h79-0-1428" class="i">+	}
</a><a href="#h79-0-1429" id="h79-0-1429" class="i">+
</a><a href="#h79-0-1430" id="h79-0-1430" class="i">+	g_signal_connect(G_OBJECT(w), &quot;destroy&quot;,
</a><a href="#h79-0-1431" id="h79-0-1431" class="i">+	                 G_CALLBACK(destroywin), c);
</a><a href="#h79-0-1432" id="h79-0-1432" class="i">+	g_signal_connect(G_OBJECT(w), &quot;enter-notify-event&quot;,
</a><a href="#h79-0-1433" id="h79-0-1433" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h79-0-1434" id="h79-0-1434" class="i">+	g_signal_connect(G_OBJECT(w), &quot;key-press-event&quot;,
</a><a href="#h79-0-1435" id="h79-0-1435" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h79-0-1436" id="h79-0-1436" class="i">+	g_signal_connect(G_OBJECT(w), &quot;leave-notify-event&quot;,
</a><a href="#h79-0-1437" id="h79-0-1437" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h79-0-1438" id="h79-0-1438" class="i">+	g_signal_connect(G_OBJECT(w), &quot;window-state-event&quot;,
</a><a href="#h79-0-1439" id="h79-0-1439" class="i">+	                 G_CALLBACK(winevent), c);
</a><a href="#h79-0-1440" id="h79-0-1440" class="i">+
</a><a href="#h79-0-1441" id="h79-0-1441" class="i">+	return w;
</a><a href="#h79-0-1442" id="h79-0-1442" class="i">+}
</a><a href="#h79-0-1443" id="h79-0-1443" class="i">+
</a><a href="#h79-0-1444" id="h79-0-1444" class="i">+gboolean
</a><a href="#h79-0-1445" id="h79-0-1445" class="i">+loadfailedtls(WebKitWebView *v, gchar *uri, GTlsCertificate *cert,
</a><a href="#h79-0-1446" id="h79-0-1446" class="i">+              GTlsCertificateFlags err, Client *c)
</a><a href="#h79-0-1447" id="h79-0-1447" class="i">+{
</a><a href="#h79-0-1448" id="h79-0-1448" class="i">+	GString *errmsg = g_string_new(NULL);
</a><a href="#h79-0-1449" id="h79-0-1449" class="i">+	gchar *html, *pem;
</a><a href="#h79-0-1450" id="h79-0-1450" class="i">+
</a><a href="#h79-0-1451" id="h79-0-1451" class="i">+	c-&gt;failedcert = g_object_ref(cert);
</a><a href="#h79-0-1452" id="h79-0-1452" class="i">+	c-&gt;tlserr = err;
</a><a href="#h79-0-1453" id="h79-0-1453" class="i">+	c-&gt;errorpage = 1;
</a><a href="#h79-0-1454" id="h79-0-1454" class="i">+
</a><a href="#h79-0-1455" id="h79-0-1455" class="i">+	if (err &amp; G_TLS_CERTIFICATE_UNKNOWN_CA)
</a><a href="#h79-0-1456" id="h79-0-1456" class="i">+		g_string_append(errmsg,
</a><a href="#h79-0-1457" id="h79-0-1457" class="i">+		    &quot;The signing certificate authority is not known.&lt;br&gt;&quot;);
</a><a href="#h79-0-1458" id="h79-0-1458" class="i">+	if (err &amp; G_TLS_CERTIFICATE_BAD_IDENTITY)
</a><a href="#h79-0-1459" id="h79-0-1459" class="i">+		g_string_append(errmsg,
</a><a href="#h79-0-1460" id="h79-0-1460" class="i">+		    &quot;The certificate does not match the expected identity &quot;
</a><a href="#h79-0-1461" id="h79-0-1461" class="i">+		    &quot;of the site that it was retrieved from.&lt;br&gt;&quot;);
</a><a href="#h79-0-1462" id="h79-0-1462" class="i">+	if (err &amp; G_TLS_CERTIFICATE_NOT_ACTIVATED)
</a><a href="#h79-0-1463" id="h79-0-1463" class="i">+		g_string_append(errmsg,
</a><a href="#h79-0-1464" id="h79-0-1464" class="i">+		    &quot;The certificate&#39;s activation time &quot;
</a><a href="#h79-0-1465" id="h79-0-1465" class="i">+		    &quot;is still in the future.&lt;br&gt;&quot;);
</a><a href="#h79-0-1466" id="h79-0-1466" class="i">+	if (err &amp; G_TLS_CERTIFICATE_EXPIRED)
</a><a href="#h79-0-1467" id="h79-0-1467" class="i">+		g_string_append(errmsg, &quot;The certificate has expired.&lt;br&gt;&quot;);
</a><a href="#h79-0-1468" id="h79-0-1468" class="i">+	if (err &amp; G_TLS_CERTIFICATE_REVOKED)
</a><a href="#h79-0-1469" id="h79-0-1469" class="i">+		g_string_append(errmsg,
</a><a href="#h79-0-1470" id="h79-0-1470" class="i">+		    &quot;The certificate has been revoked according to &quot;
</a><a href="#h79-0-1471" id="h79-0-1471" class="i">+		    &quot;the GTlsConnection&#39;s certificate revocation list.&lt;br&gt;&quot;);
</a><a href="#h79-0-1472" id="h79-0-1472" class="i">+	if (err &amp; G_TLS_CERTIFICATE_INSECURE)
</a><a href="#h79-0-1473" id="h79-0-1473" class="i">+		g_string_append(errmsg,
</a><a href="#h79-0-1474" id="h79-0-1474" class="i">+		    &quot;The certificate&#39;s algorithm is considered insecure.&lt;br&gt;&quot;);
</a><a href="#h79-0-1475" id="h79-0-1475" class="i">+	if (err &amp; G_TLS_CERTIFICATE_GENERIC_ERROR)
</a><a href="#h79-0-1476" id="h79-0-1476" class="i">+		g_string_append(errmsg,
</a><a href="#h79-0-1477" id="h79-0-1477" class="i">+		    &quot;Some error occurred validating the certificate.&lt;br&gt;&quot;);
</a><a href="#h79-0-1478" id="h79-0-1478" class="i">+
</a><a href="#h79-0-1479" id="h79-0-1479" class="i">+	g_object_get(cert, &quot;certificate-pem&quot;, &amp;pem, NULL);
</a><a href="#h79-0-1480" id="h79-0-1480" class="i">+	html = g_strdup_printf(&quot;&lt;p&gt;Could not validate TLS for “%s”&lt;br&gt;%s&lt;/p&gt;&quot;
</a><a href="#h79-0-1481" id="h79-0-1481" class="i">+	                       &quot;&lt;p&gt;You can inspect the following certificate &quot;
</a><a href="#h79-0-1482" id="h79-0-1482" class="i">+	                       &quot;with Ctrl-t (default keybinding).&lt;/p&gt;&quot;
</a><a href="#h79-0-1483" id="h79-0-1483" class="i">+	                       &quot;&lt;p&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/p&gt;&quot;, uri, errmsg-&gt;str, pem);
</a><a href="#h79-0-1484" id="h79-0-1484" class="i">+	g_free(pem);
</a><a href="#h79-0-1485" id="h79-0-1485" class="i">+	g_string_free(errmsg, TRUE);
</a><a href="#h79-0-1486" id="h79-0-1486" class="i">+
</a><a href="#h79-0-1487" id="h79-0-1487" class="i">+	webkit_web_view_load_alternate_html(c-&gt;view, html, uri, NULL);
</a><a href="#h79-0-1488" id="h79-0-1488" class="i">+	g_free(html);
</a><a href="#h79-0-1489" id="h79-0-1489" class="i">+
</a><a href="#h79-0-1490" id="h79-0-1490" class="i">+	return TRUE;
</a><a href="#h79-0-1491" id="h79-0-1491" class="i">+}
</a><a href="#h79-0-1492" id="h79-0-1492" class="i">+
</a><a href="#h79-0-1493" id="h79-0-1493" class="i">+void
</a><a href="#h79-0-1494" id="h79-0-1494" class="i">+loadchanged(WebKitWebView *v, WebKitLoadEvent e, Client *c)
</a><a href="#h79-0-1495" id="h79-0-1495" class="i">+{
</a><a href="#h79-0-1496" id="h79-0-1496" class="i">+	const char *uri = geturi(c);
</a><a href="#h79-0-1497" id="h79-0-1497" class="i">+
</a><a href="#h79-0-1498" id="h79-0-1498" class="i">+	switch (e) {
</a><a href="#h79-0-1499" id="h79-0-1499" class="i">+	case WEBKIT_LOAD_STARTED:
</a><a href="#h79-0-1500" id="h79-0-1500" class="i">+		setatom(c, AtomUri, uri);
</a><a href="#h79-0-1501" id="h79-0-1501" class="i">+		c-&gt;title = uri;
</a><a href="#h79-0-1502" id="h79-0-1502" class="i">+		c-&gt;https = c-&gt;insecure = 0;
</a><a href="#h79-0-1503" id="h79-0-1503" class="i">+		seturiparameters(c, uri, loadtransient);
</a><a href="#h79-0-1504" id="h79-0-1504" class="i">+		if (c-&gt;errorpage)
</a><a href="#h79-0-1505" id="h79-0-1505" class="i">+			c-&gt;errorpage = 0;
</a><a href="#h79-0-1506" id="h79-0-1506" class="i">+		else
</a><a href="#h79-0-1507" id="h79-0-1507" class="i">+			g_clear_object(&amp;c-&gt;failedcert);
</a><a href="#h79-0-1508" id="h79-0-1508" class="i">+		break;
</a><a href="#h79-0-1509" id="h79-0-1509" class="i">+	case WEBKIT_LOAD_REDIRECTED:
</a><a href="#h79-0-1510" id="h79-0-1510" class="i">+		setatom(c, AtomUri, uri);
</a><a href="#h79-0-1511" id="h79-0-1511" class="i">+		c-&gt;title = uri;
</a><a href="#h79-0-1512" id="h79-0-1512" class="i">+		seturiparameters(c, uri, loadtransient);
</a><a href="#h79-0-1513" id="h79-0-1513" class="i">+		break;
</a><a href="#h79-0-1514" id="h79-0-1514" class="i">+	case WEBKIT_LOAD_COMMITTED:
</a><a href="#h79-0-1515" id="h79-0-1515" class="i">+		seturiparameters(c, uri, loadcommitted);
</a><a href="#h79-0-1516" id="h79-0-1516" class="i">+		c-&gt;https = webkit_web_view_get_tls_info(c-&gt;view, &amp;c-&gt;cert,
</a><a href="#h79-0-1517" id="h79-0-1517" class="i">+		                                        &amp;c-&gt;tlserr);
</a><a href="#h79-0-1518" id="h79-0-1518" class="i">+		break;
</a><a href="#h79-0-1519" id="h79-0-1519" class="i">+	case WEBKIT_LOAD_FINISHED:
</a><a href="#h79-0-1520" id="h79-0-1520" class="i">+		seturiparameters(c, uri, loadfinished);
</a><a href="#h79-0-1521" id="h79-0-1521" class="i">+		/* Disabled until we write some WebKitWebExtension for
</a><a href="#h79-0-1522" id="h79-0-1522" class="i">+		 * manipulating the DOM directly.
</a><a href="#h79-0-1523" id="h79-0-1523" class="i">+		evalscript(c, &quot;document.documentElement.style.overflow = &#39;%s&#39;&quot;,
</a><a href="#h79-0-1524" id="h79-0-1524" class="i">+		    enablescrollbars ? &quot;auto&quot; : &quot;hidden&quot;);
</a><a href="#h79-0-1525" id="h79-0-1525" class="i">+		*/
</a><a href="#h79-0-1526" id="h79-0-1526" class="i">+		runscript(c);
</a><a href="#h79-0-1527" id="h79-0-1527" class="i">+		break;
</a><a href="#h79-0-1528" id="h79-0-1528" class="i">+	}
</a><a href="#h79-0-1529" id="h79-0-1529" class="i">+	updatetitle(c);
</a><a href="#h79-0-1530" id="h79-0-1530" class="i">+}
</a><a href="#h79-0-1531" id="h79-0-1531" class="i">+
</a><a href="#h79-0-1532" id="h79-0-1532" class="i">+void
</a><a href="#h79-0-1533" id="h79-0-1533" class="i">+progresschanged(WebKitWebView *v, GParamSpec *ps, Client *c)
</a><a href="#h79-0-1534" id="h79-0-1534" class="i">+{
</a><a href="#h79-0-1535" id="h79-0-1535" class="i">+	c-&gt;progress = webkit_web_view_get_estimated_load_progress(c-&gt;view) *
</a><a href="#h79-0-1536" id="h79-0-1536" class="i">+	              100;
</a><a href="#h79-0-1537" id="h79-0-1537" class="i">+	updatetitle(c);
</a><a href="#h79-0-1538" id="h79-0-1538" class="i">+}
</a><a href="#h79-0-1539" id="h79-0-1539" class="i">+
</a><a href="#h79-0-1540" id="h79-0-1540" class="i">+void
</a><a href="#h79-0-1541" id="h79-0-1541" class="i">+titlechanged(WebKitWebView *view, GParamSpec *ps, Client *c)
</a><a href="#h79-0-1542" id="h79-0-1542" class="i">+{
</a><a href="#h79-0-1543" id="h79-0-1543" class="i">+	c-&gt;title = webkit_web_view_get_title(c-&gt;view);
</a><a href="#h79-0-1544" id="h79-0-1544" class="i">+	updatetitle(c);
</a><a href="#h79-0-1545" id="h79-0-1545" class="i">+}
</a><a href="#h79-0-1546" id="h79-0-1546" class="i">+
</a><a href="#h79-0-1547" id="h79-0-1547" class="i">+void
</a><a href="#h79-0-1548" id="h79-0-1548" class="i">+mousetargetchanged(WebKitWebView *v, WebKitHitTestResult *h, guint modifiers,
</a><a href="#h79-0-1549" id="h79-0-1549" class="i">+    Client *c)
</a><a href="#h79-0-1550" id="h79-0-1550" class="i">+{
</a><a href="#h79-0-1551" id="h79-0-1551" class="i">+	WebKitHitTestResultContext hc = webkit_hit_test_result_get_context(h);
</a><a href="#h79-0-1552" id="h79-0-1552" class="i">+
</a><a href="#h79-0-1553" id="h79-0-1553" class="i">+	/* Keep the hit test to know where is the pointer on the next click */
</a><a href="#h79-0-1554" id="h79-0-1554" class="i">+	c-&gt;mousepos = h;
</a><a href="#h79-0-1555" id="h79-0-1555" class="i">+
</a><a href="#h79-0-1556" id="h79-0-1556" class="i">+	if (hc &amp; OnLink)
</a><a href="#h79-0-1557" id="h79-0-1557" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h79-0-1558" id="h79-0-1558" class="i">+	else if (hc &amp; OnImg)
</a><a href="#h79-0-1559" id="h79-0-1559" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_image_uri(h);
</a><a href="#h79-0-1560" id="h79-0-1560" class="i">+	else if (hc &amp; OnMedia)
</a><a href="#h79-0-1561" id="h79-0-1561" class="i">+		c-&gt;targeturi = webkit_hit_test_result_get_media_uri(h);
</a><a href="#h79-0-1562" id="h79-0-1562" class="i">+	else
</a><a href="#h79-0-1563" id="h79-0-1563" class="i">+		c-&gt;targeturi = NULL;
</a><a href="#h79-0-1564" id="h79-0-1564" class="i">+
</a><a href="#h79-0-1565" id="h79-0-1565" class="i">+	c-&gt;overtitle = c-&gt;targeturi;
</a><a href="#h79-0-1566" id="h79-0-1566" class="i">+	updatetitle(c);
</a><a href="#h79-0-1567" id="h79-0-1567" class="i">+}
</a><a href="#h79-0-1568" id="h79-0-1568" class="i">+
</a><a href="#h79-0-1569" id="h79-0-1569" class="i">+gboolean
</a><a href="#h79-0-1570" id="h79-0-1570" class="i">+permissionrequested(WebKitWebView *v, WebKitPermissionRequest *r, Client *c)
</a><a href="#h79-0-1571" id="h79-0-1571" class="i">+{
</a><a href="#h79-0-1572" id="h79-0-1572" class="i">+	ParamName param = ParameterLast;
</a><a href="#h79-0-1573" id="h79-0-1573" class="i">+
</a><a href="#h79-0-1574" id="h79-0-1574" class="i">+	if (WEBKIT_IS_GEOLOCATION_PERMISSION_REQUEST(r)) {
</a><a href="#h79-0-1575" id="h79-0-1575" class="i">+		param = Geolocation;
</a><a href="#h79-0-1576" id="h79-0-1576" class="i">+	} else if (WEBKIT_IS_USER_MEDIA_PERMISSION_REQUEST(r)) {
</a><a href="#h79-0-1577" id="h79-0-1577" class="i">+		if (webkit_user_media_permission_is_for_audio_device(
</a><a href="#h79-0-1578" id="h79-0-1578" class="i">+		    WEBKIT_USER_MEDIA_PERMISSION_REQUEST(r)))
</a><a href="#h79-0-1579" id="h79-0-1579" class="i">+			param = AccessMicrophone;
</a><a href="#h79-0-1580" id="h79-0-1580" class="i">+		else if (webkit_user_media_permission_is_for_video_device(
</a><a href="#h79-0-1581" id="h79-0-1581" class="i">+		         WEBKIT_USER_MEDIA_PERMISSION_REQUEST(r)))
</a><a href="#h79-0-1582" id="h79-0-1582" class="i">+			param = AccessWebcam;
</a><a href="#h79-0-1583" id="h79-0-1583" class="i">+	} else {
</a><a href="#h79-0-1584" id="h79-0-1584" class="i">+		return FALSE;
</a><a href="#h79-0-1585" id="h79-0-1585" class="i">+	}
</a><a href="#h79-0-1586" id="h79-0-1586" class="i">+
</a><a href="#h79-0-1587" id="h79-0-1587" class="i">+	if (curconfig[param].val.i)
</a><a href="#h79-0-1588" id="h79-0-1588" class="i">+		webkit_permission_request_allow(r);
</a><a href="#h79-0-1589" id="h79-0-1589" class="i">+	else
</a><a href="#h79-0-1590" id="h79-0-1590" class="i">+		webkit_permission_request_deny(r);
</a><a href="#h79-0-1591" id="h79-0-1591" class="i">+
</a><a href="#h79-0-1592" id="h79-0-1592" class="i">+	return TRUE;
</a><a href="#h79-0-1593" id="h79-0-1593" class="i">+}
</a><a href="#h79-0-1594" id="h79-0-1594" class="i">+
</a><a href="#h79-0-1595" id="h79-0-1595" class="i">+gboolean
</a><a href="#h79-0-1596" id="h79-0-1596" class="i">+decidepolicy(WebKitWebView *v, WebKitPolicyDecision *d,
</a><a href="#h79-0-1597" id="h79-0-1597" class="i">+    WebKitPolicyDecisionType dt, Client *c)
</a><a href="#h79-0-1598" id="h79-0-1598" class="i">+{
</a><a href="#h79-0-1599" id="h79-0-1599" class="i">+	switch (dt) {
</a><a href="#h79-0-1600" id="h79-0-1600" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_NAVIGATION_ACTION:
</a><a href="#h79-0-1601" id="h79-0-1601" class="i">+		decidenavigation(d, c);
</a><a href="#h79-0-1602" id="h79-0-1602" class="i">+		break;
</a><a href="#h79-0-1603" id="h79-0-1603" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_NEW_WINDOW_ACTION:
</a><a href="#h79-0-1604" id="h79-0-1604" class="i">+		decidenewwindow(d, c);
</a><a href="#h79-0-1605" id="h79-0-1605" class="i">+		break;
</a><a href="#h79-0-1606" id="h79-0-1606" class="i">+	case WEBKIT_POLICY_DECISION_TYPE_RESPONSE:
</a><a href="#h79-0-1607" id="h79-0-1607" class="i">+		decideresource(d, c);
</a><a href="#h79-0-1608" id="h79-0-1608" class="i">+		break;
</a><a href="#h79-0-1609" id="h79-0-1609" class="i">+	default:
</a><a href="#h79-0-1610" id="h79-0-1610" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h79-0-1611" id="h79-0-1611" class="i">+		break;
</a><a href="#h79-0-1612" id="h79-0-1612" class="i">+	}
</a><a href="#h79-0-1613" id="h79-0-1613" class="i">+	return TRUE;
</a><a href="#h79-0-1614" id="h79-0-1614" class="i">+}
</a><a href="#h79-0-1615" id="h79-0-1615" class="i">+
</a><a href="#h79-0-1616" id="h79-0-1616" class="i">+void
</a><a href="#h79-0-1617" id="h79-0-1617" class="i">+decidenavigation(WebKitPolicyDecision *d, Client *c)
</a><a href="#h79-0-1618" id="h79-0-1618" class="i">+{
</a><a href="#h79-0-1619" id="h79-0-1619" class="i">+	WebKitNavigationAction *a =
</a><a href="#h79-0-1620" id="h79-0-1620" class="i">+	    webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h79-0-1621" id="h79-0-1621" class="i">+	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h79-0-1622" id="h79-0-1622" class="i">+
</a><a href="#h79-0-1623" id="h79-0-1623" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h79-0-1624" id="h79-0-1624" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h79-0-1625" id="h79-0-1625" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h79-0-1626" id="h79-0-1626" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h79-0-1627" id="h79-0-1627" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h79-0-1628" id="h79-0-1628" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED: /* fallthrough */
</a><a href="#h79-0-1629" id="h79-0-1629" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h79-0-1630" id="h79-0-1630" class="i">+	default:
</a><a href="#h79-0-1631" id="h79-0-1631" class="i">+		/* Do not navigate to links with a &quot;_blank&quot; target (popup) */
</a><a href="#h79-0-1632" id="h79-0-1632" class="i">+		if (webkit_navigation_policy_decision_get_frame_name(
</a><a href="#h79-0-1633" id="h79-0-1633" class="i">+		    WEBKIT_NAVIGATION_POLICY_DECISION(d))) {
</a><a href="#h79-0-1634" id="h79-0-1634" class="i">+			webkit_policy_decision_ignore(d);
</a><a href="#h79-0-1635" id="h79-0-1635" class="i">+		} else {
</a><a href="#h79-0-1636" id="h79-0-1636" class="i">+			/* Filter out navigation to different domain ? */
</a><a href="#h79-0-1637" id="h79-0-1637" class="i">+			/* get action→urirequest, copy and load in new window+view
</a><a href="#h79-0-1638" id="h79-0-1638" class="i">+			 * on Ctrl+Click ? */
</a><a href="#h79-0-1639" id="h79-0-1639" class="i">+			webkit_policy_decision_use(d);
</a><a href="#h79-0-1640" id="h79-0-1640" class="i">+		}
</a><a href="#h79-0-1641" id="h79-0-1641" class="i">+		break;
</a><a href="#h79-0-1642" id="h79-0-1642" class="i">+	}
</a><a href="#h79-0-1643" id="h79-0-1643" class="i">+}
</a><a href="#h79-0-1644" id="h79-0-1644" class="i">+
</a><a href="#h79-0-1645" id="h79-0-1645" class="i">+void
</a><a href="#h79-0-1646" id="h79-0-1646" class="i">+decidenewwindow(WebKitPolicyDecision *d, Client *c)
</a><a href="#h79-0-1647" id="h79-0-1647" class="i">+{
</a><a href="#h79-0-1648" id="h79-0-1648" class="i">+	Arg arg;
</a><a href="#h79-0-1649" id="h79-0-1649" class="i">+	WebKitNavigationAction *a =
</a><a href="#h79-0-1650" id="h79-0-1650" class="i">+	    webkit_navigation_policy_decision_get_navigation_action(
</a><a href="#h79-0-1651" id="h79-0-1651" class="i">+	    WEBKIT_NAVIGATION_POLICY_DECISION(d));
</a><a href="#h79-0-1652" id="h79-0-1652" class="i">+
</a><a href="#h79-0-1653" id="h79-0-1653" class="i">+
</a><a href="#h79-0-1654" id="h79-0-1654" class="i">+	switch (webkit_navigation_action_get_navigation_type(a)) {
</a><a href="#h79-0-1655" id="h79-0-1655" class="i">+	case WEBKIT_NAVIGATION_TYPE_LINK_CLICKED: /* fallthrough */
</a><a href="#h79-0-1656" id="h79-0-1656" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_SUBMITTED: /* fallthrough */
</a><a href="#h79-0-1657" id="h79-0-1657" class="i">+	case WEBKIT_NAVIGATION_TYPE_BACK_FORWARD: /* fallthrough */
</a><a href="#h79-0-1658" id="h79-0-1658" class="i">+	case WEBKIT_NAVIGATION_TYPE_RELOAD: /* fallthrough */
</a><a href="#h79-0-1659" id="h79-0-1659" class="i">+	case WEBKIT_NAVIGATION_TYPE_FORM_RESUBMITTED:
</a><a href="#h79-0-1660" id="h79-0-1660" class="i">+		/* Filter domains here */
</a><a href="#h79-0-1661" id="h79-0-1661" class="i">+/* If the value of “mouse-button” is not 0, then the navigation was triggered by a mouse event.
</a><a href="#h79-0-1662" id="h79-0-1662" class="i">+ * test for link clicked but no button ? */
</a><a href="#h79-0-1663" id="h79-0-1663" class="i">+		arg.v = webkit_uri_request_get_uri(
</a><a href="#h79-0-1664" id="h79-0-1664" class="i">+		        webkit_navigation_action_get_request(a));
</a><a href="#h79-0-1665" id="h79-0-1665" class="i">+		newwindow(c, &amp;arg, 0);
</a><a href="#h79-0-1666" id="h79-0-1666" class="i">+		break;
</a><a href="#h79-0-1667" id="h79-0-1667" class="i">+	case WEBKIT_NAVIGATION_TYPE_OTHER: /* fallthrough */
</a><a href="#h79-0-1668" id="h79-0-1668" class="i">+	default:
</a><a href="#h79-0-1669" id="h79-0-1669" class="i">+		break;
</a><a href="#h79-0-1670" id="h79-0-1670" class="i">+	}
</a><a href="#h79-0-1671" id="h79-0-1671" class="i">+
</a><a href="#h79-0-1672" id="h79-0-1672" class="i">+	webkit_policy_decision_ignore(d);
</a><a href="#h79-0-1673" id="h79-0-1673" class="i">+}
</a><a href="#h79-0-1674" id="h79-0-1674" class="i">+
</a><a href="#h79-0-1675" id="h79-0-1675" class="i">+void
</a><a href="#h79-0-1676" id="h79-0-1676" class="i">+decideresource(WebKitPolicyDecision *d, Client *c)
</a><a href="#h79-0-1677" id="h79-0-1677" class="i">+{
</a><a href="#h79-0-1678" id="h79-0-1678" class="i">+	int i, isascii = 1;
</a><a href="#h79-0-1679" id="h79-0-1679" class="i">+	WebKitResponsePolicyDecision *r = WEBKIT_RESPONSE_POLICY_DECISION(d);
</a><a href="#h79-0-1680" id="h79-0-1680" class="i">+	WebKitURIResponse *res =
</a><a href="#h79-0-1681" id="h79-0-1681" class="i">+	    webkit_response_policy_decision_get_response(r);
</a><a href="#h79-0-1682" id="h79-0-1682" class="i">+	const gchar *uri = webkit_uri_response_get_uri(res);
</a><a href="#h79-0-1683" id="h79-0-1683" class="i">+
</a><a href="#h79-0-1684" id="h79-0-1684" class="i">+	if (g_str_has_suffix(uri, &quot;/favicon.ico&quot;)) {
</a><a href="#h79-0-1685" id="h79-0-1685" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h79-0-1686" id="h79-0-1686" class="i">+		return;
</a><a href="#h79-0-1687" id="h79-0-1687" class="i">+	}
</a><a href="#h79-0-1688" id="h79-0-1688" class="i">+
</a><a href="#h79-0-1689" id="h79-0-1689" class="i">+	if (!g_str_has_prefix(uri, &quot;http://&quot;)
</a><a href="#h79-0-1690" id="h79-0-1690" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;https://&quot;)
</a><a href="#h79-0-1691" id="h79-0-1691" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;about:&quot;)
</a><a href="#h79-0-1692" id="h79-0-1692" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;file://&quot;)
</a><a href="#h79-0-1693" id="h79-0-1693" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;data:&quot;)
</a><a href="#h79-0-1694" id="h79-0-1694" class="i">+	    &amp;&amp; !g_str_has_prefix(uri, &quot;blob:&quot;)
</a><a href="#h79-0-1695" id="h79-0-1695" class="i">+	    &amp;&amp; strlen(uri) &gt; 0) {
</a><a href="#h79-0-1696" id="h79-0-1696" class="i">+		for (i = 0; i &lt; strlen(uri); i++) {
</a><a href="#h79-0-1697" id="h79-0-1697" class="i">+			if (!g_ascii_isprint(uri[i])) {
</a><a href="#h79-0-1698" id="h79-0-1698" class="i">+				isascii = 0;
</a><a href="#h79-0-1699" id="h79-0-1699" class="i">+				break;
</a><a href="#h79-0-1700" id="h79-0-1700" class="i">+			}
</a><a href="#h79-0-1701" id="h79-0-1701" class="i">+		}
</a><a href="#h79-0-1702" id="h79-0-1702" class="i">+		if (isascii) {
</a><a href="#h79-0-1703" id="h79-0-1703" class="i">+			handleplumb(c, uri);
</a><a href="#h79-0-1704" id="h79-0-1704" class="i">+			webkit_policy_decision_ignore(d);
</a><a href="#h79-0-1705" id="h79-0-1705" class="i">+			return;
</a><a href="#h79-0-1706" id="h79-0-1706" class="i">+		}
</a><a href="#h79-0-1707" id="h79-0-1707" class="i">+	}
</a><a href="#h79-0-1708" id="h79-0-1708" class="i">+
</a><a href="#h79-0-1709" id="h79-0-1709" class="i">+	if (webkit_response_policy_decision_is_mime_type_supported(r)) {
</a><a href="#h79-0-1710" id="h79-0-1710" class="i">+		webkit_policy_decision_use(d);
</a><a href="#h79-0-1711" id="h79-0-1711" class="i">+	} else {
</a><a href="#h79-0-1712" id="h79-0-1712" class="i">+		webkit_policy_decision_ignore(d);
</a><a href="#h79-0-1713" id="h79-0-1713" class="i">+		download(c, res);
</a><a href="#h79-0-1714" id="h79-0-1714" class="i">+	}
</a><a href="#h79-0-1715" id="h79-0-1715" class="i">+}
</a><a href="#h79-0-1716" id="h79-0-1716" class="i">+
</a><a href="#h79-0-1717" id="h79-0-1717" class="i">+void
</a><a href="#h79-0-1718" id="h79-0-1718" class="i">+insecurecontent(WebKitWebView *v, WebKitInsecureContentEvent e, Client *c)
</a><a href="#h79-0-1719" id="h79-0-1719" class="i">+{
</a><a href="#h79-0-1720" id="h79-0-1720" class="i">+	c-&gt;insecure = 1;
</a><a href="#h79-0-1721" id="h79-0-1721" class="i">+}
</a><a href="#h79-0-1722" id="h79-0-1722" class="i">+
</a><a href="#h79-0-1723" id="h79-0-1723" class="i">+void
</a><a href="#h79-0-1724" id="h79-0-1724" class="i">+downloadstarted(WebKitWebContext *wc, WebKitDownload *d, Client *c)
</a><a href="#h79-0-1725" id="h79-0-1725" class="i">+{
</a><a href="#h79-0-1726" id="h79-0-1726" class="i">+	g_signal_connect(G_OBJECT(d), &quot;notify::response&quot;,
</a><a href="#h79-0-1727" id="h79-0-1727" class="i">+	                 G_CALLBACK(responsereceived), c);
</a><a href="#h79-0-1728" id="h79-0-1728" class="i">+}
</a><a href="#h79-0-1729" id="h79-0-1729" class="i">+
</a><a href="#h79-0-1730" id="h79-0-1730" class="i">+void
</a><a href="#h79-0-1731" id="h79-0-1731" class="i">+responsereceived(WebKitDownload *d, GParamSpec *ps, Client *c)
</a><a href="#h79-0-1732" id="h79-0-1732" class="i">+{
</a><a href="#h79-0-1733" id="h79-0-1733" class="i">+	download(c, webkit_download_get_response(d));
</a><a href="#h79-0-1734" id="h79-0-1734" class="i">+	webkit_download_cancel(d);
</a><a href="#h79-0-1735" id="h79-0-1735" class="i">+}
</a><a href="#h79-0-1736" id="h79-0-1736" class="i">+
</a><a href="#h79-0-1737" id="h79-0-1737" class="i">+void
</a><a href="#h79-0-1738" id="h79-0-1738" class="i">+download(Client *c, WebKitURIResponse *r)
</a><a href="#h79-0-1739" id="h79-0-1739" class="i">+{
</a><a href="#h79-0-1740" id="h79-0-1740" class="i">+	Arg a = (Arg)DOWNLOAD(webkit_uri_response_get_uri(r), geturi(c));
</a><a href="#h79-0-1741" id="h79-0-1741" class="i">+	spawn(c, &amp;a);
</a><a href="#h79-0-1742" id="h79-0-1742" class="i">+}
</a><a href="#h79-0-1743" id="h79-0-1743" class="i">+
</a><a href="#h79-0-1744" id="h79-0-1744" class="i">+void
</a><a href="#h79-0-1745" id="h79-0-1745" class="i">+webprocessterminated(WebKitWebView *v, WebKitWebProcessTerminationReason r,
</a><a href="#h79-0-1746" id="h79-0-1746" class="i">+                     Client *c)
</a><a href="#h79-0-1747" id="h79-0-1747" class="i">+{
</a><a href="#h79-0-1748" id="h79-0-1748" class="i">+	fprintf(stderr, &quot;web process terminated: %s\n&quot;,
</a><a href="#h79-0-1749" id="h79-0-1749" class="i">+	        r == WEBKIT_WEB_PROCESS_CRASHED ? &quot;crashed&quot; : &quot;no memory&quot;);
</a><a href="#h79-0-1750" id="h79-0-1750" class="i">+	closeview(v, c);
</a><a href="#h79-0-1751" id="h79-0-1751" class="i">+}
</a><a href="#h79-0-1752" id="h79-0-1752" class="i">+
</a><a href="#h79-0-1753" id="h79-0-1753" class="i">+void
</a><a href="#h79-0-1754" id="h79-0-1754" class="i">+closeview(WebKitWebView *v, Client *c)
</a><a href="#h79-0-1755" id="h79-0-1755" class="i">+{
</a><a href="#h79-0-1756" id="h79-0-1756" class="i">+	gtk_widget_destroy(c-&gt;win);
</a><a href="#h79-0-1757" id="h79-0-1757" class="i">+}
</a><a href="#h79-0-1758" id="h79-0-1758" class="i">+
</a><a href="#h79-0-1759" id="h79-0-1759" class="i">+void
</a><a href="#h79-0-1760" id="h79-0-1760" class="i">+destroywin(GtkWidget* w, Client *c)
</a><a href="#h79-0-1761" id="h79-0-1761" class="i">+{
</a><a href="#h79-0-1762" id="h79-0-1762" class="i">+	destroyclient(c);
</a><a href="#h79-0-1763" id="h79-0-1763" class="i">+	if (!clients)
</a><a href="#h79-0-1764" id="h79-0-1764" class="i">+		gtk_main_quit();
</a><a href="#h79-0-1765" id="h79-0-1765" class="i">+}
</a><a href="#h79-0-1766" id="h79-0-1766" class="i">+
</a><a href="#h79-0-1767" id="h79-0-1767" class="i">+void
</a><a href="#h79-0-1768" id="h79-0-1768" class="i">+pasteuri(GtkClipboard *clipboard, const char *text, gpointer d)
</a><a href="#h79-0-1769" id="h79-0-1769" class="i">+{
</a><a href="#h79-0-1770" id="h79-0-1770" class="i">+	Arg a = {.v = text };
</a><a href="#h79-0-1771" id="h79-0-1771" class="i">+	if (text)
</a><a href="#h79-0-1772" id="h79-0-1772" class="i">+		loaduri((Client *) d, &amp;a);
</a><a href="#h79-0-1773" id="h79-0-1773" class="i">+}
</a><a href="#h79-0-1774" id="h79-0-1774" class="i">+
</a><a href="#h79-0-1775" id="h79-0-1775" class="i">+void
</a><a href="#h79-0-1776" id="h79-0-1776" class="i">+reload(Client *c, const Arg *a)
</a><a href="#h79-0-1777" id="h79-0-1777" class="i">+{
</a><a href="#h79-0-1778" id="h79-0-1778" class="i">+	if (a-&gt;i)
</a><a href="#h79-0-1779" id="h79-0-1779" class="i">+		webkit_web_view_reload_bypass_cache(c-&gt;view);
</a><a href="#h79-0-1780" id="h79-0-1780" class="i">+	else
</a><a href="#h79-0-1781" id="h79-0-1781" class="i">+		webkit_web_view_reload(c-&gt;view);
</a><a href="#h79-0-1782" id="h79-0-1782" class="i">+}
</a><a href="#h79-0-1783" id="h79-0-1783" class="i">+
</a><a href="#h79-0-1784" id="h79-0-1784" class="i">+void
</a><a href="#h79-0-1785" id="h79-0-1785" class="i">+print(Client *c, const Arg *a)
</a><a href="#h79-0-1786" id="h79-0-1786" class="i">+{
</a><a href="#h79-0-1787" id="h79-0-1787" class="i">+	webkit_print_operation_run_dialog(webkit_print_operation_new(c-&gt;view),
</a><a href="#h79-0-1788" id="h79-0-1788" class="i">+	                                  GTK_WINDOW(c-&gt;win));
</a><a href="#h79-0-1789" id="h79-0-1789" class="i">+}
</a><a href="#h79-0-1790" id="h79-0-1790" class="i">+
</a><a href="#h79-0-1791" id="h79-0-1791" class="i">+void
</a><a href="#h79-0-1792" id="h79-0-1792" class="i">+showcert(Client *c, const Arg *a)
</a><a href="#h79-0-1793" id="h79-0-1793" class="i">+{
</a><a href="#h79-0-1794" id="h79-0-1794" class="i">+	GTlsCertificate *cert = c-&gt;failedcert ? c-&gt;failedcert : c-&gt;cert;
</a><a href="#h79-0-1795" id="h79-0-1795" class="i">+	GcrCertificate *gcrt;
</a><a href="#h79-0-1796" id="h79-0-1796" class="i">+	GByteArray *crt;
</a><a href="#h79-0-1797" id="h79-0-1797" class="i">+	GtkWidget *win;
</a><a href="#h79-0-1798" id="h79-0-1798" class="i">+	GcrCertificateWidget *wcert;
</a><a href="#h79-0-1799" id="h79-0-1799" class="i">+
</a><a href="#h79-0-1800" id="h79-0-1800" class="i">+	if (!cert)
</a><a href="#h79-0-1801" id="h79-0-1801" class="i">+		return;
</a><a href="#h79-0-1802" id="h79-0-1802" class="i">+
</a><a href="#h79-0-1803" id="h79-0-1803" class="i">+	g_object_get(cert, &quot;certificate&quot;, &amp;crt, NULL);
</a><a href="#h79-0-1804" id="h79-0-1804" class="i">+	gcrt = gcr_simple_certificate_new(crt-&gt;data, crt-&gt;len);
</a><a href="#h79-0-1805" id="h79-0-1805" class="i">+	g_byte_array_unref(crt);
</a><a href="#h79-0-1806" id="h79-0-1806" class="i">+
</a><a href="#h79-0-1807" id="h79-0-1807" class="i">+	win = gtk_window_new(GTK_WINDOW_TOPLEVEL);
</a><a href="#h79-0-1808" id="h79-0-1808" class="i">+	wcert = gcr_certificate_widget_new(gcrt);
</a><a href="#h79-0-1809" id="h79-0-1809" class="i">+	g_object_unref(gcrt);
</a><a href="#h79-0-1810" id="h79-0-1810" class="i">+
</a><a href="#h79-0-1811" id="h79-0-1811" class="i">+	gtk_container_add(GTK_CONTAINER(win), GTK_WIDGET(wcert));
</a><a href="#h79-0-1812" id="h79-0-1812" class="i">+	gtk_widget_show_all(win);
</a><a href="#h79-0-1813" id="h79-0-1813" class="i">+}
</a><a href="#h79-0-1814" id="h79-0-1814" class="i">+
</a><a href="#h79-0-1815" id="h79-0-1815" class="i">+void
</a><a href="#h79-0-1816" id="h79-0-1816" class="i">+clipboard(Client *c, const Arg *a)
</a><a href="#h79-0-1817" id="h79-0-1817" class="i">+{
</a><a href="#h79-0-1818" id="h79-0-1818" class="i">+	if (a-&gt;i) { /* load clipboard uri */
</a><a href="#h79-0-1819" id="h79-0-1819" class="i">+		gtk_clipboard_request_text(gtk_clipboard_get(
</a><a href="#h79-0-1820" id="h79-0-1820" class="i">+		                           GDK_SELECTION_PRIMARY),
</a><a href="#h79-0-1821" id="h79-0-1821" class="i">+		                           pasteuri, c);
</a><a href="#h79-0-1822" id="h79-0-1822" class="i">+	} else { /* copy uri */
</a><a href="#h79-0-1823" id="h79-0-1823" class="i">+		gtk_clipboard_set_text(gtk_clipboard_get(
</a><a href="#h79-0-1824" id="h79-0-1824" class="i">+		                       GDK_SELECTION_PRIMARY), c-&gt;targeturi
</a><a href="#h79-0-1825" id="h79-0-1825" class="i">+		                       ? c-&gt;targeturi : geturi(c), -1);
</a><a href="#h79-0-1826" id="h79-0-1826" class="i">+	}
</a><a href="#h79-0-1827" id="h79-0-1827" class="i">+}
</a><a href="#h79-0-1828" id="h79-0-1828" class="i">+
</a><a href="#h79-0-1829" id="h79-0-1829" class="i">+void
</a><a href="#h79-0-1830" id="h79-0-1830" class="i">+zoom(Client *c, const Arg *a)
</a><a href="#h79-0-1831" id="h79-0-1831" class="i">+{
</a><a href="#h79-0-1832" id="h79-0-1832" class="i">+	if (a-&gt;i &gt; 0)
</a><a href="#h79-0-1833" id="h79-0-1833" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view,
</a><a href="#h79-0-1834" id="h79-0-1834" class="i">+		                               curconfig[ZoomLevel].val.f + 0.1);
</a><a href="#h79-0-1835" id="h79-0-1835" class="i">+	else if (a-&gt;i &lt; 0)
</a><a href="#h79-0-1836" id="h79-0-1836" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view,
</a><a href="#h79-0-1837" id="h79-0-1837" class="i">+		                               curconfig[ZoomLevel].val.f - 0.1);
</a><a href="#h79-0-1838" id="h79-0-1838" class="i">+	else
</a><a href="#h79-0-1839" id="h79-0-1839" class="i">+		webkit_web_view_set_zoom_level(c-&gt;view, 1.0);
</a><a href="#h79-0-1840" id="h79-0-1840" class="i">+
</a><a href="#h79-0-1841" id="h79-0-1841" class="i">+	curconfig[ZoomLevel].val.f = webkit_web_view_get_zoom_level(c-&gt;view);
</a><a href="#h79-0-1842" id="h79-0-1842" class="i">+}
</a><a href="#h79-0-1843" id="h79-0-1843" class="i">+
</a><a href="#h79-0-1844" id="h79-0-1844" class="i">+static void
</a><a href="#h79-0-1845" id="h79-0-1845" class="i">+msgext(Client *c, char type, const Arg *a)
</a><a href="#h79-0-1846" id="h79-0-1846" class="i">+{
</a><a href="#h79-0-1847" id="h79-0-1847" class="i">+	static char msg[MSGBUFSZ];
</a><a href="#h79-0-1848" id="h79-0-1848" class="i">+	int ret;
</a><a href="#h79-0-1849" id="h79-0-1849" class="i">+
</a><a href="#h79-0-1850" id="h79-0-1850" class="i">+	if ((ret = snprintf(msg, sizeof(msg), &quot;%c%c%c%c&quot;,
</a><a href="#h79-0-1851" id="h79-0-1851" class="i">+	                    4, c-&gt;pageid, type, a-&gt;i))
</a><a href="#h79-0-1852" id="h79-0-1852" class="i">+	    &gt;= sizeof(msg)) {
</a><a href="#h79-0-1853" id="h79-0-1853" class="i">+		fprintf(stderr, &quot;surf: message too long: %d\n&quot;, ret);
</a><a href="#h79-0-1854" id="h79-0-1854" class="i">+		return;
</a><a href="#h79-0-1855" id="h79-0-1855" class="i">+	}
</a><a href="#h79-0-1856" id="h79-0-1856" class="i">+
</a><a href="#h79-0-1857" id="h79-0-1857" class="i">+	if (pipeout[1] &amp;&amp; write(pipeout[1], msg, sizeof(msg)) &lt; 0)
</a><a href="#h79-0-1858" id="h79-0-1858" class="i">+		fprintf(stderr, &quot;surf: error sending: %.*s\n&quot;, ret-2, msg+2);
</a><a href="#h79-0-1859" id="h79-0-1859" class="i">+}
</a><a href="#h79-0-1860" id="h79-0-1860" class="i">+
</a><a href="#h79-0-1861" id="h79-0-1861" class="i">+void
</a><a href="#h79-0-1862" id="h79-0-1862" class="i">+scrollv(Client *c, const Arg *a)
</a><a href="#h79-0-1863" id="h79-0-1863" class="i">+{
</a><a href="#h79-0-1864" id="h79-0-1864" class="i">+	msgext(c, &#39;v&#39;, a);
</a><a href="#h79-0-1865" id="h79-0-1865" class="i">+}
</a><a href="#h79-0-1866" id="h79-0-1866" class="i">+
</a><a href="#h79-0-1867" id="h79-0-1867" class="i">+void
</a><a href="#h79-0-1868" id="h79-0-1868" class="i">+scrollh(Client *c, const Arg *a)
</a><a href="#h79-0-1869" id="h79-0-1869" class="i">+{
</a><a href="#h79-0-1870" id="h79-0-1870" class="i">+	msgext(c, &#39;h&#39;, a);
</a><a href="#h79-0-1871" id="h79-0-1871" class="i">+}
</a><a href="#h79-0-1872" id="h79-0-1872" class="i">+
</a><a href="#h79-0-1873" id="h79-0-1873" class="i">+void
</a><a href="#h79-0-1874" id="h79-0-1874" class="i">+navigate(Client *c, const Arg *a)
</a><a href="#h79-0-1875" id="h79-0-1875" class="i">+{
</a><a href="#h79-0-1876" id="h79-0-1876" class="i">+	if (a-&gt;i &lt; 0)
</a><a href="#h79-0-1877" id="h79-0-1877" class="i">+		webkit_web_view_go_back(c-&gt;view);
</a><a href="#h79-0-1878" id="h79-0-1878" class="i">+	else if (a-&gt;i &gt; 0)
</a><a href="#h79-0-1879" id="h79-0-1879" class="i">+		webkit_web_view_go_forward(c-&gt;view);
</a><a href="#h79-0-1880" id="h79-0-1880" class="i">+}
</a><a href="#h79-0-1881" id="h79-0-1881" class="i">+
</a><a href="#h79-0-1882" id="h79-0-1882" class="i">+void
</a><a href="#h79-0-1883" id="h79-0-1883" class="i">+stop(Client *c, const Arg *a)
</a><a href="#h79-0-1884" id="h79-0-1884" class="i">+{
</a><a href="#h79-0-1885" id="h79-0-1885" class="i">+	webkit_web_view_stop_loading(c-&gt;view);
</a><a href="#h79-0-1886" id="h79-0-1886" class="i">+}
</a><a href="#h79-0-1887" id="h79-0-1887" class="i">+
</a><a href="#h79-0-1888" id="h79-0-1888" class="i">+void
</a><a href="#h79-0-1889" id="h79-0-1889" class="i">+toggle(Client *c, const Arg *a)
</a><a href="#h79-0-1890" id="h79-0-1890" class="i">+{
</a><a href="#h79-0-1891" id="h79-0-1891" class="i">+	curconfig[a-&gt;i].val.i ^= 1;
</a><a href="#h79-0-1892" id="h79-0-1892" class="i">+	setparameter(c, 1, (ParamName)a-&gt;i, &amp;curconfig[a-&gt;i].val);
</a><a href="#h79-0-1893" id="h79-0-1893" class="i">+}
</a><a href="#h79-0-1894" id="h79-0-1894" class="i">+
</a><a href="#h79-0-1895" id="h79-0-1895" class="i">+void
</a><a href="#h79-0-1896" id="h79-0-1896" class="i">+togglefullscreen(Client *c, const Arg *a)
</a><a href="#h79-0-1897" id="h79-0-1897" class="i">+{
</a><a href="#h79-0-1898" id="h79-0-1898" class="i">+	/* toggling value is handled in winevent() */
</a><a href="#h79-0-1899" id="h79-0-1899" class="i">+	if (c-&gt;fullscreen)
</a><a href="#h79-0-1900" id="h79-0-1900" class="i">+		gtk_window_unfullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h79-0-1901" id="h79-0-1901" class="i">+	else
</a><a href="#h79-0-1902" id="h79-0-1902" class="i">+		gtk_window_fullscreen(GTK_WINDOW(c-&gt;win));
</a><a href="#h79-0-1903" id="h79-0-1903" class="i">+}
</a><a href="#h79-0-1904" id="h79-0-1904" class="i">+
</a><a href="#h79-0-1905" id="h79-0-1905" class="i">+void
</a><a href="#h79-0-1906" id="h79-0-1906" class="i">+togglecookiepolicy(Client *c, const Arg *a)
</a><a href="#h79-0-1907" id="h79-0-1907" class="i">+{
</a><a href="#h79-0-1908" id="h79-0-1908" class="i">+	++cookiepolicy;
</a><a href="#h79-0-1909" id="h79-0-1909" class="i">+	cookiepolicy %= strlen(curconfig[CookiePolicies].val.v);
</a><a href="#h79-0-1910" id="h79-0-1910" class="i">+
</a><a href="#h79-0-1911" id="h79-0-1911" class="i">+	setparameter(c, 0, CookiePolicies, NULL);
</a><a href="#h79-0-1912" id="h79-0-1912" class="i">+}
</a><a href="#h79-0-1913" id="h79-0-1913" class="i">+
</a><a href="#h79-0-1914" id="h79-0-1914" class="i">+void
</a><a href="#h79-0-1915" id="h79-0-1915" class="i">+toggleinspector(Client *c, const Arg *a)
</a><a href="#h79-0-1916" id="h79-0-1916" class="i">+{
</a><a href="#h79-0-1917" id="h79-0-1917" class="i">+	if (webkit_web_inspector_is_attached(c-&gt;inspector))
</a><a href="#h79-0-1918" id="h79-0-1918" class="i">+		webkit_web_inspector_close(c-&gt;inspector);
</a><a href="#h79-0-1919" id="h79-0-1919" class="i">+	else if (curconfig[Inspector].val.i)
</a><a href="#h79-0-1920" id="h79-0-1920" class="i">+		webkit_web_inspector_show(c-&gt;inspector);
</a><a href="#h79-0-1921" id="h79-0-1921" class="i">+}
</a><a href="#h79-0-1922" id="h79-0-1922" class="i">+
</a><a href="#h79-0-1923" id="h79-0-1923" class="i">+void
</a><a href="#h79-0-1924" id="h79-0-1924" class="i">+find(Client *c, const Arg *a)
</a><a href="#h79-0-1925" id="h79-0-1925" class="i">+{
</a><a href="#h79-0-1926" id="h79-0-1926" class="i">+	const char *s, *f;
</a><a href="#h79-0-1927" id="h79-0-1927" class="i">+
</a><a href="#h79-0-1928" id="h79-0-1928" class="i">+	if (a &amp;&amp; a-&gt;i) {
</a><a href="#h79-0-1929" id="h79-0-1929" class="i">+		if (a-&gt;i &gt; 0)
</a><a href="#h79-0-1930" id="h79-0-1930" class="i">+			webkit_find_controller_search_next(c-&gt;finder);
</a><a href="#h79-0-1931" id="h79-0-1931" class="i">+		else
</a><a href="#h79-0-1932" id="h79-0-1932" class="i">+			webkit_find_controller_search_previous(c-&gt;finder);
</a><a href="#h79-0-1933" id="h79-0-1933" class="i">+	} else {
</a><a href="#h79-0-1934" id="h79-0-1934" class="i">+		s = getatom(c, AtomFind);
</a><a href="#h79-0-1935" id="h79-0-1935" class="i">+		f = webkit_find_controller_get_search_text(c-&gt;finder);
</a><a href="#h79-0-1936" id="h79-0-1936" class="i">+
</a><a href="#h79-0-1937" id="h79-0-1937" class="i">+		if (g_strcmp0(f, s) == 0) /* reset search */
</a><a href="#h79-0-1938" id="h79-0-1938" class="i">+			webkit_find_controller_search(c-&gt;finder, &quot;&quot;, findopts,
</a><a href="#h79-0-1939" id="h79-0-1939" class="i">+			                              G_MAXUINT);
</a><a href="#h79-0-1940" id="h79-0-1940" class="i">+
</a><a href="#h79-0-1941" id="h79-0-1941" class="i">+		webkit_find_controller_search(c-&gt;finder, s, findopts,
</a><a href="#h79-0-1942" id="h79-0-1942" class="i">+		                              G_MAXUINT);
</a><a href="#h79-0-1943" id="h79-0-1943" class="i">+
</a><a href="#h79-0-1944" id="h79-0-1944" class="i">+		if (strcmp(s, &quot;&quot;) == 0)
</a><a href="#h79-0-1945" id="h79-0-1945" class="i">+			webkit_find_controller_search_finish(c-&gt;finder);
</a><a href="#h79-0-1946" id="h79-0-1946" class="i">+	}
</a><a href="#h79-0-1947" id="h79-0-1947" class="i">+}
</a><a href="#h79-0-1948" id="h79-0-1948" class="i">+
</a><a href="#h79-0-1949" id="h79-0-1949" class="i">+void
</a><a href="#h79-0-1950" id="h79-0-1950" class="i">+clicknavigate(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h79-0-1951" id="h79-0-1951" class="i">+{
</a><a href="#h79-0-1952" id="h79-0-1952" class="i">+	navigate(c, a);
</a><a href="#h79-0-1953" id="h79-0-1953" class="i">+}
</a><a href="#h79-0-1954" id="h79-0-1954" class="i">+
</a><a href="#h79-0-1955" id="h79-0-1955" class="i">+void
</a><a href="#h79-0-1956" id="h79-0-1956" class="i">+clicknewwindow(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h79-0-1957" id="h79-0-1957" class="i">+{
</a><a href="#h79-0-1958" id="h79-0-1958" class="i">+	Arg arg;
</a><a href="#h79-0-1959" id="h79-0-1959" class="i">+
</a><a href="#h79-0-1960" id="h79-0-1960" class="i">+	arg.v = webkit_hit_test_result_get_link_uri(h);
</a><a href="#h79-0-1961" id="h79-0-1961" class="i">+	newwindow(c, &amp;arg, a-&gt;i);
</a><a href="#h79-0-1962" id="h79-0-1962" class="i">+}
</a><a href="#h79-0-1963" id="h79-0-1963" class="i">+
</a><a href="#h79-0-1964" id="h79-0-1964" class="i">+void
</a><a href="#h79-0-1965" id="h79-0-1965" class="i">+clickexternplayer(Client *c, const Arg *a, WebKitHitTestResult *h)
</a><a href="#h79-0-1966" id="h79-0-1966" class="i">+{
</a><a href="#h79-0-1967" id="h79-0-1967" class="i">+	Arg arg;
</a><a href="#h79-0-1968" id="h79-0-1968" class="i">+
</a><a href="#h79-0-1969" id="h79-0-1969" class="i">+	arg = (Arg)VIDEOPLAY(webkit_hit_test_result_get_media_uri(h));
</a><a href="#h79-0-1970" id="h79-0-1970" class="i">+	spawn(c, &amp;arg);
</a><a href="#h79-0-1971" id="h79-0-1971" class="i">+}
</a><a href="#h79-0-1972" id="h79-0-1972" class="i">+
</a><a href="#h79-0-1973" id="h79-0-1973" class="i">+int
</a><a href="#h79-0-1974" id="h79-0-1974" class="i">+main(int argc, char *argv[])
</a><a href="#h79-0-1975" id="h79-0-1975" class="i">+{
</a><a href="#h79-0-1976" id="h79-0-1976" class="i">+	Arg arg;
</a><a href="#h79-0-1977" id="h79-0-1977" class="i">+	Client *c;
</a><a href="#h79-0-1978" id="h79-0-1978" class="i">+
</a><a href="#h79-0-1979" id="h79-0-1979" class="i">+	memset(&amp;arg, 0, sizeof(arg));
</a><a href="#h79-0-1980" id="h79-0-1980" class="i">+
</a><a href="#h79-0-1981" id="h79-0-1981" class="i">+	/* command line args */
</a><a href="#h79-0-1982" id="h79-0-1982" class="i">+	ARGBEGIN {
</a><a href="#h79-0-1983" id="h79-0-1983" class="i">+	case &#39;a&#39;:
</a><a href="#h79-0-1984" id="h79-0-1984" class="i">+		defconfig[CookiePolicies].val.v = EARGF(usage());
</a><a href="#h79-0-1985" id="h79-0-1985" class="i">+		defconfig[CookiePolicies].prio = 2;
</a><a href="#h79-0-1986" id="h79-0-1986" class="i">+		break;
</a><a href="#h79-0-1987" id="h79-0-1987" class="i">+	case &#39;b&#39;:
</a><a href="#h79-0-1988" id="h79-0-1988" class="i">+		defconfig[ScrollBars].val.i = 0;
</a><a href="#h79-0-1989" id="h79-0-1989" class="i">+		defconfig[ScrollBars].prio = 2;
</a><a href="#h79-0-1990" id="h79-0-1990" class="i">+		break;
</a><a href="#h79-0-1991" id="h79-0-1991" class="i">+	case &#39;B&#39;:
</a><a href="#h79-0-1992" id="h79-0-1992" class="i">+		defconfig[ScrollBars].val.i = 1;
</a><a href="#h79-0-1993" id="h79-0-1993" class="i">+		defconfig[ScrollBars].prio = 2;
</a><a href="#h79-0-1994" id="h79-0-1994" class="i">+		break;
</a><a href="#h79-0-1995" id="h79-0-1995" class="i">+	case &#39;c&#39;:
</a><a href="#h79-0-1996" id="h79-0-1996" class="i">+		cookiefile = EARGF(usage());
</a><a href="#h79-0-1997" id="h79-0-1997" class="i">+		break;
</a><a href="#h79-0-1998" id="h79-0-1998" class="i">+	case &#39;C&#39;:
</a><a href="#h79-0-1999" id="h79-0-1999" class="i">+		stylefile = EARGF(usage());
</a><a href="#h79-0-2000" id="h79-0-2000" class="i">+		break;
</a><a href="#h79-0-2001" id="h79-0-2001" class="i">+	case &#39;d&#39;:
</a><a href="#h79-0-2002" id="h79-0-2002" class="i">+		defconfig[DiskCache].val.i = 0;
</a><a href="#h79-0-2003" id="h79-0-2003" class="i">+		defconfig[DiskCache].prio = 2;
</a><a href="#h79-0-2004" id="h79-0-2004" class="i">+		break;
</a><a href="#h79-0-2005" id="h79-0-2005" class="i">+	case &#39;D&#39;:
</a><a href="#h79-0-2006" id="h79-0-2006" class="i">+		defconfig[DiskCache].val.i = 1;
</a><a href="#h79-0-2007" id="h79-0-2007" class="i">+		defconfig[DiskCache].prio = 2;
</a><a href="#h79-0-2008" id="h79-0-2008" class="i">+		break;
</a><a href="#h79-0-2009" id="h79-0-2009" class="i">+	case &#39;e&#39;:
</a><a href="#h79-0-2010" id="h79-0-2010" class="i">+		embed = strtol(EARGF(usage()), NULL, 0);
</a><a href="#h79-0-2011" id="h79-0-2011" class="i">+		break;
</a><a href="#h79-0-2012" id="h79-0-2012" class="i">+	case &#39;f&#39;:
</a><a href="#h79-0-2013" id="h79-0-2013" class="i">+		defconfig[RunInFullscreen].val.i = 0;
</a><a href="#h79-0-2014" id="h79-0-2014" class="i">+		defconfig[RunInFullscreen].prio = 2;
</a><a href="#h79-0-2015" id="h79-0-2015" class="i">+		break;
</a><a href="#h79-0-2016" id="h79-0-2016" class="i">+	case &#39;F&#39;:
</a><a href="#h79-0-2017" id="h79-0-2017" class="i">+		defconfig[RunInFullscreen].val.i = 1;
</a><a href="#h79-0-2018" id="h79-0-2018" class="i">+		defconfig[RunInFullscreen].prio = 2;
</a><a href="#h79-0-2019" id="h79-0-2019" class="i">+		break;
</a><a href="#h79-0-2020" id="h79-0-2020" class="i">+	case &#39;g&#39;:
</a><a href="#h79-0-2021" id="h79-0-2021" class="i">+		defconfig[Geolocation].val.i = 0;
</a><a href="#h79-0-2022" id="h79-0-2022" class="i">+		defconfig[Geolocation].prio = 2;
</a><a href="#h79-0-2023" id="h79-0-2023" class="i">+		break;
</a><a href="#h79-0-2024" id="h79-0-2024" class="i">+	case &#39;G&#39;:
</a><a href="#h79-0-2025" id="h79-0-2025" class="i">+		defconfig[Geolocation].val.i = 1;
</a><a href="#h79-0-2026" id="h79-0-2026" class="i">+		defconfig[Geolocation].prio = 2;
</a><a href="#h79-0-2027" id="h79-0-2027" class="i">+		break;
</a><a href="#h79-0-2028" id="h79-0-2028" class="i">+	case &#39;i&#39;:
</a><a href="#h79-0-2029" id="h79-0-2029" class="i">+		defconfig[LoadImages].val.i = 0;
</a><a href="#h79-0-2030" id="h79-0-2030" class="i">+		defconfig[LoadImages].prio = 2;
</a><a href="#h79-0-2031" id="h79-0-2031" class="i">+		break;
</a><a href="#h79-0-2032" id="h79-0-2032" class="i">+	case &#39;I&#39;:
</a><a href="#h79-0-2033" id="h79-0-2033" class="i">+		defconfig[LoadImages].val.i = 1;
</a><a href="#h79-0-2034" id="h79-0-2034" class="i">+		defconfig[LoadImages].prio = 2;
</a><a href="#h79-0-2035" id="h79-0-2035" class="i">+		break;
</a><a href="#h79-0-2036" id="h79-0-2036" class="i">+	case &#39;k&#39;:
</a><a href="#h79-0-2037" id="h79-0-2037" class="i">+		defconfig[KioskMode].val.i = 0;
</a><a href="#h79-0-2038" id="h79-0-2038" class="i">+		defconfig[KioskMode].prio = 2;
</a><a href="#h79-0-2039" id="h79-0-2039" class="i">+		break;
</a><a href="#h79-0-2040" id="h79-0-2040" class="i">+	case &#39;K&#39;:
</a><a href="#h79-0-2041" id="h79-0-2041" class="i">+		defconfig[KioskMode].val.i = 1;
</a><a href="#h79-0-2042" id="h79-0-2042" class="i">+		defconfig[KioskMode].prio = 2;
</a><a href="#h79-0-2043" id="h79-0-2043" class="i">+		break;
</a><a href="#h79-0-2044" id="h79-0-2044" class="i">+	case &#39;m&#39;:
</a><a href="#h79-0-2045" id="h79-0-2045" class="i">+		defconfig[Style].val.i = 0;
</a><a href="#h79-0-2046" id="h79-0-2046" class="i">+		defconfig[Style].prio = 2;
</a><a href="#h79-0-2047" id="h79-0-2047" class="i">+		break;
</a><a href="#h79-0-2048" id="h79-0-2048" class="i">+	case &#39;M&#39;:
</a><a href="#h79-0-2049" id="h79-0-2049" class="i">+		defconfig[Style].val.i = 1;
</a><a href="#h79-0-2050" id="h79-0-2050" class="i">+		defconfig[Style].prio = 2;
</a><a href="#h79-0-2051" id="h79-0-2051" class="i">+		break;
</a><a href="#h79-0-2052" id="h79-0-2052" class="i">+	case &#39;n&#39;:
</a><a href="#h79-0-2053" id="h79-0-2053" class="i">+		defconfig[Inspector].val.i = 0;
</a><a href="#h79-0-2054" id="h79-0-2054" class="i">+		defconfig[Inspector].prio = 2;
</a><a href="#h79-0-2055" id="h79-0-2055" class="i">+		break;
</a><a href="#h79-0-2056" id="h79-0-2056" class="i">+	case &#39;N&#39;:
</a><a href="#h79-0-2057" id="h79-0-2057" class="i">+		defconfig[Inspector].val.i = 1;
</a><a href="#h79-0-2058" id="h79-0-2058" class="i">+		defconfig[Inspector].prio = 2;
</a><a href="#h79-0-2059" id="h79-0-2059" class="i">+		break;
</a><a href="#h79-0-2060" id="h79-0-2060" class="i">+	case &#39;p&#39;:
</a><a href="#h79-0-2061" id="h79-0-2061" class="i">+		defconfig[Plugins].val.i = 0;
</a><a href="#h79-0-2062" id="h79-0-2062" class="i">+		defconfig[Plugins].prio = 2;
</a><a href="#h79-0-2063" id="h79-0-2063" class="i">+		break;
</a><a href="#h79-0-2064" id="h79-0-2064" class="i">+	case &#39;P&#39;:
</a><a href="#h79-0-2065" id="h79-0-2065" class="i">+		defconfig[Plugins].val.i = 1;
</a><a href="#h79-0-2066" id="h79-0-2066" class="i">+		defconfig[Plugins].prio = 2;
</a><a href="#h79-0-2067" id="h79-0-2067" class="i">+		break;
</a><a href="#h79-0-2068" id="h79-0-2068" class="i">+	case &#39;r&#39;:
</a><a href="#h79-0-2069" id="h79-0-2069" class="i">+		scriptfile = EARGF(usage());
</a><a href="#h79-0-2070" id="h79-0-2070" class="i">+		break;
</a><a href="#h79-0-2071" id="h79-0-2071" class="i">+	case &#39;s&#39;:
</a><a href="#h79-0-2072" id="h79-0-2072" class="i">+		defconfig[JavaScript].val.i = 0;
</a><a href="#h79-0-2073" id="h79-0-2073" class="i">+		defconfig[JavaScript].prio = 2;
</a><a href="#h79-0-2074" id="h79-0-2074" class="i">+		break;
</a><a href="#h79-0-2075" id="h79-0-2075" class="i">+	case &#39;S&#39;:
</a><a href="#h79-0-2076" id="h79-0-2076" class="i">+		defconfig[JavaScript].val.i = 1;
</a><a href="#h79-0-2077" id="h79-0-2077" class="i">+		defconfig[JavaScript].prio = 2;
</a><a href="#h79-0-2078" id="h79-0-2078" class="i">+		break;
</a><a href="#h79-0-2079" id="h79-0-2079" class="i">+	case &#39;t&#39;:
</a><a href="#h79-0-2080" id="h79-0-2080" class="i">+		defconfig[StrictTLS].val.i = 0;
</a><a href="#h79-0-2081" id="h79-0-2081" class="i">+		defconfig[StrictTLS].prio = 2;
</a><a href="#h79-0-2082" id="h79-0-2082" class="i">+		break;
</a><a href="#h79-0-2083" id="h79-0-2083" class="i">+	case &#39;T&#39;:
</a><a href="#h79-0-2084" id="h79-0-2084" class="i">+		defconfig[StrictTLS].val.i = 1;
</a><a href="#h79-0-2085" id="h79-0-2085" class="i">+		defconfig[StrictTLS].prio = 2;
</a><a href="#h79-0-2086" id="h79-0-2086" class="i">+		break;
</a><a href="#h79-0-2087" id="h79-0-2087" class="i">+	case &#39;u&#39;:
</a><a href="#h79-0-2088" id="h79-0-2088" class="i">+		fulluseragent = EARGF(usage());
</a><a href="#h79-0-2089" id="h79-0-2089" class="i">+		break;
</a><a href="#h79-0-2090" id="h79-0-2090" class="i">+	case &#39;v&#39;:
</a><a href="#h79-0-2091" id="h79-0-2091" class="i">+		die(&quot;surf-&quot;VERSION&quot;, see LICENSE for © details\n&quot;);
</a><a href="#h79-0-2092" id="h79-0-2092" class="i">+	case &#39;w&#39;:
</a><a href="#h79-0-2093" id="h79-0-2093" class="i">+		showxid = 1;
</a><a href="#h79-0-2094" id="h79-0-2094" class="i">+		break;
</a><a href="#h79-0-2095" id="h79-0-2095" class="i">+	case &#39;x&#39;:
</a><a href="#h79-0-2096" id="h79-0-2096" class="i">+		defconfig[Certificate].val.i = 0;
</a><a href="#h79-0-2097" id="h79-0-2097" class="i">+		defconfig[Certificate].prio = 2;
</a><a href="#h79-0-2098" id="h79-0-2098" class="i">+		break;
</a><a href="#h79-0-2099" id="h79-0-2099" class="i">+	case &#39;X&#39;:
</a><a href="#h79-0-2100" id="h79-0-2100" class="i">+		defconfig[Certificate].val.i = 1;
</a><a href="#h79-0-2101" id="h79-0-2101" class="i">+		defconfig[Certificate].prio = 2;
</a><a href="#h79-0-2102" id="h79-0-2102" class="i">+		break;
</a><a href="#h79-0-2103" id="h79-0-2103" class="i">+	case &#39;z&#39;:
</a><a href="#h79-0-2104" id="h79-0-2104" class="i">+		defconfig[ZoomLevel].val.f = strtof(EARGF(usage()), NULL);
</a><a href="#h79-0-2105" id="h79-0-2105" class="i">+		defconfig[ZoomLevel].prio = 2;
</a><a href="#h79-0-2106" id="h79-0-2106" class="i">+		break;
</a><a href="#h79-0-2107" id="h79-0-2107" class="i">+	default:
</a><a href="#h79-0-2108" id="h79-0-2108" class="i">+		usage();
</a><a href="#h79-0-2109" id="h79-0-2109" class="i">+	} ARGEND;
</a><a href="#h79-0-2110" id="h79-0-2110" class="i">+	if (argc &gt; 0)
</a><a href="#h79-0-2111" id="h79-0-2111" class="i">+		arg.v = argv[0];
</a><a href="#h79-0-2112" id="h79-0-2112" class="i">+	else
</a><a href="#h79-0-2113" id="h79-0-2113" class="i">+#ifdef HOMEPAGE
</a><a href="#h79-0-2114" id="h79-0-2114" class="i">+		arg.v = HOMEPAGE;
</a><a href="#h79-0-2115" id="h79-0-2115" class="i">+#else
</a><a href="#h79-0-2116" id="h79-0-2116" class="i">+		arg.v = &quot;about:blank&quot;;
</a><a href="#h79-0-2117" id="h79-0-2117" class="i">+#endif
</a><a href="#h79-0-2118" id="h79-0-2118" class="i">+
</a><a href="#h79-0-2119" id="h79-0-2119" class="i">+	setup();
</a><a href="#h79-0-2120" id="h79-0-2120" class="i">+	c = newclient(NULL);
</a><a href="#h79-0-2121" id="h79-0-2121" class="i">+	showview(NULL, c);
</a><a href="#h79-0-2122" id="h79-0-2122" class="i">+
</a><a href="#h79-0-2123" id="h79-0-2123" class="i">+	loaduri(c, &amp;arg);
</a><a href="#h79-0-2124" id="h79-0-2124" class="i">+	updatetitle(c);
</a><a href="#h79-0-2125" id="h79-0-2125" class="i">+
</a><a href="#h79-0-2126" id="h79-0-2126" class="i">+	gtk_main();
</a><a href="#h79-0-2127" id="h79-0-2127" class="i">+	cleanup();
</a><a href="#h79-0-2128" id="h79-0-2128" class="i">+
</a><a href="#h79-0-2129" id="h79-0-2129" class="i">+	return 0;
</a><a href="#h79-0-2130" id="h79-0-2130" class="i">+}
</a><b>diff --git a/<a id="h80" href="../file/surf/surf.c.rej.html">surf/surf.c.rej</a> b/<a href="../file/surf/surf.c.rej.html">surf/surf.c.rej</a></b>
<a href="#h80-0" id="h80-0" class="h">@@ -0,0 +1,14 @@
</a><a href="#h80-0-0" id="h80-0-0" class="i">+--- surf.c
</a><a href="#h80-0-1" id="h80-0-1" class="i">++++ surf.c
</a><a href="#h80-0-2" id="h80-0-2" class="i">+@@ -1751,7 +1751,11 @@ main(int argc, char *argv[])
</a><a href="#h80-0-3" id="h80-0-3" class="i">+ 	if (argc &gt; 0)
</a><a href="#h80-0-4" id="h80-0-4" class="i">+ 		arg.v = argv[0];
</a><a href="#h80-0-5" id="h80-0-5" class="i">+ 	else
</a><a href="#h80-0-6" id="h80-0-6" class="i">++#ifdef HOMEPAGE
</a><a href="#h80-0-7" id="h80-0-7" class="i">++		arg.v = HOMEPAGE;
</a><a href="#h80-0-8" id="h80-0-8" class="i">++#else
</a><a href="#h80-0-9" id="h80-0-9" class="i">+ 		arg.v = &quot;about:blank&quot;;
</a><a href="#h80-0-10" id="h80-0-10" class="i">++#endif
</a><a href="#h80-0-11" id="h80-0-11" class="i">+ 
</a><a href="#h80-0-12" id="h80-0-12" class="i">+ 	setup();
</a><a href="#h80-0-13" id="h80-0-13" class="i">+ 	c = newclient(NULL);
</a><b>diff --git a/<a id="h81" href="../file/surf/surf.o.html">surf/surf.o</a> b/<a href="../file/surf/surf.o.html">surf/surf.o</a></b>
Binary files differ.
<b>diff --git a/<a id="h82" href="../file/surf/surf.png.html">surf/surf.png</a> b/<a href="../file/surf/surf.png.html">surf/surf.png</a></b>
Binary files differ.
</pre>
</div>
</body>
</html>
